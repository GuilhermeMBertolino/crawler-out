<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="proma" content="no-cache"><meta http-equiv="cache-control" content="no cache"><meta http-equiv="expires" content="0"><meta content="width=device-width,initial-scale=1,user-scalable=no" name="viewport"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="stylesheet" href="/static/css/phone/style.css"><style>::-webkit-scrollbar{display:none}.main-pad{padding:1% 3% 1% 3%;height:70vh}.row{clear:both;width:100%;height:35px;line-height:35px}.span2{width:35%;float:left;white-space:nowrap;overflow-x:auto}.span3{width:30%;float:left;white-space:nowrap;overflow-x:auto}</style></head><body><div id="app"></div><script type="text/x-template" id="main"><div>
  <div class="toper">
    <phone-back url="/phone/tools.html" :title="lang_t('menu.tools')"></phone-back>
  </div>
  <div class="nav">{{ lang_t('menu.salv_upload') }}</div>
  <br>
  <div class="content" style="padding:6% 0;width: 100%;">
	<div class="main-pad">
	  <div class="list-main">
        <div class="row-group">
          <div style="text-align:center">
            {{lang_t('mesh.crrent_device')}}
          </div>
        </div>
        <div class="group">
          <div class="content-list">
            <table class="t_table3" style="width: 100%;">
              <thead> 
                <tr>
                  <th>MAC</th>
                  <th>{{ lang_t('firmware.firmware_ver') }}</th>
                  <th>{{ lang_t('firmware.check') }}</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(data,i) in device" :key="i"v-if="meshState=='1'">
                  <td>
                    <span>{{ data.mac }}</span>
                  </td>
                  <td>
                    <span>{{ data.version }}</span>
                  </td>
                  <td>
                    <span v-if="loadResult[i]">{{ lang_t('firmware.upload') }}</span>
                    <button v-else class="login-btn-blue" style="height: auto;padding: 3px 2px;" @click="checkLoad(data.ip,i)">{{ lang_t('firmware.check_btn') }}</button>
                  </td>
                </tr>
              </tbody>
            </table>
          <div class="row" v-else style="font-size: 14px;">{{ lang_t('mesh.msg2') }}</div>
        </div>
        </div>
	  </div>
    </div>
  </div>
</div></script><script src="/plugin/vue.js"></script><script src="/plugin/jquery-3.2.1.min.js"></script><script src="/static/js/config.js"></script><script src="/static/js/phone_layout.js"></script><script src="/static/js/common.js"></script><script src="/static/js/topicurl.js"></script><script>var cs_main={template:"#main",data:function(){return{globalConfig:globalConfig,lang:$.lang,lang_t:lang_t,meshState:"0",listHeight:"300px",device:[],loadResult:[]}},created:function(){var t=this;this.meshInit(!0),window.setInterval(function(){t.meshInit(!1)},2e4)},methods:{meshInit:function(a){var i=this;uiPost.getWiFiMeshConfig(function(t){i.meshState=t.meshState,i.device=t.meshInfo;for(var e=0;e<i.device.length;e++)"1"==i.device[e].updating?i.loadResult[e]=!0:(a||i.loadResult[e])&&(i.loadResult[e]=!1)})},backFun:function(){location.href="tools.html?timestamp="+(new Date).getTime()},checkLoad:function(a,t){var i=this,n=0,s={type:"1",ip:a};this.idx=t,_tempStopLoad_=!0,Cstool.Mark({content:this.lang_t("firmware.newcloudUpdateing"),type:"load",time:1}),uiPost.CloudSrvVersionCheck(s,function(){var e=setInterval(function(){if(30<=n)return i.statusCheck(a,e,"2"),!1;uiPost.getCloudSrvCheckStatus(s,function(t){i.statusCheck(a,e,t.cloudFwStatus,t)}),n++},1e3)})},statusCheck:function(e,t,a,i){var n=this;if(null!=a&&"3"!=a&&"0"!=a){var s="",o=this.lang_t("common.back");"4"==a&&(s=i.newVersion,o=this.lang_t("config.update")),_tempStopLoad_=!1,Cstool.Flag({title:this.lang_t("firmware.cloud_upgrade"),content:this.statusMsg(a,s),btnText:o,ok:function(){if("4"==a){var t={cloudUpdate:"1"};t.ip=e,uiPost.informSlaveUpdate(t,function(t){n.loadResult.splice(n.idx,1,!0)})}}}),clearInterval(t)}},statusMsg:function(t,e){var a="";switch(String(t)){case"4":a=this.lang_t("firmware.check_msg",[e]);break;case"1":a=this.lang_t("firmware.check_internet_result");break;case"3":a=this.lang_t("firmware.newcloudUpdateing");break;case"5":a=this.lang_t("firmware.cloudUpdateing");break;case"2":a=this.lang_t("firmware.check_if_newver")}return a}}}</script><script src="/static/js/main.js"></script></body></html>