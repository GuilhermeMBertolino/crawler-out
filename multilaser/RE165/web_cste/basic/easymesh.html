<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="proma" content="no-cache"><meta http-equiv="cache-control" content="no cache"><meta http-equiv="expires" content="0"><title></title><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><link rel="stylesheet" href="/static/css/main.css"><link rel="stylesheet" href="/static/css/common.css"><link rel="stylesheet" href="/static/css/basic_menu.css"><link rel="stylesheet" href="/static/css/loading.css"></head><body><div id="app"></div><script type="text/x-template" id="main"><div class="basic-box">
  <x-help :text="lang_t('mesh.help')"></x-help>
  <br>
  <div class="fun-box">
	<span class="basic-title">{{ lang_t('mesh.mesh_set') }}</span>
  </div>
  <div class="fun-box">
    <table class="table">
      <tbody>
	    <tr>
		  <td class="fun-left">{{ lang_t('mesh.mesh_set') }}</td>
		  <td>
		   <x-switch v-model="enabled" @change="stateChange"></x-switch>
		  </td>
	    </tr>
		<tr v-show="enabled">
		  <td class="fun-left">{{ lang_t('mesh.mode') }}</td>
		  <td>
			<select v-model="mode" @change="modeChange">
			  <option value="controller">{{ lang_t('mesh.main_device') }}</option>
			  <option value="agent">{{ lang_t('mesh.slave_device') }}</option>
			</select>
		  </td>
		</tr>	
		<!--
		<tr v-show="enabled">
		  <td class="fun-left">{{ lang_t('mesh.back_haul_pre') }}</td>
		  <td>
		    <select v-model="ifname">
		  	  <option value="0">5G</option>
			  <option value="1">2.4G</option>
			</select>
		  </td>
	    </tr>
		-->	
		<tr v-show="enabled">
		  <td class="fun-left">{{ lang_t('mesh.device_name') }}</td>
		  <td>
		    <input type="text" v-model="deviceName" maxlength="32" v-verify="formRule" data-name="deviceName">
		  </td>
		</tr>
	  </tbody>
	  <tbody v-show="enabled">
		<tr v-show="mode=='agent'">
		  <td class="fun-left">{{ lang_t('mesh.link_status') }}</td>
		  <td>
			<span v-html="linkStatusHtml"></span>
		  </td>
		</tr>	
		<tr><td colspan="2"></td></tr>
	    <tr>
		  <td class="fun-left"></td>
		  <td>
			<button type="button" class="btn" @click="handleSubmit">{{ lang_t('common.apply') }}</button>
			<button type="button" class="btn" @click="startFun" :disabled="!isConfig">{{ lang_t('common.start') }} Mesh</button>
		  </td>
		</tr>
	  </tbody>
    </table>
	<br><br>
	<div v-show="enabled && mode!='agent' && origMode=='controller'">
	  <span class="basic-title">{{lang_t('mesh.crrent_device')}}</span>
	  <table class="t_table3 table-bordered table-striped">
		<thead>
		  <tr>
			<th>ID</th>
			<th>{{ lang_t('mesh.device_name') }}</th>
			<th>{{lang_t('rule.ip')}}</th>
			<th>{{lang_t('rule.mac')}}</th>
			<th>{{lang_t('mesh.rssi')}}</th>
		  </tr>
		</thead>
		<tr>
		  <td>-</td>
		  <td>{{device.device_name}}</td>
		  <td>{{device.ip_addr}}</td>
		  <td>{{stringConver(device.mac_address)}}</td>
		  <td>-</td>
		</tr>
		<tr v-for="(list,index) in this.neighbor_devices">
		  <td>{{index+1}}</td>
		  <td>{{list.neighbor_name}}</td>
		  <td>{{list.ip_addr}}</td>
		  <td>{{stringConver(list.neighbor_mac)}}</td>
		  <td>{{list.neighbor_rssi}}%</td>
		</tr>
	  </table>
	</div>
  </div>
</div></script><script src="/plugin/vue.js"></script><script src="/plugin/jquery-3.2.1.min.js"></script><script src="/static/js/config.js"></script><script src="/static/js/layout.js"></script><script src="/static/js/common.js"></script><script src="/static/js/topicurl.js"></script><script>var cs_main={template:"#main",data:function(){return{globalConfig:globalConfig,lang:$.lang,lang_t:lang_t,device:{},neighbor_devices:{},isConfig:!1,enabled:!1,origMode:"controller",mode:"controller",deviceName:"",ifname:"0",linkStatus:""}},computed:{linkStatusHtml:function(){var t=this.lang_t("index.disconnected"),e="#db3b21";return"connected"==this.linkStatus&&(t=this.lang_t("index.connected"),e="#28a745"),'<span style="color:'+e+';">'+t+"</span>"},formRule:function(){var i=this;return{deviceName:function(t,e){var n=cs.commentstr(t);0==n?e(i.lang_t("mesh.msg10")):1==n?e(i.lang_t("mesh.msg11")):e()}}}},created:function(){var i=this;uiPost.getEasyMeshCfg(function(t){i._rawData=t,i.enabled="1"==t.enabled,i.isConfig="1"==t.enabled,i.linkStatus=t.status,i.mode=t.mode,i.origMode=t.mode,i.deviceName=t.deviceName,i.ifname=t.ifname}),uiPost.getEasyMeshList(function(t){if(t&&t.ip_addr){var e=(i.device=t).neighbor_devices;if(e){for(var n=0;n<e.length;n++)e.neighbor_mac==t.child_devices.mac_address&&(e[n].ip_addr=t.child_devices[n].ip_addr);i.neighbor_devices=e}}})},methods:{stringConver:function(t){if(null!=t){for(var e="",n=0;n<t.length;n++)e+=t[n],n%2==1&&11!=n&&(e+=":");return e.toUpperCase()}},modeChange:function(){this.isConfig=this.mode==this.origMode&&"1"==this._rawData.enabled},stateChange:function(t){if(t!=this.isConfig&&!t){var e={enabled:"0"};uiPost.setEasyMeshCfg(e,function(t){var e=15;null!=t.wtime&&0!=t.wtime&&(e=t.wtime),Cstool.Count(e,"js",function(){location.href=location.href})})}},getEasyMeshStatus:function(){var e=this;uiPost.getEasyMeshStatus({},function(t){"connected"==t.status?Cstool.Msg({content:e.lang_t("mesh.success"),type:"alert",ok:function(){self.location.href="/basic/index.html?time="+(new Date).getTime()}}):Cstool.Msg({content:e.lang_t("mesh.fail"),type:"alert",ok:function(){location.href=location.href}})})},startFun:function(){uiPost.setEasyMeshStart({},function(t){var e=10;t.wtime&&"0"!=t.wtime?(e=t.wtime,Cstool.Count(e,"js",function(){location.href=location.href})):location.href=location.href})},clearFun:function(){Cstool.Msg({content:this.lang_t("mesh.msg9"),type:"confirm",ok:function(){uiPost.clearEasyMeshCfg(postVar,function(t){var e=60;t.wtime&&"0"!=t.wtime?(e=t.wtime,Cstool.Count(e,"js",function(){location.href=location.href})):location.href=location.href})}})},handleSubmit:function(){var e=this,n={};Cstool.Verify(this.formRule,function(t){t&&(n.enabled="1",n.mode=e.mode,n.deviceName=e.deviceName,n.ifname=e.ifname,uiPost.setEasyMeshCfg(n,function(t){var e=15;null!=t.wtime&&0!=t.wtime&&(e=t.wtime),Cstool.Count(e,"js",function(){location.href=location.href})}))})}}}</script><script src="/static/js/main.js"></script></body></html>