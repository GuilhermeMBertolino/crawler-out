<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="proma" content="no-cache"><meta http-equiv="cache-control" content="no cache"><meta http-equiv="expires" content="0"><title></title><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><link rel="stylesheet" href="/static/css/main.css"><link rel="stylesheet" href="/static/css/common.css"><link rel="stylesheet" href="/static/css/basic_menu.css"></head><body><div id="app"></div><script type="text/x-template" id="main"><div>
  <!--子菜单-->
  <adv-child-menu ></adv-child-menu>  
  <div class="advance-box">
	<br>
  <br>
	<div class="fun-box">
      <table class="table">  
        <tbody>
        <tr>
          <td>
            <span class="basic-title">{{ lang_t('firmware.msg9') }}</span>
          </td>
        </tr>
	    <tr>
		  <td class="fun-left2">{{ lang_t('firmware.firmware_ver') }}</td>
		  <td>{{ version }}</td>
		</tr>
		<tr>
		  <td class="fun-left2">{{ lang_t('firmware.build_time') }}</td>
		  <td>{{ buildTime }}</td>
		</tr>
  	  	</tbody>
	   </table>
      <br>
      <table class="table">  
        <tbody>
        <tr><td><b>{{ lang_t('firmware.local_upgrade') }}</b></td></tr>  
        <tr><td>{{ lang_t('firmware.local_upgrade_msg') }}</td></tr>
        
		<tr>
          <td>
            <x-checkbox v-model="loaddef">{{ lang_t('firmware.upgrade_with_reset') }}</x-checkbox>
           <br>
           <br>
            <input type="file" id="f_upload" @change="filechange">
          </td>
        </tr>
        <tr>
          <td v-show="showUpdateBtn">
            <button type="button" class="btn"  @click="submit_upgrade" >{{ lang_t('firmware.upgrade') }}</button>
          </td>
        </tr>
        <br>
        <tr><td><b>{{ lang_t('firmware.cloud_upgrade') }}</b></td></tr>
        <tr><td>{{ lang_t('firmware.cloud_upgrade_msg') }}</td></tr>
        <tr>
          <td>
			<button type="button" class="btn" @click="cloudCheck" :disabled="cloudCheck_en">{{ lang_t('firmware.check') }}</button>
          </td>
        </tr>
       <tr v-if="result != 0">
          <td v-if="result == 4 && cloudStatus != 1">{{ lang_t('firmware.found_newfw')}}:&nbsp;&nbsp;&nbsp;<span style="font-weight:bold;color:#EA7105;">{{newVersion}}</span> {{lang_t('firmware.manual_upgrade') }} 
            &nbsp;&nbsp;
			<button type="button" class="btn btn-primary all-but" id="cloud_upload" @click.prevent="cloudUpgrade" >{{ lang_t('firmware.upgrade') }}</button>
          </td>
          <td v-else-if="result == 1">{{ lang_t('firmware.check_internet_result') }}</td>
          <td v-else-if="result == 3">{{ lang_t('firmware.newcloudUpdateing') }}</td>
		  <td v-else-if="result == 5">{{ lang_t('firmware.cloudUpdateing') }}</td>
          <td v-else-if="result == 2">{{ lang_t('firmware.check_if_newver') }}</td>
          <td v-else-if="cloudStatus == 1" style="color:blue"><b>{{ lang_t('firmware.upload') }}</b></td>
        </tr>
        </tbody> 
      </table>
      <br><br>
      <div v-if="showMesh">
        <table class="table">
          <tbody>
          <tr>
            <td>
              <span class="basic-title">{{ lang_t('firmware.msg5') }}</span>
            </td>
          </tr>
          </tbody>
        </table>
        <table class="table">
          <tbody>
          <tr><td>{{ lang_t('firmware.msg6') }}</td></tr>
          <tr>
            <td colspan="12">
                <table class="t_table3 table-bordered table-striped">
                  <thead>
                    <th>{{ lang_t('rule.device_name') }}</th>
                    <th>IP</th>
                    <th>MAC</th>
                    <th>{{ lang_t('common.select') }}<x-checkbox v-model="selectAll" @change="selectFun"></x-checkbox></th>
                  </thead>
                  <tbody>
                    <tr v-for="(d,i) in meshGroup" :key="d.idx">
                      <td>{{ d.device_name }}</td>
                      <td>{{ d.ip }}</td>
                      <td>{{ d.mac }}</td>
                      <td><x-checkbox v-model="selectIdx[i]"></x-checkbox></td>
                    </tr>
                  </tbody>
                </table>
            </td>
          </tr>
          <tr>
            <td>
              <x-checkbox v-model="loaddef_salv">{{ lang_t('firmware.upgrade_with_reset') }}</x-checkbox>
             <br>
             <br>
              <input type="file" id="salv_file" @change="salvFileFun">
              <button type="button" class="btn btn-primary all-but" @click="salv_Upgrade" v-show="salvBtn">{{ lang_t("firmware.upgrade") }}</button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
      <br>
    </div>
  </div>
</div></script><script src="/plugin/vue.js"></script><script src="/plugin/jquery-3.2.1.min.js"></script><script src="/static/js/config.js"></script><script src="/static/js/layout.js"></script><script src="/static/js/common.js"></script><script src="/static/js/topicurl.js"></script><script>var cs_main={template:"#main",data:function(){return{globalConfig:globalConfig,lang:$.lang,lang_t:lang_t,result:"",buildTime:"",newVersion:"",loaddef:!1,version:"",platform:"",contentLength:"",fileName:"",customUpgrade:"",upgradeAction:"/cgi-bin/cstecgi.cgi?action=upload",setUpgradeFW:"0",maxSize:0,filename:"",selectbox:!1,showUpdateBtn:!1,cloudCheck_en:!1,cloudStatus:"",meshGroup:[],selectIdx:[],selectAll:!1,loaddef_salv:!1,showMesh:!1,salvBtn:!1}},watch:{selectIdx:function(t){t.length==this.meshGroup.length&&t.indexOf(!1)<0?this.selectAll=!0:this.selectAll=!1}},created:function(){var i=this;uiPost.FirmwareUpgrade(function(t){if(i.hardModel=t.hardModel,i.flashSize=t.flashSize,i.version=t.fmVersion,i.platform=t.platform,i.contentLength=t.ContentLength,i.fileName=t.FileName,i.customUpgrade=t.customUpgrade,-1!=t.buildTime.indexOf("-"))i.buildTime=t.buildTime;else{for(var e=t.buildTime.replace(/\s+/g," "),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=0;o<12;o++)if(e.split(" ")[0]==n[o])var l=o+1;i.buildTime=e.split(" ")[2]+"-"+l+"-"+e.split(" ")[1]+" "+e.split(" ")[3]}i.cloudFw=t.cloudFw,i.maxSize=parseInt(t.maxSize),i.lanip=t.lanIp,""!=t.upgradeAction&&(i.upgradeAction=t.upgradeAction),""!=t.setUpgradeFW&&(i.setUpgradeFW=t.setUpgradeFW)}),uiPost.getWiFiMeshConfig(function(t){i.meshGroup=t.meshInfo,"0"!=t.wifiOff&&"0"!=t.wifiOff5g||"1"==t.meshEnabled&&"1"==globalConfig.masterMode&&(i.showMesh=!0)})},methods:{selectFun:function(t){for(var e in this.selectIdx=[],this.meshGroup)this.selectIdx[e]=t},filechange:function(){var t=document.getElementById("f_upload"),e=t.files[0].name,n=t.files[0];if(e.indexOf(".web")<0&&e.indexOf(".bin")<0)return Cstool.Msg({content:this.lang_t("firmware.msg2")}),t.value="",!1;this.upload(n,"")},salvFileFun:function(t){var e=t.target.files[0];return e.name.indexOf(".web")<0&&e.name.indexOf(".bin")<0?(Cstool.Msg({content:this.lang_t("firmware.msg2",["web、bin"])}),!1):1<=e.size/(1024*this.flashSize*1024)?(Cstool.Msg({content:this.lang_t("config.msg3")}),!1):void this.upload(e,"salv")},salv_Upgrade:function(){var t={},e=[];for(var n in this.meshGroup)!0===this.selectIdx[n]&&e.push(this.meshGroup[n].ip);if(0==e.length)return Cstool.Msg({content:this.lang_t("firmware.msg7")}),!1;var o=document.getElementById("salv_file").files[0];t.ip=e.join(";"),t.resetFlags=this.loaddef_salv?"1":"0",t.FileName=o.name,t.ContentLength=o.size,uiPost.informSlaveUpdate(t,function(t){var e=100;t.wtime&&(e=t.wtime),Cstool.Count(e,"up",function(){location.href="http://"+location.host+"/login.html"})})},cloudUpgrade:function(){var n=this,t={},o=0;n.cloudCheck_en=!0,n.loaddef?t.resetFlags="1":t.resetFlags="0","1"==this.setUpgradeFW?uiPost.setUpgradeFW(t,function(t){o=null!=t.wtime&&""!=t.wtime&&0!=t.wtime?Number(t.wtime):120;var e=setInterval(function(){uiPost.getCloudDownloadStatus(function(t){n.cloudStatus=t.cloudupg_download,"2"==t.cloudupg_download?(clearInterval(e),Cstool.Count(o,"up",function(){parent.location.href="http://"+location.host+"/login.html"})):"3"==t.cloudupg_download&&(n.cloudCheck_en=!1)})},1e3)}):uiPost.CloudACMunualUpdate(t,function(t){o=null!=t.wtime&&""!=t.wtime&&0!=t.wtime?Number(t.wtime):240;var e=location.host;Cstool.Count(o,"up",function(){parent.location.href="http://"+e+"/login.html"})})},cloudCheck:function(){this.newCloudCheck()},newCloudCheck:function(){var n=this,t=0;uiPost.CloudSrvVersionCheck(function(){var e=setInterval(function(){if(30<=t)return t=0,n.result=2,clearInterval(e),!1;uiPost.getCloudSrvCheckStatus(function(t){"1"==t.cloudFwStatus?(n.result=1,clearInterval(e)):"2"==t.cloudFwStatus?(n.result=2,clearInterval(e)):"4"==t.cloudFwStatus?(n.newVersion=t.newVersion,n.result=4,clearInterval(e)):"5"==t.cloudFwStatus?n.result=5:n.result=3}),t++},1e3)})},submit_upgrade:function(){var t={};if(""==$("#f_upload").val())return Cstool.Msg({content:this.lang_t("firmware.msg1")}),!1;var e=document.getElementById("f_upload").files[0],n=e.size;if(1<=n/(1024*this.flashSize*1024))return Cstool.Msg({content:this.lang_t("firmware.msg3")}),!1;this.loaddef?t.resetFlags="1":t.resetFlags="0",t.FileName=e.name,t.ContentLength=n,uiPost.setUpgradeFW(t,function(t){var e=240;null!=t.wtime&&""!=t.wtime&&(e=t.wtime),Cstool.Count(e,"up",function(){parent.location.href=location.origin+"/login.html"})})},upload:function(t,e){var n=this;Cstool.Msg({type:"no",content:this.lang_t("firmware.uploading")}),upload.fileUpload({data:t,url:this.upgradeAction,success:function(t){"1"==t.upgradeStatus?(Cstool.Msg({content:n.lang_t("firmware.upload_success"),type:"no",time:2}),"salv"==e?n.salvBtn=!0:n.showUpdateBtn=!0):("salv"==e?n.salvBtn=!1:n.showUpdateBtn=!1,Cstool.Msg({content:n.lang_t('firmware["'+t.upgradeERR+'"]')}))},error:function(t){"salv"==e?n.salvBtn=!1:n.showUpdateBtn=!1,Cstool.Msg({content:n.lang_t("firmware.MM_fwupload_error")})}})}}}</script><script src="/static/js/main.js"></script></body></html>