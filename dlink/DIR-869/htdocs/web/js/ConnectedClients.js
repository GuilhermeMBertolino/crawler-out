var HNAP=new HNAP_XML();var xml_GetNetworkSettings=HNAP.GetXML("GetNetworkSettings");var xml_GetGuestZoneRouterSettings=HNAP.GetXML("GetGuestZoneRouterSettings");var lanip=xml_GetNetworkSettings.Get("GetNetworkSettingsResponse/IPAddress");var guestzone_ip=xml_GetGuestZoneRouterSettings.Get("GetGuestZoneRouterSettingsResponse/IPAddress");var guestzone_submask=xml_GetGuestZoneRouterSettings.Get("GetGuestZoneRouterSettingsResponse/SubnetMask");var submask=xml_GetNetworkSettings.Get("GetNetworkSettingsResponse/SubnetMask");var mask=COMM_IPv4MASK2INT(submask);var guestzone_mask=COMM_IPv4MASK2INT(guestzone_submask);var xml_GetWanSettings=HNAP.GetXML("GetWanSettings");var wan_type_init=xml_GetWanSettings.Get("GetWanSettingsResponse/Type");var xml_GetClientSettings=HNAP.GetXML("GetClientInfo");var Reserved_cnt=xml_GetClientSettings.Get("GetClientInfoResponse/Reserved_cnt");var xml_GetMacFilterSettings=HNAP.GetXML("GetMACFilters2");var MACFilter_cnt=xml_GetMacFilterSettings.Get("GetMACFilters2Response/MACFilter_cnt");function Datalist(){this.list=new Array();this.maxrowid=0}Datalist.prototype={get length(){return this.list.length},set length(a){if(parseInt(a,10)>=0){this.list.length=parseInt(a,10)}}};Datalist.prototype.prepareUpdate=function(){for(var a in this.list){this.list[a].Live=false}};Datalist.prototype.getData=function(b){var a;var c;for(a=0;a<this.list.length;a++){c=this.list[a];if(c.rowid==b){break}}return c};Datalist.prototype.getDataRowNumByMac=function(e){var b;var c=null;var d=null;var a=e.toLowerCase();for(b=0;b<this.list.length;b++){c=this.list[b];if(c.MacAddress.toLowerCase()==a){d=b;break}}return d};Datalist.prototype.getRowNum=function(a){var b=0;for(b=0;b<this.list.length;b++){if(a==this.list[b].rowid){break}}return b};Datalist.prototype.editData=function(c,b){var a=this.list[this.getRowNum(c)];a.IPv4Address=b.IPv4Address;a.IPv6Address=b.IPv6Address;a.Type=b.Type;a.DeviceName=b.DeviceName;a.NickName=b.NickName;a.ReserveIP=b.ReserveIP;a.Band=b.Band;a.SignalLevel=b.SignalLevel;a.DeviceFamilyID=b.DeviceFamilyID;a.Vendor=b.Vendor;a.ScheduleName=b.ScheduleName;a.MacfilterEnabled=b.MacfilterEnabled;a.Status=b.Status;a.DevDownByte=b.DevDownByte;a.DevUpByte=b.DevUpByte;a.Live=true;return true};Datalist.prototype.deleteData=function(b){var a=this.getRowNum(b);this.list.splice(a,1)};Datalist.prototype.push=function(a){a.setRowid(this.maxrowid);this.list.push(a);this.maxrowid++;this.list.sort(function(d,c){function e(b){if(b=="LAN"){return 0}else{if(b.toUpperCase().indexOf("WIFI_")>=0){return 1}else{return 2}}}return e(d.Type)-e(c.Type)});return true};Datalist.prototype.clean=function(){for(var a in this.list){obj=this.list[a];if(obj.Live==false){this.list.splice(a,1)}}};Datalist.prototype.reset=function(){this.list.splice(0,this.list.length);this.maxrowid=0;return true};function AppDatalist(){this.list=new Array();this.maxrowid=0}AppDatalist.prototype={get length(){return this.list.length},set length(a){if(parseInt(a,10)>=0){this.list.length=parseInt(a,10)}}};AppDatalist.prototype.getData=function(b){var a;var c;for(a=0;a<this.list.length;a++){c=this.list[a];if(c.rowid==b){break}}return c};AppDatalist.prototype.getRowNumByApp=function(a,e){var b;var c=null;var d=null;for(b=0;b<this.list.length;b++){c=this.list[b];if(c.AppName==a&&c.MacAddress==e){d=b;break}}return d};AppDatalist.prototype.getDataRowNumByMac=function(e){var b;var c=null;var d=null;var a=e.toLowerCase();for(b=0;b<this.list.length;b++){c=this.list[b];if(c.MacAddress.toLowerCase()==a){d=b;break}}return d};AppDatalist.prototype.getRowNum=function(a){var b=0;for(b=0;b<this.list.length;b++){if(a==this.list[b].rowid){break}}return b};AppDatalist.prototype.editData=function(c,a){var b=this.getRowNum(c);this.list[b].MacAddress=a.MacAddress;this.list[b].CatName=a.CatName;this.list[b].AppName=a.AppName;this.list[b].DownByte=a.DownByte;this.list[b].UpByte=a.UpByte;return true};AppDatalist.prototype.deleteData=function(b){var a=this.getRowNum(b);this.list.splice(a,1)};AppDatalist.prototype.push=function(a){a.setRowid(this.maxrowid);this.list.push(a);this.maxrowid++;return true};AppDatalist.prototype.reset=function(){this.list.splice(0,this.list.length);this.maxrowid=0;return true};function Data(e,k,d,i,g,l,m,c,f,b,a,h,j){this.MacAddress=e;this.IPv4Address=k;this.IPv6Address=d;this.Type=i;this.DeviceName=g;this.NickName=l;this.ReserveIP=m;this.Band=c;this.SignalLevel=f;this.DeviceFamilyID=b;this.Vendor=getVendor(e);this.AppCount=a;this.DevDownByte=h;this.DevUpByte=j;this.ScheduleName="Always";this.MacfilterEnabled=false;this.Status=false;this.Live=true}Data.prototype={get NickName(){if(this._NickName==""){return this.DeviceName}return this._NickName},set NickName(a){this._NickName=a;if(a==this.DeviceName){this._NickName=""}},get ScheduleName(){return this._ScheduleName},set ScheduleName(a){if((a=="")||(a.toLowerCase()=="always")){this._ScheduleName="Always"}else{this._ScheduleName=a}},setRowid:function(a){this.rowid=a},showClientInfo:function(){var i=this;var r=i.NickName;var q="";var b;var o="link_IconE_";var c="client_Name";var h=i.IPv4Address;var m=i.Band;var g=i.DeviceFamilyID;var n=i.Vendor;var l="";var f="";var a="false";var p="false";if(Reserved_cnt>=24){a="true"}if(MACFilter_cnt>=24){p="true"}if(wan_type_init.indexOf("Bridged")<0&&wan_type_init.indexOf("Ap")<0&&wan_type_init.indexOf("Extender")<0&&wan_type_init.indexOf("Repeater")<0){if(i.Type=="New"){if(a=="false"||p=="false"){var e='<td><div class ="client_add_Tag" onclick ="addData()" style ="cursor:pointer"></div></td>';return e}}}if(typeof(i.MacAddress)=="undefined"||i.MacAddress.length==0){return""}if(r==""||escape(r).indexOf("%u")>=0){r="Unknown"}else{r=decode_char_text(r)}if(g==""){g="0"}if(g=="0"&&m==""){var o="link_IconE_"}else{if(g=="0"&&m!=""){var o="link_IconW"}else{if(g=="1"){var o="link_IconTV"}else{if(g=="2"){var o="link_IconGame"}else{if(g=="3"){var o="link_IconHand"}else{if(g=="4"&&m==""){var o="link_IconE"}else{if(g=="4"&&m!=""){var o="link_IconW"}else{if(g=="5"){var o="link_IconIPCam"}else{if(g=="6"){var o="link_IconW"}else{if(g=="7"){var o="link_IconNet"}else{if(m==""){var o="link_IconE_"}else{if(m!=""){var o="link_IconW"}}}}}}}}}}}}if(m=="2.4GHz"){o+="_"}else{if(g!="0"&&m==""){o+="_"}else{if(m=="Pri.5GHz"||m=="5GHz"){o+="5g_"}else{if(m=="Sec.5GHz"){o+="5g2_"}}}}var j=i.Type.toUpperCase();if(j=="OFFLINE"){o="link_Offline_";c+=" client_Name_Offline";h=i.ReserveIP}if(i.MacfilterEnabled){l="client_Access_enable";q=I18N("j","Enabled");b="#FF0000";if((i.Type=="Blocked")||(i.Status)){if(m=="2.4GHz"||m=="5GHz"||m=="Pri.5GHz"||m=="Sec.5GHz"){o="link_IconW_Block"}else{o+="Block"}}else{o+="Allow"}}else{l="client_Access";q=I18N("j","Disabled");b="#000000";o+="Allow"}if(n.length>22){n=n.substr(0,19)+"..."}if(i.SignalLevel=="low"){f="client_Signal_Lv1"}else{if(i.SignalLevel=="mid"){f="client_Signal_Lv2"}else{if(i.SignalLevel=="high"){f="client_Signal_Lv3"}else{if(i.SignalLevel=="high+"){f="client_Signal_Lv4"}}}}if(IQoSEnable==true){if(IQoSClientMAC!=""&&IQoSClientMAC==i.MacAddress){var d="IQoSClientMAC='';showClientLists('Host');"}else{var d="IQoSClientMAC='"+i.MacAddress+"';category_list_upload_diff=[0,0,0,0,0,0];category_list_download_diff=[0,0,0,0,0,0];showClientLists('Host');"}var k="cursor:pointer"}else{var d="";var k="cursor:default"}var e='<td><div class ="client_Tag" onclick ="'+d+'" style ="'+k+'"><div class ="'+o+'"></div><div class ="client_Info"><div class ="'+c+'">'+HTMLEncode(r)+'</div><div class ="client_EditImage" onclick ="editData('+i.rowid+')" style ="cursor:pointer"></div><div class ="client_Vender">'+n+'</div><div class ="client_IPv4Address">'+h+'</div><div class ="client_IPv6Address" id="IPv6Address_Client_'+i.rowid+'" title="'+i.IPv6Address+'">'+i.IPv6Address+'</div><div class ="'+l+'"></div><div class ="'+f+'"></div></div></div></td>';return e}};function appData(e,b,a,c,d){this.MacAddress=e;this.CatName=b;this.AppName=a;this.DownByte=c;this.UpByte=d}appData.prototype={setRowid:function(a){this.rowid=a}};function Copy_applist_datalist(){applist_last.reset();for(var b in applist.list){var c=new appData(applist.list[b].MacAddress,applist.list[b].CatName,applist.list[b].AppName,applist.list[b].DownByte,applist.list[b].UpByte);applist_last.push(c)}datalist_last.reset();for(var b in datalist.list){var a=new Data(datalist.list[b].MacAddress,datalist.list[b].IPv4Address,datalist.list[b].IPv6Address,datalist.list[b].Type,datalist.list[b].DeviceName,decode_char_text(datalist.list[b].NickName),datalist.list[b].ReserveIP,datalist.list[b].Band,datalist.list[b].SignalLevel,datalist.list[b].DeviceFamilyID,datalist.list[b].AppCount,datalist.list[b].DevDownByte,datalist.list[b].DevUpByte);datalist_last.push(a)}}IQoSView_updateDetail=function(g){if(g==null){return}var b=$("#iqosPop_table_body");b.empty();applist_sort.reset();for(var c in applist.list){var f=applist.list[c].CatName;if(f=="Streaming Media"){f="Streaming Media"}else{if(f=="Voice over IP"){f="Online Chat & Mail"}else{if(f=="Games"){f="Games"}else{if(f=="Web"){f="Web & Social Network"}else{if(f=="File Transfer"){f="File Transfer & P2P"}else{if(f=="P2P"){f="File Transfer & P2P"}else{f="Others"}}}}}}var d=new appData(applist.list[c].MacAddress,f,applist.list[c].AppName,applist.list[c].DownByte,applist.list[c].UpByte);applist_sort.push(d)}if(IQoSSortTarget=="cate"&&IQoSSortDirect=="descending"){applist_sort.list.sort(function(i,h){return h.CatName>i.CatName?1:-1})}else{if(IQoSSortTarget=="cate"&&IQoSSortDirect=="ascending"){applist_sort.list.sort(function(i,h){return i.CatName>h.CatName?1:-1})}else{if(IQoSSortTarget=="app"&&IQoSSortDirect=="descending"){applist_sort.list.sort(function(i,h){return h.AppName>i.AppName?1:-1})}else{if(IQoSSortTarget=="app"&&IQoSSortDirect=="ascending"){applist_sort.list.sort(function(i,h){return i.AppName>h.AppName?1:-1})}else{if(IQoSSortTarget=="upload"&&IQoSSortDirect=="descending"){applist_sort.list.sort(function(i,h){return h.UpByte-i.UpByte})}else{if(IQoSSortTarget=="upload"&&IQoSSortDirect=="ascending"){applist_sort.list.sort(function(i,h){return i.UpByte-h.UpByte})}else{if(IQoSSortTarget=="download"&&IQoSSortDirect=="descending"){applist_sort.list.sort(function(i,h){return h.DownByte-i.DownByte})}else{if(IQoSSortTarget=="download"&&IQoSSortDirect=="ascending"){applist_sort.list.sort(function(i,h){return i.DownByte-h.DownByte})}}}}}}}}for(var c in applist_sort.list){var e=applist_sort.list[c];if(e.MacAddress!=g){continue}var a='<tr><td style="width:30%">'+e.CatName+'</td><td style="width:40%">'+e.AppName+'</td><td style="width:15%;text-align:right;padding-right:10px">'+IQoSView_data_unit(e.UpByte,"data")+" "+IQoSView_data_unit(e.UpByte,"unit")+'B</td><td style="width:15%;text-align:right;padding-right:10px">'+IQoSView_data_unit(e.DownByte,"data")+" "+IQoSView_data_unit(e.DownByte,"unit")+"B</td></tr>";b.append(a)}};IQoSView_data_unit=function(c,d){var b,a;if(c<1024){b=(c/1024).toFixed(1);a="K"}else{if(c<(1024*1024)){b=(c/1024).toFixed(0);a="K"}else{if(c<(1024*1024*1024)){b=(c/(1024*1024)).toFixed(1);a="M"}else{if(c<(1024*1024*1024*1024)){b=(c/(1024*1024*1024)).toFixed(1);a="G"}else{b=(c/(1024*1024*1024*1024)).toFixed(1);a="T"}}}}if(d=="data"){return b}else{return a}};IQoSView_sort_detail=function(a){if(a=="cate"){IQoSSortTarget="cate"}else{if(a=="app"){IQoSSortTarget="app"}else{if(a=="upload"){IQoSSortTarget="upload"}else{if(a=="download"){IQoSSortTarget="download"}}}}document.getElementById("iqos_detail_cate").style.backgroundImage="none";document.getElementById("iqos_detail_cate").style.backgroundColor="#4598aa";document.getElementById("iqos_detail_app").style.backgroundImage="none";document.getElementById("iqos_detail_app").style.backgroundColor="#4598aa";document.getElementById("iqos_detail_upload").style.backgroundImage="none";document.getElementById("iqos_detail_upload").style.backgroundColor="#4598aa";document.getElementById("iqos_detail_download").style.backgroundImage="none";document.getElementById("iqos_detail_download").style.backgroundColor="#4598aa";if(IQoSSortDirect=="descending"){document.getElementById("iqos_detail_"+IQoSSortTarget).style.backgroundImage='url("image/sort_ascending.png")';document.getElementById("iqos_detail_"+IQoSSortTarget).style.backgroundPosition="right";document.getElementById("iqos_detail_"+IQoSSortTarget).style.backgroundRepeat="no-repeat";document.getElementById("iqos_detail_"+IQoSSortTarget).style.backgroundColor="#73b9c7";IQoSSortDirect="ascending"}else{document.getElementById("iqos_detail_"+IQoSSortTarget).style.backgroundImage='url("image/sort_descending.png")';document.getElementById("iqos_detail_"+IQoSSortTarget).style.backgroundPosition="right";document.getElementById("iqos_detail_"+IQoSSortTarget).style.backgroundRepeat="no-repeat";document.getElementById("iqos_detail_"+IQoSSortTarget).style.backgroundColor="#73b9c7";IQoSSortDirect="descending"}IQoSView_updateDetail(IQoSClientMAC)};IQoSClientHTML=function(){if(IQoSClientColumn%3==0){var n="640px"}else{if(IQoSClientColumn%3==1){var n="80px"}else{var n="360px"}}var s=new Array("Streaming Media","Voice over IP","Games","Web","File Transfer","Others");var v=new Array("Streaming Media","Online Chat & Mail","Games","Web & Social Network","File Transfer & P2P","Others");var o=new Array("image/StreamingMedia.png","image/OnlineChat.png","image/Games.png","image/WebSurfing.png","image/FileTransfer.png","image/Others1.png");var l=new Array(0,0,0,0,0,0);var e=new Array(0,0,0,0,0,0);var j=new Array(0,0,0,0,0,0);var b=new Array(0,0,0,0,0,0);for(var t in applist.list){if(applist.list[t].MacAddress!=IQoSClientMAC){continue}switch(applist.list[t].CatName){case"Streaming Media":l[0]+=parseInt(applist.list[t].UpByte,10);e[0]+=parseInt(applist.list[t].DownByte,10);break;case"Voice over IP":l[1]+=parseInt(applist.list[t].UpByte,10);e[1]+=parseInt(applist.list[t].DownByte,10);break;case"Games":l[2]+=parseInt(applist.list[t].UpByte,10);e[2]+=parseInt(applist.list[t].DownByte,10);break;case"Web":l[3]+=parseInt(applist.list[t].UpByte,10);e[3]+=parseInt(applist.list[t].DownByte,10);break;case"File Transfer":case"P2P":l[4]+=parseInt(applist.list[t].UpByte,10);e[4]+=parseInt(applist.list[t].DownByte,10);break;case"Others":default:l[5]+=parseInt(applist.list[t].UpByte,10);e[5]+=parseInt(applist.list[t].DownByte,10);break}}for(var t in applist_last.list){if(applist_last.list[t].MacAddress!=IQoSClientMAC){continue}switch(applist_last.list[t].CatName){case"Streaming Media":j[0]+=parseInt(applist_last.list[t].UpByte,10);b[0]+=parseInt(applist_last.list[t].DownByte,10);break;case"Voice over IP":j[1]+=parseInt(applist_last.list[t].UpByte,10);b[1]+=parseInt(applist_last.list[t].DownByte,10);break;case"Games":j[2]+=parseInt(applist_last.list[t].UpByte,10);b[2]+=parseInt(applist_last.list[t].DownByte,10);break;case"Web":j[3]+=parseInt(applist_last.list[t].UpByte,10);b[3]+=parseInt(applist_last.list[t].DownByte,10);break;case"File Transfer":case"P2P":j[4]+=parseInt(applist_last.list[t].UpByte,10);b[4]+=parseInt(applist_last.list[t].DownByte,10);break;case"Others":default:j[5]+=parseInt(applist_last.list[t].UpByte,10);b[5]+=parseInt(applist_last.list[t].DownByte,10);break}}for(var t in l){if(l[t]-j[t]>=0){category_list_upload_diff[t]=l[t]-j[t]}if(e[t]-b[t]>=0){category_list_download_diff[t]=e[t]-b[t]}}var u=0,g,a;var w=0,m,f;for(var t in category_list_upload_diff){u+=category_list_upload_diff[t];w+=category_list_download_diff[t]}g=u/6;m=w/6;if(g<1024){g=(g/1024).toFixed(1);a="K"}else{if(g<(1024*1024)){g=(g/1024).toFixed(0);a="K"}else{if(g<(1024*1024*1024)){g=(g/(1024*1024)).toFixed(1);a="M"}else{g=(g/(1024*1024*1024)).toFixed(1);a="G"}}}if(m<1024){m=(m/1024).toFixed(1);f="K"}else{if(m<(1024*1024)){m=(m/1024).toFixed(0);f="K"}else{if(m<(1024*1024*1024)){m=(m/(1024*1024)).toFixed(1);f="M"}else{m=(m/(1024*1024*1024)).toFixed(1);f="G"}}}var r='<td colspan="3"><div id="iqos_obj" class="IQoS"><image src="image/this-iqos.png" class="iqos_pointer" style="width:90px;height:30px;left:'+n+';" /><div class="IQoS_header"><div class="IQoS_Speed"><img src="image/upload.png" style="width:20px;height:20px" /><span id="uplink">'+g+"</span> "+a+'B/s<img src="image/download.png" style="margin-left:30px;width:20px;height:20px" /><span id="downlink">'+m+"</span> "+f+'B/s</div><div class="IQoS_more_icon" onclick="IQoS_ShowMore()"><img src="image/gotosettings.png" style="width:25px;height:25px" /> More...</div></div>';var c,d,k;var q,h,p;for(var t in s){if(category_list_upload_diff[t]>0||category_list_download_diff[t]>0){c=category_list_upload_diff[t]/6;q=category_list_download_diff[t]/6;k=100*category_list_upload_diff[t]/(u+w);p=100*category_list_download_diff[t]/(u+w);if(c<1024){c=(c/1024).toFixed(1);d="K"}else{if(c<(1024*1024)){c=(c/1024).toFixed(0);d="K"}else{if(c<(1024*1024*1024)){c=(c/(1024*1024)).toFixed(1);d="M"}else{c=(c/(1024*1024*1024)).toFixed(1);d="G"}}}if(q<1024){q=(q/1024).toFixed(1);h="K"}else{if(q<(1024*1024)){q=(q/1024).toFixed(0);h="K"}else{if(q<(1024*1024*1024)){q=(q/(1024*1024)).toFixed(1);h="M"}else{q=(q/(1024*1024*1024)).toFixed(1);h="G"}}}r+='<div name="IQoS_Content" class="IQoS_Content"><img class="IQoS_Content_icon" src="'+o[t]+'"/><span class="IQoS_Content_name">'+v[t]+'</span><div class="IQoS_Content_bar"><div style="display:table-row"><div class="progress"><span name="upload_value" class="progress_value"></span><div name="upload_bar" class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="'+k+'" aria-valuemin="0" aria-valuemax="100" style="background-color:#ff9933;width:'+k+'%;min-width:0.1%;"></div></div><div style="position:relative;z-index:10;top:-30px;height:0px;text-align:center;line-height:20px;font-size:12px;">'+c+" "+d+'B/s</div></div><div style="display:table-row"><div class="progress"><span name="download_value" class="progress_value"></span><div name="download_bar" class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="'+p+'" aria-valuemin="0" aria-valuemax="100" style="background-color:#33ccff;width:'+p+'%;min-width:0.1%;"></div></div><div style="position:relative;z-index:10;top:-30px;height:0px;text-align:center;line-height:20px;font-size:12px;">'+q+" "+h+"B/s</div></div></div></div>"}}r+="</div></td>";return r};var tmpXML_ScheduleCnt;var Client_Type="Host";var datalist=new Datalist();var macList="";var datalist_last=new Datalist();var applist=new AppDatalist();var applist_last=new AppDatalist();var applist_sort=new AppDatalist();var editType=true;var editID="";var reserve_change=false;var macctrl_change=false;function LoadMACList(){$.ajax({url:"/js/MacList.json",type:"GET",dataType:"json",success:function(a){macList=a}})}function Base92(b){var a=92;function e(g){if((g+35)==92){return"!"}return String.fromCharCode(g+35)}var d=Math.floor(b/a);var c=b%a;var f="";if(d>=a){f+=Base92(d)}else{f+=e(d)}f+=e(c);return f}function getVendor(f){var d="Unknown Vendor";var e;if((typeof macList=="undefined")||(macList=="")){return d}var c=f.split(":");var b=Base92(parseInt(c[0],16));var a=Base92(parseInt(c[1]+c[2],16));if(typeof macList[b]=="undefined"||typeof macList[b][a]=="undefined"){e=d}else{e=macList[b][a]}if(typeof e=="undefined"){e=d}return decode_char_text(e)}function Get_ClientInfo(){var i=$.Deferred();var e=new SOAPGetClientInfoResponse();var g=new SOAPGetMACFilters2Response();var h=new SOAPAction();var c=new SOAPAction();var d=h.sendSOAPAction("GetClientInfo",null,e);var f=null;var b=null;var a;if(IQoSFirstRecord==0){Copy_applist_datalist();applist.reset()}if(currentState=="clientInfo"){f=c.sendSOAPAction("GetMACFilters2",null,g)}$.when(d,f).done(function(n){datalist.prepareUpdate();for(var w in datalist.list){var n=datalist.list[w];if(n.Type=="Blocked"){n.Live=true}if(n.Type=="New"){n.Live=true;datalist.deleteData(n.rowid)}}for(var j in e.ClientInfoLists.ClientInfo){b=e.ClientInfoLists.ClientInfo[j];var o=new Data(b.MacAddress,b.IPv4Address,b.IPv6Address,b.Type,b.DeviceName,b.NickName,b.ReserveIP,b.Band,b.SignalLevel,b.DeviceFamilyID,b.AppCount,b.DevDownByte,b.DevUpByte);var v=datalist.getDataRowNumByMac(b.MacAddress);if(v!=null){datalist.editData(datalist.list[v].rowid,o)}else{datalist.push(o)}}if(b){if(e.IQoSEnable=="true"){IQoSEnable=true}for(var m in e.AppInfoLists.AppInfo){var k=e.AppInfoLists.AppInfo[m];var u=new appData(k.MacAddress.toLowerCase(),k.CatName,k.AppName,k.DownByte,k.UpByte);var p=applist.getRowNumByApp(k.AppName,b.MacAddress);if(p!=null){u.DownByte+=applist.list[p].DownByte;u.UpByte+=applist.list[p].UpByte;applist.editData(applist.list[p].rowid,u)}else{applist.push(u)}}}datalist.clean();var t=new Data("","","","New","","","","","");datalist.push(t);if(currentState=="clientInfo"){var r=false;datalist.prepareUpdate();for(var w in datalist.list){var n=datalist.list[w];if(n.Type!="Blocked"){n.Live=true}}for(var l in g.MACList.MACInfo){var s=g.MACList.MACInfo[l];var v=datalist.getDataRowNumByMac(s.MacAddress);if(v!=null){datalist.list[v].MacfilterEnabled=true;datalist.list[v].ScheduleName=decode_char_text(s.ScheduleName);if(s.Status=="true"||(s.ScheduleName==""&&s.Status=="false")){datalist.list[v].Status=true;datalist.list[v].Type="Blocked";r=true}datalist.list[v].Live=true}else{var o=new Data(s.MacAddress,"","","LAN",s.DeviceName,"","","");o.MacfilterEnabled=true;o.ScheduleName=decode_char_text(s.ScheduleName);o.Type="Blocked";if(s.Status=="true"){o.Status=true}datalist.push(o);r=true}}datalist.clean();showClientTypeBtn("block",r);showClientLists(Client_Type)}IQoSFirstRecord=0;var q=0;for(var j in e.ClientInfoLists.ClientInfo){if(e.ClientInfoLists.ClientInfo[j].Type!="OFFLINE"){q++}}$("#Total_ConnectedClients").html(q);i.resolve()});return i.promise()}function showClientLists(c){$(document).tooltip("disable");$(document).tooltip("enable");var b=0;IQoSClientSelected=false;IQoSClientColumn=0;var a='<table class="block" border="0" ondragstart="return false" onselectstart="return false" width="900px"><tbody><tr style="height:120px">';for(var e in datalist.list){var d=datalist.list[e];if(c=="Guest"){if(d.Type.toLowerCase().indexOf("guest")<0){continue}}else{if(c=="Host"){if(d.Type.toLowerCase().indexOf("guest")>=0){continue}if(d.Type=="Blocked"){continue}if(e==0&&d.Type=="New"){break}}else{if(c=="Blocked"){if(d.Type!="Blocked"){continue}}}}b++;if(d.MacAddress==IQoSClientMAC&&d.MacAddress!=""){IQoSClientSelected=true;IQoSClientColumn=b}a+=d.showClientInfo();if(b%3==0){a+="</tr><tr style='height:120px'>";if(IQoSClientSelected&&b-2<=IQoSClientColumn&&IQoSClientColumn<=b){a+=IQoSClientHTML();a+="</tr><tr>"}}}if(IQoSClientSelected&&b%3==2&&b-1==IQoSClientColumn){a+="</tr><tr>";a+=IQoSClientHTML();a+="</tr><tr>"}a+="</tr></tbody>";$("#Client_Group").html(a);if(b>0){$("#Client_Info").hide()}else{if(c=="Blocked"){showClientTypeBtn("block",true);showClientLists("Host")}else{$("#Client_Info").show()}}$("#Client_Group").css("display","table-row");if(IQoSClientSelected){IQoSView_updateDetail(IQoSClientMAC)}}function addData(){changeTimeoutAction();$("#popTitle").html(I18N("j","Add Rule"));$("#check_btn").attr("class","styled_button_dis").prop("disabled",true);$("#show_Vendor").hide();$("#client_MACAddress").hide();$("#show_editMac").show();$("#show_IPAdr").hide();$("#show_IPAdrReserve").hide();$("#enableReserveIP").prop("checked",false);$("#enableAccess").prop("checked",false);$("#show_Schedule").hide();$("#editPop").show();editType=false;editID="";document.getElementById("MACAddress_Info").innerHTML="";document.getElementById("IPAdrReserve_Info").style.display="none";document.getElementById("show_IPAdrReserveAlerInfo").style.display="none"}function editData(c){changeTimeoutAction();$("#check_btn").attr("class","styled_button_dis").prop("disabled",true);$("#popTitle").html(I18N("j","Edit Rule"));$("#show_Vendor").show();$("#client_MACAddress").show();$("#show_editMac").hide();$("#show_IPAdr").show();var b=datalist.getData(c);var a=b.IPv4Address;document.getElementById("MACAddress_Info").innerHTML="";document.getElementById("IPAdrReserve_Info").style.display="none";document.getElementById("client_IPAdrReserve").value=b.ReserveIP;document.getElementById("client_MACAddress").innerHTML=b.MacAddress;if(escape(b.NickName).indexOf("%u")>=0){$("#client_Name").val("Unknown")}else{$("#client_Name").val(decode_char_text(b.NickName))}if(a==""){a=I18N("j","Not Available")}$("#client_IPAdr").html(a);if(b.ReserveIP==""){reserve_change=false;document.getElementById("show_IPAdrReserve").style.display="none";document.getElementById("show_IPAdrReserveAlerInfo").style.display="none";document.getElementById("show_IPAdr").style.display="table-row";$("#enableReserveIP").prop("checked",false)}else{reserve_change=true;document.getElementById("show_IPAdrReserve").style.display="table-row";document.getElementById("show_IPAdrReserveAlerInfo").style.display="none";document.getElementById("show_IPAdr").style.display="none";$("#enableReserveIP").prop("checked",true)}if(wan_type_init.indexOf("Bridged")>=0||wan_type_init.indexOf("Ap")>=0||wan_type_init.indexOf("Extender")>=0||wan_type_init.indexOf("Repeater")>=0){document.getElementById("show_ReserveIP").style.display="none"}else{if(!COMM_CheckNetworkAddr(b.IPv4Address,guestzone_ip,mask)){document.getElementById("show_ReserveIP").style.display="table-row"}else{document.getElementById("show_ReserveIP").style.display="none"}}if(b.Vendor!=""){document.getElementById("client_Vendor").innerHTML=b.Vendor}else{document.getElementById("client_Vendor").innerHTML="N/A"}if(b.MacfilterEnabled){macctrl_change=true;$("#schedule").selectbox("detach");$("#schedule").val(b.ScheduleName);$("#schedule").selectbox("attach");$("#enableAccess").prop("checked",true);$("#show_Schedule").show()}else{macctrl_change=false;$("#enableAccess").prop("checked",false);$("#show_Schedule").hide()}$("#editPop").show();editType=true;editID=c}function closeEditPOP(){changeTimeoutAction();var g=$("#enableReserveIP").prop("checked");var i=$("#client_IPAdrReserve").val();var a=$("#client_Name").val();var h=$("#enableAccess").prop("checked");var f=$("#schedule").val();$("#check_btn").attr("class","styled_button_dis").prop("disabled",true);var d=datalist.getData(editID);d.NickName=a;if(g&&(i!="")){d.ReserveIP=i;if(reserve_change==false){Reserved_cnt++}}else{d.ReserveIP="";if(reserve_change==true){Reserved_cnt--}}d.MacfilterEnabled=h;if(h){d.ScheduleName=f;if(macctrl_change==false){MACFilter_cnt++}}else{d.ScheduleName="";if(macctrl_change==true){MACFilter_cnt--}}datalist.editData(d.rowid,d);var j=new SOAPAction();var c=new SOAPSetClientInfo();var b=new SOAPClientInfo();b.MacAddress=d.MacAddress;b.NickName=encode_char_text(d.NickName);b.ReserveIP=d.ReserveIP;c.ClientInfoLists.push(b);var e=j.sendSOAPAction("SetClientInfo",c,null);e.done(function(p){if(p.SetClientInfoResult=="ERROR_RESERVEIP_CONFLICT"){alert(I18N("j","IP address cannot be the same."));$("#check_btn").attr("class","styled_button_dis").prop("disabled",true)}else{if(p.SetClientInfoResult=="ERROR_RESERVEIP_TOO_MANY"){alert(I18N("j","The maximum number of permitted DHCP reservations has been exceeded."));$("#check_btn").attr("class","styled_button_dis").prop("disabled",true)}else{var o=new SOAPAction();var m=new SOAPSetMACFilters2();for(var n in datalist.list){if(datalist.list[n].MacfilterEnabled){var l=new SOAPMacInfo();l.DeviceName=encode_char_text(datalist.list[n].NickName);l.MacAddress=datalist.list[n].MacAddress;l.ScheduleName=encode_char_text(datalist.list[n].ScheduleName);m.MACList.push(l)}}var k=o.sendSOAPAction("SetMACFilters2",m,null);k.done(function(q){if(q.SetMACFilters2Result=="ERROR_MACLIST_TOO_MANY"){alert(I18N("j","The rules exceed maximum."));$("#check_btn").attr("class","styled_button_dis").prop("disabled",true)}});resetRulePOP()}}})}function closeAddPOP(){changeTimeoutAction();var n=$("#enableReserveIP").prop("checked");var p=$("#client_IPAdrReserve").val();var b=$("#client_Name").val();var o=$("#enableAccess").prop("checked");var j=$("#schedule").val();var m=$("#client_editMac").val();$("#check_btn").attr("class","styled_button_dis").prop("disabled",true);if(n&&(p!="")){if(!COMM_ValidV4Format(p)||!COMM_ValidV4Addr(p)){document.getElementById("IPAdrReserve_Info").style.display="";return}for(var r in datalist.list){var h=datalist.list[r];if(h.IPv4Address==p){document.getElementById("IPAdrReserve_Info").style.display="";return}}}if(COMM_IsMAC(m)==false){document.getElementById("MACAddress_Info").innerHTML=I18N("j","err_Check_Mac");return}for(var r in datalist.list){var h=datalist.list[r];if(h.MacAddress.toLowerCase()==m.toLowerCase()){document.getElementById("MACAddress_Info").innerHTML=I18N("j","err_mac_conflict");return}}var q=new SOAPAction();var k=null;var a=null;var g=0;if(n){var d=new SOAPSetClientInfo();var c=new SOAPClientInfo();c.MacAddress=m;c.NickName=encode_char_text(b);c.ReserveIP=p;d.ClientInfoLists.push(c);k=q.sendSOAPAction("SetClientInfo",d,null);Reserved_cnt++;k.done(function(i){if(i.SetClientInfoResult=="ERROR_RESERVEIP_CONFLICT"){alert(I18N("j","IP address cannot be the same."));$("#check_btn").attr("class","styled_button_s").prop("disabled",false);g=1}else{if(i.SetClientInfoResult=="ERROR_RESERVEIP_TOO_MANY"){alert(I18N("j","The maximum number of permitted DHCP reservations has been exceeded."));$("#check_btn").attr("class","styled_button_dis").prop("disabled",true);g=1}}})}if(o){var l=new SOAPSetMACFilters2();for(var f in datalist.list){if(datalist.list[f].MacfilterEnabled){var c=new SOAPMacInfo();c.DeviceName=datalist.list[f].DeviceName;c.MacAddress=datalist.list[f].MacAddress;c.ScheduleName=encode_char_text(datalist.list[f].ScheduleName);l.MACList.push(c)}}var e=new SOAPMacInfo();e.DeviceName=encode_char_text(b);e.MacAddress=m;e.ScheduleName=encode_char_text(j);l.MACList.push(e);a=q.sendSOAPAction("SetMACFilters2",l,null);MACFilter_cnt++;a.done(function(i){if(i.SetMACFilters2Result=="ERROR_MACLIST_TOO_MANY"){alert(I18N("j","The rules exceed maximum."));$("#check_btn").attr("class","styled_button_dis").prop("disabled",true);g=1}})}$.when(k,a).done(function(i){if(g==0){resetRulePOP()}})}function clearCreateRulePOP(){changeTimeoutAction();resetRulePOP()}function resetRulePOP(){Get_ClientInfo().done(function(){$("#editPop").hide();$("input").val("");$("#editMac_Info").hide();$("select").selectbox("detach");$("#schedule").val("Always");$("select").selectbox("attach");$("#client_IPAdrReserve_warning").remove();var a=$("#client_form").validate();a.resetForm();$("#client_form input").removeClass("error")})}function getClientList(a){if(a=="Host"){$("#client_btn_Blocked").attr("class","v4v6_linkstyle_2");$("#client_btn_Guest").attr("class","v4v6_linkstyle_2");$("#client_btn_Host").attr("class","v4v6_linkstyle_1")}else{if(a=="Guest"){$("#client_btn_Blocked").attr("class","v4v6_linkstyle_2");$("#client_btn_Guest").attr("class","v4v6_linkstyle_1");$("#client_btn_Host").attr("class","v4v6_linkstyle_2")}else{$("#client_btn_Blocked").attr("class","v4v6_linkstyle_1");$("#client_btn_Guest").attr("class","v4v6_linkstyle_2");$("#client_btn_Host").attr("class","v4v6_linkstyle_2")}}Client_Type=a;showClientLists("Host")}function buttonStyleChange(){var a=true;changeTimeoutAction();if(editType==true){if(($("#enableReserveIP").prop("checked")==true)&&($("#client_IPAdrReserve").val()=="")){a=false}}else{if($("#client_editMac").val()==""){a=false}if(($("#enableReserveIP").prop("checked")==false)&&($("#enableAccess").prop("checked")==false)){a=false}if(($("#enableReserveIP").prop("checked")==true)&&($("#client_IPAdrReserve").val()=="")){a=false}}if(a){$("#check_btn").attr("class","styled_button_s").prop("disabled",false)}else{$("#check_btn").attr("class","styled_button_dis").prop("disabled",true)}}function setEvents(){$("#enableReserveIP").on("change",function(a){buttonStyleChange();if($(this).prop("checked")){$("#show_IPAdrReserve").show()}else{$("#show_IPAdrReserve").hide()}});$("#enableAccess").on("change",function(a){buttonStyleChange();if($(this).prop("checked")){$("#show_Schedule").show()}else{$("#show_Schedule").hide()}})}function closeIQoSPop(){$("#iqosPop").hide();$("body").css("overflow","auto")}function setClientValidate(){$.validator.addMethod("checkIP",function(b,a){if(b==""){return true}if(!COMM_ValidV4Format(b)||!COMM_ValidV4Addr(b)){return false}return true},jQuery.validator.messages.address_Check);$.validator.addMethod("checkMac",function(b,a){if(COMM_IsMAC(b)==false){return false}return true},jQuery.validator.messages.mac_Check);$.validator.addMethod("checkMacConflict",function(b,a){for(var d in datalist.list){var c=datalist.list[d];if(c.MacAddress.toLowerCase()==b.toLowerCase()){return false}}return true},jQuery.validator.messages.mac_Conflict);$.validator.addMethod("checkIPConflict",function(b,a){for(var d in datalist.list){var c=datalist.list[d];if((editType==true)&&(editID==c.rowid)){continue}if((b!="")&&(c.ReserveIP==b||c.IPv4Address==b)){return false}}return true},jQuery.validator.messages.ip_Conflict);$.validator.addMethod("checkNetworkAddr",function(b,a){if(b==""){return true}if(!COMM_CheckNetworkAddr(b,lanip,mask)&&!COMM_CheckNetworkAddr(b,guestzone_ip,guestzone_mask)){return false}return true},jQuery.validator.messages.check_NetworkAddr);$("#client_form").validate({rules:{client_editMac:{checkMac:true,checkMacConflict:true},client_IPAdrReserve:{checkIP:true,checkIPConflict:true,checkNetworkAddr:true}},submitHandler:function(a){if(editType==true){closeEditPOP()}else{closeAddPOP()}},unhighlight:function(c,a,b){$(c).removeClass(a).addClass(b);if((c==$("input#client_IPAdrReserve")[0])&&(editType==true)){$("#client_IPAdrReserve_warning").remove();var d=datalist.getData(editID);if((c.value)&&(c.value!=d.ReserveIP)){$(c).after("<div id='client_IPAdrReserve_warning' style='color:#00f;fone-size:12px' />");$("#client_IPAdrReserve_warning").html(I18N("j","It will take effect after reconnecting"))}}},highlight:function(c,a,b){$(c).addClass(a).removeClass(b);if(c==$("input#client_IPAdrReserve")[0]){$("#client_IPAdrReserve_warning").remove()}},errorPlacement:function(a,b){a.insertAfter(b).css("display","inline")}})};