<html><head>
<link rel=stylesheet href='stylemain.css' type='text/css'>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<script language="javascript" src="portName.js"></script>
<script language="javascript" src="util.js"></script>
<script language='JavaScript' src='menu.js'></script>
<script language='javascript'>
<!-- hide
var enblQos = '<%ejGetOther(qosMgmtDefEnbl, all)%>';
var defMark = '<%ejGetOther(qosMgmtDefMark, all)%>';

var chipId = <%ejGetOther(sysInfo, chipId)%>

var numPrioLevels = '<%ejGet(glbQosPrioLevel)%>';
var numEthPrioLevels = '<%ejGet(glbEthQosPrioLevel)%>';

function hideAllElements()
{
   showhide("precedence", 0);
   showhide("wght_val", 0);
   showhide("dsl_latency", 0);
   showhide("ptm_prio", 0);   
}

function changeSelect(OnPageLoad) 
{
   with ( document.forms[0] ) {
      var intfSelected = getSelect(queueintf);

      hideAllElements();

      /* all dsl wan interfaces are appended with layer 2 interface descriptors in (),
       * e.g., ppp0(0_0_35), ppp1(4_0_39), ppp3(0_1_0), atm0(1_0_42), ptm2(1_0_1),....
       */
      latency.length        = 1;
      latency.selectedIndex = 0;
      if (intfSelected.indexOf('(4_') != -1) {
         /* dual latency vdsl link */
         latency.length           = 2;
         latency.options[0].value = '0';
         latency.options[0].text  = 'Path0';
         latency.options[1].value = '1';
         latency.options[1].text  = 'Path1';
         showhide("dsl_latency", 1);
      }
      else if (intfSelected.indexOf('(0_') != -1) {
         latency.options[0].value = '0';
         latency.options[0].text  = 'Path0';
         showhide("dsl_latency", 1);
      }
      else if (intfSelected.indexOf('(1_') != -1) {
         latency.options[0].value = '1';
         latency.options[0].text  = 'Path1';
         showhide("dsl_latency", 1);
      }
      else {
         /* non-dsl wan interface */
         latency.options[0].value = '-1';
         latency.options[0].text  = '';
      }

      ptmpriority.length        = 1;
      ptmpriority.selectedIndex = 0;
      if (intfSelected.indexOf('_1_1)') != -1) {
         /* dual ptm priority */
         ptmpriority.length           = 2;
         ptmpriority.options[0].value = '0';
         ptmpriority.options[0].text  = 'Low';
         ptmpriority.options[1].value = '1';
         ptmpriority.options[1].text  = 'High';
         showhide("ptm_prio", 1);
      }
      else if (intfSelected.indexOf('_0_1)') != -1) {
         ptmpriority.options[0].value = '0';
         ptmpriority.options[0].text  = 'Low';
         showhide("ptm_prio", 1);
      }
      else if (intfSelected.indexOf('_1_0)') != -1) {
         ptmpriority.options[0].value = '1';
         ptmpriority.options[0].text  = 'High';
         showhide("ptm_prio", 1);
      }
      else {
         /* non-dsl wan interface */
         ptmpriority.options[0].value = '-1';
         ptmpriority.options[0].text  = '';
      }

      /* adjust the queueprecedence select list. */
      if (intfSelected.indexOf('eth') == -1)
         queueprecedence.length = numPrioLevels - 1;
      else
         queueprecedence.length = numEthPrioLevels;
      for (i = 0; i < queueprecedence.length; i++) {
         queueprecedence.options[i].value = i+1;
         queueprecedence.options[i].text  = i+1;
      }
      queueprecedence.selectedIndex = 0;

      if (intfSelected.indexOf('WFQ') != -1) {
         showhide("precedence", 0);
         showhide("wght_val", 1);
      }
      else {
         showhide("precedence", 1);
         showhide("wght_val", 0);
      }  
   }
}

function frmLoad() {
    hideAllElements();

    with (document.forms[0]) 
    {
        if (enblQos == '1')
        {
            enableQos.checked = true;
	    hideQosInfo(0);
	    for (var i=0; i< document.forms[0].dscpMark.options.length; i++) {
            	if (document.forms[0].dscpMark.options[i].value == defMark) 
		{
                	document.forms[0].dscpMark.options[i].selected = true;
                	break;
            	}
            }
        }
        else 
        {
            enableQos.checked = false;
	    hideQosInfo(1);
        }
    }
}

function btnApply() {
   var loc = 'qosqueue.cmd?action=add';

   with ( document.forms[0] ) {

      if (queuename.value == '' ) {
         msg = 'Please enter QoS queue name.';
         alert(msg);
         return;
      }

      if ( isValidName(queuename.value) == false ) {
         msg = 'Please enter valid QoS queue name: No special characters.';
         alert(msg);
         return;
      }
      if (queuename.value.length > 15) {
         msg = 'Maximum QoS queue name cannot exceed 15 characters.';
         alert(msg);
         return;
      }
      
//	  if ( queueenbl.selectedIndex == 0 ) {
//         msg = 'Please select status for this queue.'
//         alert(msg);
//         return;
//      }      

      if ( queueintf.selectedIndex == 0 ) {
         msg = 'Specify an egress interface for this queue.'
         alert(msg);
         return;
      }      

//	  if ( queueprecedence.selectedIndex == 0 ) {
//         msg = 'Please select precedence for this queue.'
//         alert(msg);
//         return;
//      }
    
      // queuename
      loc += '&queueName=' + encodeUrl(queuename.value);

      // queueenbl
      idx = queueenbl.selectedIndex;
      loc += '&enable=' + queueenbl.options[idx].value;

      // queueintf
      idx = queueintf.selectedIndex;
      val = queueintf.options[idx].value.split('(');
      loc += '&queueintf=' + val[0];
      
      if (queueintf.options[idx].value.indexOf('WFQ') != -1) {
         // scheduler algorithm and weight
         if ( isNaN(parseInt(wght.value)) == true ) {
            alert('Weight Value "' + wght.value + '" is invalid.');
            return;
         }
         wghtval = parseInt(wght.value);
         if ( wghtval < 1 || wghtval > 63 ) {
            alert('Weight Value "' + wght.value + '" is out of range [1-63].');
            return;
         }
         val = queueintf.options[idx].value.split('&');
         loc += '&alg=WFQ&wght=' + wght.value;
         loc += '&precedence=' + val[1];
      }
      else {
         // scheduler algorithm
         loc += '&alg=SP&precedence=' + queueprecedence.value;
      }

      // latency path
      idx = latency.selectedIndex;
      loc += '&latency=' + latency.options[idx].value;

      // ptm priority
      idx = ptmpriority.selectedIndex;
      loc += '&ptmpriority=' + ptmpriority.options[idx].value;
   }

   loc += '&sessionKey=<%ejGetOther(sessionKey)%>';
   var code = 'location="' + loc + '"';
   eval(code);
}

function btn1Cancel() {
   var loc = '';
   loc += 'qosclscfg.html';

   var code = 'location="' + loc + '"';
   eval(code);
}

function btn2Cancel() {
    with (document.forms[0]) 
    {
        queueInfo.style.display = 'none';
        btnadd.disabled = false;
        btnrmv.disabled = false;
        btncancel.disabled = false;
    }
}

function addClick() {
    var num = '<%ejGetOther(qosClass,qosNum)%>';
    if (parseInt(num) == 16)
    {
        alert("The maximum number of qos class item is 16.");
        return;
    }
    
    with (document.forms[0]) 
    {
        queueInfo.style.display = 'block';
        btnadd.disabled = true;
        btnrmv.disabled = true;
        btncancel.disabled = true;
    }
}

/* 20100331, Linus Shi, begin to mod for fixing bug #8395, mark:03311452 */
function enableClick(ebl)
{
   var lst = '';
   var i;

   with ( document.forms[0] ) 
   {
  /* 20100831, Tick mod for fixing  #9673, mark:87676789 */
      if (enableQos.checked != true) 
      {
        alert("Only Qos is enable can set this .");
      }
/* 20100831, Tick, end ------------------------------ mark:87676789 */

      if (ebl)
   	  {
         if (ebl.length > 0)
         {
           for (i = 0; i < ebl.length; i++) 
		   {
              if ( ebl[i].checked == true )
              {
                 lst += '1,';
              }
              else
                lst += '0,';
           }
         }
		 else
		 {
            if ( ebl.checked == true )
            {
               lst += '1';
			}
			else
               lst += '0';
		 }
   	  }
   }
   var loc = 'qosqueue.cmd?action=enable&eblLst=' + lst;
   loc += '&sessionKey=<%ejGetOther(sessionKey)%>';
   var code = 'location="' + loc + '"';
   eval(code);
}

function removeClick(rml)
{
   var lst = '';
   var i;

   with ( document.forms[0] ) 
   {
      if (rml)
      {
         if (rml.length > 0)
         {
           for (i = 0; i < rml.length; i++) 
		   {
              if ( rml[i].checked == true )
              {
                 lst += '1,';
              }
              else
                 lst += '0,';
           }
         }
		 else
		 {
		    if ( rml.checked == true )
			{
			   lst = '1';
			}
			else
			   lst = '0';
		 }
	  }
   }

    var loc = 'qosqueue.cmd?action=remove&rmLst=' + lst;
    loc += '&sessionKey=<%ejGetOther(sessionKey)%>';
    var code = 'location="' + loc + '"';
    eval(code);

}

function btnApplyQmgmt()
{
    var loc = 'qosmgmt.cmd?action=savapply';
    with (document.forms[0]) {
        if (enableQos.checked == true) 
        {
            loc += '&enblQos=1';
            //loc += '&defaultQueue=' + defaultqueue.value;
            loc += '&defaultQueue=' + '-1';
            loc += '&defaultDscpMark=' + dscpMark.value;
        } 
        else 
        {
            loc += '&enblQos=0';
            loc += '&defaultQueue=' + '-1';
            loc += '&defaultDscpMark=' + '-1';
        }
    }
    var code = 'location="' + loc + '"';
    eval(code);
}

function hideQosInfo(hide) {
   	var status = 'visible';

   	if ( hide == 1 )
      		status = 'hidden';
   	if (document.getElementById)  // DOM3 = IE5, NS6
      		document.getElementById('qosinfo').style.visibility = status;
   	else {
      		if (document.layers == false) // IE4
         		document.all.qosinfo.style.visibility = status;
	}
   	// if QoS is enabled, make sure that one drop dowm selection box for
   	// default queue and default dspc mark is selected.
}


function qosClick(cb) {
   if (cb.checked == true)
      hideQosInfo(0);
   else
      hideQosInfo(1);
}

// done hiding -->
</script>
</head>
<body onload="frmLoad()">
<blockquote>
<script language='JavaScript'>
TabHeader="Advanced";
SideItem="Network Tools";
HelpItem="";
</script> 
<script type='text/javascript'>
mainTableStart();
logo();
TopNav();
ThirdRowStart();
Write_Item_Images();
mainBodyStart();
</script>
    <form>
        <table id=box_header width="690" border=0 cellSpacing=0>
        <tr><td class=topheader>QoS</td></tr>
        <tr>
           <td class=content>
              <p>The screen allows you to configure a QoS queue entry and assign it to a specific
	        network interface. Each of the queues can be configured for a specific precedence. The
        	queue entry configured here will be used by the classifier to place ingress packets
	        appropriately.<b> Note: Lower integer values for precedence imply higher priority
	        for this queue relative to others </b>
	        Click 'Apply' to save and activate the queue.</p>
           </td>
	</tr>
        </table>

        <table id=body_header border=0 cellSpacing=0>
           <tr>
              <td class=topheader>QoS -- Queue Management Configuration</td>
           </tr>
           <tr>
              <td class=content>
		If Enable QoS&nbsp;checkbox is selected, choose a default DSCP mark
		to automatically mark incoming traffic without reference to a particular
		classifier. Click 'Apply/Save' button to save it.
        	<p> 
	        <b> Note: If Enable Qos checkbox is not selected, all QoS will be disabled for all interfaces.</b>
		<br><br>
		<b> Note: The default DSCP mark is used to mark all egress packets that
	            do not match any classification rules.</b>
		</p>
                <table border="0" cellpadding="0" cellspacing="0">
                   <tr>
                     <td valign="center" align="middle" colspan="2" width="30" height="30">
                     <input type='checkbox' name='enableQos' onclick='qosClick(this)'></td>
                     <td colspan="2">Enable QoS</td>
                   </tr>
                </table>
		
		<br>
		<div id='qosinfo'>
                <table>
                  <tr>
                     <td> Select Default DSCP Mark</td>
                     <td> <select size="1" name="dscpMark">
                              <option value="-1" selected>No Change(-1)
                              <option value="-2" >Auto Marking(-2)
                              <option value="0"> default(000000)
                              <option value="56"> AF13(001110)
                              <option value="48"> AF12(001100)
                              <option value="40"> AF11(001010)
                              <option value="32"> CS1(001000)
                              <option value="88"> AF23(010110)
                              <option value="80"> AF22(010100)
                              <option value="72"> AF21(010010)
                              <option value="64"> CS2(010000)
                              <option value="120"> AF33(011110)
                              <option value="112"> AF32(011100)
                              <option value="104"> AF31(011010)
                              <option value="96">  CS3(011000)
                              <option value="152"> AF43(100110)
                              <option value="144"> AF42(100100)
                              <option value="136"> AF41(100010)
                              <option value="128"> CS4(100000)
                              <option value="184"> EF(101110)
                              <option value="160"> CS5(101000)
                              <option value="192"> CS6(110000)
                              <option value="224"> CS7(111000)
                              </option>
                           </select>
                     </td>
                  </tr>
                </table>
                <br>
                </div>
              </td>
	   </tr>
	<br>
	<tr>
	<center>
               <input type='button' onClick='btnApplyQmgmt()' value='Apply/Save'>
        </center>
        </tr>
     <br>	   
        </table>
	   

        <table id=body_header border=0 cellSpacing=0>
        <tr>
        <td class=topheader>
        QoS Queue Setup -- A maximum 16 entries can be configured.
        </td>
        </tr>
        <tr>
        <td class=content>
        <p>
        If you disable WMM function in Wireless Page, Queues related to wireless will not take effects.<br></p>
            <table class=formlisting>
                <tr class=form_label_row>
                <td class='form_label_col'>Name</td>
                <td class='form_label_col'>Key</td>
                <td class='form_label_col'>Interface</td>
                <td class='form_label_col'>Scheduler Alg</td>          
                <td class='form_label_col'>Precedence</td>
				<script language="javascript">
				<!-- hide
				if(chipId == "6368" || chipId == "6362" || chipId == "6328")
					document.write("  <td class='form_label_col'>Weight</td>");
				document.write("  <td class='form_label_col'>DSL Latency</td>");
				if(chipId == "6368" || chipId == "6362" || chipId == "6328")
					document.write("  <td class='form_label_col'>PTM Priority</td>");
				// done hiding -->
				</script>
                <td class='form_label_col'>Enable</td>
                <td class='form_label_col'>Remove</td>
                </tr>
                <%ejGetOther(qosqueueTbl,queueView)%>
            </table>
        <br>
        </td></tr>
        </table>
        
        <p align=center>
        <input type='button' onClick='addClick()' id=btnadd value='Add'>
        <input type='button' onClick='removeClick(this.form.rml)' id=btnrmv value='Remove'>
        <input type='button' onClick='btn1Cancel()' id=btncancel value='Cancel'></p>

        <div id=queueInfo style="display:none;">            
        <table id=body_header border=0 cellSpacing=0>
        <tr>
        <td class=topheader>QoS Queue Configuration</td>
        </tr>
        <tr>
        <td class=content>
            <table class=formarea border="0" cellpadding="0" cellspacing="0">
               <tr>
                  <td class=form_label>Name:</td>
                  <td><input type='text' size="22" name="queuename"></td>
               </tr>
               <tr>
                  <td class=form_label>Enable:</td>
                  <td><select name='queueenbl' size="1">
                      <option value="0"> Disable
                      <option value="1"> Enable
                  </select></td>
               </tr>
               <tr>
                  <td class=form_label>Interface:</td>
                  <td><select name='queueintf' size="1" onChange='changeSelect(0)'>
                      <option value="0">&nbsp;
                      <script language="javascript">
<!-- hide
{
   var queueIntf = '<%ejGetOther(queueIntf, all)%>';
   var intf = queueIntf.split('|');   
   intf.sort();
 //  var itfc ;
   for ( i = 0; i < intf.length; i++ ) {
      if (intf[i] != '') {
	 if (intf[i].indexOf('eth') != -1)
	 {
	     //itfc = intf[i].replace('eth','lan');
	    continue;	   // skip eth ifc
	 }
         if (intf[i].indexOf('usb') != -1)
            continue;      // skip usb ifc
         if (intf[i].indexOf('wl0') != -1)
            continue;      // skip wl0 ifc
         if (intf[i].indexOf('ath') != -1)
         {
           
             // itfc = intf[i].replace('ath','wlan');
		
            continue; 	
         }
	  
         document.write("  <option value='" + intf[i]+ "'>" + intf[i]);
      }
   }
}
// done hiding -->
                      </script>
                  </select></td>
               </tr></table>
			    <div id='precedence'><table class=formarea border="0" cellpadding="0" cellspacing="0">
               <tr>
                  <td class=form_label>Precedence:</td>
                  <td><select name='queueprecedence' size="1">
                    <script language="javascript">
							<!-- hide
							for ( i = 1; i < numPrioLevels; i++ ) {
							    document.write("  <option value='" + i + "'>");
							    document.writeln(i);
							}
							// done hiding -->
                    </script>
                  </select></td>
               </tr>
            </table></div>
            <div id='wght_val'><table class=formarea border="0" cellpadding="0" cellspacing="0">
               <tr>
                  <td width="160">Queue Weight: [1-63]</td>
                  <td><input type='text' size='4' name='wght'></td>
               </tr>
               <tr>
                  <td colspan="2">&nbsp;</td>
               </tr>
            </table></div>
            <div id='dsl_latency'>
            <table class=formarea border="0" cellpadding="0" cellspacing="0">
               <tr>
                  <td class=form_label>DSL Latency:</td>
                  <td><select name='latency' size="1">
                      <option value='-1'>&nbsp;
                  </select></td>
               </tr>
            </table></div>
            <div id='ptm_prio'>
            <table class=formarea border="0" cellpadding="0" cellspacing="0">
               <tr>
                  <td class=form_label>PTM Priority:</td>
                  <td><select name='ptmpriority' size="1">
                      <option value='-1'>&nbsp;
                  </select></td>
               </tr>
            </table></div>
            
            </td></tr></table>
            <br>
            <center><input type='button' onClick='btnApply()' value='Apply'>
                    <input type='button' onClick='btn2Cancel()' value='Cancel'></center>
            </div>
    </form>
<script type='text/javascript'>
mainBodyEnd();
delaytimer=250;
ThirdRowEnd();
Footer();
mainTableEnd();
</script>
</blockquote>
</body>
</html>
