<html>
   <head>
      <meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
      <link rel="stylesheet" href='stylemain.css' type='text/css'>
            <script language="javascript" src="util.js"></script>
            <script language="javascript">
            
var interfaceInfo = '<%ejGetOther(wanInterfaceInfo, forDnsPlusOne)%>';

var interfaces = interfaceInfo.split('|');
var prtcl = '<%ejGetOther(memInfo, ntwkPrtcl)%>';
var dns1 = '<%ejGet(dnsPrimary)%>'; if ( dns1 == '&nbsp' || dns1 == '0.0.0.0') dns1 = '<%ejGetOther(sysInfo, dns1)%>';
var dns2 = '<%ejGet(dnsSecondary)%>'; if ( dns2 == '&nbsp' || dns2 == '0.0.0.0') dns2 = '<%ejGetOther(sysInfo, dns2)%>';
var dnsIfc = '<%ejGetOther(sysInfo, dnsIfc)%>'; if (dnsIfc == '&nbsp') dnsIfc = '';
//var auto = '<%ejGet(dnsAuto)%>';
var ethIp = '<%ejGet(ethIpAddress)%>';

var enblIP6 = '<%ejGet(enblv6)%>';
var useIPv6OnPage = '<%ejGet(useIPv6OnPage)%>';
var intfInfo6 = '<%ejGetOther(wanInterfaceInfo, forDns6PlusOne)%>';
var intf6 = intfInfo6.split('|');
var dns6type = '<%ejGetOther(sysInfo, dns6Type)%>'; if ( dns6type == '&nbsp' ) dns6type = '';
var dns6pri = '<%ejGetOther(sysInfo, dns6Pri)%>'; if ( dns6pri == '&nbsp' ) dns6pri = '';
var dns6sec = '<%ejGetOther(sysInfo, dns6Sec)%>'; if ( dns6sec == '&nbsp' ) dns6sec = '';
var dns6ifc = '<%ejGetOther(sysInfo, dns6Ifc)%>'; if ( dns6ifc == '&nbsp' ) dns6ifc = '';
var enetWan = parseInt('<%ejGet(enblEnetWan)%>');

<!-- hide
var state = '0';
if ( state == '1' ) {
   var code = 'location="dnscfg.cgi?dnsRefresh=0"';
   eval(code);
}

function hideDnsInfo(hide) {
   var status = 'visible';

   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)  // DOM3 = IE5, NS6
      document.getElementById('dnsInfo').style.visibility = status;
   else {
      if (document.layers == false) // IE4
         document.all.dnsInfo.style.visibility = status;
   }
}

/* 20101020, Linus Shi, begin mod fix bug#10140, mark: 10200921 */
function dnsClick() 
{
	with ( document.forms[0] ) 
	{
		if (dns[0].checked == true)
		{
			//changeBlockState('dnsInfo',true);
			wanIf.disabled = false;
			dnsPrimary.disabled = true;
			dnsSecondary.disabled = true;
            dnsPrimary.value = '';
            dnsSecondary.value = '';
		} 
		else 
		{
			//changeBlockState('dnsInfo',false);
			wanIf.disabled = true;
			dnsPrimary.disabled = false;
			dnsSecondary.disabled = false;
            dnsPrimary.value = dns1;
            dnsSecondary.value = dns2;
		}
	}      
}
/* 20101020, Linus Shi, end -------------------- mark: 10200921 */

function disableDns6IPInfo() {
   with ( document.forms[0] ) {
      dns6Primary.disabled = 1;
      dns6Primary.value = dns6pri;
      dns6Secondary.disabled = 1;
      dns6Secondary.value = dns6sec;

      wanIf6.disabled = 0;
   }
}

function enableDns6IPInfo() {
   with ( document.forms[0] ) {
      dns6Primary.disabled = 0;
      dns6Primary.value = dns6pri;
      dns6Secondary.disabled = 0;
      dns6Secondary.value = dns6sec;

      wanIf6.disabled = 1;
   }
}

function dns6Click() {
   with ( document.forms[0] ) {
      if (dns6[0].checked == true )
         disableDns6IPInfo();
      else
         enableDns6IPInfo();
   }
}

function hideDns6Info(hide) {
   var status = 'visible';

   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)  // DOM3 = IE5, NS6
      document.getElementById('dns6Info').style.visibility = status;
   else {
      if (document.layers == false) // IE4
         document.all.dns6Info.style.visibility = status;
   }

   if (hide == 0) {
      dns6Click();
   }
}


function frmLoad() {
   with ( document.forms[0] ) 
   {
      //var auto = '<%ejGetOther(sysInfo, dnsAuto)%>';
      if ( dns1 == '&nbsp' || dns1 == '0.0.0.0' || dns1 == ethIp) dns1 = '';
      if ( dns2 == '&nbsp' || dns2 == '0.0.0.0') dns2 = '';

	  var dnsIfc1 = '<%ejGet(dnsIfc)%>';	
      /* 20101020, Linus Shi, begin mod fix bug#10140 and #10148, mark: 10200921 */
      if ((dns1 == '') || (dnsIfc1 != ''))
	  //if ( (dns1 == '') || auto == 1)
	  {
          dns[0].checked = true;
          dns[1].checked = false;
          dnsPrimary.value = '';
          dnsSecondary.value = '';
      } 
	  else 
	  {
          dns[0].checked = false;
          dns[1].checked = true;
          dnsPrimary.value = dns1;
          dnsSecondary.value = dns2;
      }
	  dnsClick();
	  /* 20101020, Linus Shi, end ------------------------------ mark: 10200921 */
	}
   }

function btnNext() {
   var loc = 'ifcgateway.cgi?';
  	
   with ( document.forms[0] ) {
      if (dns[0].checked) {
         var idx = wanIf.selectedIndex;
         var ifc = wanIf.options[idx].value;
         loc += 'dnsIfc=' + ifc;
         loc +=  '&dnsPrimary=' + '0.0.0.0';
         loc +=  '&dnsSecondary=' + '0.0.0.0';
		 //loc += '&dnsAuto=1';
      }
      else {
         if ( isValidIpAddress(dnsPrimary.value) == false ) {
            alert('Primary DNS "' + dnsPrimary.value + '" is invalid IP address.');
            return;
         }
         loc += 'dnsPrimary=' + dnsPrimary.value;
         if (dnsSecondary.value != '') {
            if ( isValidIpAddress(dnsSecondary.value) == false ) {
               alert('Secondary DNS "' + dnsSecondary.value + '" is invalid IP address.');
               return;
            }
            loc += '&dnsSecondary=' + dnsSecondary.value;
         }
         else
            loc +=  '&dnsSecondary=' + '0.0.0.0';	  	
         loc += '&dnsIfc=' + '';
		 //loc += '&dnsAuto=0';
      }

    }

   var code = 'location="' + loc + '"';
   eval(code);
}

function btnBack() {
   var loc;

   if ( prtcl == 'PPPoE' || prtcl == 'PPPoA' )
      loc = 'pppoe.html';
   else if ( prtcl == 'IPoA' )
      loc = 'natcfg2.html';
   else if ( prtcl == 'IPoE' || prtcl == 'IPoW')
      loc = 'natcfg2.html';
   //else if ( prtcl == 'MER' )
      //loc = 'natcfg2.html';
   else
      loc = 'wancfg.cmd';
   //eric add for ethwan back issue
   if(enetWan == 1 && prtcl == 'PPPoE')
   	  loc = 'pppoeeth.html';
   if(enetWan == 1 && prtcl == 'IPoW' || enetWan == 1 && prtcl == 'IPoE')
   	  loc = 'ethcfg2.html';
   var code = 'location="' + loc + '"';
   eval(code);
}

function btnCancel(){
   var loc = 'ifcdns.html';

   var code = 'location="' + loc + '"';

   eval(code);

}

// done hiding -->
</script>
      <script language="JavaScript" src="menu.js"></script>
   </head>
<body onLoad='frmLoad()'>
<blockquote>
<script language="JavaScript">
TabHeader="Setup";
SideItem="Internet Setup";
HelpItem="dns";
</script> 
<script type='text/javascript'>
	mainTableStart();	
	logo();
	TopNav();
	ThirdRowStart();
	Write_Item_Images();
	mainBodyStart();
</script>
<form>
	<table id=box_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				WAN</td>										
		</tr>
		<tr>
			<td class=content>
				<p>				
               Click "Apply" button to save the new configuration. You must reboot the
               router to make the new configuration effective.</p>
				
			</td>
		</tr>
	</table>
	<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				DNS Server Configuration
			</td>										
		</tr>
		<tr>
			<td class=content>
            <table border="0" cellpadding="0" cellspacing="0">
               <tr>
                  <td width="30" height="19" align="middle" valign="center">                 
			     <input type='radio' name='dns' id='dns' onClick='dnsClick()'></td>
                  <td class=form_label><label for=enableAuto1><b>
                     Obtain DNS server address automatically</b></label></td>
              <tr>
                  <td width="30" height="25" align="middle" valign="center">
                  </td>
                 <td class=form_label>
            <table border="0" cellpadding="0" cellspacing="0" id="table1">
               <tr>
                  <td><span class="form_label_left">WAN Interface selected:&nbsp;</span></td>
	                  <td><select name='wanIf'>
	                      <script language="javascript">
					<!-- hide
					{
					
					   var i = 0;
					   var names = interfaces[i].split('/');
					
					   if (names == '') {
					      document.write("  <option value='&nbsp' selected>NO CONFIGURED INTERFACE");
      		                              if(dns[0].checked)
						      alert('No configured WAN interface existed for DNS server information.');
					   }
					   else {
						  for ( i = 0; i < interfaces.length; i++ ) {
						     var names = interfaces[i].split('/');
					
						     if ( names[1] == dnsIfc )
						        document.write("  <option value='" + names[1] + "' selected>");
						     else
						        document.write("  <option value='" + names[1] + "'>");
						     document.writeln(interfaces[i]);
						  }
					   }
					}
					// done hiding -->
					</script>
                    </select>
					</td>

		      </tr>
               </table>
            	</td>
              </tr>
               <tr></tr>
                  <td valign="center" align="middle" width="30">
                     <input type='radio' name='dns' id='dns' onclick='dnsClick()'></td>
                  <td class=form_label><label for=enableAuto2><b>
                     Use the following DNS server addresses</b></td>
					 <div id='dnsInfo' name='dnsInfo'>
                  <tr>
                     <td height="24" class=form_label_left>&nbsp;</td>
                     <td><span class="form_label_left">Preferred DNS server:&nbsp;&nbsp;&nbsp;&nbsp;</span>                    
					 <input type='text' name='dnsPrimary' size='15' maxlength='15'></td>
                  </tr>
				  <tr></tr>
                  <tr>
                     <td height="24" class=form_label_left>&nbsp;&nbsp;</td>
                     <td><span class="form_label_left">Alternate DNS server:&nbsp;&nbsp;&nbsp;&nbsp;</span>
                       <input type='text' name='dnsSecondary' size='15' maxlength='15'></td></tr>
		      </table>
               <br>
			</td>										
		</tr>
	</table>
	<br>

            <center>
               <input type='button' onClick='btnBack()' value='Back'><input type='button' onClick='btnNext()' value='Next'><input type='button' onClick='btnCancel()' value='Cancel'>
            </center>

     </form>
<script type='text/javascript'>
	mainBodyEnd();
	ThirdRowEnd();
	Footer()
	mainTableEnd()
</script>
</blockquote>
   </body>
</html>
