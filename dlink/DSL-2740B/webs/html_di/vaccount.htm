<html>
<head>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<link rel='STYLESHEET' type='text/css' href='stylemain.css'>
<script language='JavaScript' src='menu.js'></script> 
<script language='JavaScript' src='util.js'></script> 
<SCRIPT language="JavaScript">
<!--
var accountnum = '<%ejGetVoice(accountnum)%>';
// note: return true means input includes illegal char.
function isNNumber(input)
{ 
	var ret = false;
	var i = 0;
	for (i=0;i<input.length;i++)
	{
		if (input.charAt(i) < '0' || input.charAt(i) > '9')
		{	
			ret = true;
			break;
		}
	}
	return ret;
}

function isVNumber(input)
{ 
	var ret = false;
	var i = 0;
	for (i=0;i<input.length;i++)
	{
		if ((input.charAt(i) < '0' || input.charAt(i) > '9')&& input.charAt(0) != '+')
		{	
			ret = true;
			break;
		}
	}
	return ret;
}

function isSpecChar(input)
{ 
	var ret = false;
	var i = 0;
	for (i=0;i<input.length;i++)
	{
		if (input.charAt(i) == ' ' || input.charAt(i) == '\\' 
		|| input.charAt(i) == '\'' || input.charAt(i) == '\"')
		{	
			ret = true;
			break;
		}
	}
	return ret;
}


function stOk(){

	  if (document.forms[0].T11.value!="" || document.forms[0].T12.value!="" || document.forms[0].P11.value!="" || document.forms[0].P12.value!="" || document.forms[0].T13.value!="" || document.forms[0].T13_1.value !=""){
		if (document.forms[0].T11.value=="" || (isSpecChar(document.forms[0].T11.value))
		|| isVNumber(document.forms[0].T11.value)){
		  alert("Invalid SIP number.");
		  document.forms[0].T11.value = "";
		  document.forms[0].T11.focus();
		  return;
		}
		if ( document.forms[0].T12.value=="" || isSpecChar(document.forms[0].T12.value)
		 || isInvalidString(document.forms[0].T12.value)){
		  alert("Invalid Auth name.");
		  document.forms[0].T12.value = "";
		  document.forms[0].T12.focus();
		  return;
		}
		 
		if (document.forms[0].P11.value=="" || document.forms[0].P12.value=="" || document.forms[0].P11.value!=document.forms[0].P12.value || isSpecChar(document.forms[0].P11.value)){
		  alert("Invalid password.");
		  document.forms[0].P11.value = "";
		  document.forms[0].P12.value = "";
		  document.forms[0].P11.focus();
		  return;
		}
		if (document.forms[0].T13.value=="" || isInvalidString(document.forms[0].T13.value) ){
		  alert("Invalid Registrar.");
		  document.forms[0].T13.value = "";
		  document.forms[0].T13.focus();
		  return;
		}
		if (document.forms[0].T13_1.value=="" || isNaN(document.forms[0].T13_1.value)){
		  alert("Invalid Registrar port.");
		  document.forms[0].T13_1.value = "";
	  document.forms[0].T13_1.focus();
		  return;
		}
  }
	
  // save account config
  stSave();
}

function stSave(){
	var j=parseInt(accountnum)+1;
	var loc = 'voipcfg.cmd?action=accountadd';

       eval( "loc += \'&extension" + j + "=\' + document.forms[0].T11.value" );
       eval( "loc += \'&authName" + j + "=\' + document.forms[0].T12.value" );
       eval( "loc += \'&password" + j + "=\' + document.forms[0].P11.value" );
       eval( "loc += \'&regAddr" + j + "=\' + encodeUrl(document.forms[0].T13.value)" );
       eval( "loc += \'&regPort" + j + "=\' + document.forms[0].T13_1.value" );
       eval( "loc += \'&priority" + j + "=\' + document.forms[0].accPriority[document.forms[0].accPriority.selectedIndex].value" );
//     loc += '&extension=' + document.forms[0].T11.value;
//      loc += '&authName=' + document.forms[0].T12.value;
//      loc += '&password=' + document.forms[0].P11.value;
//      loc += '&regAddr=' + encodeUrl(document.forms[0].T13.value);
//      loc += '&regPort=' + document.forms[0].T13_1.value ;
//	  loc += '&accPriority=' + document.forms[0].accPriority[document.forms[0].accPriority.selectedIndex].value ;

// map UA to all three endpoint by default when add new accounts
//   	loc += '&phonemap=111';
	
	  //loc += '&sipcallnum=' + document.forms[0].T1.value;
      var C1="0", C2="0", C3="0", C4="0", C5="0", C6="0";

      if(document.forms[0].C4.checked == true) C4="1";
      if(document.forms[0].C5.checked == true) C5="1";
      if(document.forms[0].C6.checked == true) C6="1";

//	  loc += '&dnssrv=' + C4;
//	  loc += '&srvprefix=' + C5;
//	  loc += '&usedomain=' + C6;
       eval( "loc += \'&phonemap" + j + "=111\' " );
       eval( "loc += \'&dnsSrv" + j + "=\' + C4" );
       eval( "loc += \'&srvPrefix" + j + "=\' + C5" );
       eval( "loc += \'&useDomain" + j + "=\' + C6" );
//	  if(C6 =="1")	loc += "&sipdomain=" + document.forms[0].T14.value;
        if(C6 =="1") eval( "loc += \'&domainName" + j + "=\' + document.forms[0].T14.value" );
   var code = 'this.location.assign("' + loc + '")';
   eval(code);
	
}

var recheck = false;
var check2;
var check3;
function stAkt(){

 dnssrv();
 usedomain();
}
function dnssrv(){
 if (document.forms[0].C4.checked) {
	document.forms[0].C5.disabled = true;
 	document.forms[0].C5.checked = true;
	document.getElementById('autoprefix').style.display="";
	document.getElementById('port').style.display="none";
 }
 else{
   document.getElementById('autoprefix').style.display="none";
   document.getElementById('port').style.display="";
 }
}
function usedomain(){
	if (document.forms[0].C6.checked) {
		document.getElementById('usedomain').style.display="";
	}
	else{
		document.getElementById('usedomain').style.display="none";
	}
}


//-->
</SCRIPT>



</head>

<body onload='stAkt()'><blockquote>
<script language="JavaScript">
TabHeader="Voice";
SideItem="Voip Account";
HelpItem="Account";
</script> 
<script type='text/javascript'>
	mainTableStart();	
	logo();
	TopNav();
	ThirdRowStart();
	Write_Item_Images();
	mainBodyStart();
</script>
<form>
	<table id=box_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				VOIP ACCOUNT
			</td>										
		</tr>
		<tr>
			<td class=content>
				<p>
				Use this section to configure your VOIP service provider infomation. </p>
			</td>
		</tr>
	</table>

	<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				Add New Voip Account
			</td>										
		</tr>
		<tr>
			<td class=content>
<table class=formarea border="0" cellpadding="0" cellspacing="0">
        <tr>
            <td class=form_label>SIP number:</td>
            <td><input type="text" name="T11" size="32" maxlength="63"></td>
        </tr>
        <tr>
            <td class=form_label>Auth name:</td>
            <td><input type="text" name="T12" size="32" maxlength="63"></td>
        </tr>
				        <tr>
				            <td class=form_label>Password:</td>
				            <td><input type="password" class="stylepwd" name="P11" size="24" maxlength="31"></td>
				        </tr>	
				        <tr>
				            <td class=form_label>Password confirm:</td>
				            <td><input type="password" class="stylepwd" name="P12" size="24" maxlength="31"></td>
				        </tr>
				        <tr>
				            <td class=form_label>Use DNS SRV:</td>
				            <td><input type=checkbox name="C4" onclick='dnssrv()'>
								<span id="autoprefix">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Auto Prefix:<input type='checkbox' name="C5" checked>
								</span></td>
				        </tr>
				        <tr>
				            <td class=form_label>Registrar/Proxy:</td>
				            <td><input type="text" name="T13" size="24" maxlength="31">
								<span id="port">
		&nbsp;&nbsp;Port: &nbsp;<input type="text" name="T13_1" size="5" maxlength="5" value="5060" >
								</span>
							</td>
				        </tr>

				        <tr>
				            <td class=form_label>Use Domain to Register:</td>
				            <td><input type=checkbox name="C6"  onclick='usedomain()'>
										<span id='usedomain'>
		&nbsp;&nbsp;SIP Domain:&nbsp;<input type="text" name="T14" size="24" maxlength="31">
										</span>
							</td>
				        </tr>
				        <tr>
				            <td class=form_label>Priority:</td>
				            <td><select name='accPriority' size="1">
											<option value=9>9</option>
											<option value=8>8</option>
											<option value=7>7</option>
											<option value=6>6</option>
											<option value=5>5</option>
											<option value=4>4</option>
											<option value=3>3</option>
											<option value=2>2</option>
											<option value=1>1</option>
											<option value=0 selected>0</option>
										</select>
							</td>
				        </tr>
				    </table>
      </td>										
		</tr>
	</table><!--
<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				Forward setting
			</td>										
		</tr>
		<tr>
			<td class=content>
<table class=formarea border="0" cellpadding="0" cellspacing="0">
        <tr>
            <td class=form_label>Forward number:</td>
            <td><input type="text" name="T1" size="24" maxlength='31' value=''></td>
        </tr>
				        <tr>
				            <td class=form_label0>Forward immediately</td>
				            <td><input type=checkbox name="C1" onclick=stAkt()></td>
				        </tr>	
				        <tr>
				            <td class=form_label0>Forward no answer</td>
				            <td><input type=checkbox name="C2" onclick=stAkt()></td>
				        </tr>
				        <tr>
				            <td class=form_label0>Forward occupied</td>
				            <td><input type=checkbox name="C3" onclick=stAkt()></td>
				        </tr>

				    </table>
      </td>										
		</tr>
	</table>-->
<br>


				    <center><input name='button1' class=button_submit type=button value='Apply' onClick='stOk()'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				    <input  name='button2' class=button_submit type=button value='Cancel' onClick="window.location.href='voipcfg.cmd?action=accountview'"></center>


</form>
<script type='text/javascript'>
	mainBodyEnd();
	ThirdRowEnd();
	Footer()
	mainTableEnd()
</script></blockquote>
</body>
</html>

