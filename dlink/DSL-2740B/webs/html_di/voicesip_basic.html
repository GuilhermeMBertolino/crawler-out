<!--
 Copyright (c) 2008 Broadcom Corporation

 This program is the proprietary software of Broadcom Corporation and/or
 its licensors, and may only be used, duplicated, modified or distributed
 pursuant to the terms and conditions of a separate, written license
 agreement executed between you and Broadcom (an "Authorized License").
 Except as set forth in an Authorized License, Broadcom grants no license
 (express or implied), right to use, or waiver of any kind with respect to
 the Software, and Broadcom expressly reserves all rights in and to the
 Software and all intellectual property rights therein.  IF YOU HAVE NO
 AUTHORIZED LICENSE, THEN YOU HAVE NO RIGHT TO USE THIS SOFTWARE IN ANY WAY,
 AND SHOULD IMMEDIATELY NOTIFY BROADCOM AND DISCONTINUE ALL USE OF THE
 SOFTWARE.

 Except as expressly set forth in the Authorized License,

 1.     This program, including its structure, sequence and organization,
 constitutes the valuable trade secrets of Broadcom, and you shall use all
 reasonable efforts to protect the confidentiality thereof, and to use this
 information only in connection with your use of Broadcom integrated circuit
 products.

 2.     TO THE MAXIMUM EXTENT PERMITTED BY LAW, THE SOFTWARE IS PROVIDED
 "AS IS" AND WITH ALL FAULTS AND BROADCOM MAKES NO PROMISES, REPRESENTATIONS
 OR WARRANTIES, EITHER EXPRESS, IMPLIED, STATUTORY, OR OTHERWISE, WITH
 RESPECT TO THE SOFTWARE.  BROADCOM SPECIFICALLY DISCLAIMS ANY AND ALL
 IMPLIED WARRANTIES OF TITLE, MERCHANTABILITY, NONINFRINGEMENT, FITNESS FOR
 A PARTICULAR PURPOSE, LACK OF VIRUSES, ACCURACY OR COMPLETENESS, QUIET
 ENJOYMENT, QUIET POSSESSION OR CORRESPONDENCE TO DESCRIPTION. YOU ASSUME
 THE ENTIRE RISK ARISING OUT OF USE OR PERFORMANCE OF THE SOFTWARE.

 3.     TO THE MAXIMUM EXTENT PERMITTED BY LAW, IN NO EVENT SHALL BROADCOM
 OR ITS LICENSORS BE LIABLE FOR (i) CONSEQUENTIAL, INCIDENTAL, SPECIAL,
 INDIRECT, OR EXEMPLARY DAMAGES WHATSOEVER ARISING OUT OF OR IN ANY WAY
 RELATING TO YOUR USE OF OR INABILITY TO USE THE SOFTWARE EVEN IF BROADCOM
 HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES; OR (ii) ANY AMOUNT IN
 EXCESS OF THE AMOUNT ACTUALLY PAID FOR THE SOFTWARE ITSELF OR U.S. $1,
 WHICHEVER IS GREATER. THESE LIMITATIONS SHALL APPLY NOTWITHSTANDING ANY
 FAILURE OF ESSENTIAL PURPOSE OF ANY LIMITED REMEDY.

****************************************************************************
  $Id:

  Filename: voicesip_basic.html
  Author:
  Creation Date: 2008

****************************************************************************
end_copyright_header -->
<html>
   <head>
      <meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
      <link rel="stylesheet" href='stylemain.css' type='text/css'>
      <link rel="stylesheet" href='colors.css' type='text/css'>
      <script language="javascript" src="util.js"></script>
<script language="javascript">

var maxLines = '<%ejGetVoice(maxLines)%>';
if ( maxLines.search("ejGetVoice") >= 0 ) {
   maxLines = 2; // if not provided by provisioning, hard-code maxLines
}

var voiceRunning = '<%ejGetVoice(voiceStatus)%>';
var maxPrefCodecs = '<%ejGetVoice(maxPrefCodecs)%>';
//maxPrefCodecs = 3; // for testing
var pa = '<%ejGetVoice(proxyAddr)%>';
var pp = '<%ejGetVoice(proxyPort)%>';
var oa = '<%ejGetVoice(obProxyAddr)%>';
var op = '<%ejGetVoice(obProxyPort)%>';
var ra = '<%ejGetVoice(regAddr)%>';
var rp = '<%ejGetVoice(regPort)%>';
var la  = '<%ejGetVoice(sipLogAddr)%>';
var lp  = '<%ejGetVoice(sipLogPort)%>';
var locList = '<%ejGetVoice(localeList)%>';
var suppCodecList = '<%ejGetVoice(suppCodecList)%>';
//suppCodecList = "abc, def, ghi, jkl, mno"; // for testing
var selectedLocale = '<%ejGetVoice(localeName)%>';
var ifn  = '<%ejGetVoice(ifName)%>';
var ifList  = '<%ejGetVoice(ifList)%>';
var dn  = '<%ejGetVoice(domainName)%>';
var dm  = '<%ejGetVoice(digiMap)%>';

/* Forward declarations of variables so that no errors show up
when the Web page is opened directly with a browser */
for (var i = 0; i < maxLines; i++) {
   var j = i + 1;
   eval( "var ex" + j + " \= \"\" " );
   eval( "var dn" + j + " \= \"\" " );
   eval( "var an" + j + " \= \"\" " );
   eval( "var pw" + j + " \= \"\" " );
   eval( "var vp" + j + " \= \"\" " );
   eval( "var le" + j + " \= \"\" " );
   eval( "var cl" + j + " \= \"\" " );
   eval( "var pe" + j + " \= \"\" " );
}

/* Get all the per-line items from provisioning (through the C code).
** The provisioning will provide javascript variables
** with initialized values if the values are available. */
var tmpex = '<%ejGetVoice(extension)%>';
var tmpdn = '<%ejGetVoice(dispName)%>';
var tmpan = '<%ejGetVoice(authName)%>';
var tmppw = '<%ejGetVoice(password)%>';
var tmpvp  = '<%ejGetVoice(voicePtime)%>';
var tmple  = '<%ejGetVoice(lineEnabled)%>';
var tmpcl  = '<%ejGetVoice(codecList)%>';
var tmppe  = '<%ejGetVoice(physEndpt)%>';

// Ignore warning when page opened directly with browser
if ( tmpex.search("ejGetVoice") < 0 ) {
   eval( tmpex );
}
if ( tmpdn.search("ejGetVoice") < 0 ) {
   eval( tmpdn );
}
if ( tmpan.search("ejGetVoice") < 0 ) {
   eval( tmpan );
}
if ( tmppw.search("ejGetVoice") < 0 ) {
   eval( tmppw );
}
if ( tmppw.search("ejGetVoice") < 0 ) {
   eval( tmpvp );
}
if ( tmppw.search("ejGetVoice") < 0 ) {
   eval( tmple );
}
if ( tmppw.search("ejGetVoice") < 0 ) {
   eval( tmpcl );
}
if ( tmppe.search("ejGetVoice") < 0 ) {
   eval( tmppe );
}

function printInterfaceListBox(){
   var tokInterfaceList = ifList.split(" ");

   for(i = 0; i < tokInterfaceList.length; i++)
   {
      document.writeln("<option value=\"" + tokInterfaceList[i] + "\" selected>");  
      document.writeln(tokInterfaceList[i]);
   }
}

function printLocaleListBox(){
   var tokLocCodeList = locList.split(",");

   for(i = 0; i < tokLocCodeList.length; i++)
   {
      var tokCodeNameList = tokLocCodeList[i].split(" - ");
      document.writeln("<option value=\"" + tokCodeNameList[0] + "\" selected>");
      document.writeln(tokCodeNameList[0] + " - " + tokCodeNameList[1]);
   }
}

function btnStartSip(current_view) {
   var loc = 'voicesipstart.cmd?';
   loc += addParamsToQuery( loc, current_view );
   
   //Stripping quotes and spaces
   loc = loc.replace(/['" ]/g,'');

   var code = 'location="' + loc + '"';
   eval(code);
}


function btnStopSip(current_view) {
   var loc = 'voicesipstop.cmd?';
   loc += addParamsToQuery( loc, current_view );
   
   //Stripping quotes and spaces
   loc = loc.replace(/['" ]/g,'');

   var code = 'location="' + loc + '"';
   eval(code);
}

function btnDefaultSip(current_view) {
   var loc = 'voicesipsetdefault.cmd?';
   loc += 'currentview=' + current_view;

   //Stripping quotes and spaces
   loc = loc.replace(/['" ]/g,'');

var code = 'location="' + loc + '"';
eval(code);
}

function btnApplySip(current_view) {
   var loc = 'voicesipapply.cmd?';
   loc += addParamsToQuery( loc, current_view );
   
   //Stripping quotes and spaces
   loc = loc.replace(/['" ]/g,'');

   var code = 'location="' + loc + '"';
   eval(code);
}

// Adds parameters to the query passed to the C code
function addParamsToQuery( loc_init, current_view) {

   var loc = loc_init;
   with ( document.forms[0] ) {
      loc += 'currentview=' + current_view;
         if ( enblProxy.checked == true ) {
           if ( isValidIpAddress(proxyAddr.value) == false ) {
           }
         }
         else {
           proxyAddr.value = '0.0.0.0';
           proxyPort.value = '0';
         }

         if ( enblOutbound.checked == true ) {
           if ( isValidIpAddress(obProxyAddr.value) == false ) {
           }
         }
         else {
           obProxyAddr.value = '0.0.0.0';
           obProxyPort.value = '0';
         }

         if ( enblReg.checked == true ) {
           if ( isValidIpAddress(regAddr.value) == false ) {
           }
         }
         else {
           regAddr.value = '0.0.0.0';
           regPort.value = '0';
         }

         loc += '&proxyAddr='   + proxyAddr.value.replace(/['" ]/g,'');
         loc += '&proxyPort='   + proxyPort.value.replace(/['" ]/g,'');
         loc += '&obProxyAddr=' + obProxyAddr.value.replace(/['" ]/g,'');
         loc += '&obProxyPort=' + obProxyPort.value.replace(/['" ]/g,'');
         loc += '&regAddr='     + regAddr.value.replace(/['" ]/g,'');
         loc += '&regPort='     + regPort.value.replace(/['" ]/g,'');

         for (var i = 0; i < maxLines; i++) {
            var j = i + 1;
            eval( "loc += \'&extension" + j + "=\' + encodeUrl(extension" + j + ".value.replace(/[\'\" ]/g,\'\'))" );
            eval( "loc += \'&dispName"  + j + "=\' + encodeUrl(dispName"  + j + ".value.replace(/[\'\" ]/g,\'\'))" );
            eval( "loc += \'&authName"  + j + "=\' + encodeUrl(authName"  + j + ".value.replace(/[\'\" ]/g,\'\'))" );
            eval( "loc += \'&password"  + j + "=\' + encodeUrl(password"  + j + ".value.replace(/[\'\" ]/g,\'\'))" );
            eval( "loc += \'&voicePtime"+ j + "=\' + voicePtime"          + j + ".value.replace(/[\'\" ]/g,\'\')"  );
            eval( "loc += \'&physEndpt" + j + "=\' + physEndpt"           + j + ".value.replace(/[\'\" ]/g,\'\')"  );

            var test = eval("lineEnabled" + j + ".checked == true");
            if ( test ){
               loc+= "&lineEnabled" + j + "=on";
            } else {
               loc+= "&lineEnabled" + j + "=off";
            }

            //Handle codec list
            var codecListId = "codecList" + j;
            var prefCodecList="";
            for (var k = 0; k < maxPrefCodecs; k++) {
               l = k + 1;
               if ( l == 1 ){
                  prefCodecList += eval( codecListId + l + ".value" );
               } else {
                  prefCodecList += "," + eval( codecListId + l + ".value" );
               }
            }
            loc += "&" + codecListId + "=" + prefCodecList;
         }

         loc += '&ifName='     + ifName.value.replace(/['" ]/g,'');
         loc += '&domainName=' + domainName.value.replace(/['" ]/g,'');
         loc += '&localeName=' + localeName.value.replace(/['" ]/g,'');

      }

   return loc;
}

function frmLoad(current_view) {

   generatePerLineTable()

   with ( document.forms[0] ) {
         enableButtons();
         proxyAddr.value = pa;
         proxyPort.value = pp;
         obProxyAddr.value = oa;
         obProxyPort.value = op;
         regAddr.value = ra;
         regPort.value = rp;
         ifName.value = ifn;
         domainName.value = dn;
         localeName.value = selectedLocale;

         for (var i = 1; i <= maxLines; i++) {
            eval("extension" + i + ".value=ex"+i);
            eval("dispName" + i + ".value=dn"+i);
            eval("authName" + i + ".value=an"+i);
            eval("password" + i + ".value=pw"+i);
            eval("physEndpt" + i + ".value=pe"+i);
            eval("voicePtime" + i + ".value=vp"+i);

            //Handle line enable checkboxes
            if ( eval("le" + i + "== 1") ){
               eval("lineEnabled" + i + ".checked = true");
            } else {
               eval("lineEnabled" + i + ".checked = false");
            }

            //Handle codec list
            var codecListId = "codecList" + i;
            temp = eval( "cl" + i + ".split(',')" );
            for (var j = 0; j < maxPrefCodecs; j++)
            {
               k = j + 1;
               if ( j < temp.length )
               {
                  eval(codecListId + k + ".value = temp[" + j + "]" );
               }
               else
               {
                  eval(codecListId + k + ".value = \"\" " );
               }
            }
         }

         if ('192.168.1.10' != '0.0.0.0') {
            enblProxy.checked = true;
            hideProxyInfo(0);
         } else {
            enblProxy.checked = false;
            hideProxyInfo(1);
         }

         if ('192.168.1.10' != '0.0.0.0') {
            enblOutbound.checked = true;
            hideOutboundInfo(0);
         } else {
            enblOutbound.checked = false;
            hideOutboundInfo(1);
         }

         if ('192.168.1.10' != '0.0.0.0') {
            enblReg.checked = true;
            hideRegInfo(0);
         } else {
            enblReg.checked = false;
            hideRegInfo(1);
         }

      }
}
function hideProxyInfo(hide) {
   var status = 'visible';

   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)  // DOM3 = IE5, NS6
      document.getElementById('proxyInfo').style.visibility = status;
   else {
      if (document.layers == false) // IE4
         document.all.proxyInfo.style.visibility = status;
   }
}
function ProxyCbClick(cb) {
   if ( cb.checked == true )
      hideProxyInfo(0);
   else
      hideProxyInfo(1);
}
function hideOutboundInfo(hide) {
   var status = 'visible';

   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)  // DOM3 = IE5, NS6
      document.getElementById('outboundInfo').style.visibility = status;
   else {
      if (document.layers == false) // IE4
         document.all.outboundInfo.style.visibility = status;
   }
}
function OutboundCbClick(cb) {
   if ( cb.checked == true )
      hideOutboundInfo(0);
   else
      hideOutboundInfo(1);
}
function hideRegInfo(hide) {
   var status = 'visible';

   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)  // DOM3 = IE5, NS6
      document.getElementById('regInfo').style.visibility = status;
   else {
      if (document.layers == false) // IE4
         document.all.regInfo.style.visibility = status;
   }
}
function RegCbClick(cb) {
   if ( cb.checked == true )
      hideRegInfo(0);
   else
      hideRegInfo(1);
}

function cfCheckboxGetIdx(cb) {
  var i = parseInt( cb.id, 10 );
  return i;
}


function generatePerLineTable() {
   // Generate the table
   if (document.body.innerHTML) {
      var tableHtmlOutput = "<table id='perLineTable1' border='1'><tbody id='perLineTbody1'>";

      // Line row
      tableHtmlOutput += "<tr>";
      tableHtmlOutput += "<td class='hd'>SIP Account <\/td>"
      for (var line = 1; line <= maxLines; line++) {
         var data = line;
         tableHtmlOutput += "<td align=center>" + data + "</td>";
      }
      tableHtmlOutput += "</tr>";

      // Account line enabled row
      tableHtmlOutput += "<tr>";
      tableHtmlOutput += "<td class='hd'>Account Enabled <\/td>"
      for (var line = 1; line <= maxLines; line++) {
         var data = "<input type='checkbox' size=10 name=\'lineEnabled" + line + "\'>";
         tableHtmlOutput += "<td align=center>" + data + "</td>";
      }
      tableHtmlOutput += "</tr>";

      // Physical Endpt Id row
      tableHtmlOutput += "<tr>";
      tableHtmlOutput += "<td class='hd'>Physical Endpt Id <\/td>"
      for (var line = 1; line <= maxLines; line++) {
         var data = "<input type='text' size=20 maxlength=20 name=\'physEndpt" + line + "\'>";
         tableHtmlOutput += "<td align=center>" + data + "</td>";
      }
      tableHtmlOutput += "</tr>";

      // Extension row
      tableHtmlOutput += "<tr>";
      tableHtmlOutput += "<td class='hd'>Extension <\/td>"
      for (var line = 1; line <= maxLines; line++) {
         var data = "<input type='text' size=20 maxlength=20 name=\'extension" + line + "\'>";
         tableHtmlOutput += "<td align=center>" + data + "</td>";
      }
      tableHtmlOutput += "</tr>";

      // Display name row
      tableHtmlOutput += "<tr>";
      tableHtmlOutput += "<td class='hd'>Display name <\/td>"
      for (var line = 1; line <= maxLines; line++) {
         var data = "<input type='text' size=20 maxlength=20 name=\'dispName" + line + "\'>";
         tableHtmlOutput += "<td align=center>" + data + "</td>";
      }
      tableHtmlOutput += "</tr>";

      // Authentication name row
      tableHtmlOutput += "<tr>";
      tableHtmlOutput += "<td class='hd'>Authentication name <\/td>"
      for (var line = 1; line <= maxLines; line++) {
         var data = "<input type='text' size=20 maxlength=20 name=\'authName" + line + "\'>";
         tableHtmlOutput += "<td align=center>" + data + "</td>";
      }
      tableHtmlOutput += "</tr>";

      // Password row
      tableHtmlOutput += "<tr>";
      tableHtmlOutput += "<td class='hd'>Password <\/td>"
      for (var line = 1; line <= maxLines; line++) {
         var data = "<input type='text' size=20 maxlength=20 name=\'password" + line + "\'>";
         tableHtmlOutput += "<td align=center>" + data + "</td>";
      }
      tableHtmlOutput += "</tr>";

      // Ptime row
      tableHtmlOutput += "<tr>";
      tableHtmlOutput += "<td class='hd'>Preferred ptime <\/td>"
      var selectOptions = Array();
      for ( var i = 0; i <= 2; i++ ) {
         var ptime = (i+1)*10;
         selectOptions[i] = "<option value=" + ptime + " selected>" + ptime;
      }
      for (var line = 1; line <= maxLines; line++) {
         var data = "<select name='voicePtime" + line + "'>" + selectOptions.join("") + "<\/select>";
         tableHtmlOutput += "<td align=center>" + data + "</td>";
      }
      tableHtmlOutput += "</tr>";

      // Codec rows
      var tokenizedList = suppCodecList.split(",");
      var selectOptions = Array();
      for ( var i = 0; i < tokenizedList.length; i++ ) {
         selectOptions[i] = "<option value=" + tokenizedList[i] + " selected>" + tokenizedList[i];
      }
      for (var i = 1; i <= maxPrefCodecs; i++) {
         tableHtmlOutput += "<tr>";
         tableHtmlOutput += "<td class='hd'>Preferred codec " + i + " <\/td>"
         for (var line = 1; line <= maxLines; line++) {
            var data = "<select name='codecList" + line + i + "'>" + selectOptions.join("") + "<\/select>";
            tableHtmlOutput += "<td align=center>" + data + "</td>";
         }
         tableHtmlOutput += "</tr>";
      }

      //End of table
      tableHtmlOutput += "</tbody></table>";

      document.getElementById("perLineTablePlaceholder1").innerHTML = tableHtmlOutput;
   } else {
      alert("Cannot create per line table in this browser.");
   }

}


function enableButtons(){
   var buttonStart = document.getElementById("StartButton");
   var buttonStop = document.getElementById("StopButton");
   var buttonApply = document.getElementById("ApplyButton");
   var buttonDefault = document.getElementById("DefaultButton");

   if ( voiceRunning == 1 ) {
      buttonStart.disabled = true;
      buttonStop.disabled = false;
      buttonApply.disabled = false;
      buttonDefault.disabled = false;
   } else {
      buttonStart.disabled = false;
      buttonStop.disabled = true;
      buttonApply.disabled = true;
      buttonDefault.disabled = false;
   }
}


</script>
</head>

<body onLoad="frmLoad('basic')">
   <blockquote>
      <form>
         <b>Voice -- SIP configuration</b><br>

         <br>
                  Enter the SIP parameters and click Start/Stop to save the parameters
                  and start/stop the voice application.<br>
         <br>

         <table border="0" cellpadding="0" cellspacing="0">
            <tr>
               <td width="150">Bound Interface Name:</td>
               <td><select name="ifName" size="1">
                  <script TYPE="text/javascript">
                     printInterfaceListBox()
                  </script>
               </select></td>
               <td width="450"><b>(Note: Requires vodsl restart to take affect)</b></td>
            </tr>
         </table>
         <br>

         <table border="0" cellpadding="0" cellspacing="0">
            <tr>
               <td width="150">Locale selection:</td>
               <td><select name="localeName" size="1">
                  <script TYPE="text/javascript">
                     printLocaleListBox()
                  </script>
               </select></td>
               <td width="450"><b>(Note: Requires vodsl restart to take affect)</b></td>
            </tr>
         </table>
         <br>

         <table border="0" cellpadding="0" cellspacing="0">
            <tr>
               <td width="150">SIP domain name:</td>
               <td><input type='text' name='domainName'></td>
            </tr>
         </table>
         <br>

         <td valign="middle" align="center" colspan="2" width="30" height="30"><input type='checkbox' name='enblProxy' onClick='ProxyCbClick(this)' ID="Checkbox1"></td>
         <td colspan="2">
         Use SIP Proxy.
         <br>

         <div id='proxyInfo'>
            <table border="0" cellpadding="0" cellspacing="0" ID="Table1">
               <tr>
                  <td width="150">SIP Proxy:</td>
                  <td><input type='text' name='proxyAddr'></td>
               </tr>
               <tr>
                  <td>SIP Proxy port:</td>
                  <td><input type='text' name='proxyPort'></td>
               </tr>
            </table>
         </div>
         <br>

         <td valign="middle" align="center" colspan="2" width="30" height="30"><input type='checkbox' name='enblOutbound' onClick='OutboundCbClick(this)' ID="Checkbox2"></td>
         <td colspan="2">
         Use SIP Outbound Proxy.
         <br>

         <div id='outboundInfo'>
            <table border="0" cellpadding="0" cellspacing="0" ID="Table1">
               <tr>
                  <td width="150">SIP Outbound Proxy:</td>
                  <td><input type='text' name='obProxyAddr'></td>
               </tr>
               <tr>
                  <td>SIP Outbound Proxy port:</td>
                  <td><input type='text' name='obProxyPort'></td>
               </tr>
            </table>
         </div>
         <br>

         <td valign="middle" align="center" colspan="2" width="30" height="30"><input type='checkbox' name='enblReg' onClick='RegCbClick(this)' ID="Checkbox3"></td>
         <td colspan="2">
         Use SIP Registrar.
         <br>

         <div id='regInfo'>
            <table border="0" cellpadding="0" cellspacing="0" ID="Table1">
               <tr>
                  <td width="150">SIP Registrar:</td>
                  <td><input type='text' name='regAddr'></td>
               </tr>
               <tr>
                  <td>SIP Registrar port:</td>
                  <td><input type='text' name='regPort'></td>
               </tr>
            </table>
         </div>
         <br>

         <div class="tableWrapper" id="perLineTablePlaceholder1">
         <table></table>
         </div>
         <br>

         <center>
            <input type='button' onClick="btnStartSip('basic')" value='Start SIP client' ID="StartButton" disabled=true>
            <br>
            <br>
            <input type='button' onClick="btnStopSip('basic')" value='Stop SIP client' ID="StopButton" disabled=true>
            <br>
            <br>
            <input onclick="btnDefaultSip('basic')"  value="Restore default setting" id="DefaultButton" disabled="true"
 type="button">
            <br>
            <br>
            <input type='button' onClick="btnApplySip('basic')" value='Apply' ID="ApplyButton" disabled=true>
            <br>
         </center>
      </form>
   </blockquote>
</body>
</html>
