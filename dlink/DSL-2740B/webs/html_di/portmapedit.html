<html>
   <head>
      <meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
      <link rel="stylesheet" href='stylemain.css' type='text/css'>
            <script language="javascript" src="util.js"></script>
            <script language="javascript" src="portName.js"></script>
            <script language='JavaScript' src='menu.js'></script>
            <script language="javascript">
<!-- hide

var groupName = '<%ejGetOther(getPMapGroupName)%>';
var vid0 = '<%ejGetOther(vendorid, 0)%>';
var vid1 = '<%ejGetOther(vendorid, 1)%>';
var vid2 = '<%ejGetOther(vendorid, 2)%>';
var vid3 = '<%ejGetOther(vendorid, 3)%>';
var vid4 = '<%ejGetOther(vendorid, 4)%>';

function frmLoad() {
   with ( document.choiceForm ) {
      var gName = '<%ejGetOther(getPMapGroupName)%>';
      if ( groupName == gName )
         groupName = '';
      else
         txtGroupName.value = groupName;
      vendorid0.value = vid0;
      vendorid1.value = vid1;
      vendorid2.value = vid2;
      vendorid3.value = vid3;
      vendorid4.value = vid4;
   }
}

function btnRemove() {
   with ( document.choiceForm ) {
      var arrSelected = new Array();
      var count = 0;
      for ( i = 0; i < lstChoice.options.length; i++ ) {
         if ( lstChoice.options[i].selected == true ) {
            arrSelected[count] = lstChoice.options[i].value;
            //varOpt = new Option(lstChoice.options[i].text, lstChoice.options[i].value);
            //lstAvailable.options[lstAvailable.length] = varOpt;
            //lstChoice.options[i] = null;
         }
         count++;
      }
      var x = 0;
      for (i = 0; i < lstChoice.options.length; i++) {
         for (x = 0; x < arrSelected.length; x++) {
            if (lstChoice.options[i].value == arrSelected[x]) {
               varOpt = new Option(lstChoice.options[i].text, lstChoice.options[i].value);
               lstAvailable.options[lstAvailable.length] = varOpt;
               lstChoice.options[i] = null;
            }
         }
      }
   }
}

function btnAdd() {
   with ( document.choiceForm ) {
      var arrSelected = new Array();
      var count = 0;
      for ( i = 0; i < lstAvailable.options.length; i++ ) {
         if ( lstAvailable.options[i].selected == true ) {
            arrSelected[count] = lstAvailable.options[i].value;
         }
         count++;
      }
      var x = 0;
      for (i = 0; i < lstAvailable.options.length; i++) {
         for (x = 0; x < arrSelected.length; x++) {
            if (lstAvailable.options[i].value == arrSelected[x]) {
               varOpt = new Option(lstAvailable.options[i].text, lstAvailable.options[i].value);
               lstChoice.options[lstChoice.length] = varOpt;
               lstAvailable.options[i] = null;
            }
         }
      }
   }
}

function btnApply() {
   var loc = 'portmapcfg.cmd?action=edit';
   with ( document.forms[0] ) {
      var i = 0;
      //var unsafeString = "\"<>%\\^[]`\+\$\,='#&@.:\t";
	  var unsafeVendorID = "\"<>%\\^[]`\+\$\,='#&:\t"; /* 20111118, Linus Shi, mod for Vendor ID input check, mark: 11181109 */	

      if (vendorid0.value != '')
      {
          if (!isValidVendorID(vendorid0.value))
          {
              alert("Vendorid string can't contain " + unsafeVendorID);
              return;
          }
          loc += '&vendorid0=' + vendorid0.value;
      }
      
      if (vendorid1.value != '')
      {
          if (!isValidVendorID(vendorid1.value))
          {
              alert("Vendorid string can't contain " + unsafeVendorID);
              return;
          }
          loc += '&vendorid1=' + vendorid1.value;
      }
      
      if (vendorid2.value != '')
      {
          if (!isValidVendorID(vendorid2.value))
          {
              alert("Vendorid string can't contain " + unsafeVendorID);
              return;
          }
          loc += '&vendorid2=' + vendorid2.value;
      }
      
      if (vendorid3.value != '')
      {
          if (!isValidVendorID(vendorid3.value))
          {
              alert("Vendorid string can't contain " + unsafeVendorID);
              return;
          }
          loc += '&vendorid3=' + vendorid3.value;
      }
      
      if (vendorid4.value != '')
      {
          if (!isValidVendorID(vendorid4.value))
          {
              alert("Vendorid string can't contain " + unsafeVendorID);
              return;
          }
          loc += '&vendorid4=' + vendorid4.value;
      }

      var vendoridUsed = loc.search('&vendorid');
	  
      if (lstChoice.length == 0 && vendoridUsed == -1) {
         alert('Need to provide at least one interface from "Select one from the LAN Available list OR enter some Vendor IDs"');
         return;
      }
      //loc += '&groupName=' + groupName.value;
	  loc += '&groupName=' + '<%ejGetOther(getPMapGroupName)%>';	
      var ifc = '';
      var tempList = '';
      for (i = 0; i < lstChoice.length; i++) {
         tempList += lstChoice.options[i].value + '|';
      }
      var interfaces = tempList.split('|');
      interfaces.sort();
      for (i = 0; i < interfaces.length; i++ ) {
               // ifc += interfaces[i] + '|';
	  if (  interfaces[i] == "lan1" )
       		ifc +=  'eth0' + '|';
    	else if (  interfaces[i] == "lan2" )
       		ifc +=  'eth1' + '|';
	else if (  interfaces[i] == "lan3" )
			ifc +=  'eth2' + '|';
	else if (  interfaces[i] == "lan4" )
			ifc +=  'eth3' + '|';
	 else 
         ifc += interfaces[i] + '|';
      }
      loc += '&choiceBox=' + ifc;

      var idx = wanIf.selectedIndex;
      var wanIfc = wanIf.options[idx].value;
      loc += '&wanIfName=' + wanIfc;
	  
   }
   var code = 'location="' + loc + '"';
   eval(code);
}

// done hiding -->
      </script>
   </head>
   <body onLoad='frmLoad()'>
      <blockquote>
<form name="choiceForm">
<script language="JavaScript">
TabHeader="Advanced";
SideItem="Network Tools";
HelpItem="portmapadd";
</script> 
<script type='text/javascript'>
	mainTableStart();	
	logo();
	TopNav();
	ThirdRowStart();
	Write_Item_Images();
	mainBodyStart();
</script>

  <TABLE id=box_header cellSpacing=0 border=0>
    <TBODY>
    <TR>
      <TD colspan = 2 class=topheader>Edit Port Mapping settings </TD></TR>
    <TR>
      <TD colspan = 2 class=content>
       <p>This section is used to edit port mapping settings.</p></td></tr>
      </TBODY></TABLE>

<TABLE id=body_header cellSpacing=0 border=0>
    <TBODY>
    <TR>
      <TD class=topheader>Port Mapping Configuration</TD></TR>
      
                   <tr><td class=content>
            To edit the port mapping configuration:
            <br>
            1. To add interfaces to the grouped list, select the interfaces from
            available interface list.
            <br><br>
            2. Use the left arrow button to move the selected interfaces to the grouped
            list.
            <br><br>
            3. To remove the interfaces, select the interface from the grouped list
            and click the right arrow button.
            <br>
            <b>Note that the selected interfaces will be removed from their
            existing groups and added to the default.</b>
            <br><br>
            4. To automatically add LAN clients to the specified group PVC edit the list.
             <br><b>Note that by adding the DHCP vendor ID (OPTION 60) string. The clients will
             be automatically denied an IP address by the local DHCP server and may obtain public
             IP address.</b>
            <br><br>
            5. Click Save/Apply button to make the changes effective immediately.
            <br><br>
            <table border="1" cellpadding="3" cellspacing="0">
               <tr>
                  <td class='hd'>Group Name:</td>
                  <td><%ejGetOther(getPMapGroupName)%></td></b>
               </tr>
            </table>
            <table>
               <tr>
                     <td><b>WAN Interface used in this group: &nbsp;&nbsp;</b></td>
                     <td><select name='wanIf'>
                           <script language="javascript">
<!-- hide
{
   var i = 0;
   var interfaceInfo = '<%ejGetOther(bridgeGroupInfo, wan)%>';
   var interfaces = interfaceInfo.split('|');
   var none = 0;
   for ( i = 0; i < interfaces.length; i++ ) 
   {
      var names = interfaces[i].split('/');
 
      document.write("  <option value='" + interfaces[i] + "'>");
      document.writeln(interfaces[i]);
   }
   if (interfaceInfo == 'None') 
   {
	   none = 1;;
   }
   interfaceInfo = '<%ejGetOther(wanInterfaceInfo, allEoAPvc)%>';
   interfaces = interfaceInfo.split('|');

   for ( i = 0; i < interfaces.length - none; i++ ) 
   {
      var names = interfaces[i].split('/');
 
      document.write("  <option value='" + names[1] + "'>");
      document.writeln(names[1]);
   } 
   
               	}
// done hiding -->
</script>
                        </select></td>
                  </tr>
            </table>
            
            <br><br>
            <table border="0" cellpadding="0" cellspacing="0">
               <tr>
                  <td width="150"><b>Grouped Interfaces</b></td>
                  <td width="100"></td>
                  <td width="150"><b>Available Interfaces</b></td>
               </tr>
               <tr><td colspan="3"></td></tr>
               <tr>
                  <td>
                      <select multiple name="lstChoice" size="10" style="width: 100">
<script language="javascript">
<!-- hide
{
   if ( groupName != '' ) 
   {
      var i = 0;
      var brdId = '<%ejGet(boardID)%>';
      var dispName = '';
      var grpedIntfInfo = '<%ejGetOther(bridgeGroupInfo, group)%>';
      var grpedInterfaces = grpedIntfInfo.split('|');

      grpedInterfaces.sort();
      for ( i = 0; i < grpedInterfaces.length; i++ ) 
	  {
         if (grpedInterfaces[i] != '') 
		 {
            document.write("  <option value='" + grpedInterfaces[i] + "'>");
         }
         dispName = getUNameByLName(brdId + '|' + grpedInterfaces[i]);
         document.writeln(dispName);
      }
   }
}
// done hiding -->
</script>
                    </select>
                  </td>
                  <td>
                     <table border="0" cellpadding="0" cellspacing="5">
                        <tr><td>
                           <input type="button" value="->" onClick="btnRemove()" style="width: 30; height: 30">
                        </td></tr>
                        <tr><td>
                           <input type="button" value="<-" onClick="btnAdd()" style="width: 30; height: 30">
                        </td></tr>
                     </table>
                  </td>
                  <td>
                      <select multiple name="lstAvailable" size="10" style="width: 100">
<script language="javascript">
<!-- hide
{
   var i = 0;
   var dispName = '';
   var brdId = '<%ejGet(boardID)%>';
   var interfaceInfo = '<%ejGetOther(bridgeInterfaceInfo, all)%>';
   var interfaces = interfaceInfo.split('|');
   
   interfaces.sort();
   for ( i = 0; i < interfaces.length; i++ ) 
   {
      if (interfaces[i] != '') 
	  {
         document.write("  <option value='" + interfaces[i] + "'>");
      }
      dispName = getUNameByLName(brdId + '|' + interfaces[i]);
      document.writeln(dispName);
   }
}
// done hiding -->
                         </script>
                      </select>
                  </td>
               </table>
               <br><br>
               <table>
                  <tr>
                     <td width="150"><b>Automatically Add Clients With the following DHCP Vendor IDs</b></td>
                  </tr>
                  <tr>
                     <td><input type='text' name='vendorid0' size="32" maxlength="64"></td>
                  </tr>
                  <tr>
                     <td><input type='text' name='vendorid1' size="32" maxlength="64"></td>
                  </tr>
                  <tr>
                     <td><input type='text' name='vendorid2' size="32" maxlength="64"></td>
                  </tr>
                  <tr>
                     <td><input type='text' name='vendorid3' size="32" maxlength="64"></td>
                  </tr>
                  <tr>
                     <td><input type='text' name='vendorid4' size="32" maxlength="64"></td>
                  </tr>
               </table>
</form>
   </tr>
    </table>
            <br><br>
            <center>
               <input type='button' onClick='btnApply()' value='Apply'>
               <input name="button2" type=reset class=button_submit value="Cancel"  onClick="window.location.href='portmapcfg.cmd'">
            </center>
            <P><FONT color=red>Please take notice that you should reboot your device after you apply the port mapping
                settings. This makes sure that the port mapping works well.</FONT></P>
<script type='text/javascript'>
	mainBodyEnd();
	ThirdRowEnd();
	Footer()
	mainTableEnd()
</script>
         </form>
      </blockquote>
   </body>
</html>
