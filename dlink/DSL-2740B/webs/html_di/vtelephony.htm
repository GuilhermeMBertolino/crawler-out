<html>
<head>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<link rel='STYLESHEET' type='text/css' href='stylemain.css'>
<script language='JavaScript' src='menu.js'></script> 
<script language='JavaScript' src='util.js'></script> 
<SCRIPT language="JavaScript">
<!-- hide 
var codecsInfo = '<%ejGetCodec(codec)%>'; //codecsInfo = '1,20|2,30|4,20|3,30|0,20';
var codecs = codecsInfo.split('|');
var cdc = new Array(5);
for(i = 0; i<5; i++)
{
	cdc[i] = new rWe('','');
}
for(j = 0; j<5; j++)
{	
	var codec = codecs[j].split(',');
	cdc[j] = new rWe(codec[0],codec[1]);
}

function rWe(priority, ptime){
	this.priority = priority;	this.ptime = ptime;
}


var which = '<%ejGetTelephony(whichone)%>';
var teles = '<%ejGetTelephony(teles)%>';//teles = '1,1,1,100,4|0,0,0,120,3|';which = '1';country = 'CHN';
var entrys = teles.split('|');

var rule = new Array(2);
for (i = 0; i < 2; i++)
{
	rule[i] = new rVe('','','','','','','','');
}

for (j = 0; j < 2; j++)
{
	var entry = entrys[j].split(',');
	rule[j] = new rVe(entry[0], entry[1], entry[2], entry[3], entry[4], entry[5]);
}
	
function rVe(ec, vad, dtmf, payload, timer, t38)
{
   this.ec = ec;   this.vad = vad;   this.dtmf = dtmf;
   this.payload = payload;      this.timer = timer;
   this.t38 = t38;
}

var country = '<%ejGetVoip(country)%>'; 


function frmLoad(){
var igain = '<%ejGetVoip(ingressGain)%>';
var egain = '<%ejGetVoip(egressGain)%>';//igain = '5'; egain = '-9';
var igainFxo = '<%ejGetVoip(ingressGainFxo)%>';
var egainFxo = '<%ejGetVoip(egressGainFxo)%>';
with ( document.forms[0] ) {
	if(which == '0')
	index.selectedIndex = 0;
	else
	index.selectedIndex = 1;
	lineselect(which);
	

	C1.selectedIndex = cdc[0].priority; 
	C2.selectedIndex = cdc[1].priority; 
	C3.selectedIndex = cdc[2].priority; 
	C4.selectedIndex = cdc[3].priority; 
	C5.selectedIndex = cdc[4].priority; 
	for(i = 0; i< 5; i++){
		if(P1[i].value == cdc[0].ptime)		P1.selectedIndex = i;
		if(P2[i].value == cdc[1].ptime)		P2.selectedIndex = i;
		if(P3[i].value == cdc[2].ptime)		P3.selectedIndex = i;
		if(P4[i].value == cdc[3].ptime)		P4.selectedIndex = i;
		if(P5[i].value == cdc[4].ptime)		P5.selectedIndex = i;
	}	
	setSelect(localeName, country);
	
	if(igain == '') igain = '0';
	if(egain == '') egain = '0';
	setSelect(ingressGain, parseInt(igain)/2);
	setSelect(egressGain, parseInt(egain)/2);
	setSelect(ingressGainFxo, parseInt(igainFxo)/2);
	setSelect(egressGainFxo, parseInt(egainFxo)/2);
}
}

function oobdtmf(){
with ( document.forms[0] ) {
	if(getSelect(OOB) == 0){
		payload.disabled = true;
		payload.value = 0;
	}
	else{ 
		payload.disabled = false;
		payload.value = rule[0].payload;
	}
}
}

function lineselect(line){
with ( document.forms[0] ) {
      
	if(line == '0'){
		if(rule[0].ec == '1')	EC.selectedIndex = 1;
		else EC.selectedIndex = 0;
		if(rule[0].vad == '1')	VAD.selectedIndex = 1;
		else VAD.selectedIndex = 0;		
		if(rule[0].t38 == '1')	T38.selectedIndex = 1;
		else T38.selectedIndex = 0;	
		if(rule[0].dtmf == '1')	OOB.selectedIndex = 1;
		else if(rule[0].dtmf == '2')	OOB.selectedIndex = 2;
		else OOB.selectedIndex = 0;
		oobdtmf(); 
		payload.value = rule[0].payload;
		idt.value = rule[0].timer;
	}else if(line == '1'){
		if(rule[1].ec == '1')	EC.selectedIndex = 1;
		else EC.selectedIndex = 0;
		if(rule[1].vad == '1')	VAD.selectedIndex = 1;
		else VAD.selectedIndex = 0;		
		if(rule[1].t38 == '1')	T38.selectedIndex = 1;
		else T38.selectedIndex = 0;	
		if(rule[1].dtmf == '1')	OOB.selectedIndex = 1;
		else if(rule[1].dtmf == '2')	OOB.selectedIndex = 2;
		else OOB.selectedIndex = 0;
		oobdtmf(); 
		payload.value = rule[1].payload;
		idt.value = rule[1].timer;	
	}
}
}


   function cr(){
      with ( document.forms[0] ) {
	     var c1 = getSelect(C1),c2 = getSelect(C2);
		 var c3 = getSelect(C3),c4 = getSelect(C4),c5 = getSelect(C5);
		 if(c1 != 0){
		    if((c1 == c2)||(c1 == c3) || (c1 == c4) ||(c1 == c5)) 
			return -1;			
		 }
		 if(c2 != 0){
		    if((c2 == c3)||(c2 == c4) || (c2 == c5)) 
			return -1;	
		 }
		 if(c3 != 0){
		    if((c3 == c4)||(c3 == c5)) 
			return -1;	
		 }
	     if(c4 != 0){
		    if((c4 == c5)) 
			return -1;	
		 }
	  }
   return 0;
   } 
	
   function btnApply(){
      var loc = 'voipcfg.cmd?action=telephony';
	     
      with ( document.forms[0] ) {
	      loc += '&index=' + getSelect(index);
		  loc += '&EC=' + getSelect(EC);
		  loc += '&VAD=' + getSelect(VAD);
		  loc += '&T38=' + getSelect(T38);
	      loc += '&OOB=' + getSelect(OOB);
          loc += '&payload=' + payload.value;
		  
		  if((idt.value =='')|| isNaN(idt.value)|| parseInt(idt.value)>4 || parseInt(idt.value)<1){
		     alert("Inter-digit Timer should be a value between 1 and 4.");
			 return;
		  }			
		  loc += '&idt=' + idt.value;
		  if(cr() == -1) {
		     alert("Codec priority should not be the same if it is not \'no-use\'.");
		     return;
		  }
		  if((payload.value =='')|| isNaN(payload.value) || parseInt(payload.value)<96 || parseInt(payload.value)>127){
		    if(getSelect(OOB) == '1'){
				alert("Payload Type should be a value between 96 and 127.");
				return;
			}
		  }
		  loc += '&C1=' + getSelect(C1);
		  loc += '&P1=' + getSelect(P1);
		  loc += '&C2=' + getSelect(C2);
		  loc += '&P2=' + getSelect(P2);
		  loc += '&C3=' + getSelect(C3);
		  loc += '&P3=' + getSelect(P3);
		  loc += '&C4=' + getSelect(C4);
		  loc += '&P4=' + getSelect(P4);
		  loc += '&C5=' + getSelect(C5);
		  loc += '&P5=' + getSelect(P5);
		  loc += '&localeName=' + localeName.value;
          //if(country != localeName.value)
			//alert('Locale setting will only take effect after rebooting the router.');	
		var igain = '<%ejGetVoip(ingressGain)%>';
		var egain = '<%ejGetVoip(egressGain)%>';//igain = '5'; egain = '10';
		if((ingressGain.value != igain)||(egressGain.value != egain))
		{
		   loc += '&ingressGain=' + ingressGain.value * 2; 
		   loc += '&egressGain=' + egressGain.value * 2;
		}
		var igainFxo = '<%ejGetVoip(ingressGainFxo)%>';
		var egainFxo = '<%ejGetVoip(egressGainFxo)%>';//igain = '5'; egain = '10';
		if((ingressGainFxo.value != igainFxo)||(egressGainFxo.value != egainFxo))
		{
		   loc += '&ingressGainFxo=' + ingressGainFxo.value * 2; 
		   loc += '&egressGainFxo=' + egressGainFxo.value * 2;
		}
	  }
	  
      var code = 'location="' + loc + '"';
      eval(code);
   }
   

// done hiding -->
</script>



</head>

<body onload='frmLoad()'>
<blockquote>
<script language="JavaScript">
TabHeader="Voice";
SideItem="Telephony Setup";
HelpItem="Telephony";
</script> 
<script type='text/javascript'>
	mainTableStart();	
	logo();
	TopNav();
	ThirdRowStart();
	Write_Item_Images();
	mainBodyStart();
</script>
<form onload='frmLoad()'>
	<table id=box_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				VOIP Configuration
			</td>										
		</tr>
		<tr>
			<td class=content>
				
				The table below describes the VOIP Telephony settings.<br><br>
			</td>
		</tr>
	</table>

	<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				Telephony Configuration
			</td>										
		</tr>
		<tr>
			<td class=content> 
      </td>										
		</tr>
		<tr><td>
<table class=formarea border="0" cellpadding="0" cellspacing="0">
                           <tr>
                              <td class=form_label>Index</td>
							  <td>
							     <select name='index' size="1" onchange='lineselect(this.value)'>
								    <option value='0'>1</option>
									<option value='1'>2</option>
                                 </select>								 
							  </td>
                           </tr>
                           <tr>
                              <td class=form_label>EC</td>
							  <td>	
							     <select name='EC' size="1">
								    <option value='0'>Disabled</option>
									<option value='1'>Enabled</option>
                                 </select>	
							  </td>
                           </tr>
                           <tr>
                              <td class=form_label>VAD</td>
							   <td>							    
							     <select name='VAD' size="1">
								    <option value='0'>Disabled</option>
									<option value='1'>Enabled</option>
                                 </select>	
							   </td>
                           </tr>
						   <tr>
							  <td class=form_label>T38 support</td>
							  <td>
							     <select name='T38' size="1">
								    <option value='0'>Disabled</option>
									<option value='1'>Enabled</option>
                                 </select>								
							  </td>
						   </tr>						 
						   <tr>
                              <td class=form_label>OOB DTMF</td>
							   <td>							    
							     <select name='OOB' size="1" onchange='oobdtmf()'>
								    <option value='0'>In Band</option>
									<option value='1'>Enabled(RFC 2833)</option>
									<option value='2'>SIP Info</option>
                                 </select>	
							   </td>
                           </tr>
                           <tr>
                              <td class=form_label>Payload Type</td>
							   <td><input type="text" name="payload" size="24" maxlength="31"></td>
                           </tr>
						   <tr>
                              <td class=form_label>Inter-Digit Timer</td>
							   <td><input type="text" name="idt" size="24" maxlength="31">sec</td>
                           </tr>
						</table>
		<br>
		
		</td></tr>
	</table>
	<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				Codec Priority & Packet Interval
			</td>										
		</tr>
		<tr>
			<td class=content> 
      </td>										
		</tr>
		<tr><td>
<table class=formarea border="0" cellpadding="0" cellspacing="0">
						   <tr>
                              <td class=form_label>G.711a-law</td>
							   <td>							    
							     <select name='C1' size="1">
								    <option value='0'>no-use</option>
									<option value='1'>1st</option>
									<option value='2'>2nd</option>
									<option value='3'>3rd</option>
									<option value='4'>4th</option>
									<option value='5'>5th</option>
                                 </select>	
							   </td>
					           <td>							    
							     <select name='P1' size="1">
								    <option value='10'>10</option>
									<option value='20'>20</option>
								    <option value='30'>30</option>
									<option value='40'>40</option>								 
								    <option value='50'>50</option>
									<option value='60'>60</option>
                                 </select>ms	
							   </td>
                           </tr>
						   <tr>
                              <td class=form_label>G.711u-law</td>
							   <td>							    
							     <select name='C2' size="1">
								    <option value='0'>no-use</option>
									<option value='1'>1st</option>
									<option value='2'>2nd</option>
									<option value='3'>3rd</option>
									<option value='4'>4th</option>
									<option value='5'>5th</option>
                                 </select>	
							   </td>
					           <td>							    
							     <select name='P2' size="1">
								    <option value='10'>10</option>
									<option value='20'>20</option>
								    <option value='30'>30</option>
									<option value='40'>40</option>								 
								    <option value='50'>50</option>
									<option value='60'>60</option>
                                 </select>ms	
							   </td>
                           </tr>
						   
						   <tr>
                              <td class=form_label>G.723.1</td>
							   <td>							    
							     <select name='C3' size="1">
								    <option value='0'>no-use</option>
									<option value='1'>1st</option>
									<option value='2'>2nd</option>
									<option value='3'>3rd</option>
									<option value='4'>4th</option>
									<option value='5'>5th</option>
                                 </select>	
							   </td>
					           <td>							    
							     <select name='P3' size="1">
								    <option value='10'>10</option>
									<option value='20'>20</option>
								    <option value='30'>30</option>
									<option value='40'>40</option>								 
								    <option value='50'>50</option>
									<option value='60'>60</option>
                                 </select>ms	
							   </td>
                           </tr>
						   
						   <tr>
                              <td class=form_label>G.726</td>
							   <td>							    
							     <select name='C4' size="1">
								    <option value='0'>no-use</option>
									<option value='1'>1st</option>
									<option value='2'>2nd</option>
									<option value='3'>3rd</option>
									<option value='4'>4th</option>
									<option value='5'>5th</option>
                                 </select>	
							   </td>
					           <td>							    
							     <select name='P4' size="1">
								    <option value='10'>10</option>
									<option value='20'>20</option>
								    <option value='30'>30</option>
									<option value='40'>40</option>								 
								    <option value='50'>50</option>
									<option value='60'>60</option>
                                 </select>ms	
							   </td>
                           </tr>
						   
						   <tr>
                              <td class=form_label>G.729</td>
							   <td width=100>							    
							     <select name='C5' size="1">
								    <option value='0'>no-use</option>
									<option value='1'>1st</option>
									<option value='2'>2nd</option>
									<option value='3'>3rd</option>
									<option value='4'>4th</option>
									<option value='5'>5th</option>
                                 </select>	
							   </td>
					           <td>							    
							     <select name='P5' size="1">
								    <option value='10'>10</option>
									<option value='20'>20</option>
								    <option value='30'>30</option>
									<option value='40'>40</option>								 
								    <option value='50'>50</option>
									<option value='60'>60</option>
                                 </select>ms	
							   </td>
                           </tr>
						</table><br>
		</td></tr>
	</table>	
	<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				Locale selection
			</td>										
		</tr>
		<tr>
			<td class=content> 
      </td>										
		</tr>
		<tr><td>
<table class=formarea border="0" cellpadding="0" cellspacing="0">
	<tr>
     <td class=form_label>Locale</td>
     <td>							    
		<select name='localeName' size="1">
			<option value="AUS">AUS - Australia
            <option value="BEL">BEL - Belgium
            <option value="BRA">BRA - Brazil      
            <option value="CHL">CHL - Chile            
            <option value="CHN">CHN - China            
            <option value="DNK">DNK - Denmark      
            <option value="ETS">ETS - ETSI        
            <option value="FIN">FIN - Finland   
            <option value="FRA">FRA - France      
            <option value="DEU">DEU - Germany     
            <option value="HUN">HUN - Hungary       
            <option value="ITA">ITA - Italy       
            <option value="JPN">JPN - Japan        
            <option value="NLD">NLD - Netherlands  
            <option value="NZL">NZL - New Zealand  
            <option value="USA">USA - United States  
            <option value="ESP">ESP - Spain    
            <option value="PRT">PRT - Portugal    
            <option value="SWE">SWE - Sweden			
            <option value="NOR">NOR - Norway     
            <option value="POL">POL - Poland     
            <option value="CHE">CHE - Switzerland 
            <option value="T57">T57 - TR57
            <option value="GBR">GBR - Great Britain
        </select>	
	  </td>
    </tr>
</table><br>
		</td></tr>
	</table>	
	<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>Voice Debug 
			</td>										
		</tr>
		<tr>
			<td class=content></td>										
		</tr>
		<tr><td>
<div id='Gain'>
<table class=formarea border="0" cellpadding="0" cellspacing="0">
	<tr>
     <td class=form_label>FXS Ingress Gain</td>
	 <td><select name='ingressGain' size=1>
	 <SCRIPT language="JavaScript">
	 for(i = -20; i <=20;){
		document.writeln('<option value=\''+ i +'\'>'+ i +' dB\n');
		i += 0.5;
	 }	 
	 </SCRIPT>
	 </select>
	 </td>     
    </tr>
	<tr>
     <td class=form_label>FXS Egress Gain</td>
	 <td><select name='egressGain' size=1>
	 <SCRIPT language="JavaScript">
	 for(i = -20; i <=20;){
		document.writeln('<option value=\''+ i +'\'>'+ i +' dB\n');
		i += 0.5;
	 }	 
	 </SCRIPT>
	 </select>
	 </td>     
    </tr>
	<tr>
     <td class=form_label>FXO Ingress Gain</td>
	 <td><select name='ingressGainFxo' size=1>
	 <SCRIPT language="JavaScript">
	 for(i = -20; i <=20;){
		document.writeln('<option value=\''+ i +'\'>'+ i +' dB\n');
		i += 0.5;
	 }	 
	 </SCRIPT>
	 </select>
	 </td>     
    </tr>
	<tr>
     <td class=form_label>FXO Egress Gain</td>
	 <td><select name='egressGainFxo' size=1>
	 <SCRIPT language="JavaScript">
	 for(i = -20; i <=20;){
		document.writeln('<option value=\''+ i +'\'>'+ i +' dB\n');
		i += 0.5;
	 }	 
	 </SCRIPT>
	 </select>
	 </td>     
    </tr>
</table>
</div>
<br>
		</td></tr>
	</table>		
	

<br>
				    <center><input type='button', onClick='btnApply()', value='Apply' >
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input name="button2" type=reset class=button_submit value="Cancel"  onClick="window.location.href='vtelephony.htm'"></center>


</form>
<script type='text/javascript'>
	mainBodyEnd();
	ThirdRowEnd();
	Footer()
	mainTableEnd()
</script>
</blockquote>
</body>
</html>

