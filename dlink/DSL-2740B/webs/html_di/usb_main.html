<HTML><HEAD><TITLE>D-Link ADSL Router</TITLE>
<META http-equiv=Content-Type content="text/html">
<META http-equiv=Pragma content=no-cache><LINK 
href="stylemain.css" type=text/css rel=stylesheet>
<SCRIPT language=JavaScript src="util.js"></SCRIPT>
<SCRIPT language=JavaScript src="menu.js"></SCRIPT>
<SCRIPT language=javascript>
<!-- hide

var diskNum = '<%ejGet(disknum)%>';

var part_num = '<%ejGet(partitions)%>';
var disk_type =  '<%ejGet(disk_type)%>';
if (disk_type > '1')
	part_num -=1;
var drive_Info = '<%ejGet(vendor)%>' + '(<%ejGet(model)%>)';
var usb_ms_vendor = '<%ejGet(vendor)%>';
var usb_ms_model = '<%ejGet(model)%>';
var usb_ms_type = '<%ej_get_fs_type(type)%>';
var dev_eject = false;

var unPlugDisk = !'<%ejGet(eject)%>';
var unPlugPrinter = false;

var mountNum = '<%ejGet(partitions)%>';
var shareMaxNum = 18;
var volMaxNum = 7;
var mountMaxNum = 4;

var shVol = new Array(shareMaxNum);
var shName = new Array(shareMaxNum);

var	volLabelMix = new Array(volMaxNum+1);
var	volLabel = new Array(volMaxNum+1);
var	volSerial = new Array(volMaxNum+1);
var	volType = new Array(volMaxNum+1);
var	volTypeID = new Array(volMaxNum+1);
var	volID = new Array(volMaxNum+1);
var	volMount = new Array(volMaxNum+1);
var	volValid = new Array(volMaxNum+1);
var	volSize = new Array(volMaxNum+1);
var	volFree = new Array(volMaxNum+1);
var	partInfo = new Array(volMaxNum+1);
var	volShareNum = new Array(volMaxNum+1);

shVol[2] = 1;
shName[2] = 'DISK_IMG';

volLabelMix[0] = 'DISK_IMG (FAT16)';
volLabel[0] = 'DISK_IMG';
volSerial[0] = '2DED-7A00';
var array = usb_ms_type.split('|');
var length = array.length - 1;
for (i=0;i<length; i++)
{
	volType[i]=array[i];
}

volValid[0] = true;
volSize[0] = '1.93 GB';
volFree[0] = '1.84 GB';
volID[0] = 1;
volTypeID[0] = 6;
volMount[0] = 1;
partInfo[0] = 'DISK_IMG (1.93 GB, 1.84 GB free, FAT16)';

//volNum[0] = 8;
volLabelMix[1] = 'No Disk';
volID[1] = 0;
volValid[1] = true;
volValid[1] = false;

//volNum[1] = 8;

profile_num=5;
var enb_value=new Array(5);
var partition_value=new Array(5);
var disk_value=new Array(5);
var user_value=new Array(5);
var pathValue=new Array(5);
/*enb_value[0]=1;
partition_value[0]=1;
disk_value[0]=0;
user_value[0]="anonymous";
pathValue[0] = '';*/
var ftp_user_info = '<%ej_get_ftp_userid(user_info)%>';
//var ftp_user_info = 'anonymous.\\|';


var entrys = ftp_user_info.split('|');

var entryNum = entrys.length - 1;

var rule = new Array(profile_num);

for (i = 0; i < profile_num; i++)
{
	rule[i] = new rVe('','');
}

for (j = 0; j < entryNum; j++)
{
	var entry = entrys[j].split('&');
	rule[j] = new rVe(entry[0], entry[1]);
}

function rVe(userId, path )
{
   this.userId = userId;   this.path = path;  
}

for (j = 0; j < entryNum; j++)
{
	user_value[j] = rule[j].userId;
	//alert(user_value[j]);
	pathValue[j] = rule[j].path;
	//alert(pathValue[j]);
	enb_value[j] = 1;
}
var wftp_partition_value=1;
var wftp_disk_value=0;
var http_browse_port=8000;
var http_browse_remote=0;
var wftp_pathValue='\\';
var wftp_defaultPath='/iinet_usb';

function submitRefreshDisk() {
	document.tF0.isPrinter.value = 0;
	document.tF0.unplug.value = 3;
	document.tF0.submit();

	return true;
}

// flag: 1-mount, 2-unmount
// diskId: 0 based
// volId: 1 based
function mountFunc(volId, flag) {
	if (volShareNum[volId] > 0) {
		alert('This partition has been shared for some service. Please disable these services before you deactivate this partition.');
		return false;
	}

	
	document.tF0.volID.value = volId - 1;
	document.tF0.volType.value = volTypeID[volId];
	document.tF0.mountflag.value = flag;
	//document.tF0.submit();
}

var stri;
// volId: 1 based
function part_stat(volId){
	var j, strTmp, tt, cnt = 0, cntFtp = 0, cntWFtp = 0;

	// check file server
	strTmp = '';
	tt = '';
	/*for (j = 2 ; j < shareMaxNum ; j++) {
		if ((shVol[j] == volId) && (shName[j] != '')) {
			if (cnt > 0) strTmp += ',';
			strTmp += shName[j];
			cnt++;
		}
	}
	if (cnt > 0) {
		tt += 'File Server('+strTmp+')';
	}
*/
	// check ftp
	strTmp = '';
	for (j = 0 ; j < entryNum ; j++) {
		if (user_value[j] != '') {
			if (cntFtp > 0) strTmp += ',';
			strTmp += user_value[j];
			cntFtp++;
		}
	}
	if (cntFtp > 0 && 1 == volId) {
		if (tt != '') tt += ', ';
		tt += 'FTP('+strTmp+')';
	}

	// check wftp
	if ((wftp_partition_value == volId)) {
		if (tt != '') tt += ', ';
		tt += 'Web-FTP';
		cntWFtp = 1;
	}

	if (tt == '') stri += '&nbsp;';
	else stri += tt;
	
	volShareNum[volId] = cnt + cntFtp + cntWFtp;
}

function getDISK() {
	var j, k;

	if (diskNum == 0) return;

	stri = '<table border="0" cellspacing="1" cellpadding="5" width=80%>';
	if (part_num != -1) {
		stri += '<tr><td class=tdTitle>Partition</td>\n';
		stri += '<td class=tdTitle>Sharing Status</td>';
		stri += '<td class=tdTitle>Configure</td></tr>';
		for (j = 1 ; j <= part_num; j++) {
			if (volType[j-1] == 'vfat')
				volType[j-1] = 'FAT32';
			stri += '<tr><td class=tdText>'+(j)+'.  '+volType[j-1]+'</td>';
			//if ((volType[j-1] != 'FAT12') && (volType[j-1] != 'FAT16') && (volType[j-1] != 'FAT32') && (volType[j-1] != 'Minix')) {
				//stri += '<td class=tdText colspan=2>(not supported)</td></tr>';
			//}
		 if ((volMount[j-1] == 0) && (mountNum >= mountMaxNum)) {
				stri += '<td class=tdText>&nbsp;</td>';
				stri += '<td class=tdText>&nbsp;</td></tr>';
			}
			else {
				if (volMount[j-1] != 0) {
					stri += '<td class=tdText>';
					part_stat(j);
					stri += '</td>';
					stri += '<td class=tdText><a href="" onclick="javascript:void(mountFunc(j,2));" class="button87b_0margin"><input type="button" class="formsbutton" name="deactb" value="Deactivate"></a></td></tr>';
					//stri += '<td class=tdText><a href="" onclick="javascript:void(mountFunc('j',2));" class="button87b_0margin"><input type="button" class="formsbutton" name="deactb" value="Deactivate"></a></td></tr>';
				}
				else {
					stri += '<td class=tdText>&nbsp;</td>';
					stri += '<td class=tdText><a href="" onclick="javascript:void(mountFunc(j,1));" class="button87b_0margin"><input type="button" class="formsbutton" name="actb" value="Active"></a></td></tr>';
				}
			}
		}
	}
	stri += '<tr><td></td></tr></table>';

	document.getElementById('Partition').innerHTML=stri;
}


var preUsbEnb = 1;
function frmLoad(){
   with ( document.forms[0] ) {
      var UsbEnb = '<%ejGet(usbenable)%>';
      if (UsbEnb == '1')
	  		preUsbEnb = 1;
	  else 
	  		preUsbEnb = 0;
	}
}
function evaltF() {
	if (document.tF0.usbEnable.checked == false) {
		if (confirm('Before you disable this function. Please make sure no any user is connecting to the USB device. Unexpect disconnect could result client user file crash or system hang-up. Do you really want to continue ?') == false) {
			document.tF0.usbEnable.checked = true;
			return false;
		}}
		
	var loc = 'usbmain.cmd?';
	if (document.tF0.usbEnable.checked == false)
		loc += '&enable=0';
	else
		loc += '&enable=1';
	var code = 'location="' + loc + '"';
	//alert('eval(code)='+code);
	eval(code);
		
	return true;
}


function click_Eject(){
	if (confirm('Before you disable this function. Please make sure no any user is connecting to the USB. Unexpect disconnect could result client user file crash or system hang-up. Do you really want to continue ?') == false) {
		return false;
	}
	else{
		var loc = 'usbeject.cgi';
		var code = 'location=\"' + loc + '\"';
			//alert('eval(code)='+code);
		eval(code);
	}
}

function click_Unplug(){
	if (confirm('Before you disable this function. Please make sure no any user is connecting to the USB. Unexpect disconnect could result client user file crash or system hang-up. Do you really want to continue ?') == false) {
		return false;
	}
	else{
		//if (confirm('Please Un-Plug your USB device ?') == false) {
		//return false;
	 	//}
		//else{
		var loc = 'usbremove.cgi';
		var code = 'location=\"' + loc + '\"';
			//alert('eval(code)='+code);
		eval(code);
		//}
	}
}

function click_Rescan(){
	var loc = 'usbrescan.cgi';
	var code = 'location=\"' + loc + '\"';
		//alert('eval(code)='+code);
	eval(code);	
}

function click_Update(){
	var loc = 'usbdetect.cgi';
	var code = 'location=\"' + loc + '\"';
		//alert('eval(code)='+code);
	eval(code);
}

function btnCancel(){
	var loc= 'usb_main.html';
    var code = 'location=\"' + loc + '\"';
    eval(code);
}
 //done hiding -->
</SCRIPT>
<link rel="stylesheet" type="text/css" media="screen" href="wftp.css">
</HEAD>
<BODY onLoad='frmLoad()'>
<BLOCKQUOTE>

<SCRIPT language=JavaScript>
TabHeader="Setup";
SideItem="USB Setup";
HelpItem="usb";
</SCRIPT>

<SCRIPT type=text/javascript>
mainTableStart();	
logo();
TopNav();
ThirdRowStart();
Write_Item_Images();
mainBodyStart();
</SCRIPT>

  <FORM name="tF0">
  <input type="hidden" name="isPrinter">
<input type="hidden" name="unplug" value=0>
<input type="hidden" name="mountflag" value=0>
<input type="hidden" name="volID">
<input type="hidden" name="volType">
  <TABLE id=box_header cellSpacing=0 border=0>
    <TBODY>
    <TR>
      <TD class=topheader>USB setup</TD></TR>
    <TR>
      <TD class=content>
        <P>
		This IAD supports the USB Host controller function. You can enable this function and plug-in your USB device to share it with other people over your LAN network.
<!--    <p> The supported USB devices include:
			<br><br>
			USB mass storage: hard disk, flash disk or single slot card reader, up to 1 device.<br>
			USB-Hub: up to 1 device.<br>

			<br><br>
			After you plug-in the USB device into this IAD. You may click "Update Status" to see the device information in the "Current USB Device Status" table.
			Three different file system formats are supported: FAT12, FAT16 and FAT32, and up to 4 partitions could be activated at the same time. For your convenience, the  IAD will activate the first 4 partitions automatically when you plug-in an USB storage device. If you have more than 4 partitions in your storage device, you could "Deactivate" some unused partitions and "Activate" other partitions that you would like to use. Please activate the partitions before you configure the "File Server", "FTP Server" and "Web FTP Server".</p>-->
		</P>
		</TD></TR></TBODY></TABLE>
  <TABLE id=body_header cellSpacing=0 border=0>
    <TBODY>
    <TR>
      <TD class=topheader>USB Interface</TD></TR>
    <TR>
     <TD class=content>
        <P>
		    <script LANGUAGE="JavaScript">
				if (diskNum  > 0) {
					document.write('<font color="red">Warning!</font> If you would like to unplug the USB storage, please click "Safely Remove" button in the "Current USB Device Status" table to make sure all un-saved data have been written into disk completely. Directly unplugging device may cause your USB storage crash.</p>');
				}
			</script>
		</p>
	 </td>
	</tr>
	<tr>
		<td>
			<p class=normalText>
				<input type="checkbox" name="usbEnable" value=1>&nbsp;&nbsp;Enable USB function
				<script LANGUAGE="JavaScript">
					if (preUsbEnb == 1)
						document.forms[0].usbEnable.checked = true;
					else
						document.forms[0].usbEnable.checked = false;
				</script>
			</p>
		</td>
	</tr>
	<tr>
		<td>
			<p class=normalText>Current USB Device Status:</p>
				<script language="javascript">
				var k;
				document.write('<table border=0 cellspacing="1" cellpadding="5" width=80%><tr><td class=tdTitle>\n');
				document.write('<table border=0 cellspacing="0" cellpadding="0" width=100%><tr>');
				if (diskNum > 0) {
					document.write('<td width=80%>');
					document.write('<input type="hidden" name="disk_id" value=0>');
					for (k = 0 ; k < diskNum ; k++) {
						document.tF0.disk_id.value = k;
						if (isBlank(drive_Info) == false)
							document.write('<b>'+drive_Info+' connected with '+part_num+' Partitions</b>');
						else
							document.write('<b>Mass storage connected with '+part_num+' Partitions</b>');
					}
					document.write('</td>');

					// only support one disk
					document.write('<td align=right nowrap>');
					if (dev_eject) 
						document.write('<input type="button" class="formsbutton" onclick="click_Eject();" name="ejectb" value="Eject">');

					document.write('<input type="button" class="formsbutton" onclick="click_Unplug();" name="uplugb" value="Safely Remove"></td>');
					document.write('</tr></table></td></tr></table>');
					document.write('<span id="Partition"></span>');
					getDISK();
				}
				else if (dev_eject) { // only support one disk
					document.write('<td width=80%>');
					document.write('<input type="hidden" name="disk_id" value=0>');
					if (drive_Info !== "()")
						document.write('<b>'+drive_Info+'</b>');
					else
						document.write('<b>Mass Storage</b>');
					document.write('</td><td align=right nowrap>');
					document.write('<input type="button" class="formsbutton" onclick="click_Rescan();" name="rescanb" value="Rescan">');
					//document.write('<a href="" onclick="javascript:void(submitUnPlug(0,0,1));" class="button87b"><input type="button" class="formsbutton" name="uplugb" value="Safely Remove"></a>');
					document.write('</td></tr></table></td></tr><tr><td></td></tr></table>');
				}
				else {
					document.write('<input type="hidden" name="disk_id" value=0>');
					document.write('<td width=80%><b>Mass storage Disconnected</b></td>\n');
					document.write('<td align=right width=20%><input type="button" class="formsbutton" onclick="click_Update();" name="updateb" value="Update Status"></td>');
					document.write('</tr></table></td></tr><tr><td></td></tr></table>');
				}
				
				
				</script>

				<!--<P align=center><a href="javascript:document.forms[0].submit()" onClick="return evaltF();" class="button87b"><input type="button" class="formsbutton" name="savesetting" value="SAVE SETTINGS"></a>-->
				<!---<td><a href=''><input type="button" class="formsbutton" name="cancelb" value="CANCEL" onClick='btnCancel()'></P>-->
    <!--    <P align=center><INPUT onclick=atmcfg() type=button value="ATM Interface"></P>-->
		</TD></TR></TBODY></TABLE>
  <!--<TABLE id=body_header cellSpacing=0 border=0>
    <TBODY>
    <TR>
      <TD class=topheader>ETH interface</TD></TR>
    <TR>
      <TD class=content>
        <P>use ETH to configure you wan interface.</P>

          <P align=center><INPUT onclick=ethcfg() type=button value="ETH Interface"></P>
		  
         </TD></TR></TBODY></TABLE>-->
				<P align=center><INPUT onclick='evaltF()' type=button class="formsbutton"  name="savesetting" value="SAVE SETTINGS">
				<INPUT onclick='btnCancel()' type=button class="formsbutton"  name="cancelb" value="CANCEL"></P>		 
</FORM>
 <SCRIPT type=text/javascript>
mainBodyEnd();
ThirdRowEnd();
Footer()
mainTableEnd()
</SCRIPT>
</BLOCKQUOTE></BODY></HTML>
