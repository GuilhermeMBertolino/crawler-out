<html>
   <head>
      <meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
      <link rel="stylesheet" href='stylemain.css' type='text/css'>
		<script language="javascript" src="util.js"></script>
		<script language="javascript" src="menu.js"></script>
            <script language="javascript">
<!-- hide
var timeOut = '<%ejGet(pppTimeOut)%>';
var onDemand = '<%ejGet(enblOnDemand)%>';
var ipExtension = '<%ejGet(pppIpExtension)%>';
var authMethod = '<%ejGet(pppAuthMethod)%>';
var prtcl = '<%ejGetOther(memInfo, ntwkPrtcl)%>';
var enblIpAddr = '<%ejGet(useStaticIpAddress)%>';
var localIpAddr = '<%ejGet(pppLocalIpAddress)%>';
var pppDebug = '<%ejGet(enblPppDebug)%>';
var pppShowAuthErrorRetry = '<%ejGet(pppShowAuthErrorRetry)%>';
var pppAuthErrorRetry = '<%ejGet(pppAuthErrorRetry)%>';
var enetWan = parseInt('<%ejGet(enblEnetWan)%>');
var ppptobr = '<%ejGet(pppToBridge)%>';
var fullcone = '<%ejGet(enblFullcone)%>';
var enblAdvDmz = '<%ejGet(enblAdvDmz)%>';
var serviceId = '<%ejGet(serviceId)%>';

var enblIP6 = '<%ejGet(enblv6)%>';
var addr6Type = '<%ejGet(wanAddr6Type)%>'; if ( addr6Type == '&nbsp' ) addr6Type = '';
var addr6 = '<%ejGet(wanAddr6)%>';  if (addr6 == '&nbsp') addr6 = '';
var addr6PrefixLen = '<%ejGet(wanAddr6PrefixLen)%>';  if (addr6PrefixLen == '&nbsp') addr6PrefixLen = '';

var enbl_usb_3g = '<%ej_get_3g(usb35genable)%>';
var has_3g_ppp = '<%ej_get_3g(usb35gexists)%>';

function frmLoad() {
	with ( document.forms[0] ) {
		if (enblAdvDmz == 1) {
			var enblAdvancedDmz = '<%ejGet(enableAdvancedDmz)%>';
		    var nonDmzIpAddr = '<%ejGet(nonDmzIpAddress)%>';
			var nonDmzIpMsk = '<%ejGet(nonDmzIpMask)%>';
			if ( enblAdvancedDmz == '1' )
				enableAdvancedDmz.checked = true;
			else
				enableAdvancedDmz.checked = false;	
			nonDmzIpAddress.value = nonDmzIpAddr;
			nonDmzIpMask.value = nonDmzIpMsk;		 
		}
        showhide("pppUserAndPass", 1);
		if ( onDemand == '1' ) {
			enblOnDemand.checked = true;
			hideOnDemandInfo(0);
		} else {
			enblOnDemand.checked = false;
			hideOnDemandInfo(1);
		}
		if ( enblIpAddr == '1' ) {
			enblPppIpAddress.checked = true;
			hidePppIpAddressInfo(0);
		} else {
			enblPppIpAddress.checked = false;
			hidePppIpAddressInfo(1);
		}
		//if ( enblIP6 == '1' ) {
		//   if ( addr6Type == 'Static' ) {
		//      enblPppIp6Address.checked = true;
		//   } else {
		//      enblPppIp6Address.checked = false;
		//   }
		//   hideWan6Info(0);
		//} else {
		//   hideWan6Info(1);
		//}
		if ( fullcone == '1' )
			enblFullcone.checked = true;
		else
			enblFullcone.checked = false;      
		if ( ipExtension == '1' )
			pppIpExtension.checked = true;
		else
			pppIpExtension.checked = false;

		if ( authMethod == '1' )
			pppAuthMethod.selectedIndex = 2;
		else if ( authMethod == '2' )
			pppAuthMethod.selectedIndex = 3;
		else if ( authMethod == '3' )
			pppAuthMethod.selectedIndex = 4;
		else
			pppAuthMethod.selectedIndex = 1;
		if(enbl_usb_3g == '1' && has_3g_ppp != '1'){
			pppUserName.value = '';
			pppPassword.value = '';
		}else{
			pppUserName.value = '<%ejGet(pppUserName)%>';
			pppPassword.value = '<%ejGet(pppPassword)%>';
		}
		pppTimeOut.value = timeOut;
		pppLocalIpAddress.value = localIpAddr;
		if ( prtcl == 'PPPoE' )
			pppServerName.value = '<%ejGet(pppServerName)%>';

		if ( pppShowAuthErrorRetry == '1' )
			hidePppAuthErrorRetry(0);
		else
		 hidePppAuthErrorRetry(1);

		if ( pppAuthErrorRetry == '1' )
			authErrorRetry.checked = true;
		else
			authErrorRetry.checked = false;

		if ( pppDebug == '1' )
			enblPppDebug.checked = true;
		else
			enblPppDebug.checked = false;

		if (prtcl == 'PPPoE') {
			setCheck(pppToBridge, ppptobr);
		}   
		else {
			setCheck(pppToBridge, 0);
		}
		pppIpExtChange(pppIpExtension);

		var enableIgmp = '<%ejGet(enblIgmp)%>';
		if ( enableIgmp == '1' )
			enblIgmp.checked = true;
		else
			enblIgmp.checked = false;
	}
}

function btnNext() {
   var loc = 'ifcdns.cgi?';

   with ( document.forms[0] ) {
      // validate user name
      var len = pppUserName.value.length;
      if ( len > 64 ) {
         msg = 'The length of user name (' + len + ') is too long [0-64].';
         alert(msg);
         return;
      }
	  if(is_valid_ppp(pppUserName.value) == false) {
         msg = 'The PPP user name (' + pppUserName.value + ') has unsafe chars \' \" \\ < >';
         alert(msg);
         return;
      }
      // validate password
      len = pppPassword.value.length;
      if ( len > 32 ) {
         msg = 'The length of password (' + len + ') is too long [0-32].';
         alert(msg);
         return;
      }
	  if(is_valid_ppp(pppPassword.value) == false) {
         msg = 'The PPP password (' + pppPassword.value + ') has unsafe chars \' \" \\ < >';
         alert(msg);
         return;
      }
	  
      // validate inactivity timeout
      if ( enblOnDemand.checked == true ) {
         if ( isNaN(parseInt(pppTimeOut.value)) == true ) {
            msg = 'Inactivity Timeout "' + pppTimeOut.value + '" is invalid.';
            alert(msg);
            return;
         }
         timeOutNum = parseInt(pppTimeOut.value);
         if ( timeOutNum < 1 || timeOutNum > 4320 ) {
            msg = 'Inactivity Timeout "' + pppTimeOut.value + '" is out of range [1-4320].';
            alert(msg);
            return;
         }
      }

	  if (enblAdvDmz == 1) {
        // validate ppp IP address
        if ( enblPppIpAddress.checked == true ) {
           if ( isValidIpAddress(pppLocalIpAddress.value) == false ) {
              alert('Address "' + pppLocalIpAddress.value + '" is invalid IP address.');
              return;
           }
        }
        // validate non DMZ IP address and Netmask
        if ( enableAdvancedDmz.checked == true ) {
           if ( isValidIpAddress(nonDmzIpAddress.value) == false ) {
              alert('Address "' + nonDmzIpAddress.value + '" is invalid IP address.');
              return;
           }
           if ( isValidIpAddress(nonDmzIpMask.value) == false ) {
              alert('Address "' + nonDmzIpMask.value + '" is invalid Netmask.');
              return;
           }
        }
	  }
	  
      // validate authentication method
      if ( pppAuthMethod.selectedIndex == 0 ) {
         msg = 'No selection for authentication method.';
         alert(msg);
         return;
      }
      // validate server name
      if ( prtcl == 'PPPoE') {
         len = pppServerName.value.length;
         if ( len > 32 ) {
            msg = 'The length of PPP service (' + len + ') is too long [0-32].';
            alert(msg);
            return;
         }
      }

      //loc = 'ifcdns.cgi?';

      loc += 'pppUserName=' + encodeUrl(pppUserName.value);
      loc += '&pppPassword=' + encodeUrl(pppPassword.value);
      if ( enblOnDemand.checked == true ) {
         loc += '&enblOnDemand=1';
         loc += '&pppTimeOut=' + timeOutNum;
      } else {
         loc += '&enblOnDemand=0';
         loc += '&pppTimeOut=' + timeOut;
      }
      if ( enblPppIpAddress.checked == true ) {
         loc += '&useStaticIpAddress=1';
         loc += '&pppLocalIpAddress=' + pppLocalIpAddress.value;
      } else {
         loc += '&useStaticIpAddress=0';
         loc += '&pppLocalIpAddress=' + localIpAddr;
      }
      if ( pppIpExtension.checked == true ) {
         loc += '&pppIpExtension=1&enblNat=0&enblFirewall=0';
	     if (enblAdvDmz == '1') {
	         if ( enableAdvancedDmz.checked == true ) {
	            loc += '&enableAdvancedDmz=1';
	            loc += '&nonDmzIpAddress=' + nonDmzIpAddress.value;
	            loc += '&nonDmzIpMask=' + nonDmzIpMask.value;
	         } else {
	            loc += '&enableAdvancedDmz=0';
	         }
	     }
      }
      else
         loc += '&pppIpExtension=0&enblFirewall=1&enblNat=1';
      if ( enblFullcone.checked == true )
         loc += '&enblFullcone=1';
      else
         loc += '&enblFullcone=0';
      var idx = pppAuthMethod.selectedIndex;
      loc += '&pppAuthMethod=' + pppAuthMethod.options[idx].value;
      if ( prtcl == 'PPPoE')
         loc += '&pppServerName=' + encodeUrl(pppServerName.value);

      if ( authErrorRetry.checked == true )
         loc += '&pppAuthErrorRetry=1';
      else
         loc += '&pppAuthErrorRetry=0';

      if ( enblPppDebug.checked == true )
         loc += '&enblPppDebug=1';
      else
         loc += '&enblPppDebug=0';
         
      loc += submitCheck(pppToBridge);

      if ( enblIgmp.checked == true )
         loc += '&enblIgmp=1';
      else
         loc += '&enblIgmp=0';

      if ( enblIP6 == '1' ) {
         if ( enblPppIp6Address.checked == false )
            loc += '&wanAddr6Type=DHCP';   // auto WAN address
         else {
            loc += '&wanAddr6Type=Static';   // static WAN address
            if (pppLocalIp6Address.value != '' && isValidIpAddress6(pppLocalIp6Address.value) == false) {
               alert('Invalid PPP local IPv6 address.');
               return;
            }
            loc += '&wanAddr6=' + pppLocalIp6Address.value;
            if (pppLocalIp6PrefixLen.value != '' && isValidPrefixLength(pppLocalIp6PrefixLen.value) == false) {
               alert('Invalid PPP local IPv6 prefix length.');
               return;
            }
            loc += '&wanAddr6PrefixLen=' + pppLocalIp6PrefixLen.value;
         }
      }
   }
   var code = 'location="' + loc + '"';
   eval(code);
}

function btnBack() {
	//var wanL2IfName = '<%ejGet(wanL2IfName)%>';
	//var loc = '';
	//loc = 'wansrvc.cmd?wanL2IfName='+wanL2IfName; 
	
	var code = 'location="' + '3gwanproto.html' + '"';
    if (serviceId != '0')
    {
        code = 'location="' + 'cfgwan.cmd' + '"';
    }
	eval(code);
}

function hideOnDemandInfo(hide) {
   var status = 'visible';
   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)  // DOM3 = IE5, NS6
      document.getElementById('pppInfo').style.visibility = status;
   else {
      if (document.layers) { // Netscape 4
         if ( hide == 1 )
            document.forms[0].pppTimeOut.value = '';
         else
            document.forms[0].pppTimeOut.value = '<%ejGet(pppTimeOut)%>';
      } else  // IE 4
         document.all.pppInfo.style.visibility = status;
   }
}

function dialOnDemandClick(cb) {
   if ( cb.checked == true )
      hideOnDemandInfo(0);
   else
      hideOnDemandInfo(1);
}

function advancedDmzClick(cb) {
   with ( document.forms[0] ) {
     setDisable(nonDmzIpAddress, cb.checked != true);
     setDisable(nonDmzIpMask, cb.checked != true);
   }
}

function hidePppIpAddressInfo(hide) {
   var status = 'visible';
   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)  // DOM3 = IE5, NS6
      document.getElementById('pppIpAddressInfo').style.visibility = status;
   else {
      if (document.layers) { // Netscape 4
         if ( hide == 1 )
            document.forms[0].pppLocalIpAddress.value = '';
         else
            document.forms[0].pppLocalIpAddress.value = '<%ejGet(pppLocalIpAddress)%>';
      } else  // IE 4
         document.all.pppIpAddressInfo.style.visibility = status;
   }
}

function pppIpAddressClick(cb) {
   if ( cb.checked == true )
      hidePppIpAddressInfo(0);
   else
      hidePppIpAddressInfo(1);
}

function hidePppIp6AddressInfo(hide) {
   var status = 'visible';
   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)  // DOM3 = IE5, NS6
      document.getElementById('pppIp6AddressInfo').style.visibility = status;
   else {
      if (document.layers == false) // IE4
         document.all.pppIp6AddressInfo.style.visibility = status;
   }
}

function pppIp6AddressClick() {
   with ( document.forms[0] ) {
      pppLocalIp6Address.value = addr6;
      pppLocalIp6PrefixLen.value = addr6PrefixLen;
      if ( enblPppIp6Address.checked == true ) {
         pppLocalIp6Address.value = addr6;
         pppLocalIp6PrefixLen.value = addr6PrefixLen;
         hidePppIp6AddressInfo(0);
      }
      else {
         pppLocalIp6Address.value = '';
         pppLocalIp6PrefixLen.value = '';
         hidePppIp6AddressInfo(1);
      }
   }
}

function hideWan6Info(hide) {
   var status = 'visible';

   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)  // DOM3 = IE5, NS6
      document.getElementById('wan6Info').style.visibility = status;
   else {
      if (document.layers == false) // IE4
         document.all.wan6Info.style.visibility = status;
   }

      pppIp6AddressClick();
}

function hidePppAuthErrorRetry(hide) {
   var status = 'visible';

   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)  // DOM3 = IE5, NS6
      document.getElementById('pppAuthErrorInfo').style.visibility = status;
   else {
      if (document.layers == false) // IE4
         document.all.pppAuthErrorInfo.style.visibility = status;
   }
}

function pppIpExtChange(item) {
        if ( item.checked == true ) {
            with ( document.forms[0] ) {
	          if (enblAdvDmz == '1') {
                setDisable(enableAdvancedDmz, 0);
                setDisable(nonDmzIpAddress, enableAdvancedDmz.checked != true);
                setDisable(nonDmzIpMask, enableAdvancedDmz.checked != true);
	          }
            }
        } else {
            with ( document.forms[0] ) {
	          if (enblAdvDmz == '1') {				
                setDisable(enableAdvancedDmz,1);
                setDisable(nonDmzIpAddress,1);
                setDisable(nonDmzIpMask,1);
	          }
            }
        }

	if (enetWan == '1' || prtcl != 'PPPoE' || item.checked == true) {
	    showhide("divPppToBridge", 0);
	}
	else {
	    showhide("divPppToBridge", 1);
	}
}

function btnCancel(){
   var loc = 'pppoe.cgi';

   var code = 'location="' + loc + '"';

   eval(code);

}

// done hiding -->
</script>
   </head>
   <body onLoad='frmLoad()'>
      <blockquote>
<script language="JavaScript">
TabHeader="Setup";
SideItem="Internet Setup";
HelpItem="wancfghelp";
</script> 
<script type='text/javascript'>
	mainTableStart();	
	logo();
	TopNav();
	ThirdRowStart();
	Write_Item_Images();
	mainBodyStart();
</script>
         <form>
			<table id=box_header width="690" border=0 cellSpacing=0>
			<tr>
			<td class=topheader>WAN</td></tr>
			<tr>
			<td class=content><p>
			PPP usually requires that you have a user name and password to establish your 
            connection. <br>In the boxes below, enter the user name and password that your ISP 
            has provided to you. But if your ISP hasn't provided, you should leave it blank.</p>
			</td></tr></table>
			<table id=body_header width="690" border=0 cellSpacing=0>
			<tr><td class=topheader>PPP Username and Password</td></tr>
			<tr>
			<td class=content>
            <br>
           
            <div id = 'pppUserAndPass'>
            <table border="0" cellpadding="0" cellspacing="0">
               <tr>
                  <td>PPP Username:&nbsp;&nbsp;</td>
                  <td><input type='text' name='pppUserName' maxLength=64></td>
               </tr>
               <tr>
                  <td>PPP Password:&nbsp;&nbsp;</td>
                  <td><input type='password' name='pppPassword' maxLength=32></td>
               </tr>
<script language="javascript">
<!-- hide
if ( prtcl == 'PPPoE') {
   document.writeln("               </tr>");
   document.writeln("                  <td>PPPoE Service Name:&nbsp;&nbsp;</td>");
   document.writeln("                  <td><input type='text' name='pppServerName'></td>");
   document.writeln("               </tr>");
}
// done hiding -->
</script>
               <tr>
                  <td>Authentication Method:&nbsp;&nbsp;</td>
                  <td><select name='pppAuthMethod' size="1">
                        <option value="-1">
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp
                        <option value="0">AUTO
                        <option value="1">PAP
                        <option value="2">CHAP
                        <option value="3">MSCHAP
                     </select></td>
               </tr>
            </table>
            </div>
              <br>
              <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                  <td width='30' height="30"><input type='checkbox' name='enblFullcone'></td>
                  <td>Enable Fullcone NAT</td>
                </tr>
              </table>
              <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                  <td width='30' height="30"><input type='checkbox' name='enblOnDemand' onClick='dialOnDemandClick(this)'></td>
                  <td>Dial on demand (with idle timeout timer)</td>
                </tr>
              </table>
            <div id='pppInfo'>
            <table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td>Inactivity Timeout (minutes) [1-4320]:&nbsp;&nbsp;</td>
                <td><input type='text' name='pppTimeOut'></td>
              </tr>
            </table>
            <br>
            </div>
            <table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td width='30' height="30"><input type='checkbox' name='pppIpExtension' onClick='pppIpExtChange(this)'></td>
                <td>PPP IP extension</td>
              </tr>
              </table>
<script language="javascript">
<!-- hide
if (enblAdvDmz == '1')
{      
   document.writeln("<div id='advancedDmzInfo'>");
   document.writeln("<table border='0' cellpadding='0' cellspacing='0'>");
   document.writeln("<tr>");
   document.writeln("<td width='30' height='30'><input type='checkbox' name='enableAdvancedDmz' onClick='advancedDmzClick(this)'></td>");
   document.writeln("<td>Advanced DMZ</td>");
   document.writeln("</tr>");
   document.writeln("</table>");

   document.writeln("</div>");
   document.writeln("<div id='nonDmzIpAddressInfo'>");
   document.writeln("<table border='0' cellpadding='0' cellspacing='0'>");
   document.writeln("<tr>");
   document.writeln("<td width='140'>Non DMZ IP Address:&nbsp;&nbsp;</td>");
   document.writeln("<td><input type='text' name='nonDmzIpAddress'></td>");
   document.writeln("</tr>");
   document.writeln("<tr>");
   document.writeln("<td width='140'>Non DMZ Net Mask:&nbsp;&nbsp;</td>");
   document.writeln("<td><input type='text' name='nonDmzIpMask'></td>");
   document.writeln("</tr>");
   document.writeln("</table>");
   document.writeln("<br>");
   document.writeln("</div>");
}
// done hiding -->
</script>

              <table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td width='30' height="30"><input type='checkbox' name='enblPppIpAddress' onClick='pppIpAddressClick(this)'></td>
                <td>Use Static IPv4 Address</td>
              </tr>
            </table>
            <div id='pppIpAddressInfo'>
              <table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td width="160">IPv4 Address:&nbsp;&nbsp;</td>
                <td><input type='text' name='pppLocalIpAddress'></td>
              </tr>
            </table>
            </div>
            
<script language="javascript">
<!-- hide
if (enblIP6 == '1')
{      
            document.writeln("<div id='wan6Info'>");
            document.writeln("<table border=0 cellpadding=0 cellspacing=0>");
            document.writeln("<tr>");
            document.writeln("    <td width=30 height=30><input type=checkbox name=enblPppIp6Address onClick=pppIp6AddressClick()></td>");
            document.writeln("    <td>Use Static IPv6 Address</td>");
            document.writeln("  </tr>");
            document.writeln("</table>");
            
            document.writeln("<div id=pppIp6AddressInfo>");
            document.writeln("<table border=0 cellpadding=0 cellspacing=0>");
            document.writeln("  <tr>");
            document.writeln("    <td width=160>IPv6 Address:&nbsp;&nbsp;</td>");
            document.writeln("    <td><input type='text' name='pppLocalIp6Address'></td>");
            document.writeln("  </tr>");
            document.writeln("  <tr>");
            document.writeln("    <td width=160>IPv6 Address Prefix Length:</td>");
            document.writeln("    <td><input type=text name=pppLocalIp6PrefixLen></td>");
            document.writeln("  </tr>");
            document.writeln("</table>");
            document.writeln("</div>");
            document.writeln("</div>");
}
// done hiding -->
</script>
            <div id='pppAuthErrorInfo'>
            <table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td width='30' height="30"><input type='checkbox' name='authErrorRetry'></td>
                <td>Retry PPP password on authentication error</td>
              </tr>
            </table></div>
            <table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td width='30' height="30"><input type='checkbox' name='enblPppDebug'></td>
                <td>Enable PPP Debug Mode</td>
              </tr>
            </table>
            <div id = 'divPppToBridge'><table border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td width='30' height="30"><input type='checkbox' name='pppToBridge'></td>
                <td>Bridge PPPoE Frames Between WAN and Local Ports </td>
              </tr>
            </table></div>
            <br><br><b>IGMP Multicast</b><br>
            <table border="0" cellpadding="0" cellspacing="0">
               <tr>
                  <td width='30' height="30"><input type='checkbox' name='enblIgmp'></td>
                  <td>Enable IGMP Multicast</td>
               </tr>
            </table><br><br>
			</td>
			</tr></table>
			<br>
            <center>
               <input type='button' onClick='btnBack()' value='Back'> <input type='button' onClick='btnNext()' value='Next'><input type='button' onClick='btnCancel()' value='Cancel'>
            </center>
         </form>
      </blockquote>
<script type='text/javascript'>
mainBodyEnd();
delaytimer=200;
ThirdRowEnd();
Footer();
mainTableEnd();
</script>
   </body>
</html>
