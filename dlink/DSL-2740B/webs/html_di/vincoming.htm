<html>
<head>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<link rel='STYLESHEET' type='text/css' href='stylemain.css'>
<script language='JavaScript' src='menu.js'></script> 
<script language='JavaScript' src='util.js'></script> 
<SCRIPT language="JavaScript">
<!--
MAX_ENTRY = 10;
var fwdInfo = '<%ejGetForward(forward)%>'; //fwdInfo = ',,,,,,0';
var fwd = fwdInfo.split(',');

var icpInfo = '<%ejGetICP(icp)%>'; //icpInfo = '1,222,333,2|0,555555,,3|1,232,2323,0|0,,,|0,,,|0,,,|0,,,|0,,,|0,,,|0,,,|'
var icps = icpInfo.split('|');
var rule = new Array(MAX_ENTRY);

function rVe(flag, innum, tonum, condition)
{
   this.flag = flag;   this.innum = innum;
   this.tonum = tonum;   this.condition = condition;
}

for (i = 0; i < MAX_ENTRY; i++)	rule[i] = new rVe('','','','');

for (j = 0; j < MAX_ENTRY; j++)
{
	var icp = icps[j].split(',');
	rule[j] = new rVe(icp[0], icp[1], icp[2], icp[3]);
}


function frmLoad(){
	with ( document.forms[0] ) {
		T1.value = fwd[3];T2.value = fwd[4];T3.value = fwd[5];T4.value = fwd[6];
		if(fwd[0] == '1')		C1.checked = true; 
		else C1.checked = false;
		if(fwd[1] == '1')		C2.checked = true; 
		else C2.checked = false;
		if(fwd[2] == '1')		C3.checked = true; 
		else C3.checked = false;
	
		for (idx = 0; idx < 10; idx++){
			if(rule[idx].flag == '1'){
				v[idx].checked = true;
			}
			else{
				v[idx].checked = false;
			}
			a[idx].value = rule[idx].innum;
			b[idx].value = rule[idx].tonum;
			
			//if(rule[idx].innum == '') rule[idx].condition = 4; 
			
			setSelect(d[idx], rule[idx].condition);
			cChg(idx);
		}
	}
	stAkt();
}


var recheck = false;
var check2;
var check3;
function stAkt(){

 if (document.forms[0].C1.checked){
    check2 = document.forms[0].C2.checked;
    check3 = document.forms[0].C3.checked;
    recheck = true;
    document.forms[0].C2.checked = false;
    document.forms[0].C3.checked = false;
    document.forms[0].C2.disabled = true;
    document.forms[0].C3.disabled = true;
    document.forms[0].T1.disabled = false;
    document.forms[0].T2.disabled = true;
    document.forms[0].T3.disabled = true;
    document.forms[0].T4.disabled = true;
 }
 else{
    if (recheck){
       document.forms[0].C2.checked = check2;
       document.forms[0].C3.checked = check3;
    }
    recheck = false;
    document.forms[0].C2.disabled = false;
    document.forms[0].C3.disabled = false;
    document.forms[0].T1.disabled = true;
	if(document.forms[0].C2.checked)    document.forms[0].T2.disabled = false;
	else document.forms[0].T2.disabled = true;
	if(document.forms[0].C3.checked){
    document.forms[0].T3.disabled = false;
    document.forms[0].T4.disabled = false;
	}else{
    document.forms[0].T3.disabled = true;
    document.forms[0].T4.disabled = true;	
	}
 }
}

   function stChg() {
      with ( document.forms[0] ) {
	  
      }
   }
  
   function cChg(idx) {
      with ( document.forms[0] ) {
		if(getSelect(d[idx]) == '3' ||getSelect(d[idx]) == '4'){
			b[idx].disabled = true;
			b[idx].value = '';
		}
		else{
			b[idx].disabled = false;			
		}
      }
   }  
   
   function btnApply(){
      var loc = 'voipcfg.cmd?action=forward';

      var c1="0", c2="0", c3="0";
      if(document.forms[0].C1.checked == true) {
		if(document.forms[0].T1.value == ''||isNaN(document.forms[0].T1.value)){
			alert("Invalid Unconditional Forward to Number: "+ document.forms[0].T1.value);
			return;
		}
		else	
			c1="1"; 
	  }
      if(document.forms[0].C2.checked == true) {
		if(document.forms[0].T2.value == ''||isNaN(document.forms[0].T2.value)){		
			alert("Invalid Busy Forward to Number: "+ document.forms[0].T2.value);
			return;		
		}
		else
			c2="1";		
	  }	  
      if(document.forms[0].C3.checked == true) {
		if(document.forms[0].T3.value == ''||isNaN(document.forms[0].T3.value)){		
			alert("Invalid No Answer Forward to Number: "+ document.forms[0].T3.value);
			return;
		}		
		else 
			c3="1";
		if(document.forms[0].T4.value == ''||isNaN(document.forms[0].T4.value)){		
			alert("Invalid No Answer Waiting Time: "+ document.forms[0].T4.value);
			return;
		}
		if((parseInt(document.forms[0].T4.value) > 19) || (parseInt(document.forms[0].T4.value) < 10)){		
			alert("No Answer Waiting Time Range: (10-19)");
			return;
		}			
	  }
      loc += '&uncon=' + c1;
      loc += '&busy=' + c2;
      loc += '&noans=' + c3;
	  
	  if(c1 == '1')
		loc += '&ucall=' + document.forms[0].T1.value;
	  if(c2 == '1')		
		loc += '&bcall=' + document.forms[0].T2.value;
	  if(c3 == '1'){
		loc += '&ncall=' + document.forms[0].T3.value;
		loc += '&natime=' + document.forms[0].T4.value;	  
	  }
	  
	  for(i = 0; i < 10; i++){
		if(document.forms[0].v[i].checked == false && document.forms[0].a[i].value == '' &&
			document.forms[0].b[i].value == ''){
			continue;	
		}		
		if(document.forms[0].a[i].value != '' &&
			isNaN(document.forms[0].a[i].value)){
			alert('Invalid Incoming Call Number: ' + document.forms[0].a[i].value);
			return;
		}
		if(document.forms[0].v[i].checked == true && getSelect(document.forms[0].d[i]) != '3'
			&& getSelect(document.forms[0].d[i]) != '4'){
			if(document.forms[0].a[i].value == '' || document.forms[0].b[i].value == ''){
				alert('Require both Incoming and Forward Number.');
				return;
			}			
		}
		if(document.forms[0].v[i].checked == true && 
		(getSelect(document.forms[0].d[i]) == '3'|| getSelect(document.forms[0].d[i]) == '4')){
			if(document.forms[0].a[i].value == ''){
				alert('Require Incoming Call Number.');
				return;
			}			
		}		
		if(document.forms[0].b[i].value != '' && 	
			isNaN(document.forms[0].b[i].value)){
			alert('Invalid Forward to Number: '+ document.forms[0].b[i].value);
			return;
		}
		for(j = i+1; j < 10; j++){
			var m = parseInt(getSelect(document.forms[0].d[i]));
			var n = parseInt(getSelect(document.forms[0].d[j]));
			if((document.forms[0].v[i].checked == document.forms[0].v[j].checked)&&
				(document.forms[0].v[j].checked == true)&&
				(document.forms[0].a[i].value == document.forms[0].a[j].value)&& 
				(6*m + 2*n != 10)&&(6*n + 2*m != 10)){
				alert('Conflict rules:'+ (i+1) +' and '+(j+1) +'\nNOTE:If 2 Incoming Numbers are the same, make sure their conditions are \'Busy\' and \'No Answer\'!');
				return;
			}
		}
		
		
		if(document.forms[0].v[i].checked == true)
			loc += '&fg'+ i +'=1';
		else
			loc += '&fg'+ i +'=0';
		loc += '&icn'+ i +'=' + document.forms[0].a[i].value;
		if(getSelect(document.forms[0].d[i]) != '3' && getSelect(document.forms[0].d[i]) != '4')
			loc += '&ftn'+ i +'=' + document.forms[0].b[i].value;
		loc += '&con'+ i +'='+ getSelect(document.forms[0].d[i]);
		
	  }
	  
      var code = 'location="' + loc + '"';
      eval(code);
   }
//-->
</SCRIPT>


<body onLoad="frmLoad()"><blockquote>
<script language="JavaScript">
TabHeader="Voice";
SideItem="Incoming Call Policy"
HelpItem="Incoming";
</script> 
<script type='text/javascript'>
	mainTableStart();	
	logo();
	TopNav();
	ThirdRowStart();
	Write_Item_Images();
	mainBodyStart();
</script>
<form onload='frmLoad()'>
	<table id=box_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				Incoming call Configuration
			</td>										
		</tr>
		<tr>
			<td class=content>				
				Advanced call forwarding feature which can have several settings that assign dedicated incoming call number forwarded to the dedicated number on several condition individually.<br><br>
			</td>
		</tr>
	</table>
	<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				Forward to Number Setup
			</td>										
		</tr>
		<tr>
			<td class=content>

<table class=formarea border="0" cellpadding="0" cellspacing="0">
   <tr>
       <td><input type=checkbox name="C1" onclick=stAkt()></td>
       <td class=form_label0>Unconditional Forward to Number:</td>
	   <td><input type="text" name="T1" size="24" maxlength='31' value=''></td>
    </tr>
  <tr>
       <td><input type=checkbox name="C2" onclick=stAkt()></td>
       <td class=form_label0>Busy Forward to Number:</td>
	   <td><input type="text" name="T2" size="24" maxlength='31' value=''></td>
    </tr>
 <tr>
       <td><input type=checkbox name="C3" onclick=stAkt()></td>
       <td class=form_label0>No Answer Forward to Number:</td>
	   <td><input type="text" name="T3" size="24" maxlength='31' value=''></td>
    </tr>
	<tr> <td></td>
		<td class=form_label0>No Answer Waiting Time:</td>
		<td><input type="text" name="T4" size="4" maxlength='31' value=''>second</td>
	</tr>
 </table>
	</td>
	</tr>
</table>
	<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				Advanced Setup
			</td>										
		</tr>
		<tr>
			<td class=content>
				<table class=formarea border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td class=form_label>#</td><td class=form_label>Activate</td><td class=form_label>Incoming Call Number</td><td class=form_label>Forward to Number</td><td class=form_label>Condition</td>

					</tr>
					<tr>
						   
						<td class=form_label>1</td>
						<td class=form_label><input type=checkbox name="v" onclick=stChg()></td>
						<td class=form_label0><input type="text" name="a" size="24" maxlength='31' value=''></td>
						<td class=form_label0><input type="text" name="b" size="24" maxlength='31' value=''></td>
						<td><select name='d' size="1" onchange=cChg(0)>
								<option value=0 selected>Uncondtional</option>
								<option value=1>Busy</option>
								<option value=2>No Answer</option>
								<option value=3>Block</option>
								<option value=4>Accept</option>
							</select>
						</td>

					</tr>
					<tr>

						<td class=form_label>2</td>
						<td class=form_label><input type=checkbox name="v" onclick=stChg()></td>
						<td class=form_label0><input type="text" name="a" size="24" maxlength='31' value=''></td>
						<td class=form_label0><input type="text" name="b" size="24" maxlength='31' value=''></td>
						<td><select name='d' size="1" onchange=cChg(1)>
								<option value=0 selected>Uncondtional</option>
								<option value=1>Busy</option>
								<option value=2>No Answer</option>
								<option value=3>Block</option>
								<option value=4>Accept</option>
							</select>
						</td>

					</tr>
					<tr>
						<td class=form_label>3</td>
						<td class=form_label><input type=checkbox name="v" onclick=stChg()></td>
						<td class=form_label0><input type="text" name="a" size="24" maxlength='31' value=''></td>
						<td class=form_label0><input type="text" name="b" size="24" maxlength='31' value=''></td>
						<td><select name='d' size="1" onchange=cChg(2)>
								<option value=0 selected>Uncondtional</option>
								<option value=1>Busy</option>
								<option value=2>No Answer</option>
								<option value=3>Block</option>
								<option value=4>Accept</option>
							</select>
						</td>

					</tr>
					<tr>
						<td class=form_label>4</td>
						<td class=form_label><input type=checkbox name="v" onclick=stChg()></td>
						<td class=form_label0><input type="text" name="a" size="24" maxlength='31' value=''></td>
						<td class=form_label0><input type="text" name="b" size="24" maxlength='31' value=''></td>
						<td><select name='d' size="1" onchange=cChg(3)>
								<option value=0 selected>Uncondtional</option>
								<option value=1>Busy</option>
								<option value=2>No Answer</option>
								<option value=3>Block</option>
								<option value=4>Accept</option>
							</select>
						</td>

					</tr>
					<tr>
						<td class=form_label>5</td>
						<td class=form_label><input type=checkbox name="v" onclick=stChg()></td>
						<td class=form_label0><input type="text" name="a" size="24" maxlength='31' value=''></td>
						<td class=form_label0><input type="text" name="b" size="24" maxlength='31' value=''></td>
						<td><select name='d' size="1" onchange=cChg(4)>
								<option value=0 selected>Uncondtional</option>
								<option value=1>Busy</option>
								<option value=2>No Answer</option>
								<option value=3>Block</option>
								<option value=4>Accept</option>
							</select>
						</td>

					</tr>
					<tr>
						<td class=form_label>6</td>
						<td class=form_label><input type=checkbox name="v" onclick=stChg()></td>
						<td class=form_label0><input type="text" name="a" size="24" maxlength='31' value=''></td>
						<td class=form_label0><input type="text" name="b" size="24" maxlength='31' value=''></td>
						<td><select name='d' size="1" onchange=cChg(5)>
								<option value=0 selected>Uncondtional</option>
								<option value=1>Busy</option>
								<option value=2>No Answer</option>
								<option value=3>Block</option>
								<option value=4>Accept</option>
							</select>
						</td>

					</tr>
					<tr>

						<td class=form_label>7</td>
						<td class=form_label><input type=checkbox name="v" onclick=stChg()></td>
						<td class=form_label0><input type="text" name="a" size="24" maxlength='31' value=''></td>
						<td class=form_label0><input type="text" name="b" size="24" maxlength='31' value=''></td>
						<td><select name='d' size="1" onchange=cChg(6)>
								<option value=0 selected>Uncondtional</option>
								<option value=1>Busy</option>
								<option value=2>No Answer</option>
								<option value=3>Block</option>
								<option value=4>Accept</option>
							</select>
						</td>

					</tr>
					<tr>
						<td class=form_label>8</td>
						<td class=form_label><input type=checkbox name="v" onclick=stChg()></td>
						<td class=form_label0><input type="text" name="a" size="24" maxlength='31' value=''></td>
						<td class=form_label0><input type="text" name="b" size="24" maxlength='31' value=''></td>
						<td><select name='d' size="1" onchange=cChg(7)>
								<option value=0 selected>Uncondtional</option>
								<option value=1>Busy</option>
								<option value=2>No Answer</option>
								<option value=3>Block</option>
								<option value=4>Accept</option>
							</select>
						</td>

					</tr>
					<tr>
						<td class=form_label>9</td>
						<td class=form_label><input type=checkbox name="v" onclick=stChg()></td>
						<td class=form_label0><input type="text" name="a" size="24" maxlength='31' value=''></td>
						<td class=form_label0><input type="text" name="b" size="24" maxlength='31' value=''></td>
						<td><select name='d' size="1" onchange=cChg(8)>
								<option value=0 selected>Uncondtional</option>
								<option value=1>Busy</option>
								<option value=2>No Answer</option>
								<option value=3>Block</option>
								<option value=4>Accept</option>
							</select>
						</td>

					</tr>
					<tr>
						<td class=form_label>10</td>
						<td class=form_label><input type=checkbox name="v" onclick=stChg()></td>
						<td class=form_label0><input type="text" name="a" size="24" maxlength='31' value=''></td>
						<td class=form_label0><input type="text" name="b" size="24" maxlength='31' value=''></td>
						<td><select name='d' size="1" onchange=cChg(9)>
								<option value=0 selected>Uncondtional</option>
								<option value=1>Busy</option>
								<option value=2>No Answer</option>
								<option value=3>Block</option>
								<option value=4>Accept</option>
							</select>
						</td>

					</tr>
				</table>		
      </td>										
		</tr>
	</table>
<br>
<center><input name='button1' class=button_submit type=button value='Apply' onClick='btnApply()'>&nbsp;&nbsp;&nbsp;&nbsp;
				    <input name='button2' class=button_submit type=button value="Cancel" onClick="window.location.href='vincoming.htm'"></center>	
	
</form>	
	
<script type='text/javascript'>
	mainBodyEnd();
	ThirdRowEnd();
	Footer()
	mainTableEnd()
</script></blockquote>	
</body>
</html>

