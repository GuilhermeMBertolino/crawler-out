<html>
   <head>
      <meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
      <link rel="stylesheet" href='stylemain.css' type='text/css'>
            <script language="javascript" src="util.js"></script>
            <script language="javascript">
<!-- hide

var doEdit = false;
//Frederick,060911	add iptable schedule option
//var fwrules = 'aaa/FE80::16D6:4DFF:FEF2:B819/atm0/TCP/FE80::16D6:4DFF:FEF2:B819/444/555/atm0/scedule1|';
var fwrules = '<%ejGetIpv6Fwrule(fwrule)%>';
var MAX_ENTRY_NUM = 20;
var entrys = fwrules.split('|');
var entryNum = entrys.length - 1;
var rule = new Array(MAX_ENTRY_NUM);

for (j = 0; j < entryNum; j++)
{
	var entry = entrys[j].split('\1');
	rule[j] = new rVe(entry[0], entry[1], entry[2], entry[3], entry[4], entry[5],entry[6], entry[7]);
}

function rVe(fwruleName, srcAddr, srcWanIf, srcProto, dstAddr, dstPortStart, dstPortEnd, schedule)
{
   this.fwname = fwruleName;   this.srcAddr = srcAddr;   this.srcWanIf = srcWanIf;
   this.srcProto = srcProto;   this.dstAddr = dstAddr;   this.dstPortStart = dstPortStart;
   this.dstPortEnd = dstPortEnd;  this.schedule = schedule;
}

function rule_exist(rule_name)
{
    var i = 0;
   if (doEdit == false)
   {
       for (i = 0; i < entryNum; i++)
       {
           if (rule_name == rule[i].fwname)
           {
               return true;
           }
       }
   }
   return false;
}

function btnApply() {

var okChk = 0;
var loc = '';
	if(doEdit == false){
   		loc = 'ipv6_firewall.cmd?action=add';
   	}
	else{
   		loc = 'ipv6_firewall.cmd?action=edit';
   }

   with ( document.forms[0] ) {
	if(fwrulename.value == '')
	{
		alert("Firewall Rule Name is empty!");
		return;
	}
	else if (rule_exist(fwrulename.value))
	{
		alert("Firewall Rule Name is exist!");
		return;
	}
	loc += '&fwrulename=' + fwrulename.value;
	loc += '&iptschedule=' + iptscheditem.value;
	if(srcAddr.value == '')
	{
		alert("Source Address is empty!");
		return;
	}
	loc += '&srcAddr=' + srcAddr.value;
	loc += '&srcWanIf=' + srcWanIf.value;
	if(destAddr.value == '')
	{
		alert("Destnation Address is empty!");
		return;
	}
	loc += '&destAddr=' + destAddr.value;
	if(dstPortStart.value == '' || dstPortEnd.value == '')
	{
		alert("Destnation Ports is empty!");
		return;
	}
	loc += '&dstPortStart=' + dstPortStart.value;
	loc += '&dstPortEnd=' + dstPortEnd.value;
	if(srcProtocol.value == '4')
	{
		alert("No source or dest protocol selected!");
		return;
	}
	loc += '&srcProtocol=' + srcProtocol.value;
	
   }
   var code = 'location="' + loc + '"';
   eval(code);
}

//add by Van 1001051538
function isValidRange(EndIp, StartIp)
{

}
//add end



function btnCancel(){

}


function addClick(){
    if(entryNum == MAX_ENTRY_NUM)	
    {
        alert("A maximum 20 entries can be configured.");
        return;
    }
    doEdit = false;
    
    with ( document.forms[0] ) {
        document.getElementById("fwRuleInfo").style.display = 'block';
    }
}


//add end
function btnEdit(rml) {

	var lst='';
	var hasChecked = false;
	var checkedCount = 0;
	var checkId = 0;
	var tmpName= '';
	var tmpSrcAddr = '';
	var tmpSrcWan = '';
	var tmpSrcProto = '';
	var tmpDstAddr = '';
	var tmpDstPortStart = '';
	var tmpDstPortEnd = '';
	var tmpDstProto = '';
	var tmpSchedule = '';
	
	if (rml){
		if (rml.length > 1) {
			for(i=0;i<rml.length;i++)
			{
				if(rml[i].checked == true)
				{
					checkedCount++;
					hasChecked = true;
					checkId = i;
					tmpName = document.getElementById( "lblName" + i).innerHTML;
					tmpSrcAddr = document.getElementById("lblsrcAddr" + i).innerHTML;
					tmpSrcWan = document.getElementById("lblsrcWanIf" + i).innerHTML;
					tmpSrcProto = document.getElementById("lblSrcProtocol" + i).innerHTML;
					tmpDstAddr = document.getElementById("lbldstAddr" + i).innerHTML;
					var tmpDstPort = document.getElementById("lbldstPort" + i).innerHTML;
					var tmpDstPortEntry = tmpDstPort.split('~');
					tmpDstPortStart = tmpDstPortEntry[0];
					tmpDstPortEnd =  tmpDstPortEntry[1];
					tmpSchedule = document.getElementById("lblschecule" + i).innerHTML;
				}
			}
		} 
		else if ( rml.checked == true ) {
				editId = rml.value
				lst = rml.value;
				hasChecked = true;
				i = 0;
				tmpName = document.getElementById( "lblName" + i).innerHTML;
				tmpSrcAddr = document.getElementById("lblsrcAddr" + i).innerHTML;
				tmpSrcWan = document.getElementById("lblsrcWanIf" + i).innerHTML;
				tmpSrcProto = document.getElementById("lblSrcProtocol" + i).innerHTML;
				tmpDstAddr = document.getElementById("lbldstAddr" + i).innerHTML;
				var tmpDstPort = document.getElementById("lbldstPort" + i).innerHTML;
				var tmpDstPortEntry = tmpDstPort.split('~');
				tmpDstPortStart = tmpDstPortEntry[0];
				tmpDstPortEnd =  tmpDstPortEntry[1];
				tmpSchedule = document.getElementById("lblschecule" + i).innerHTML;
		}			
	}

	if (!hasChecked) {
		alert ("Please select an item to edit!");
		 doEdit = false;
		 editId = '';
		return;
	}
	if(checkedCount > 1) {
		alert ("Please select only 1 item to edit!");
		 doEdit = false;
		 editId = '';
		return;
	}

    with ( document.forms[0] ) {
		document.getElementById("fwRuleInfo").style.display = 'block';
		addFwrule.disabled = 1;
		editFwrule.disabled = 1;
		rmFwrule.disabled = 1;
		fwrulename.disabled = 1;
		fwrulename.value = tmpName;
		srcAddr.value = tmpSrcAddr;
		destAddr.value = tmpDstAddr;
		dstPortStart.value = tmpDstPortStart;
		dstPortEnd.value = tmpDstPortEnd;
		iptscheditem.value = tmpSchedule;
		for(i = 0; i < srcWanIf.length; i++)
		{
			if (srcWanIf[i].value == tmpSrcWan){
				srcWanIf.selectedIndex = i;
				break;
			}
		}
		for(i = 0; i < srcProtocol.length; i++)
		{
			if (srcProtocol[i].value == tmpSrcProto){
				srcProtocol.selectedIndex = i;
				break;
			}
		}
		
	doEdit = true;
	}

}

function removeClick(rml) {
	var lst = '';
	var has_selected_items = false;
	var i = 0;
   with ( document.forms[0] )
   {
	    if (rml)
	  	{
			if (rml.length > 0)
			{
		    	for (i = 0; i < rml.length; i++) 
				{
		        	if ( rml[i].checked == true )
					{
						has_selected_items=true;
		            	lst += rml[i].value + ', ';
					}
		      	}
			}
			else if ( rml.checked == true )
			{
					has_selected_items=true;
			      	lst = rml.value;
			}
		}
	}

	if (has_selected_items){
   		var loc = 'ipv6_firewall.cmd?action=remove&rmLst=' + lst;
		var code = 'location="' + loc + '"';
   		eval(code);
	} else{
		alert("There are no items to remove!");
		return;
	}
}

// done hiding -->
      </script>
   <script language="JavaScript" src="menu.js"></script>
   </head>
<body>
<blockquote>
<script language="JavaScript">
TabHeader="Advanced";
SideItem="IPv6 Firewall";
HelpItem="ipv6firewall";
</script> 
<script type='text/javascript'>
	mainTableStart();	
	logo();
	TopNav();
	ThirdRowStart();
	Write_Item_Images();
	mainBodyStart();
</script><form>
	<table id=box_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				IPv6 FIREWALL
			</td>										
		</tr>
		<tr>
			<td class=content>
			<p>The Firewall settings section is an advance feature used to allow or deny traffic from passing
			through the device. It works in the same way as ip filters with additional settings. You
			can create more detail rules for the device.</p>
			</td>
		</tr>
	</table>
	<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>Active Firewall Rules</td>
		</tr>
		<tr>
			<td class=content>
			<div class=overflow>
			<table class=formlisting rules="none">
			   <tr class=form_label_row>
			      <td class='form_label_col'>&nbsp;</td>
			      <td class='form_label_col'>Name</td>
			      <td class='form_label_col'>Src.  Addr Range</td>
			      <td class='form_label_col'>Use Interface</td>
			      <td class='form_label_col'>Src Protocol</td>
			      <td class='form_label_col'>Dest. Addr Range</td>
			      <td class='form_label_col'>Dest. Port</td>
			      <td class='form_label_col'>Schedule Rule</td>
			   </tr>
<script language="javascript">   

for (i = 0; i < entryNum; i++)
{
      document.writeln("<tr><td align='center'><input type='checkbox' name='rml' value='" + rule[i].fwname + "'></td>");
    document.writeln('<td><div align=center id=lblName'+i+'>'+rule[i].fwname+'</div></td>');  
    document.writeln('<td><div align=center id=lblsrcAddr'+i+'>'+rule[i].srcAddr+'</div></td>'); 
    document.writeln('<td><div align=center id=lblsrcWanIf'+i+'>'+rule[i].srcWanIf+'</div></td>');
	if(rule[i].srcProto == 'TCP')
    	document.writeln('<td><div align=center'+i+'>TCP<label id=lblSrcProtocol'+i+' style="display:none">0</label></div></td>');  
	else if(rule[i].srcProto == 'UDP')
    	document.writeln('<td><div align=center'+i+'>UDP<label id=lblSrcProtocol'+i+' style="display:none">1</label></div></td>');  
	else if(rule[i].srcProto == 'TCP or UDP')
    	document.writeln('<td><div align=center'+i+'>TCP/UDP<label id=lblSrcProtocol'+i+' style="display:none">2</label></div></td>');  
	else if(rule[i].srcProto == 'ICMP')
		document.writeln('<td><div align=center'+i+'>ICMP<label id=lblSrcProtocol'+i+' style="display:none">3</label></div></td>');  
    document.writeln('<td><div align=center id=lbldstAddr'+i+'>'+rule[i].dstAddr+'</div></td>'); 
    document.writeln('<td><div align=center id=lbldstPort'+i+'>'+rule[i].dstPortStart + '~' + rule[i].dstPortEnd +'</div></td>'); 	
     document.writeln('<td><div align=center id=lblschecule'+i+'>'+rule[i].schedule+'</div></td>'); 
}

</script>				   
	   		</table>
   			</div>
			</td>
		</tr>
	<br>
	<br>
</table>

<p align=center><input type='button' id=addFwrule onClick='addClick()' value='Add' class='btn'>
<input type='button' id=editFwrule onClick='btnEdit(this.form.rml)' value='Edit' class='btn'>
<input type='button' id=rmFwrule onClick='removeClick(this.form.rml)' value='Delete' class='btn'>
</p>
<div id=fwRuleInfo style="display:none;">
	<table id=body_header border=0 cellSpacing=0>
		<tr>
			<td class=topheader>
				IPV6 Firewall Rule
			</td>										
		</tr>
		<tr>
			<td class=content>
            <table class=formarea>
               <tr>
                  <td class=form_label>Rule Name&nbsp;:</td>
                  <td><input type='text' size="22" maxlength="12" name="fwrulename"></td>
               </tr>
			<tr>
			<td class=form_label>Schedule&nbsp;:</td>
			<td><select name="iptscheditem">
			<option value="Always">Always</option>
<SCRIPT language=javascript>
			function rVe(nm){   this.name = nm;}  
			var tods = '<%ejGetTod(name)%>';//tods = 'aaa|';
			var ts = tods.split('|');
			var tNum = ts.length - 1;
			var t = new Array(tNum);
			for (i = 0; i < tNum; i++)	t[i] = new rVe(ts[i]);
					
			for (i = 0; i< tNum; i++){
				document.write('<OPTION value='+t[i].name+'>' + t[i].name + '</OPTION>');
			}
</SCRIPT>
			<option value="Never">Never</option></select>&nbsp;&nbsp;
			<a href="iptschedadd.html">View Available Schedules</a></td>
			</tr>
               <tr>
                  <td class=form_label>Source Address Range&nbsp;:</td>
                  <td><input type='text' size="22" maxlength="64" name="srcAddr"></td>
               </tr>
               <tr>
                  <td class=form_label>Use Interface&nbsp;:</td>
                  <td>
			         <script language="javascript"> 
                     document.write("<select name='srcWanIf' style='width:100'>")
               
	                  var i = 0;
	                  var interfaceInfo = '<%ejGetOther(wanInterfaceInfo, wan6)%>';
	                  var interfaces = interfaceInfo.split('|');
	               
	                  for ( i = 0; i < interfaces.length; i++ ) {
	                     var names = interfaces[i].split('/');
	                     document.write("  <option value='" + names[1] + "'>");
	                     document.writeln(interfaces[i]);
	                  }     
                     document.write("</select>");
					</script>
				</td>
               </tr>
               <tr>
                  <td class=form_label>Protocol&nbsp;:</td>
                  <td><select name='srcProtocol' size="1">
                        <option value="4">(Click to select)
                        <option value="0">
                        TCP
                        <option value="1">
                        UDP
                        <option value="2">
                        TCP/UDP
                        <option value="3">
                        ICMP
                        </select></td>
               </tr>
               </table>
      		</td>
		</tr>
		<tr>
			<td class=content>
            <table class=formarea>
               <tr>
                  <td class=form_label>Dest Address Range&nbsp;:</td>
                  <td><input type='text' size="22" maxlength="64" name="destAddr"></td>
               </tr>
               <tr>
                  <td class=form_label>Dest Port Range&nbsp;:</td>
                  <td><input type='text' size="6" maxlength="5" name="dstPortStart">~&nbsp;&nbsp;<input type='text' size="6" maxlength="5" name="dstPortEnd"></td>
               </tr>               
               </table>
      		</td>
		</tr>		
	</table>
	
<p align=center><input type='button' onClick='btnApply()' value='Apply'>
<input type='button' onClick='btnCancel()' value='Cancel'></p>
</div>
</form>
<script type='text/javascript'>
	mainBodyEnd();
	ThirdRowEnd();
	Footer()
	mainTableEnd()
</script>
</blockquote>
   </body>
</html>



