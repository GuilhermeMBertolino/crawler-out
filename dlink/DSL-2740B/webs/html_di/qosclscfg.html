<html><head>
<link rel=stylesheet href='stylemain.css' type='text/css'>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<script language="javascript" src="portName.js"></script>
<script language="javascript" src="util.js"></script>
<script language='JavaScript' src='menu.js'></script>
<script language='javascript'>
<!-- hide
var enableTc = '<%ejGetOther(sysInfo, enblTc)%>';
var glbDisplayPhysicalPort = false;
var QoSClassinfo = '<%ejGetOther(qosClass,className)%>';
var FWmodelname = '<%ejGet(modelName)%>';
var buildQosPrioByTos='';
var queueInfo = '<%ejGetOther(qosqueueInfo, all)%>';
var queues  = queueInfo.split('|');
var rateLimit = '1';

if (document.getElementById) onload = function () {
/*
   var i, a;

   if (document.getElementById) {
   for(i=0; (a = document.getElementsByTagName('tr')[i]); i++) {
      if ((/SrcMacAddr/i.test(a.id)) ||
          (/SrcMacMask/i.test(a.id)) ||
          (/DstMacAddr/i.test(a.id)) ||
          (/DstMacMask/i.test(a.id)) ||
          (/DscpMark/i.test(a.id))) {
         a.style.display = 'none';
      } else
         a.style.display = '';
   }
   	}
    //tblItmIpPreRule.style.display = 'none';
    //tblItmIpTosRule.style.display = 'none';
*/  
}

function hideAllElements()
{
   showhide("etype", 0);
   showhide("etype_route", 0);
   showhide("smac", 0);
   showhide("dmac", 0);
   showhide("eth_ip", 0);
   showhide("dscpcheck", 0);
   showhide("proto4", 0);
   showhide("proto6", 0);
   showhide("tcp_udp_port", 0);
   showhide("eth_8021q", 0);
   showhide("mark_8021p", 0);
   showhide("tag_vlanid", 0);
   showhide("rate_control", 0);
}

function changeSelect(OnPageLoad) 
{
   with ( document.forms[0] ) {
      var ifc     = getSelect(classIfc);
      var clsIntf = ifc.split('/');
      var proto;
	  
      hideAllElements();
	  
      if (ifc == 'Local') {
         showhide("etype_route", 1);
         showhide("dscpcheck", 1);
         showhide("proto4", 1);
         proto = getSelect(protocol4);
         if (proto == '6' || proto == '17')
            showhide("tcp_udp_port", 1);
      }
     else if (ifc.indexOf('wlan') != -1)
      {
       //   showhide("dscpmark", 1);
      }
      else if (ifc == 'WAN' || ifc.indexOf('ro') != -1) {
         showhide("etype_route", 1);
         showhide("smac", 1);
         showhide("eth_ip", 1);
         showhide("dscpcheck", 1);
         showhide("proto4", 1);
         proto = getSelect(protocol4);
         if (proto == '6' || proto == '17')
            showhide("tcp_udp_port", 1);
         
         //This is a WAN interface. Only show selection for source ip address.
         ipoptionlist.length = 1;
         ipoptionlist.selectedIndex = 0;
      }
      else {
         var type  = getSelect(ethtype);

         showhide("etype", 1);
         // for now, we always show mark_8021p and tag_vlanid even if the
         // queue interface is not vlan enabled.  This is to support
         // vlan pass-through frame remarking.
         showhide("mark_8021p", 1);
         showhide("tag_vlanid", 1);

         //show adequate forms for each mode
         switch (type) {
         case '800':
            showhide("smac", 1);
            showhide("dmac", 1);
            showhide("eth_ip", 1);
            showhide("dscpcheck", 1);
            showhide("proto4", 1);
            proto = getSelect(protocol4);
            if (proto == '6' || proto == '17')
               showhide("tcp_udp_port", 1);
            break;
         case '86DD':
            showhide("smac", 1);
            showhide("eth_ip", 1);
            showhide("dscpcheck", 1);
            showhide("proto6", 1);
            proto = getSelect(protocol6);
            if (proto == '6' || proto == '17')
               showhide("tcp_udp_port", 1);
            break;
         case '8100':
            showhide("eth_8021q", 1);
            break;
         default:
            showhide("smac", 1);
            showhide("dmac", 1);
            break;
         }

         //If this is a WAN interface, only show selection for source ip address.
         if (ifc.indexOf('br') != -1) {
            ipoptionlist.length = 1;
            ipoptionlist.selectedIndex = 0;
         }
         else {
            //Show selections for src ip, opt60 and opt77
            ipoptionlist.length = 3;
            ipoptionlist.options[1].value = 1;
            ipoptionlist.options[1].text  = "Vendor Class ID (DHCP Option 60)";
            ipoptionlist.options[2].value = 2;
            ipoptionlist.options[2].text  = "User Class ID (DHCP option 77)";
         }
      }

      //adjust the queuekey select list.
      queuekey.length = queues.length + 1;
      for ( i = 0, j = 1; i < queues.length; i++ ) {
         if (queues[i] != '') {
            var info = queues[i].split(':');

            //do not support wan to wan traffic classification
            //if ifc is wan interface, exclude wan interface queues.
            if ((ifc == 'WAN' || ifc.indexOf('br') != -1 || ifc.indexOf('ro') != -1) &&
                (info[1].indexOf('wan') != -1 || info[1].indexOf('atm') != -1 || info[1].indexOf('ptm') != -1))
               continue;
          var itfc;
	   if (info[1].indexOf('eth') != -1)
	   {
	       itfc = info[1].replace('eth','lan');
	   
	   }
           if (info[1].indexOf('ath') != -1&&!(info[1].indexOf('wan') != -1 || info[1].indexOf('atm') != -1 || info[1].indexOf('ptm') != -1
		   	|| info[1].indexOf('ppp') != -1))
            {
             continue;
            }
            //exclude interface queues on the class interface
			/*
            if (clsIntf[0] != '' && info[1].indexOf(clsIntf[0]) != -1)
               continue;
*/
	  
            queuekey.options[j].value = info[0];
            queuekey.options[j].text  = info[1];
            j++;
         }
      }
      queuekey.length = j;
      queuekey.selectedIndex = 0;
   }
}

function changeSelect2(OnPageLoad) 
{
   with ( document.forms[0] ) {
      var ifc   = getSelect(classIfc);

      if (ifc != 'Local' && ifc != 'WAN' && ifc.indexOf('br') == -1 && ifc.indexOf('ro') == -1) {
         var qkey  = getSelect(queuekey);

         for ( i = 0; i < queues.length; i++ ) {
            if (queues[i] != '') {
               var info = queues[i].split(':');

               if (qkey == info[0]) {
                  if (info[1].indexOf('wan') != -1 || info[1].indexOf('atm') != -1 || info[1].indexOf('ptm') != -1)
                     showhide("rate_control", 1);
                  else
                     showhide("rate_control", 0);

// for now, we always show mark_8021p and tag_vlanid even if the
// queue interface is not vlan enabled.  This is to support
// vlan pass-through frame remarking.
//                  if (info[2] == '1') {
//                     showhide("mark_8021p", 1);
//                     showhide("tag_vlanid", 1);
//                  }
//                  else {
//                     showhide("mark_8021p", 0);
//                     showhide("tag_vlanid", 0);
//                  }
                  break;
               }
            }
         }
      }
   }
	return;

   with ( document.forms[0] ) {
      var ifc   = getSelect(classIfc);

      if (ifc != 'Local' && ifc != 'WAN' && ifc.indexOf('br') == -1 && ifc.indexOf('ro') == -1) {
         var qkey  = getSelect(queuekey);

         showhide("mark_8021p", 0);
         showhide("tag_vlanid", 0);
         for ( i = 0; i < queues.length; i++ ) {
            if (queues[i] != '') {
               var info = queues[i].split(':');

               if (qkey == info[0]) { 
                  if (info[2] == '1') {
                     showhide("mark_8021p", 1);
                     showhide("tag_vlanid", 1);
                  }
                  break;
               }
            }
         }
      }
   }
}

function frmLoad() {
   hideAllElements();
   showhide("etype", 1);
   showhide("smac", 1);
   showhide("dmac", 1);
   // for now, we always show mark_8021p and tag_vlanid even if the
   // queue interface is not vlan enabled.  This is to support
   // vlan pass-through frame remarking.
   showhide("mark_8021p", 1);
   showhide("tag_vlanid", 1);
}

function btnApply() {
   var loc = 'qoscls.cmd?action=add&isWired=1';

   with ( document.forms[0] ) {

      // Clean up un-applicable parameters
      if (classIfc.options[classIfc.selectedIndex].value == 'Local') {
         ethtype.selectedIndex = 0;
         srcmacaddr.value = "";
         srcmacmask.value = "";
         dstmacaddr.value = "";
         dstmacmask.value = "";
         srcaddr.value = "";
         dstaddr.value = "";
         vlan8021p.selectedIndex = 0;
         wanVlan8021p.selectedIndex = 0;
         wanVlanID.value = "";
         if ( enableTc == '1' )
            txtrate.value = "";
      }
      else if (classIfc.options[classIfc.selectedIndex].value == 'WAN' ||
               classIfc.options[classIfc.selectedIndex].value.indexOf('ro') != -1) {
         ethtype.selectedIndex = 0;
         srcmacmask.value = "";
         dstmacaddr.value = "";
         dstmacmask.value = "";
         vlan8021p.selectedIndex = 0;
         wanVlan8021p.selectedIndex = 0;
         wanVlanID.value = "";
         if ( enableTc == '1' )
            txtrate.value = "";
      }
      else {
         var qkey = getSelect(queuekey);

         ethtyperoute.selectedIndex = 0;

         idx = ethtype.selectedIndex;
         if (ethtype.options[idx].value == '800') {
            protocol6.selectedIndex = 0;
            vlan8021p.selectedIndex = 0;
         }
         else if (ethtype.options[idx].value == '86DD') {
            srcmacmask.value = "";
            dstmacaddr.value = "";
            dstmacmask.value = "";
            protocol4.selectedIndex = 0;
            vlan8021p.selectedIndex = 0;
         }
         else if (ethtype.options[idx].value == '8100') {
            srcmacaddr.value = "";
            srcmacmask.value = "";
            dstmacaddr.value = "";
            dstmacmask.value = "";
            srcaddr.value = "";
            dstaddr.value = "";
            protocol4.selectedIndex = 0;
            protocol6.selectedIndex = 0;
            dscpchk.selectedIndex = 0;
         }
         else {
            srcaddr.value = "";
            dstaddr.value = "";
            protocol4.selectedIndex = 0;
            protocol6.selectedIndex = 0;
            dscpchk.selectedIndex = 0;
            vlan8021p.selectedIndex = 0;
         }

         // for now, we always show mark_8021p and tag_vlanid even if the
         // queue interface is not vlan enabled.  This is to support
         // vlan pass-through frame remarking.
//         for ( i = 0; i < queues.length; i++ ) {
//            if (queues[i] != '') {
//               var info = queues[i].split(':');
//
//               if (qkey == info[0]) {
//                  if (info[2] != '1') {
//                     wanVlan8021p.selectedIndex = 0;
//                     wanVlanID.value = "";
//                  }
//                  break;
//               }
//            }
//         }
      }   

      idx4 = protocol4.selectedIndex;
      idx6 = protocol6.selectedIndex;
      if (protocol4.options[idx4].value != '6' && protocol4.options[idx4].value != '17' &&
          protocol6.options[idx6].value != '6' && protocol6.options[idx6].value != '17') {
         srcport.value = "";
         dstport.value = "";
      }

      // Sanity checks
      if ( txtclsname.value == '' ) {
         msg = 'Please enter QoS class name.';
         alert(msg);
         return;
      }
      if ( isValidName(txtclsname.value) == false ) {
         msg = 'Please enter valid QoS class name: No special characters.';
         alert(msg);
         return;
      }
      if (txtclsname.value.length > 15) {
         msg = 'Maximum QoS class name cannot exceed 15 characters.';
         alert(msg);
         return;
      }
      if ( queuekey.selectedIndex == 0 ) {
         msg = 'There is no selected classification queue.';
         alert(msg);
         return;
      }
      if ( wanVlanID.value != "" ) {
         var vlanid = parseInt(wanVlanID.value);
         if ( isNaN(vlanid) == true || vlanid < 0 || vlanid > 4094 ) {
            msg = 'vlan id "' + wanVlanID.value + '" is out of range [0-4094].';
            alert(msg);
            return;
         }
      }
      if (classIfc.selectedIndex == 0 &&
          ethtype.selectedIndex == 0 && srcmacaddr.value == "" && dstmacaddr.value == "") {
         msg = 'At least one criterion must be specified for unspecified ethertype.'
         alert(msg);
         return;
      }
      if ( enableTc == '1' ) {
         var rateNum = parseInt(txtrate.value);
         if ( txtrate.value != "" &&  (isNaN(rateNum) == true || rateNum < 1) ) {
            msg = 'Rate "' + txtrate.value + '" is invalid.';
            alert(msg);
            return;
         }
      }
      if ( ipoptionlist.selectedIndex == 0 && srcaddr.value != "" ) {
         var sa = srcaddr.value;
         var addrParts = sa.split('/');

         if ( addrParts.length > 2 ) {
            msg = 'Source address "' + srcaddr.value + '" is invalid.';
            alert(msg);
            return;
         }
         if ( addrParts[0] == "" ) {
            msg = 'Source address "' + srcaddr.value + '" is invalid.';
            alert(msg);
            return;
         }
         if ( ethtype.value == '800' || ethtyperoute.value == '800' ) {
            if ( isValidIpAddress(addrParts[0]) == false ) {
               msg = 'Source address "' + srcaddr.value + '" is invalid.';
               alert(msg);
               return;
            }
            if ( addrParts.length == 2 ) {
               num = parseInt(addrParts[1]);
               if ( num <= 0 || num > 32 ) {
                  msg = 'Source address "' + srcaddr.value + '" is invalid.';
                  alert(msg);
                  return;
               }
            }
         }
         else {
            if ( isValidIpAddress6(addrParts[0]) == false ) {
               msg = 'Source address "' + srcaddr.value + '" is invalid.';
               alert(msg);
               return;
            }
            if ( addrParts.length == 2 ) {
               num = parseInt(addrParts[1]);
               if ( num <= 0 || num > 128 ) {
                  msg = 'Source address "' + srcaddr.value + '" is invalid.';
                  alert(msg);
                  return;
               }
            }
         }
      }
      if ( srcport.value != "" && isValidPort(srcport.value) == false ) {
         msg = 'Source port "' + srcport.value + '" is invalid port number or port range.';
         alert(msg);
         return;
      }
      if ( dstaddr.value != "" ) {
         var da = dstaddr.value;
         var addrParts = da.split('/');

         if ( addrParts.length > 2 ) {
            msg = 'Destination address "' + dstaddr.value + '" is invalid.';
            alert(msg);
            return;
         }
         if ( addrParts[0] == "" ) {
            msg = 'Destination address "' + dstaddr.value + '" is invalid.';
            alert(msg);
            return;
         }
         if ( ethtype.value == '800' || ethtyperoute.value == '800' ) {
            if ( isValidIpAddress(addrParts[0]) == false ) {
               msg = 'Destination address "' + dstaddr.value + '" is invalid.';
               alert(msg);
               return;
            }
            if ( addrParts.length == 2 ) {
               num = parseInt(addrParts[1]);
               if ( num <= 0 || num > 32 ) {
                  msg = 'Destination address "' + dstaddr.value + '" is invalid.';
                  alert(msg);
                  return;
               }
            }
         }
         else {
            if ( isValidIpAddress6(addrParts[0]) == false ) {
               msg = 'Destination address "' + dstaddr.value + '" is invalid.';
               alert(msg);
               return;
            }
            if ( addrParts.length == 2 ) {
               num = parseInt(addrParts[1]);
               if ( num <= 0 || num > 128 ) {
                  msg = 'Destination address "' + dstaddr.value + '" is invalid.';
                  alert(msg);
                  return;
               }
            }
         }
      }
      if ( dstport.value != "" && isValidPort(dstport.value) == false ) {
         msg = 'Destination port "' + dstport.value + '" is invalid port number or port range.';
         alert(msg);
         return;
      }
      if ( srcmacaddr.value != "" && isValidMacAddress(srcmacaddr.value) == false ) {
         msg = 'Source MAC address "' + srcmacaddr.value + '" is invalid.';
         alert(msg);
         return;
      }
      if ( srcmacmask.value != "" && isValidMacMask(srcmacmask.value) == false ) {
         msg = 'Source MAC address mask "' + srcmacmask.value + '" is invalid.';
         alert(msg);
         return;
      }
      if ( srcmacaddr.value == "" && srcmacmask.value != "" ) {
         msg = 'Cannot have source MAC mask without source MAC address.';
         alert(msg);
         return;
      }
      if ( dstmacaddr.value != "" && isValidMacAddress(dstmacaddr.value) == false ) {
         msg = 'Destination MAC address "' + dstmacaddr.value + '" is invalid.';
         alert(msg);
         return;
      }
      if ( dstmacmask.value != "" && isValidMacMask(dstmacmask.value) == false ) {
         msg = 'Destination MAC address mask "' + dstmacmask.value + '" is invalid.';
         alert(msg);
         return;
      }
      if ( dstmacaddr.value == "" && dstmacmask.value != "" ) {
         msg = 'Cannot have destination MAC mask without destination MAC address.';
         alert(msg);
         return;
      }

      // class name
      loc += '&clsName=' + encodeUrl(txtclsname.value);

      // rule order
      loc += '&rulsOrder=' + rulsorder.options[rulsorder.selectedIndex].value

      // rule status
      loc += '&rulsEnbl=' + rulsenbl.options[rulsenbl.selectedIndex].value;

      // physical lan port ifc name
      val = classIfc.options[classIfc.selectedIndex].value.split('/');
    //  var itfc;	 
	// if (val[0].indexOf('lan') != -1)
	// {
	//   itfc = val[0].replace('lan','eth');
	   
	 //}
     //   if (val[0].indexOf('wlan') != -1)
       // {
      //        itfc = val[0].replace('wlan','ath');
     //    }
      loc += '&classIf=' + val[0];
      // ether type
      if ( classIfc.options[classIfc.selectedIndex].value == 'Local' ||
           classIfc.options[classIfc.selectedIndex].value == 'WAN'   ||
           classIfc.options[classIfc.selectedIndex].value.indexOf('ro') != -1)
         loc += '&ethertype=' + ethtyperoute.options[ethtyperoute.selectedIndex].value;
      else if ( ethtype.selectedIndex > 0 )
         loc += '&ethertype=' + ethtype.options[ethtype.selectedIndex].value;

      // source MAC address
      if ( srcmacaddr.value != "" )
         loc += '&srcMacAddr=' + srcmacaddr.value;

      // destination MAC address
      if ( dstmacaddr.value != "" )
         loc += '&dstMacAddr=' + dstmacaddr.value;

      // source MAC mask
      if ( srcmacmask.value != "" )
         loc += '&srcMacMask=' + srcmacmask.value;

      // destination MAC mask
      if ( dstmacmask.value != "" )
         loc += '&dstMacMask=' + dstmacmask.value;

      // source address
      if ( srcaddr.value != "" ) {
         loc += '&ipoptionlist=' + ipoptionlist.selectedIndex;
         loc += '&srcAddr=' + srcaddr.value;
      }

      // destination address
      if ( dstaddr.value != "" )
         loc += '&dstAddr=' + dstaddr.value;

      // protocol
      if ( protocol4.selectedIndex > 0 )
         loc += '&protocol=' + protocol4.options[protocol4.selectedIndex].value;
      else if ( protocol6.selectedIndex > 0 )
         loc += '&protocol=' + protocol6.options[protocol6.selectedIndex].value;

      // source port
      if ( srcport.value != "" )
         loc += '&srcPort=' + srcport.value;

      // destination port
      if ( dstport.value != "" )
         loc += '&dstPort=' + dstport.value;

      // dscp check
      if ( dscpchk.selectedIndex > 0 )
         loc += '&dscpCheck=' + dscpchk.options[dscpchk.selectedIndex].value;

      // 8021p priority check
      loc += '&vlan8021p=' + vlan8021p.options[vlan8021p.selectedIndex].value;

      // queuekey
      loc += '&queuekey=' + queuekey.options[queuekey.selectedIndex].value;

      // egress interface
      val = queuekey.options[queuekey.selectedIndex].text.split('&');
      
  
	// if (val[0].indexOf('lan') != -1)
	// {
	 //  itfc = val[0].replace('lan','eth');
	   
	// }
      //   if (val[0].indexOf('wlan') != -1)
       //  {
         //     itfc = val[0].replace('wlan','ath');
         //}
		
	loc += '&egress=' + val[0];
      // dscp mark
      loc += '&dscpMark=' + dscp.options[dscp.selectedIndex].value;

      // VLAN id tagging
      if ( wanVlanID.value != "" )
         loc += '&wanVlanID=' + wanVlanID.value;
	  
      // WAN 802.1p priority mark
      loc += '&wanVlan8021p=' + wanVlan8021p.options[wanVlan8021p.selectedIndex].value;

      // rate control
      if ( enableTc == '1' ) {
         if ( txtrate.value != "" ) {
            loc += '&rate=' + txtrate.value;
         }
      }
   }
   loc += '&sessionKey=<%ejGetOther(sessionKey)%>';
   var code = 'location="' + loc + '"';
   eval(code);
}

function btnCancel() {
    with ( document.forms[0] ) {
		qosInfo.style.display = 'none';
		removeQos.disabled = 0;
		addQos.disabled = 0;
		//editQos.disabled = 1;
		//clearFields();
	}
}

function addClick() {
	hideAllElements();
    showhide("etype", 1);
    showhide("smac", 1);
    showhide("dmac", 1);
    // for now, we always show mark_8021p and tag_vlanid even if the
    // queue interface is not vlan enabled.  This is to support
    // vlan pass-through frame remarking.
    showhide("mark_8021p", 1);
    showhide("tag_vlanid", 1);
	
	var num = '<%ejGetOther(qosClass,qosNum)%>';
	if (parseInt(num) == 16)
	{
		alert("The maximum number of qos class item is 16.");
		return;
	}
    with ( document.forms[0] ) {
		qosInfo.style.display = 'block';
		removeQos.disabled = 1;
		addQos.disabled = 1;
		//editQos.disabled = 1;
	}
}

function enableClick(ebl) {
	   var lst = '';

		if (ebl.checked == true) {
              lst += '&className='+ebl.value+'&enbl=1';
      } else {
              lst += '&className='+ebl.value+'&enbl=0';
		}

      var loc = 'qoscls.cmd?action=enable' + lst;
      var code = 'location="' + loc + '"';
      eval(code);
}

function removeClick(rml) {
        var lst = '';
        var has_selected_items = false;
        var i,j;

        with ( document.forms[0] ) {
                if (rml)
                {
                        if (rml.length > 0)
                        {
                                for (i = 0; i < rml.length; i++) 
                                {
                                        if ( rml[i].checked == true )
                                        {
                                        	has_selected_items=true;
                                                lst = lst + rml[i].value + ',';
                                        }
                                }
                        }
                        else {
                                if ( rml.checked == true )
                                {
                                        has_selected_items=true;
                                        lst = lst + rml.value + ',';
                                }
                        }
                }
        }
        if (has_selected_items)
        {
                var loc = 'qoscls.cmd?action=remove&rmLst=' + lst;
                
                var code = 'location="' + loc + '"';
                eval(code);
        }
        else
        {
                alert("There is no item selected!")
                return;
        }
}
// done hiding -->
</script>
</head>
<body onload='frmLoad()'>



<blockquote>

<script language='JavaScript'>
TabHeader="Advanced";
SideItem="Network Tools";
HelpItem="";
</script> 
<script type='text/javascript'>
	mainTableStart();	
	logo();
	TopNav();
	ThirdRowStart();
	Write_Item_Images();
	mainBodyStart();
</script>
<form>
	<table id=box_header width="690" border=0 cellSpacing=0>
		<tr>
			<td class=topheader>QoS</td>		
		</tr>
		<tr>
		<td class=content>
		<p>Choose Add or Remove to configure network traffic classes.</p>
		<p>The screen creates a traffic class rule to classify the upstream traffic, assign queue which defines the precedence and the interface and optionally overwrite the IP header DSCP byte. A rule consists of a class name and at least one condition below. All of the specified conditions in this classification rule must be satisfied for the rule to take effect. Click 'Apply/Save' to save and activate the rule. .</p>
		<p><b>Note: <a href="qosqueuecfg.html">QoS Queues</a> should be set firstly for the traffic class rules.</b></p>
		</td></tr>
	</table>
	<table id=body_header width="690" border=0 cellSpacing=0>
		<tr>
		   <td class=topheader>Quality of Service Setup -- A maximum 32 entries can be configured.</td>
		</tr>
		<tr>
		   <td class=content>
			Choose Add or Remove to configure network traffic classes.<br>
			If you disable WMM function in Wireless Page, classification related to wireless will not take effects<br>
	
<div class=overflow>
  <table class=formlisting>
    <tr class=form_label_row>
      	<td class='form_label_col' colspan='1'>&nbsp;</td>
	<td class='form_label_col' colspan='11'><center>CLASSIFICATION CRITERIA</center></td>
	<script language="javascript">
	<!-- hide
		if (rateLimit == '1')
			document.write("  <td class='form_label_col' colspan='5'><center>CLASSIFICATION RESULTS</center></td>");
		else
			document.write("  <td class='form_label_col' colspan='4'><center>CLASSIFICATION RESULTS</center></td>");
	-->
	</script>
	<td class='form_label_col' colspan='2'>&nbsp;</td>
    </tr>
    <tr class=form_label_row>
	<td class='form_label_col'>Class Name</td>
	<td class='form_label_col'>Order</td>
	<td class='form_label_col'>Class Intf</td>	
	<td class='form_label_col'>Ether Type</td>
	<td class='form_label_col'>SrcMAC/ Mask</td>
	<td class='form_label_col'>DstMAC/ Mask</td>
	<td class='form_label_col'>SrcIP/ PrefixLength</td>
	<td class='form_label_col'>DstIP/ PrefixLength</td>
	<td class='form_label_col'>Proto</td>
	<td class='form_label_col'>SrcPort</td>
	<td class='form_label_col'>DstPort</td>
	<td class='form_label_col'>DSCP Check</td>
	<td class='form_label_col'>802.1P Check</td>
	<td class='form_label_col'>Queue Key</td>
	<td class='form_label_col'>DSCP Mark</td>
	<td class='form_label_col'>802.1P Mark</td>
	<td class='form_label_col'>VlanID Tag</td>
	<script language="javascript">
	<!-- hide
		if (rateLimit == '1')
			document.write("  <td class='form_label_col'><center>Rate Control(kbps)</center></td>");
	-->
	</script>
	<td class='form_label_col'>Enable</td>
	<td class='form_label_col'>Remove</td>
   </tr>
<script language="javascript">   
MAX_ENTRY = 8;
var qosgs = "<%ejGetOther(qosClass,qosG)%>";//qosgs = "test,2,5,8,34|sheet,1,2,16,22|";
var gs = qosgs.split('|');
var gNum = gs.length - 1;
var rule = new Array(MAX_ENTRY);
for (i = 0; i < MAX_ENTRY; i++)	rule[i] = new rVe('','','','','');

for (j = 0; j < gNum; j++)
{
	var g = gs[j].split(',');
	rule[j] = new rVe(g[0], g[1], g[2], g[3], g[4], g[5], g[6], g[7], g[8], g[9], g[10], g[11], g[12], g[13], g[14], g[15], g[16], g[17], g[18]);
}

function rVe(clsName, order, intf, ethType, srcMac, dstMac, srcIP, dstIP, proto, srcPort, dstPort, dscpC, check8021P, queueKey, dscpM, mark8021P, vlanID, rate, enbl)
{
   this.clsName = clsName;   this.order = order; this.intf = intf;   this.ethType = ethType;   this.srcMac = srcMac;
   this.dstMac = dstMac;   this.srcIP = srcIP;   this.dstIP = dstIP; this.proto = proto;   this.srcPort = srcPort;   this.dstPort = dstPort;   
   this.dscpC = dscpC;   this.check8021P = check8021P;   this.queueKey = queueKey;   this.dscpM = dscpM;   this.mark8021P = mark8021P;   
   this.vlanID = vlanID;   this.rate = rate;   this.enbl = enbl; 
}

for (i = 0; i < gNum; i++)
{
document.writeln('<tr>');
document.writeln('<td><div align=center>'+ rule[i].clsName+'</div></td>');	
document.writeln('<td><div align=center>'+ rule[i].order+'</div></td>');	
document.writeln('<td><div align=center>'+ rule[i].intf + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].ethType + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].srcMac + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].dstMac + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].srcIP + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].dstIP + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].proto + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].srcPort + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].dstPort + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].dscpC + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].check8021P + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].queueKey + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].dscpM + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].mark8021P + '</div></td>');
document.writeln('<td><div align=center>'+ rule[i].vlanID + '</div></td>');
if (rateLimit == '1')
   document.writeln('<td><div align=center>'+ rule[i].rate + '</div></td>');
if (rule[i].enbl == '1') {
   document.writeln('<td><div align=center><input type=checkbox name=enbl value=\'' + rule[i].clsName +'\' onclick=\'enableClick(this)\' checked></div></td>');	
} else {
   document.writeln('<td><div align=center><input type=checkbox name=enbl value=\'' + rule[i].clsName +'\' onclick=\'enableClick(this)\'></div></td>');	
}
document.writeln('<td><div align=center><input type=checkbox name=rml value=\'' + rule[i].clsName +'\'></div></td>');	
document.writeln('</tr>');   
}

</script>				
</table><br>
<br>
</div>
</td>
</tr>
</table>

<p align=center>
<input type='button' onClick='addClick()' value='Add' id='addQos'>
<input type='button' onClick='removeClick(this.form.rml)' value='Remove' id='removeQos'>
</p>

<div id=qosInfo style="display:none;">
<table id=body_header border=0 cellSpacing=0>
	<tr>
	<td class=topheader>Add Network Traffic Class Rule</td>
	</tr>
	<tr>
	<td class=content><br>
      The screen creates a traffic class rule to classify the upstream traffic, 
      assign queue which defines the precedence and the interface and optionally 
      overwrite the IP header DSCP byte. 
      A rule consists of a class name and at least one condition below. All of 
      the specified conditions in this classification rule must be satisfied for 
      the rule to take effect. Click 'Apply/Save' to save and activate the rule. 
      <br>
	 <table id="qosClsSts" cellSpacing="0" cellPadding="0" border="0"><br>
            <tr>
	       	<td class=form_label>Traffic Class Name: &nbsp;</td>
	       	<td><input type="text" size="22" name="txtclsname"  maxlength="15"></td>
	    </tr>

      <tr>
        <td>Rule Order:</td>
        <td><select size="1" name="rulsorder">
<script language="javascript">
<!-- hide
{
   var i = 0;
   var order;
   var queueclsRulsOrder = '<%ejGetOther(qosclsRulsOrder, all)%>';
   var rules = queueclsRulsOrder.split('|');
   rules.sort();
   for ( i = 0; i < rules.length; i++ )
   {
      order = i + 1;
      if (rules[i] == 'Last')
      {
         document.write("  <option value='" + order + "' selected> ");
	     document.write(rules[i]);
         document.writeln("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
      }
	  else if (rules[i] != '') 
      {
         document.write("  <option value='" + order + "'> ");
         document.writeln(rules[i]);
	  }
   }
}
// done hiding -->
</script>
         </option></select></td>
      </tr>	  
       <tr>
        	<td width="360">Rule Status:</td>
        	<td><select size="1" name='rulsenbl'>
	            <option value="0"> Disable
	            <option value="1"> Enable
	            </option></select></td>
	   </tr>
         </table>

	<p><b>Specify Classification Criteria</b><br>
    	A blank criterion indicates it is not used for classification.</p>                     
<!--	<table id="qosClsCriteria" cellSpacing="0" cellPadding="0" border="0"><br>
       <tr id="phyIfc"> 
	       <td width="360">Physical LAN Port:</td>
           <td><select size='1' name='classIfc' onChange='changeSelect(0)'>
		   <option value='' selected>
         <script language="javascript">
         <!-- hide
         {
            var i = 0;
            var qosIntf = '<%ejGetOther(qosIntf, all)%>';
            var intf = qosIntf.split('|');
            intf.sort();
            for ( i = 0; i < intf.length; i++ ) {
               if (intf[i] != '') {
                  if (intf[i].indexOf('usb') != -1)
                     continue;      // skip usb ifc
                  if (intf[i].indexOf('nas_') != -1)
                     continue;      // skip usb ifc
                  if (intf[i].indexOf('atm') != -1)
                     continue;      // skip usb ifc
                  if (intf[i].indexOf('ptm') != -1)
                     continue;      // skip usb ifc
                  if (intf[i].indexOf('ppp') != -1)
                     continue;      // skip usb ifc
                  document.writeln("  <option value='" + intf[i] + "'>" + intf[i]);
               }
            }
         }
	// done hiding -->  <!--
	</script>
	</option></select></td>
	</tr>
	</table>-->
	    <table cellSpacing="0" cellPadding="0" border="0">
	      <tr>
	        <td width='360'>Class Interface:</td>
	        <td><select size='1' name='classIfc' onChange='changeSelect(0)'>
                     <!-- <option value='LAN'> LAN -->
                     <!-- <option value='WAN'> WAN -->
                     <!-- <option value='Local'> Local -->
	<script language="javascript">
	<!-- hide
	   var i = 0;
	   var qosIntf = '<%ejGetOther(qosIntf, all)%>';
	   var intf = qosIntf.split('|');
	  // var itfc;
	   intf.sort();
 
	   for ( i = 0; i < intf.length; i++ ) 
          {
              if (intf[i] != '') 
              {
                  if (intf[i].indexOf('usb') != -1 || intf[i].indexOf('atm') != -1 || intf[i].indexOf('ptm') != -1)
                  {
                      continue;      // skip usb ifc
                  } 
                  document.writeln("  <option value='" + intf[i] + "'>" + intf[i]);
              }
          } 
	// done hiding -->
	</script>
        </option></select></td>
      </tr>
    </table>	
	<div id='etype'><table id="etype" cellSpacing="0" cellPadding="0" border="0">
      <tr> 
        <td width="360">Ether Type:</td>
        <td><select size="1" name='ethtype' onChange='changeSelect(0)'>
            <option value="-1"  > &nbsp;
            <option value="800" > IP (0x800) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <option value="806" > ARP (0x806)
            <option value="86DD"> IPv6 (0x86DD)
            <option value="8863"> PPPoE_DISC (0x8863)
            <option value="8864"> PPPoE_SES (0x8864)
            <option value="8865"> 8865 (0x8865)
            <option value="8866"> 8866 (0x8866)
            <option value="8100"> 8021Q (0x8100)
        </option></select></td>
      </tr>
	</table></div>
    <div id='etype_route'><table cellSpacing="0" cellPadding="0" border="0">
      <tr> 
        <td width="360">Ether Type:</td>
        <td><select size="1" name='ethtyperoute'>
            <option value="800" > IP (0x800) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        </option></select></td>
      </tr>
    </table></div>	
	<div id='smac'><table id="smac" cellSpacing="0" cellPadding="0" border="0">
      <tr id="tblItmSrcMacAddr"> 
        <td width="360">Source MAC Address:</td>
        <td><input type="text" size="16" name="srcmacaddr"></td>
      </tr>
	</table></div>
	<div id='dmac'><table id="dmac" cellSpacing="0" cellPadding="0" border="0">
      <tr id="tblItmSrcMacMask">
        <td width="360">Source MAC Mask:</td>
        <td><input type="text" size="16" name="srcmacmask"></td>
      </tr>
      <tr id="tblItmDstMacAddr"> 
        <td width="360">Destination MAC Address:</td>
        <td><input type="text" size="16"  maxlength="17" name="dstmacaddr"></td>
      </tr>
      <tr id="tblItmDstMacMask"> 
        <td width="360">Destination MAC Mask:</td>
        <td><input type="text" size="16"  maxlength="17" name="dstmacmask"></td>
      </tr>
	</table></div>
	<div id='eth_ip'><table id="eth_ip" cellSpacing="0" cellPadding="0" border="0">
      <tr id="sip_opt"> 
        <td width="360"><select size="1" name="ipoptionlist">
            <option value="0"> Source IP Address[/Mask]:
            <option value="1"> Vendor Class ID (DHCP Option 60):
            <option value="2"> User Class ID (DHCP option 77):
        </option></select></td>
        <td class=form_label><input type="text" size="22" name="srcaddr"></td>
       </tr>

      <tr id="dip_opt"> 
        <td width="360">Destination IP Address[/Mask]:</td>
        <td><input type="text" size="22" name="dstaddr"></td>
      </tr>
	</table></div>
	<div id='dscpcheck'><table id="dscpcheck" cellSpacing="0" cellPadding="0" border="0">
        <tr id="dscpcheck"> 
        <td width="360">Differentiated Service Code Point (DSCP) Check:</td>
        <td><select size="1" name="dscpchk">
            <option value="-1"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <option value="0"> default
            <option value="56"> AF13(001110) 
            <option value="48"> AF12(001100) 
            <option value="40"> AF11(001010) 
            <option value="32"> CS1(001000) 
            <option value="88"> AF23(010110) 
            <option value="80"> AF22(010100) 
            <option value="72"> AF21(010010) 
            <option value="64"> CS2(010000) 
            <option value="120"> AF33(011110) 
            <option value="112"> AF32(011100) 
            <option value="104"> AF31(011010) 
            <option value="96"> CS3(011000) 
            <option value="152"> AF43(100110) 
            <option value="144"> AF42(100100) 
            <option value="136"> AF41(100010) 
            <option value="128"> CS4(100000) 
            <option value="184"> EF(101110) 
            <option value="160"> CS5(101000) 
            <option value="192"> CS6(110000)
            <option value="224"> CS7(111000)
        </option></select></td>
      </tr>
	</table></div>
	<div id='proto4'><table id="protocol4" cellSpacing="0" cellPadding="0" border="0">
      <tr id="proto4"> 
        <td width="360">Protocol:</td>
        <td><select size="1" name="protocol4" onChange='changeSelect(0)'>
            <option value="-1"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <option value="6" > TCP 
            <option value="17"> UDP 
            <option value="1" > ICMP
            <option value="2" > IGMP
        </option></select></td>
      </tr>
	</table></div>
	<div id='proto6'><table id="protocol6" cellSpacing="0" cellPadding="0" border="0">
      <tr id="proto6"> 
        <td width="360">Protocol V6:</td>
        <td ><select size="1" name="protocol6" onChange='changeSelect(0)'>
            <option value="-1"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <option value="6" > TCP 
            <option value="17"> UDP 
            <option value="58"> ICMPv6
        </option></select></td>
      </tr>
	</table></div>
	<div id='tcp_udp_port'><table id="tcp_udp_port" cellSpacing="0" cellPadding="0" border="0">
      <tr id="tcp_udp_sport"> 
        <td width="360">UDP/TCP Source Port (port or port:port):</td>
        <td><input type="text" size="22" name="srcport"></td>
      </tr>
      <tr id="tcp_udp_dport"> 
        <td width="360">UDP/TCP Destination Port (port or port:port):</td>
        <td><input type="text" size="22" name="dstport"></td>
      </tr>
	</table></div>
	<div id='eth_8021q'><table id="eth_8021q" cellSpacing="0" cellPadding="0" border="0">
      <tr id="eth_8021q"> 
        <td width="360">802.1p Priority Check:</td>
        <td><select size="1" name="vlan8021p">
            <option value="-1"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <option value="0"> 0 
            <option value="1"> 1 
            <option value="2"> 2 
            <option value="3"> 3 
            <option value="4"> 4 
            <option value="5"> 5 
            <option value="6"> 6 
            <option value="7"> 7
        </option></select></td>
      </tr>
    </table></div>
    <p><b>Specify Classification Results</b><br>
    Must select a classification queue. A blank mark or tag value means no change.</p>
    <table id="classResult" cellSpacing="0" cellPadding="0" border="0">
      <tr id="class_queue"> 
        <td width="360">Assign Classification Queue:</td>
        <td><select size="1" name="queuekey" onChange='changeSelect2(0)'>
            <option value="-1"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;&nbsp;
<script language="javascript">
<!-- hide
{
   //queues.sort();
   for ( i = 0; i < queues.length; i++ ) {
      if (queues[i] != '') {
         var info = queues[i].split(':');
	   var itfc;
         if (info[1].indexOf('ath') != -1&&!(info[1].indexOf('wan') != -1 || info[1].indexOf('atm') != -1 || info[1].indexOf('ptm') != -1 ||
		info[1].indexOf('ppp') != -1))
         {

         //   itfc = info[1].replace('ath0','WLAN1');
		 continue;
	    
         }
         document.writeln("  <option value='" + info[0] + "'>" +info[1]);
      }
   }
}
// done hiding -->
</script>
        </option></select></td>
      </tr>
      <tr id="dscpmark"> 
        <td width="360">Mark Differentiated Service Code Point (DSCP):</td>
        <td><select size="1" name="dscp">
            <option value="-1" selected> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <option value="-2"> Auto Marking
            <option value="0"> default
            <option value="56"> AF13(001110) 
            <option value="48"> AF12(001100) 
            <option value="40"> AF11(001010) 
            <option value="32"> CS1(001000) 
            <option value="88"> AF23(010110) 
            <option value="80"> AF22(010100) 
            <option value="72"> AF21(010010) 
            <option value="64"> CS2(010000) 
            <option value="120"> AF33(011110) 
            <option value="112"> AF32(011100) 
            <option value="104"> AF31(011010) 
            <option value="96"> CS3(011000) 
            <option value="152"> AF43(100110) 
            <option value="144"> AF42(100100) 
            <option value="136"> AF41(100010) 
            <option value="128"> CS4(100000) 
            <option value="184"> EF(101110) 
            <option value="160"> CS5(101000) 
            <option value="192"> CS6(110000)
            <option value="224"> CS7(111000)
        </option></select></td>
      </tr>
	</table>
	<div id='mark_8021p'><table id="mark_8021p" cellSpacing="0" cellPadding="0" border="0">
      <tr id="mark_8021p"> 
        <td width='360'>Mark 802.1p priority:</td>
        <td><select size="1" name="wanVlan8021p">
            <option value="-1" selected> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <option value="0"> 0 
            <option value="1"> 1 
            <option value="2"> 2 
            <option value="3"> 3 
            <option value="4"> 4 
            <option value="5"> 5 
            <option value="6"> 6 
            <option value="7"> 7
        </option></select></td>
      </tr>
	</table></div>
	<div id='tag_vlanid'><table id="tag_vlanid" cellSpacing="0" cellPadding="0" border="0">
      <tr id="tag_vlanid"> 
        <td width='360'>Tag VLAN ID [0-4094]:</td>
        <td><input type="text" size="22" name="wanVlanID"></td>
      </tr>
	</table></div>
	<div id='rate_control'><table id="rate_control" cellSpacing="0" cellPadding="0" border="0">
	<script language="javascript">
	<!-- hide
	{
	   if ( enableTc == '1' ) {
	      document.writeln("      <tr>");
	      document.writeln("        <td width='360'>Set Rate Control(kbps):</td>");
	      document.writeln("        <td><input type='text' size='22' name='txtrate'></td>");
	      document.writeln("      </tr>");
	   }
	}
	// done hiding -->
	</script>
      </table></div>
<br>

<p align=center><input type='button' onClick='btnApply()' value='Apply'>
<input type='button' onClick='btnCancel()' value='Cancel'></p>

</td>
</tr>
</table>
</div>

</form>
<script type='text/javascript'>
mainBodyEnd();
delaytimer=250;
ThirdRowEnd();
Footer();
mainTableEnd();
</script>
</blockquote>
</body>
</html>
