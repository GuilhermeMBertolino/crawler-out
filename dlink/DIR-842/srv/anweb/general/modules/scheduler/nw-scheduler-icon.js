"use strict";!function(){var nwSchedulerIcon=angular.module(regdep("nw-scheduler-icon"),[]);nwSchedulerIcon.directive("nwSchedulerIcon",["translate",function(){return{restrict:"A",replace:!0,template:'<div class="nw-scheduler-icon" ng-click="setSchedule()" ng-class="{\'nw-scheduler-icon--added\': isExistsSchedule, \'nw-scheduler-icon--disabled\': isDisabled}"title="{{!isExistsSchedule ? (\'sched_set\' | translate) : (\'sched_edit\' | translate)}}"><div svg-icon="time"></div></div>',scope:{idRule:"@",indexesLink:"=",isExistsSchedule:"=",titleExistsSchedule:"@",valueModel:"=",isDisabled:"="},controller:"nwSchedulerIconCtrl"}}]),nwSchedulerIcon.controller("nwSchedulerIconCtrl",["$scope","$attrs","scheduler","ngDialog",function($scope,$attrs,scheduler,ngDialog){function initData(){function checkExistsSchedule(){$scope.isExistsSchedule=_.some(indexesLink,function(indexes){return scheduler.isExists($scope.idRule,indexes)})}scheduler.getSchedulerData().then(checkExistsSchedule)}function resetValueModel(){$scope.valueModel=backupValueModel}initData();var backupValueModel=$scope.valueModel,indexesLink=void 0;_.has($attrs,"existsNotWatch")||$scope.$watch("isExistsSchedule",resetValueModel),$scope.$watch("indexesLink",function(value){indexesLink=scheduler.parseIndexesLink(value)}),$scope.setSchedule=function(){function getBranches(rule){return _.map(indexesLink,function(indexes){return scheduler.getFullLink(rule,indexes)})}if(!$scope.isDisabled){var options={branches:getBranches($scope.idRule),name:$attrs.idRule,isNeedReload:!1};return ngDialog.open({template:"dialogs/schedule_form/dialog.tpl.html",controller:"ScheduleFormDialogCtrl",scope:$scope,data:options,className:"schedule-dialog-width"}).closePromise.then(function(data){data&&data.value&&initData()})}}}])}();