"use strict";!function(){var checkPing=angular.module(regdep("check-ping"),[]);checkPing.service("checkPing",["$q","$timeout",function($q,$timeout){return{check:function(){var new_params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},accept_loss=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,deferred=$q.defer(),proto="https:"==document.location.protocol?"wss":"ws",connection=new WebSocket("".concat(proto,"://").concat(document.location.host,"/websocket")),params=Object.assign({host:"google.com",count:3,is_ipv6:!1,packet_size:20,timeout:1,work_timeout:180},new_params),cancelPromise=$timeout(function(){connection.close(),deferred.reject()},1e3*params.work_timeout);return connection.onopen=function(){var send="init ".concat(Math.round(4294967294*Math.random()+1)),method=params.is_ipv6?"ping6":"ping",load='{ "method": "'.concat(method,'", "params": { "host": "').concat(params.host,'", "-c": "').concat(params.count,'", "-s": "').concat(params.packet_size,'", "-W": "').concat(params.timeout,'", "-w": "').concat(params.work_timeout,'" } }');connection.send(send),connection.send("sysutils:"+load)},connection.onmessage=function(e){var data=e.data;if("sysutils:"==data.substring(0,9)){var load=data.replace("sysutils:",""),input=JSON.parse(load);if((!input||input.error)&&(connection.close(),deferred.reject()),input.result){if(input.result.message){var mess=input.result.message;if(mess.includes("packet loss")){var result=mess.match(/\s+([0-9]+)%\s+packet loss/);result=result&&result[1]||100,accept_loss>=result?deferred.resolve():deferred.reject()}else mess.includes("bad address")&&deferred.reject()}input.result.end&&connection.close()}}},connection.onerror=function(){connection.close(),deferred.reject()},connection.onclose=function(){$timeout.cancel(cancelPromise),deferred.reject()},deferred.promise}}}])}();