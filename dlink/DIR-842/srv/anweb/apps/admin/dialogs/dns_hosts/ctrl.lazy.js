"use strict";function DnsHostsDialogCtrl($scope,funcs){var data=$scope.data=$scope.ngDialogData;$scope.header="dns_hosts_"+(data.host?"edit":"add"),function(data){var host;data.hostsArr||(data.hostsArr=[]),data.inx||0==data.inx?(host=data.hostsArr[data.inx],data.host={__AddressArray:(host.__AddressArray||[]).map(function(e){return{IPAddress:e.IPAddress,__key:e.__key}}),Hostname:host.Hostname},data.host.__AddressArray.length||data.host.__AddressArray.push({IPAddress:""})):data.host={__AddressArray:[{IPAddress:""}],Hostname:""}}(data);var initialData={host:{__AddressArray:data.host.__AddressArray.map(function(e){return{IPAddress:e.IPAddress,__key:e.__key}}),Hostname:data.host.Hostname}};$scope.validateHostname=function(value){return value&&data.hostsArr.find(function(e,i){return i!=data.inx&&e.Hostname==value})?"msg_error_value_is_not_uniq":null},$scope.validateIP=function(value,inx){function checkIPIntersection(ipVer){return data.host.__AddressArray.find(function(e,i){return i!=inx&&funcs.is[ipVer](e.IPAddress)&&0==funcs[ipVer].address.compare(e.IPAddress,value)})?!0:!1}var addrArr;if(value)if("ipv6"==data.ipVersion){if(!funcs.is.ipv6(value))return"msg_invalid_ipv6";if(checkIPIntersection("ipv6"))return"msg_error_value_is_not_uniq"}else if("ipv4"==data.ipVersion){if(!funcs.is.ipv4(value))return"msg_invalid_ipv4";if(checkIPIntersection("ipv4"))return"msg_error_value_is_not_uniq"}else if(funcs.is.ipv4(value)){if(checkIPIntersection("ipv4"))return"msg_error_value_is_not_uniq"}else{if(!funcs.is.ipv6(value))return"msg_invalid_ip";if(checkIPIntersection("ipv6"))return"msg_error_value_is_not_uniq"}else if(0==inx&&(addrArr=data.host.__AddressArray,$scope.form.hosts_ip.$dirty&&!$scope.filterList(addrArr).length))return"msg_need_addr";return null},$scope.addIP=function(){data.host.__AddressArray.push({IPAddress:""})},$scope.clientListOnChange=function(option){option.raw.host&&!data.host.Hostname&&(data.host.Hostname=option.raw.host)},$scope.changed=function(){var host=initialData.host,filteredInit=$scope.filterList(host.__AddressArray),filteredData=$scope.filterList(data.host.__AddressArray);return filteredInit.length!=filteredData.length||filteredInit.find(function(host,inx){return host.IPAddress!=filteredData[inx].IPAddress})||host.Hostname!=data.host.Hostname},$scope.filterList=function(ipList){return ipList.filter(function(e){return e.IPAddress})},$scope.submit=function(form){var hostsIPField=form.hosts_ip;hostsIPField.$setViewValue(hostsIPField.$viewValue),form.$valid&&(data.host.__AddressArray=$scope.filterList(data.host.__AddressArray),$scope.closeThisDialog(data))}}angular.module("app").controllerProvider.register("DnsHostsDialogCtrl",DnsHostsDialogCtrl);