"use strict";angular.module("app").controller("WifiShapingDialogCtrl",["$scope","$timeout","device",function($scope,$timeout,device){var util=device.wifiShaping;$scope.unescape=_.unescape,$scope.action=$scope.ngDialogData.action,$scope.rule=$scope.ngDialogData.rule,$scope.networks=util.getNetworks(),$scope.rule.UploadUnlim=0===$scope.rule.UploadRate,$scope.rule.DownloadUnlim=0===$scope.rule.DownloadRate,"edit"==$scope.action&&($scope.rule.UploadRate=$scope.rule.UploadRate?$scope.rule.UploadRate/$scope.constants.KbInMB:null,$scope.rule.DownloadRate=$scope.rule.DownloadRate?$scope.rule.DownloadRate/$scope.constants.KbInMB:null);var backupRule=angular.copy($scope.rule);$scope.uniqueMacValidator=function(mac){return"add"==$scope.action&&$scope.wifiShaping.data[mac]?"wifi_client_shaping_exist_mac":null},$scope.save=function(){$timeout(function(){$scope.$emit("goToErrorForm",!0),$scope.wifi_shaping_form.$valid&&($scope.hasNetworks()&&($scope.ngDialogData.rule.SSID=$scope.networks[$scope.ngDialogData.rule.Band].List[$scope.ngDialogData.rule.Network].SSID),$scope.closeThisDialog($scope.ngDialogData.rule))})},$scope.isMoreThanOneBand=function(){return _.size($scope.networks)>1},$scope.changeBand=function(){$scope.networks[$scope.rule.Band].List[$scope.rule.Network]||($scope.rule.Network=_.keys($scope.networks[$scope.rule.Band].List)[0])},$scope.hasNetworks=function(){return!_.isUndefined($scope.networks)},$scope.isNew=function(){return!_.has($scope.rule,"Inx")},$scope.wasModified=function(){return!_.isEqual(backupRule,$scope.rule)}}]);