"use strict";function DHCPStaticAddressDialogCtrl($scope,funcs){function sanitizeIPv4Data(data){funcs.is.ipv4(data.ip0)||delete data.ip0,funcs.is.mask(data.mask)||delete data.mask}function sanitizeIPv6Data(data){data.lanIPv6Arr&&data.lanIPv6Arr.length&&(data.lanIPv6Arr=data.lanIPv6Arr.filter(function(e){var arr=e.split("/");return funcs.is.ipv6(arr[0])&&funcs.is.number(arr[1])}))}function ipv4OutOfNetwork(value){return!funcs.ipv4.subnet.belongNetwork(data.subnet0,value,data.mask0)}function ipv6OutOfNetwork(value){var ipv6Prefix,arr,addr,prefix,lanSubnet;for(var i in data.lanIPv6Arr)if(ipv6Prefix=data.lanIPv6Arr[i],arr=ipv6Prefix.split("/"),addr=arr[0],prefix=arr[1],lanSubnet=funcs.ipv6.subnet.getNetworkAddress(addr,prefix),funcs.ipv6.subnet.belongNetwork(lanSubnet,value,prefix))return!1;return!0}var data=$scope.data=$scope.ngDialogData;"ipv4"==data.ipVersion?(sanitizeIPv4Data(data),$scope.ipExample="192.168.0.10"):(sanitizeIPv6Data(data),$scope.ipExample="fd00::10"),data.__leaseInMinutes=data.lease?(data.lease/60).toFixed():"";var used=data.used,initialData={ip:data.ip,mac:data.mac,hostname:data.hostname,__leaseInMinutes:data.__leaseInMinutes};"ipv4"==data.ipVersion&&data.ip0&&data.mask0&&(data.subnet0=funcs.ipv4.address.and(data.ip0,data.mask0),data.subnetPrefix0=data.subnet0+"/"+funcs.ipv4.mask["short"](data.mask0)),$scope.clientListOnChange=function(option){option.raw.ip&&funcs.is[data.ipVersion](option.raw.ip)&&(data.ip=option.raw.ip),option.raw.mac&&(data.mac=option.raw.mac),option.raw.host?data.hostname=option.raw.host:option.raw.hostname&&(data.hostname=option.raw.hostname)},$scope.submit=function(form){form.$valid&&(data.lease=data.__leaseInMinutes?60*data.__leaseInMinutes:0,data.hostname||(data.hostname=""),$scope.closeThisDialog(data))},$scope.changed=function(){return data.ip!=initialData.ip||data.mac!=initialData.mac||data.hostname!=initialData.hostname||data.__leaseInMinutes!=initialData.__leaseInMinutes},$scope.getListType=function(type){return"host"==type?"host:ip/mac":"mac"==type?type:type},$scope.validateIP=function(value){if("ipv4"==data.ipVersion){if(!funcs.is.ipv4(value))return"msg_invalid_ipv4";if(ipv4OutOfNetwork(value))return"msg_ip_address_is_not_included_to_network";if(value==data.ip0)return"lan_error_ip_address_is_used_as_lan_ip";if(data.gw&&data.gw==value)return"lan_error_ip_address_is_used_as_gw_ip";if(used&&used.map(function(e){return e.IPAddress}).includes(value))return"msg_ip_address_is_used"}else{if(!funcs.is.ipv6(value))return"msg_invalid_ipv6";if(ipv6OutOfNetwork(value))return"msg_ip_address_is_not_included_to_any_network";if(data.lanIPv6Arr.map(function(e){return e.split("/")[0]}).find(function(e){return!funcs.ipv6.address.compare(value,e)}))return"lan_error_ip_address_is_used_as_lan_ip";if(data.gw&&!funcs.ipv6.address.compare(value,data.gw))return"lan_error_ip_address_is_used_as_gw_ip";if(used&&used.map(function(e){return e.IPAddress}).find(function(e){return!funcs.ipv6.address.compare(value,e)}))return"msg_ip_address_is_used"}return null},$scope.validateMAC=function(value){return value?funcs.is.mac(value)?used&&used.filter(function(e){return e.MACAddress}).map(function(e){return e.MACAddress.toUpperCase()}).includes(value.toUpperCase())?"msg_mac_address_is_used":null:"msg_invalid_mac":null},$scope.validateHostname=function(value){return used&&value&&used.filter(function(e){return e.Hostname}).map(function(e){return e.Hostname}).includes(value)?"msg_error_value_is_not_uniq":null},$scope.validateLease=function(value){if(value){if(!funcs.is.number(value))return"msg_invalid_number";if(2>value)return"msg_value_less_min"}return null},$scope.ipValidAndOutOfNetwork=function(value){return"ipv4"==data.ipVersion?funcs.is.ipv4(value)&&ipv4OutOfNetwork(value):funcs.is.ipv6(value)&&ipv6OutOfNetwork(value)}}