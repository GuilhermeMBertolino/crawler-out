"use strict";angular.module(regdep("app.page-details"),["app.config","app.navigation"]).factory("pageDetails",["navigation","pageList","$state",function(navigation,pageList,$state){function getUrl(state){var ancs=getStateAncestors(state),parts=[];for(var s in ancs)parts.push(navigation[ancs[s]].url);return"#"+parts.join("")}function getMenuPath(state){var menu,ancs=getStateAncestors(state),parts=[];for(var s in ancs)menu=navigation[ancs[s]].menu,menu&&parts.push(menu.name);return parts}function InfoObj(state,page){this.state=state,this.url=getUrl(state,"url"),this.features=page.features,this.go=function(newHost,params,options){var newURL;newHost?(newURL=document.location.protocol+"//"+newHost+":"+document.location.port+assignParamsToStateURL(this.url,params),document.location.href=newURL):$state.go(this.state,params,options)},navigation[state].title&&(this.title=navigation[state].title);var menu,menuState=findMenuState(state);menuState&&(menu=navigation[menuState].menu,this.menu={name:menu.name,desc:menu.desc,path:getMenuPath(state),state:menuState})}function findMenuState(state){var i,s,ancs=getStateAncestors(state);for(i=ancs.length-1;i>=0;i--)if(s=navigation[ancs[i]],s.menu&&s.menu.sref==state)return ancs[i];return null}function getStateAncestors(state){var i,ancestors=[],parts=state.split(".");for(i=1;i<=parts.length;i++)ancestors.push(parts.slice(0,i).join("."));return ancestors}function assignParamsToStateURL(url,params){params||(params={});var paramPairs,arr=url.split("?");if(arr&&arr.length){paramPairs=[];for(var key in params)params[key]&&paramPairs.push(key+"="+params[key]);return paramPairs.length?arr[0]+"?"+paramPairs.join("&"):arr[0]}return null}var navs,page,obj,defaultView,pages={};for(var pageName in pageList){navs=[],page=pageList[pageName];for(var key in navigation)obj=navigation[key],_.isString(obj.page)?obj.page==pageName&&(navs.push(new InfoObj(key,page)),findMenuState(key)&&(navs[0].isMenuState=!0)):_.isObject(obj.page)&&(defaultView=obj.page[""],defaultView==pageName&&(navs.push(new InfoObj(key,page)),findMenuState(key)&&(navs[0].isMenuState=!0)));navs.length&&(pages[pageName]=navs)}return pages}]);