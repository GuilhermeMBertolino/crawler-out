"use strict";!function(){var modname="menu-list";window.appDeps.push(modname);var menuList=angular.module(modname,[]);menuList.value("menus",[]),menuList.run(["menus",function(menus){menus.push("home"),menus.push("settings"),menus.push("function"),menus.push("control")}]),menuList.factory("menuFuncs",["menus","translate",function(menus,translate){function makeSubMenuList(navs,parent,pageList){function isPage(menuItem){var pageExists=!1;return _.isString(menuItem.page)?pageExists=!!pageList[menuItem.page]:_.isObject(menuItem.page)&&(pageExists=!!pageList[menuItem.page[""]]),pageExists}function hasPage(menuItem,menuId){if(isPage(menuItem)||menuItem.external)return!0;var arr=_.filter(navs,function(elem,key){return key.indexOf("".concat(menuId,"."))>-1});return _.find(arr,function(elem){return isPage(elem)})}return _.chain(navs).map(function(elem,id){var arr=[],spliter=id.lastIndexOf(".");if(-1!=spliter&&(arr[0]=id.substring(0,spliter),arr[1]=id.substring(spliter+1)),elem.menu){if(hasPage(elem,id)&&arr[0]==parent&&!elem.hidden){var submenu=makeSubMenuList(navs,id,pageList)||[];return _.extend({},elem.menu,{id:id,sref:elem.menu.sref,external:elem.external,url:elem.url,state:elem,submenu:submenu,isGroup:elem.menu.isGroup})}return null}return elem.delimiter&&arr[0]==parent&&2==arr.length&&!elem.hidden?_.extend({},{name:elem.name,delimiter:!0}):null}).filter(function(elem){return elem}).value()}function getInfoText(name){if(!info_text||!name)return{};var nameArr=name.split("."),parent=_.initial(nameArr).join("."),current=_.last(nameArr);return info_text[name]||info_text[current]||getInfoText(parent)}function getMainState($scope,state,menu){for(var pageName in $scope.pageDetails){var page=$scope.pageDetails[pageName][0],pageArr=page.state.split("."),menuArr=menu.id.split("."),equal=!0;for(var inx in menuArr)if(pageArr[inx]!=menuArr[inx]){equal=!1;break}if(equal)return page.state}return state.current.name}function makeTabsList(menu,state){function getTabs(menu,namePage){var parent=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",tabs=[];if(namePage&&namePage.length){var current=parent+_.first(namePage);_.each(menu,function(item){item.id==current&&(tabs=item.isTabsBar?item.submenu:getTabs(item.submenu,_.rest(namePage),current+"."))})}return tabs}var namePage=state.name.split(".");return getTabs(menu,namePage)}var linkNavs;return{makeMenuList:function(navs,pageList){return linkNavs=navs,_.chain(menus).filter(function(elem){return navs[elem]}).map(function(elem){return _.extend({},navs[elem].menu,{id:elem,sref:navs[elem].menu.sref,submenu:makeSubMenuList(navs,elem,pageList)})}).filter(function(elem){return navs[elem.id].page||elem.submenu.length}).value()},updateNavs:function($scope){var navs=linkNavs,domBack=document.querySelector("#back_anchor"),domIcon=document.querySelector("#icon-anchor"),domTitle=document.querySelector("#title-anchor"),domTitleMobile=document.querySelector("#title_anchor_mobile"),domDescript=document.querySelector("#descript-anchor"),backState=$scope.backState(),scopeState=$scope.state();if(scopeState){if(domBack)if($scope.backState()){if($scope.backState().params&&!$scope.backState().params.concatParams&&(domBack.innerHTML=$scope.backState().params&&$scope.backState().params.langParams?translate($scope.backState().title,$scope.backState().params.langParams):translate($scope.backState().title)),$scope.backState().params&&$scope.backState().params.concatParams){var sep=$scope.backState().params.concatParams;domBack.innerHTML=scope.backState().title.split(sep)[1]?translate($scope.backState().title.split(sep)[0])+sep+translate($scope.backState().title.split(sep)[1]):translate($scope.backState().title.split(sep)[0])}}else domBack.innerHTML="";var info="undefined"==typeof info_text?{}:getInfoText(scopeState.name);if(!_.isEmpty(info)){if(domTitle&&scopeState&&(scopeState.params&&!scopeState.params.concatParams&&(domTitle.innerHTML=scopeState.params&&scopeState.params.langParams?translate(scopeState.title,scopeState.params.langParams):translate(scopeState.title)),scopeState.params&&scopeState.params.concatParams)){var sep=scopeState.params.concatParams;domTitle.innerHTML=scopeState.title.split(sep)[1]?translate(scopeState.title.split(sep)[0])+sep+translate(scopeState.title.split(sep)[1]):translate(scopeState.title.split(sep)[0])}if(domTitleMobile&&scopeState&&(scopeState.params&&!scopeState.params.concatParams&&(domTitleMobile.innerHTML=scopeState.params&&scopeState.params.langParams?translate(scopeState.title,scopeState.params.langParams):translate(scopeState.title)),scopeState.params&&scopeState.params.concatParams)){var sep=scopeState.params.concatParams;domTitleMobile.innerHTML=scopeState.title.split(sep)[1]?translate(scopeState.title.split(sep)[0])+sep+translate(scopeState.title.split(sep)[1]):translate(scopeState.title.split(sep)[0])}domDescript&&(domDescript.innerHTML=translate(info.descript)||""),domIcon&&domIcon.setAttribute("src",info.image||"")}for(var pathPage=scopeState.name.split("."),concatPath="",strPathPage="",i=0;i<pathPage.length;i++)if(concatPath.length>1&&(concatPath+="."),concatPath+=pathPage[i],(4!=pathPage.length||2!=i)&&void 0!=navs[concatPath].title){if(strPathPage.length>1&&(strPathPage+=" >> "),navs[concatPath].params&&!navs[concatPath].params.concatParams&&(strPathPage+=translate(navs[concatPath].title,navs[concatPath].params.langParams)),navs[concatPath].params&&navs[concatPath].params.concatParams){var sep=navs[concatPath].params.concatParams;strPathPage+=navs[concatPath].title.split(sep)[1]?translate(navs[concatPath].title.split(sep)[0])+sep+translate(navs[concatPath].title.split(sep)[1]):translate(navs[concatPath].title.split(sep)[0])}navs[concatPath].params||(strPathPage+=translate(navs[concatPath].title))}var domPathPage=document.querySelector("#path-page");if(domPathPage&&(domPathPage.innerHTML=strPathPage),domBack&&domTitle){var domBackRect=domBack.getBoundingClientRect(),domTitleRect=domTitle.getBoundingClientRect();domBackRect.right+20>domTitleRect.left?angular.element(domBack).css("visibility","hidden"):angular.element(domBack).css("visibility","visible")}backState?angular.element(domIcon).css("visibility","visible"):(angular.element(domBack).css("visibility","hidden"),angular.element(domIcon).css("visibility","hidden"))}},selectSecondLevelMenu:function($scope,$state,menu){return $state.current.name==menu.id?$state.reload():-1!=$state.current.name.indexOf(menu.id)&&$state.go(getMainState($scope,$state,menu),null,{reload:!0}),menu.isGroup?($scope.showGroup=$scope.showGroup==menu.id?"":menu.id,0):($scope.tabsList=makeTabsList($scope.menuList,$state.current),$scope.selectedMenu=null,$scope.selectedSubMenu=null,1)},selectSubMenu:function($scope,menu,event,mousemove){$scope.selectedSubMenu=$scope.selectedSubMenu!=menu.id?menu.id:void 0,menu.external&&(location.href=menu.url),menu.openPage&&!mousemove&&($state.go(menu.sref,null,{reload:!0}),$scope.collapseMobileMenu())},makeTabsList:makeTabsList}}])}();