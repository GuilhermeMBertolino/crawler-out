"use strict";!function(){angular.module("app").service("statsPortsUtil",["$rootScope","cpe","device","devinfo","funcs",function($rootScope,cpe,device,devinfo,funcs){var paths={statsPort:"Device.Statistics.Port.",pullPaths:["Device.Statistics.Port.","Device.Switch.Ports.order","Device.Switch.Ports.*.Alias","Device.Switch.Ports.*.Status","Device.Switch.Ports.*.Enable"]},attrs=null,lastData=null,converter=device.statsPorts.converter;return{preload:function(){function readCb(response){attrs=funcs.buildTreeAttributes(response[0].result.ParameterList)}return attrs?Promise.resolve():Promise.all([cpe.GetParameterAttributes([paths.statsPort])]).then(readCb)},subscribeInfo:function(cb,$scope,fetchLastData){function prepareData(response){function sortData(){if(!data.order)return data.ports;var sortData=[];return _.each(data.order,function(elem){sortData.push(_.findWhere(data.ports,{__id:elem}))}),sortData}if(response&&response.collect){var input={value:response.collect,attrs:attrs},data=converter.dsysinitToNative(input);data.ports=sortData(),lastData=data,cb&&cb(data)}}fetchLastData&&lastData&&cb(lastData),devinfo.collect.onceAndSubscribe(paths.pullPaths.join("|"),prepareData,$scope),$rootScope.portsDefer.promise.then(function(data){var result={preload:!0,ports:_.map(data,function(port){return{alias:port.name}})};cb(result)})}}}])}();