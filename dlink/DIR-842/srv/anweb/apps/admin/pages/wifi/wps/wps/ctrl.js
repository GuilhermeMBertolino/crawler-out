"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i["return"]||_i["return"]()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){return Array.isArray(arr)?arr:void 0}function _createForOfIteratorHelper(o,allowArrayLike){var i,F,it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length)return it&&(o=it),i=0,F=function(){},{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e2){throw _e2},f:F};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e3){didErr=!0,err=_e3},f:function(){try{normalCompletion||null==it["return"]||it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){var i,arr2;for((null==len||len>arr.length)&&(len=arr.length),i=0,arr2=new Array(len);len>i;i++)arr2[i]=arr[i];return arr2}!function(){angular.module("app").controller("wifiWPSSettings",["$scope","$state","device","wifiWpsUtil","ngDialog","funcs","wifiWpsShared","snackbars","translate",function($scope,$state,device,util,ngDialog,funcs,shared,snackbars,translate){function activate(){var band=device.wifi.getBand(0);$scope.wifi.wps.connectMethod=band.wps.getConnectMethod(inx),$scope.wifi.wps.info=band.wps.getInfo(inx),$scope.wifi.wps.data=band.wps.data(inx),util.pull(),saveBackup(),$scope.wifi.needUpdate=!1,resetStatusChecker()}function saveBackup(){backup.data=device.funcs.deepExtend({},$scope.wifi.wps.data)}function update(){$scope.wifi.wps.data.Enable?apply():apply(action)}function refresh(){var overlay=$scope.overlay.circular,overlayId=overlay.start();shared.activate().then(activate)["finally"](overlay.stop.bind(overlay,overlayId))}function getConfirmMsgRadio(){var msg="",radio=util.getScheduleWarning().find(function(e){return"radio"==e});return radio&&(msg="wifi_wps_radio_schedule_warning"),msg}function getConfirmMsgBroadcast(){var msg="",broadcast=util.getScheduleWarning().find(function(e){return"broadcast"==e});return broadcast&&(msg="wifi_wps_broadcast_schedule_warning"),msg}function resetStatusChecker(){device.wifi.getBand(0)}function apply(action){saveBackup(),action?shared.apply({action:action,freq:freq}):shared.apply()}var overlay=$scope.overlay.circular,freq=$state.params.freq?$state.params.freq:"2.4GHz",inx=$state.params.inx||"1",currentState=$state.current.name.split("."),action="edit"==currentState.pop()?"wps":void 0,backup={};$scope.wifi.wps={data:null,connectMethod:null,connectStatus:null,info:{},wpsSystemButton:function(){var _iterator,_step,buttons=util.getConfig(),commands=util.getCommands();if(buttons){_iterator=_createForOfIteratorHelper(buttons);try{for(_iterator.s();!(_step=_iterator.n()).done;){var command=_step.value;for(var key in command){var commandKey=Object.entries(commands).find(function(_ref){var _ref2=_slicedToArray(_ref,2),index=_ref2[0],commandConfig=_ref2[1];return"wps"==commandConfig.Command?index:!1});if(commandKey&&command[key].Command==="Device.System.Command.".concat(commandKey[0],"."))return!0}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return!1}},hasWarning:function(name){var band=device.wifi.getBand(0),warnings=band.wps.warnings(inx);return name?_.contains(warnings,name):warnings.length},hasInfoParam:function(param){return $scope.wifi.wps.info?_.has($scope.wifi.wps.info,param):!1},supportParam:function(name){return _.has($scope.wifi.wps.data,name)}},$scope.wifi.isNotModified=function(){return $scope.wifi.wps.data&&backup?angular.equals($scope.wifi.wps.data,backup.data):!0},$scope.wifi.action={apply:apply,update:update,connect:function(){var dlg=ngDialog.open({template:"dialogs/wps_connection/dialog.tpl.html",controller:"WpsConnectionDialogController",resolve:funcs.getLazyResolve("dialogs/wps_connection/ctrl.lazy.js","WpsConnectionDialogController")});dlg.closePromise.then(function(result){if(result&&result.value&&!_.isString(result.value)){var band=device.wifi.getBand(0);_.extend(band.wps.data(inx),{Method:result.value.method,PIN:result.value.pin}),band.wps.connect(inx),apply(action)}})},refresh:refresh,reset:function(){var band=device.wifi.getBand(0);band.wps.reset(update,inx)},unlock:function(){util.unlock(function(response){funcs.is.RPCSuccess(response)||snackbars.add("msg_rpc_write_error"),activate()})},enableRadio:function(){function enRadio(){device.wifi.enableRadio(freq,function(){refresh(),overlay.stop(overlayId)})}function error(){snackbars.add("msg_rpc_write_error"),overlay.stop(overlayId)}var confirmMsg=translate(getConfirmMsgRadio());if(confirmMsg){if(!confirm(confirmMsg))return;util.deleteScheduler("radioEnable").then(enRadio)["catch"](error)}else enRadio();var overlayId=overlay.start()},enableRadioBroadcast:function(){function enRadioBroadcast(){device.wifi.enableRadioBroadcast(freq,inx,function(){refresh(),overlay.stop(overlayId)})}function error(){snackbars.add("msg_rpc_write_error"),overlay.stop(overlayId)}var confirmMsg=translate(getConfirmMsgBroadcast());if(confirmMsg){if(!confirm(confirmMsg))return;util.deleteScheduler("ssidEnable").then(enRadioBroadcast)["catch"](error)}else enRadioBroadcast();var overlayId=overlay.start()}},activate()}])}();