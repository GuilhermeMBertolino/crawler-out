"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i["return"]||_i["return"]()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){return Array.isArray(arr)?arr:void 0}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){return"undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"]?Array.from(iter):void 0}function _arrayWithoutHoles(arr){return Array.isArray(arr)?_arrayLikeToArray(arr):void 0}function _arrayLikeToArray(arr,len){var i,arr2;for((null==len||len>arr.length)&&(len=arr.length),i=0,arr2=new Array(len);len>i;i++)arr2[i]=arr[i];return arr2}!function(){angular.module("app").controllerProvider.register("wifiClientShapingCtrl",["$scope","$state","funcs","ngDialog","translate","cookie",function($scope,$state,funcs,ngDialog,translate,cookie){function save(){var overlay=$scope.overlay.circular,overlayId=overlay.start();_.each(wifiShaping.data,function(e){return delete e.__Key}),util.push(function(error){error?$state.go("error",{code:"msg_push_error",message:"msg_error_desc"}):$state.go($state.current,{},{reload:!0})})["finally"](overlay.stop.bind(overlay,overlayId))}function openDialog(action,rule){ngDialog.open({template:"/admin/dialogs/wifi_shaping/dialog.tpl.html",className:"wifi_shaping_dialog",controller:"WifiShapingDialogCtrl",scope:$scope,data:{action:action,rule:_.clone(rule)}}).closePromise.then(function(result){if(result.value&&"$escape"!=result.value){var value=result.value,key=_.has(value,"ProfileKey")&&_.has(value,"Inx")?value.ProfileKey+value.Inx:"new_inst";wifiShaping.data[key]={MAC:value.Mac,Band:value.Band,Network:value.Network,Inx:value.Inx,Enabled:value.Enabled,DownloadRate:value.DownloadUnlim?0:value.DownloadRate*constants.KbInMB,UploadRate:value.UploadUnlim?0:value.UploadRate*constants.KbInMB,SSID:value.SSID},save()}})}var device=$scope.device,util=device.wifiShaping,wifiShaping={data:null,networks:null,add:function(){var hasNetworks=Object.keys(wifiShaping.networks).length>1;openDialog("add",{Enabled:!0,Mac:"",DownloadRate:"",UploadRate:"",Band:hasNetworks?"1":void 0,Network:hasNetworks?Object.keys(Object.values(wifiShaping.networks)[0].List)[0]:void 0})},remove:function(items){var apProfileIdsToDelete=_toConsumableArray(new Set(Object.values(items).map(function(x){return x.Network}))),apProfileInxsToDelete=_toConsumableArray(new Set(Object.values(items).map(function(x){return x.Inx})));Object.entries(wifiShaping.data).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),ruleKey=_ref2[0],rule=_ref2[1];apProfileIdsToDelete.some(function(x){return x===rule.Network})&&apProfileInxsToDelete.some(function(x){return x===rule.Inx})&&delete wifiShaping.data[ruleKey]}),save()},edit:function(item){openDialog("edit",{Enabled:item.Enabled,Mac:item.MAC,DownloadRate:item.DownloadRate,UploadRate:item.UploadRate,Band:item.Band,Network:item.Network,Inx:item.Inx,ProfileKey:item.ProfileKey})},save:save,wasModified:util.wasModified,rateInfo:function(rate){return rate?rate/constants.KbInMB:translate("wifi_client_shaping_unlimited")},getMiniCaption:function(key,value){return value.MAC},getMiniShort:function(key,value){var list=[];return list.push(value.UploadRate?"".concat(value.UploadRate/constants.KbInMB," ").concat(translate("units_mbps")):translate("wifi_client_shaping_unlimited")),list.push(value.DownloadRate?"".concat(value.DownloadRate/constants.KbInMB," ").concat(translate("units_mbps")):translate("wifi_client_shaping_unlimited")),"".concat(list.join(" - ")," (").concat(translate(wifiShaping.networks[value.Band].Band+"ghz"),")")}},constants={KbInMB:1e3,minUploadRate:1,maxUploadRate:2e3,minDownloadRate:1,maxDownloadRate:2e3};$scope.wifiShaping=wifiShaping,$scope.constants=constants,$scope.isEasyMeshEnabled=autoconf.BR2_PACKAGE_ANWEB_WIFI_EASYMESH&&"enabled"==cookie.get("easy_mesh"),function(){util.pull(function(error){return error?void $state.go("error",{code:"msg_pull_error",message:"msg_error_desc"}):(wifiShaping.data=util.getData(),wifiShaping.networks=util.getNetworks(),_.each(wifiShaping.data,function(e,k){return e.__Key=k}),$scope.$emit("pageload"),$scope.isActivate=!0,void($scope.isEmpty=!_.size(wifiShaping.data)))})}()}])}();