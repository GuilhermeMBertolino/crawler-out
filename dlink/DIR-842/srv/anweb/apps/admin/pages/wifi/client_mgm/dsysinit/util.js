"use strict";!function(){angular.module("app").service("wifiClientMgmUtil",["funcs","device","devinfo","cpe","translate","cookie",function(funcs,device,devinfo,cpe,translate,cookie){function getClients(){return config?formClients(config.Clients,config.EasyMesh,config.EmTopology):{}}function isSupported5G(){return config.Support5G}function formClients(clients,easyMesh,topology){function formBand(value){return"2.4GHz"==value?"24ghz":"5GHz"==value?"5ghz":void 0}function formSize(value){return _.isUndefined(value)?"-":funcs.lookSize(value).toString(sizeTranslater)}function sizeTranslater(value){return translate("units_"+value)}function formSpeed(value){return value?funcs.lookSize(1e3*value*1e3/8,"bit",1e3).toString(sizeTranslater)+"/"+translate("units_dt_S"):"-"}if(easyMesh.Enable&&topology){var emClientsList=[];_.each(topology,function(elem){var stationInfo=funcs.newConfig.normalize(elem.StationInfo);_.each(stationInfo,function(client){emClientsList.push(client.MACAddress.toUpperCase())})}),clients=_.filter(clients,function(client){return _.find(emClientsList,function(elem){return elem==client.MAC})})}return _.map(clients,function(client){return _.isUndefined(client)?void 0:(_.isUndefined(client.Band)||(client.BandName=formBand(client.Band)),_.isUndefined(client.RxBytes)||(client.RxBytes=0==client.RxBytes?void 0:formSize(client.RxBytes)),_.isUndefined(client.TxBytes)||(client.TxBytes=0==client.TxBytes?void 0:formSize(client.TxBytes)),_.isUndefined(client.RateUpLink)||(client.RateUpLink=formSpeed(client.RateUpLink)),_.isUndefined(client.RateDownLink)||(client.RateDownLink=0==client.RateDownLink?void 0:formSpeed(client.RateDownLink)),client)})}var devMode=cookie.get("device_mode"),config={},constants={wifiInfo:"Device.WiFi.",wifiClientsMgm24:"Device.Statistics.WiFi.Radio.1.AccessPoint.",wifiClientsMgm5:"Device.Statistics.WiFi.Radio.2.AccessPoint.",dhcpStats:"Device.Statistics.DHCPServer.",hostnames:"Device.Hostnames.",easyMesh:"Device.Services.EasyMesh.",emTopology:"Device.Statistics.EasyMesh.Topology."},converter=device.wifiClientMgm.converter,parameterArr=[constants.wifiInfo,constants.wifiClientsMgm24,constants.dhcpStats,constants.hostnames];return parameterArr.push(constants.wifiClientsMgm5),"ap"!=devMode&&(parameterArr.push(constants.easyMesh),parameterArr.push(constants.emTopology)),{pull:function(){function success(response){return config=funcs.buildTree(response[0].result.ParameterList),config=converter.dsysinitToNative(config),Promise.resolve()}return Promise.all([cpe.GetParameterValues(parameterArr)]).then(success)},subsribeClientInfo:function(cb,$scope,id){var subscribeString=parameterArr.join("|");devinfo.subscribe(subscribeString,function(response){if(response){var wifiClientsMgm24=funcs.splitTree(response[constants.wifiClientsMgm24]),wifiInfo=funcs.splitTree(response[constants.wifiInfo]),servers=funcs.splitTree(response[constants.servers]),wifiClientsMgm5=funcs.splitTree(response[constants.wifiClientsMgm5]),hostnames=funcs.splitTree(response[constants.hostnames]),easyMesh=funcs.splitTree(response[constants.easyMesh]),emTopology=funcs.splitTree(response[constants.emTopology]),ipAddress=_.filter(funcs.splitTree(response[constants.dhcpStats]),function(elem){return/DHCPServer\.\d+\.Client/.test(elem.Name)}),input=funcs.buildTree(wifiClientsMgm24.concat(wifiClientsMgm5,wifiInfo,servers,hostnames,easyMesh,emTopology,ipAddress)),data=converter.dsysinitToNative(input);cb&&cb(formClients(data.Clients,data.EasyMesh,data.EmTopology),id)}},$scope)},updateClients:function(){function success(response){return config=funcs.buildTree(response[0].result.ParameterList),config=converter.dsysinitToNative(config),Promise.resolve()}return Promise.all([cpe.GetParameterValues(parameterArr)]).then(success)},disconnect:function(items){function getMacs(group){return group.map(function(item){return item.MAC}).join(" ")}var groupItems=_.groupBy(items,"Link"),disconnetParams=_.map(groupItems,function(group){return{Name:group[0].Link+"DisconnectStation",Value:getMacs(group)}});return cpe.SetParameterValues(disconnetParams)},getClients:getClients,isSupported5G:isSupported5G}}])}();