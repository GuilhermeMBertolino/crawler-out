"use strict";!function(){function WifiAPSettings($scope,$state,device,cookie,history,translate,wifiCommonShared){function getEncrypTypes(){var operatingStands=wifi.general&&wifi.general.data&&wifi.general.data.OperatingStandards?wifi.general.data.OperatingStandards:standards,modeAvailable=wifi.general&&wifi.general.data&&wifi.general.data.ModeAvailable?wifi.general.data.ModeAvailable:availableModes;return helper.getEncrypTypes(wifi.ap.data,operatingStands,modeAvailable)}function changeBandwidthRestricted(value){!wifi.ap.data||_.isNull(value)||_.isUndefined(value)||(value?$scope.BandwidthRestrictedBackup&&(wifi.ap.data.BandwidthRestricted=angular.copy($scope.BandwidthRestrictedBackup),$scope.BandwidthRestrictedBackup=null):($scope.BandwidthRestrictedBackup=angular.copy(wifi.ap.data.BandwidthRestricted),wifi.ap.data.BandwidthRestricted=0))}function isEdit(){return"edit"===action}function isAdd(){return"add"===action}function isChange(){var currentNativeConfig=angular.copy(wifi.ap.data);return currentNativeConfig.Profile=backupData.Profile,_.size(device.funcs.getChanges(currentNativeConfig,backupData))}function getSSID(currentProfile){var _wifi$apProfilesList$;return null===(_wifi$apProfilesList$=wifi.apProfilesList.find(function(profile){return profile.value===currentProfile}))||void 0===_wifi$apProfilesList$?void 0:_wifi$apProfilesList$.name}var helper=device.wifi.helper,action=$state.current.name.split(".").pop(),freq=$state.params.freq,isAPMode="ap"===cookie.get("device_mode"),standards=null,backupData=null,availableModes=null,wifi=$scope.wifi;wifi.ap={data:null,pmfList:null,supportedParam:function(param,subPath){var band=device.wifi.getBand(0),root=subPath?subPath+".":"";return band.ap.supportedParam(param,root)},supportedModes:function(){if(!wifi.ap.data)return[];var operatingStands=wifi.general&&wifi.general.data&&wifi.general.data.OperatingStandards?wifi.general.data.OperatingStandards:standards,modeAvailable=wifi.general&&wifi.general.data&&wifi.general.data.ModeAvailable?wifi.general.data.ModeAvailable:availableModes,modesTemplate=helper.getTempModes(modeAvailable,operatingStands);wifi.ap.pmfList=helper.getPMFList(operatingStands,wifi.ap.data.Security.ModeEnabled,modeAvailable);var modesSupported=wifi.ap.data.Security.ModesSupported.split(","),modes=_.filter(modesTemplate,function(obj){return~_.indexOf(modesSupported,obj.value)});return $scope.customRules.ExcludeWifiSecurityMode&&(modes=_.filter(modes,function(item){return!_.some($scope.customRules.ExcludeWifiSecurityMode,function(exclude){return exclude==item.value})})),_.findWhere(modes,{value:wifi.ap.data.Security.ModeEnabled})||(wifi.ap.data.Security.ModeEnabled=modes[0].value),_.each(modes,function(item,index){/mixed/.test(item.name)&&(modes[index].name=item.name.replace("mixed",translate("wifi_mixed")))}),modes},showSecurity:function(type){var operatingStands=wifi.general&&wifi.general.data&&wifi.general.data.OperatingStandards?wifi.general.data.OperatingStandards:standards,modeAvailable=wifi.general&&wifi.general.data&&wifi.general.data.ModeAvailable?wifi.general.data.ModeAvailable:availableModes;return helper.checkSecurityType(type,wifi.ap.data,operatingStands,modeAvailable)},showPreAuth:function(mode){return"WPA2-Enterprise"==mode||"WPA-WPA2-Enterprise"==mode},getEncrypTypes:getEncrypTypes,getDefaultKeysID:function(){return helper.getDefaultKeysID()},getPMFList:function(){var frames=[{name:"wifi_protected_frames_without",value:"NoMgmtFrameProtection"},{name:"wifi_protected_frames_optional",value:"MgmtFrameProtectionOptional"},{name:"wifi_protected_frames_required",value:"MgmtFrameProtectionRequired"}],supportedFrames=[];return _.each(frames,function(elem){-1!=_.indexOf(wifi.ap.pmfList,elem.value)&&supportedFrames.push(elem)}),supportedFrames},validWEPKey:function(wepKey){return wifi.ap.data?helper.validWEPKey(wepKey,wifi.ap.data):null},validPSKKey:function(pskKey){var messErr=helper.validPSKKey(pskKey);return messErr},validRadiusSecret:function(secret){return autoconf.BR2_PACKAGE_ANWEB_DSYSINIT?helper.validRadiusParamLen(secret):null},getWEPKeyLenMessage:function(){return wifi.ap.data?helper.getWEPKeyLenMessage(wifi.ap.data):null},isOpen:function(){var operatingStands=wifi.general&&wifi.general.data&&wifi.general.data.OperatingStandards?wifi.general.data.OperatingStandards:standards,modeAvailable=wifi.general&&wifi.general.data&&wifi.general.data.ModeAvailable?wifi.general.data.ModeAvailable:availableModes;return helper.isOpen(wifi.ap.data,operatingStands,modeAvailable)},isEdit:isEdit,isAdd:isAdd,isChange:isChange,isShowGuestAccess:function(){return(isAdd()||$state.params.inx>1)&&!isAPMode},initNSG:function(){_.isUndefined(backupData.NSG)&&(backupData.NSG=wifi.ap.data.NSG=!1)},changeBandwidthRestricted:changeBandwidthRestricted,generatePreSharedKey:function(){for(var result="",words="0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM",maxPosition=words.length-1,i=0;10>i;++i){var position=Math.floor(Math.random()*maxPosition);result+=words.substring(position,position+1)}wifi.ap.data.Security.PreSharedKey=result},isDisabledPMF:function(){return"WPA3"==wifi.ap.data.Security.ModeEnabled||"WPA2-WPA3"==wifi.ap.data.Security.ModeEnabled},setPMF:function(){if(wifi.ap.supportedParam("ProtectedManagementFrames","Security")){var mode=wifi.ap.data.Security.ModeEnabled;wifi.ap.data.Security.ProtectedManagementFrames="WPA3"==mode?"MgmtFrameProtectionRequired":"WPA2-WPA3"==mode?"MgmtFrameProtectionOptional":"NoMgmtFrameProtection"}}},wifi.apProfilesList=null,wifi.inputFields={apProfile:null},$scope.schedule={active:!1},$scope.BandwidthRestricted={enable:null,min:"1",max:"2.4GHz"==freq?"150":"450"},$scope.$watch(getEncrypTypes,function(types){if(types&&types.length&&wifi.ap.data){var encr=wifi.ap.data.Security.EncryptionType;_.contains(types,encr)||(wifi.ap.data.Security.EncryptionType=types[0])}},!0),$scope.$watch("wifi.advancedAp.bandwidthRestrictedEnable",changeBandwidthRestricted),$scope.$watch("wifi.inputFields.apProfile",function(newValue,oldValue){if(newValue!==oldValue&&![void 0,null].includes(newValue))if(newValue!==wifi.ap.data.Profile&&confirm("".concat(translate("act_apply")," ").concat(translate("profile"),' "').concat(getSSID(newValue),'"?'))){var argumentsForApply=null;wifi.ap.data.Profile=newValue,isAdd()&&(wifi.ap.data._noNewProfile=!0,argumentsForApply={action:"ap",freq:freq}),wifiCommonShared.apply(argumentsForApply)}else setTimeout(function(){return wifi.inputFields.apProfile=angular.copy(wifi.ap.data.Profile)},0)}),function(){function getWifiApProfilesList(){function removeCurrent(profile){var _wifi$ap$data;return isAdd()||profile!=(null===(_wifi$ap$data=wifi.ap.data)||void 0===_wifi$ap$data?void 0:_wifi$ap$data.Profile)?!0:!1}var usedProfiles=Object.values(band.radio.AccessPoint).map(function(ap){return ap.Profile}).filter(removeCurrent),listFiltered=rootData.Device.WiFi.apProfilesList.filter(function(profile){return!usedProfiles.includes(profile.value)});return listFiltered}var inxSsid,band=device.wifi.getBand(0),apHelper=band.ap,rootData=device.wifi.getRootData();wifi.isEasyMeshEnabled=rootData.Device.EasyMeshEnable,standards=band.radio.OperatingStandards,availableModes=band.radio.ModeAvailable,isEdit()?(history.setCleanLastHistory(!0),inxSsid=$state.params.inx,wifi.ap.data=apHelper.get(inxSsid)):isAdd()?(history.setCleanLastHistory(!0),inxSsid=apHelper.add(apHelper.getDefault()),wifi.ap.data=apHelper.get(inxSsid)):wifi.ap.data=apHelper.getBase(),wifi.apProfilesList=getWifiApProfilesList(),wifi.ap.inxRadio=band.radio.Inx,wifi.ap.inxSsid=_.isUndefined(inxSsid)?"1":inxSsid,$scope.BandwidthRestricted.enable=0!=wifi.ap.data.BandwidthRestricted,wifi.inputFields.apProfile=angular.copy(wifi.ap.data.Profile),backupData=angular.copy(wifi.ap.data),device.wifi.setEditedAP(wifi.ap.inxRadio,wifi.ap.inxSsid)}()}angular.module("app").controller("WifiAPSettings",WifiAPSettings),WifiAPSettings.$inject=["$scope","$state","device","cookie","history","translate","wifiCommonShared"]}();