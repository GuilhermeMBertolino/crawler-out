"use strict";!function(){angular.module("app").service("urlfilterUtil",["cpe","device","funcs","navShared","$injector",function(cpe,device,funcs,navShared){var firewallShared,dsysinitConfig=null,dsysinitAttrs=null,nativeConfig=null,converter=device.urlfilter.converter,Helper=device.urlfilter.Helper,paths={serviceURL:"Device.Services.URLFilter."},pullValues=[paths.serviceURL],pullAttrs=[paths.serviceURL],deviceMode=navShared.deviceMode,isFirewallMode=navShared.isFirewallMode;return{pull:function(){function success(response){return dsysinitConfig=response[0].result.Config,dsysinitAttrs=response[1].result.Datamodel,dsysinitConfig.IsDNSFilter=autoconf.BR2_PACKAGE_ANWEB_DNS_FILTER,dsysinitConfig.isFirewallMode=isFirewallMode,nativeConfig=converter.dsysinitToNative(dsysinitConfig),angular.copy(nativeConfig),Promise.resolve()}return Promise.all([cpe.GetConfig(pullValues),cpe.GetDatamodel(pullAttrs)]).then(success)},push:function(settings,instance){function __prepareConfigs(){settings.config.IsDNSFilter=autoconf.BR2_PACKAGE_ANWEB_DNS_FILTER,settings.config.isFirewallMode=isFirewallMode,nativeConfig.config.IsDNSFilter=autoconf.BR2_PACKAGE_ANWEB_DNS_FILTER,nativeConfig.config.isFirewallMode=isFirewallMode}__prepareConfigs();var newCpeConfig=converter.nativeToDsysinit(settings),initCpeConfig=converter.nativeToDsysinit(nativeConfig);isFirewallMode&&"new_filter"==instance&&(newCpeConfig=firewallShared.firewallAutoConfig(newCpeConfig,paths.serviceURL+instance,"Dual"));var diff=funcs.newConfig.makeDiff(initCpeConfig,newCpeConfig,dsysinitAttrs);return cpe.ApplyDifference(diff)},makeHelper:function(index){function makeWorkList(list){return _.map(list,function(elem){var obj={};return obj=angular.copy(elem)})}var helperConfig=nativeConfig.config;index&&(helperConfig=_.find(nativeConfig.config,function(elem){return elem.__id==index}),helperConfig||(helperConfig={}));var workList=makeWorkList(helperConfig.list),dsysinit={config:dsysinitConfig,attrs:dsysinitAttrs};return new Helper(helperConfig,helperConfig.list,workList,dsysinit)},needPrepareSettings:function(){return!1},deviceMode:deviceMode}}])}();