"use strict";!function(){angular.module("app").controllerProvider.register("DmzCtrl",["$scope","$state","dmzUtil","funcs","devinfo",function($scope,$state,util,funcs,devinfo){function activate(){function success(){dmz.data=util.getConfig(),__backupRule=funcs.deepClone(dmz.data);var conf=dmz.data;$scope.schedule.isDisabled=!conf.dmz.ip,$scope.indexesLink=conf.dmz.__indexDMZRule,dmz.isActivate=!0,$scope.$emit("pageload")}function error(){$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})}function stopOverlay(){overlayId&&($scope.overlay.circular.stop(overlayId),overlayId=null)}util.pull().then(success)["catch"](error)["finally"](stopOverlay),devinfo.once("net").then(function(data){$scope.dmz.lans=data.lan})}function showIpWarning(){if($scope.dmz.data&&$scope.dmz.data.dmz&&$scope.dmz.data.dmz.enable&&funcs.is.ipv4($scope.dmz.data.dmz.ip)){if(!isLanIp($scope.dmz.data.dmz.ip,$scope.dmz.lans))return!0;if(util.disableUseLanIp()&&isRouterIp($scope.dmz.data.dmz.ip,$scope.dmz.lans))return!0}return!1}function isLanIp(ip,lans){function getIPv4validator(lan){if(lan.ip&&lan.mask){var range=funcs.ipv4.subnet.getNetworkRange(lan.ip,lan.mask);return function(addr){return funcs.ipv4.subnet.belongNetworkRange(range,addr)}}}if(_.isUndefined(lans))return!0;var lanCheckers=_.map(lans,getIPv4validator);return _.some(lanCheckers,function(checkLan){return _.isUndefined(checkLan)?!0:checkLan(ip)})}function isRouterIp(ip,lans){return _.isUndefined(lans)?!1:_.some(lans,function(lan){return ip==lan.ip})}function wasModified(){return __backupRule&&!_.isEqual(__backupRule,dmz.data)}function checkSnatDefaultEnable(){util.snatDefaultEnable()&&(dmz.data.dmz.enable_snat=!0)}$scope.dmz={isActivate:!1,data:null,apply:function(){function error(response){overlayId&&($scope.overlay.circular.stop(overlayId),overlayId=null),$state.go("error",{code:"msg_push_error",message:"msg_error_desc"})}$scope.form.$invalid&&(dmz.data.dmz.enable||dmz.data.superDmz&&dmz.data.superDmz.enable)||(overlayId=$scope.overlay.circular.start(),dmz.data.dmz.enable||(dmz.data.dmz=_.extend(dmz.data.dmz,__backupRule.dmz),checkSnatDefaultEnable(),dmz.data.dmz.enable=!1),util.apply(dmz.data).then(activate)["catch"](error))},useEnableSNAT:function(){return util.useEnableSNAT()},wasModified:wasModified,needDisableApply:function(){return!wasModified()||autoconf.BR2_PACKAGE_ANWEB_CUSTOM_PARTNER_23078&&showIpWarning()},showIpWarning:showIpWarning,getIpWarning:function(){return isLanIp($scope.dmz.data.dmz.ip,$scope.dmz.lans)?isRouterIp($scope.dmz.data.dmz.ip,$scope.dmz.lans)?"apps_partner_ip_is_router_ip":void 0:"dmz_ip_warning"},checkSnatDefaultEnable:checkSnatDefaultEnable};var dmz=$scope.dmz,__backupRule=null,overlayId=null;$scope.schedule={active:!1},activate()}])}();