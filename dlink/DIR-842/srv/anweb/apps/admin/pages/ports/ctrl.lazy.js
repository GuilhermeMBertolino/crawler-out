"use strict";angular.module("app").controllerProvider.register("PortsCtrl",["$scope","$state","translate","ngDialog","funcs","PortSettingsUtil",function($scope,$state,translate,ngDialog,funcs,util){function init(overlayId){function success(){$scope.preload=!1,overlayId&&overlay.stop(overlayId),helper=util.makeHelper(),updatePorts(helper.getData()),$scope.global=helper.getGlobalData(),backup=funcs.deepClone($scope.global),isSubscribe||(isSubscribe=!0,util.subscribe(updatePorts,$scope)),$scope.$emit("pageload"),$scope.$watch("ports",function(){return $scope.ports})}function updatePorts(data){$scope.ports=data}util.pull().then(success)["catch"](errorPull)}function errorPull(overlayId){overlayId&&overlay.stop(overlayId),$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})}var helper,backup,overlay=$scope.overlay.circular,isSubscribe=!1;!function(){util.preload().then(function(){helper=util.makeHelper(),$scope.ports=helper.getData(),$scope.preload=!0,$scope.$emit("pageload")})["finally"](init)}(),$scope.wasModified=function(){return!angular.equals($scope.global,backup)},$scope.apply=function(){function error(){overlayId&&overlay.stop(overlayId),$state.go("error",{code:"msg_push_error",message:"msg_error_desc"})}if(!$scope.ports_form.$invalid){var overlayId=overlay.start();util.applyGlobal($scope.global).then(init.bind(null,overlayId))["catch"](error)}},$scope.edit=function(port,isRange){isRange&&(port={advertisement:{"10M-Full":!0,"10M-Half":!0,"100M-Full":!0,"100M-Half":!0,"1000M-Full":!0},enable:!0,autonegotiation:!0,flowControl:"Off",pause:!1,speed:"1000M-Full",status:"Up",mdix:"Auto",preferenceMode:"Auto"}),ngDialog.open({template:"/admin/dialogs/port_settings/dialog.tpl.html",className:"port_settings_dialog",controller:"PortSettingsDialogCtrl",resolve:funcs.getLazyResolve("/admin/dialogs/port_settings/ctrl.lazy.js","PortSettingsDialogCtrl"),data:{port:port,notEdit:!port.advertisement||"SFP"==port.alias,isRange:isRange},scope:$scope}).closePromise.then(init)},$scope.getPortAdmin=function(port){return $scope.preload?"-":translate(port.enable?"st_enabled":"st_disabled")},$scope.getPortStatus=function(port){return $scope.preload?"-":translate("portctrl_status_"+port.status.toLowerCase())},$scope.getFlowControl=function(port){return $scope.preload?"-":"Enabled"==port.flowControl?"st_enabled":"Disabled"==port.flowControl?"st_disabled":"Up"!==port.status||"Unknown"===port.flowControl?"-":"Off"==port.flowControl?translate("portctrl_status_off"):port.flowControl},$scope.getSpeed=function(port){return $scope.preload?"-":"Up"!==port.status?"-":"0M-Full"==port.speed||"0M-Half"==port.speed?"auto":port.speed},$scope.getShort=function(port){return $scope.preload?"-":$scope.getPortStatus(port)},$scope.getPortClass=function(port){return $scope.preload?"":"status ".concat(port.status)},$scope.getAutonegotiation=function(port){return $scope.preload?"-":"autonegotiation"in port?translate(port.autonegotiation?"on":"off"):"-"},$scope.getMDIX=function(port){return $scope.preload?"-":port.mdix?"Auto"==port.mdix?"auto":port.mdix:"stats_ports_unsupported"},$scope.getMaxReceiveFrameSize=function(port){return $scope.preload?"-":port.maxReceiveFrameSize}}]);