"use strict";angular.module("app").factory("lanPage",["cpe","devinfo","funcs","WorkDataKeeper","$q",function(cpe,devinfo,funcs,WorkDataKeeper,$q){var workDataKeeper,viewBasePath="View.LAN.";return{pull:function(path){path||(path="List.");var paths=[viewBasePath+path];return paths.push("Device.WiFi.Radio.*.Advanced."),cpe.GetParameterValues(paths).then(function(response){return workDataKeeper=new WorkDataKeeper(response.result.ParameterList),workDataKeeper.workTree})},setData:function(data,attrs){return workDataKeeper=new WorkDataKeeper.fromTree(data,attrs),workDataKeeper.workTree},push:function(){var diff=workDataKeeper.makeDiffTree(),d=$q.defer();return cpe.ApplyDifference(diff).then(function(data){d.resolve({data:data,status:"Success"})})["catch"](function(error){error&&error.error&&error.error.code?d.reject({error:error,status:"ApplyError"}):d.resolve({error:error,status:"HTTPError"})}),d.promise},subscribe:function($scope,handler,paths){paths||(paths=["List."]);var branches=paths.map(function(e){return viewBasePath+e}),areas=branches.join("|"),checksum=null;devinfo.subscribe(areas,function(response){if(response){var obj,value,__checksum=funcs.checksum(funcs.stringifyJSONStable(response));if(__checksum!=checksum){for(var key in response)"infoAreasStatus"!=key&&(obj=response[key],obj&&(value=funcs.findBranch(obj,key),workDataKeeper.updatePath(key,value)));handler(),checksum=__checksum}}},$scope)},changed:function(){return workDataKeeper.makeDiffTree().length},getWorkDataKeeper:function(){return workDataKeeper},haveAPFeatures:function(ipvx){return"Unknown"!=ipvx.AddressingType}}}]);