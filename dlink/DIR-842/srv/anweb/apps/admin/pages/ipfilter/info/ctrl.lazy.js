"use strict";!function(){angular.module("app").controllerProvider.register("IPFilterInfoCtrl",["$scope","$state","translate","ipfilterUtil",function($scope,$state,translate,util){function activate(){function success(){helper=util.makeHelper(),ipfilter.isActivate=!0,ipfilter.rules=helper.getRules(),$scope.$emit("pageload")}function error(){$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})}function stopOverlay(){overlayId&&($scope.overlay.circular.stop(overlayId),overlayId=null)}util.pull().then(success)["catch"](error)["finally"](stopOverlay)}function add(){$state.go(currentState+".add")}function edit(item,inx){$state.go(currentState+".edit",{inx:inx,useSchedule:item.useSchedule})}function getSource(item){return getRange(item,"ips","ports",!0)}function getDestination(item){return getRange(item,"ipd","portd",!0)}function getRange(item,ipField,portField,isMiniTable){var port,ip;return ip=""!=item[ipField]&&"0.0.0.0/0"!=item[ipField]?item[ipField].split("-").join(" - "):isMiniTable?translate("all"):escapeHtml("all"),port=item[portField]?item[portField]:isMiniTable?translate("all"):escapeHtml("all"),"[".concat(ip,"] : [").concat(port,"]")}function escapeHtml(){var str=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",strTranslate=translate(str),escapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};if("string"==typeof strTranslate){var escapesReg=new RegExp(Object.keys(escapes).join("|"),"g");return strTranslate.replace(escapesReg,function(s){return escapes[s]})}return""}function isSupported(param){return helper?helper.isSupported(param):void 0}$scope.ipfilter={isActivate:!1,rules:null,add:add,edit:edit,remove:function(items,indexes){function error(){$state.go("error",{code:"msg_remove_error",message:"msg_rpc_remove_error"})}if(confirm(translate("ipflt_remove_rules_warn"))){overlayId=$scope.overlay.circular.start();var removeList=helper.makeRemoveList(indexes);util.removeRules(removeList).then(activate)["catch"](error)}},getSource:getSource,getDestination:getDestination,getSourceDestination:function(item){function formIPv6SourceDestination(item){function getIpv6Str(ipv6,param){if(ipv6){var result="";result+="<span>[</span>";var arrIPv6=ipv6.split("-");return"source"==param&&($scope.ipsource=arrIPv6,result+="<span ipv6cut='ipsource[0]'></span>",$scope.ipsource[1]&&(result+="<span> - </span>",result+="<span ipv6cut='ipsource[1]'></span>")),"dest"==param&&($scope.ipdest=arrIPv6,result+="<span ipv6cut='ipdest[0]'></span>",$scope.ipdest[1]&&(result+="<span> - </span>",result+="<span ipv6cut='ipdest[1]'></span>")),result+="<span>]</span>"}}var ipsstr=item.ips&&""!=item.ips&&"0.0.0.0/0"!=item.ips?getIpv6Str(item.ips,"source"):"<span>["+escapeHtml("all")+"]</span>",ports=item.ports||escapeHtml("all"),ipdstr=item.ipd&&""!=item.ipd&&"0.0.0.0/0"!=item.ipd?getIpv6Str(item.ipd,"dest"):"<span>["+escapeHtml("all")+"]</span>",portd=item.portd||escapeHtml("all"),resultStr="";return resultStr=resultStr+"<div class='not_break_block'>"+ipsstr+" : ["+ports+"]</div>",resultStr+="<div> - </div>",resultStr=resultStr+"<div class='not_break_block'>"+ipdstr+" : ["+portd+"]</div>"}if(item.is_ipv6)return formIPv6SourceDestination(item);var resStr="<div class='not_break_block'>"+getRange(item,"ips","ports")+"</div>";return resStr+="<div> - </div>",resStr+="<div class='not_break_block'>"+getRange(item,"ipd","portd")+"</div>"},getMiniCaption:function(item){return _.has(item,"name")?item.name:_.has(item,"id")?translate("rule")+" â„–"+item.id:void 0},getMiniInfo:function(item){var info=[];return info.push(translate("protocol")+": "+item.proto),info.push(translate("ip_version")+": "+item.IPVersion),info.push(translate("source")+": "+getSource(item)),info.push(translate("dest")+": "+getDestination(item)),info.push("act_allow"==item.action?translate("action")+": "+translate("act_allow"):translate("action")+": "+translate("act_deny")),info.push(item.state?translate("state")+": "+translate("st_enabled"):translate("state")+": "+translate("st_disabled")),info},isSupported:isSupported,isEmptyRules:function(){return!ipfilter.rules||0==ipfilter.rules.length},getDirection:function(item){var type=item.is_ipv6?"v6":"v4",sourceDirs=helper.getSourceDirections(type),destDirs=helper.getDestDirections(type),sourceDir=_.findWhere(sourceDirs,{value:item.sourceDirection}),destDir=_.findWhere(destDirs,{value:item.destDirection});return translate(sourceDir.name)+" -> "+translate(destDir.name)}};var helper,overlayId=null,ipfilter=$scope.ipfilter;activate();var currentState=$state.current.name.split(".");currentState.pop(),currentState=currentState.join(".")}])}();