"use strict";function _typeof(obj){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _regeneratorRuntime(){function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state="suspendedStart";return function(method,arg){var delegate,delegateResult,record;if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){if(delegate=context.delegate,delegate&&(delegateResult=maybeInvokeDelegate(delegate,context))){if(delegateResult===ContinueSentinel)continue;return delegateResult}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);if(state="executing",record=tryCatch(innerFn,self,context),"normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg)})})}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var result,value,record=tryCatch(generator[method],generator,arg);return"throw"!==record.type?(result=record.arg,value=result.value,value&&"object"==_typeof(value)&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)}):PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result)},function(error){return invoke("throw",error,resolve,reject)})):void reject(record.arg)}var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(void 0===method){if(context.delegate=null,"throw"===context.method){if(delegate.iterator["return"]&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){var iteratorMethod,i,next;if(iterable){if(iteratorMethod=iterable[iteratorSymbol])return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length))return i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next},next.next=next}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}_regeneratorRuntime=function(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}exports.wrap=wrap;var ContinueSentinel={},IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,function(){return this});var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);return GeneratorFunction.prototype=GeneratorFunctionPrototype,define(Gp,"constructor",GeneratorFunctionPrototype),define(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,function(){return this}),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,function(){return this}),define(Gp,"toString",function(){return"[object Generator]"}),exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(var key;keys.length;)if(key=keys.pop(),key in object)return next.value=key,next.done=!1,next;return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}if(this.done)throw exception;var i,entry,record,hasCatch,hasFinally,context=this;for(i=this.tryEntries.length-1;i>=0;--i){if(entry=this.tryEntries[i],record=entry.completion,"root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev)if(hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc"),hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}},abrupt:function(type,arg){for(i=this.tryEntries.length-1;i>=0;--i)if(entry=this.tryEntries[i],entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){finallyEntry=entry;break}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var i,entry,finallyEntry,record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){var i,entry;for(i=this.tryEntries.length-1;i>=0;--i)if(entry=this.tryEntries[i],entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel},"catch":function(tryLoc){var i,entry,record,thrown;for(i=this.tryEntries.length-1;i>=0;--i)if(entry=this.tryEntries[i],entry.tryLoc===tryLoc)return record=entry.completion,"throw"===record.type&&(thrown=record.arg,resetTryEntry(entry)),thrown;throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){var i,arr2;for((null==len||len>arr.length)&&(len=arr.length),i=0,arr2=new Array(len);len>i;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i["return"]||_i["return"]()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){return Array.isArray(arr)?arr:void 0}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){var info,value;try{info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}var gen=fn.apply(self,args);_next(void 0)})}}!function(){function SysConfigCtrl($scope,$state,$q,$timeout,$rootScope,$injector,cpe,devinfo,util,translate,device,snackbars,funcs,navigationFilter,ngDialog){function init(){function success(res){var param=res[0],langNames=res[1].data;if(param.mode&&(config.mode.name=param.mode.name,config.mode.hasHwModeSwitch=param.mode.hasHwModeSwitch,config.mode.value=param.mode.value,config.mode.list=_.map(param.mode.list,function(item){return{Value:item,Name:item}})),config.user.name=param.user?param.user.name:"",config.user.list=param.user?param.user.list:null,config.lang.value=langNames[param.lang.value],config.lang.list=_.values(langNames),param.autoreboot&&(config.autoreboot.isShow=!0,config.autoreboot.data=param.autoreboot,config.autoreboot.data.period/=60,config.autoreboot.backup=funcs.deepClone(config.autoreboot.data)),param.webInterface&&(config.webInterface.data=param.webInterface,config.webInterface.backup=funcs.deepClone(config.webInterface.data)),param.autoPingReboot&&(config.autoPingReboot.data=param.autoPingReboot,config.autoPingReboot.backup=funcs.deepClone(config.autoPingReboot.data)),param.backup&&(backupDefaultFileName=param.backup.filename,config.backup.isFactorySettings=param.backup.isFactorySettings),param.schedule&&param.schedule.tree){var tree=param.schedule.tree;config.schedule.rules=tree.Device.System.Scheduler.Config,param.schedule.attrs,firewall=param.schedule.firewall,config.schedule.isActivate=!0,$scope.$emit("pageload"),helper=new device.schedule.helper(config.schedule.rules),config.schedule.rules=helper.convertRules(),commands.tree=tree.Device.System.Scheduler.Commands,helperCmd=helper.commands();var autobackup=helperCmd.getCommand(commands.tree,tree,"upload_config");if(config.schedule.usbPath=getAutobackupArgs(tree.Device.System.Command).usbPath,config.schedule.filename=getAutobackupArgs(tree.Device.System.Command).filename,autobackup.length){{config.schedule.autobackup.state}config.schedule.autobackup.state.enable=!0,_.each(autobackup,function(cmd){commands.upload_config.push(cmd),config.schedule.autobackup.state.schedule.push(scheduler.translateSchedule(helper.convertCronToUserString(cmd.Cron)))})}_.each(config.schedule.rules,function(item,i){config.schedule.rules[i].interval=scheduler.translateSchedule(item.interval),config.schedule.rules[i].duration=scheduler.translateSchedule(item.duration.toString())})}}function getAutobackupArgs(tree){var args={usbPath:"",filename:""},backupSchedule=_.find(tree,function(elem){return"upload_config"==elem.Command});if(backupSchedule){var arr=backupSchedule.Arguments.split("file:///tmp/mnt")[1].split("/");_.each(arr,function(elem){return args.usbPath+=_.isEmpty(elem)||/tar\.gz/.test(elem)?"":"/"+elem}),args.filename=/\.tar\.gz/.test(arr[arr.length-1])?arr[arr.length-1].split(".")[0]:null}return args}function error(err){$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})}Promise.all([util.getInitParams(),translate.getLangNames()]).then(success).then(checkRules)["catch"](error)["finally"]($scope.$emit.bind($scope,"pageload"))}function reboot(opts){function error(msg){msg&&"not_confirm"==msg||("factory"==opts.mode||"factory_force"==opts.mode?location.href=location.protocol+"//192.168.0.1":snackbars.add(translate("configRebootError")))}function success(){("factory"==opts.mode||"factory_force"==opts.mode)&&(location.href=location.protocol+"//192.168.0.1")}var rebootMess,prepareAction="confirm";return opts=opts||{},"restore"==opts.mode?rebootMess="sysconfig_config_restore_confirm":"factory"==opts.mode?rebootMess="notice_save_and_reboot_confirm":"factory_force"==opts.mode?prepareAction="bypass":rebootMess="sysconfig_config_reboot_confirm",confirmPromise(translate(rebootMess),prepareAction).then(util.reboot.bind(util,opts.mode)).then(snackbars.add.bind(snackbars,translate("sysconfig_reboot_ok"))).then(success)["catch"](error)}function isResponseSucceed(data){return!_.isEmpty(data)&&0!=data.status}function getBackupWithThrottle(){return _.throttle(util.backup,3e3,{trailing:!1})}function showUserDialog(options){function startDialog(options){return ngDialog.open({template:"/admin/dialogs/config_user/dialog.tpl.html",controller:"ConfigUserDialogCtrl",scope:$scope,data:{data:options,allUsername:_.pluck(config.user.table,"Username")}})}function closeDialog(result){function success(){init(),snackbars.add("msg_rpc_write_success")}function error(){snackbars.add(translate("msg_rpc_write_error"))}if(result&&result.value){var overlayId=overlay.start();util.applyUser(result.value.user,config.user.tableTemplate).then(success)["catch"](error)["finally"](overlay.stop.bind(overlay,overlayId))}}startDialog(options).closePromise.then(closeDialog)}function showWebInterface(param){return param?showWebInterface()&&!_.isUndefined(config.webInterface.backup[param]):config.webInterface.backup&&_.size(config.webInterface.backup)}function confirmPromise(msg,mode){var deferred=$q.defer();return"bypass"==mode?deferred.resolve():confirm(msg)?deferred.resolve():deferred.reject("not_confirm"),deferred.promise}function checkRules(){function hasFirewall(rules){return _.some(rules,function(rule){return _.some(rule.genInfo.tasks,function(task){return/Device.Firewall./.test(task.Link)})})}if(hasFirewall(config.schedule.rules)){var getIpVersionIpFilter=function(item){return item.is_ipv6?"IPv6":"IPv4"},converterIpFilter=device.ipfilter.ipfilterConverter.dsysinitToNative,converterMacFilter=device.macfilter.converter.dsysinitToNative.config,converterUrlFilter=device.urlfilter.converter.dsysinitToNative,rules=config.schedule.rules;rules=scheduler.addRuleNamesToTasks(rules,converterIpFilter(firewall),"ipfilter",[getIpVersionIpFilter,"__index"]),rules=scheduler.addRuleNamesToTasks(rules,converterMacFilter({config:firewall}).Rules,"macfilterIPv4");var dataUrlFilter=converterUrlFilter(firewall).config;rules=scheduler.addRuleNamesToTasks(rules,dataUrlFilter,"urlfilterEnable",[function(){return"IPv4"},"__ruleIdIPv4"]),rules=scheduler.addRuleNamesToTasks(rules,dataUrlFilter,"urlfilterEnable",[function(){return"IPv6"},"__ruleIdIPv6"])}}function clearInternalStorage(){return _clearInternalStorage.apply(this,arguments)}function _clearInternalStorage(){return _clearInternalStorage=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){var overlayId,response,getListUsedBy;return _regeneratorRuntime().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(getListUsedBy=function(processesTree){var processesNames=[];return funcs.newConfig.instanceObjectToArray(processesTree).forEach(function(process){return processesNames.push(process.ProcessName)}),processesNames.join(", ")},confirm(translate("domoticz_backup_prepare")+"?")){_context.next=3;break}return _context.abrupt("return");case 3:return overlayId=overlay.start(),_context.prev=4,_context.t0=funcs,_context.next=8,cpe.Execute("Device.System.Storage.1.EraseAndRemount.");case 8:_context.t1=_context.sent.result.ParameterList,response=_context.t0.buildTree.call(_context.t0,_context.t1),_context.t2=response.EraseAndRemountCode,_context.next=0===_context.t2?13:8===_context.t2?13:10===_context.t2?14:16;break;case 13:return _context.abrupt("break",18);case 14:return alert(translate("system_clear_internal_storage_error_busy",{list:getListUsedBy(response.ProcessesUsingStorage)})),_context.abrupt("break",18);case 16:return alert(translate("system_clear_internal_storage_error_reboot")),_context.abrupt("break",18);case 18:_context.next=23;break;case 20:_context.prev=20,_context.t3=_context["catch"](4),alert(translate("internal_error"));case 23:return _context.prev=23,overlay.stop(overlayId),_context.finish(23);case 26:case"end":return _context.stop()}},_callee,null,[[4,20,23,26]])})),_clearInternalStorage.apply(this,arguments)}if($injector.has("scheduler"))var scheduler=$injector.get("scheduler");$scope.customRules=navigationFilter.rules()||{},$scope.config={save:function(saveAsDefault){var overlayId=overlay.start();util.save(saveAsDefault).then(snackbars.add.bind(snackbars,translate("sysconfig_save_ok")))["catch"](snackbars.add.bind(snackbars,translate("sysconfig_save_ok")))["finally"](overlay.stop.bind(overlay,overlayId)),init()},reset:function(cleanAll){function __reset(){return util.reset(cleanAll).then(function(){$rootScope.pageDetails.sysConfig[0].go(autoconf.BR2_PACKAGE_ANWEB_DEVICE_DEFAULT_IP)})["catch"](snackbars.add.bind(snackbars,translate("sysconfig_factory_error")))}function getFactoryConfirmMsg(){if(config.mode&&config.mode.name&&config.mode.hasHwModeSwitch)var msg="sysconfig_factory_question_"+config.mode.name;else var msg="sysconfig_factory_question";return translate(msg)}var confirmMsg=getFactoryConfirmMsg();return confirmPromise(confirmMsg).then(__reset)},reboot:reboot,backup:{isFactorySettings:!1,openDialog:function(){if(config.backup.isFactorySettings)return!1;var __backup=getBackupWithThrottle();return __backup()}},backupDefault:function(){return _.throttle(util.backupDefault,3e3,{trailing:!1})}(),restore:{url:"/config_restore",useFormData:util.useFormData,prepare:function(cb){return util.restorePrepare(config.restore.url,cb)},begin:function(){config.overlay=overlay.start(),$scope.isupload=!1},end:function(data){overlay.stop(config.overlay);var data=data&&data.data||data;return data&&20051==data.status?void alert(translate("sysconfig_invalid_config_mode")):void(data&&data.status?reboot({mode:"restore"}):alert(translate("sysconfig_invalid_config")))},overlay:null,openDialog:function(){var dlg=ngDialog.open({template:"dialogs/system_config/restore/dialog.tpl.html",controller:"RestoreDialogController",className:"dlna-dialog dialog_fixed_footer",resolve:funcs.getLazyResolve("dialogs/system_config/restore/ctrl.lazy.js","RestoreDialogController"),data:{restoreFromPC:config.restore,restoreFromFlach:util.restore}});return dlg.closePromise.then(function(result){result&&result.value&&isResponseSucceed(result.value.data)&&snackbars.add("msg_rpc_write_success")})}},user:{name:"",password:"",confirm:"",list:null,changePassword:function(user,password){function success(msg){config.user.password="",config.user.confirm="",snackbars.add(translate("sysconfig_password_changed"))}function error(msg){var msg=msg||"sysconfig_password_not_changed";snackbars.add(translate(msg))}function notifyMobileApp(msg){$rootScope.dlinkMobileApp&&$rootScope.dlinkMobileApp.isUserInMobileApp()&&$rootScope.dlinkMobileApp.updatePassword({username:user,password:password})}if($scope.form_system_password.$valid){var overlayId=overlay.start();util.changePassword(user,password).then(success).then(notifyMobileApp)["catch"](error)["finally"](overlay.stop.bind(overlay,overlayId))}},changeLogin:function(){config.user.password="",config.user.confirm=""},addUser:function(){showUserDialog({Username:""})},editUser:function(item){showUserDialog({Username:item.Username,__id:item.__id})},deleteUser:function(items){function success(){snackbars.add(translate("msg_rpc_remove_success")),init()}var names=_.pluck(items,"Username");if(_.contains(names,config.user.name))return void alert(translate("msg_cant_remove_cur_user"));var overlayId=overlay.start();util.deleteUsers(items).then(success)["catch"](snackbars.add.bind(snackbars,translate("msg_rpc_remove_error")))["finally"](overlay.stop.bind(overlay,overlayId))}},mode:{value:null,list:null,change:function(data){if(confirm('Reboot in "'.concat(data,'"?'))){var overlayId=overlay.start();util.changeDeviceMode(data).then(snackbars.add.bind(snackbars,translate("msg_rpc_write_success")))["catch"](snackbars.add.bind(snackbars,translate("msg_rpc_write_error")))["finally"](overlay.stop.bind(overlay,overlayId))}}},lang:{value:null,list:null,change:function(lang){var lang=_.findKey(translate.langNames,function(value){return value===lang}),overlayId=overlay.start();util.changeLang(lang).then(translate.changeLanguage.bind(translate,lang))["catch"](snackbars.add.bind(snackbars,translate("sysconfig_change_lang_error")))["finally"](overlay.stop.bind(overlay,overlayId))}},webInterface:{data:null,backup:null,isShow:showWebInterface,isModified:function(){return config.webInterface.backup&&!_.isEqual(config.webInterface.backup,config.webInterface.data)},change:function(){var overlayId=overlay.start(),data=_.pick(config.webInterface.data,function(item,key){return item!=config.webInterface.backup[key]});config.webInterface.backup=funcs.deepClone(config.webInterface.data),util.changeWebInterface(data).then(snackbars.add.bind(snackbars,translate("msg_rpc_write_success")))["catch"](snackbars.add.bind(snackbars,translate("msg_rpc_write_error")))["finally"](overlay.stop.bind(overlay,overlayId))}},getConfigResetMessage:function(){if(config.mode&&config.mode.name&&config.mode.hasHwModeSwitch)var msg="sysconfig_reset_"+config.mode.name;else var msg="sysconfig_reset";return translate(msg)},autoreboot:{isShow:!1,data:{},backup:null,isModified:function(){return config.autoreboot.backup&&!_.isEqual(config.autoreboot.backup,config.autoreboot.data)},apply:function(){function success(){config.autoreboot.backup=funcs.deepClone(config.autoreboot.data),snackbars.add("msg_rpc_write_success")}function error(){snackbars.add("msg_rpc_write_error")}$scope.form_system_autoreboot.$invalid||util.changeAutoReboot(config.autoreboot.data).then(success,error)}},autoPingReboot:{data:null,backup:null,isShow:function(){return config.autoPingReboot.backup&&_.size(config.autoPingReboot.backup)},isModified:function(){return config.autoPingReboot.backup&&!_.isEqual(config.autoPingReboot.backup,config.autoPingReboot.data)},change:function(){function success(){config.autoPingReboot.backup=funcs.deepClone(config.autoPingReboot.data),snackbars.add("msg_rpc_write_success")}function error(){snackbars.add("msg_rpc_write_error")}$scope.form_system_autopingreboot.$invalid||util.changeAutoPingReboot(config.autoPingReboot.data).then(success,error)}},snapshots:{editSnapshot:function(item){return ngDialog.open({template:"dialogs/system_config/snapshot/edit/dialog.tpl.html",controller:"SnapshotEditDialogController",data:{snapshot:item},resolve:funcs.getLazyResolve("dialogs/system_config/snapshot/edit/ctrl.lazy.js","SnapshotEditDialogController"),scope:$scope,closeByEscape:!1})},addSnapshot:function(){function success(data){null!=data.value&&snackbars.add("msg_rpc_write_success"),init()}return ngDialog.open({template:"dialogs/system_config/snapshot/add/dialog.tpl.html",controller:"SnapshotAddDialogController",resolve:funcs.getLazyResolve("dialogs/system_config/snapshot/add/ctrl.lazy.js","SnapshotAddDialogController"),scope:$scope}).closePromise.then(success)},deleteSnapshot:function(items){function success(){snackbars.add("msg_rpc_remove_success"),init()}if(confirm(translate("sysconfig_snapshots_delete"))){var overlayId=overlay.start();util.deleteSnapshot(items).then(success)["finally"](overlay.stop.bind(overlay,overlayId))}},getSnapshotName:function(snapshot){return snapshot.IsAuto?translate("sysconfig_snapshots_auto"):snapshot.Name?snapshot.Name:"-"}},schedule:{isActivate:!1,rules:null,usbPath:null,filename:null,autobackup:{state:{enable:!1,schedule:[]}}},internalStorage:{clear:clearInternalStorage,getDesc:function(){var possibleSoftware={Domoticz:autoconf.BR2_PACKAGE_ANWEB_DOMOTICZ},desc=translate("system_clear_internal_storage_desc");return Object.entries(possibleSoftware).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),name=_ref2[0],exists=_ref2[1];exists&&(Object.keys(possibleSoftware)[0]!==name&&(desc="".concat(desc,",")),desc="".concat(desc," ").concat(name))}),desc}}};var config=$scope.config,overlay=$scope.overlay.circular,backupDefaultFileName="",helper=null,helperCmd=null,firewall=null,commands={tree:null,upload_config:[]};init(),$scope.getPassDesc=function(){return"password_description"}}angular.module("app").controllerProvider.register("SysConfigCtrl",SysConfigCtrl),SysConfigCtrl.$inject=["$scope","$state","$q","$timeout","$rootScope","$injector","cpe","devinfo","systemUtil","translate","device","snackbars","funcs","navigationFilter","ngDialog"]}();