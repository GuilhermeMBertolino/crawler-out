"use strict";!function(){angular.module("app").service("routingUtil",["cpe","device","funcs","translate","navigationFilter",function(cpe,device,funcs,translate,navigationFilter){function getConfig(){return angular.copy(nativeConfig)}var nativeConfig=null,dsysinitConfig=null,__initNativeConfig=null,__initDsysinitConfig=null,dsysinitAttrs=null,customRules=navigationFilter.rules()||{},converter=device.routing.converter,pathsToPull={config:["Device.Network.","Device.Routing.","Device.Network.Connection.","Device.Network.Settings.PPPClient.","Device.Network.Group.","Device.USB.Connection."],attributes:["Device.Routing."]};return{getConfig:getConfig,getAttrs:function(){return null},pull:function(){function success(response){return dsysinitConfig=response[0].result.Config,dsysinitAttrs=response[1].result.Datamodel,dsysinitConfig.hideTRVoip=customRules.HideTRVoipStats,nativeConfig=converter.dsysinitToNative({config:dsysinitConfig}),__initDsysinitConfig=funcs.deepClone(dsysinitConfig),__initNativeConfig=funcs.deepClone(nativeConfig),Promise.resolve()}return Promise.all([cpe.GetConfig(pathsToPull.config,!0),cpe.GetDatamodel(pathsToPull.attributes,!0)]).then(success)},removeRules:function(items){var newConfig=funcs.deepClone(__initDsysinitConfig);_.each(items,function(item){var version=item.IPVersion,id=item.__id,removePath="Device.Routing.".concat(version,".Routes.").concat(id);funcs.cutBranch(newConfig,removePath)});var diff=funcs.newConfig.makeDiff(__initDsysinitConfig,newConfig,dsysinitAttrs);return cpe.ApplyDifference(diff)},applyRule:function(rule,id){function updateConfig(config,rule,id){var index=_.findIndex(config.Routes,function(e){return e.__id==id&&e.IPVersion==rule.InitVersion});return rule.InitVersion&&rule.IPVersion!=rule.InitVersion?(config.Routes.push(rule),void config.Routes.splice(index,1)):void(-1==index?config.Routes.push(rule):config.Routes[index]=rule)}var newConfig=funcs.deepClone(__initNativeConfig);updateConfig(newConfig,rule,id);var newDsysinitConfig=converter.nativeToDsysinit(newConfig),initDsysinitConfig=converter.nativeToDsysinit(__initNativeConfig);newDsysinitConfig.Device.Routing.IPv4||funcs.setValue("Device.Routing.IPv4.Routes",{},newDsysinitConfig),newDsysinitConfig.Device.Routing.IPv6||funcs.setValue("Device.Routing.IPv6.Routes",{},newDsysinitConfig);var diff=funcs.newConfig.makeDiff(initDsysinitConfig,newDsysinitConfig,dsysinitAttrs);return cpe.ApplyDifference(diff)},applyHwRoute:function(){return Promise.resolve()}}}])}();