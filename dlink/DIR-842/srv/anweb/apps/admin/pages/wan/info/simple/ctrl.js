"use strict";angular.module("app").controller("WanInfoSimpleCtrl",["$scope","$state","wanPageCommon","wanPage","translate",function($scope,$state,wanPageCommon,wanPage,translate){function getBreakMsgRemove(conn){var alrt,trConn,alertConns=[];wanPage.wanUsedInReserve($scope.data,conn);var msg;if(alertConns.length){msg="".concat(translate("wan_delete_conn_err")," (").concat(alertConns.map(function(alrt){return alrt.conn}),").");for(var i in alertConns)alrt=alertConns[i],msg+="\n".concat(translate("connection")," (").concat(alrt.conn,") ").concat(alrt.msg,".")}return $scope.customRules.DenyEditingTRConnection&&"admin"==localStorage.getItem("auth-dsysinit.Login")&&(trConn=wanPage.wanUsedInTr69($scope.data,conn),trConn&&(alertConns.push({conn:trConn.Name}),msg="".concat(translate("wan_delete_conn_err")," (").concat(alertConns.map(function(alrt){return alrt.conn}).join(", "),")."))),msg}function getConfirmMsgRemove(conn){var alrt,alertConns=[],gateways=conn.DefaultGateway||conn.DefaultGatewayv6;gateways&&alertConns.push({conn:conn.Name,msg:translate("wan_default_gateway_warning_connection2")});var trConn=wanPage.wanUsedInTr69($scope.data,conn);trConn&&alertConns.push({conn:conn.Name,msg:translate("wan_tr_warning")});var voipConn=wanPage.wanUsedInVoIP($scope.data,conn);voipConn&&alertConns.push({conn:conn.Name,msg:translate("wan_voip_warning")});var httpaccessConn=wanPage.wanUsedInHttpaccess($scope.data,conn);httpaccessConn&&alertConns.push({conn:conn.Name,msg:translate("wan_warning_in_use",{name:translate("raccess_in")})});var msg="",allAlertConnNames=[];if(alertConns.length)for(var i in alertConns)alrt=alertConns[i],allAlertConnNames=allAlertConnNames.concat(alrt.conn.split(", ")),msg+="".concat(translate("connection")," (").concat(alrt.conn,") ").concat(alrt.msg,".\n");return msg+=translate("wan_connections_warning_one")}$scope.data=$state.params.data;var flatConnList=$scope.data.__flatConnList;$scope.list=flatConnList.map(function(e,i,all){var stConn=wanPage.getStatusText($scope.data,e);return wanPageCommon.extendConn(e,all,stConn)}).sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}),$scope.switchToAdvancedMode=function(){$scope.$emit("switchWanPageMode",!0)},$scope.reconnect=function(conn){var paths=[conn.__Path];conn.__Status="loading",wanPage.reconnect(paths,$scope.data).then(function(){$scope.$emit("pageNeedUpdate")})["catch"](function(){$state.go("error",{code:"msg_push_error",message:"msg_error_desc"})})["finally"](function(){$scope.overlay.circular.stop(overlay)})},$scope.changeCfg=function(){var trconn=$scope.list.some(function(el){return wanPage.wanUsedInTr69($scope.data,el)});$scope.customRules.DenyEditingTRConnection&&trconn&&"admin"==localStorage.getItem("auth-dsysinit.Login")?alert(translate("wan_edit_tr")):$scope.$emit("goToAdding",!0)},$scope.edit=function(path){var trconn=$scope.list.some(function(el){return el.__Path==path&&wanPage.wanUsedInTr69($scope.data,el)});$scope.customRules.DenyEditingTRConnection&&trconn&&"admin"==localStorage.getItem("auth-dsysinit.Login")?alert(translate("wan_edit_tr")):$scope.$emit("goToEditing",path)},$scope.remove=function(conn){var breakMsg=getBreakMsgRemove(conn);if(breakMsg)return void alert(breakMsg);var confirmMsg=getConfirmMsgRemove(conn);if(!confirmMsg||confirm(confirmMsg)){var paths=[conn.__Path],overlay=$scope.overlay.circular.start();wanPage.remove(paths,$scope.data).then(function(){$scope.$emit("pageNeedUpdate")})["catch"](function(){$state.go("error",{code:"msg_push_error",message:"msg_error_desc"})})["finally"](function(){$scope.overlay.circular.stop(overlay)})}},$scope.hideDeleteButton=function(){return!($scope.list.length>1&&$scope.list.find(function(e){return"IPv6oE"==e.__Type})&&$scope.list.find(function(e){return"IPv4oE"==e.__Type}))}}]);