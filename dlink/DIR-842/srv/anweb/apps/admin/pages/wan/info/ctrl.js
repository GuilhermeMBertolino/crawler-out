"use strict";!function(){angular.module("app").controller("WanInfoCtrl",["$scope","$state","devinfo","wanPage","wanPageCommon","anwebStorage","navShared",function($scope,$state,devinfo,wanPage,wanPageCommon,anwebStorage,navShared){function onUpdate(data){function updateEmptyCondition(){$scope.haveConns=data.__flatConnList.length}var _$scope$customRules$H,storage=$scope.modeStorage,simpleModeAvail=isSimpleConfig(data);if($scope.data=data,updateEmptyCondition(),$scope.haveConns){var connNamesToHide=null!==(_$scope$customRules$H=$scope.customRules.HideWanConnectionsList)&&void 0!==_$scope$customRules$H?_$scope$customRules$H:[];data.__flatConnList.some(function(conn){return connNamesToHide.some(function(e){return e==conn.Name})})&&(data.__flatConnList=data.__flatConnList.filter(function(conn){return connNamesToHide.every(function(e){return e!=conn.Name})}),updateEmptyCondition()),storage&&storage.get("advanced")||!simpleModeAvail?$state.go(baseStateName+".advanced",{simpleModeAvail:simpleModeAvail,data:data}).then(function(){}):$state.go(baseStateName+".simple",{data:data}).then(function(){})}}function onError(error){console.log("onErrorrr!"),console.log(error)}function isSimpleConfig(data){if(navShared.isFirewallMode)return!1;var list=data.__flatConnList;return 1==list.length?!0:2!=list.length?!1:wanPage.isSimpleConfig(list)}var baseStateName=$scope.pageDetails.wanInfo[0].state;devinfo.once("version").then(function(res){return $scope.modeStorage=anwebStorage.make("wanMode-".concat(res.modelId,"-").concat(res.buildDate)),wanPage.pull()}).then(function(data){$scope.data=data,onUpdate(data),$scope.$emit("pageload"),wanPage.subscribe(onUpdate,$scope)})["catch"](onError),$scope.$on("switchWanPageMode",function(event,advanced){var storage=$scope.modeStorage;storage&&storage.set("advanced",advanced),onUpdate($scope.data)}),$scope.$on("pageNeedUpdate",function(){var overlay=$scope.overlay.circular.start();wanPage.pull().then(function(data){$scope.overlay.circular.stop(overlay),onUpdate(data),$scope.$emit("pageload")})["catch"](onError)}),$scope.$on("goToEditing",function($event,path){var editingStateName=wanPageCommon.getSiblingStateFullName(baseStateName,"edit");$state.go(editingStateName,{path:path})}),$scope.$on("goToAdding",function($event,simple){var addingStateName=wanPageCommon.getSiblingStateFullName(baseStateName,"add");$state.go(addingStateName,{simple:simple})})}])}();