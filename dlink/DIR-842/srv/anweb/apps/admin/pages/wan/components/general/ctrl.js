"use strict";function WanGeneralCtrl($scope,$state,translate,navShared,wanPage){function updateFlagsNATs(){if("mobileinet"==$scope.common.contype)if($scope.conn.InterfaceOnly)$scope.conn.__New||(defaultValues.FlagsNAT=flags.NAT,defaultValues.FlagsNATv6=flags.NATv6),flags.NAT=!1,flags.NATHide=!0,flags.NATv6=!1,flags.NATv6Hide=!0;else{var oldNATHide=flags.NATHide;flags.NATHide=!["Dual","IPv4"].includes($scope.conn.Version),flags.NATHide?($scope.conn.__New||(defaultValues.FlagsNAT=flags.NAT),flags.NAT=!1):oldNATHide&&(flags.NAT=defaultValues.FlagsNAT);var oldNATv6Hide=flags.NATv6Hide;flags.NATv6Hide=!["Dual","IPv6"].includes($scope.conn.Version),flags.NATv6Hide?($scope.conn.__New||(defaultValues.FlagsNATv6=flags.NATv6),flags.NATv6=!1):oldNATv6Hide&&(flags.NATv6=defaultValues.FlagsNATv6)}}var defaultValues={FlagsNAT:!0,FlagsNATv6:!0,FlagsPing:!1},flags=$scope.conn.Flags?$scope.conn.Flags:{};$scope.isFirewallMode=navShared.isFirewallMode,$scope.isTatTRConn=(autoconf.BR2_PACKAGE_ANWEB_CUSTOM_TATTELEKOM_36956||autoconf.BR2_PACKAGE_ANWEB_CUSTOM_TATTELEKOM_39681)&&!$scope.customRules.tatSuperAdmin&&"DSL.ATM"==$scope.conn.MediaType&&"0/69"==$scope.conn.Media.DSL.ATM.DestinationAddress,$scope.curIface=$scope.conn.MediaPath,updateFlagsNATs(),$scope.$watch("conn.MediaPath",function(v){v&&$scope.ifaceChange()}),$scope.contypeChange=function(){$scope.$emit("generalContypeChange",$scope.common.contype,$scope.common.role)},$scope.ifaceChange=function(){$scope.$emit("generalIfaceChange",$scope.conn.MediaPath,$scope.curIface),$scope.curIface=$scope.conn.MediaPath},$scope.validateName=function(value){return wanPage.checkUniqueName(value,$scope.conn.__Link,$scope.common.existsConns)?null:"name_exists"},$scope.changeRealConnState=function(){$scope.conn.InterfaceOnly?($scope.conn.__New||(defaultValues.FlagsPing=flags.Ping),flags.Ping=!1,flags.PingHide=!0):($scope.conn.__New||(flags.Ping=defaultValues.FlagsPing),flags.PingHide=!1),updateFlagsNATs()},$scope.getUSBIfaceNote=function(){var href=$scope.pageDetails.vlanList[0].url;return translate("wan_usb_interface_only_note",{link:"<a href='"+href+"'>VLAN</a>",trustAsHtml:!0})},$scope.isBase=function(){return"base"==$state.params.role},$scope.changeProxyARP=function(){if(!$scope.common.isXxtp&&"mobileinet"!=$scope.common.contype&&"bridge"!=$scope.common.contype){var media=$scope.conn.Media,mediaType=$scope.conn.MediaType;mediaType&&-1!=mediaType.indexOf("DSL")&&(media=media.DSL,mediaType=mediaType.split(".")[1]),mediaType&&(media[mediaType].ProxyARP=flags.ProxyARP)}},$scope.disabledFirewallFlag=function(){return $scope.customRules.DisabledWANFirewallv6?/v6|dual/.test($scope.common.contype)&&flags.Firewall?!0:void 0:!1},$scope.showNoWanPortsNote=function(){return $scope.common.isNoWanPorts&&"mobileinet"!=$scope.common.contype}}angular.module("app").controller("WanGeneralCtrl",["$scope","$state","translate","navShared","wanPage",WanGeneralCtrl]);