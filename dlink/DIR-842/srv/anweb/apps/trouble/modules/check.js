"use strict";!function(){angular.module(regdep("trouble-check"),[]).service("troubleCheck",["$rootScope","devinfo","checkPing",function($rootScope,devinfo,ping){function getWANStatus(ports,$scope){var etherwan=_.find(ports,function(port){return port.isEtherwan}),wanTypes=$scope.DSLMode?["dsl"]:["ethernet","fiber"];if(etherwan)return etherwan.status>0;var wan=_.find(ports,function(port){return port.isWan&&_.contains(wanTypes,port.type)});return wan&&wan.status>0}function isWiFiIface(iface){return _.contains(["wifi","wifi24ghz","wifi5ghz"],iface)}var areas="net|ports|dongle|version",lastData={},status=null,connNotCreated=null,isIPv6=!1;return{getNextStatus:function(fn,$scope){function query(data){var wanStatus,gw,dongleData,actSim;if(data){if(!data||isLoaded)return;if(devinfo.unsubscribe(areas,query),isLoaded=!0,lastData=data,$rootScope.rootAvailPorts=data.availPorts,wanStatus=getWANStatus(data.availPorts,$scope),gw={},connNotCreated=!1,data&&data.ipv4gw?(gw=data.ipv4gw,isIPv6=!1):data&&data.ipv6gw?(gw=data.ipv6gw,isIPv6=!0):connNotCreated=!0,dongleData=null,("3g"==gw.contype||"lte"==gw.contype||"mobileinet"==gw.contype)&&(dongleData=_.isArray(data.dongle)?data.dongle.length>1?_.find(data.dongle,function(data){return"Device.USB.Modem.".concat(data.__id,".")==gw.__modem_link}):data.dongle[0]:data.dongle),status="error_undefined","3g"==gw.contype||"lte"==gw.contype||"mobileinet"==gw.contype?(actSim=null,dongleData&&(actSim=_.find(dongleData.simList,function(sim){return dongleData.activeSIM==sim.__id})),dongleData&&dongleData.status?"SIM not inserted"==dongleData.imsi||actSim&&!actSim.inserted?status="error_dongle_sim_not_inserted":(dongleData.pinStatus,"PPPAuthFailed"==gw.status?status="error_ppp_auth":"Connected"==gw.connection_status&&(status="connected")):status="error_dongle_not_inserted"):wanStatus||isWiFiIface(gw.ifacetype)||connNotCreated?connNotCreated?status="error_conn_not_created":"Connected"==gw.connection_status?status="connected":"PPPAuthFailed"==gw.status&&wanStatus?status="error_ppp_auth":"PPPNotResponse"==gw.status&&wanStatus?status="error_undefined":"DHCPIPNotReceived"==gw.status&&wanStatus&&(status="error_dhcp_ip_not_received"):status="error_cable",isWiFiIface(gw.ifacetype)&&"WiFiDisconnected"==gw.connection_status&&(status="error_wifi"),"string"==typeof window.dbgStatus)return void fn(window.dbgStatus);console.log("status:",status),"connected"==status?ping.check({is_ipv6:isIPv6,work_timeout:8}).then(fn.bind(null,"connected"),fn.bind(null,"error_undefined")):fn(status)}}var isLoaded=!1;devinfo.onceAndSubscribe(areas,query)},getLastStatus:function(){return status},getData:function(){return lastData}}}])}();