#!/bin/sh

source /usr/etc/rc.d/rc.funcs

fs() {
	local SYSLOG_TAG=FileSystem
	log_msg "${SYSLOG_TAG}" Start check...
	local ROOT_PART=/dev/mtd3
	for x in $(cat /proc/cmdline); do
		case "$x" in
			root=/dev/*)
			ROOT_PART="${x#root=}"
			;;
		esac
	done
	sqfsck "$ROOT_PART"
	if [ ! $? -eq 0 ]; then 
		log_msg "${SYSLOG_TAG}" Failed: $i
		/bin/support /tmp/emerg /etc/persistent/emerg.supp emerg 1;
	fi 
	sysctl -w vm.drop_caches=3 2>&1 > /dev/null
	sysctl -w vm.swappiness=0 2>&1 > /dev/null
	log_msg "${SYSLOG_TAG}" End check.
}

fs
