#!/bin/sh

cmd="$1"
pid="$2"
sig="$3"
now="$4"

dst="/tmp/core.$cmd.$sig"
last="/tmp/.core.$cmd.$sig.last"
last_at=0

if [ -f "$last" ]; then
    last_at=$(cat "$last")
fi

# No more than 1 core / 10 seconds / executable / signal.
if  [ $(($now - $last_at)) -gt 10 ]; then
    if grep -q devel /usr/lib/version; then
	cat > "$dst"
    fi
    logger -t core "[$pid] [$sig] $cmd"
fi

date +%s > "$last"
