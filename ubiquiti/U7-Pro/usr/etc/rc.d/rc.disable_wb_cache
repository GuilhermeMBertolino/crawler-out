#!/bin/sh

for device in /sys/block/*; do
    device_name=$(basename $device)

    # Check if the device is mmcblk or mtdblock
    case "$device_name" in
        mmcblk*|mtdblock*)
            if [ -w "$device/queue/write_cache" ]; then
                echo "Disabling write cache for device /dev/$device_name"
                echo "write through" > "$device/queue/write_cache"
            fi
            ;;
    esac
done
