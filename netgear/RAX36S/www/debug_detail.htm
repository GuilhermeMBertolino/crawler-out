<% http_header("style/form.css","funcs.js") %>
<script>
<% refresh_timestamp("debug_info","collect_log","debug_save","apply_beacon_dtim") %>
var ts="<% cfg_get("debug_info") %>";
<% get_support_flag() %>
function loadvalue()
{
	if("<% cfg_get("debug_boot_up") %>" == "1")
		document.getElementById("log_capture_form").log_capture.checked = true;
	else
		document.getElementById("log_capture_form").log_capture.checked = false;

	if("<% cat_file("/tmp/wanlan_capture") %>" == "1")
	{
		document.getElementById("wanlan_capture_form").wanlan_capture.checked = true;
		document.getElementById("store_location_form").store_location.disabled = false;
	}
	else
	{
		document.getElementById("wanlan_capture_form").wanlan_capture.checked = false;
		document.getElementById("store_location_form").store_location.disabled = true;
	}

	var locate= "<% cat_file("/tmp/debug_store_locate") %>";
	if(locate == "")
		locate = "0";
	document.getElementById("store_location_form").store_location.value = locate;
	rewrite_list_value(document.getElementById("store_location_form"), "store_location");
	if(support_rae1_5==1){
		if("<% cfg_get("collect_ra_log") %>" == "1")
			document.getElementById("ra_btn").collect_ra_log.checked = true;
		else
			document.getElementById("ra_btn").collect_ra_log.checked = false;
	}

	if(disable_telnet_flag == 0){
		if("<% cat_file("/tmp/enable_telnet") %>" == "1")
			document.getElementById("telnet").enable_telnet.checked = true;
		else
			document.getElementById("telnet").enable_telnet.checked = false;
	}

	if(mirror_to_flag == 1)
	{
		if("<% cat_file("/tmp/debug_mirror_on") %>" == "1")
			document.getElementById("mirror").mirrortolan.checked = true;
		else
			document.getElementById("mirror").mirrortolan.checked = false;
	}

	if("<% cat_file("/tmp/allow_ipv6_ping") %>" == "1")
		document.getElementById("ipv6_ping_form").allow_ipv6_ping.checked = true;
	else
		document.getElementById("ipv6_ping_form").allow_ipv6_ping.checked = false;

	if(always_enable_fan_flag == 1)
	{
		if("<% cat_file("/tmp/always_enable_fan") %>" == "1")
			document.getElementById("fan_form").always_enable_fan.checked = true;
		else
			document.getElementById("fan_form").always_enable_fan.checked = false;
	}

	if(hostapd_debug_flag == 1)
	{
		if("<% cfg_get("enable_hostapd_debug") %>" === "1")
			document.getElementById("hostapd_form").enable_hostapd_debug.checked = true;
	}

        if(enable_improve_conn_flag == 1)
        {
                if("<% cfg_get("improve_wl_con") %>" == "1")
                        document.getElementById("improve_conn_form").enable_improve_conn.checked = true;
                else
                        document.getElementById("improve_conn_form").enable_improve_conn.checked = false;
        }
	if(disable_channel_switch == 1)
	{
		if("<% cfg_get("dfs_detect") %>" == "0")
			document.getElementById("channel_switch_form").disable_channel_switch.checked = true;
		else
			document.getElementById("channel_switch_form").disable_channel_switch.checked = false;
	}
	if(fan_algorithm_flag == 1)
	{
		document.getElementById("algorithm_form").fan_speed.value = "<% cfg_get("fan_speed") %>";
	}


	if(use_orbi_style_flag == 1)
	{
		var beacon_2g = "<% cfg_get("wlg_beacon_intval") %>";
		var dtim_2g = "<% cfg_get("wlg_dtim") %>";
		var beacon_5g = "<% cfg_get("wla_beacon_intval") %>";
		var dtim_5g = "<% cfg_get("wla_dtim") %>";
		if(beacon_2g != "")
			document.getElementById("beacon_int_2g").value = beacon_2g;
		if(dtim_2g != "")
			document.getElementById("dtim_2g").value = dtim_2g;
		if(beacon_5g != "")
			document.getElementById("beacon_int_5g").value = beacon_5g;
		if(dtim_5g != "")
			document.getElementById("dtim_5g").value = dtim_5g;
		if(tri_band_router == 1)
		{
			var beacon_5g2 = "<% cfg_get("wla_2nd_beacon_intval") %>";
			var dtim_5g2 = "<% cfg_get("wla_2nd_dtim") %>";
			if(beacon_5g2 != "")
				document.getElementById("beacon_int_5g2").value = beacon_5g2;
			if(dtim_5g2 != "")
				document.getElementById("dtim_5g2").value = dtim_5g2;
		}
	}
	if(support_control_bridge_mode == 1)
	{
		if("<% cfg_get("show_bridge_mode") %>" == "1")
			document.getElementById("bridge_mode_form").show_bridge_mode.checked = true;
		else
			document.getElementById("bridge_mode_form").show_bridge_mode.checked = false;
		if("<% cfg_get("bridge_mode") %>" == "1")
			document.getElementById("bridge_mode_form").show_bridge_mode.disabled = true;
		else
			document.getElementById("bridge_mode_form").show_bridge_mode.disabled = false;
	}

	refresh_start();
}

function click_logcapture()
{
	var cf = document.getElementById("log_capture_form");
	if(cf.log_capture.checked == true)
		cf.hid_boot_up.value = "1";
	else
		cf.hid_boot_up.value = "0";
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

function click_wanlan()
{
	var cf = document.getElementById("wanlan_capture_form");
	if(cf.wanlan_capture.checked == true)
		cf.hid_wanlan_capture.value = "1";
	else
		cf.hid_wanlan_capture.value = "0";
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

function click_ra_log()
{
	var cf = document.getElementById("ra_btn");
	if(cf.collect_ra_log.checked == true)
		cf.hid_collect_ra_log.value = "1";
	else
		cf.hid_collect_ra_log.value = "0";
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

function click_location()
{
	var cf = document.getElementById("store_location_form");
	cf.hid_store_location.value=convert_value_to_original(cf, "store_location");
	if(cf.hid_store_location.value == "1" && "<% cat_file("/tmp/debug-usb") %>" != "1")
	{
		alert("There are no USB devices connected to the router!");
		cf.hid_store_location.value = "0";
	}
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

function click_start()
{
	var cf = document.getElementById("start_collect_form");
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

function click_telnet()
{
	var cf = document.getElementById("telnet");
	if(cf.enable_telnet.checked == true)
		cf.hid_telnet.value = "1";
	else
		cf.hid_telnet.value = "0";
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

function click_mirror()
{
	var cf = document.getElementById("mirror");
	if(cf.mirrortolan.checked == true)
		cf.hid_mirrortolan.value = "1";
	else
		cf.hid_mirrortolan.value = "0";
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}
function click_ipv6()
{
	var cf = document.getElementById("ipv6_ping_form");
	if(cf.allow_ipv6_ping.checked == true)
		cf.hid_ipv6.value = "1";
	else
		cf.hid_ipv6.value = "0";
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

function click_enable_fan()
{
	var cf = document.getElementById("fan_form");
	if(cf.always_enable_fan.checked == true)
		cf.hid_fan.value = "1";
	else
		cf.hid_fan.value = "0";
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

function click_hostapd()
{
	var cf = document.getElementById("hostapd_form");
	if(cf.enable_hostapd_debug.checked == true)
		cf.hid_hostapd.value = "1";
	else
		cf.hid_hostapd.value = "0";
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}
function click_improve_conn()
{
        var cf = document.getElementById("improve_conn_form");
        if(cf.enable_improve_conn.checked == true)
                cf.hid_improve_conn.value = "1";
        else
                cf.hid_improve_conn.value = "0";
        cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
        cf.submit();
}
function click_channel_switch()
{
	var cf = document.getElementById("channel_switch_form");
	if(cf.disable_channel_switch.checked == true)
		cf.hid_channel_switch.value = "0";
	else
		cf.hid_channel_switch.value = "1";
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

function click_bridge_mode()
{
	var cf = document.getElementById("bridge_mode_form");
	if(cf.show_bridge_mode.checked == true)
		cf.hid_bridge_mode.value = "1";
	else
		cf.hid_bridge_mode.value = "0";
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}
function click_fan()
{
	var cf = document.getElementById("algorithm_form");
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

function refresh_start()
{
        var file="/collect_debug.txt";
        var xmlHttp = createXMLHttpRequest();
        var result;

	var disable_str="<input type='button' name='Start' id='start_capture' class='common_gray_bt' value='Start Capture' disabled/>    Debug Log capturing in progress";
	var enable_str="<input type='button' name='Start' id='start_capture' class='common_bt' value='Start Capture' onclick='click_start();'/>";

        xmlHttp.onreadystatechange=function()
        {
                if(xmlHttp.readyState==4 && xmlHttp.status==200)
                {
                        result=xmlHttp.responseText;
			getObj("start_button").innerHTML='';
                        if(result == 1)
				getObj("start_button").innerHTML=disable_str;
                        else
				getObj("start_button").innerHTML=enable_str;
                }
        }
        xmlHttp.open("GET", file, true);
        xmlHttp.send();

}

function click_beacon_dtim()
{
	var cf = document.getElementById("beacon_dtim_form");
	cf.action="/apply.cgi?/debug_detail.htm timestamp="+ts;
	cf.submit();
}

</script>

<BODY onLoad="loadvalue();" bgcolor=#ffffff class="debug_body">
<div id="main">
<div>
<table width="100%" border="0" cellpadding="0" cellspacing="10">
<tr><td colspan=3><img src=/liteblue.gif width=100% height=12></td></tr>
<tr><td colspan=3><b>Basic Information</b></td></tr>
<% show_cpu() %>
<tr><td></td><td><b>Memory Usage(Used/Total)</b></td><td><% cat_file("/tmp/debug_mem") %></td></tr>
<tr><td></td><td><b>Flash Usage(Used/Total)</b></td><td><% cat_file("/tmp/debug_flash") %></td></tr>
<tr><td></td><td><b>Network Session(Active/Total)</b></td><td><% cat_file("/tmp/debug_session") %></td></tr>
<% show_debug_info("temperature") %>
<tr>
	<td></td><td><b>System Uptime</b></td>
	<td>
	<script>
	var uptime= "<% show_uptime() %>";
	var new_time=change_sec_to_time(uptime);
	document.write(new_time);
	</script>
</td></tr>
<% show_debug_info("wireless_driver") %>
</table>
</div>

<div style="margin-left:5px">
<b>Debug Log Capture</b>
<div style="margin-left:50px">
<form id="log_capture_form" method="post" action="/apply.cgi?/debug_detail.htm" target="formframe">
<input type="hidden" name="submit_flag" value="debug_info" />
<input type="hidden" name="hid_boot_up" />
<input type="checkbox" name="log_capture" onclick="click_logcapture();" id="log_capture_st"><label for="log_capture_st"><b>Start Debug Log Capture when boot up</b></label>
</form>
<br/>
<form id="wanlan_capture_form" method="post" action="/apply.cgi?/debug_detail.htm" target="formframe">
<input type="hidden" name="submit_flag" value="debug_info" />
<input type="hidden" name="hid_wanlan_capture" />
<input type="checkbox" name="wanlan_capture" onchange="click_wanlan();" id="wanlan_capture_en"><label for="wanlan_capture_en"><b>Enable LAN/WAN Packet Capture</b></label>
</form>
<br/>
<% show_debug_info("rae") %>
<div style="margin-left:30px">
<form id="store_location_form" method="post" action="/apply.cgi?/debug_detail.htm" target="formframe">
<input type="hidden" name="submit_flag" value="debug_info" />
<input type="hidden" name="hid_store_location">
<b>Store location</b>&nbsp;&nbsp;&nbsp;&nbsp;
	<select name="store_location" id="store_location" onchange="click_location();">
		<option value="0">System Memory</option>
		<option value="1">USB Device</option>
	</select>
</form>
</div>
<br/>
<form id="start_collect_form" method="post" action="/apply.cgi?/debug_detail.htm" target="formframe">
<input type="hidden" name="submit_flag" value="collect_log" />
<div id="start_button"></div>
</form>
<br/>
<form action="/debug.cgi? timestamp=<% cfg_get("debug_save") %>" method="post" enctype="multipart/form-data" target="formframe">
<input type="submit" name="Save" id="save_log" class="common_bt" value="Save Debug Log" onclick="setTimeout('refresh_start()',5000);return true;"/>
</form>
</div>
<br/>
<% show_debug_info("telnet") %>
<% show_debug_info("mirror") %>
<form id="ipv6_ping_form" method="post" action="/apply.cgi?/debug_detail.htm" target="formframe">
<input type="hidden" name="submit_flag" value="debug_info" />
<input type="hidden" name="hid_ipv6" />
<input type="checkbox" name="allow_ipv6_ping" onclick="click_ipv6();" id="allow_ipv6_ping_ch"><label for="allow_ipv6_ping_ch"><b>Allow external IPv6 hosts ping internal IPv6 hosts</b></label>
</form>
<br/>
<% show_debug_info("fan") %>
<% show_debug_info("hostapd") %>
<% show_debug_info("improve_conn") %>
<% show_debug_info("channel_switch") %>
</div>

<style>
.t_title td{ width:10%; border:solid #D2DEE9; border-width:0px 1px 1px 0px; }
.t_title{ font-weight:bold; height:25px; }
.t_title td, .t_middle td{ width:10%; border:solid #D2DEE9; border-width:0px 1px 1px 0px; }
.t_last td{ width:10%; border:solid #D2DEE9; border-width:0px 1px 0px 0px; }
.t_title .no_rigth, .t_middle .no_rigth{ border-width:0px 0px 1px 0px; }
.t_last .no_rigth{ border-width:0px 0px 0px 0px; }
.border_input{border:solid 1px !important; height:2rem !important;}
</style>
<% show_debug_info("algorithm") %>
<% show_debug_info("beacon_dtim") %>
<% show_debug_info("bridge_mode") %>
</div>
</body>
</html>

