<!DOCTYPE HTML>
<%
      local commonCfg = require "webGetFunc.commonCfg"
%>
<html>
<head>
  <META charset="UTF-8">
  <META http-equiv="Pragma" content="no-cache">
  <META HTTP-equiv="Cache-Control" content="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="Mon, 06 Jan 1990 00:00:01 GMT">

  <title>NETGEAR Router <? commonCfg.getModelNameStr() ?></title>

  <link rel="stylesheet" href="css/table_noh.css">
  <link rel="stylesheet" href="css/scrollbar.css">
  <link rel="stylesheet" href="css/button.css">
  <link rel="stylesheet" href="css/form.css">
  <link rel="stylesheet" href="css/settings.css">

  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.mousewheel.js"></script>
  <script src="js/jquery.jscrollpane.min.js"></script>
  <script src="js/jquery.inputmask.min.js"></script>
  <script src="js/ipInput.js"></script>
  <script src="js/utils.js<? commonCfg.getVer(); ?>"></script>
  <script src="js/validations.js"></script>
  <script src="js/embedProgressBar.js"></script>

  <!--link rel="stylesheet" href="css/form.css"-->
  <!--link rel="stylesheet" href="css/custom.css" type="text/css"-->

  <script language="javascript" type="text/javascript">

    //CSRF_TOKEN = <!--?= commonCfg.genCsrfTokenFile('tokenNumber')?-->;

    /* pre_fillout_init() callback function replaces the position of ready() function */
    function pre_fillout_init(json)
    {
    }

    function formSubmit(btn) {
        if (validation(document.forms[0]))
        {
            $.postForm('ntp', $('#target'), 'cgi-bin/netgear.plua', 'postForm_callback');
            show_EmbedProgressBar('3G222', 15000, '/NTP_Settings.html');
            //setTimeout("redirectProgressBar('3G222', '', '15000', 'NTP_Settings.html')", 10);
        }
    }

    function postForm_callback()
    {
        /* Refreshing page is already done by progress bar, the callback function do nothing here is
        to avoid the postForm defaultHandler() refreshing page may interrupt the execution of progress bar
        */
    }

    function validation(f) {
        if ($("input[name='preferNtpServer']:checked").val() == "true")
        {
            if ($("input[name='ntpServer']").val() == "")
            {
                alert(window.top.mlang["SWPE10"]);
                return false;
            }

            var tmp = $("input[name='ntpServer']").val();

            if(tmp.slice(0, 7) == "http://")
                tmp = tmp.slice(7);
            else if(tmp.slice(0, 8) == "https://")
                tmp = tmp.slice(8);

            var i = tmp.indexOf("/");
            i == -1? i=tmp.length: i=i;
            tmp = tmp.slice(0, i);
            var isIP = /^[0-9.]+$/g.test(tmp);

            if (isIP)
            {
                if(checkipaddr(tmp) == false)
                {
                    alert(window.top.mlang["ACB_098"]);
                    return false;
                }
            }
            else if(!isValidDomain(tmp))
            {
                alert(window.top.mlang["SWPE02"]);
                return false;
            }
        }

        return true;
    }

    function isNumStr(str)
    {
        var i;
        if (str.length == 0)
        {
            return false;
        }

        for(i = 0; i < str.length; i++)
        {
            var c = str.substring(i, i+1);
            if("0" <= c && c <= "9")
            {
                continue;
            }
            return false;
        }

        return true;
    }

    function post_fillout_init()
    {
        /* init elements */
        /*init_BlockDays_checkbox();
        init_BlockTime_text();*/
        init_NtpServer_text();
        init_currentTime_span();

        /* sync checkbox value to be same with its check status */
        $('#target [name=autoDaylightSaving]').on('change', function() {
            $('[name=autoDaylightSaving]').val($('[name=autoDaylightSaving]').prop("checked"));
        });
        $("input[name='preferNtpServer']").on('click', function() {
            onChange_preferNtpServer();
        });

        //PEGA JYang, two select lists for Netgear GUI automation id (dirty solution)
        $('#time_zone')[0].selectedIndex = $('#timeZone').prop('selectedIndex');

        $('#time_zone').on('change', function() {
            $('#timeZone')[0].selectedIndex = $('#time_zone').prop('selectedIndex');
            $("input[name='timeZonestate']").val("2"); //manually timezone
        });

        // Mainly to translate 'NtpServerStatus'
        $("[mlang]").each(function(idx,obj){
            obj.innerHTML = window.top.mlang[obj.attributes.mlang.value];
        });
    }

    function init_NtpServer_text()
    {
        if ( $("input[name='preferNtpServer']:checked").val() == "true")
        {
            $("input[name='ntpServer']").attr('readonly', false);
        }
        else
        {
            $("input[name='ntpServer']").attr('readonly', true);
        }
    }

    function init_currentTime_span()
    {
        var ori_fmt_date = $('#target span[name=currentTime]').text(); // e.g. Wed Jan 20 15:27:01 2021
        var date_array = ori_fmt_date.toString().split(/\s+/);

        var year = date_array[4];
        var month_abbr = date_array[1];
        var month = month_to_mlang(month_abbr);
        var week_abbr = date_array[0];
        var week = week_to_mlang(week_abbr);
        var day = date_array[2];
        var time = date_array[3];

        var new_fmt_date = week + ", "  + month + " "+ day + ", " + year + " " + time; // e.g. Sunday, Feb 21, 2021 20:17:40

        $('#target span[name=currentTime]').text(new_fmt_date);
    }

    function month_to_mlang(abbr)
    {
        var month_map = {"Jan" : "CSE017", "Feb" : "CSE018", "Mar" : "CSE019",
                         "Apr" : "CSE020", "May" : "CSE021", "Jun" : "CSE022",
                         "Jul" : "CSE023", "Aug" : "CSE024", "Sep" : "CSE025",
                         "Oct" : "CSE026", "Nov" : "CSE027", "Dec" : "CSE028"};
        var month = window.top.mlang[month_map[abbr]];
        return month;
    }

    function week_to_mlang(abbr)
    {
        var week_map = {"Sun" : "CSE012", "Mon" : "CSE009", "Tue" : "CSE015",
                        "Wed" : "CSE016", "Thu" : "CSE013", "Fri" : "CSE006", "Sat" : "CSE010"};
        var week = window.top.mlang[week_map[abbr]];
        return week;
    }

    function onChange_preferNtpServer()
    {
        if ( $("input[name='preferNtpServer']:checked").val() == "true")
        {
            $("input[name='ntpServer']").attr('readonly', false);
        }
        else
        {
            $("input[name='ntpServer']").attr('readonly', true);
        }
    }

    function greyout_weekdays_checkbox(val)
    {
        if (val == true)
        {
            $(".weekdays").css("pointer-events", "none");
            $(".weekdays").css("opacity", "0.5");
        }
        else
        {
            $(".weekdays").css("pointer-events", "");
            $(".weekdays").css("opacity", "");
        }
    }

  </script>
  <link href="css/custom.css" rel="stylesheet" type="text/css">
</head>

<? commonCfg.bodyBegin('NTP_Settings', 'NTP_Settings', 'ACB_094', 'NTP Settings', '', 'post_fillout_init') ?>
  <div id="main" class="form-group" style="height:365px;overflow:auto;scrolling:auto">
    <div class="form-row">
      <b mlang="CLO002" >Current Time</b> <b>: </b> <b><span name="currentTime" id="current_time"></span></b> <br>
      <b> <span name="NtpServerStatus" id="ntp_Server_status" style="color: red"></span></b>
    </div>

    <div class="space-divider">&nbsp;</div>

    <div class="form-row">
      <label class="checkbox-container">
        <span mlang="plex_052">Use default NETGEAR NTP server</span>
        <input type="radio" name="preferNtpServer" id="ntp_type1" value="false">
        <span class="radio-checkmark"></span>
      </label>
    </div>
    <div class="form-row">
      <label class="checkbox-container">
        <span mlang="plex_053">Set your preferred NTP server</span>
        <input type="radio" name="preferNtpServer" id="ntp_type2" value="true">
        <span class="radio-checkmark"></span>
      </label>
    </div>

    <div class="form-row">
      <b mlang="SWP029" >Server Address</b><b>:</b>
    </div>

    <div class="form-row">
      <input type="text" name="ntpServer" class="input1" id="pri_ntp" size="20" maxlength="128" value="">
    </div>

    <div class="form-row">
      <input type="hidden" id="timeZonestate" name="timeZonestate" value="2">
    </div>

    <div class="divider">&nbsp;</div>
    <div class="space-divider">&nbsp;</div>
    <div class="form-row">
      <a href="javascript:loadhelp('NTP_Settings','timezone')" tabindex="-1"><b mlang="CEM013" >Time Zone</b></a>
    </div>

    <!--PEGA JYang, two select lists for Netgear GUI automation id (dirty solution)-->
    <div class="form-row" style="display:none">
      <select name="timeZone" id="timeZone" size=1>
        <option value="International_Date_Line_West" selected mlang="CEM017" >(GMT-12:00) International Date Line West, Eniwetok, Kwajalein</option>
        <option value="Midway_Island" mlang="CEM018" >(GMT-11:00) Midway Island, Samoa</option>
        <option value="Hawaii" mlang="CEM019" >(GMT-10:00) Hawaii</option>
        <option value="Alaska" mlang="CEM020" >(GMT-09:00) Alaska</option>
        <option value="Pacific_Time" mlang="CEM021" >(GMT-08:00) Pacific Time (US & Canada); Tijuana</option>
        <option value="Arizona" mlang="CEM022" >((GMT-07:00) Arizona, Chihuahua, La Paz, Mazatlan</option>
        <option value="Mountain_Time" mlang="CEM023" >(GMT-07:00) Mountain Time (US & Canada)</option>
        <option value="Central_Time" mlang="CEM024" >(GMT-06:00) Central America, Central Time (US & Canada)</option>
        <option value="Monterrey" mlang="CEM025" >(GMT-06:00) Guadalajara, Mexico City, Monterrey, Saskatchewan</option>
        <option value="Bogota" mlang="CEM026" >(GMT-05:00) Bogota, Lima, Quito</option>
        <option value="Eastern_Time" mlang="CEM061" >(GMT-05:00) Eastern Time (US & Canada)</option>
        <option value="Indiana" mlang="CEM027" >(GMT-05:00) Indiana (East)</option>
        <option value="Atlantic_Time" mlang="CEM028" >(GMT-04:00) Atlantic Time (Canada), Caracas, La Paz, Santiago</option>
        <option value="Newfoundland" mlang="CEM056" >(GMT-03:30) Newfoundland</option>
        <option value="Brasilia" mlang="CEM029" >(GMT-03:00) Brasilia, Buenos Aires, Georgetown, Greenland</option>
        <option value="Noronha" mlang="CEM030" >(GMT-02:00) Mid-Atlantic</option>
        <option value="Azores" mlang="CEM031" >(GMT-01:00) Azores, Cape Verde Is.</option>
        <option value="Casablanca" mlang="CEM032" >(GMT) Casablanca, Monrovia</option>
        <option value="GMT" mlang="CEM033" >(GMT) Greenwich Mean Time: Dublin, Edinburgh, Lisbon, London</option>
        <option value="Amsterdam" mlang="CEM034" >(GMT+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna</option>
        <option value="Belgrade" mlang="CEM035" >(GMT+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague</option>
        <option value="Brussels" mlang="CEM036" >(GMT+01:00) Brussels, Copenhagen, Madrid, Paris</option>
        <option value="Sarajevo" mlang="CEM037" >(GMT+01:00) Sarajevo, Skopje, Warsaw, Zagreb, West Central Africa</option>
        <option value="Athens" mlang="CEM038" >(GMT+02:00) Athens, Beirut, Istanbul, Minsk</option>
        <option value="Bucharest" mlang="CEM039" >(GMT+02:00) Bucharest, Cairo, Harare, Pretoria</option>
        <option value="Helsinki" mlang="CEM040" >(GMT+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius, Jerusalem</option>
        <option value="Baghdad" mlang="CEM041" >(GMT+03:00) Baghdad, Kuwait, Nairobi, Riyadh, Tehran</option>
        <option value="Baku" mlang="CEM043" >(GMT+04:00) Abu Dhabi, Muscat, Baku, Tbilisi, Yerevan, Kabul</option>
        <option value="Moscow" mlang="CEM042" >(GMT+04:00) Moscow, St. Petersburg, Volgograd</option>
        <option value="Karachi" mlang="CEM044" >(GMT+05:00) Ekaterinburg, Islamabad, Karachi, Tashkent</option>
        <option value="Kolkata" mlang="CEM045" >(GMT+05:30) Chennai, Kolkata, Mumbai, New Delhi</option>
        <option value="Almaty" mlang="CEM046" >(GMT+06:00) Almaty, Ekaterinburg, Astana, Dhaka, Sri Jayawardenepura, Rangoon</option>
        <option value="Bangkok" mlang="CEM047" >(GMT+07:00) Bangkok, Jakarta, Hanoi, Novosibirsk</option>
        <option value="Beijing" mlang="CEM048" >(GMT+08:00) Beijing, Chongqing, Hong Kong, Urumqi</option>
        <option value="Taipei" mlang="CEM049" >(GMT+08:00) Krasnoyarsk, Ulaan Bataar, Kuala Lumpur, Singapore, Perth, Taipei</option>
        <option value="Tokyo" mlang="CEM050" >(GMT+09:00) Tokyo, Osaka, Sapporo, Seoul, Irkutsk</option>
        <option value="Darwin" mlang="CEM065" >(GMT+09:30) Adelaide, Darwin</option>
        <option value="Sydney" mlang="CEM051" >(GMT+10:00) Brisbane, Canberra, Melbourne, Sydney</option>
        <option value="Yakutsk" mlang="CEM062">(GMT+10:00) Yakutsk</option>
        <option value="Guam" mlang="CEM052" >(GMT+10:00) Guam, Port Moresby, Hobart</option>
        <option value="Vladivostok" mlang="CEM053" >(GMT+11:00) Vladivostok</option>
        <option value="Magadan" mlang="CEM063">(GMT+11:00) Magadan, Solomon Is., New Caledonia</option>
        <option value="Fiji" mlang="CEM054" >(GMT+12:00) Fiji, Auckland, Wellington, Marshall Is.</option>
        <option value="Kamchatka" mlang="CEM064">(GMT+12:00) Kamchatka, Magadan</option>
        <option value="Tongatapu" mlang="CEM055" >(GMT+13:00) Nukualofa </option>
      </select>
    </div>

     <div class="form-row">
      <select id="time_zone" size=1>
        <option value="-12" selected mlang="CEM017" >(GMT-12:00) International Date Line West, Eniwetok, Kwajalein</option>
        <option value="-11" mlang="CEM018" >(GMT-11:00) Midway Island, Samoa</option>
        <option value="-10" mlang="CEM019" >(GMT-10:00) Hawaii</option>
        <option value="-9" mlang="CEM020" >(GMT-09:00) Alaska</option>
        <option value="-8" mlang="CEM021" >(GMT-08:00) Pacific Time (US & Canada); Tijuana</option>
        <option value="-7" mlang="CEM022" >((GMT-07:00) Arizona, Chihuahua, La Paz, Mazatlan</option>
        <option value="-7" mlang="CEM023" >(GMT-07:00) Mountain Time (US & Canada)</option>
        <option value="-6" mlang="CEM024" >(GMT-06:00) Central America, Central Time (US & Canada)</option>
        <option value="-6" mlang="CEM025" >(GMT-06:00) Guadalajara, Mexico City, Monterrey, Saskatchewan</option>
        <option value="-5" mlang="CEM026" >(GMT-05:00) Bogota, Lima, Quito</option>
        <option value="-5" mlang="CEM061" >(GMT-05:00) Eastern Time (US & Canada)</option>
        <option value="-5" mlang="CEM027" >(GMT-05:00) Indiana (East)</option>
        <option value="-4" mlang="CEM028" >(GMT-04:00) Atlantic Time (Canada), Caracas, La Paz, Santiago</option>
        <option value="-3.5" mlang="CEM056" >(GMT-03:30) Newfoundland</option>
        <option value="-3" mlang="CEM029" >(GMT-03:00) Brasilia, Buenos Aires, Georgetown, Greenland</option>
        <option value="-2" mlang="CEM030" >(GMT-02:00) Mid-Atlantic</option>
        <option value="-1" mlang="CEM031" >(GMT-01:00) Azores, Cape Verde Is.</option>
        <option value="0" mlang="CEM032" >(GMT) Casablanca, Monrovia</option>
        <option value="0" mlang="CEM033" >(GMT) Greenwich Mean Time: Dublin, Edinburgh, Lisbon, London</option>
        <option value="1" mlang="CEM034" >(GMT+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna</option>
        <option value="1" mlang="CEM035" >(GMT+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague</option>
        <option value="1" mlang="CEM036" >(GMT+01:00) Brussels, Copenhagen, Madrid, Paris</option>
        <option value="1" mlang="CEM037" >(GMT+01:00) Sarajevo, Skopje, Warsaw, Zagreb, West Central Africa</option>
        <option value="2" mlang="CEM038" >(GMT+02:00) Athens, Beirut, Istanbul, Minsk</option>
        <option value="2" mlang="CEM039" >(GMT+02:00) Bucharest, Cairo, Harare, Pretoria</option>
        <option value="2" mlang="CEM040" >(GMT+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius, Jerusalem</option>
        <option value="3" mlang="CEM041" >(GMT+03:00) Baghdad, Kuwait, Nairobi, Riyadh, Tehran</option>
        <option value="4" mlang="CEM043" >(GMT+04:00) Abu Dhabi, Muscat, Baku, Tbilisi, Yerevan, Kabul</option>
        <option value="4" mlang="CEM042" >(GMT+04:00) Moscow, St. Petersburg, Volgograd</option>
        <option value="5" mlang="CEM044" >(GMT+05:00) Ekaterinburg, Islamabad, Karachi, Tashkent</option>
        <option value="5.5" mlang="CEM045" >(GMT+05:30) Chennai, Kolkata, Mumbai, New Delhi</option>
        <option value="6" mlang="CEM046" >(GMT+06:00) Almaty, Ekaterinburg, Astana, Dhaka, Sri Jayawardenepura, Rangoon</option>
        <option value="7" mlang="CEM047" >(GMT+07:00) Bangkok, Jakarta, Hanoi, Novosibirsk</option>
        <option value="8" mlang="CEM048" >(GMT+08:00) Beijing, Chongqing, Hong Kong, Urumqi</option>
        <option value="8" mlang="CEM049" >(GMT+08:00) Krasnoyarsk, Ulaan Bataar, Kuala Lumpur, Singapore, Perth, Taipei</option>
        <option value="9" mlang="CEM050" >(GMT+09:00) Tokyo, Osaka, Sapporo, Seoul, Irkutsk</option>
        <option value="9.5" mlang="CEM065" >(GMT+09:30) Adelaide, Darwin</option>
        <option value="10" mlang="CEM051" >(GMT+10:00) Brisbane, Canberra, Melbourne, Sydney</option>
        <option value="10" mlang="CEM062" >(GMT+10:00) Yakutsk</option>
        <option value="10" mlang="CEM052" >(GMT+10:00) Guam, Port Moresby, Hobart</option>
        <option value="11" mlang="CEM053" >(GMT+11:00) Vladivostok</option>
        <option value="11" mlang="CEM063" >(GMT+11:00) Magadan, Solomon Is., New Caledonia</option>
        <option value="12" mlang="CEM054" >(GMT+12:00) Fiji, Auckland, Wellington, Marshall Is.</option>
        <option value="12" mlang="CEM064" >(GMT+12:00) Kamchatka, Magadan</option>
        <option value="13" mlang="CEM055" >(GMT+13:00) Nukualofa </option>
      </select>
    </div>

    <div class="form-row">
      <label class="checkbox-container">
        <span mlang="CEM003" >Automatically adjust for daylight saving time</span>
        <input type="checkbox" name="autoDaylightSaving" id="adjust" value="true">
        <span class="checkbox-checkmark"></span>
      </label>
    </div>
  </div> <!-- form-group end -->

  <? commonCfg.bodyEnd(0, 'NTP_Settings.html') ?>
  <? commonCfg.generate_EmbedProgressBar()?>
</html>
