<!DOCTYPE HTML>
<!-- include PHP to use php functions -->
<% 
      local commonCfg = require "webGetFunc.commonCfg"
%>

<html>
<head>
  <META charset="UTF-8">
  <META http-equiv="Pragma" content="no-cache">
  <META HTTP-equiv="Cache-Control" content="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="Mon, 06 Jan 1990 00:00:01 GMT">

  <title>NETGEAR Router <? commonCfg.getModelNameStr()?></title>

  <link rel="stylesheet" href="css/table_noh.css">
  <link rel="stylesheet" href="css/scrollbar.css">
  <link rel="stylesheet" href="css/button.css">
  <link rel="stylesheet" href="css/form.css">
  <link rel="stylesheet" href="css/settings.css">
  <link rel="stylesheet" href="css/custom.css">

  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.mousewheel.js"></script>
  <script src="js/jquery.jscrollpane.min.js"></script>
  <script src="js/jquery.inputmask.min.js"></script>
  <script src="js/ipInput.js"></script>
  <script src="js/utils.js<? commonCfg.getVer(); ?>"></script>
  <script src="js/validations.js"></script>
  <script src="js/staticRoute.js"></script>

  <script language="javascript" type="text/javascript">
    //CSRF_TOKEN_TOP = <!--?= genCsrfTokenTopFilePhp('tokenNumber')?-->;

    /* var for Edit button of route rule */
    var sel_route_index = "-1";
    var sel_route_routeName;
    var sel_route_isPrivate;
    var sel_route_isActive;
    var sel_route_destIpAddr;
    var sel_route_subnetMask;
    var sel_route_gateway;
    var sel_route_metric;
    
    $(document).ready(function()
    {
        pre_fillout_init();
        post_fillout_init();
    });
    
    function pre_fillout_init(json) 
    {
        var new_tr = '<tr>\r\n\
        <td nowrap align=\"center\"> &nbsp;\r\n\
            <input type=\"radio\" name=\"select\" id=\"route_select__index\" value=\"__index\" onClick=\"onClick_SelRouteRule(\'__index\',\'__routeName\',\'__isPrivate\',\'__isActive\',\'__destIpAddr\',\'__subnetMask\',\'__gateway\',\'__metric\');\">\r\n\
        </td>\r\n\
        <td nowrap align=\"center\">\r\n\
            <span class=\"thead\">__count</span>\r\n\
        </td>\r\n\
        <td nowrap align=\"center\">\r\n\
            <span class=\"ttext\">__active</span>\r\n\
        </td>\r\n\
        <td nowrap align=\"center\">\r\n\
            <span class=\"ttext\">__routeName</span>\r\n\
        </td>\r\n\
        <td nowrap align=\"center\">\r\n\
            <span class=\"ttext\">__destIpAddr</span>\r\n\
        </td>\r\n\
        <td nowrap align=\"center\">\r\n\
            <span class=\"ttext\">__gateway</span>\r\n\
        </td>\r\n\
        <td nowrap align=center style = "display: none;" >__index</td>\r\n\
        </tr>\n';
        
        fetchTableData('static_route', 'staticRouteTable', new_tr);
         
    }

    function formSubmit_routeRule() {
        //sync the ip data to hidden input
        if ($('#destIpAddr-ip').getIp() == false) {
            alert(window.top.mlang["SWPE05"]);
            return false;
        }
        $('#destIpAddr').val($('#destIpAddr-ip').getIp());
        
        if ($('#subnetMask-ip').getIp() == false) {
            alert(window.top.mlang["SWPE05"]);
            return false;
        }
        $('#subnetMask').val($('#subnetMask-ip').getIp());
        
        if ($('#gateway-ip').getIp() == false) {
            alert(window.top.mlang["SWPE05"]);
            return false;
        }
        $('#gateway').val($('#gateway-ip').getIp());
        
        if (validation_routeRule()) {
            $.postForm('staticRouteSetup', $('#target_RouteRule'), 'cgi-bin/netgear.plua', 'postSubmit');
        }
    }
    function postSubmit(json) {
		location.href = "STR_static_route.html";
    }
    
    
    function validation_routeRule()
    {
        var routeName = $("#target_RouteRule input[name='routeName']").val();
        var destIpAddr = $("#target_RouteRule input[name='destIpAddr']").val();
        var subnetMask = $("#target_RouteRule input[name='subnetMask']").val();
        var gateway = $("#target_RouteRule input[name='gateway']").val();
        var metric = $("#target_RouteRule input[name='metric']").val();
        var action = $("#target_RouteRule input[name='action']").val();
        
        /* check route name */
        if (routeName == "" || routeName.match( /[^\x20-\x7E]/ )) {
            //"Invalid character or characters in Route Name"
            alert(window.top.mlang["OTH016"] + " " + window.top.mlang["ASR007"]);
            return false;
        }
        
        /* check if route name is duplicate */
        if (is_duplicateRouteRuleName(sel_route_index, action, routeName) == true) {
            //"Duplicate route name."
            alert(window.top.mlang["ASRE03"]);
            return false;
        }
        
        /* check IP */
        if(isValidIpStr(destIpAddr) == false)
        {
            // "Invalid Destination IP Address, please enter again."
            alert(window.top.mlang["ASRE01"]);
            return false;
        }
        if(isValidIpStr(subnetMask) == false)
        {
            // "Invalid subnet mask. Please enter it again.";
            alert(window.top.mlang["SWPE06"]);
            return false;
        }
        if(isValidIpStr(gateway) == false)
        {
            // "Invalid gateway IP address. Please enter it again.";
            alert(window.top.mlang["SWPE04"]);
            return false;
        }

        /* check metric */
        if (metric == "") {
            //"Metric must not be blank."
            alert(window.top.mlang["ASR006"] + window.top.mlang["APPE13"] );
            return false;
        }
        if (isNumStr(metric) == false) {
            //"Metric contains an invalid number."
            alert(window.top.mlang["ASR006"] + " " + window.top.mlang["OTH014"] );
            return false;
        }
        if (metric < 2 || metric > 15) {
            alert(window.top.mlang["ASR006"] + " " + window.top.mlang["OTH014"] );
            return false;
        }
        
        /* check duplicate route condition */
        if (is_duplicateRouteRule(destIpAddr, subnetMask, action)) {
            //"Duplicate route condition."
            alert(window.top.mlang["ASRE04"]);
            return false;
        }
        
        return true;
    }
    

    
    function post_fillout_init()
    {   
        /* register a onClick/onChange funtion */
        $('#target_StaticRoute [name=add_route_rule]').on('click', function() {
            onClick_add_route_rule();
        });
        $('#target_StaticRoute [name=edit_route_rule]').on('click', function() {
            onClick_edit_route_rule();
        });
        $('#target_StaticRoute [name=del_route_rule]').on('click', function() {
            onClick_del_route_rule();
        });
        
        post_fillout_init_routeRule();
    }
    
    function post_fillout_init_routeRule()
    {
        /* sync checkbox value */
        $('#target_RouteRule [name=isPrivate]').on('change', function() {
            $('#target_RouteRule [name=isPrivate]').val($('#target_RouteRule [name=isPrivate]').prop("checked"));
        });
        $('#target_RouteRule [name=isActive]').on('change', function() {
            $('#target_RouteRule [name=isActive]').val($('#target_RouteRule [name=isActive]').prop("checked"));
        });
    }

    /* Onclick Callback Section --------> Begin */
    function onClick_SelRouteRule(index, routeName, isPrivate, isActive, destIpAddr, subnetMask, gateway, metric)
    {
        sel_route_index = index;
        sel_route_routeName = routeName;
        sel_route_isPrivate = isPrivate;
        sel_route_isActive = isActive;
        sel_route_destIpAddr = destIpAddr;
        sel_route_subnetMask = subnetMask;
        sel_route_gateway = gateway;
        sel_route_metric = metric;
    }
     
    function onClick_add_route_rule()
    {
        $("#target_RouteRule input[name='action']").val("add");
	$("#target_RouteRule input[name='isPrivate']").val("false");
	$("#target_RouteRule input[name='isActive']").val("true");
        
        /* init IP element */
        $('#destIpAddr-ip').ipInput();
        $('#subnetMask-ip').ipInput();
        $('#gateway-ip').ipInput();
        /* fill auto test IDs of IP element */
        $('#destIpAddr-ip :input').each(function(index){
            $(this).attr("id", 'route_dest_address' + (index+1));  
        });
        $('#subnetMask-ip :input').each(function(index){
            $(this).attr("id", 'route_net_mask' + (index+1));  
        });
        $('#gateway-ip :input').each(function(index){
            $(this).attr("id", 'route_gateway' + (index+1));  
        });
        
        /* show form "target_RouteRule"*/
        show_RouteRule_form();

        //PEGA JYang, change the edit id to "main"
        $('div[name=main]').attr("id", "");
        $('div[name=mainEdit]').attr("id", "main");
    }
    

    
    function onClick_edit_route_rule()
    {
        /* no rule is selected */
        if (sel_route_index == "-1")
        {
            //"Please select an item to edit"
            alert(window.top.mlang["AAWE08"]);
            return;
        }
        
        /* Fillout selected rule data into form 'target_RouteRule' */
        $("#target_RouteRule input[name='action']").val("edit");
        $("#target_RouteRule input[name='iid']").val(sel_route_index);
        $("#target_RouteRule input[name='routeName']").val(sel_route_routeName);
        $("#target_RouteRule input[name='isPrivate']").val(sel_route_isPrivate);
        $("#target_RouteRule input[name='isPrivate']")[0].checked = (sel_route_isPrivate == "true");
        $("#target_RouteRule input[name='isActive']").val(sel_route_isActive);
        $("#target_RouteRule input[name='isActive']")[0].checked = (sel_route_isActive == "true");
        
        /* init IP element in RouteRule page */
        $('#target_RouteRule #destIpAddr-ip').ipInput().setIp(sel_route_destIpAddr);
        $("#target_RouteRule input[name='destIpAddr']").val(sel_route_destIpAddr);
        $('#target_RouteRule #subnetMask-ip').ipInput().setIp(sel_route_subnetMask);
        $("#target_RouteRule input[name='subnetMask']").val(sel_route_subnetMask);
        $('#target_RouteRule #gateway-ip').ipInput().setIp(sel_route_gateway);
        $("#target_RouteRule input[name='gateway']").val(sel_route_gateway);
        /* fill auto test IDs of IP elements */
        $('#destIpAddr-ip :input').each(function(index){
            $(this).attr("id", 'route_dest_address' + (index+1));  
        });
        $('#subnetMask-ip :input').each(function(index){
            $(this).attr("id", 'route_net_mask' + (index+1));  
        });
        $('#gateway-ip :input').each(function(index){
            $(this).attr("id", 'route_gateway' + (index+1));  
        });
        $('[name=isPrivate]').attr("id", 'SRoutePrivate');
        $('[name=isActive]').attr("id", 'SRouteActive');
        
        $("#target_RouteRule input[name='metric']").val(sel_route_metric);  
        
        /* show form "target_RouteRule"*/
        show_RouteRule_form();

        //PEGA JYang, change the edit id to "main"
        $('div[name=main]').attr("id", "");
        $('div[name=mainEdit]').attr("id", "main");
    }
    
    function onClick_del_route_rule()
    {
        /* no rule is selected */
        if (sel_route_index == "-1")
        {
            //"Please select an item to delete"
            alert(window.top.mlang["AAWE07"]);
            return;
        }
        
        $("#target_RouteRule input[name='action']").val("delete");
        $("#target_RouteRule input[name='iid']").val(sel_route_index);
        $("#target_RouteRule input[name='routeName']").val(sel_route_routeName);
        $("#target_RouteRule input[name='isPrivate']").val(sel_route_isPrivate);
        $("#target_RouteRule input[name='isActive']").val(sel_route_isActive);
        $("#target_RouteRule input[name='destIpAddr']").val(sel_route_destIpAddr);
        $("#target_RouteRule input[name='subnetMask']").val(sel_route_subnetMask);
        $("#target_RouteRule input[name='gateway']").val(sel_route_gateway);
        $("#target_RouteRule input[name='metric']").val(sel_route_metric);
        
        /* Send post for deleting forward rule */
        $.postForm('staticRouteSetup', $('#target_RouteRule'), 'cgi-bin/netgear.plua', 'postSubmit');
    }
    /* Onclick Callback Section --------> End */

  </script>


</head>

<body onload="window.top.change_size($(this));loadhelp('STR_static_route','');" class="page-body" onResize="window.top.change_size($(this));">
    <div id="main_page"> <!-- main_page div end -->
    <div class="page-header" style="position: relative;" mlang="LUP035">Static Routes</div>
    <div id="main" name="main" class="form-group" style=height:410px;overflow:auto;scrolling:auto">
    
    <!-- static route form -->
    <form id="target_StaticRoute"  name="formname_StaticRoute" method="POST" >
        
        <div class="form-row">
            <table class="tbWhite cmn-table-2" name="staticRoute_table" id="static_route" border="1" cellpadding="2" cellspacing="0" width="97%">
                <tr class="table_header">
                    <td nowrap width="5%" align="center"><span class="thead">&nbsp;</span></td>
                    <td nowrap width="5%" align="center"><span class="thead">#</span></td>
                    <td width="15%" align="center"><span class="thead" mlang="ASR001">Active</span></td>
                    <td width="25%" align="center"><span class="thead" mlang="ASR007">Route Name</span></td>
                    <td width="25%" align="center"><span class="thead" mlang="ASR002">Destination</span></td>
                    <td width="25%" align="center"><span class="thead" mlang="ASR004">Gateway</span></td>
                    <td align="center" style="display: none;"></td>
                </tr>
            </table>
        </div>
        
        <div class="form-row">
            <td colspan="2" align="center">
                <button type="button" value="add" id="add" name="add_route_rule" class="button-sty1" mlang="OTH012">Add</button>
                <button type="button" value="edit" id="edit" name="edit_route_rule" class="button-sty1" mlang="UAS011">Edit</button>
                <button type="button" value="delete" id="delete" name="del_route_rule" class="button-sty1"  mlang="UAS013">Delete</button>
            </td>
        </div>
    </form>
    <!-- static route form end -->
    
    </div><!-- form-group end -->
    
    </div> <!-- main_page div end -->

    <!-- static route rule form begin -->
    <form id="target_RouteRule"  name="formname_RouteRule" method="POST" style="display: none;">
        <div class="page-header" style="position: relative;" mlang="LUP035">Static Routes</div>
        <div id="mainEdit" name="mainEdit" class="form-group" style=height:365px;overflow:auto;scrolling:auto">
            <div class="form-row">
                <span mlang="ASR007" >Route Name</span>
            </div>
            
            <div class="form-row">
                <input class="input1" type="text" name="routeName" id="route_name" size="30" maxlength="30" value="">
            </div>
            
            <div class="form-row">
                <label class="checkbox-container">
                    <span mlang="ASR005" >Private</span>
                    <input type="checkbox" name="isPrivate" id="route_private" value="true">
                    <span class="checkbox-checkmark"></span>
                </label>
            </div>
            
            <div class="form-row">
                <label class="checkbox-container">
                    <span mlang="ASR001" >Active</span>
                    <input type="checkbox" name="isActive" id="route_active" value="true" checked>
                    <span class="checkbox-checkmark"></span>
                </label>
            </div>
            
            <div class="form-row">
                <b mlang="ASR003">Destination IP Address</b>
            </div>
            
            <div id="destIpAddr-ip"></div>
            <input type="hidden" id="destIpAddr" name="destIpAddr">
            
            <div class="form-row">
                <b mlang="SWP044">"IP Subnet Mask</b>
            </div>
            
            <div id="subnetMask-ip"></div>
            <input type="hidden" id="subnetMask" name="subnetMask">

            <div class="form-row">
                <b mlang="SWP034">Gateway IP Address</b>
            </div>
            
            <div id="gateway-ip"></div>
            <input type="hidden" id="gateway" name="gateway">
            
            <div class="form-row">
                <b mlang="ASR006">Metric</b>
            </div>
            
            <div class="form-row">
                <input class="input1" type="TEXT" name="metric" id="route_metric" class="num" size="3" maxlength="2">
            </div>
        </div> <!-- form-group end -->
    
        <div class="form-btn-row" id="form_btn_fwdrule">
            <button type="button" value="BUTTON"  onClick="location.href='STR_static_route.html';" name="Cancel" id="cancel" class="button-cancel cancel_bt" mlang="UAS021">Cancel</button>
            <button type="button" value="apply"  onClick="formSubmit_routeRule($(this))" name="apply" id="apply" class="button-apply apply_bt" mlang="LUP004" >Apply</button>
        </div>
        
        <input type="hidden" name="action" value="">
        <input type="hidden" name="iid" value="">
    </form>
    <!-- static route rule form end -->

    </body>
   <? commonCfg.genHelpSection() ?>
</html>
