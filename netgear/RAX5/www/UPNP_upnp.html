<!DOCTYPE HTML>
<%
      local commonCfg = require "webGetFunc.commonCfg"
%>
<html>
<head>
  <META charset="UTF-8">
  <META http-equiv="Pragma" content="no-cache">
  <META HTTP-equiv="Cache-Control" content="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="Mon, 06 Jan 1990 00:00:01 GMT">
  
  <title>NETGEAR Router <? commonCfg.getModelNameStr()?></></title>



  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.jscrollpane.min.js"></script>
  <script src="js/jquery.mousewheel.js"></script>
  <script src="js/ipInput.js"></script>
  <script src="js/utils.js<? commonCfg.getVer(); ?>"></script>
  <script src="js/validations.js"></script>

  <link rel="stylesheet" href="css/button.css">
  <link rel="stylesheet" href="css/settings.css">
  <link rel="stylesheet" href="css/scrollbar.css">
  <link rel="stylesheet" href="css/form.css">
  <link rel="stylesheet" href="css/custom.css"  type="text/css">
  <script language="javascript" type="text/javascript">

  CSRF_TOKEN = <?= commonCfg.genCsrfTokenFile('tokenNumber')?>;

  $(document).ready(function() {
      refreshUnpnpPortMapTable();
      fetchData('target', 'upnp');

      $("#upnp").on("click", function(){
          $(this).val($(this).prop("checked"));
      });

      $("#refresh").on("click", function(){
          refreshUnpnpPortMapTable();
      });

      $("#cancel").on("click", function(){
          window.location.reload();
      });
      
      $("#apply").on("click", function(){
          if(validate())
          {
              $("input[name=advPeriod]").val(parseInt($("input[name=AdverTime]").val()) * 60);
              $.postForm('upnp', $('#target'), 'cgi-bin/netgear.plua');
          }
          
      });
  });

  function validate()
  {
      if(!CheckAdverTimeVal())
          return false;
      else if(!CheckTimeToLiveVal())
          return false;
      else
      {
          return true;
      }
  }

  function CheckAdverTimeVal()
  {
      var advTime = $("input[name=AdverTime]").val();
      if(advTime.trim().length == 0)
      {
          alert(window.top.mlang["OTH013"] + " " + window.top.mlang["AUP001"]);
          $("input[name=AdverTime]").val($("input[name=hiddenAdverTime]").val());
          $("input[name=AdverTime]").focus();
          return false;
      }
      if(!$.isNumeric(advTime))
      {
          alert(window.top.mlang["AUP001"] + " " + window.top.mlang["OTH014"]);
          $("input[name=AdverTime]").val($("input[name=hiddenAdverTime]").val());
          $("input[name=AdverTime]").focus();
          return false;
      }
      if((advTime >1440 )||(advTime <= 0 ))
      {
          alert(window.top.mlang["AUPE01"]);
          $("input[name=AdverTime]").val($("input[name=hiddenAdverTime]").val());
          $("input[name=AdverTime]").focus();
          return false;
      }
      return true
  }

  function CheckTimeToLiveVal()
  {
      var timeToLive = $("input[name=advTtl]").val();
      if(timeToLive.trim().length == 0)
      {
          alert(window.top.mlang["OTH013"] + " " + window.top.mlang["AUP007"]);
          $("input[name=advTtl]").val($("input[name=hiddenTimeToLive]").val());
          $("input[name=advTtl]").focus();
          return false;
      }

      if(!$.isNumeric(timeToLive))
      {
          alert(window.top.mlang["AUP007"] + " " +  window.top.mlang["OTH014"]);
          $("input[name=advTtl]").val($("input[name=hiddenTimeToLive]").val());
          $("input[name=advTtl]").focus();
          return false;
      }

      if((timeToLive > 255 )||(timeToLive <= 0 ))
      {
          alert( window.top.mlang["AUPE02"]);
          $("input[name=advTtl]").val($("input[name=hiddenTimeToLive]").val());
          $("input[name=advTtl]").focus();
          return false;
      }

      return true
  }

  function removeTableRow()
  {
      $(".table_row").remove();  
  }

  function refreshUnpnpPortMapTable()
  {
      var new_tr = '<tr class="table_row">\r\n\
                      <td nowrap align=\"center\">\r\n\
                        <span class=\"ttext\">YES</span>\r\n\
                      </td>\r\n\
                      <td nowrap align=\"center\">\r\n\
                        <span class=\"ttext\">__protocol</span>\r\n\
                      </td>\r\n\
                      <td nowrap align=\"center\">\r\n\
                        <span class=\"ttext\">__interPort</span>\r\n\
                      </td><td nowrap align=\"center\">\r\n\
                        <span class=\"ttext\">__extPort</span>\r\n\
                      </td>\r\n\
                      <td nowrap align=\"center\">\r\n\
                        <span class=\"ttext\">__ip</span>\r\n\
                      </td>\r\n\
                    </tr>';
      fetchTableData('upnp_portmap', 'upnp_portmap_table', new_tr, 'removeTableRow');  
    
  }
  </script>  
</head>

<body onload="window.top.change_size($(this));loadhelp('UPNP_upnp','')"" class="page-body" onResize="window.top.change_size($(this));">
  <form id="target"  name="formname" method="POST" >
    <div class="page-header" style="position: relative;" mlang="LUP038">UPnP</div>
    <div id="main" class="form-group" style=height:365px;overflow:auto;scrolling:auto">
      <div class="form-row ">
        <label class="checkbox-container">
          <input type="checkbox" name="enableUpnp" id="upnp" value="true"><B><a href="javascript:loadhelp('UPNP_upnp','turnon')" tabindex="-1" mlang="AUP005">Turn UPnP On</a></B>
          <span class="checkbox-checkmark"></span>
        </label>
      </div>
      <div class="form-row ">
        <b><a href="javascript:loadhelp('UPNP_upnp','adv')" tabindex="-1" mlang="AUP001">Advertisement Period</a></b>
        <span mlang="APP001">(in minutes)</span>
      </div>
      <div class="form-row ">
        <input type="text" class="num input1" name="AdverTime" id="adver_time" size="5" maxlength="4" value="" onFocus="this.select();" >
      </div>
      <div class="form-row ">
        <b><a href="javascript:loadhelp('UPNP_upnp','live')" tabindex="-1" mlang="AUP007">Advertisement Time to Live</a></b>
        <span mlang="AUP003">(in hops)</span>
      </div>
      <div class="form-row ">
        <input type="text" class="num input1" name="advTtl" id="time_to_live" size="4" maxlength="3" value="" onFocus="this.select();" >
      </div>

      <div class="divider">&nbsp;</div>

      <div class="form-row">
        <b><a href="javascript:loadhelp('UPNP_upnp','table')" tabindex="-1" mlang="AUP006">UPnP Portmap Table</a></b>
      </div>
      <div class="form-row">
        <table border ="1" cellpadding ="0" cellspacing ="0" width="100%" id="upnp_portmap"  class="tbWhite cmn-table-2">
          <tr class="table_header">
            <td width="10%" align="center"><span class="thead" mlang="ASR001">Active</span></td>
            <td width="15%" align="center"><span class="thead" mlang="SBS014">Protocol</span></td>
            <td width="15%" align="center"><span class="thead" mlang="AUP004">Int. Port</span></td>
            <td width="15%" align="center"><span class="thead" mlang="AUP002">Ext. Port</span></td>
            <td width="25%" align="center"><span class="thead" mlang="SWP030">IP Address</span></td>
          </tr>
        </table>
      </div>
    </div><!--form-group-->  
  
    <div class="form-btn-row" id="form_btn_div">
      <button type="button" value="refresh"name="refresh" id="refresh" class="button-common common_bt" mlang="UBS012">Refresh</button>
      <button type="button" value="cancel" name="Cancel" id="cancel" class="button-cancel cancel_bt" mlang="UAS021">Cancel</button>
      <button type="button" value="apply"  name="apply" id="apply" class="button-apply apply_bt" mlang="LUP004" >Apply</button>
    </div>
    <input type="hidden" value="" name="hiddenAdverTime" disabled>
    <input type="hidden" value="" name="hiddenTimeToLive" disabled>
    <input type="hidden" value="" name="advPeriod">
</form>
 <? commonCfg.genHelpSection() ?>
</html>
