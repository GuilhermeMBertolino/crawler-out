<!DOCTYPE HTML>
<% 
    local commonCfg = require "webGetFunc.commonCfg"
%>

<html>
<head>
  <META charset="UTF-8">
  <META http-equiv="Pragma" content="no-cache">
  <META HTTP-equiv="Cache-Control" content="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="Mon, 06 Jan 1990 00:00:01 GMT">

  <title>NETGEAR Router <?= commonCfg.getModelNameStr()?></title>

  <link rel="stylesheet" href="css/table_noh.css">
  <link rel="stylesheet" href="css/scrollbar.css">
  <link rel="stylesheet" href="css/button.css">
  <link rel="stylesheet" href="css/form.css">
  <link rel="stylesheet" href="css/settings.css<?= commonCfg.getVer() ?>">
  <link rel="stylesheet" href="css/custom.css">

  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.mousewheel.js"></script>
  <script src="js/jquery.jscrollpane.min.js"></script>
  <script src="js/jquery.inputmask.min.js"></script>
  <script src="js/ipInput.js"></script>
  <script src="js/utils.js<?= commonCfg.getVer() ?>"></script>
  <script src="js/validations.js<?= commonCfg.getVer() ?>"></script>
  <script src="js/embedProgressBar.js"></script>

  <script language="javascript" type="text/javascript">
    
    CSRF_TOKEN = <?= commonCfg.genCsrfTokenFile('tokenNumber')?>;
    var bridge_support = <?= commonCfg.getBridgeSupport()?>;

    $(document).ready(function()
    {
        /* decide to hidden bridge mode or not */
        if (bridge_support  == "1") {
            $('#label_bridge').show();
            $('#apid').show();
            $('#bridge').show();
        }
        else {
            $('#label_bridge').hide();
            $('#apid').hide();
            $('#bridge').hide();
        }
        fetchData('target', 'wireless_apmode_router', '', 'post_fillout_init');
    });

    function formSubmit() 
    {
        if ($("[name=runningMode]").val() == "router") {
            // Router mode to router mode, do nothing
            return;
        }
        
        if (validation()) {
            $.postForm('opMode', $('#target'), 'cgi-bin/netgear.plua', 'postForm_callback');
            
            /* system would reboot after sending post, show progress bar and go back to first page */
            show_EmbedProgressBar('D-genie_377', 120000, 'http://www.routerlogin.net');
            
            //un-greyout ApMode-ReadOnly/BridgeMode-ReadOnly submenus when DUT switch to router mode
            parent.$(".ApMode-ReadOnly").css("pointer-events", "");
            parent.$(".ApMode-ReadOnly").css("opacity", "");
            parent.$(".ApMode-ReadOnly").removeClass("auto_grey");
            parent.$(".BridgeMode-ReadOnly").css("pointer-events", "");
            parent.$(".BridgeMode-ReadOnly").css("opacity", "");
            parent.$(".BridgeMode-ReadOnly").removeClass("auto_grey");
        }
    }
    
    function validation()
    {
        return true;
    }
    
    function postForm_callback()
    {
        /* Refreshing page is already done by progress bar, the callback function do nothing here is
        to avoid the postForm defaultHandler() refreshing page may interrupt the execution of progress bar
        */
    }
    
    function post_fillout_init()
    {   
        /* init function */
        init_mlang_strings();
        init_runningMode();

        /* register a onClick/onChange funtion */
        $('#target [name=mode]').on('change', function() {
            onChange_mode($('[name=mode]:checked').val());
        });
    }
    
    /* init function Section --------> Begin */
    function init_mlang_strings()
    {
        //replace loadhelp() in the mlang string
        $('#mode_d a').attr("href", "javascript:loadhelp('WLG_ap_router','mode')");
    }
    
    function init_runningMode()
    {
        var runningMode = $('[name=runningMode]').val();
        
        //change the color of the icon based on which mode is running
        if (runningMode == "router") {
            $("#router").removeClass("icon").addClass("icon_select");
        }
        else if (runningMode == "ap") {
            $("#ap").removeClass("icon_unselect").addClass("icon_select");
        }
        else if (runningMode == "bridge") {
            $("#bridge").removeClass("icon_unselect").addClass("icon_select");
        }
    }
    /* init function Section --------> End */
    
    /* Onclick Callback Section --------> Begin */
    function onChange_mode(mode) {
        if (mode == "router") {
            location.href="WLG_ap_router.html";
        }
        else if (mode == "ap") {
            location.href="WLG_ap_ap.html";
        }
        else if (mode == "bridge") {
            location.href="WLG_ap_bridge.html";
        }
    }
    /* Onclick Callback Section --------> End */ 
    
    function onClick_internet()
    {
        //jump to internet setup page
        parent.highLightMenu('setup_header', 'int_set');
        parent.loadPage("BAS_wan.html");
    }
    
    function onClick_wireless()
    {
        //jump to wireless setup page
        parent.highLightMenu('setup_header', 'wireless_set');
        parent.loadPage("WLG_wireless.html");
    }
  </script>

<style>
.boxline{width: 590px; height: 180px; margin: 0 auto; position: relative;}
.box_select {width: 170px; height: 150px; float: left; position: relative; margin-left: 20px; margin-top: 20px;}
.box_select .radio_box{width: 90%; height: 20px; font-size: 13px; font-weight: bold; color: black; position: relative; top: 10px; padding-left: 10%;}
.box_select .icon_unselect, .box_select .icon_select{width:100px; height: 100px; position: absolute; bottom: 0px; left: 20px; cursor: pointer;}
.box_select .icon_unselect img, .box_select .icon_select img{width:100px; height:100px}
.box {width: 170px; height: 110px; float: left; position: relative; margin-left: 20px; margin-top: 30px; }
.box .radio_box{width: 90%; height: 20px; font-size: 11px; font-weight: bold; color: black; position: relative; top: 10px; padding-left: 10%;}
.box .icon_unselect, .box .icon_select{width:60px; height: 60px; position: absolute; bottom: 0px; left: 20px; cursor: pointer;}
.box .icon_unselect img, .box .icon_select img{width:60px; height:60px}
.icon_unselect { background-color: #5db5e5;border-radius:8px;}
.icon_select { background-color: #6abd49;}

#content1{width:58%;height:auto;position:relative;left:5%;float:left;background-image:url(images/v_middleline.gif);background-repeat:repeat-y;background-position:100% 0}
#content3{width:25%;height:auto;position:relative;left:5%;float:left}
</style>

</head>

<body onload="window.top.change_size($(this));loadhelp('WLG_ap_router','');" class="page-body" onResize="window.top.change_size($(this));">
    <div class="page-header" style="position: relative;">
        <span mlang="ACB_113">Router / AP Mode</span>
    </div>
    
    <div id="main" class="form-group"  style=height:365px;overflow:auto;scrolling:auto">
    
    <!-- form -->
    <form id="target"  name="formname" method="POST" >
        <div class="main_top_button">
            <div class="boxline">
                <div class="box_select">
                    <div class="radio_box">
                        <input type="radio" name="mode" value="router" id="routerid" checked>
                        <label for="routerid" mlang="RAEM06"> Router Mode </label>
                    </div>
                    <div id="router" class="icon_unselect" onclick="onChange_mode('router')">
                        <img src="/images/router.gif">
                    </div>
                </div>
                <div class="box">
                    <div class="radio_box">
                        <input type="radio" name="mode" id="routerapid" value="ap"  >
                        <label for="routerapid" mlang="AAW028"> AP Mode </label>
                    </div>
                    <div id="ap" class="icon_unselect" onclick="onChange_mode('ap')">
                        <img src="/images/ap.gif">
                    </div>
                </div>
                <div class="box">
                    <div class="radio_box">
                        <input type="radio" name="mode" id="apid" value="bridge"  >
                        <label id="label_bridge" for="apid" mlang="MRS093"> Bridge Mode </label>
                    </div>
                    <div id="bridge" class="icon_unselect" onclick="onChange_mode('bridge')">
                        <img src="/images/bridge.gif">
                    </div>
                </div>
                
                <input type="hidden" name="runningMode" disabled>
            </div>
            
            <div id="content1" style="font-size:14px;">
                <table>
                    <tr>
                        <td  align="left" id="mode_d" mlang="RAEM12">
                            <!--<a tabindex=-1 href="javascript:loadhelp('_rae_router','mode')"><b>Router Mode:</b></a>This mode allows you to take advantage of NETGEAR router functions. The NETGEAR router is set up as a normal WiFi router behind your existing router or gateway. This mode requires that all of your devices be connected to the new NETGEAR router and not to your existing gateway.-->
                        </td>
                    </tr>
                    <tr><td height="10px"></td></tr>
                    <tr><td>
                        <button class="new_apply_bt2" type="button" id="learn_router" onclick="window.open('rae_learn.html','newwindow','resizable=no,scrollbars=yes,toolbar=no,menubar=no,status=no,location=no,alwaysRaised=yes,z-look=yes,width=800,height=600,left=200,top=100').focus();" mlang="LPC104">Learn more</button>
                    </td></tr>
                </table>
            </div>
            
            <div id="content3" style="font-size:14px;">
                <table>
                    <tr><td><span mlang="RAEM07">To change router settings</span>:</td></tr>
                    <tr><td>
                        <button type="button" id="internet" class="wireless_bt2" onclick="onClick_internet();" mlang="genie_68">Internet Setup</button>
                    </td></tr>
                    <tr><td height="5px"></td></tr>
                    <tr><td>
                        <button type="button" id="wireless" class="wireless_bt2" onclick="onClick_wireless();" mlang="genie_153">Wireless Setup</button>
                    </td></tr>
                </table>
            </div>
            
            <div><img src="images/G1.png" style="padding-left:30px; padding-top:40px"></div>
            
        </div>
        <!-- These hidden parameters are for cgi happy -->
        <input type="hidden" name="ipType" value="">
        <input type="hidden" name="ipAddr" value="">
        <input type="hidden" name="netmask" value="">
        <input type="hidden" name="gateway" value="">
        <input type="hidden" name="dnsType" value="">
        <input type="hidden" name="dns1" value="">
        <input type="hidden" name="dns2" value="">
    </form>
    <!-- form end -->
    </div><!-- form-group end -->
    
    <div class="form-btn-row" id="form_btn_div">
        <button type="button" value="cancel"  onClick="location.href='WLG_ap_basic.html';" name="Cancel" id="cancel" class="button-cancel cancel_bt" mlang="UAS021">Cancel</button>
        <button type="button" value="apply"  onClick="formSubmit($(this))" name="apply" id="apply" class="button-apply apply_bt" mlang="LUP004">Apply</button>
    </div>

    <?= commonCfg.genHelpSection() ?>
    <?= commonCfg.generate_EmbedProgressBar() ?>
    
</html>
