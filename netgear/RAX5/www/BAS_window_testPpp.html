<!DOCTYPE HTML>
<% 
      local commonCfg = require "webGetFunc.commonCfg"
%>

<html>
<head>
  <META charset="UTF-8">
  <META http-equiv="Pragma" content="no-cache">
  <META HTTP-equiv="Cache-Control" content="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="Mon, 06 Jan 1990 00:00:01 GMT">

  <title>NETGEAR Router <?= commonCfg.getModelNameStr()?></title>

  <link rel="stylesheet" href="css/table_noh.css">
  <link rel="stylesheet" href="css/scrollbar.css">
  <link rel="stylesheet" href="css/button.css">
  <link rel="stylesheet" href="css/form.css">
  <link rel="stylesheet" href="css/settings.css">
  <link rel="stylesheet" href="css/custom.css">

  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.mousewheel.js"></script>
  <script src="js/jquery.jscrollpane.min.js"></script>
  <script src="js/jquery.inputmask.min.js"></script>
  <script src="js/ipInput.js"></script>
  <script src="js/utils.js<? commonCfg.getVer(); ?>"></script>
  <script src="js/validations.js"></script>

  <script language="javascript" type="text/javascript">
    CSRF_TOKEN = <?= commonCfg.genCsrfTokenFile('tokenNumber')?>;

    var g_intervalId = -1;
    
    $(document).ready(function()
    {
        fetchData('target', 'internetPppStatus', '', 'post_fillout_init');
    });

    
    function post_fillout_init()
    {   
        $("[mlang]").each(function(idx, obj) {
              obj.innerHTML = window.opener.top.mlang[obj.attributes.mlang.value];
        });
        
        //when internet connection is detected, display NETGEAR website, otherwise refresh the page
        if ($('[name=internetStatus]').val() == "up") { 
            if (g_intervalId != -1) {
                clearInterval(g_intervalId);
            }
            //goto NETGEAR website
            //Steven modify for IR-093, modify delay time from 2000ms to 5000ms
            g_intervalId = setInterval("location.href='http://www.netgear.com/success/generic.aspx';", 5000);
        }
        else if ($('[name=internetStatus]').val() == "down") { 
            if (g_intervalId != -1) {
                clearInterval(g_intervalId);
            }
            //refresh page
            g_intervalId = setInterval("fetchData('target', 'internetPppStatus', '', 'post_fillout_init')", 2500);
        }
        
    }
    
  </script>


</head>

<body bgcolor="#ffffff">
    <form id="target"  name="formname">
        <table border="0" width="95%" align="center" id="internet_status_table">
            <tr>
                <td colspan="2" align="center">
                    <b mlang="SBS035">Testing Internet Connection</b>
                </td>
            </tr>
            <tr>
                <td colspan="2" height="12">
                    <div class="divider">&nbsp;</div>
                </td>
            </tr>
            <tr>
                <td colspan="2" align="left">
                    <span mlang="SBS033">This page will automatically display the NETGEAR website if a successful Internet connection is detected.</span>
                </td>
            </tr>
        </table>
        <br>
        <table width="95%" border=1 cellspacing=1 cellpadding=5 align="center" class="tbWhite cmn-table-2">
        	<tr>
                <td nowrap width="50%">
                    <font face="Arial, Helvetica, sans-serif" size=2>
                        <b mlang="SBS036">Connection Time</b>
                    </font>
                </td>
                <td nowrap width="50%">
                    <font face="Arial, Helvetica, sans-serif" size=2>
                        <span name="wanPortConnectTime"></span>
                    </font>
                </td>
            </tr>
            <tr>
                <td nowrap width="50%">
                    <font face="Arial, Helvetica, sans-serif" size=2>
                        <b mlang="SBS032">Connecting to server</b>
                    </font>
                </td>
                <td nowrap width="50%">
                    <font face="Arial, Helvetica, sans-serif" size=2>
                        <span name="wanPortConnectStatus"></span>
                    </font>
                </td>
            </tr>
            <tr>
                <td nowrap width="50%">
                    <font face="Arial, Helvetica, sans-serif" size=2>
                        <b mlang="SBS019">Negotiation</b>
                    </font>
                </td>
                <td nowrap width="50%">
                    <font face="Arial, Helvetica, sans-serif" size=2>
                        <span name="negotiationStatus"></span>
                    </font>
                </td>
            </tr>
            <tr>
                <td nowrap width="50%">
                    <font face="Arial, Helvetica, sans-serif" size=2>
                        <b mlang="SBS018">Authentication</b>
                    </font>
                </td>
                <td nowrap width="50%">
                    <font face="Arial, Helvetica, sans-serif" size=2>
                        <span name="authStatus"></span>
                    </font>
                </td>
            </tr>
            <tr>
                <td nowrap width="50%">
                    <font face="Arial, Helvetica, sans-serif" size=2>
                        <b mlang="SBS034">Getting IP address</b>
                    </font>
                </td>
                <td nowrap width="50%">
                    <font face="Arial, Helvetica, sans-serif" size=2>
                        <span name="wanIp"></span>
                    </font>
                </td>
            </tr>
        </table>
        <table border="0" cellpadding="0" cellspacing="3" align="center" width="95%">
            <tr>
                <td colspan="2" height="12">
                    <div class="divider">&nbsp;</div>
                </td>
            </tr>       
             <tr>
                <td colspan="2" align="center"><BR>
                    <button type="button" value="Close" id="close" class="button-sty1" onClick="top.window.close();" mlang="OTH002">Close</button>
                </td>
            </tr>
        </table>
        <!--The disabled inputs values is gotten from fetchData(), and the input name will not be included into post parameters -->
        <input type="hidden" name="internetStatus" disabled>
    </form>
</html>
