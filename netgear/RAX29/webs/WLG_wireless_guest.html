<!DOCTYPE HTML>
<? include 'php/commonCfg.php';?>
<? include_once 'php/apmode.php';?>
<html>
<head>
  <META charset="UTF-8">
  <META http-equiv="Pragma" content="no-cache">
  <META HTTP-equiv="Cache-Control" content="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="Mon, 06 Jan 1990 00:00:01 GMT">

  <title>NETGEAR Router <?= getModelNameStr()?></title>

  <link rel="stylesheet" href="css/table_noh.css">
  <link rel="stylesheet" href="css/scrollbar.css">
  <link rel="stylesheet" href="css/button.css">
  <link rel="stylesheet" href="css/form.css">
  <link rel="stylesheet" href="css/settings.css<? getVer(); ?>">

  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.mousewheel.js"></script>
  <script src="js/jquery.jscrollpane.min.js"></script>
  <script src="js/jquery.inputmask.min.js"></script>
  <script src="js/ipInput.js"></script>
  <script src="js/utils.js<? getVer(); ?>"></script>
  <script src="js/validations.js<? getVer(); ?>"></script>
  <script src="js/wireless.js"></script>
  <script src="js/embedProgressBar.js"></script>
<!--
  <link rel="stylesheet" href="css/form.css">
  <style TYPE="text/javascript">
    classes.num.all.fontFamily = "Courier";
    classes.num.all.fontSize = "10pt" ;
  </style>
-->

  <script language="javascript" type="text/javascript">
    CSRF_TOKEN = <?= genCsrfTokenFilePhp('tokenNumber')?>;

    /* pre_fillout_init() callback function replaces the position of ready() function */
    var opMode = "<?= getRadioVal_mode() ?>";
    function pre_fillout_init(json)
    {
    }

     function changeSecurityHint()
    {
            var val_2GSecurity = $('[name=2GSecurity]:checked').val();
            var val_5GSecurity = $('[name=5GSecurity]:checked').val();        

            if(val_2GSecurity == "5")
            {
                $("#2GpwdHint").text($("#2GpwdHint").text().replace("63","127").replace("64","128"));
            }
            else
            {
                $("#2GpwdHint").text($("#2GpwdHint").text().replace("127","63").replace("128","64"));
            }
    
            if(val_5GSecurity == "5")
            {
                $("#5GpwdHint").text($("#2GpwdHint").text().replace("63","127").replace("64","128"));
            }
            else
            {
                $("#5GpwdHint").text($("#2GpwdHint").text().replace("127","63").replace("128","64"));
            }  
    }

    function afterSubmit() {
      show_EmbedProgressBar('SWP046', 25000, '/WLG_wireless_guest.html');
    }

    function formSubmit(btn) {
      if (opMode == "ap") {
        $('#allow_access').prop("disabled", false);
        $('#allow_access_an').prop("disabled", false);
      }
      if (validation(document.forms[0])) {
        $.postForm('guestNetwork', $('#target'), 'cgi-bin/rex_cgi', 'afterSubmit');
      }
      else {
        if (opMode == "ap") {
          $('#allow_access').prop("disabled", true);
          $('#allow_access_an').prop("disabled", true);
        }
      }
    }

    function validation(f) {
      var ssid_2g = $('[name=2GSsid]').val();
      var ssid_5g = $('[name=5GSsid]').val();
      //var ssid_5g1 = $('#5G1Ssid').val();
      
      /* Check SSID */
      if (ssid_2g == "")
      {
        alert(window.top.mlang["SWSE07"]);
        return false;
      }
      
      if (ssid_2g.match( /[^\x20-\x7E]/ ))
      {
        alert(window.top.mlang["SWSE02"]);
        $('[name=2GSsid]').focus();
        return false;
      }
      
      if (ssid_5g == "")
      {
        alert(window.top.mlang["SWSE07"]);
        return false;
      }
      
      if (ssid_5g.match( /[^\x20-\x7E]/ ))
      {
        alert(window.top.mlang["SWSE02"]);
        $('[name=5GSsid]').focus();
        return false;
      }
/*
      if (ssid_5g1 == "")
      {
        alert(window.top.mlang["SWSE07"]);
        return false;
      }
      
      if (ssid_5g1.match( /[^\x20-\x7E]/ ))
      {
        alert(window.top.mlang["SWSE02"]);
        $('#5G1Ssid').focus();
        return false;
      }
*/      
        //Main & Guest SSIDs can NOT be set to the same name
        if ($('[name=2GSsid]').val() == $('[name=2GMainSsid]').val() ||
            $('[name=2GSsid]').val() == $('[name=5GMainSsid]').val() ||
            $('[name=5GSsid]').val() == $('[name=2GMainSsid]').val() ||
            $('[name=5GSsid]').val() == $('[name=5GMainSsid]').val()) {
            //"The SSID is duplicate, please change to another one."
            alert(window.top.mlang["SGNW02"]);
            return false;
        }
      
        if (checkSecurityType($('[name=2GEnableGuest]').val(),
                              $('[name=5GEnableGuest]').val(),
                              true) == false)
        {
            return false;
        }
        
      return true;
    }
    
    function post_fillout_init() 
    {
        $("[name=2GSsid]").val(decodeHtml($("[name=2GSsid]").val()));
        $("[name=5GSsid]").val(decodeHtml($("[name=5GSsid]").val()));
		
        /* Disable 5G high band input elements */
        $('#target #5g_hi_guest :input').attr('disabled', true);
        
        /* Init "Security Options" radio elements */
        init_2gSecurityType();
        init_5gSecurityType();
        //init_5g1SecurityType();
        changeSecurityHint();
        
        /* register a onclick function for 2GSecurity radio element */
        $('#target [name=2GSecurity]').on('click', function() {
            init_2gSecurityType();
            changeSecurityHint();
        });

        // register a onclick function for 5GSecurity radio element
        $('#target [name=5GSecurity]').on('click', function() {
            init_5gSecurityType();
            changeSecurityHint();
        });
/*
        // register a onclick function for 5G1Security radio element
        $('#target [name=5G1Security]').on('click', function() {
            init_5g1SecurityType();
        });
*/        
        /* sync checkbox value */
        $('#target [name=2GEnableGuest]').on('change', function() {
            $('[name=2GEnableGuest]').val($('[name=2GEnableGuest]').prop("checked"));
        });
        $('#target [name=2GSsidBroadcast]').on('change', function() {
            $('[name=2GSsidBroadcast]').val($('[name=2GSsidBroadcast]').prop("checked"));
        });
        $('#target [name=2GAllowAccessLocal]').on('change', function() {
            $('[name=2GAllowAccessLocal]').val($('[name=2GAllowAccessLocal]').prop("checked"));
        });

        $('#target [name=5GEnableGuest]').on('change', function() {
            $('[name=5GEnableGuest]').val($('[name=5GEnableGuest]').prop("checked"));
        });
        $('#target [name=5GSsidBroadcast]').on('change', function() {
            $('[name=5GSsidBroadcast]').val($('[name=5GSsidBroadcast]').prop("checked"));
        });
        $('#target [name=5GAllowAccessLocal]').on('change', function() {
            $('[name=5GAllowAccessLocal]').val($('[name=5GAllowAccessLocal]').prop("checked"));
        });
/*
        $('#target [name=5G1EnableGuest]').on('change', function() {
            $('#5G1EnableGuest').val($('#5G1EnableGuest').prop("checked"));
        });
        $('#target [name=5G1SsidBroadcast]').on('change', function() {
            $('#5G1SsidBroadcast').val($('#5G1SsidBroadcast').prop("checked"));
        });
        $('#target [name=5G1AllowAccessLocal]').on('change', function() {
            $('#5G1AllowAccessLocal').val($('#5G1AllowAccessLocal').prop("checked"));
        });          
*/        
        if(opMode == "ap")
        {
            $(".allow_to_see").css("pointer-events", "none");
            $(".allow_to_see").css("opacity", "0.5");
            $('#allow_access').prop("disabled", true);
            $('#allow_access_an').prop("disabled", true);
        }

        $("[name='apply']").on('click', function() {
            fetchData('target', 'wpsCheck', '', 'afterCheckWps');
        });
    }

    function afterCheckWps()
    {
        if($("[name='wps_status']").val() == "on")
        {
            alert(window.top.mlang["AWCE03"]);
            return false;
        }
        else
        {
            formSubmit();
        }
    }

    function init_2gSecurityType()
    {
        var security_2g = $("input[name='2GSecurity']:checked").val();
        
        /* WPA2-PSK, WPA-PSK+WPA2-PSK, WPA3-PSK, WPA2+WPA3 show passphrase field */
        if (security_2g == "2" || security_2g == "3" || security_2g == "5" || security_2g == "6")
        {
            $('#wpa_2G_guest')[0].style.display="block";
        }
        else
        {
            $('#wpa_2G_guest')[0].style.display="none";
        }
    }

    function init_5gSecurityType()
    {
        var security_5g = $("input[name='5GSecurity']:checked").val();
        
        // WPA2-PSK, WPA-PSK+WPA2-PSK, WPA3-PSK, WPA2+WPA3 show passphrase field
        if (security_5g == "2" || security_5g == "3" || security_5g == "5" || security_5g == "6")
        {
            $('#wpa_5G_guest')[0].style.display="block";
        }
        else
        {
            $('#wpa_5G_guest')[0].style.display="none";
        }  
    }
/*    
    function init_5g1SecurityType()
    {
        var security_5g1 = $("input[name='5G1Security']:checked").val();
        
        // WPA2-PSK, WPA-PSK+WPA2-PSK, WPA3-PSK, WPA2+WPA3 show passphrase field
        if (security_5g1 == "2" || security_5g1 == "3" || security_5g1 == "5" || security_5g1 == "6")
        {
            $('#wpa_5G_hi_guest')[0].style.display="block";
        }
        else
        {
            $('#wpa_5G_hi_guest')[0].style.display="none";
        }  
    }
*/    
    function onClick_pwdEye(passwdId, eyeSlashName, eyeName)
    {
        var type = document.getElementById(passwdId).type;
        
        if (type == "password") {
            document.getElementById(passwdId).type = "text";
            $('[name='+eyeSlashName+']')[0].style.display = "none";
            $('[name='+eyeName+']')[0].style.display = "";
        }
        else if (type == "text") {
            document.getElementById(passwdId).type = "password";
            $('[name='+eyeSlashName+']')[0].style.display = "";
            $('[name='+eyeName+']')[0].style.display = "none";
        }
    }
    
  </script>
  <link href="css/custom.css" rel="stylesheet" type="text/css">
</head>

<? bodyBegin('wirelessGuest', 'WLG_wireless_guest', 'SGN004', 'Guest Network Settings', 'pre_fillout_init', 'post_fillout_init') ?>
  <div id="main" class="form-group" style="overflow:auto;scrolling:auto">

    <div id="2g_guest">
      <div class="form-row">
        <a href="javascript:loadhelp('WLG_wireless_guest','wireless')" tabindex="-1"><b mlang="SWS038" >Wireless Network</b> (2.4 GHz b/g/n/ax)</a>
      </div>

      <div class="form-row">
        <label class="checkbox-container">
          <span mlang="SGN002" >Enable Guest Network</span>
          <input type="checkbox" name="2GEnableGuest" id="enable_bssid" value="true">
          <span class="checkbox-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">
          <span mlang="SGN003" >Enable SSID Broadcast</span>
          <input type="checkbox" name="2GSsidBroadcast" id="enable_ssid_bc" value="true">
          <span class="checkbox-checkmark"></span>
        </label>
      </div>

      <div class="form-row allow_to_see">
        <label class="checkbox-container">
          <span mlang="SGN014" >Allow guests to see each other and access my local network</span>
          <input type="checkbox" name="2GAllowAccessLocal" id="allow_access" value="true">
          <span class="checkbox-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <b mlang="SGN005" >Guest Wireless Network Name (SSID):</b>
      </div>

      <div class="form-row">
        <input type="text" name="2GSsid" class="input1" id="ssid" size="20" maxlength="32" value="">
      </div>

      <div class="divider">&nbsp;</div>

      <div class="form-row">
        <a href="javascript:loadhelp('WLG_wireless_guest','security')" tabindex="-1"><b mlang="SWS036" >Security Options</b></a>
      </div>

      <div class="form-row">
        <label class="checkbox-container" ><div mlang="SWS016">None</div>
          <input type="radio" name="2GSecurity" id="security_disable" value="1">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA2-PSK [AES]
          <input type="radio" name="2GSecurity" id="security_wpa2" value="2">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA-PSK [TKIP] + WPA2-PSK [AES]
          <input type="radio" name="2GSecurity" id="security_auto" value="3">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA3-PSK
          <input type="radio" name="2GSecurity" id="security_wpa3" value="5">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA2 + WPA3
          <input type="radio" name="2GSecurity" id="security_auto_wpa3" value="6">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div id="wpa_2G_guest" style="display: none;">
        <div class="form-row">
          <b mlang="SWS034">Password (Network Key):</b>
        </div>

        <div class="form-row">
          <input type="password" class="input1" name="2GPassword" id="passphrase" size="128" maxLength="128" value="">
          <img src="images/pwdEyeSlash.png" name="2GpwdEyeSlash" id="pwd_display" style="width:20px; cursor:pointer;" onclick="onClick_pwdEye('passphrase','2GpwdEyeSlash', '2GpwdEye');">
          <img src="images/pwdEye.png" name="2GpwdEye" id="pwd_display" style="width:20px; cursor:pointer; display:none;" onclick="onClick_pwdEye('passphrase','2GpwdEyeSlash', '2GpwdEye');">
          <span mlang="SGN012" id="2GpwdHint">(8-63 characters or 64 hex digits)</span>
        </div>
      </div>

    </div> <!-- 2g_guest section end -->

    <div class="divider">&nbsp;</div>

    <!-- 5g_guest section -->
    <div id="5g_guest">
      <div class="form-row">
        <a href="javascript:loadhelp('WLG_wireless_guest','wireless')" tabindex="-1"><b mlang="SWS038" >Wireless Network</b> (5GHz a/n/ac/ax)</a>
      </div>

      <div class="form-row">
        <label class="checkbox-container">
          <span mlang="SGN002" >Enable Guest Network</span>
          <input type="checkbox" name="5GEnableGuest" id="enable_bssid_an" value="true">
          <span class="checkbox-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">
          <span mlang="SGN003" >Enable SSID Broadcast</span>
          <input type="checkbox" name="5GSsidBroadcast" id="enable_ssid_bc_an" value="true">
          <span class="checkbox-checkmark"></span>
        </label>
      </div>

      <div class="form-row allow_to_see">
        <label class="checkbox-container">
          <span mlang="SGN014" >Allow guests to see each other and access my local network</span>
          <input type="checkbox" name="5GAllowAccessLocal" id="allow_access_an" value="true">
          <span class="checkbox-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <b mlang="SGN005" >Guest Wireless Network Name (SSID):</b>
      </div>

      <div class="form-row">
        <input type="text" name="5GSsid" class="input1" id="ssid_an" size="20" maxlength="32" value="">
      </div>

      <div class="divider">&nbsp;</div>

      <div class="form-row">
        <a href="javascript:loadhelp('WLG_wireless_guest','security')" tabindex="-1"><b mlang="SWS036" >Security Options</b></a>
      </div>

      <div class="form-row">
        <label class="checkbox-container" ><div mlang="SWS016">None</div>
          <input type="radio" name="5GSecurity" id="security_an_disable" value="1">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA2-PSK [AES]
          <input type="radio" name="5GSecurity" id="security_an_wpa2" value="2">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA-PSK [TKIP] + WPA2-PSK [AES]
          <input type="radio" name="5GSecurity" id="security_an_auto" value="3">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA3-PSK
          <input type="radio" name="5GSecurity" id="security_an_wpa3" value="5">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA2 + WPA3
          <input type="radio" name="5GSecurity" id="security_an_auto_wpa3" value="6">
          <span class="radio-checkmark"></span>
        </label>
      </div>
      <div id="wpa_5G_guest" style="display: none;">
        <div class="form-row">
          <b mlang="SWS034">Password (Network Key):</b>
        </div>

        <div class="form-row">
          <input type="password" class="input1" name="5GPassword" id="passphrase_an" size="128" maxLength="128" value="">
          <img src="images/pwdEyeSlash.png" name="5GpwdEyeSlash" id="pwd_an_display" style="width:20px; cursor:pointer;" onclick="onClick_pwdEye('passphrase_an','5GpwdEyeSlash', '5GpwdEye');">
          <img src="images/pwdEye.png" name="5GpwdEye" id="pwd_an_display" style="width:20px; cursor:pointer; display:none;" onclick="onClick_pwdEye('passphrase_an','5GpwdEyeSlash', '5GpwdEye');">
          <span mlang="SGN012" id="5GpwdHint">(8-63 characters or 64 hex digits)</span>
        </div>
      </div>
    </div> <!-- 5g_guest section end -->


    <!-- 5g_hi_guest section -->
    <div id="5g_hi_guest" style="display:none;">
      <div class="form-row">
        <a href="javascript:loadhelp('WLG_wireless_guest','wireless')" tabindex="-1"><b mlang="SWS038" >Wireless Network</b> (5GHz-High a/n/ac/ax)</a>
      </div>

      <div class="form-row">
        <label class="checkbox-container">
          <span mlang="SGN002" >Enable Guest Network</span>
          <input type="checkbox" name="5G1EnableGuest" id="5G1EnableGuest" value="true">
          <span class="checkbox-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">
          <span mlang="SGN003" >Enable SSID Broadcast</span>
          <input type="checkbox" name="5G1SsidBroadcast" id="5G1SsidBroadcast" value="true">
          <span class="checkbox-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">
          <span mlang="SGN014" >Allow guests to see each other and access my local network</span>
          <input type="checkbox" name="5G1AllowAccessLocal" id="5G1AllowAccessLocal" value="true">
          <span class="checkbox-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <b mlang="SGN005" >Guest Wireless Network Name (SSID):</b>
      </div>

      <div class="form-row">
        <input type="text" name="5G1Ssid" class="input1" id="5G1Ssid" size="20" maxlength="32" value="">
      </div>

      <div class="divider">&nbsp;</div>

      <div class="form-row">
        <a href="javascript:loadhelp('WLG_wireless_guest','security')" tabindex="-1"><b mlang="SWS036" >Security Options</b></a>
      </div>

      <div class="form-row">
        <label class="checkbox-container" ><div mlang="SWS016">None</div>
          <input type="radio" name="5G1Security" id="5G1SecurityNone" value="1">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA2-PSK [AES]
          <input type="radio" name="5G1Security" id="5G1SecurityWpa2Psk" value="2">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA-PSK [TKIP] + WPA2-PSK [AES]
          <input type="radio" name="5G1Security" id="5G1SecurityWpaPsk" value="3">
          <span class="radio-checkmark"></span>
        </label>
      </div>

      <div class="form-row">
        <label class="checkbox-container">WPA3-PSK
          <input type="radio" name="5G1Security" id="5G1SecurityWpa3Psk" value="5">
          <span class="radio-checkmark"></span>
        </label>
      </div>
      <div id="wpa_5G_hi_guest" style="display: none;">
        <div class="form-row">
          <b mlang="SWS034">Password (Network Key):</b>
        </div>

        <div class="form-row">
          <input type="text" class="input1" name="5G1Password" id="5G1Password" size="63" maxLength="64" value="" mlang="SGN012">(8-63 characters or 64 hex digits)
        </div>
      </div>
    </div> <!-- 5g_hi_guest section end -->
  </div> <!-- form-group end -->
    <input type="hidden" name="2GMainSsid" disabled>
    <input type="hidden" name="5GMainSsid" disabled>
    <input type="hidden" name="wps_status" disabled>

  <div class="form-btn-row" id="form_btn_div">
    <button type="button" value="BUTTON" onClick="location.href='WLG_wireless_guest.html';" name="Cancel" id="cancel" class="button-cancel cancel_bt" mlang="UAS021">Cancel</button>
    <button type="button" value="apply" name="apply" id="apply" class="button-apply apply_bt" mlang="LUP004" >Apply</button>
  </div>
  </form>
  <? genHelpSection() ?>
  <? generate_EmbedProgressBar()?>
</html>
