<!DOCTYPE HTML>
<? include 'php/commonCfg.php';?>
<? include_once 'php/apmode.php';?>
<html>
<head>
  <META charset="UTF-8">
  <META http-equiv="Pragma" content="no-cache">
  <META HTTP-equiv="Cache-Control" content="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="Mon, 06 Jan 1990 00:00:01 GMT">

  <title>NETGEAR Router <?= getModelNameStr()?></title>

  <link rel="stylesheet" href="css/table_noh.css">
  <link rel="stylesheet" href="css/scrollbar.css">
  <link rel="stylesheet" href="css/button.css">
  <link rel="stylesheet" href="css/form.css">
  <link rel="stylesheet" href="css/settings.css<? getVer(); ?>">

  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.mousewheel.js"></script>
  <script src="js/jquery.jscrollpane.min.js"></script>
  <script src="js/jquery.inputmask.min.js"></script>
  <script src="js/ipInput.js"></script>
  <script src="js/utils.js<? getVer(); ?>"></script>
  <script src="js/validations.js<? getVer(); ?>"></script>

<!--
  <link rel="stylesheet" href="css/form.css">
  <style TYPE="text/javascript">
    classes.num.all.fontFamily = "Courier";
    classes.num.all.fontSize = "10pt" ;
  </style>
-->

  <script language="javascript" type="text/javascript">
    CSRF_TOKEN = <?= genCsrfTokenFilePhp('tokenNumber')?>;

    var opMode = "<?= getRadioVal_mode() ?>";
    /* pre_fillout_init() callback function replaces the position of ready() function */
    function pre_fillout_init(json)
    {
    }
    
    function formSubmit(btn) {
        var startBlockTime;
        var endBlockTime;
        
        /* sync startBlockTime value */
        startBlockTime = $('#start_hour').val() + ":" + $('#start_minute').val();
        $('#startBlockTime').val(startBlockTime);
        endBlockTime = $('#end_hour').val() + ":" + $('#end_minute').val();
        $('#endBlockTime').val(endBlockTime);
        
        if (validation(document.forms[0])) {
            $.postForm('blockSchedule', $('#target'), 'cgi-bin/rex_cgi');
        }
    }

    function validation(f) { 
    
        if ($('[name=isEveryDay]').val() == "false")
        {
             if ($('[name=isSunday]').val() == "false" &&
                $('[name=isMonday]').val() == "false" &&
                $('[name=isTuesday]').val() == "false" &&
                $('[name=isWednesday]').val() == "false" &&
                $('[name=isThursday]').val() == "false" &&
                $('[name=isFriday]').val() == "false" &&
                $('[name=isSaturday]').val() == "false")
            {
                //"Please check at least one day to block!"
                alert(window.top.mlang["CSEE02"]);
                return false;
            }
        }

        if ($('[name=allDayBlock]').val() == "false") {
            if (isNumStr($('#start_hour').val()) == false ||
                isNumStr($('#start_minute').val()) == false ||
                isNumStr($('#end_hour').val()) == false ||
                isNumStr($('#end_minute').val()) == false)
            {
                //"Invalid time input"
                alert(window.top.mlang["CSEE01"]);
                return false;
            }
        
            if (parseInt($('#start_hour').val()) > 23 ||
                parseInt($('#start_minute').val()) > 59 ||
                parseInt($('#end_hour').val()) > 23 ||
                parseInt($('#end_minute').val()) > 59 )
            {
                alert(window.top.mlang["CSEE01"]);
                return false;
            }
        
            if ($('#start_hour').val().length != 2 ||
                $('#start_minute').val().length != 2 ||
                $('#end_hour').val().length != 2 ||
                $('#end_minute').val().length != 2) {
                alert(window.top.mlang["CSEE01"]);
                return false;
            }
            if ($('#startBlockTime').val() == $('#endBlockTime').val()) {
                alert(window.top.mlang["CSEE01"]);
                return false;
            }
        }
        
        return true;
    }
    
    function isNumStr(str)
    {
        var i;
        if (str.length == 0) {
            return false;
        }
        
        for(i = 0; i < str.length; i++) {
            var c = str.substring(i, i+1);
            if("0" <= c && c <= "9") {
                continue;
            }
            return false;
        }
        
        return true;
    }
    
    function post_fillout_init() 
    {
        /* init elements */
        init_BlockDays_checkbox();
        init_BlockTime_text();
        
        /* register onClick/onChange callback function */

        
        /* sync checkbox value to be same with its check status */
        $('#target [name=isEveryDay]').on('change', function() {
            $('[name=isEveryDay]').val($('[name=isEveryDay]').prop("checked"));
            onChange_isEveryDay();
        });
        $('#target [name=isSunday]').on('change', function() {
            $('[name=isSunday]').val($('[name=isSunday]').prop("checked"));
        });
        $('#target [name=isMonday]').on('change', function() {
            $('[name=isMonday]').val($('[name=isMonday]').prop("checked"));
        });
        $('#target [name=isTuesday]').on('change', function() {
            $('[name=isTuesday]').val($('[name=isTuesday]').prop("checked"));
        });
        $('#target [name=isWednesday]').on('change', function() {
            $('[name=isWednesday]').val($('[name=isWednesday]').prop("checked"));
        });
        $('#target [name=isThursday]').on('change', function() {
            $('[name=isThursday]').val($('[name=isThursday]').prop("checked"));
        });
        $('#target [name=isFriday]').on('change', function() {
            $('[name=isFriday]').val($('[name=isFriday]').prop("checked"));
        });
        $('#target [name=isSaturday]').on('change', function() {
            $('[name=isSaturday]').val($('[name=isSaturday]').prop("checked"));
        });        
        $('#target [name=allDayBlock]').on('change', function() {
            $('[name=allDayBlock]').val($('[name=allDayBlock]').prop("checked"));
            onChange_allDayBlock();
        });
        
        if(opMode == "ap")
        {
            $(".everydays").css("pointer-events", "none");
            $(".everydays").css("opacity", "0.5");
            $(".allday").css("pointer-events", "none");
            $(".allday").css("opacity", "0.5");
        }
    }

    function init_BlockDays_checkbox()
    {
        if ($('[name=isEveryDay]').val() == "true") {
            greyout_weekdays_checkbox(true);
        }
        else {
            greyout_weekdays_checkbox(false);
        }
    }
    
    function init_BlockTime_text()
    {
        var startTime = $('#target [name=startBlockTime]').val().split(":");
        var endTime = $('#target [name=endBlockTime]').val().split(":");
        
        /* fillout blocktime text elements */
        $('#start_hour').val(startTime[0]);
        $('#start_minute').val(startTime[1]);
        $('#end_hour').val(endTime[0]);
        $('#end_minute').val(endTime[1]);

        /* greyout blocktime text elements */
        if ( $('[name=allDayBlock]').val() == "true") {
            greyout_blocktime_text(true);
        }
        else {
            greyout_blocktime_text(false);
        }
    }
    
    function init_NtpServer_text()
    {
        if ( $('#preferNtpServer').val() == "true") {
            $('#ntpServer').attr('readonly', false);
        }
        else {
            $('#ntpServer').attr('readonly', true);
        }
    }
    
    function init_currentTime_span()
    {
        /* ori_fmt_date = 2020-06-17T01:59:23-04:00 */
        var ori_fmt_date = $('#target span[name=currentTime]').text();
        /* tmp_fmt_date = Wed Jun 17 2020 13:59:23 GMT+0800 */
        var tmp_fmt_date = new Date(ori_fmt_date);
        
        var date_array = tmp_fmt_date.toString().split(" ");
        
        var year = date_array[3];
        var month_num = tmp_fmt_date.getMonth();
        var month = month_Num2Str_mlang(month_num);
        var week_num = tmp_fmt_date.getDay();
        var week = week_Num2Str_mlang(week_num);
        var day = date_array[2];
        var time = date_array[4];
        
        /* new_fmt_date = Wednesday, 1 Jul 2020 13:59:23 */
        var new_fmt_date = week + ", " + day + " " + month + " " + year + " " + time;

        $('#target span[name=currentTime]').text(new_fmt_date);
    }
    
    function month_Num2Str_mlang(num)
    {
      /* 0 = Jan, 1 = Feb, ... */
      var month_map = {0 : "CSE017", 1 : "CSE018", 2 : "CSE019", 
                       3 : "CSE020", 4 : "CSE021", 5 : "CSE022",
                       6 : "CSE023", 7 : "CSE024", 8 : "CSE025",
                       9 : "CSE026", 10 : "CSE027", 11 : "CSE028"};
      var month = window.top.mlang[month_map[num]];
      return month;
    }
    
    function week_Num2Str_mlang(num)
    {
        /* 0 = Sunday, 1 = Monday, 2 = Tuesday, ... */
        var week_map = {0 : "CSE012", 1 : "CSE009", 2 : "CSE015",
                        3 : "CSE016", 4 : "CSE013", 5 : "CSE006", 6 : "CSE010"};
        var week = window.top.mlang[week_map[num]];
        return week;
    }
    
    function onChange_isEveryDay()
    {
        if ($('[name=isEveryDay]').val() == "true") {
            greyout_weekdays_checkbox(true);
        }
        else {
            greyout_weekdays_checkbox(false);
        }
    }
    

    function onChange_allDayBlock()
    {
        /* greyout blocktime text elements */
        if ( $('[name=allDayBlock]').val() == "true") {
            greyout_blocktime_text(true);
        }
        else {
            greyout_blocktime_text(false);
        }        
    }
    
    function onChange_preferNtpServer()
    {
        if ( $('#preferNtpServer').val() == "true") {
            $('#ntpServer').attr('readonly', false);
        }
        else {
            $('#ntpServer').attr('readonly', true);
        }    
    }
    
    
    function greyout_weekdays_checkbox(val)
    {
        if (val == true)
        {
            $(".weekdays").css("pointer-events", "none");
            $(".weekdays").css("opacity", "0.5");
        }
        else
        {
            $(".weekdays").css("pointer-events", "");
            $(".weekdays").css("opacity", "");
        }
    }
    
    function greyout_blocktime_text(val)
    {
        $('#start_hour').attr('readonly', val);
        $('#start_minute').attr('readonly', val);
        $('#end_hour').attr('readonly', val);
        $('#end_minute').attr('readonly', val);
    }
    


    
  </script>
  <link href="css/custom.css" rel="stylesheet" type="text/css">
</head>

<? bodyBegin('blocksiteSchedule', 'BKS_schedule', 'LUP019', 'Schedule', 'pre_fillout_init', 'post_fillout_init') ?>
  <div id="main" class="form-group" style="overflow:auto;scrolling:auto">

    <div class="form-row">
      <a href="javascript:loadhelp('BKS_schedule','blocksch')" tabindex="-1"><b mlang="CSE003" >Days to Block</b></a>
    </div>

    <div class="form-row everydays">
      <label class="checkbox-container">
        <span mlang="CSE005" >Every Day</span>
        <input type="checkbox" name="isEveryDay" id="everyday" value="true">
        <span class="checkbox-checkmark"></span>
      </label>
    </div>

    <div class="form-row weekdays">
      <label class="checkbox-container">
        <span mlang="CSE012" >Sunday</span>
        <input type="checkbox" name="isSunday" id="sun" value="true">
        <span class="checkbox-checkmark"></span>
      </label>
    </div>

    <div class="form-row weekdays">
      <label class="checkbox-container">
        <span mlang="CSE009" >Monday</span>
        <input type="checkbox" name="isMonday" id="mon" value="true">
        <span class="checkbox-checkmark"></span>
      </label>
    </div>

    <div class="form-row weekdays">
      <label class="checkbox-container">
        <span mlang="CSE015" >Tuesday</span>
        <input type="checkbox" name="isTuesday" id="tue" value="true">
        <span class="checkbox-checkmark"></span>
      </label>
    </div>

    <div class="form-row weekdays">
      <label class="checkbox-container">
        <span mlang="CSE016" >Wednesday</span>
        <input type="checkbox" name="isWednesday" id="wed" value="true">
        <span class="checkbox-checkmark"></span>
      </label>
    </div>

    <div class="form-row weekdays">
      <label class="checkbox-container">
        <span mlang="CSE013" >Thursday</span>
        <input type="checkbox" name="isThursday" id="thu" value="true">
        <span class="checkbox-checkmark"></span>
      </label>
    </div>

    <div class="form-row weekdays">
      <label class="checkbox-container">
        <span mlang="CSE006" >Friday</span>
        <input type="checkbox" name="isFriday" id="fri" value="true">
        <span class="checkbox-checkmark"></span>
      </label>
    </div>

    <div class="form-row weekdays">
      <label class="checkbox-container">
        <span mlang="CSE010" >Saturday</span>
        <input type="checkbox" name="isSaturday" id="sat" value="true">
        <span class="checkbox-checkmark"></span>
      </label>
    </div>

    <div class="space-divider">&nbsp;</div>

    <div class="form-row">
      <a href="javascript:loadhelp('BKS_schedule','blocksch')" tabindex="-1"><b mlang="CSE014">Time of day to block:</b><b mlang="CSE001">(use 24-hour clock)</b></a>
    </div>

    <div class="form-row allday">
      <label class="checkbox-container">
        <span mlang="CSE002" >All Day</span>
        <input type="checkbox" name="allDayBlock" id="all_day" value="true">
        <span class="checkbox-checkmark"></span>
      </label>
    </div>
    
    <div class="form-row">
      <b mlang="CSE011" >Start Blocking</b>
    </div>

    <div class="form-row">
      <input type="text" class="num s_input s_input2" id="start_hour" size="3" maxlength="2">
      <span mlang="CSE007">Hour</span>
      <input type="text" class="num s_input s_input2" id="start_minute" size="3" maxlength="2">
      <span mlang="CSE008">Minute</span>
      <input type="hidden" id="startBlockTime" name="startBlockTime" value="">
    </div>

    <div class="form-row">
      <b mlang="CSE004" >End Blocking</b>
    </div>

    <div class="form-row">
      <input type="text" class="num s_input s_input2" id="end_hour" size="3" maxlength="2">
      <span mlang="CSE007">Hour</span>
      <input type="text" class="num s_input s_input2" id="end_minute" size="3" maxlength="2">
      <span mlang="CSE008">Minute</span>
      <input type="hidden" id="endBlockTime" name="endBlockTime" value="">
    </div>
    
    <div class="space-divider">&nbsp;</div>
    

  </div> <!-- form-group end -->
<? bodyEnd(false, 'BKS_schedule.html') ?>
</html>
