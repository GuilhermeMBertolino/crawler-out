<!DOCTYPE HTML>
<? include 'php/commonCfg.php';?>

<html>
<head>
  <META charset="UTF-8">
  <META http-equiv="Pragma" content="no-cache">
  <META HTTP-equiv="Cache-Control" content="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="Mon, 06 Jan 1990 00:00:01 GMT">
  
  <title>NETGEAR Router <?= getModelNameStr()?></title>



  <script src="js/jquery.min.js"></script>
  <script src="js/jquery.jscrollpane.min.js"></script>
  <script src="js/jquery.mousewheel.js"></script>
  <script src="js/utils.js<? getVer(); ?>"></script>


  <link rel="stylesheet" href="css/table_noh.css">
  <link rel="stylesheet" href="css/button.css">
  <link rel="stylesheet" href="css/settings.css<? getVer(); ?>">
  <link rel="stylesheet" href="css/scrollbar.css">
  <link rel="stylesheet" href="css/form.css">
  <link rel="stylesheet" href="css/custom.css"  type="text/css">

  <script language="javascript" type="text/javascript">
  CSRF_TOKEN_SUB = <?= genCsrfTokenSubFilePhp('tokenNumber')?>;

  var interval = 2;
  var intervalId;

  $(document).ready(function() {
       getStatusTable();

      $("button[name='release']").on("click", function(){
          showPleaseWaitWindow();
          postProtocolAction("wanDhcp","release");
          setTimeout('showWanStat()', 5 * 1000);
      });
           
      $("button[name='renew']").on("click", function(){
          showPleaseWaitWindow();
          postProtocolAction("wanDhcp","renew");
          setTimeout('showWanStat()', 5 * 1000);
       });
      
      $("button[name='disconnect']").on("click", function(){
           $("[mlang='establish_conn']").text(window.opener.top.mlang[$("[mlang='establish_conn']").attr("mlang")]);
           showEstablishConnWindow();
          postProtocolAction("wanPPPConn","disconnect");
          setTimeout('showWanStat()', 20 * 1000);
      });
      
      $("button[name='connect']").on("click", function(){
          showPleaseWaitWindow();
          postProtocolAction("wanPPPConn","connect");
          setTimeout('showWanStat()', 20 * 1000);
       });

       $("button[name='close']").on("click", function(){
           sessionStorage.removeItem("wanType");
           self.close();
       });
  });

  function showPleaseWaitWindow()
  {
      document.getElementById("wait_page").style.display="";
      document.getElementById("topHalf").style.display="none";
  }

  function showEstablishConnWindow()
  {
      document.getElementById("establish_conn_page").style.display="";
      document.getElementById("topHalf").style.display="none";
  }

  function showWanStat()
  {
      document.getElementById("wait_page").style.display="none";
      document.getElementById("establish_conn_page").style.display="none";
      document.getElementById("topHalf").style.display="";
  }
  
  function getStatusTable()
  {
      clearInterval(intervalId);
      var wanType = sessionStorage.getItem("wanType");
      if(wanType == "ap")
      {
          fetchData('target', 'apstat', '', 'postFillOutAp');
      }
      else if(wanType == "DHCP")
      {
          fetchData('target', 'dhcpstat', '', 'postFillOutDhcp');
      }    
      else if(wanType == "PPPoE")
      {
          fetchData('target', 'pppoestat', '', 'postFillOutPppoe');
      }
      else if(wanType == "PPTP")
      {
          fetchData('target', 'pptpstat', '', 'postFillOutPptp');
      }
      else if(wanType == "L2TP")
      {
          fetchData('target', 'l2tpstat', '', 'postFillOutL2tp');
      }
      else if(wanType == "Static")
      {
          fetchData('target', 'staticstat');
      }
      else
      {
          fetchData('target', 'dhcpstat', '', 'postFillOutDhcp');
      }
      $("#"+wanType+"_table").show();
      intervalId = setInterval("getStatusTable()", interval * 1000);
  }

  function postFillOutAp()
  {
      if ($("#ap_table [name='ipAddr']").html() == "")
      {
          $("#ap_table [name='ipAddr']").html("0.0.0.0");
      }

      if ($("#ap_table [name='subnetMask']").html() == "")
      {
          $("#ap_table [name='subnetMask']").html("0.0.0.0");
      }

      if ($("#ap_table [name='defaultGateway']").html() == "")
      {
          $("#ap_table [name='defaultGateway']").html("0.0.0.0");
      }

      if ($("#ap_table [name='dhcpServer']").html() == "")
      {
          $("#ap_table [name='dhcpServer']").html("0.0.0.0");
      }

      if ($("#ap_table [name='dnsPrimary']").html() == "")
      {
          $("#ap_table [name='dnsPrimary']").html("0.0.0.0");
      }

      // Re-format the content if no lease
      if ($("#ap_table [name='leaseObtainedDays']").html() == "--")
      {
          $("#ap_table [name='leaseObtainedNormal']").hide();
          $("#ap_table [name='leaseObtainedFail']").show();
      }
      else
      {
          $("#ap_table [name='leaseObtainedNormal']").show();
          $("#ap_table [name='leaseObtainedFail']").hide();
      }

      if ($("#ap_table [name='leaseExpiredDays']").html() == "--")
      {
          $("#ap_table [name='leaseExpiredNormal']").hide();
          $("#ap_table [name='leaseExpiredFail']").show();
      }
      else
      {
          $("#ap_table [name='leaseExpiredNormal']").show();
          $("#ap_table [name='leaseExpiredFail']").hide();
      }
  }

  function postFillOutDhcp()
  {
      if ($("#DHCP_table [name='ipAddr']").html() == "")
      {
          $("#DHCP_table [name='ipAddr']").html("0.0.0.0");
      }

      if ($("#DHCP_table [name='subnetMask']").html() == "")
      {
          $("#DHCP_table [name='subnetMask']").html("0.0.0.0");
      }

      if ($("#DHCP_table [name='defaultGateway']").html() == "")
      {
          $("#DHCP_table [name='defaultGateway']").html("0.0.0.0");
      }

      if ($("#DHCP_table [name='dhcpServer']").html() == "")
      {
          $("#DHCP_table [name='dhcpServer']").html("0.0.0.0");
      }

      if ($("#DHCP_table [name='dnsPrimary']").html() == "")
      {
          $("#DHCP_table [name='dnsPrimary']").html("0.0.0.0");
      }

      // Re-format the content if no lease
      if ($("#DHCP_table [name='leaseObtainedDays']").html() == "--")
      {
          $("#DHCP_table [name='leaseObtainedNormal']").hide();
          $("#DHCP_table [name='leaseObtainedFail']").show();
      }
      else
      {
          $("#DHCP_table [name='leaseObtainedNormal']").show();
          $("#DHCP_table [name='leaseObtainedFail']").hide();
      }

      if ($("#DHCP_table [name='leaseExpiredDays']").html() == "--")
      {
          $("#DHCP_table [name='leaseExpiredNormal']").hide();
          $("#DHCP_table [name='leaseExpiredFail']").show();
      }
      else
      {
          $("#DHCP_table [name='leaseExpiredNormal']").show();
          $("#DHCP_table [name='leaseExpiredFail']").hide();
      }
  }

  function postFillOutPppoe()
  {
     $("#ppp_connect [mlang]").each(function(idx, obj) {
            obj.innerHTML = window.opener.top.mlang[obj.attributes.mlang.value];    
     });

      if ($("#PPPoE_table [name='ipAddr']").html() == "")
      {
          $("#PPPoE_table [name='ipAddr']").html("0.0.0.0");
      }

      if ($("#PPPoE_table [name='subnetMask']").html() == "")
      {
          $("#PPPoE_table [name='subnetMask']").html("0.0.0.0");
      }
  }

  function postFillOutPptp()
  {
     $("#pptp_connect [mlang]").each(function(idx, obj) {
            obj.innerHTML = window.opener.top.mlang[obj.attributes.mlang.value];    
     });

      if ($("#PPTP_table [name='ipAddr']").html() == "")
      {
          $("#PPTP_table [name='ipAddr']").html("0.0.0.0");
      }

      if ($("#PPTP_table [name='subnetMask']").html() == "")
      {
          $("#PPTP_table [name='subnetMask']").html("0.0.0.0");
      }
  }

  function postFillOutL2tp()
  {
     $("#l2tp_connect [mlang]").each(function(idx, obj) {
            obj.innerHTML = window.opener.top.mlang[obj.attributes.mlang.value];    
     });

      if ($("#L2TP_table [name='ipAddr']").html() == "")
      {
          $("#L2TP_table [name='ipAddr']").html("0.0.0.0");
      }

      if ($("#L2TP_table [name='subnetMask']").html() == "")
      {
          $("#L2TP_table [name='subnetMask']").html("0.0.0.0");
      }
  }

  function initLoad()
  {
      $("[mlang]").each(function(idx, obj) {
          obj.innerHTML = window.opener.top.mlang[obj.attributes.mlang.value];    
      });
  }
  
  function postProtocolAction(func,actionStr)
  {
      var postData = {};
      postData.function = func;
      var o = {};
      o["action"] = actionStr;
      postData.data = o;
      //console.log(postData);
      dataPost(JSON.stringify(postData));
  }

  function dataPost(postData)
  {
      $.ajax({
        url: "/cgi-bin/rex_cgi?csrftoken_sub=" + CSRF_TOKEN_SUB,
        type: "POST",
        data: postData,
        dataType: 'json',
        contentType: "application/json; charset=utf-8",
        success : function(data) {
            if(data.status == "error")
            {   
                console.log("Response: error");
            }
        },
        error : function(xhr, ajaxOptions, thrownError) {
            console.log(xhr.status);
            console.log(thrownError);
        },
        beforeSend : function(json) {
            //setTimeout("redirectProgressBar('D-genie_377')", 100);
        }
      }); //ajax()
  }
  </script>
</head>


<body onload="initLoad()" style="margin:0px;">
<form id="target">
<div class="topHalf" id="topHalf" style="display:block;">
  <div class="page-header" style="position: relative;" mlang="MRS006">Connection Status</div>

  <div id="ap_table" class="form-row pl28" style="display:none;"><!--ap table form-row-->
    <table border="1" cellpadding="0" cellspacing="0" width="98%" class="cmn-table-2 tbWhite" id="dhcp_connect">
      <tr>
        <td NOWRAP width="50%"><b mlang="SWP030">IP Address</b></td>
        <td NOWRAP width="50%"><span name="ipAddr"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS016">Subnet Mask</b></td>
        <td NOWRAP width="50%"><span name="subnetMask"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS045">Default Gateway</b></td>
        <td NOWRAP width="50%"><span name="defaultGateway"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS003">DHCP Server</b></td>
        <td NOWRAP width="50%"><span name="dhcpServer"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS004">DNS Server</b></td>
        <td NOWRAP width="50%"><span name="dnsPrimary"></span><br><span name="dnsSlave"></span></td>
      </tr>
      <tr name="leaseObtainedNormal">
        <td NOWRAP width="50%"><b mlang="MRS007">Lease Obtained</b></td>
        <td NOWRAP width="50%"><span name="leaseObtainedDays"></span>&nbsp;<span></span><span mlang="ATM005">Days</span><span>,&nbsp;</span><span name="leaseObtainedHours"></span><span>&nbsp;</span><span mlang="MRS064">Hours</span><span>,&nbsp;</span><span name="leaseObtainedMinutes"></span><span>&nbsp;</span><span mlang="MRS065">Minutes</span></td>
      </tr>
      <tr style="display:none">
        <td NOWRAP width="50%"></td>
        <td NOWRAP width="50%"></td>
      </tr>
      <tr name="leaseObtainedFail" style="display:none">
        <td NOWRAP width="50%"><b mlang="MRS007">Lease Obtained</b></td>
        <td NOWRAP width="50%">----</td>
      </tr>
      <tr name="leaseExpiredNormal">
        <td NOWRAP width="50%"><b mlang="MRS005">Lease Expire</b></td>
        <td NOWRAP width="50%"><span name="leaseExpiredDays"></span><span>&nbsp;</span><span mlang="ATM005">Days</span><span>,&nbsp;</span><span name="leaseExpiredHours"></span><span>&nbsp;</span><span mlang="MRS064">Hours</span><span>,&nbsp;</span><span name="leaseExpiredMinutes"></span><span>&nbsp;</span><span mlang="MRS065">Minutes</span></td>
      </tr>
      <tr style="display:none">
        <td NOWRAP width="50%"></td>
        <td NOWRAP width="50%"></td>
      </tr>
      <tr name="leaseExpiredFail" style="display:none">
        <td NOWRAP width="50%"><b mlang="MRS005">Lease Expire</b></td>
        <td NOWRAP width="50%">----</td>
      </tr>
    </table>

    <div class="form-row pl28 pt-30" align="center">
      <button type="button" value="Release" name="release" id="disconnect" class="button-sty1" mlang="MRS018">Release</button>
      <button type="button" value="Renew" name="renew" id="connect" class="button-sty1" mlang="MRS019">Renew</button>
      <button type="button" value="Close Window" name="close" id="close" class="button-sty1" mlang="WP0006">Close Window</button>
    </div>
  </div><!--ap table form-row-->

  <div id="DHCP_table" class="form-row pl28" style="display:none;"><!--dhcp table form-row-->
    <table border="1" cellpadding="0" cellspacing="0" width="98%" class="cmn-table-2 tbWhite" id="dhcp_connect">
      <tr>
        <td NOWRAP width="50%"><b mlang="SWP030">IP Address</b></td>
        <td NOWRAP width="50%"><span name="ipAddr"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS016">Subnet Mask</b></td>
        <td NOWRAP width="50%"><span name="subnetMask"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS045">Default Gateway</b></td>
        <td NOWRAP width="50%"><span name="defaultGateway"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS003">DHCP Server</b></td>
        <td NOWRAP width="50%"><span name="dhcpServer"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS004">DNS Server</b></td>
        <td NOWRAP width="50%"><span name="dnsPrimary"></span><br><span name="dnsSlave"></span></td>
      </tr>
      <tr name="leaseObtainedNormal">
        <td NOWRAP width="50%"><b mlang="MRS007">Lease Obtained</b></td>
        <td NOWRAP width="50%"><span name="leaseObtainedDays"></span>&nbsp;<span></span><span mlang="ATM005">Days</span><span>,&nbsp;</span><span name="leaseObtainedHours"></span><span>&nbsp;</span><span mlang="MRS064">Hours</span><span>,&nbsp;</span><span name="leaseObtainedMinutes"></span><span>&nbsp;</span><span mlang="MRS065">Minutes</span></td>
      </tr>
      <tr style="display:none">
        <td NOWRAP width="50%"></td>
        <td NOWRAP width="50%"></td>
      </tr>
      <tr name="leaseObtainedFail" style="display:none">
        <td NOWRAP width="50%"><b mlang="MRS007">Lease Obtained</b></td>
        <td NOWRAP width="50%">----</td>
      </tr>
      <tr name="leaseExpiredNormal">
        <td NOWRAP width="50%"><b mlang="MRS005">Lease Expire</b></td>
        <td NOWRAP width="50%"><span name="leaseExpiredDays"></span><span>&nbsp;</span><span mlang="ATM005">Days</span><span>,&nbsp;</span><span name="leaseExpiredHours"></span><span>&nbsp;</span><span mlang="MRS064">Hours</span><span>,&nbsp;</span><span name="leaseExpiredMinutes"></span><span>&nbsp;</span><span mlang="MRS065">Minutes</span></td>
      </tr>
      <tr style="display:none">
        <td NOWRAP width="50%"></td>
        <td NOWRAP width="50%"></td>
      </tr>
      <tr name="leaseExpiredFail" style="display:none">
        <td NOWRAP width="50%"><b mlang="MRS005">Lease Expire</b></td>
        <td NOWRAP width="50%">----</td>
      </tr>
    </table>

    <div class="form-row pl28 pt-30" align="center">
      <button type="button" value="Release" name="release" id="disconnect" class="button-sty1" mlang="MRS018">Release</button>
      <button type="button" value="Renew" name="renew" id="connect" class="button-sty1" mlang="MRS019">Renew</button>
      <button type="button" value="Close Window" name="close" id="close" class="button-sty1" mlang="WP0006">Close Window</button>
    </div>
  </div><!--dhcp table form-row-->
  
  <div id="PPPoE_table" class="form-row pl28" style="display:none;"><!--pppoe table form-row-->
    <table width="99%" border=1 cellspacing=1 cellpadding=4 id="ppp_connect" class="tbWhite cmn-table-2">
      <tr>
        <td NOWRAP width="50%"><b mlang="SBS036"></b></td>
        <td NOWRAP width="50%"><span name="connetionUpTime"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS006"></b></td>
        <td NOWRAP width="50%"><span name="connetionStatus"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="SBS019"></b></td>
        <td NOWRAP width="50%"><span name="negotiation" mlang=""></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="SBS018"></b></td>
        <td NOWRAP width="50%"><span name="authentication" mlang=""></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="SWP030"></b></td>
        <td NOWRAP width="50%"><span name="ipAddr"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS016"></b></td>
        <td NOWRAP width="50%"><span name="subnetMask"></span></td>
      </tr>
    </table>
    <div class="form-row pl28 pt-30" align="center">
      <button type="button" name="disconnect" id="disconnect" class="button-sty1" mlang="MRS009">Disconnect</button>
      <button type="button" name="connect" id="connect" class="button-sty1" mlang="MRS001">Connect</button>
    
    </div>
    <div class="form-row pl28 pt-10" align="center">
    
      <button type="button" value="Close Window" name="close" id="close2" class="button-sty1" mlang="WP0006">Close Window</button>
    </div>
  </div> <!--pppoe table form-row-->
  
  <div id="PPTP_table" class="form-row pl28" style="display:none;"><!--PPTPs table form-row-->
    <table width="99%" border=1 cellspacing=1 cellpadding=4 id="pptp_connect" class="tbWhite cmn-table-2">
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS006"></b></td>
        <td NOWRAP width="50%"><span name="connetionStatus"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="SWP030"></b></td>
        <td NOWRAP width="50%"><span name="ipAddr"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS016"></b></td>
        <td NOWRAP width="50%"><span name="subnetMask"></span></td>
      </tr>
    </table>
    <div class="form-row pl28 pt-30" align="center">
      <button type="button" name="disconnect" id="disconnect" class="button-sty1" mlang="MRS009">Disconnect</button>
      <button type="button" name="connect" id="connect" class="button-sty1" mlang="MRS001">Connect</button>
    
    </div>
    <div class="form-row pl28 pt-10" align="center">
    
      <!--button type="button" value="Close Window" name="close" id="close2" class="button-sty1" mlang="WP0006">Close Window</button-->
    </div>
  </div> <!--PPTP table form-row-->

  <div id="L2TP_table" class="form-row pl28" style="display:none;"><!--PPTPs table form-row-->
    <table width="99%" border=1 cellspacing=1 cellpadding=4 id="l2tp_connect" class="tbWhite cmn-table-2">
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS006"></b></td>
        <td NOWRAP width="50%"><span name="connetionStatus"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="SWP030"></b></td>
        <td NOWRAP width="50%"><span name="ipAddr"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS016"></b></td>
        <td NOWRAP width="50%"><span name="subnetMask"></span></td>
      </tr>
    </table>
    <div class="form-row pl28 pt-30" align="center">
      <button type="button" name="disconnect" id="disconnect" class="button-sty1" mlang="MRS009">Disconnect</button>
      <button type="button" name="connect" id="connect" class="button-sty1" mlang="MRS001">Connect</button>
    
    </div>
    <div class="form-row pl28 pt-10" align="center">
    
      <!--button type="button" value="Close Window" name="close" id="close2" class="button-sty1" mlang="WP0006">Close Window</button-->
    </div>
  </div> <!--L2TP table form-row-->
  
  <div id="Static_table" class="form-row pl28" style="display:none;"><!--static table form-row-->
    <table width="99%" border=1 cellspacing=1 cellpadding=4 id="static_table" class="tbWhite cmn-table-2">
      <tr>
        <td NOWRAP width="50%"><b mlang="SWP030"></b></td>
        <td NOWRAP width="50%"><span name="staticWanIp"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS016"></b></td>
        <td NOWRAP width="50%"><span name="staticMask"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS045"></b></td>
        <td NOWRAP width="50%"><span name="staticGateway"></span></td>
      </tr>
      <tr>
        <td NOWRAP width="50%"><b mlang="MRS004">DNS Server</b></td>
        <td NOWRAP width="50%"><span name="staticDnsPrimary"></span><br><span name="staticDnsSlave"></span></td>
      </tr>

    </table>
    <div class="form-row pl28 pt-10" align="center">
      <button type="button" value="Close Window" name="close" id="close3" class="button-sty1" mlang="WP0006">Close Window</button>
    </div>
  </div> <!--static table form-row--> 
</div>
<div id="wait_page" class="form-group" align="center" style="display:none;">
                    <div class="rowCenter" style="height: 25px;">
                      <p class="" mlang="SWP011">Please wait a moment...</p>
                    </div>
                    <div class="rowCenter" style="height:30px;"></div>
                    <div class="rowCenter">
                      <img id="pls_wait_div" frameborder="0" border="0" src="/images/wait.gif">
                    </div>
</div>
<div id="establish_conn_page" class="form-group" align="center" style="display:none;">
                    <div class="rowCenter" style="height: 25px;">
                      <p class="" mlang="establish_conn">To re-establish the connection, please click the <Connect> button</p>
                    </div>
                    <div class="rowCenter" style="height:30px;"></div>
                    <div class="rowCenter">
                      <img id="pls_wait_div" frameborder="0" border="0" src="/images/wait.gif">
                    </div>
</div>
</form>
</body>




</html>
