var startTime;
var maxchars = 60;
var charcount = 0;
var duration = 90000;
var nextURL = null;

function makeStr(strSize)
{
    var temp = "";
    for (i=0; i < strSize ; i ++)
        temp = temp + "||";
    return temp;
}
  
function loadNextURL()
{
    if( nextURL )
    {
        if(nextURL.match("http://") || nextURL.match("https://"))
        {
            top.window.location.replace(nextURL);
        }
        else
        {
            window.location.replace(nextURL);
        }
    }
    else
    {
        window.top.location.reload();
    }
}
  
function updateProgress()
{
    var delay_time = duration / (maxchars+2);// msecs
    var delta = (new Date()).valueOf() - startTime;
 
    if(delta > duration)
    {
        loadNextURL();
        return ;
    }
 
    if (charcount < maxchars)
    {
        charcount ++;
    }

    $("input[name='progress']").val(makeStr(charcount));
    setTimeout("updateProgress()",delay_time);  
}
  
function show_EmbedProgressBar(barTitle_mlang, i_duration, i_nextURL)
{
    duration = i_duration;
    nextURL = i_nextURL;  
    startTime = (new Date()).valueOf();
    
    //hide the spinning circle icon generated by postForm()
    window.top.finishLoading();
    
    //hide router/ap/bridge mode page elements and show the progress bar embeded in router/ap/bridge mode page
    $(".page-header").hide();
    $("#main").hide();
    $("#form_btn_div").hide();
    $("#form_btn_div1").hide();
    $("#form_btn_div2").hide();
    $(".help-section").hide();
    $("#pgbar-div").show();
    
    //change progress bar title
    $("[name=barTitle]").text(window.top.mlang[barTitle_mlang]);
    
    updateProgress();
}
