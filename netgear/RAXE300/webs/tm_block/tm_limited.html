<!DOCTYPE HTML>
<!-- include PHP to use php functions -->
<? include 'php/commonCfg.php';?>

<html>
<head>
  <META charset="UTF-8">
  <META http-equiv="Pragma" content="no-cache">
  <META HTTP-equiv="Cache-Control" content="no-cache">
  <META HTTP-EQUIV="Expires" CONTENT="Mon, 06 Jan 1990 00:00:01 GMT">

  <title>NETGEAR Router <?= getModelNameStr()?></title>

  <link rel="stylesheet" href="../css/custom.css">

  <script src="../js/jquery.min.js"></script>
  <script src="../js/jquery.mousewheel.js"></script>
  <script src="../js/jquery.jscrollpane.min.js"></script>
  <script src="../js/jquery.inputmask.min.js"></script>
  <script src="../js/ipInput.js"></script>
  <script src="../js/utils.js<? getVer(); ?>"></script>
  <script src="../js/validations.js<? getVer(); ?>"></script>
  <script src="../js/mlang.js"></script>

  <script language="javascript" type="text/javascript">
    CSRF_TOKEN_SUB = <?= genCsrfTokenSubFilePhp('tokenNumber')?>;
    function fetchDataTm(formId, path, preFilloutCallback, postFilloutCallback) {
        path = "/tm_block/php/db/" + path + "_data" + ".php";
        var jqxhr = $.ajax(path)
        .done(function(e) {
            if (preFilloutCallback != undefined && preFilloutCallback != null && preFilloutCallback != "") {
                eval(preFilloutCallback + "(e)");
            }
            fillOutData(formId, e);
        })
        .fail(function(e) {
          //addToast("warning", "<strong>Error:</strong>", 'now',  "<strong>\"" + path + "\"</strong> can't retrieve data");
          //addAlert("danger", "<strong>Error:</strong> \"" + path + "\" can't retrieve data");
          console.log( "ERROR: can't retrieve data" + e );
        })
        .always(function(e) {
            //alert( "complete" + e );
            if (postFilloutCallback != undefined && postFilloutCallback != null && postFilloutCallback != "") {
                eval(postFilloutCallback + "()");
            }
        });
        // Perform other work here ...
    }

    $(document).ready(function()
    {
        fetchDataTm('target', 'trafficMeter_limited', '', 'post_fillout_init');
    });
    
    function post_fillout_init()
    {
        var message = window.top.mlang["ATMW02"] + " " +
                      $("[name=monthlyLimit]").val() + " " +
                      window.top.mlang[$("[name=limitUnit]").val()] + " ) " +
                      window.top.mlang["ATMW03"] + " [ " +
                      $("[name=limit_reached_time]").val() + " ]";
        $("#message").text(message);

        //notify cgi that the limit reached warnning page has popup
        var json_data = '{ "function": "tmPopLimitedPage", "data": { "" : ""} }';
        $.postData('/tm_block/tm_block.cgi', json_data);
    }
    /* init function Section --------> Begin */

    /* init function Section --------> End */
    
    //waitLoading() and finishLoading() is for fecthData() can work without start.html
    function waitLoading()
    {
    }

    function finishLoading()
    {
    }

    $.postData = function(url, data , callback, time) {
        //post data
        $.ajax({
            url: url + "?csrftoken_sub=" + CSRF_TOKEN_SUB,
            type: "POST",
            data: data,
            dataType: 'json',
            contentType: "application/json; charset=utf-8",
            success: function(json) {
                
            },
            error: function(xhr) {
                var json = {
                    "code": "-1",
                    "message": xhr.status + " " + xhr.statusText,
                };
                
            },
            timeout: time ? time : 0,
        });
    };

  </script>


</head>

<body bgcolor="#ffffff">
    <form id="target"  name="formname">
        <div class="form-row">
            <h1 mlang="ATM041">Warning</h1>
        </div>
        <div class="form-row">
            <span id="message"></span>
        </div>
        <!--The disabled inputs is only for read, is gotten from fetchData(), and will not be included into post parameters -->
        <input type="hidden" name="monthlyLimit" disabled>
        <input type="hidden" name="limitUnit" disabled>
        <input type="hidden" name="current_time" disabled>
        <input type="hidden" name="limit_reached_time" disabled>        
    </form>
</html>
