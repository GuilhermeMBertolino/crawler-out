!function(o){o.su.moduleManager.define("antivirus",{deps:[],services:["ajax","polling"],models:["antivirusInfo","antivirusCategory","antivirusRule"],stores:["antivirusHistoryListStore"],views:["antivirusView"],listeners:{"ev_on_launch":function(e,a,i,r,t,n,s){i.antivirusView.antivirusInfoWrapper.hide(),(a=this).unRegisterAutoSaveData([r.antivirusInfo]),s.polling.poll(r.antivirusInfo,"load",{data:{},success:function(e,t){var n;e&&(e=r.antivirusInfo.getData(),n=a.transformTime(e.checkedTime),i.antivirusView.antivirusProtectedInfo.setField("protectedDays",e.protectedDays),0==e.protectedDays||1==e.protectedDays?i.antivirusView.antivirusProtectedInfo.setField("protected_unit",o.su.CHAR.ANTIVIRUS.DAY):i.antivirusView.antivirusProtectedInfo.setField("protected_unit",o.su.CHAR.ANTIVIRUS.DAYS),e.isUpdating?i.antivirusView.antivirusUpdateInfo.setField("up_to_date",o.su.CHAR.ANTIVIRUS.DATABASE_UPDATING):(i.antivirusView.antivirusUpdateInfo.setField("up_to_date",o.su.CHAR.ANTIVIRUS.UP_TO_DATE_TEXT.replace("%s",n)),s.polling.stopPolling(r.antivirusInfo,a)),a.changeSecurityStatus(e))},fail:function(e){s.polling.stopPolling(r.antivirusInfo,a)}},5e3,a),r.antivirusCategory.load({success:function(e){e=r.antivirusCategory.getData();a.categoryList=e.categoryList,i.antivirusView.antivirusHistoryList.setCategoryList(e.categoryList)}}),r.antivirusRule.load({success:function(e){e=r.antivirusRule.getData();a.ruleList=e.ruleList,i.antivirusView.antivirusHistoryList.setRuleList(e.ruleList)}}),this.control({"#antivirus-history":{"click":function(e){t.antivirusHistoryListStore.load({data:{operation:"read"},success:function(e){e&&0<e.length?(i.antivirusView.noHistory.hide(),i.antivirusView.antivirusHistoryList.show(),i.antivirusView.antivirusHistoryClear.enable()):(i.antivirusView.antivirusHistoryList.hide(),i.antivirusView.noHistory.show(),i.antivirusView.antivirusHistoryClear.disable()),i.antivirusView.antivirusHistoryMsg.show()}})}},"#antivirus-history-clear":{"ev_button_click":function(e){i.antivirusView.antivirusHistoryClearCfm.show()}},"#antivirus-history-clear-cfm":{"ev_msg_ok":function(e){t.antivirusHistoryListStore.load({data:{operation:"clear"}})}},"#vulnerable-repair-btn":{"ev_button_click":function(e){"disable"!=r.antivirusInfo.maliciousSitesBlocking.getValue()&&"disable"!=r.antivirusInfo.intrusionPreventionSystem.getValue()&&"disable"!=r.antivirusInfo.infectedDevicePreventionBlocking.getValue()||("disable"==r.antivirusInfo.maliciousSitesBlocking.getValue()&&r.antivirusInfo.maliciousSitesBlocking.setValue("enable"),"disable"==r.antivirusInfo.intrusionPreventionSystem.getValue()&&r.antivirusInfo.intrusionPreventionSystem.setValue("enable"),"disable"==r.antivirusInfo.infectedDevicePreventionBlocking.getValue()&&r.antivirusInfo.infectedDevicePreventionBlocking.setValue("enable"),r.antivirusInfo.submit({success:function(e){a.changeSecurityStatus(e)}}))}},"#malicious-switch":{"ev_view_change":function(e){r.antivirusInfo.submit({success:function(e){a.changeSecurityStatus(e)}})}},"#instrusion-switch":{"ev_view_change":function(e){r.antivirusInfo.submit({success:function(e){a.changeSecurityStatus(e)}})}},"#infected-switch":{"ev_view_change":function(e){r.antivirusInfo.submit({success:function(e){a.changeSecurityStatus(e)}})}}})},"ev_before_destroy":function(e,t,n,a,i,r,s){s.polling.stopPolling(a.antivirusInfo,t)}},init:function(e,t,n,a,i,r){}},function(n,t,e,a,i,r){n=this;return{parseFormat:function(e,t){for(e=e.toString();e.length<t;)e="0"+e;return e},transformTime:function(e){var e=new Date(1e3*e),t=new Date;return e.getMonth()==t.getMonth()&&e.getDay()==t.getDay()?e.getHours()<=12?o.su.CHAR.DATE.TODAY+", "+n.parseFormat(e.getHours(),2)+":"+n.parseFormat(e.getMinutes(),2)+o.su.CHAR.HOUR.AM:o.su.CHAR.DATE.TODAY+", "+n.parseFormat(e.getHours()-12,2)+":"+n.parseFormat(e.getMinutes(),2)+o.su.CHAR.HOUR.PM:e.getMonth()==t.getMonth()&&e.getDay()==t.getDay()-1?e.getHours()<=12?o.su.CHAR.DATE.YESTERDAY+", "+n.parseFormat(e.getHours(),2)+":"+n.parseFormat(e.getMinutes(),2)+o.su.CHAR.HOUR.AM:o.su.CHAR.DATE.YESTERDAY+", "+n.parseFormat(e.getHours()-12,2)+":"+n.parseFormat(e.getMinutes(),2)+o.su.CHAR.HOUR.PM:e.getHours()<=12?n.parseFormat(e.getDate(),2)+"."+n.parseFormat(e.getMonth()+1,2)+", "+n.parseFormat(e.getHours(),2)+":"+n.parseFormat(e.getMinutes(),2)+o.su.CHAR.HOUR.AM:n.parseFormat(e.getDate(),2)+"."+n.parseFormat(e.getMonth()+1,2)+", "+n.parseFormat(e.getHours()-12,2)+":"+n.parseFormat(e.getMinutes(),2)+o.su.CHAR.HOUR.PM},changeSecurityStatus:function(e){"disable"==e.maliciousSitesBlocking||"disable"==e.intrusionPreventionSystem||"disable"==e.infectedDevicePreventionBlocking?t.antivirusView.antivirusInfoWrapper.addClass("vulnerable"):t.antivirusView.antivirusInfoWrapper.removeClass("vulnerable"),t.antivirusView.antivirusInfoWrapper.show()}}})}(jQuery),$.su.modelManager.define("antivirusInfo",{type:"model",fields:[{name:"checkedTime",mapping:"checked_time"},{name:"isUpdating",mapping:"is_updating"},{name:"protectedDays",mapping:"protected_days"},{name:"maliciousSitesBlocking",mapping:"malicious_sites_blocking"},{name:"intrusionPreventionSystem",mapping:"intrusion_prevention_system"},{name:"infectedDevicePreventionBlocking",mapping:"infected_device_prevention_blocking"}],proxy:{url:$.su.url("/admin/security?form=info")}}),$.su.define("securityHistoryProxy",{extend:"IPFProxy",url:$.su.url("/admin/security?form=history")}),$.su.storeManager.define("antivirusHistoryListStore",{type:"store",fields:[{name:"type"},{name:"client"},{name:"timestamp"},{name:"blockedWebsite",mapping:"blocked_website"},{name:"attacker"},{name:"blockedIp",mapping:"blocked_ip"},{name:"categoryId",mapping:"category_id"},{name:"ruleId",mapping:"rule_id"}],proxy:"securityHistoryProxy"}),$.su.modelManager.define("antivirusCategory",{type:"model",fields:[{name:"categoryList",mapping:"category_list"}],proxy:{url:$.su.url("/admin/security?form=category")}}),$.su.modelManager.define("antivirusRule",{type:"model",fields:[{name:"ruleList",mapping:"rule_list"}],proxy:{url:$.su.url("/admin/security?form=rule")}}),function(f){f.su.moduleManager.define("parentalControls",{deps:["main"],services:["ajax","device"],models:["parentalCtrlsEditorModel"],stores:["parentalControlsStore","parentalCtrlsGridItemArray","parentalCtrHistoryDay","parentalCtrlsDevicesListGrid","dailyTimeLimitS","categoryFilterS","keywordFilterS"],views:["parentalControlsView"],listeners:{"ev_on_launch":function(e,s,p,m,g,o,a){for(var t,n,s=this,i=(g.parentalControlsStore.load(),parseInt((new Date).getTime()/1e3)),i=[{name:f.su.CHAR.PARENTAL_CONTROLS.TODAY,value:"0",boxlabel:f.su.CHAR.PARENTAL_CONTROLS.TODAY},{name:f.su.CHAR.PARENTAL_CONTROLS.YESTERDAY,value:"1",boxlabel:f.su.CHAR.PARENTAL_CONTROLS.YESTERDAY},{name:s.convertLocalString(i-172800),value:"2",boxlabel:s.convertLocalString(i-172800)},{name:s.convertLocalString(i-259200),value:"3",boxlabel:s.convertLocalString(i-259200)},{name:s.convertLocalString(i-345600),value:"4",boxlabel:s.convertLocalString(i-345600)},{name:s.convertLocalString(i-432e3),value:"5",boxlabel:s.convertLocalString(i-432e3)},{name:s.convertLocalString(i-518400),value:"6",boxlabel:s.convertLocalString(i-518400)}],r=(g.parentalCtrHistoryDay.loadData(i),[]),l=30;l<=480;l+=30)t=parseInt(l/60,10),n=parseInt(l%60,10),r.push(0!=n?{name:t+" "+f.su.CHAR.PARENTAL_CONTROLS.HOURS+" "+n+" "+f.su.CHAR.PARENTAL_CONTROLS.MINS,value:l+"",boxlabel:t+" "+f.su.CHAR.PARENTAL_CONTROLS.HOURS+" "+n+" "+f.su.CHAR.PARENTAL_CONTROLS.MINS}:{name:t+" "+f.su.CHAR.PARENTAL_CONTROLS.HOURS,value:l+"",boxlabel:t+" "+f.su.CHAR.PARENTAL_CONTROLS.HOURS});g.dailyTimeLimitS.loadData(r),a.ajax.request({proxy:"patrolFilterProxy",success:function(e){for(var t=0;t<e.length;t++)s.defaultCategory[e[t].filterLevel]=e[t].categoriesList,s.preCategory[e[t].filterLevel]=e[t].prefilterList,f.isArray(s.defaultCategory[e[t].filterLevel])||(s.defaultCategory[e[t].filterLevel]=[]),f.isArray(s.preCategory[e[t].filterLevel])||(s.preCategory[e[t].filterLevel]=[]);if(s.defaultCategory.all){for(var n=[],a=0;a<s.defaultCategory.all.length;a++)n.push({name:s.defaultCategory.all[a],value:a,boxlabel:f.su.CHAR.PARENTAL_CONTROLS[s.defaultCategory.all[a].toUpperCase()]||s.defaultCategory.all[a]});g.categoryFilterS.loadData(n)}}});i="("+f.su.CHAR.REBOOT.SUN+" - "+f.su.CHAR.REBOOT.THU+")",m.parentalCtrlsEditorModel.enableWorkdayBedTime.setTips(i),i="("+f.su.CHAR.REBOOT.FRI+" and "+f.su.CHAR.REBOOT.SAT+")";m.parentalCtrlsEditorModel.enableWeekendBedTime.setTips(i),this.control({"#parental-controls-grid => a.btn-insight":{"ev_grid_action_click":function(e,t){p.parentalControlsView.parentalCtrlsInsightSwitch.itemClick("top-10-visit"),this.getTopTenVisitInfo(t),p.parentalControlsView.parentalCtrlDaySlt.setValue(0),s.renderHistory(t,function(){p.parentalControlsView.parentalCtrlsInsightMsg.show()})}},"#parental-controls-grid => a.btn-internet-access":{"ev_grid_action_click":function(e,t){var n=g.parentalControlsStore.getModelByKey(t).ownerId.getValue(),t=!g.parentalControlsStore.getModelByKey(t).internetBlocked.getValue();a.ajax.request({proxy:"patrolOwnerBlockProxy",method:"write",data:{owner_id:n,internet_blocked:t},success:function(e){g.parentalControlsStore.load()}})}},"#parental-controls-grid":{"ev_grid_edit":function(e,t){"add"===t?(p.parentalControlsView.parentalCtrlsEditSwitch.hide(),p.parentalControlsView.parentalCtrlsAddSteps.show(),p.parentalControlsView.parentalCtrlsAddBtns.show(),p.parentalControlsView.filterLevelSelectNote.show(),p.parentalControlsView.parentalCtrlsAddSteps.setValue(null),p.parentalControlsView.parentalCtrlsAddSteps.setValue("basic-info"),p.parentalControlsView.parentalCtrlsAddBtnsLeft.setText(f.su.CHAR.PARENTAL_CONTROLS.CANCEL),p.parentalControlsView.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PARENTAL_CONTROLS.NEXT),g.parentalControlsStore.getPlugin("editor").hideBtns()):(g.parentalControlsStore.getPlugin("editor").showBtns(),p.parentalControlsView.parentalCtrlsAddSteps.hide(),p.parentalControlsView.parentalCtrlsAddBtns.hide(),p.parentalControlsView.filterLevelSelectNote.hide(),p.parentalControlsView.parentalCtrlsEditSwitch.show(),p.parentalControlsView.parentalCtrlsEditSwitch.itemClick("basic-info")),setTimeout(function(){g.keywordFilterS.load()},200),p.parentalControlsView.parentalCtrlsAddBtnsRight.disable()}},"#parental-controls-grid => a.btn-delete":{"ev_grid_action_click":function(e,t){p.parentalControlsView.parentalCtrlsDelCfmMsg.viewObjs[0].settings.key=t,p.parentalControlsView.parentalCtrlsDelCfmMsg.show()}},"#parental-ctrls-del-cfm-msg":{"ev_msg_ok":function(e){g.parentalControlsStore.load({data:{operation:"remove",key:p.parentalControlsView.parentalCtrlsDelCfmMsg.viewObjs[0].settings.key},success:function(e){g.parentalControlsStore.load()}})}},"#parental-ctrls-device-list":{"ev_add_device":function(e){a.ajax.request({proxy:"onlineDevProxy",method:"load",success:function(e){for(var t=g.parentalControlsStore.getData(),n=[],a=0;a<t.length;a++)n[t[a].ownerId]=t[a].name;for(a=0;a<e.length;a++)n[e[a].owner_id]?e[a]["ownerName"]=n[e[a].owner_id]:e[a]["ownerName"]="---";g.parentalCtrlsDevicesListGrid.loadData(e,!0);for(var i=m.parentalCtrlsEditorModel.clientList.getValue(),r=[],a=0;a<e.length;a++)for(var s=0;s<i.length;s++)e[a].deviceId==i[s].deviceId&&r.push(e[a].key);setTimeout(function(){g.parentalCtrlsDevicesListGrid.selectByKey(r),p.parentalControlsView.parentalCtrlsAddDevicesMsg.show()},100)}})}},"#parental-ctrls-add-devices-msg":{"ev_msg_ok":function(e,t){var n,a=g.parentalCtrlsDevicesListGrid.getSelectedDataKey();if(a.length>s.profileLimit.devicesLength)n=f.su.CHAR.PARENTAL_CONTROLS.DEV_CATEGORY_LIMIT.replace("%1$d",s.profileLimit.devicesLength),o.main.showError(n),t.preventDefault();else{for(var i=[],r=0;r<a.length;r++)i.push(g.parentalCtrlsDevicesListGrid.getModelByKey(a[r]).getData());m.parentalCtrlsEditorModel.clientList.setValue(i)}}},"#parental-ctrls-keyword-filter":{"ev_items_limit":function(){var e=f.su.CHAR.PARENTAL_CONTROLS.DEV_CATEGORY_LIMIT.replace("%1$d",s.profileLimit.categoryLength);o.main.showError(e)}},"#parental-controls-grid_popEditor-msg .switch-field-container":{"ev_switch_click":function(e,t){s.updateScroll()}},"#parental-ctrls-add-btns-left":{"ev_button_click":function(){var e=p.parentalControlsView.parentalCtrlsAddSteps.getValue();"basic-info"==e?(g.parentalControlsStore.getPlugin("editor").getMsgBox().close(),g.parentalControlsStore.getPlugin("editor").cancelEdit()):"filter-level"==e?(p.parentalControlsView.parentalCtrlsAddBtnsLeft.setText(f.su.CHAR.PARENTAL_CONTROLS.CANCEL),p.parentalControlsView.parentalCtrlsAddSteps.back(),m.parentalCtrlsEditorModel.name.getValue()&&p.parentalControlsView.parentalCtrlsAddBtnsRight.enable()):(p.parentalControlsView.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PARENTAL_CONTROLS.NEXT),p.parentalControlsView.parentalCtrlsAddSteps.back()),s.updateScroll()}},"#parental-ctrls-add-btns-right":{"ev_button_click":function(){var e=p.parentalControlsView.parentalCtrlsAddSteps.getValue();"basic-info"==e?(p.parentalControlsView.parentalCtrlsAddBtnsLeft.setText(f.su.CHAR.PARENTAL_CONTROLS.BACK),p.parentalControlsView.parentalCtrlsAddSteps.next(),p.parentalControlsView.parentalCtrlsAddBtnsRight.disable()):"filter-level"==e?(p.parentalControlsView.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PARENTAL_CONTROLS.SAVE),p.parentalControlsView.parentalCtrlsAddSteps.next()):f("#parental-controls-grid-save-button").triggerHandler("ev_button_click"),s.updateScroll()}}}),this.listen({"models.parentalCtrlsEditorModel.name":{"ev_value_change":function(e,t,n){t?p.parentalControlsView.parentalCtrlsAddBtnsRight.enable():p.parentalControlsView.parentalCtrlsAddBtnsRight.disable()}},"views.parentalControlsView.parentalCtrlDaySlt":{"ev_value_change":function(e,t,n){s.renderTopTenVisit(t)}},"models.parentalCtrlsEditorModel.filterLevel":{"ev_value_change":function(e,t,n){if(t){p.parentalControlsView.parentalCtrlsAddBtnsRight.enable(),p.parentalControlsView.filterLevelSelectNote.hide(),p.parentalControlsView.filterLevelContent.show();var a,i=g.categoryFilterS.getData(),r="child"==t?(a=this.defaultCategory["tyke"],this.preCategory["tyke"]):"pre-teen"==t?(a=this.defaultCategory["pre_teen"],this.preCategory["pre_teen"]):(a=this.defaultCategory[t],this.preCategory[t]);m.parentalCtrlsEditorModel.categoriesList.enable();for(var s={},o=0;o<a.length;o++)for(var l=0;l<i.length;l++)a[o]==i[l].name&&(s[i[l].name]=!0,m.parentalCtrlsEditorModel.categoriesList.disableItem(i[l].value));var d=m.parentalCtrlsEditorModel.categoriesList.getValue();if(0<d.length)for(var c=0;c<d.length;c++)for(var u=0;u<i.length;u++)d[c]==i[u].name&&(s[i[u].name]=!0);else for(c=0;c<r.length;c++)for(u=0;u<i.length;u++)r[c]==i[u].name&&(s[i[u].name]=!0);for(u=0;u<i.length;u++)s[i[u].name]||(s[i[u].name]=!1);m.parentalCtrlsEditorModel.categoriesList.setValue(s)}else p.parentalControlsView.parentalCtrlsAddBtnsRight.disable(),p.parentalControlsView.filterLevelContent.hide()}},"models.parentalCtrlsEditorModel.enableWorkdayTimeLimit":{"ev_value_change":function(e,t,n){!0===t?m.parentalCtrlsEditorModel.workdayDailyTime.show():m.parentalCtrlsEditorModel.workdayDailyTime.hide()}},"models.parentalCtrlsEditorModel.enableWeekendTimeLimit":{"ev_value_change":function(e,t,n){!0===t?m.parentalCtrlsEditorModel.weekendDailyTime.show():m.parentalCtrlsEditorModel.weekendDailyTime.hide()}},"models.parentalCtrlsEditorModel.enableWorkdayBedTime":{"ev_value_change":function(e,t,n){!0===t?(m.parentalCtrlsEditorModel.workdayBedTimeBegin.show(),m.parentalCtrlsEditorModel.workdayBedTimeEnd.show()):(m.parentalCtrlsEditorModel.workdayBedTimeBegin.hide(),m.parentalCtrlsEditorModel.workdayBedTimeEnd.hide())}},"models.parentalCtrlsEditorModel.enableWeekendBedTime":{"ev_value_change":function(e,t,n){!0===t?(m.parentalCtrlsEditorModel.weekendBedTimeBegin.show(),m.parentalCtrlsEditorModel.weekendBedTimeEnd.show()):(m.parentalCtrlsEditorModel.weekendBedTimeBegin.hide(),m.parentalCtrlsEditorModel.weekendBedTimeEnd.hide())}},"stores.parentalControlsStore":{"ev_before_sync":function(e,t){t.preventDefault(),g.parentalControlsStore.sync({success:function(e){g.parentalControlsStore.loadData(e,!0)}})}}}),f("#device-list .device-list-title").text(f.su.CHAR.PARENTAL_CONTROLS.DEVICES+":"),f(".filter-level-items-wrapper .title").text(f.su.CHAR.PARENTAL_CONTROLS.FILTER_LEVEL+":"),f(".filter-level-content .title").text(f.su.CHAR.PARENTAL_CONTROLS.FILTER_CONTENT+":"),f("#filter-level-select-note").text(f.su.CHAR.PARENTAL_CONTROLS.FILTER_LEVEL_NOTE1),a.ajax.request({proxy:"profileLimitProxy",method:"read",ajax:{"async":!1},success:function(e){s.profileLimit.profileLength=e.profileLength,s.profileLimit.devicesLength=e.devicesLength,s.profileLimit.categoryLength=e.categoryLength}}),g.parentalControlsStore.setMaxRules(s.profileLimit.profileLength),m.parentalCtrlsEditorModel.keywordFilter.setMaxItems(s.profileLimit.categoryLength)}},init:function(e,t,n,a,i,r){this.configViews({id:"parentalControlsView",items:[{id:"parental-controls-grid",configs:{popEditor:{addTitle:f.su.CHAR.PARENTAL_CONTROLS.ADD_PROFILE,editTitle:f.su.CHAR.PARENTAL_CONTROLS.MODIFY_PROFILE,content:"#parental-controls-grid-editor",customBtns:"#parental-ctrls-add-btns",msg:{}},paging:{items:[{name:"8",value:8,selected:!0}]},columns:[{text:f.su.CHAR.PARENTAL_CONTROLS.PROFILE_NAME,dataIndex:"name"},{text:f.su.CHAR.PARENTAL_CONTROLS.FILTER_LEVEL,dataIndex:"filterLevel",renderer:function(e,t){var n;switch(e){case"tyke":n=f.su.CHAR.PARENTAL_CONTROLS.CHILD;break;case"pre_teen":n=f.su.CHAR.PARENTAL_CONTROLS.PRE_TEEN;break;case"teen":n=f.su.CHAR.PARENTAL_CONTROLS.TEEN;break;case"adult":n=f.su.CHAR.PARENTAL_CONTROLS.ADULT}return n}},{text:f.su.CHAR.PARENTAL_CONTROLS.TIME_LIMITS,dataIndex:"limit",renderer:function(e,t){return"---"==e||(e=1<=(e=(new Date).getDay())&&e<=5?t.enableWorkdayTimeLimit?t.workdayDailyTime:-1:t.enableWeekendTimeLimit?t.weekendDailyTime:-1)<=0?"---":e<60?e+" "+f.su.CHAR.PARENTAL_CONTROLS.MINS:(t=e%60,parseInt(e/60,10)+" "+f.su.CHAR.PARENTAL_CONTROLS.HOURS+(t?" "+t+" "+f.su.CHAR.PARENTAL_CONTROLS.MINS:""))}},{text:f.su.CHAR.PARENTAL_CONTROLS.DEVICES,dataIndex:"clientList",cls:"center-td",renderer:function(e,t){return(e=f.isArray(e)?e:[]).length}},{xtype:"actioncolumn",cls:"static-action-column",text:f.su.CHAR.PARENTAL_CONTROLS.INSIGHTS,renderer:function(e,t){var n='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-insight btn-insight">';n+='<span class="icon"></span>';return'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-insight btn-insight"><span class="icon"></span><span class="text"></span></a>'}},{xtype:"actioncolumn",cls:"static-action-column parent-control-internet-access-td",dataIndex:"internetBlocked",text:f.su.CHAR.PARENTAL_CONTROLS.INTERNET_ACCESS,renderer:function(e,t){e='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-internet-access btn-internet-access '+(!0===e?"off":"on")+'">';return(e+='<span class="icon"></span>')+('<span class="text">'+f.su.CHAR.PARENTAL_CONTROLS.PAUSED+"</span>")+"</a>"}},{xtype:"actioncolumn",text:f.su.CHAR.PARENTAL_CONTROLS.MODIFY,renderer:function(e,t){var n='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit">';n+='<span class="icon"></span>';return'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit"><span class="icon"></span><span class="text"></span></a><a href="javascript:void(0)" class="grid-content-btn grid-content-custom-btn-delete btn-delete"><span class="icon"></span><span class="text"></span></a>'}}]}},{id:"parental-ctrls-insight-switch",fields:[{text:f.su.CHAR.PARENTAL_CONTROLS.TOP_10_VISITS,name:"top-10-visit",container:"top-10-visit"},{text:f.su.CHAR.PARENTAL_CONTROLS.HISTORY,name:"parental-ctrls-history",container:"parental-ctrls-history"}]},{id:"parental-ctrls-edit-switch",fields:[{text:f.su.CHAR.PARENTAL_CONTROLS.BASIC_INFO,name:"basic-info",container:"basic-info"},{text:f.su.CHAR.PARENTAL_CONTROLS.FILTER_LEVEL,name:"filter-level",container:"filter-level"},{text:f.su.CHAR.PARENTAL_CONTROLS.TIME_CONTROLS,name:"time-controls",container:"time-controls"}]},{id:"parental-ctrls-edit-steps",fields:[{name:"basic-info",text:f.su.CHAR.PARENTAL_CONTROLS.BASIC_INFORMATION,container:"basic-info"},{name:"filter-level",text:f.su.CHAR.PARENTAL_CONTROLS.FILTER_LEVEL,container:"filter-level"},{name:"time-controls",text:f.su.CHAR.PARENTAL_CONTROLS.TIME_CONTROLS,container:"time-controls"}]},{id:"parental-ctrls-devices-list-grid",configs:{paging:{items:[{name:"5",value:5,selected:!0}]},columns:[{xtype:"checkcolumn"},{text:f.su.CHAR.PARENTAL_CONTROLS.DEVICE_TYPE,cls:"center-td",dataIndex:"clientType",width:120,renderer:function(e,t){return'<span class="icon '+e+'"></span>'}},{text:f.su.CHAR.PARENTAL_CONTROLS.DEVICE_NAME,dataIndex:"name"},{text:f.su.CHAR.PARENTAL_CONTROLS.DEVICE_OWNER,dataIndex:"ownerName"},{text:f.su.CHAR.PARENTAL_CONTROLS.MAC_ADDRESS,dataIndex:"mac",width:"25%"}]}}]}),a.parentalCtrlsDevicesListGrid.setConvert(function(e){a.parentalControlsStore.getData();return e})}},function(l,o,e,d,c,m){l=this;return{topTenVisitInfo:{},defaultCategory:[],preCategory:[],categoryTotal:[],profileLimit:{profileLength:16,devicesLength:16,categoryLength:32},getTopTenVisitInfo:function(t){var e=d.parentalControlsStore.getModelByKey(t).ownerId.getValue();m.ajax.request({proxy:"parentalControlsHistoryProxy",ajax:{"async":!1},data:{ownerId:e},success:function(e){l.topTenVisitInfo=e.insights,l.topTenVisitInfo.key=t}})},renderTopTenVisit:function(e){var t=this,n=t.topTenVisitInfo[e].spend_online,a=t.topTenVisitInfo[e].website_list,i=d.parentalControlsStore.getModelByKey(t.topTenVisitInfo.key).ownerId.getValue();if(!a.length||a.length<=0)o.parentalControlsView.topTenVisitNoHistory.show(),f(".top-10-visit-wrapper").addClass("hidden");else{o.parentalControlsView.topTenVisitNoHistory.hide(),f(".top-10-visit-wrapper").removeClass("hidden");for(var e=parseInt(n/60)+" "+f.su.CHAR.PARENTAL_CONTROLS.HOURS+"<br />"+parseInt(n%60)+" "+f.su.CHAR.PARENTAL_CONTROLS.MINS,r=(f(".total-spent-online .content .hours-spent").html(e),window.echarts===undefined?f.su.router.loadFile("js/libs/echarts.min.js",function(){t.renderTotalTime(n)}):window.echarts&&t.renderTotalTime(n),""),s=0;s<a.length;s++)r=(r=(r=(r+="<tr>")+'<td class="url website" title="'+f.su.escapeHtml(a[s].website)+'">'+f.su.escapeHtml(a[s].website)+"</td>")+'<td class="time">'+f.su.escapeHtml(a[s].spend_online)+"</td>")+'<td class="block"><span class="block-icon '+(a[s].block?"has_blocked":"")+'" owner-id="'+i+'" website="'+f.su.escapeHtml(a[s].website)+'"></span></td></tr>';f("#top-10-visit-info-remain-grid tbody").html(r),f("#top-10-visit-info-remain-grid span.block-icon").click(function(){t.block(this)})}},block:function(t){var e=f(t).attr("owner-id"),n=d.parentalControlsStore.getData(),a=d.parentalCtrlsGridItemArray.getData();if(0!=a.length){for(var i=0;i<a.length;i++)if(e==a[i].ownerId&&a[i].keywordFilter.length+1>l.profileLimit.categoryLength)return r=f.su.CHAR.PARENTAL_CONTROLS.DEV_CATEGORY_LIMIT.replace("%1$d",l.profileLimit.categoryLength),c.main.showError(r),!1}else for(var r,i=0;i<n.length;i++)if(e==n[i].ownerId&&n[i].keywordFilter.length+1>l.profileLimit.categoryLength)return r=f.su.CHAR.PARENTAL_CONTROLS.DEV_CATEGORY_LIMIT.replace("%1$d",l.profileLimit.categoryLength),c.main.showError(r),!1;var s=!f(t).hasClass("has_blocked"),o=f(t).attr("website");m.ajax.request({url:f.su.url("/admin/smart_network?form=patrol_owner_website_block"),data:{operation:"write",owner_id:e,blocked_status:s,website:o},success:function(e){s?(f(t).addClass("has_blocked"),c.main.showNotice(f.su.CHAR.PARENTAL_CONTROLS.BLOCKED,0)):(f(t).removeClass("has_blocked"),c.main.showNotice(f.su.CHAR.PARENTAL_CONTROLS.UNBLOCKED,0)),d.parentalCtrlsGridItemArray.load()},fail:function(){c.main.showError(f.su.CHAR.PARENTAL_CONTROLS.WEBSITE_NUM_LIMIT)}})},renderHistory:function(e,c){var u=this,p=d.parentalControlsStore.getModelByKey(e).ownerId.getValue();m.ajax.request({proxy:"patrolInsightsHistoryProxy",data:{ownerId:p},success:function(e){var r=[];for(var t=e.history,n=0,a=t.length;n<a;n++)!function d(e,t){r[e]||(r[e]={date:u.convertLocalString(t.accessTimestamp),data:[]});var n,a,i=new Date(1e3*t.accessTimestamp);u.convertLocalString(t.accessTimestamp)!=r[e].date?d(++e,t):(n=12<i.getHours()?i.getHours()-12:i.getHours(),a=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes(),i=12<i.getHours()?"PM":"AM",r[e].data.push({site:f.su.escapeHtml(t.website),time:n+":"+a+" "+i,block:t.block}))}(0,t[n]);var i="";if(0<r.length)for(var s,o=0,a=r.length;o<a;o++){for(var i=(i=(i+='<div class="parental-ctrls-history-wrapper">')+('<div class="title"><span>'+r[o].date+"</span></div>"))+'<div class="content">'+'<div class="parental-ctrls-history-lists">',l=0;l<r[o].data.length;l++)s=r[o].data[l].block?"has_blocked":"",i=(i=(i=(i+='<div class="items'+(l==r[o].data.length-1?" last":"")+'">')+'<div class="time-wrapper"><span class="time">'+r[o].data[l].time+'</span></div><div class="point-wrapper"><span class="point"></span></div><span class="conn-line"></span>')+'<div class="website-wrapper"><span class="website">'+r[o].data[l].site+"</span></div>")+'<span class="block '+s+'" owner-id="'+p+'" website="'+r[o].data[l].site+'"></span></div>';i=(i+="</div>")+"</div>"+"</div>"}else i+='<div class="parental-ctrls-no-history"><span>'+f.su.CHAR.PARENTAL_CONTROLS.NO_HISTORY+"</span></div>";f("#parental-ctrls-insight-msg .parental-ctrls-history-content").html(i),f(".parental-ctrls-history-lists span.block").click(function(){u.block(this)}),c&&c()}})},renderTotalTime:function(e){var t=m.device.getConfig().supportGamingUIGX90?"#af0000":"#4acbd6",e=parseInt(e/1440*100),n=f("#total-spent-time").get(0),t={series:[{type:"pie",animation:!1,center:["50%","50%"],radius:[44,50],itemStyle:{normal:{label:{show:!1}}},data:[{name:"",value:e,itemStyle:{normal:{color:t,label:{show:!0,position:"center"},labelLine:{show:!1}},emphasis:{color:"#4acbd6"}}},{name:"",value:100-e,itemStyle:{normal:{color:"rgba(0, 0, 0, 0)",label:{show:!0},labelLine:{show:!1}},emphasis:{color:"rgba(0, 0, 0, 0)"}}}]}]},n=(echarts.init(n).setOption(t),f("#total-left-time").get(0)),t={series:[{type:"pie",animation:!1,center:["50%","50%"],radius:[45,49],itemStyle:{normal:{label:{show:!1}}},data:[{name:"",value:e,itemStyle:{normal:{color:"rgba(0, 0, 0, 0)",label:{show:!0,position:"center"},labelLine:{show:!1}},emphasis:{color:"rgba(0, 0, 0, 0)"}}},{name:"",value:100-e,itemStyle:{normal:{color:"#e8e8e8",label:{show:!0},labelLine:{show:!1}},emphasis:{color:"#e8e8e8"}}}]}]};echarts.init(n).setOption(t)},convertLocalString:function(e){var t,n=new Date,n=parseInt(n.getTime()/1e3),n=parseInt((n-e)/3600);return 0<n&&n<24?f.su.CHAR.PARENTAL_CONTROLS.TODAY:24<n&&n<48?f.su.CHAR.PARENTAL_CONTROLS.YESTERDAY:(e=(n=new Date(1e3*e)).getDate(),[t=(t=n.getMonth()+1)<10?"0"+t:t,e=e<10?"0"+e:e,n.getFullYear()].join("/"))},updateScroll:function(){}}})}(jQuery),$.su.define("parentalControlsStoreProxy",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_owner_list"),api:{internetAccessChange:{writeFilter:function(e){return{operation:"write",owner_id:e.ownerId,internet_blocked:e.internetBlocked}}}}}),$.su.storeManager.define("parentalControlsStore",{type:"store",fields:[{name:"ownerId",mapping:"owner_id"},{name:"name"},{name:"filterLevel",mapping:"filter_level"},{name:"limit"},{name:"clientList",mapping:"client_list",defaultValue:[]},{name:"internetBlocked",mapping:"internet_blocked"},{name:"categoriesList",mapping:"categories_list",defaultValue:[]},{name:"enableWorkdayTimeLimit",mapping:"enable_workday_time_limit",defaultValue:!1},{name:"workdayDailyTime",mapping:"workday_daily_time",defaultValue:"120"},{name:"enableWeekendTimeLimit",mapping:"enable_weekend_time_limit",defaultValue:!1},{name:"weekendDailyTime",mapping:"weekend_daily_time",defaultValue:"120"},{name:"enableWorkdayBedTime",mapping:"enable_workday_bed_time",defaultValue:!1},{name:"workdayBedTimeBegin",mapping:"workday_bed_time_begin",defaultValue:"1320"},{name:"workdayBedTimeEnd",mapping:"workday_bed_time_end",defaultValue:"420"},{name:"enableWeekendBedTime",mapping:"enable_weekend_bed_time",defaultValue:!1},{name:"weekendBedTimeBegin",mapping:"weekend_bed_time_begin",defaultValue:"1320"},{name:"weekendBedTimeEnd",mapping:"weekend_bed_time_end",defaultValue:"420"},{name:"keywordFilter",mapping:"website_list",defaultValue:[]}],proxy:"parentalControlsStoreProxy"}),$.su.storeManager.define("parentalCtrlsGridItemArray",{type:"store",fields:[{name:"ownerId",mapping:"owner_id"},{name:"categoriesList",mapping:"categories_list",defaultValue:[]},{name:"keywordFilter",mapping:"website_list",defaultValue:[]}],proxy:"parentalControlsStoreProxy"}),$.su.modelManager.define("parentalCtrlsEditorModel",{type:"model",fields:[{name:"ownerId"},{name:"name",maxLength:64,allowBlank:!1},{name:"clientList",convert:function(e){for(var t=0;t<e.length;t++)e[t].deviceId=e[t].device_id,delete e[t].device_id,e[t].ownerId=e[t].owner_id,delete e[t].owner_id,e[t].clientType=e[t].client_type,delete e[t].client_type;return e},serialize:function(e){for(var t=0;t<e.length;t++)e[t].device_id=e[t].deviceId,delete e[t].deviceId,e[t].owner_id=e[t].ownerId,delete e[t].ownerId,e[t].client_type=e[t].clientType,delete e[t].clientType;return e}},{name:"categoriesList"},{name:"filterLevel"},{name:"enableWorkdayTimeLimit"},{name:"workdayDailyTime"},{name:"enableWeekendTimeLimit"},{name:"weekendDailyTime"},{name:"enableWorkdayBedTime"},{name:"workdayBedTimeBegin"},{name:"workdayBedTimeEnd"},{name:"enableWeekendBedTime"},{name:"weekendBedTimeBegin"},{name:"weekendBedTimeEnd"},{name:"keywordFilter"}],convert:function(e){var t=function(e){return parseInt(e/60,10)+":"+parseInt(e%60,10)};return e.workdayBedTimeBegin=t(e.workdayBedTimeBegin),e.workdayBedTimeEnd=t(e.workdayBedTimeEnd),e.weekendBedTimeBegin=t(e.weekendBedTimeBegin),e.weekendBedTimeEnd=t(e.weekendBedTimeEnd),"tyke"===e.filterLevel&&(e.filterLevel="child"),"pre_teen"===e.filterLevel&&(e.filterLevel="pre-teen"),e},serialize:function(e){var t,n=function(e){return 60*parseInt(e.split(":")[0],10)+parseInt(e.split(":")[1],10)+""},a=[];for(t in e.categoriesList)e.categoriesList[t]&&a.push(t);return e.categoriesList=a,e.workdayBedTimeBegin=n(e.workdayBedTimeBegin),e.workdayBedTimeEnd=n(e.workdayBedTimeEnd),e.weekendBedTimeBegin=n(e.weekendBedTimeBegin),e.weekendBedTimeEnd=n(e.weekendBedTimeEnd),"child"===e.filterLevel&&(e.filterLevel="tyke"),"pre-teen"===e.filterLevel&&(e.filterLevel="pre_teen"),e}}),$.su.define("parentalControlsKeywordProxy",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=filter_apps_list"),writeFilter:function(e){return{operation:"read"}}}),$.su.storeManager.define("keywordFilterS",{type:"store",fields:[{name:"name"}],proxy:"parentalControlsKeywordProxy"}),$.su.define("parentalControlsHistoryProxy",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_insights"),readFilter:function(e){return{insights:e.data.insights}},writeFilter:function(e){return{operation:"read",owner_id:e.ownerId}}}),$.su.storeManager.define("parentalCtrHistoryDay",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}]}),$.su.define("patrolInsightsHistoryProxy",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_insights_history"),readFilter:function(e){for(var t=e.data,n=0;n<t.history.length;n++)t.history[n].accessTimestamp=t.history[n].access_timestamp,delete t.history[n].access_timestamp;return t},writeFilter:function(e){return{operation:"read",owner_id:e.ownerId}}}),$.su.storeManager.define("parentalCtrlsDevicesListGrid",{type:"store",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"enablePriority",mapping:"enable_priority"},{name:"remainTime",mapping:"remain_time"},{name:"ownerName"}]}),$.su.storeManager.define("dailyTimeLimitS",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}]}),$.su.storeManager.define("categoryFilterS",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}]}),$.su.define("patrolFilterProxy",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_filter"),readFilter:function(e){for(var t=e.data,n=0;n<t.length;n++)t[n].websiteList=t[n].website_list,delete t[n].website_list,t[n].categoriesList=t[n].categories_list,delete t[n].categories_list,t[n].prefilterList=t[n].prefilter_list,delete t[n].prefilter_list,t[n].filterLevel=t[n].filter_level,delete t[n].filter_level;return t},writeFilter:function(e){return{operation:"load"}}}),$.su.define("patrolOwnerBlockProxy",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_owner_block")}),$.su.define("onlineDevProxy",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_devices")}),$.su.define("profileLimitProxy",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_limit"),readFilter:function(e){return{profileLength:e.data.profile_len,devicesLength:e.data.devices_len,categoryLength:e.data.category_len}}}),function(g){g.su.moduleManager.define("parentalControlsV2",{deps:["main"],services:["ajax"],models:["parentalCtrlsEditorModelV2"],stores:["parentalControlsStoreV2","parentalCtrlsGridItemArrayV2","parentalCtrHistoryDayV2","parentalCtrlsDevicesListGridV2","dailyTimeLimitSV2","keywordFilterSV2"],views:["parentalControlsV2View"],listeners:{"ev_on_launch":function(e,s,o,l,d,c,a){for(var t,n,s=this,i=(d.parentalControlsStoreV2.load(),parseInt((new Date).getTime()/1e3)),i=[{name:g.su.CHAR.PARENTAL_CONTROLS.TODAY,value:"0",boxlabel:g.su.CHAR.PARENTAL_CONTROLS.TODAY},{name:g.su.CHAR.PARENTAL_CONTROLS.YESTERDAY,value:"1",boxlabel:g.su.CHAR.PARENTAL_CONTROLS.YESTERDAY},{name:s.convertLocalString(i-172800),value:"2",boxlabel:s.convertLocalString(i-172800)},{name:s.convertLocalString(i-259200),value:"3",boxlabel:s.convertLocalString(i-259200)},{name:s.convertLocalString(i-345600),value:"4",boxlabel:s.convertLocalString(i-345600)},{name:s.convertLocalString(i-432e3),value:"5",boxlabel:s.convertLocalString(i-432e3)},{name:s.convertLocalString(i-518400),value:"6",boxlabel:s.convertLocalString(i-518400)}],r=(d.parentalCtrHistoryDayV2.loadData(i),[]),u=30;u<=480;u+=30)t=parseInt(u/60,10),n=parseInt(u%60,10),r.push(0!=n?{name:t+" "+g.su.CHAR.PARENTAL_CONTROLS.HOURS+" "+n+" "+g.su.CHAR.PARENTAL_CONTROLS.MINS,value:u+"",boxlabel:t+" "+g.su.CHAR.PARENTAL_CONTROLS.HOURS+" "+n+" "+g.su.CHAR.PARENTAL_CONTROLS.MINS}:{name:t+" "+g.su.CHAR.PARENTAL_CONTROLS.HOURS,value:u+"",boxlabel:t+" "+g.su.CHAR.PARENTAL_CONTROLS.HOURS});d.dailyTimeLimitSV2.loadData(r),this.control({"#parental-controls-grid => a.btn-insight":{"ev_grid_action_click":function(e,t){o.parentalControlsV2View.parentalCtrlsInsightSwitch.itemClick("top-10-visit"),this.getTopTenVisitInfo(t),o.parentalControlsV2View.parentalCtrlDaySlt.setValue(0),s.renderHistory(t,function(){o.parentalControlsV2View.parentalCtrlsInsightMsg.show()})}},"#parental-controls-grid => a.btn-internet-access":{"ev_grid_action_click":function(e,t){var n=d.parentalControlsStoreV2.getModelByKey(t).ownerId.getValue(),t=!d.parentalControlsStoreV2.getModelByKey(t).internetBlocked.getValue();a.ajax.request({proxy:"patrolOwnerBlockProxyV2",method:"write",data:{owner_id:n,internet_blocked:t},success:function(e){d.parentalControlsStoreV2.load()}})}},"#parental-controls-grid":{"ev_grid_edit":function(e,t){"add"===t?(o.parentalControlsV2View.parentalCtrlsEditSwitch.hide(),o.parentalControlsV2View.parentalCtrlsAddSteps.show(),o.parentalControlsV2View.parentalCtrlsAddBtns.show(),o.parentalControlsV2View.parentalCtrlsAddSteps.setValue(null),o.parentalControlsV2View.parentalCtrlsAddSteps.setValue("basic-info"),o.parentalControlsV2View.parentalCtrlsAddBtnsLeft.setText(g.su.CHAR.PARENTAL_CONTROLS.CANCEL),o.parentalControlsV2View.parentalCtrlsAddBtnsRight.setText(g.su.CHAR.PARENTAL_CONTROLS.NEXT),d.parentalControlsStoreV2.getPlugin("editor").hideBtns()):(d.parentalControlsStoreV2.getPlugin("editor").showBtns(),o.parentalControlsV2View.parentalCtrlsAddSteps.hide(),o.parentalControlsV2View.parentalCtrlsAddBtns.hide(),o.parentalControlsV2View.parentalCtrlsEditSwitch.show(),o.parentalControlsV2View.parentalCtrlsEditSwitch.itemClick("basic-info")),setTimeout(function(){d.keywordFilterSV2.load()},200),o.parentalControlsV2View.parentalCtrlsAddBtnsRight.disable()}},"#parental-controls-grid => a.btn-delete":{"ev_grid_action_click":function(e,t){o.parentalControlsV2View.parentalCtrlsDelCfmMsg.viewObjs[0].settings.key=t,o.parentalControlsV2View.parentalCtrlsDelCfmMsg.show()}},"#parental-ctrls-del-cfm-msg":{"ev_msg_ok":function(e){d.parentalControlsStoreV2.load({data:{operation:"remove",key:o.parentalControlsV2View.parentalCtrlsDelCfmMsg.viewObjs[0].settings.key},success:function(e){d.parentalControlsStoreV2.load()}})}},"#parental-ctrls-device-list":{"ev_add_device":function(e){a.ajax.request({proxy:"onlineDevProxyV2",method:"load",success:function(e){for(var t=d.parentalControlsStoreV2.getData(),n=[],a=0;a<t.length;a++)n[t[a].ownerId]=t[a].name;for(a=0;a<e.length;a++)n[e[a].owner_id]?e[a]["ownerName"]=n[e[a].owner_id]:e[a]["ownerName"]="---";d.parentalCtrlsDevicesListGridV2.loadData(e,!0);for(var i=l.parentalCtrlsEditorModelV2.clientList.getValue(),r=[],a=0;a<e.length;a++)for(var s=0;s<i.length;s++)e[a].deviceId==i[s].deviceId&&r.push(e[a].key);setTimeout(function(){d.parentalCtrlsDevicesListGridV2.selectByKey(r),o.parentalControlsV2View.parentalCtrlsAddDevicesMsg.show()},100)}})}},"#parental-ctrls-add-devices-msg":{"ev_msg_ok":function(e,t){var n,a=d.parentalCtrlsDevicesListGridV2.getSelectedDataKey();if(a.length>s.profileLimit.devicesLength)n=g.su.CHAR.PARENTAL_CONTROLS.DEV_CATEGORY_LIMIT.replace("%1$d",s.profileLimit.devicesLength),c.main.showError(n),t.preventDefault();else{for(var i=[],r=0;r<a.length;r++)i.push(d.parentalCtrlsDevicesListGridV2.getModelByKey(a[r]).getData());l.parentalCtrlsEditorModelV2.clientList.setValue(i)}}},"#parental-ctrls-keyword-filter":{"ev_items_limit":function(){var e=g.su.CHAR.PARENTAL_CONTROLS.DEV_CATEGORY_LIMIT.replace("%1$d",s.profileLimit.categoryLength);c.main.showError(e)}},"#parental-controls-grid_popEditor-msg .switch-field-container":{"ev_switch_click":function(e,t){s.updateScroll()}},"#parental-ctrls-add-btns-left":{"ev_button_click":function(){var e=o.parentalControlsV2View.parentalCtrlsAddSteps.getValue();"basic-info"==e?(d.parentalControlsStoreV2.getPlugin("editor").getMsgBox().close(),d.parentalControlsStoreV2.getPlugin("editor").cancelEdit()):"filter-level"==e?(o.parentalControlsV2View.parentalCtrlsAddBtnsLeft.setText(g.su.CHAR.PARENTAL_CONTROLS.CANCEL),o.parentalControlsV2View.parentalCtrlsAddSteps.back(),l.parentalCtrlsEditorModelV2.name.getValue()&&o.parentalControlsV2View.parentalCtrlsAddBtnsRight.enable()):(o.parentalControlsV2View.parentalCtrlsAddBtnsRight.setText(g.su.CHAR.PARENTAL_CONTROLS.NEXT),o.parentalControlsV2View.parentalCtrlsAddSteps.back()),s.updateScroll()}},"#parental-ctrls-add-btns-right":{"ev_button_click":function(){var e=o.parentalControlsV2View.parentalCtrlsAddSteps.getValue();"basic-info"==e?(o.parentalControlsV2View.parentalCtrlsAddBtnsLeft.setText(g.su.CHAR.PARENTAL_CONTROLS.BACK),o.parentalControlsV2View.parentalCtrlsAddSteps.next()):"filter-level"==e?(o.parentalControlsV2View.parentalCtrlsAddBtnsRight.setText(g.su.CHAR.PARENTAL_CONTROLS.SAVE),o.parentalControlsV2View.parentalCtrlsAddSteps.next()):g("#parental-controls-grid-save-button").triggerHandler("ev_button_click"),s.updateScroll()}}}),this.listen({"models.parentalCtrlsEditorModelV2.name":{"ev_value_change":function(e,t,n){t?o.parentalControlsV2View.parentalCtrlsAddBtnsRight.enable():o.parentalControlsV2View.parentalCtrlsAddBtnsRight.disable()}},"views.parentalControlsV2View.parentalCtrlDaySlt":{"ev_value_change":function(e,t,n){s.renderTopTenVisit(t)}},"models.parentalCtrlsEditorModelV2.enableWorkdayTimeLimit":{"ev_value_change":function(e,t,n){!0===t?l.parentalCtrlsEditorModelV2.workdayDailyTime.show():l.parentalCtrlsEditorModelV2.workdayDailyTime.hide()}},"models.parentalCtrlsEditorModelV2.enableWeekendTimeLimit":{"ev_value_change":function(e,t,n){!0===t?l.parentalCtrlsEditorModelV2.weekendDailyTime.show():l.parentalCtrlsEditorModelV2.weekendDailyTime.hide()}},"models.parentalCtrlsEditorModelV2.enableWorkdayBedTime":{"ev_value_change":function(e,t,n){!0===t?(l.parentalCtrlsEditorModelV2.workdayBedTimeBegin.show(),l.parentalCtrlsEditorModelV2.workdayBedTimeEnd.show()):(l.parentalCtrlsEditorModelV2.workdayBedTimeBegin.hide(),l.parentalCtrlsEditorModelV2.workdayBedTimeEnd.hide())}},"models.parentalCtrlsEditorModelV2.enableWeekendBedTime":{"ev_value_change":function(e,t,n){!0===t?(l.parentalCtrlsEditorModelV2.weekendBedTimeBegin.show(),l.parentalCtrlsEditorModelV2.weekendBedTimeEnd.show()):(l.parentalCtrlsEditorModelV2.weekendBedTimeBegin.hide(),l.parentalCtrlsEditorModelV2.weekendBedTimeEnd.hide())}},"stores.parentalControlsStoreV2":{"ev_before_sync":function(e,t){t.preventDefault(),d.parentalControlsStoreV2.sync({success:function(e){d.parentalControlsStoreV2.loadData(e,!0)}})}}}),g("#device-list .device-list-title").text(g.su.CHAR.PARENTAL_CONTROLS.DEVICES+":"),g(".filter-level-items-wrapper .title").text(g.su.CHAR.PARENTAL_CONTROLS.FILTER_LEVEL+":"),g(".filter-level-content .title").text(g.su.CHAR.PARENTAL_CONTROLS.FILTER_CONTENT+":"),a.ajax.request({proxy:"profileLimitProxyV2",method:"read",ajax:{"async":!1},success:function(e){s.profileLimit.profileLength=e.profileLength,s.profileLimit.devicesLength=e.devicesLength,s.profileLimit.categoryLength=e.categoryLength}}),d.parentalControlsStoreV2.setMaxRules(s.profileLimit.profileLength),l.parentalCtrlsEditorModelV2.keywordFilter.setMaxItems(s.profileLimit.categoryLength)}},init:function(e,t,n,a,i,r){this.configViews({id:"parentalControlsV2View",items:[{id:"parental-controls-grid",configs:{popEditor:{addTitle:g.su.CHAR.PARENTAL_CONTROLS.ADD_PROFILE,editTitle:g.su.CHAR.PARENTAL_CONTROLS.MODIFY_PROFILE,content:"#parental-controls-grid-editor",customBtns:"#parental-ctrls-add-btns",msg:{}},paging:{items:[{name:"8",value:8,selected:!0}]},columns:[{text:g.su.CHAR.PARENTAL_CONTROLS.PROFILE_NAME,dataIndex:"name"},{text:g.su.CHAR.PARENTAL_CONTROLS.TIME_LIMITS,dataIndex:"limit",renderer:function(e,t){return"---"==e||(e=1<=(e=(new Date).getDay())&&e<=5?t.enableWorkdayTimeLimit?t.workdayDailyTime:-1:t.enableWeekendTimeLimit?t.weekendDailyTime:-1)<=0?"---":e<60?e+" "+g.su.CHAR.PARENTAL_CONTROLS.MINS:(t=e%60,parseInt(e/60,10)+" "+g.su.CHAR.PARENTAL_CONTROLS.HOURS+(t?" "+t+" "+g.su.CHAR.PARENTAL_CONTROLS.MINS:""))}},{text:g.su.CHAR.PARENTAL_CONTROLS.DEVICES,dataIndex:"clientList",width:90,cls:"center-td",renderer:function(e,t){return(e=g.isArray(e)?e:[]).length}},{xtype:"actioncolumn",width:100,cls:"static-action-column",text:g.su.CHAR.PARENTAL_CONTROLS.INSIGHTS,renderer:function(e,t){var n='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-insight btn-insight">';n+='<span class="icon"></span>';return'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-insight btn-insight"><span class="icon"></span><span class="text"></span></a>'}},{xtype:"actioncolumn",cls:"static-action-column parent-control-internet-access-td",dataIndex:"internetBlocked",text:g.su.CHAR.PARENTAL_CONTROLS.INTERNET_ACCESS,renderer:function(e,t){e='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-internet-access btn-internet-access '+(!0===e?"off":"on")+'">';return(e+='<span class="icon"></span>')+('<span class="text">'+g.su.CHAR.PARENTAL_CONTROLS.PAUSED+"</span>")+"</a>"}},{xtype:"actioncolumn",text:g.su.CHAR.PARENTAL_CONTROLS.MODIFY,renderer:function(e,t){var n='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit">';n+='<span class="icon"></span>';return'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit"><span class="icon"></span><span class="text"></span></a><a href="javascript:void(0)" class="grid-content-btn grid-content-custom-btn-delete btn-delete"><span class="icon"></span><span class="text"></span></a>'}}]}},{id:"parental-ctrls-insight-switch",fields:[{text:g.su.CHAR.PARENTAL_CONTROLS.TOP_10_VISITS,name:"top-10-visit",container:"top-10-visit"},{text:g.su.CHAR.PARENTAL_CONTROLS.HISTORY,name:"parental-ctrls-history",container:"parental-ctrls-history"}]},{id:"parental-ctrls-edit-switch",fields:[{text:g.su.CHAR.PARENTAL_CONTROLS.BASIC_INFO,name:"basic-info",container:"basic-info"},{text:g.su.CHAR.PARENTAL_CONTROLS.BLOCKED_CONTENT,name:"filter-level",container:"filter-level"},{text:g.su.CHAR.PARENTAL_CONTROLS.TIME_CONTROLS,name:"time-controls",container:"time-controls"}]},{id:"parental-ctrls-edit-steps",fields:[{name:"basic-info",text:g.su.CHAR.PARENTAL_CONTROLS.BASIC_INFORMATION,container:"basic-info"},{name:"filter-level",text:g.su.CHAR.PARENTAL_CONTROLS.BLOCKED_CONTENT,container:"filter-level"},{name:"time-controls",text:g.su.CHAR.PARENTAL_CONTROLS.TIME_CONTROLS,container:"time-controls"}]},{id:"parental-ctrls-devices-list-grid",configs:{paging:{items:[{name:"5",value:5,selected:!0}]},columns:[{xtype:"checkcolumn"},{text:g.su.CHAR.PARENTAL_CONTROLS.DEVICE_TYPE,cls:"center-td",dataIndex:"clientType",width:120,renderer:function(e,t){return'<span class="icon '+e+'"></span>'}},{text:g.su.CHAR.PARENTAL_CONTROLS.DEVICE_NAME,dataIndex:"name"},{text:g.su.CHAR.PARENTAL_CONTROLS.DEVICE_OWNER,dataIndex:"ownerName"},{text:g.su.CHAR.PARENTAL_CONTROLS.MAC_ADDRESS,dataIndex:"mac",width:"25%"}]}}]}),a.parentalCtrlsDevicesListGridV2.setConvert(function(e){a.parentalControlsStoreV2.getData();return e})}},function(l,o,e,d,c,m){l=this;return{topTenVisitInfo:{},defaultCategory:[],preCategory:[],categoryTotal:[],profileLimit:{profileLength:16,devicesLength:16,categoryLength:32},getTopTenVisitInfo:function(t){var e=d.parentalControlsStoreV2.getModelByKey(t).ownerId.getValue();m.ajax.request({proxy:"parentalControlsHistoryProxyV2",ajax:{"async":!1},data:{ownerId:e},success:function(e){l.topTenVisitInfo=e.insights,l.topTenVisitInfo.key=t}})},renderTopTenVisit:function(e){var t=this,n=t.topTenVisitInfo[e].spend_online,a=t.topTenVisitInfo[e].website_list,i=d.parentalControlsStoreV2.getModelByKey(t.topTenVisitInfo.key).ownerId.getValue();if(!a.length||a.length<=0)o.parentalControlsV2View.topTenVisitNoHistory.show(),g(".top-10-visit-wrapper").addClass("hidden");else{o.parentalControlsV2View.topTenVisitNoHistory.hide(),g(".top-10-visit-wrapper").removeClass("hidden");for(var e=parseInt(n/60)+" "+g.su.CHAR.PARENTAL_CONTROLS.HOURS+"<br />"+parseInt(n%60)+" "+g.su.CHAR.PARENTAL_CONTROLS.MINS,r=(g(".total-spent-online .content .hours-spent").html(e),window.echarts===undefined?g.su.router.loadFile("js/libs/echarts.min.js",function(){t.renderTotalTime(n)}):window.echarts&&t.renderTotalTime(n),""),s=0;s<a.length;s++)r=(r=(r=(r+="<tr>")+'<td class="url website" title="'+a[s].website+'">'+a[s].website+"</td>")+'<td class="time">'+a[s].spend_online+"</td>")+'<td class="block"><span class="block-icon '+(a[s].block?"has_blocked":"")+'" owner-id="'+i+'" website="'+a[s].website+'"></span></td></tr>';g("#top-10-visit-info-remain-grid tbody").html(r),g("#top-10-visit-info-remain-grid span.block-icon").click(function(){t.block(this)})}},block:function(t){var e=g(t).attr("owner-id"),n=d.parentalControlsStoreV2.getData(),a=d.parentalCtrlsGridItemArrayV2.getData();if(0!=a.length){for(var i=0;i<a.length;i++)if(e==a[i].ownerId&&a[i].keywordFilter.length+1>l.profileLimit.categoryLength)return r=g.su.CHAR.PARENTAL_CONTROLS.DEV_CATEGORY_LIMIT.replace("%1$d",l.profileLimit.categoryLength),c.main.showError(r),!1}else for(var r,i=0;i<n.length;i++)if(e==n[i].ownerId&&n[i].keywordFilter.length+1>l.profileLimit.categoryLength)return r=g.su.CHAR.PARENTAL_CONTROLS.DEV_CATEGORY_LIMIT.replace("%1$d",l.profileLimit.categoryLength),c.main.showError(r),!1;var s=!g(t).hasClass("has_blocked"),o=g(t).attr("website");m.ajax.request({url:g.su.url("/admin/smart_network?form=patrol_owner_website_block"),data:{operation:"write",owner_id:e,blocked_status:s,website:o},success:function(e){s?(g(t).addClass("has_blocked"),c.main.showNotice(g.su.CHAR.PARENTAL_CONTROLS.BLOCKED,0)):(g(t).removeClass("has_blocked"),c.main.showNotice(g.su.CHAR.PARENTAL_CONTROLS.UNBLOCKED,0)),d.parentalCtrlsGridItemArrayV2.load()},fail:function(){c.main.showError(g.su.CHAR.PARENTAL_CONTROLS.WEBSITE_NUM_LIMIT)}})},renderHistory:function(e,c){var u=this,p=d.parentalControlsStoreV2.getModelByKey(e).ownerId.getValue();m.ajax.request({proxy:"patrolInsightsHistoryProxyV2",data:{ownerId:p},success:function(e){var r=[];for(var t=e.history,n=0,a=t.length;n<a;n++)!function d(e,t){r[e]||(r[e]={date:u.convertLocalString(t.accessTimestamp),data:[]});var n,a,i=new Date(1e3*t.accessTimestamp);u.convertLocalString(t.accessTimestamp)!=r[e].date?d(++e,t):(n=12<i.getHours()?i.getHours()-12:i.getHours(),a=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes(),i=12<i.getHours()?"PM":"AM",r[e].data.push({site:t.website,time:n+":"+a+" "+i,block:t.block}))}(0,t[n]);var i="";if(0<r.length)for(var s,o=0,a=r.length;o<a;o++){for(var i=(i=(i+='<div class="parental-ctrls-history-wrapper">')+('<div class="title"><span>'+r[o].date+"</span></div>"))+'<div class="content">'+'<div class="parental-ctrls-history-lists">',l=0;l<r[o].data.length;l++)s=r[o].data[l].block?"has_blocked":"",i=(i=(i=(i+='<div class="items'+(l==r[o].data.length-1?" last":"")+'">')+'<div class="time-wrapper"><span class="time">'+r[o].data[l].time+'</span></div><div class="point-wrapper"><span class="point"></span></div><span class="conn-line"></span>')+'<div class="website-wrapper"><span class="website">'+r[o].data[l].site+"</span></div>")+'<span class="block '+s+'" owner-id="'+p+'" website="'+r[o].data[l].site+'"></span></div>';i=(i+="</div>")+"</div>"+"</div>"}else i+='<div class="parental-ctrls-no-history"><span>'+g.su.CHAR.PARENTAL_CONTROLS.NO_HISTORY+"</span></div>";g("#parental-ctrls-insight-msg .parental-ctrls-history-content").html(i),g(".parental-ctrls-history-lists span.block").click(function(){u.block(this)}),c&&c()}})},renderTotalTime:function(e){var e=parseInt(e/1440*100),t=g("#total-spent-time").get(0),n={series:[{type:"pie",animation:!1,center:["50%","50%"],radius:[44,50],itemStyle:{normal:{label:{show:!1}}},data:[{name:"",value:e,itemStyle:{normal:{color:"#4acbd6",label:{show:!0,position:"center"},labelLine:{show:!1}},emphasis:{color:"#4acbd6"}}},{name:"",value:100-e,itemStyle:{normal:{color:"rgba(0, 0, 0, 0)",label:{show:!0},labelLine:{show:!1}},emphasis:{color:"rgba(0, 0, 0, 0)"}}}]}]},t=(echarts.init(t).setOption(n),g("#total-left-time").get(0)),n={series:[{type:"pie",animation:!1,center:["50%","50%"],radius:[45,49],itemStyle:{normal:{label:{show:!1}}},data:[{name:"",value:e,itemStyle:{normal:{color:"rgba(0, 0, 0, 0)",label:{show:!0,position:"center"},labelLine:{show:!1}},emphasis:{color:"rgba(0, 0, 0, 0)"}}},{name:"",value:100-e,itemStyle:{normal:{color:"#e8e8e8",label:{show:!0},labelLine:{show:!1}},emphasis:{color:"#e8e8e8"}}}]}]};echarts.init(t).setOption(n)},convertLocalString:function(e){var e=new Date(1e3*e),t=e.getDate(),n=e.getMonth()+1,e=e.getFullYear(),a=new Date,i=a.getDate(),r=a.getMonth()+1,a=a.getFullYear();return a===e&&r===n&&i===t?g.su.CHAR.PARENTAL_CONTROLS.TODAY:a===e&&r===n&&i-1===t?g.su.CHAR.PARENTAL_CONTROLS.YESTERDAY:[n=n<10?"0"+n:n,t=t<10?"0"+t:t,e].join("/")},updateScroll:function(){}}})}(jQuery),$.su.define("parentalControlsStoreProxyV2",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_owner_list"),api:{internetAccessChange:{writeFilter:function(e){return{operation:"write",owner_id:e.ownerId,internet_blocked:e.internetBlocked}}}}}),$.su.storeManager.define("parentalControlsStoreV2",{type:"store",fields:[{name:"ownerId",mapping:"owner_id"},{name:"name"},{name:"limit"},{name:"clientList",mapping:"client_list",defaultValue:[]},{name:"internetBlocked",mapping:"internet_blocked"},{name:"categoriesList",mapping:"categories_list",defaultValue:[]},{name:"enableWorkdayTimeLimit",mapping:"enable_workday_time_limit",defaultValue:!1},{name:"workdayDailyTime",mapping:"workday_daily_time",defaultValue:"120"},{name:"enableWeekendTimeLimit",mapping:"enable_weekend_time_limit",defaultValue:!1},{name:"weekendDailyTime",mapping:"weekend_daily_time",defaultValue:"120"},{name:"enableWorkdayBedTime",mapping:"enable_workday_bed_time",defaultValue:!1},{name:"workdayBedTimeBegin",mapping:"workday_bed_time_begin",defaultValue:"1320"},{name:"workdayBedTimeEnd",mapping:"workday_bed_time_end",defaultValue:"420"},{name:"enableWeekendBedTime",mapping:"enable_weekend_bed_time",defaultValue:!1},{name:"weekendBedTimeBegin",mapping:"weekend_bed_time_begin",defaultValue:"1320"},{name:"weekendBedTimeEnd",mapping:"weekend_bed_time_end",defaultValue:"420"},{name:"keywordFilter",mapping:"website_list",defaultValue:[]}],proxy:"parentalControlsStoreProxyV2"}),$.su.storeManager.define("parentalCtrlsGridItemArrayV2",{type:"store",fields:[{name:"ownerId",mapping:"owner_id"},{name:"categoriesList",mapping:"categories_list",defaultValue:[]},{name:"keywordFilter",mapping:"website_list",defaultValue:[]}],proxy:"parentalControlsStoreProxyV2"}),$.su.modelManager.define("parentalCtrlsEditorModelV2",{type:"model",fields:[{name:"ownerId"},{name:"name",maxLength:64,allowBlank:!1},{name:"clientList",convert:function(e){for(var t=0;t<e.length;t++)e[t].deviceId=e[t].device_id,delete e[t].device_id,e[t].ownerId=e[t].owner_id,delete e[t].owner_id,e[t].clientType=e[t].client_type,delete e[t].client_type;return e},serialize:function(e){for(var t=0;t<e.length;t++)e[t].device_id=e[t].deviceId,delete e[t].deviceId,e[t].owner_id=e[t].ownerId,delete e[t].ownerId,e[t].client_type=e[t].clientType,delete e[t].clientType;return e}},{name:"categoriesList"},{name:"enableWorkdayTimeLimit"},{name:"workdayDailyTime"},{name:"enableWeekendTimeLimit"},{name:"weekendDailyTime"},{name:"enableWorkdayBedTime"},{name:"workdayBedTimeBegin"},{name:"workdayBedTimeEnd"},{name:"enableWeekendBedTime"},{name:"weekendBedTimeBegin"},{name:"weekendBedTimeEnd"},{name:"keywordFilter"}],convert:function(e){var t=function(e){return parseInt(e/60,10)+":"+parseInt(e%60,10)};return e.workdayBedTimeBegin=t(e.workdayBedTimeBegin),e.workdayBedTimeEnd=t(e.workdayBedTimeEnd),e.weekendBedTimeBegin=t(e.weekendBedTimeBegin),e.weekendBedTimeEnd=t(e.weekendBedTimeEnd),e},serialize:function(e){var t,n=function(e){return 60*parseInt(e.split(":")[0],10)+parseInt(e.split(":")[1],10)+""},a=[];for(t in e.categoriesList)e.categoriesList[t]&&a.push(t);return e.categoriesList=a,e.workdayBedTimeBegin=n(e.workdayBedTimeBegin),e.workdayBedTimeEnd=n(e.workdayBedTimeEnd),e.weekendBedTimeBegin=n(e.weekendBedTimeBegin),e.weekendBedTimeEnd=n(e.weekendBedTimeEnd),e}}),$.su.define("parentalControlsKeywordProxyV2",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=filter_apps_list"),writeFilter:function(e){return{operation:"read"}}}),$.su.storeManager.define("keywordFilterSV2",{type:"store",fields:[{name:"name"}],proxy:"parentalControlsKeywordProxyV2"}),$.su.define("parentalControlsHistoryProxyV2",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_insights"),readFilter:function(e){return{insights:e.data.insights}},writeFilter:function(e){return{operation:"read",owner_id:e.ownerId}}}),$.su.storeManager.define("parentalCtrHistoryDayV2",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}]}),$.su.define("patrolInsightsHistoryProxyV2",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_insights_history"),readFilter:function(e){for(var t=e.data,n=0;n<t.history.length;n++)t.history[n].accessTimestamp=t.history[n].access_timestamp,delete t.history[n].access_timestamp;return t},writeFilter:function(e){return{operation:"read",owner_id:e.ownerId}}}),$.su.storeManager.define("parentalCtrlsDevicesListGridV2",{type:"store",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"enablePriority",mapping:"enable_priority"},{name:"remainTime",mapping:"remain_time"},{name:"ownerName"}]}),$.su.storeManager.define("dailyTimeLimitSV2",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}]}),$.su.define("patrolOwnerBlockProxyV2",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_owner_block")}),$.su.define("onlineDevProxyV2",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_devices")}),$.su.define("profileLimitProxyV2",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=patrol_limit"),readFilter:function(e){return{profileLength:e.data.profile_len,devicesLength:e.data.devices_len,categoryLength:e.data.category_len}}}),function(f){f.su.moduleManager.define("parentalControlsV2Optimize",{deps:["main","index"],services:["ajax","time","moduleManager"],models:["ptcrEditorModel","ptcrEnableV3","ptcrViewModel"],stores:["parentalControlsStoreV3","ptcrDayOptionsV3","ptcrOnlineDevs","ptcrOfflineDevs","ptcrSelectedDevs","dailyTimeLimitSV3","ptcrDayWeeks","websiteStore","ptcrModeOpts"],views:["parentalControlsV2OptimizeView"],listeners:{"ev_on_launch":function(e,t,n,a,i,r,s){var t=this,o=n.parentalControlsV2OptimizeView;a.ptcrEnableV3.load({success:function(e){"on"===e.enable?o.ptcrContent.show():o.ptcrContent.hide()}}),i.parentalControlsStoreV3.load({success:function(e){0<e.length?o.emptyGrid.hide():o.emptyGrid.show()}}),s.ajax.request({proxy:"profileLimitProxyV3",method:"read",ajax:{"async":!1},success:function(e){t.profileLimit.profileLength=Number(e.profileLength),t.profileLimit.devicesLength=Number(e.devicesLength),t.profileLimit.categoryLength=Number(e.categoryLength)}}),i.parentalControlsStoreV3.setMaxRules(t.profileLimit.profileLength),s.time.on("on_time_change",t.onTimeChange),s.time.on("on_hour24_change",t.onHour24Change)},"ev_before_destroy":function(e,t,n,a,i,r,s){t.destoryChart(),s.time.off("on_time_change",t.onTimeChange),s.time.off("on_hour24_change",t.onHour24Change)}},init:function(h,e,C,T,l,a){var y=e.parentalControlsV2OptimizeView;var t={"mon":f.su.CHAR.DATEPICKER.MONDAY,"tue":f.su.CHAR.DATEPICKER.TUESDAY,"wed":f.su.CHAR.DATEPICKER.WEDNESDAY,"thu":f.su.CHAR.DATEPICKER.THURSDAY,"fri":f.su.CHAR.DATEPICKER.FRIDAY,"sat":f.su.CHAR.DATEPICKER.SATURDAY,"sun":f.su.CHAR.DATEPICKER.SUNDAY};this.configViews({id:"parentalControlsV2OptimizeView",items:[{id:"ptcr-grid",configs:{popEditor:{addTitle:f.su.CHAR.PARENTAL_CONTROLS.ADD_PROFILE,editTitle:f.su.CHAR.PTCR_V2.EDIT_PROFILE,content:"#ptcr-grid-editor-v2",customBtns:"#parental-ctrls-add-btns",msg:{}},paging:{items:[{name:"8",value:8,selected:!0}]},columns:[{text:f.su.CHAR.PARENTAL_CONTROLS.PROFILE_NAME,dataIndex:"name",width:100},{text:f.su.CHAR.PTCR_V2.ONLINE_LIMIT,width:150,renderer:function(e,t){var n=a.time.getTime().getDay(),n=1<=n&&n<=5?t.enableWorkdayTimeLimit?t.workdayDailyTime:-1:t.enableWeekendTimeLimit?t.weekendDailyTime:-1,t=t.onlineTotal;return(0<t?h.min2TimeText(t):0)+" / "+(0<n?h.min2TimeText(n):"--")}},{dataIndex:"internetBlocked",text:f.su.CHAR.PARENTAL_CONTROLS.INTERNET_ACCESS,width:140,renderer:function(e,t){return!0===e?f.su.CHAR.PTCR_V2.ACCESS_DENY:f.su.CHAR.PTCR_V2.ACCESS_ALLOW}},{xtype:"actioncolumn",text:f.su.CHAR.PTCR_V2.ACTION,dataIndex:"internetBlocked",width:200,renderer:function(e,t){var n="<span class='seperator'>|</span>",a="";return(a+='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-internet-access btn-internet-access '+(!0===e?"off":"on")+'">')+('<span class="icon" data-tip=\''+(!0===e?f.su.CHAR.PTCR_V2.ALLOW:f.su.CHAR.PTCR_V2.BLOCK)+"'></span>")+'<span class="text"></span>'+"</a>"+n+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit">'+('<span class="icon" data-tip="'+f.su.CHAR.PTCR_V2.EDIT+'"></span>')+'<span class="text"></span>'+"</a>"+n+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-insight btn-insight">'+('<span class="icon" data-tip="'+f.su.CHAR.PTCR_V2.VIEW+'"></span>')+'<span class="text"></span>'+"</a>"+n+'<a href="javascript:void(0)" class="grid-content-btn grid-content-custom-btn-delete btn-delete">'+('<span class="icon" data-tip="'+f.su.CHAR.OPERATION.DELETE+'"></span>')+'<span class="text"></span>'+"</a>"}}]}},{id:"parental-ctrls-insight-tabs",fields:[{text:f.su.CHAR.PTCR_V2.TIME_TAB,name:"time-chart",container:"time-chart"},{text:f.su.CHAR.PTCR_V2.WEB_TAB,name:"website-list",container:"website-list"}]},{id:"ptcr-edit-tabs",fields:[{text:f.su.CHAR.PTCR_V2.BASIC_INFO,name:"basic-info",container:"basic-info"},{text:f.su.CHAR.PTCR_V2.FILTER_CONTENT,name:"filter-level",container:"filter-level"},{text:f.su.CHAR.PTCR_V2.TIME_CONTROL,name:"time-controls",container:"time-controls"}]},{id:"ptcr-online-devices",configs:[{type:"deviceType",dataIndex:"clientType",renderer:function(e){return"<span class='device-icon "+f.su.escapeHtml(e.toLowerCase())+"'></span>"}},{type:"deviceName",dataIndex:"name",renderer:function(e,t){t=t.ownerName;return'<span class="single-line">'+f.su.escapeHtml(e)+'</span><span class="single-line'+(0<t.length?" tag":"")+'">'+f.su.escapeHtml(t)+"</span>"}},{type:"mac",dataIndex:"mac"}]},{id:"ptcr-offline-devices",configs:[{type:"deviceType",dataIndex:"clientType",renderer:function(e){return"<span class='device-icon "+f.su.escapeHtml(e.toLowerCase())+"'></span>"}},{type:"deviceName",dataIndex:"name",renderer:function(e,t){t=t.ownerName;return'<span class="single-line">'+f.su.escapeHtml(e)+'</span><span class="single-line'+(0<t.length?" tag":"")+'">'+f.su.escapeHtml(t)+"</span>"}},{type:"mac",dataIndex:"mac"}]},{id:"ptcr-selected-devices",itemRender:function(e,t){return'<div class="device-wrap">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="del-icon" data-mac="%MAC%"></span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="name-tag-group">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="name single-line">%NAME%</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="%TAG% single-line">%PROFILE%</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="mac">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t%MAC%</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="device-icon %TYPE%">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>'.replace(/\%MAC\%/g,f.su.escapeHtml(t.mac)).replace(/\%NAME\%/g,f.su.escapeHtml(t.name)).replace(/\%TYPE\%/g,f.su.escapeHtml(t.clientType)).replace(/\%PROFILE\%/g,f.su.escapeHtml(t.ownerName)).replace(/\%TAG\%/g,0<t.ownerName.length?"tag":"")}},{id:"insight-website-list",itemRender:function(e,t){return"<div class='website-item'>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class='spent'>%TIME</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class='url single-line'>%URL</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class='block-container'>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class='%EXTRACLASSblock-icon' data-url='%URL' data-tip='%HINT' data-pointer='left'>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>".replace(/\%URL/g,f.su.escapeHtml(t.website)).replace(/\%TIME/,f.su.escapeHtml(t.duration)).replace(/\%HINT/g,t.block?f.su.CHAR.PTCR_V2.BLOCKED:f.su.CHAR.PTCR_V2.BLOCK).replace(/\%EXTRACLASS/g,t.block?"disabled ":"")}},{id:"ptcr-dev-list",renderer:function(e){var t="";return(t+='<span class="icon device-type '+f.su.escapeHtml(e.clientType)+'"></span>')+('<span class="text single-line">'+f.su.escapeHtml(e.name)+"</span>")}},{id:"black-url-list",renderer:function(e){return'<span class="text single-line">'+f.su.escapeHtml(e)+"</span>"}},{id:"white-url-list",renderer:function(e){return'<span class="text single-line">'+f.su.escapeHtml(e)+"</span>"}},{id:"ptcr-time-list",renderer:function(e){return'<span class="week">'+t[e.whichDay]+'</span><span class="hour">'+h.hourFormatter(e.range[0])+" - "+h.hourFormatter(e.range[1])+"</span>"}},{id:"weekend-slider",configs:{convertValue:function(e){return h.min2TimeText(e)}},anchors:[30]},{id:"weekday-slider",configs:{convertValue:function(e){return h.min2TimeText(e)}},anchors:[30]}]}),this.listen({"models.ptcrEnableV3.enable":{"ev_value_change":function(e,t,n){"on"===t?y.ptcrContent.show():y.ptcrContent.hide()}},"stores.parentalControlsStoreV3":{"ev_loaded":function(){0<T.parentalControlsStoreV3.getSize()?y.emptyGrid.hide():y.emptyGrid.show()},"ev_before_sync":function(e,t){t.preventDefault(),T.parentalControlsStoreV3.sync({success:function(e){T.parentalControlsStoreV3.loadData(e,!0)}})}},"views.parentalControlsV2OptimizeView.ptcrDayOrWeek":{"ev_value_change":function(e,t,n){"day"===t?(y.parentalCtrlDaySlt.setValue(0),y.parentalCtrlDaySlt.show(),y.dayReportXLabel.show()):(y.dayReportXLabel.hide(),h.renderWeeklyChart(),(t=h.getInsightsData()).dayIndex=-1,h.renderHistoryCollection(t.weekSummary.websites,t.webType),y.parentalCtrlDaySlt.hide())}},"views.parentalControlsV2OptimizeView.parentalCtrlDaySlt":{"ev_value_change":function(e,t,n){var a=h.getInsightsData(),i=a.data[t];a.dayIndex=t,i&&(t=0<i.time_limit?h.min2TimeText(i.time_limit):null,h.renderDailyChart(i.spend_online,i.per_hour,t),h.renderHistoryCollection(i.website_list,a.webType))}},"models.ptcrEditorModel.name":{"ev_value_change":function(e,t){h.changeBtnStatus()}},"models.ptcrEditorModel.clientList":{"ev_value_change":function(e,t,n){h.changeBtnStatus()}},"models.ptcrEditorModel.websiteType":{"ev_value_change":function(e,t,n){var a=C.ptcrEditorModel,i=a.whiteList,a=a.blackList,r=y.webListNote;"black"==t?(i.hide(),a.show(),r.setField("TITLE",f.su.CHAR.PTCR_V2.BLACK_LIST),r.setField("TIP",f.su.CHAR.PTCR_V2.BLACK_TIPS)):(i.show(),a.hide(),r.setField("TITLE",f.su.CHAR.PTCR_V2.WHITE_LIST),r.setField("TIP",f.su.CHAR.PTCR_V2.WHITE_TIPS))}},"models.ptcrEditorModel.enableWeekendTimeLimit":{"ev_value_change":function(e,t,n){var a=C.ptcrEditorModel.weekendDailyTime,i=y.disableWeekendNote;t?(a.show(),i.hide()):(a.hide(),i.show())}},"models.ptcrEditorModel.enableWorkdayTimeLimit":{"ev_value_change":function(e,t,n){var a=C.ptcrEditorModel.workdayDailyTime,i=y.disableWeekdayNote;t?(a.show(),i.hide()):(a.hide(),i.show())}}}),this.control({"#parental-enable":{"ev_view_change":function(){C.ptcrEnableV3.submit()}},"#system-time-settings":{"ev_button_click":function(){a.moduleManager.get("navigatorController").goTo("timeSettings")}},"#ptcr-website-type":{"ev_view_change":function(e,t){var n,a;"value"===t.type&&(t=t.value,n=(a=C.ptcrEditorModel).whiteList,a=a.blackList,C.ptcrViewModel.url.reset(),("black"==t?n:a).reset())}},"#ptcr-grid => a.btn-insight":{"ev_grid_action_click":function(e,t){f.when(h.fetchInsightsData(t),h.initBarChart()).then(function(){y.parentalCtrlsInsightSwitch.itemClick("time-chart"),T.ptcrDayOptionsV3.loadData(h.refreshDAYS().reverse()),y.ptcrDayOrWeek.setValue("day"),y.parentalCtrlsInsightMsg.show()})}},"#insight-website-list => .block-icon":{"click":function(e){var t,n,a=f(e.target||e.currentTarget);a.hasClass("disabled")||(e=(t=h.getInsightsData()).storeKey,T.parentalControlsStoreV3.getModelByKey(e).blackList.getValue().length>=h.profileLimit.categoryLength?l.main.showError(f.su.CHAR.PARENTAL_CONTROLS.DEV_CATEGORY_LIMIT.replace("%1$d",h.profileLimit.categoryLength)):(n=a.attr("data-url"),e="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2.ADD_BLACK+"</h3>",e=(e+="<p>"+h.replaceCharStr(f.su.CHAR.PTCR_V2.ADD_BLACK_MSG,"%NAME",t.profileName)+"</p>")+"<p>"+f.su.escapeHtml(n)+"</p>",l.main.confirm(e,function(){h.changWebBlockStatus(t.ownerId,n,!0,function(){h.setInsightBlock(n),a.addClass("disabled").attr("data-tip",f.su.CHAR.PTCR_V2.BLOCKED),T.parentalControlsStoreV3.load()})},null,f.su.CHAR.PTCR_V2.ADD,null)))}},"#show-more":{"ev_button_click":function(){var e,t=h.getInsightsData(),n=t.loadedNum,a=null,a=0<=t.dayIndex?t.data[t.dayIndex].website_list:t.weekSummary.websites;t.loadedNum>=a.length||(n=Math.min(n+5,a.length),e=f(".website-list-wrap").get(0).scrollHeight,T.websiteStore.loadData(a.slice(0,n),!0),t.loadedNum=n,t.loadedNum>=a.length&&y.showMoreBtn.hide(),setTimeout(function(){f(".website-list-wrap").animate({scrollTop:e},1e3)},100))}},"#ptcr-online-devices":{"ev_item_select":function(e,t){h.respondSelDev(t,!0)},"ev_item_deselect":function(e,t){h.respondDeselDev(t)}},"#ptcr-offline-devices":{"ev_item_select":function(e,t){h.respondSelDev(t,!1)},"ev_item_deselect":function(e,t){h.respondDeselDev(t)}},"#ptcr-selected-devices => .del-icon":{"click":function(e){e=f(e.target||e.currentTarget).attr("data-mac");(T.ptcrSelectedDevs.getModelByKey(e).online.getValue()?T.ptcrOnlineDevs:T.ptcrOfflineDevs).unselectItems(e),h.respondDeselDev(e)}},"#url-input":{"ev_input_enter":function(){f("#url-input-btn a.button-button").click()}},"#url-input-btn":{"ev_button_click":function(){var e,t,n,a=C.ptcrViewModel.url,i=a.getValue();i&&a.validate()&&(t=(e="black"==(e=C.ptcrEditorModel).websiteType.getValue()?e.blackList:e.whiteList).getValue(),!0!==(n=h.validateKeyWeb(i,t))?a.setError(n):(e.setValue(t.concat(i)),a.reset()))}},"#ptcr-grid => a.btn-internet-access":{"ev_grid_action_click":function(e,t){var t=T.parentalControlsStoreV3.getModelByKey(t),n=t.ownerId.getValue(),a=t.internetBlocked.getValue(),t=t.name.getValue(),i="",r="",r=a?(i=(i+="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2.ALLOW_TITLE+"</h3>")+"<p>"+h.replaceCharStr(f.su.CHAR.PTCR_V2.ALLOW_MSG,"%name",t)+"</p>",f.su.CHAR.PTCR_V2.ALLOW):(i=(i+="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2.BLOCK_TITLE+"</h3>")+"<p>"+h.replaceCharStr(f.su.CHAR.PTCR_V2.BLOCK_MSG,"%name",t)+"</p>",f.su.CHAR.PTCR_V2.BLOCK);l.main.confirm(i,function(){h.toggleProfileStatus(n,!a)},null,r,f.su.CHAR.OPERATION.CANCEL)}},"#ptcr-grid":{"ev_grid_edit":function(e,t){"add"===t?(y.parentalCtrlsEditSwitch.setSupportViewSwitch(!1),y.parentalCtrlsAddBtnsLeft.setText(f.su.CHAR.PARENTAL_CONTROLS.CANCEL),y.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PARENTAL_CONTROLS.NEXT),T.parentalControlsStoreV3.getPlugin("editor").hideBtns(),y.parentalCtrlsAddBtns.show(),y.parentalCtrlsAddBtnsRight.disable()):(y.parentalCtrlsEditSwitch.setSupportViewSwitch(!0),T.parentalControlsStoreV3.getPlugin("editor").showBtns(),y.parentalCtrlsAddBtns.hide(),y.parentalCtrlsEditSwitch.show()),y.parentalCtrlsEditSwitch.switchField("basic-info")},"ev_grid_before_save":function(e,t){return!C.ptcrEditorModel.ownerId.getValue()||h.validateBeforeEditSave(t)},"ev_grid_save":function(){h.clearConfirm()}},"#ptcr-grid => a.btn-delete":{"ev_grid_action_click":function(e,t){var n=T.parentalControlsStoreV3.getModelByKey(t).name.getValue(),n=h.replaceCharStr(f.su.CHAR.PTCR_V2.DEL_CONFIRM,"%name",n);l.main.confirm(n,function(){h.deleteProfile(t)},null,f.su.CHAR.OPERATION.DELETE,f.su.CHAR.OPERATION.CANCEL)}},"#ptcr-dev-list":{"ev_add_item":function(e){a.ajax.request({proxy:"onlineDevProxyV3",method:"load",success:function(e){for(var t=T.parentalControlsStoreV3.getData(),n={},a=e.length,i=C.ptcrEditorModel,r=i.ownerId.getValue(),s=0;s<t.length;s++)r!==t[s].ownerId&&(n[t[s].ownerId]=t[s].name);for(var o=0;o<a;o++)n[e[o].owner_id]?e[o]["ownerName"]=n[e[o].owner_id]:e[o]["ownerName"]="";for(var l,d=i.clientList.getValue(),c=[],u=[],p=[],m=0,g=d.length;m<g;m++)l=d[m],c.push(l.mac),n[l.ownerId]?l["ownerName"]=n[l.ownerId]:l["ownerName"]="";for(var f,_=0,v=[],w=[];_<a;_++)"1"==(f=e[_]).online?(v.push(f),0<=c.indexOf(f.mac)&&u.push(f.mac)):(w.push(f),0<=c.indexOf(f.mac)&&p.push(f.mac));T.ptcrOnlineDevs.loadData(v,!0),T.ptcrOfflineDevs.loadData(w,!0),T.ptcrSelectedDevs.loadData(d),T.ptcrOnlineDevs.selectItems(u),T.ptcrOfflineDevs.selectItems(p),h.visibleNoSelDevNote(),y.parentalCtrlsAddDevicesMsg.show()}})}},"#ptcr-time-list":{"ev_add_item":function(){for(var e,t=C.ptcrEditorModel.timeTable.getValue(),n=0,a=t.length,i={};n<a;n++)i[(e=t[n]).whichDay]||(i[e.whichDay]=[]),i[e.whichDay].push(e.range);var i=JSON.stringify(i),r=C.ptcrViewModel.timeTable;r.setValue(i),r.setSnapshot(i),y.ptcrTimeTableMsg.show()}},"#ptcr-add-dev-msg":{"ev_msg_ok":function(e,t){t.preventDefault();var n=T.ptcrSelectedDevs,a=n.getSize();if(a>h.profileLimit.devicesLength)r=f.su.CHAR.PARENTAL_CONTROLS.DEV_CATEGORY_LIMIT.replace("%1$d",h.profileLimit.devicesLength),l.main.showError(r),t.preventDefault();else{for(var i,r,s=0,o="";s<a;s++)""!==(i=n.getModelByIndex(s)).ownerName.getValue()&&(o+="<p>"+f.su.escapeHtml(i.mac.getValue())+" ,"+f.su.escapeHtml(i.name.getValue())+"</p>");0==o.length?h.saveMsgSelDev():(r=C.ptcrEditorModel.name.getValue(),t="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2.MOVE_DEVS+"</h3>",t+="<p>"+(r?h.replaceCharStr(f.su.CHAR.PTCR_V2.MOVE_DEVS_TIP1,"%name",r):f.su.CHAR.PTCR_V2.MOVE_DEVS_TIP2)+"</p>",l.main.confirm(t="<div class='move-msg-content'>"+(t+=o)+"</div>",h.saveMsgSelDev,null,f.su.CHAR.PTCR_V2.CONTINUE))}}},"#ptcr-time-table-msg":{"ev_msg_ok":function(){var e=C.ptcrViewModel.timeTable.getValue(),e=function(e){var t,n=[];for(t in e)for(var a=0,i=(dayRanges=e[t]).length;a<i;a++)n.push({whichDay:t,range:dayRanges[a]});return n}(JSON.parse(e));C.ptcrEditorModel.timeTable.setValue(e)}},"#parental-ctrls-add-btns-left":{"ev_button_click":function(){var e=y.parentalCtrlsEditSwitch,t=e.getCurField(),n=T.parentalControlsStoreV3.getPlugin("editor");"basic-info"==t?(n.getMsgBox().close(),n.cancelEdit()):("filter-level"==t?y.parentalCtrlsAddBtnsLeft.setText(f.su.CHAR.PARENTAL_CONTROLS.CANCEL):y.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PARENTAL_CONTROLS.NEXT),e.switchPrev())}},"#parental-ctrls-add-btns-right":{"ev_button_click":function(){var e=y.parentalCtrlsEditSwitch,t=e.getCurField(),n=T.parentalControlsStoreV3.getPlugin("editor"),a=C.ptcrEditorModel;if("basic-info"==t)y.parentalCtrlsAddBtnsLeft.setText(f.su.CHAR.PARENTAL_CONTROLS.BACK),e.switchNext();else if("filter-level"==t){var t=a.websiteType.getValue(),i=a.whiteList.getValue();"white"!=t||i&&0<i.length?(y.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PARENTAL_CONTROLS.SAVE),e.switchNext()):(r="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2.WHITE_EMPTY_TITLE+"</h3>",r+="<p>"+f.su.CHAR.PTCR_V2.WHITE_EMPTY_NOTE+"</p>",l.main.confirm(r,function(){y.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PARENTAL_CONTROLS.SAVE),e.switchNext()},null,f.su.CHAR.PTCR_V2.CONTINUE,f.su.CHAR.OPERATION.CANCEL))}else{var r,t=a.timeTable.getValue(),s=n.getSaveBtn().dom();if(!(t&&0<t.length))return r="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2.NO_TIME_TABLE+"</h3>",r+="<p>"+f.su.CHAR.PTCR_V2.NO_TIME_TABLE_TIP+"</p>",l.main.confirm(r,function(){h.pushConfirm("timetable"),s.triggerHandler("ev_button_click")},h.clearConfirm,f.su.CHAR.PTCR_V2.CONTINUE,f.su.CHAR.OPERATION.CANCEL),!1;s.triggerHandler("ev_button_click")}}}})}},function(c,e,o,u,l,i){var d,c=this,p=e.parentalControlsV2OptimizeView,a=[],m=[],n={1:"JAN",2:"FEB",3:"MAR",4:"APR",5:"MAY",6:"JUN",7:"JUL",8:"AUG",9:"SEP",10:"OCT",11:"NOV",12:"DEC"},g=[],r=function(e){var t=e%12;return(0==t?12:t)+(1<=e/12&&e/12<2?" PM":" AM")},s=function(e){var t=e.toString();return(1===t.length?"0"+e:t)+":00"};return{profileLimit:{profileLength:16,devicesLength:16,categoryLength:32},onTimeChange:function(e,t){var n=i.time.getHour24(),t=i.time.format(t,"yyyy-MM-dd HH:mm:ss",n);p.currentTime.setValue(t)},onHour24Change:function(e,t){c.hourFormatter=t?s:r,o.ptcrViewModel.timeTable.setIs24(t)},replaceCharStr:function(e,t,n){return e.replace(t,f.su.escapeHtml(n))},hourFormatter:r,clearConfirm:function(){g=[]},pushConfirm:function(e){g.push(e)},validateBeforeEditSave:function(e){var t,n=o.ptcrEditorModel,a=n.websiteType.getValue(),i=n.whiteList.getValue(),n=n.timeTable.getValue(),r=u.parentalControlsStoreV3.getPlugin("editor").getSaveBtn().dom(),a=g.indexOf("white")<0&&"white"==a&&!(i&&0<i.length),i=g.indexOf("timetable")<0&&!(n&&0<n.length),s=a&&i;return a?(t="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2.WHITE_EMPTY_TITLE+"</h3>",t+="<p>"+f.su.CHAR.PTCR_V2.WHITE_EMPTY_NOTE+"</p>",l.main.confirm(t,function(e){c.pushConfirm("white"),s&&e.preventDefault(),setTimeout(function(){r.triggerHandler("ev_button_click")},50)},c.clearConfirm,f.su.CHAR.PTCR_V2.CONTINUE,f.su.CHAR.OPERATION.CANCEL),e.preventDefault(),!1):!i||(t="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2.NO_TIME_TABLE+"</h3>",t+="<p>"+f.su.CHAR.PTCR_V2.NO_TIME_TABLE_TIP+"</p>",l.main.confirm(t,function(){c.pushConfirm("timetable"),setTimeout(function(){r.triggerHandler("ev_button_click")},50)},c.clearConfirm,f.su.CHAR.PTCR_V2.CONTINUE,f.su.CHAR.OPERATION.CANCEL),e.preventDefault(),!1)},getEcharts:function(){var e=f.Deferred();return window.echarts===undefined?f.su.router.loadFile("js/libs/echarts.min.js",function(){e.resolve(window.echarts)}):window.echarts&&e.resolve(window.echarts),e.promise()},initBarChart:function(){var e=p.dayReportXLabel;return e.setField("FIRST",c.hourFormatter(0)),e.setField("SECOND",c.hourFormatter(6)),e.setField("THIRD",c.hourFormatter(12)),e.setField("FOURTH",c.hourFormatter(18)),c.getEcharts().then(function(e){return d||(d=e.init(f("#ptcr-bar-chart").get(0))).setOption({color:["rgba(80,204,215,0.30)"],grid:{show:!0,borderColor:"#BEBEBE",borderWidth:.5,top:30,left:0,right:5,bottom:0,containLabel:!0},xAxis:[{type:"category",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{color:"#A7A9AC"},splitLine:{show:!0,lineStyle:{type:"dotted"}}}],yAxis:[{type:"value",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{color:"#A7A9AC"}}],series:[{type:"bar",barWidth:"60%",silent:!0}]}),d})},destoryChart:function(){d&&d.clear()},respondSelDev:function(e,t){var n=u.ptcrSelectedDevs,t=(t?u.ptcrOnlineDevs:u.ptcrOfflineDevs).getModelByKey(e).getData(),e=n.getData();n.loadData(e.concat(t)),c.visibleNoSelDevNote()},respondDeselDev:function(e){u.ptcrSelectedDevs.removeDataByKey(e),c.visibleNoSelDevNote()},visibleNoSelDevNote:function(){0<u.ptcrSelectedDevs.getSize()?p.noSelDevNote.hide():p.noSelDevNote.show()},saveMsgSelDev:function(){o.ptcrEditorModel.clientList.setValue(u.ptcrSelectedDevs.getData("submit")),p.parentalCtrlsAddDevicesMsg.close()},validateKeyWeb:function(e,t){var n=c.profileLimit.categoryLength;if(t.length>=n)return f.su.CHAR.PTCR_V2.DEV_CATEGORY_LIMIT.replace("%1$d",n);for(var a=-1,i=0;i<t.length;i++)if(t[i]==e){a=i;break}return!(0<=a)||f.su.CHAR.PTCR_V2.KEYWORD_EXIST},deleteProfile:function(e){u.parentalControlsStoreV3.load({data:{operation:"remove",key:e},success:function(){u.parentalControlsStoreV3.load(),l.main.showNotice(f.su.CHAR.COMMON.SAVED)}})},toggleProfileStatus:function(e,t){i.ajax.request({proxy:"patrolOwnerBlockProxyV3",method:"write",data:{owner_id:e,internet_blocked:t},success:function(){u.parentalControlsStoreV3.load()}})},changWebBlockStatus:function(e,t,n,a){i.ajax.request({url:f.su.url("/admin/smart_network?form=patrol_owner_website_block"),data:{operation:"write",owner_id:e,blocked_status:n,website:t},success:function(e){a&&a(e)}})},setInsightBlock:function(e){for(var t,n,a,i=m.data,r=i.length;r--;)if(a=i[r].website_list,f.isArray(a))for(t=a.length;t--;)(n=a[t]).website===e&&(n.block=!0);for(t=(i=m.weekSummary.websites).length;t--;)(n=i[t]).website===e&&(n.block=!0)},getInsightsData:function(){return m},fetchInsightsData:function(s){var o=f.Deferred(),l=u.parentalControlsStoreV3.getModelByKey(s),d=l.ownerId.getValue();return i.ajax.request({proxy:"ptcrInsightProxyV3",data:{ownerId:d},success:function(e){for(var t=e,n=t.length,a=null;n--;){f.isArray(t[n].website_list)||(t[n].website_list=[]);for(var i,r=(a=t[n].website_list).length;r--;)(i=a[r].website)&&0!=i.length||a.splice(r,1)}m={ownerId:d,profileName:l.name.getValue(),storeKey:s,dayIndex:0,loadedNum:0,webType:l.websiteType.getValue(),data:t,weekSummary:c.calculateSummary(t)},o.resolve(m)},fail:o.reject,error:o.reject}),o},getDAYS:function(){return a},refreshDAYS:function(){a=[];for(var e,t=0,n=i.time.getTime().getTime();t<7;t++)e=new Date(n-864e5*t),a.push({value:t,name:c.convertLocalString(e),day:e.getDay()});return a[0].name=f.su.CHAR.DATE.TODAY,a[1].name=f.su.CHAR.DATE.YESTERDAY,a},convertLocalString:function(e){var t=e.getDate(),e=e.getMonth()+1;return f.su.CHAR.DATEPICKER[n[e]]+" "+t},changeBtnStatus:function(){var e=o.ptcrEditorModel,t=e.ownerId.getValue(),n=e.name.getValue(),e=e.clientList.getValue(),n=n&&n.length||0,n=0<n&&n<=64&&e&&0<e.length,e=u.parentalControlsStoreV3.getPlugin("editor").getSaveBtn();null==t&&(e=p.parentalCtrlsAddBtnsRight),n?e.enable():e.disable()},min2TimeText:function(e){var t;return e<60?e+f.su.CHAR.PTCR_V2.MINS:(t=e%60,parseInt(e/60,10)+f.su.CHAR.PTCR_V2.HOUR+(t?" "+t+f.su.CHAR.PTCR_V2.MINS:""))},calculateSummary:function(e){for(var t,n,a,i=0,r=[],s={},o=[],l=0,d=e.length;l<d;l++)if(t=e[l],i+=n=parseInt(t.spend_online),r.push(n),f.isArray(t.website_list))for(var c,u=t.website_list.length;u--;)(c=t.website_list[u]).spend_online=Number(c.spend_online),s[c.website]?s[c.website].spend_online+=c.spend_online:(c.spend_online=c.spend_online,s[c.website]=f.extend({},c));for(a in s)o.push(s[a]);delete s;for(var p=20;p--;)for(var m,g=o.length;0<--g;)o[g].spend_online>o[g-1].spend_online&&(m=o[g-1],o[g-1]=o[g],o[g]=m);return{total:i,perDay:r.reverse(),websites:o.slice(0,20)}},renderDailyChart:function(e,t,n){p.dayTotal.setField("TIME_ONLINE",c.min2TimeText(e)),n?(p.dayLimit.setField("TIME_LIMIT",n),p.dayLimit.show()):p.dayLimit.hide(),p.dayTotal.show();for(var a=[],i=0;i<24;i++)a.push(i);d.setOption({series:[{data:t}],yAxis:[{max:60,interval:30,axisLabel:{formatter:function(e){return 0===e?"":e+("s"==f.su.widgetSize?f.su.CHAR.PTCR_V2.MINS_SHORT:f.su.CHAR.PTCR_V2.MINS)}},splitLine:{show:!1},splitArea:{show:!0,areaStyle:{color:["rgba(255,255,255,0)","rgba(239,239,239,0.78)"]}}}],xAxis:[{data:a,axisLabel:{show:!1},splitLine:{interval:function(e){return 0!==e&&24!==e&&e%6==0}}}]})},renderHistoryCollection:function(e,t){var n=0,a=[];0===e.length?p.noWebsiteNote.show():(n=(a=e.slice(0,10)).length,m.loadedNum=n,p.noWebsiteNote.hide()),u.websiteStore.loadData(a,!0),u.websiteStore.removeClass("white black").addClass(t),n<e.length?p.showMoreBtn.show():p.showMoreBtn.hide()},renderWeeklyChart:function(){var e=c.getInsightsData().weekSummary.perDay;p.dayLimit.hide(),p.dayTotal.hide();for(var t=e[(s=e.length)-1],n=s-1;n--;)e[n]>t&&(t=e[n]);for(var a=2*Math.ceil(t/60/2)*60,a=Math.max(a,240),i=[],r=c.getDAYS(),s=r.length,o=0;o<s;o++)i.push(r[o].name);d.setOption({series:[{data:e}],yAxis:[{max:a,interval:a/2,axisLabel:{show:!0,formatter:function(e){return 0===e?"":e/60+f.su.CHAR.PTCR_V2.HOUR}}}],xAxis:[{data:i,axisLabel:{show:!0},splitLine:{interval:function(e){return 0!==e&&7!==e}}}]})}}})}(jQuery),function(o){var l=["sun","mon","tue","wed","thu","fri","sat"];function s(e){for(var t,n,a=0,i=[],r=0,s=(e=o.isArray(e)?e:[]).length;r<s;r++){for(t=e[r][0],n=e[r][1];a<t;)i[a]=0,a++;for(;a<n;)i[a]=1,a++}for(;a<24;)i[a]=0,a++;return i}function d(e){for(var t,n={},a=0,i=l.length;a<i;a++)n[t=l[a]]=function(e){var t,n=[],a=-1;if(e&&24==e.length){for(var i=0,r=!1;i<24;i++)r||1!=e[i]?r&&0==e[i]&&(t=i,n.push([a,t]),r=!1):(r=!0,a=i);r&&n.push([a,24])}return n}(e[t+"_time"]);return n}o.su.define("ptcrStoreProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_owner_list")}),o.su.modelManager.define("ptcrEnableV3",{fields:[{name:"enable"}],proxy:{url:o.su.url("/admin/smart_network?form=patrol_enable")}}),o.su.storeManager.define("parentalControlsStoreV3",{type:"store",fields:[{name:"ownerId",mapping:"owner_id"},{name:"name"},{name:"clientList",mapping:"client_list",defaultValue:[],convert:function(e){return e=o.isArray(e)?e:[]}},{name:"internetBlocked",mapping:"internet_blocked"},{name:"whiteList",mapping:"white_website_list",defaultValue:[],convert:function(e){return e=o.isArray(e)?e:[]}},{name:"blackList",mapping:"black_website_list",defaultValue:[],convert:function(e){return e=o.isArray(e)?e:[]}},{name:"websiteType",mapping:"website_type",defaultValue:"black"},{name:"enableWorkdayTimeLimit",mapping:"enable_workday_time_limit",defaultValue:!1},{name:"workdayDailyTime",mapping:"workday_daily_time",defaultValue:"30"},{name:"enableWeekendTimeLimit",mapping:"enable_weekend_time_limit",defaultValue:!1},{name:"weekendDailyTime",mapping:"weekend_daily_time",defaultValue:"30"},{name:"onlineTotal",mapping:"online_total"},{name:"mon_time"},{name:"tue_time"},{name:"wed_time"},{name:"thu_time"},{name:"fri_time"},{name:"sat_time"},{name:"sun_time"}],convert:function(e){return(e=o.isArray(e)?e:[]).reverse()},proxy:"ptcrStoreProxyV3"}),o.su.storeManager.define("websiteStore",{type:"store",keyProperty:"website",fields:[{name:"duration",mapping:"spend_online",convert:function(e){var t;return e<60?e+o.su.CHAR.PTCR_V2.MINS:(t=e%60,parseInt(e/60,10)+o.su.CHAR.PTCR_V2.HOUR+(t?" "+t+o.su.CHAR.PTCR_V2.MINS:""))}},{name:"block"}]}),o.su.modelManager.define("ptcrEditorModel",{type:"model",fields:[{name:"ownerId"},{name:"name",maxLength:64,allowBlank:!1},{name:"clientList",convert:function(e){for(var t=0;t<e.length;t++)e[t].deviceId=e[t].device_id,delete e[t].device_id,e[t].ownerId=e[t].owner_id,delete e[t].owner_id,e[t].clientType=e[t].client_type,delete e[t].client_type;return e},serialize:function(e){for(var t=0;t<e.length;t++)e[t].device_id=e[t].deviceId,delete e[t].deviceId,e[t].owner_id=e[t].ownerId,delete e[t].ownerId,e[t].client_type=e[t].clientType,delete e[t].clientType;return e}},{name:"whiteList"},{name:"blackList"},{name:"websiteType"},{name:"enableWorkdayTimeLimit"},{name:"workdayDailyTime"},{name:"enableWeekendTimeLimit"},{name:"weekendDailyTime"},{name:"timeTable"}],convert:function(e){for(var t=d(e),n=0,a=[];n<7;n++)for(var i,r,s=0,o=(r=t[i=l[n]]).length;s<o;s++)a.push({whichDay:i,range:r[s]});return e.timeTable=a,e},serialize:function(e){for(var t,n=e.timeTable,a={},i=0,r=n.length;i<r;i++)a[(t=n[i]).whichDay]?a[t.whichDay].push(t.range):a[t.whichDay]=[t.range];return e.mon_time=s(a.mon),e.tue_time=s(a.tue),e.wed_time=s(a.wed),e.thu_time=s(a.thu),e.fri_time=s(a.fri),e.sat_time=s(a.sat),e.sun_time=s(a.sun),delete e.timeTable,e}}),o.su.storeManager.define("ptcrModeOpts",{type:"store",fields:[{name:"value"},{name:"boxlabel"}],data:[{value:"black",boxlabel:o.su.CHAR.PTCR_V2.BLACK_LIST},{value:"white",boxlabel:o.su.CHAR.PTCR_V2.WHITE_LIST}]}),o.su.define("ptcrInsightProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_insights"),readFilter:function(e){return e.data.insights},writeFilter:function(e){return{operation:"read",owner_id:e.ownerId}}}),o.su.storeManager.define("ptcrDayOptionsV3",{type:"store",fields:[{name:"name"},{name:"value"}]}),o.su.modelManager.define("ptcrViewModel",{fields:[{name:"url",maxLength:64,allowBlank:!0,vtype:"string_visible_no_comma"},{name:"timeTable"}]}),o.su.storeManager.define("ptcrOnlineDevs",{type:"store",keyProperty:"mac",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"online",convert:function(e){return"1"==e}},{name:"ownerName"}],convert:function(e){return e.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),e}}),o.su.storeManager.define("ptcrOfflineDevs",{type:"store",keyProperty:"mac",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"online",convert:function(e){return"1"==e}},{name:"ownerName"}],convert:function(e){return e.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),e}}),o.su.storeManager.define("ptcrSelectedDevs",{type:"store",keyProperty:"mac",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"online",convert:function(e){return"1"==e}},{name:"ownerName"}]}),o.su.storeManager.define("dailyTimeLimitSV3",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}]}),o.su.storeManager.define("ptcrDayWeeks",{type:"store",fields:[{name:"name"},{name:"value"},{name:"selected"},{name:"boxlabel"}],data:[{name:o.su.CHAR.PTCR_V2.PER_DAY,value:"day",selected:!0,boxlabel:o.su.CHAR.PTCR_V2.PER_DAY},{name:o.su.CHAR.PTCR_V2.PER_WEEK,value:"week",selected:!1,boxlabel:o.su.CHAR.PTCR_V2.PER_WEEK}]}),o.su.define("patrolOwnerBlockProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_owner_block")}),o.su.define("onlineDevProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_devices")}),o.su.define("profileLimitProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_limit"),readFilter:function(e){return{profileLength:e.data.profile_len,devicesLength:e.data.devices_len,categoryLength:e.data.category_len}}})}(jQuery),function(u){u.su.moduleManager.define("qos",{deps:["bandwidth","main"],services:["ajax","moduleLoader","moduleManager","device","time"],models:["qosInfo","priorityEnable","gameAcceleratorM"],stores:["qosDevicePriorityStore","timePeriodStore"],views:["qosView"],listeners:{"ev_on_launch":function(e,r,s,o,l,d,c){(r=this).unRegisterAutoSaveData([o.qosInfo]),!0===c.device.getConfig().supportGFN&&s.qosView.gfnNotes.show(),!0===c.device.getConfig().supportQosSwitch&&o.priorityEnable.enable.show(),c.moduleLoader.load({module:"qos"},{module:"bandwidth"},s.qosView.qosBandwidthLoader),r.loadQosInfor(),r.supportQoSDevicePriority&&(r.supportQosSchedule?(c.time.on("on_time_change",r.onTimeChange),c.time.on("on_hour24_change",r.onHour24Change)):s.qosView.currentTime.hide(),s.qosView.qosPriorityTab.show(),s.qosView.qosPriorityTab.itemClick("application-priority-fieldset")),"gaming"==GLOBAL_STYLE&&o.gameAcceleratorM.load({data:{operation:"getMode"}}),this.control({".qos-btn-container":{"ev_qos_btn_click":function(e,i){var t,n,a=function(){var e,t,n,a=c.moduleManager.get("bandwidth");a.hasConfigured()?"custom"==(e=i.type)?(o.qosInfo.customDetail.enable(),s.qosView.customCfgMsg.show(),o.qosInfo.qosMode.setSelected(e),t=o.qosInfo.customDetail.getValue(),s.qosView.qosCustomSlider.setValue(t)):(n=o.qosInfo.qosMode.getValue(),o.qosInfo.qosMode.setSelected(e),o.qosInfo.qosMode.process(e),o.qosInfo.customDetail.disable(),o.qosInfo.qosMode.setValue(e),o.qosInfo.submit({preventSuccessEvent:!0,success:function(e){setTimeout(function(){o.qosInfo.qosMode.successed(e.qosMode),o.qosInfo.qosMode.setSelected(e.qosMode)},2e3)},fail:function(){setTimeout(function(){o.qosInfo.qosMode.failed(e),setTimeout(function(){o.qosInfo.qosMode.setSelected(n)},1e3)},2e3)}})):a.showBandwithMsg()};"gaming"==GLOBAL_STYLE&&"gaming"==o.qosInfo.qosMode.getValue()&&"gaming"!=i.type?(n=u.su.CHAR.QOS.GAMING_PRIORITY_CHANGE_NOTICE,t=(t="fair"==(t=i.type)?"standard":t).trim().toLowerCase().replace(t[0],t[0].toUpperCase()),n=n.replace("%type",t),d.main.confirm(n,function(){"on"==o.gameAcceleratorM.gameMode.getValue()&&(o.gameAcceleratorM.gameMode.setValue("off"),o.gameAcceleratorM.gameMode.hideLoading(),o.gameAcceleratorM.submit({preventSuccessEvent:!0,data:{operation:"setMode"},success:function(){o.gameAcceleratorM.load({preventSuccessEvent:!0,data:{operation:"getMode"}})}})),a()},null,u.su.CHAR.OPERATION.CHANGE_ANYWAY)):a()}},"#qos-custom-msg":{"ev_msg_ok":function(e,t){var n="custom",a=o.qosInfo.qosMode.getValue(),i=(o.qosInfo.qosMode.setSelected(n),o.qosInfo.qosMode.process(n),s.qosView.qosCustomSlider.getValue());o.qosInfo.qosMode.setValue(n),o.qosInfo.customDetail.setValue(i),o.qosInfo.submit({success:function(e){setTimeout(function(){o.qosInfo.qosMode.successed(e.qosMode),o.qosInfo.qosMode.setSelected(e.qosMode)},2e3)},fail:function(){setTimeout(function(){o.qosInfo.qosMode.failed(n),setTimeout(function(){o.qosInfo.qosMode.setSelected(a)},1e3)},2e3)}})}},"#qos-enable":{"ev_view_will_change":function(e,t){t.preventDefault();t=function(){changeData="on"==o.priorityEnable.enable.getValue()?"off":"on",o.priorityEnable.enable.setValue(changeData),o.priorityEnable.setOnOff({success:function(){"off"==o.priorityEnable.enable.getValue()&&"gaming"==GLOBAL_STYLE&&"on"==o.gameAcceleratorM.gameMode.getValue()&&(o.gameAcceleratorM.gameMode.setValue("off"),o.gameAcceleratorM.gameMode.hideLoading(),o.gameAcceleratorM.submit({preventSuccessEvent:!0,data:{operation:"setMode"},success:function(){o.gameAcceleratorM.load({preventSuccessEvent:!0,data:{operation:"getMode"}})}})),r.loadQosInfor()}})};"gaming"==GLOBAL_STYLE&&"on"==o.priorityEnable.enable.getValue()?d.main.confirm(u.su.CHAR.QOS.GAMING_QOS_NOTICE,t,null,u.su.CHAR.OPERATION.DISABLE_ANYWAY):t()}},"#qos-priority-tabs":{"ev_switch_click":function(e,t){"device-priority-fieldset"==t?(l.qosDevicePriorityStore.load(),r.initUpdateInterval()):clearInterval(r.updateInterval)}},"#qos-device-priority-grid":{"ev_grid_after_save":function(e){r.initUpdateInterval()},"ev_grid_cancel":function(e){l.qosDevicePriorityStore.load(),r.initUpdateInterval()},"ev_grid_custom_change":function(e,t,n,a,i){e.preventDefault(),"timing"===i.dataIndex&&"-2"===t.value&&(clearInterval(r.updateInterval),l.qosDevicePriorityStore.abort(),e="#"+n.domId+" .grid-content-btn-edit",u(e).click())}}}),this.listen({"models.priorityEnable.enable":{"ev_value_change":function(e,t,n){"on"===t?s.qosView.qosInnerItem.show():s.qosView.qosInnerItem.hide()}},"stores.qosDevicePriorityStore":{"ev_data_change":function(e,t,n){if(t.value!=t.oldValue&&"enablePriority"==n.getName()&&l.qosDevicePriorityStore.sync({success:function(e){l.qosDevicePriorityStore.loadData(e,!0)}}),t.value!=t.oldValue&&"timing"==n.getName()){if(l.qosDevicePriorityStore.abort(),"-2"===t.value)return!1;l.qosDevicePriorityStore.sync({success:function(e){l.qosDevicePriorityStore.loadData(e,!0)}})}}},"views.qosView.timeFrom":{"ev_value_change":function(e,t){var n=s.qosView.timeTo.getValue();r.timeHandler(t,n)}},"views.qosView.timeTo":{"ev_value_change":function(e,t){var n=s.qosView.timeFrom.getValue();r.timeHandler(n,t)}}})},"ev_before_destroy":function(e,t,n,a,i,r,s){clearInterval(t.updateInterval),t.clearUpdateTime()}},init:function(e,t,n,a,i,r){this.configViews({id:"qosView",items:[{id:"qos-device-priority-grid",configs:{popEditor:{editTitle:u.su.CHAR.QOS_V2.SCHEDULE,content:"#qos-schedule-editor",fields:[{name:"timeFrom"},{name:"timeTo"},{name:"repeat"}]},columns:[{dataIndex:"deviceName",cls:"m-hide l-hide xl-hide label-empty"},{text:u.su.CHAR.QOS_V2.TYPE,dataIndex:"deviceType",cls:"m-hide l-hide xl-hide label-empty",renderer:function(e,t){e=e.toLowerCase();var n=t.enablePriority?"enable":"",a="",i="",r="";switch(e){case"pc":a="icon-pc";break;case"phone":a="icon-phone";break;case"pad":a="icon-pad";break;case"entertainment":a="icon-entertainment";break;case"iot_device":a="icon-iot_device";break;case"laptop":a="icon-laptop";break;case"printer":a="icon-printer";break;case"other":a="icon-other";break;default:a="icon-"+e}n&&(r='<span class="star-tag"></span>');var s="";switch(t.deviceTag){case"2.4G":s="show_24G";break;case"5G":s="show_5G";break;case"5G_1":s="show_51G";break;case"5G_2":s="show_52G";break;case"wired":s="show_LAN";break;default:s="show_offline"}return(i+='<div class="device-type-container widget-container">')+('<span class="icon '+a+' ">'+r+"</span>")+"</div>"+'<div class="device-info-container widget-container">'+'<div class="device-mac-container">'+('<span class="mode '+s+'"></span>')+('<span class="mac">'+t.mac+"</span>")+"</div>"+"</div>"}},{text:u.su.CHAR.QOS_V2.TYPE,width:"12%",dataIndex:"deviceType",cls:"s-hide",renderer:function(e,t){e=e.toLowerCase();var t=t.enablePriority?"enable":"",n="",a="",i="";switch(e){case"pc":n="icon-pc";break;case"phone":n="icon-phone";break;case"pad":n="icon-pad";break;case"entertainment":n="icon-entertainment";break;case"iot_device":n="icon-iot_device";break;case"laptop":n="icon-laptop";break;case"printer":n="icon-printer";break;case"other":n="icon-other";break;default:n="icon-"+e}return(a+='<div class="device-type-container widget-container">')+('<span class="icon '+n+' ">'+(i=t?'<span class="star-tag"></span>':i)+"</span>")+"</div>"}},{text:u.su.CHAR.QOS_V2.INFORMATION,width:"25%",dataIndex:"deviceName",cls:"s-hide",renderer:function(e,t){var n="";if("object"===u.type(t)){var a=t.deviceName,i=t.deviceTag,r=t.mac,s=("0.0.0.0"==t.ip||t.ip,"");switch(i){case"2.4G":s="show_24G";break;case"5G":s="show_5G";break;case"5G_1":s="show_51G";break;case"5G_2":s="show_52G";break;case"wired":s="show_LAN";break;default:s="show_offline"}n=(n=(n=(n=n+'<div class="device-info-container widget-container">'+('<div class="name" title="'+a+'">'+a+"</div>"))+"<div>"+('<span class="mode '+s+'"></span>'))+('<span class="mac">'+r+"</span>")+"</div>")+('<div class="edit" deviceName="'+a+'" mac="'+r+'"></div>')+"</div>"}return n}},{text:u.su.CHAR.QOS_V2.REAL_TIME_RATE,width:"20%",dataIndex:"downloadSpeed",renderer:function(e,t){var n,a="",i=function(e){var t=(e=parseInt(e,10))/1024<1?(0!==e&&(e=(e/1024).toFixed(2)),u.su.CHAR.QOS_V2.KBPS):e/1024/1024<1?(e/1024<1e3?e=(e/1024).toFixed(1):e/=1024,u.su.CHAR.QOS_V2.KBPS):(e=(e/1024/1024).toFixed(1),u.su.CHAR.QOS_V2.MBPS);return{speed:e,unit:t}};return"object"===u.type(t)&&(n=i(t.downloadSpeed),a=(a=(a=(a=(a+='<div class="speed-upload-container widget-container">')+'<span class="icon"></span><span class="text">'+(t=i(t.uploadSpeed)).speed+"</span>")+'<span class="unit">'+t.unit+'</span></div><div class="speed-download-container widget-container">')+'<span class="icon"></span><span class="text">'+n.speed+"</span>")+'<span class="unit">'+n.unit+"</span></div>"),a}},{text:u.su.CHAR.QOS_V2.TRAFFIC_USAGE,dataIndex:"trafficUsage",cls:"center-td",renderer:function(e,t){if("---"==e)return"---";var n=e,n=t.trafficUsage,e="";n/=1024;for(var a=0;a<4&&1<n/1024;a++)n/=1024;return e=(e+='<span class="text usage">'+Math.floor(10*n)/10+"</span>")+('<span class="text unit">'+["KB","MB","GB","TB"][a]+"</span>")}},{text:u.su.CHAR.QOS_V2.PRIORITY,dataIndex:"enablePriority",xtype:"customWidget",cls:"status connected-clients-grid-priority-td",widgetName:"switch",settings:{trueValue:!0,falseValue:!1}},{text:u.su.CHAR.QOS_V2.TIMING,dataIndex:"timing",xtype:"customWidget",width:98,cls:"s-2-col timing",widgetName:"combobox",settings:{noneSelectedText:"",items:e.timePeriodItem()},showRenderer:!0,renderer:function(e,t){var n,a,i;return t.enablePriority?-2===(n=parseInt(t.timing))?("on"===t.status?u.su.CHAR.TIMESETTING.ON:u.su.CHAR.TIMESETTING.OFF)+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit hidden"><span class="icon"></span></a>':(i=t.remainTime,a=parseInt(i/3600),i=parseInt(i%3600/60),!(!n||t.remainTime<60)&&a+" "+u.su.CHAR.QOS.H+" "+i+" "+u.su.CHAR.QOS.MIN+"</br>"+u.su.CHAR.QOS.REMAINING):"---"}}]}},{id:"qos-priority-tabs",fields:[{text:u.su.CHAR.QOS.APPLICATION_PRIORITY,name:"application-priority-fieldset",container:"application-priority-fieldset"},{text:u.su.CHAR.QOS_V2.DEVICE_PRIORITY,name:"device-priority-fieldset",container:"device-priority-fieldset"}]}]})}},function(t,a,n,i,e,r){var s=u("#global-combobox-options");return{updateInterval:null,supportQoSDevicePriority:r.device.getConfig().supportQoSDevicePriority,supportQosSchedule:r.device.getConfig().supportQosSchedule,initUpdateInterval:function(){t.updateInterval=setInterval(function(){"_hidden_"===s.attr("data-shown")&&i.qosDevicePriorityStore.load({data:{operation:"updateColumn"}})},6e3)},timePeriodItem:function(){var e=i.timePeriodStore.getData();return e=t.supportQosSchedule?e.concat([{name:u.su.CHAR.QOS_V2.SCHEDULE,value:"-2"}]):e},onTimeChange:function(e,t){var n=r.time.getHour24(),t=r.time.format(t,"yyyy-MM-dd HH:mm:ss",n);a.qosView.currentTime.setValue(t),a.qosView.editorCurrentTime.setText(t)},onHour24Change:function(e,t){t?(a.qosView.timeFrom.setHourSystem("24"),a.qosView.timeTo.setHourSystem("24")):(a.qosView.timeFrom.setHourSystem("12"),a.qosView.timeTo.setHourSystem("12"))},clearUpdateTime:function(){r.time.off("on_time_change",t.onTimeChange),r.time.off("on_hour24_change",t.onHour24Change)},timeHandler:function(e,t){if("string"!=typeof e||"string"!=typeof t)return!1;e=parseInt(e.replace(/:/,""),10),t=parseInt(t.replace(/:/,""),10)<=e?u.su.CHAR.WIRELESS_SCHEDULE.NEXT_DAY_TIP:"";a.qosView.timeTo.setShortTips(t)},loadQosInfor:function(){n.priorityEnable.getOnOff(),n.qosInfo.load({success:function(){var e=n.qosInfo.getData();!0===r.device.getConfig().supportGFN&&("fair"==e.qosMode?(n.priorityEnable.enable.setValue("off"),n.qosInfo.qosMode.setDisabled()):(n.priorityEnable.enable.setValue("on"),n.qosInfo.qosMode.setAbled())),n.qosInfo.qosMode.setSelected(e.qosMode)}})}}})}(jQuery),$.su.modelManager.define("qosInfo",{type:"model",fields:[{name:"qosMode",mapping:"qos_mode",convert:function(e){switch(e){case"gfn":e="geforce";break;case"game":e="gaming";break;case"media":e="streaming";break;case"surf":e="surfing";break;case"chat":e="chatting"}return e},serialize:function(e){switch(e){case"geforce":e="gfn";break;case"gaming":e="game";break;case"streaming":e="media";break;case"surfing":e="surf";break;case"chatting":e="chat"}return e}},{name:"customDetail",mapping:"custom_detail"}],proxy:{url:$.su.url("/admin/smart_network?form=tm_qos"),api:{write:{writeFilter:function(e){return e.custom_detail=JSON.stringify(e.custom_detail),e}}}}}),$.su.modelManager.define("priorityEnable",{type:"model",fields:[{name:"enable"}],proxy:"qosEnableProxy",methods:{setOnOff:function(e){var t=this.getData();e.data=$.extend({},e.data,t),this.getProxy().setOnOff(e)},getOnOff:function(e){var t=this;this.getProxy().getOnOff({success:function(e){t.loadData(e)}})}}}),$.su.define("qosEnableProxy",{extend:"IPFProxy",url:$.su.url("/admin/smart_network?form=tm_qos"),api:{setOnOff:{writeFilter:function(e){return $.extend({operation:"setOnOff"},e)}},getOnOff:{preventSuccessEvent:!0,writeFilter:function(e){return $.extend({operation:"getOnOff"},e)},readFilter:function(e){return e.data}}}}),function(o){o.su.moduleManager.define("qosV2",{deps:[],services:["device","time","moduleManager"],models:["qosV2"],stores:["bandwidthUnitStore","qosDevicePriorityStore","timePeriodStore"],views:["qosV2View"],listeners:{"ev_on_launch":function(e,a,i,r,s,t,n){i.qosV2View.devicePriorityPanel.hide(),a.supportQosSchedule?(n.time.on("on_time_change",a.onTimeChange),n.time.on("on_hour24_change",a.onHour24Change)):i.qosV2View.scheduleWrap.hide(),r.qosV2.load({success:function(e){"on"==e.enable?i.qosV2View.devicePriorityPanel.show():i.qosV2View.devicePriorityPanel.hide(),a.maxUpBand=parseInt(r.qosV2.maxUpBand.getValue()),a.maxDownBand=parseInt(r.qosV2.maxDownBand.getValue()),"mbps"==e.up_unit&&r.qosV2.upBand.setVtype({vtype:"float_number2",min:1,max:a.maxUpBand}),"mbps"==e.down_unit&&r.qosV2.downBand.setVtype({vtype:"float_number2",min:1,max:a.maxDownBand})}}),s.qosDevicePriorityStore.load(),a.initUpdateInterval(),this.listen({"models.qosV2":{"ev_model_submit":function(e,t){"on"==t.enable?i.qosV2View.devicePriorityPanel.show():i.qosV2View.devicePriorityPanel.hide()}},"stores.qosDevicePriorityStore":{"ev_data_change":function(e,t,n){if(t.value!=t.oldValue&&"enablePriority"==n.getName()&&s.qosDevicePriorityStore.sync({success:function(e){s.qosDevicePriorityStore.loadData(e,!0)}}),t.value!=t.oldValue&&"timing"==n.getName()){if(s.qosDevicePriorityStore.abort(),"-2"===t.value)return!1;s.qosDevicePriorityStore.sync({success:function(e){s.qosDevicePriorityStore.loadData(e,!0)}})}}},"views.qosV2View.timeFrom":{"ev_value_change":function(e,t){var n=i.qosV2View.timeTo.getValue();a.timeHandler(t,n)}},"views.qosV2View.timeTo":{"ev_value_change":function(e,t){var n=i.qosV2View.timeFrom.getValue();a.timeHandler(n,t)}},"models.qosV2.upUnit":{"ev_value_change":function(e,t,n){n!=undefined&&null!=n&&0!==a.maxUpBand&&(r.qosV2.upBand.setNormal(),"kbps"==t?r.qosV2.upBand.setVtype({vtype:"float_number2",min:1,max:1e3}):r.qosV2.upBand.setVtype({vtype:"float_number2",min:1,max:a.maxUpBand}),r.qosV2.upBand.validate())}},"models.qosV2.downUnit":{"ev_value_change":function(e,t,n){n!=undefined&&null!=n&&0!==a.maxDownBand&&(r.qosV2.downBand.setNormal(),"kbps"==t?r.qosV2.downBand.setVtype({vtype:"float_number2",min:1,max:1e3}):r.qosV2.downBand.setVtype({vtype:"float_number2",min:1,max:a.maxDownBand}),r.qosV2.downBand.validate())}}})},"ev_before_destroy":function(e,t,n,a,i,r,s){clearInterval(t.updateInterval),t.clearUpdateTime()}},init:function(r,e,t,s,n,a){this.configViews({id:"qosV2View",items:[{id:"qos-device-priority-grid",configs:{popEditor:{editTitle:o.su.CHAR.QOS_V2.SCHEDULE,content:"#qos-schedule-editor",fields:[{name:"timeFrom"},{name:"timeTo"},{name:"repeat"}]},columns:[{dataIndex:"deviceName",cls:"m-hide l-hide xl-hide label-empty"},{text:o.su.CHAR.QOS_V2.TYPE,dataIndex:"deviceType",cls:"m-hide l-hide xl-hide label-empty",renderer:function(e,t){e=e.toLowerCase();var n=t.enablePriority?"enable":"",a="",i="",r="";switch(e){case"pc":a="icon-pc";break;case"phone":a="icon-phone";break;case"pad":a="icon-pad";break;case"entertainment":a="icon-entertainment";break;case"iot_device":a="icon-iot_device";break;case"laptop":a="icon-laptop";break;case"printer":a="icon-printer";break;case"other":a="icon-other";break;default:a="icon-"+e}var s=parseInt(t.timing);(-2===s&&"on"==t.status&&"enable"==n||-2!=s&&"enable"==n)&&(r='<span class="star-tag"></span>');var o="";switch(t.deviceTag){case"2.4G":o="show_24G";break;case"5G":o="show_5G";break;case"5G_1":o="show_51G";break;case"5G_2":o="show_52G";break;case"wired":o="show_LAN";break;default:o="show_offline"}return(i+='<div class="device-type-container widget-container">')+('<span class="icon '+a+' ">'+r+"</span>")+"</div>"+'<div class="device-info-container widget-container">'+'<div class="device-mac-container">'+('<span class="mode '+o+'"></span>')+('<span class="mac">'+t.mac+"</span>")+"</div>"+"</div>"}},{text:o.su.CHAR.QOS_V2.TYPE,width:"12%",dataIndex:"deviceType",cls:"s-hide",renderer:function(e,t){e=e.toLowerCase();var n=t.enablePriority?"enable":"",a="",i="",r="";switch(e){case"pc":a="icon-pc";break;case"phone":a="icon-phone";break;case"pad":a="icon-pad";break;case"entertainment":a="icon-entertainment";break;case"iot_device":a="icon-iot_device";break;case"laptop":a="icon-laptop";break;case"printer":a="icon-printer";break;case"other":a="icon-other";break;default:a="icon-"+e}var s=parseInt(t.timing);return(i+='<div class="device-type-container widget-container">')+('<span class="icon '+a+' ">'+(r=-2===s&&"on"==t.status&&"enable"==n||-2!=s&&"enable"==n?'<span class="star-tag"></span>':r)+"</span>")+"</div>"}},{text:o.su.CHAR.QOS_V2.INFORMATION,width:"25%",dataIndex:"deviceName",cls:"s-hide",renderer:function(e,t){var n="";if("object"===o.type(t)){var a=t.deviceName,i=t.deviceTag,r=t.mac,s=("0.0.0.0"==t.ip||t.ip,"");switch(i){case"2.4G":s="show_24G";break;case"5G":s="show_5G";break;case"5G_1":s="show_51G";break;case"5G_2":s="show_52G";break;case"wired":s="show_LAN";break;default:s="show_offline"}n=(n=(n=(n=n+'<div class="device-info-container widget-container">'+('<div class="name" title="'+a+'">'+a+"</div>"))+"<div>"+('<span class="mode '+s+'"></span>'))+('<span class="mac">'+r+"</span>")+"</div>")+('<div class="edit" deviceName="'+a+'" mac="'+r+'"></div>')+"</div>"}return n}},{text:o.su.CHAR.QOS_V2.REAL_TIME_RATE,width:"20%",dataIndex:"downloadSpeed",renderer:function(e,t){var n,a="",i=function(e){var t=(e=parseInt(e,10))/1024<1?(0!==e&&(e=(e/1024).toFixed(2)),o.su.CHAR.QOS_V2.KBPS):e/1024/1024<1?(e/1024<1e3?e=(e/1024).toFixed(1):e/=1024,o.su.CHAR.QOS_V2.KBPS):(e=(e/1024/1024).toFixed(1),o.su.CHAR.QOS_V2.MBPS);return{speed:e,unit:t}};return"object"===o.type(t)&&(n=i(t.downloadSpeed),a=(a=(a=(a=(a+='<div class="speed-upload-container widget-container">')+'<span class="icon"></span><span class="text">'+(t=i(t.uploadSpeed)).speed+"</span>")+'<span class="unit">'+t.unit+'</span></div><div class="speed-download-container widget-container">')+'<span class="icon"></span><span class="text">'+n.speed+"</span>")+'<span class="unit">'+n.unit+"</span></div>"),a}},{text:o.su.CHAR.QOS_V2.TRAFFIC_USAGE,dataIndex:"trafficUsage",cls:"center-td",renderer:function(e,t){if("---"==e)return"---";var n=e,n=t.trafficUsage,e="";n/=1024;for(var a=0;a<4&&1<n/1024;a++)n/=1024;return e=(e+='<span class="text usage">'+Math.floor(10*n)/10+"</span>")+('<span class="text unit">'+["KB","MB","GB","TB"][a]+"</span>")}},{text:o.su.CHAR.QOS_V2.PRIORITY,dataIndex:"enablePriority",xtype:"customWidget",cls:"status connected-clients-grid-priority-td",widgetName:"switch",settings:{trueValue:!0,falseValue:!1}},{text:o.su.CHAR.QOS_V2.TIMING,dataIndex:"timing",xtype:"customWidget",width:98,cls:"s-2-col timing",widgetName:"combobox",settings:{noneSelectedText:"",items:r.timePeriodItem()},showRenderer:!0,renderer:function(e,t){var n,a,i;return t.enablePriority?-2===(n=parseInt(t.timing))?("on"===t.status?o.su.CHAR.TIMESETTING.ON:o.su.CHAR.TIMESETTING.OFF)+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit hidden"><span class="icon"></span></a>':(i=t.remainTime,a=parseInt(i/3600),i=parseInt(i%3600/60),!(!n||t.remainTime<60)&&a+" "+o.su.CHAR.QOS.H+" "+i+" "+o.su.CHAR.QOS.MIN+"</br>"+o.su.CHAR.QOS.REMAINING):"---"}}]}},{id:"qos-schedule-repeat",configs:{format:function(e){for(var t=/\b(\w)|\s(\w)/g,n=e.length,a=0;a<n;a++)e[a]=e[a].replace(t,function(e){return e.toUpperCase()});return e.join(",")}}}]}),this.control({"#qos-device-priority-grid":{"ev_grid_after_save":function(e){r.initUpdateInterval()},"ev_grid_cancel":function(e){s.qosDevicePriorityStore.load(),r.initUpdateInterval()},"ev_grid_custom_change":function(e,t,n,a,i){e.preventDefault(),"timing"===i.dataIndex&&"-2"===t.value&&t.triggerAction!=undefined&&"clickLabel"==t.triggerAction&&(clearInterval(r.updateInterval),s.qosDevicePriorityStore.abort(),e="#"+n.domId+" .grid-content-btn-edit",o(e).click())}},"#system-time-settings":{"ev_button_click":function(){a.moduleManager.get("navigatorController").goTo("timeSettings")}}})}},function(t,a,e,n,i,r){var s=o("#global-combobox-options");return{updateInterval:null,maxUpBand:0,maxDownBand:0,supportQosSchedule:r.device.getConfig().supportQosSchedule,initUpdateInterval:function(){t.updateInterval=setInterval(function(){"_hidden_"===s.attr("data-shown")&&n.qosDevicePriorityStore.load()},6e3)},timePeriodItem:function(){var e=n.timePeriodStore.getData();return e=t.supportQosSchedule?e.concat([{name:o.su.CHAR.QOS_V2.SCHEDULE,value:"-2"}]):e},onTimeChange:function(e,t){var n=r.time.getHour24(),t=r.time.format(t,"yyyy-MM-dd HH:mm:ss",n);a.qosV2View.currentTime.setValue(t)},onHour24Change:function(e,t){t?(a.qosV2View.timeFrom.setHourSystem("24"),a.qosV2View.timeTo.setHourSystem("24")):(a.qosV2View.timeFrom.setHourSystem("12"),a.qosV2View.timeTo.setHourSystem("12"))},clearUpdateTime:function(){r.time.off("on_time_change",t.onTimeChange),r.time.off("on_hour24_change",t.onHour24Change)},timeHandler:function(e,t){if("string"!=typeof e||"string"!=typeof t)return!1;e=parseInt(e.replace(/:/,""),10),t=parseInt(t.replace(/:/,""),10)<=e?o.su.CHAR.WIRELESS_SCHEDULE.NEXT_DAY_TIP:"";a.qosV2View.timeTo.setShortTips(t)}}})}(jQuery),function(t){t.su.modelManager.define("qosV2",{type:"model",fields:[{name:"enable",defaultValue:"off"},{name:"upBand",mapping:"up_band",allowBlank:!1,vtype:{vtype:"float_number2",min:1,max:1e3}},{name:"downBand",mapping:"down_band",allowBlank:!1,vtype:{vtype:"float_number2",min:1,max:1e3}},{name:"upUnit",mapping:"up_unit"},{name:"downUnit",mapping:"down_unit"},{name:"maxUpBand",mapping:"max_up_band",disabled:!0},{name:"maxDownBand",mapping:"max_down_band",disabled:!0}],proxy:{url:t.su.url("/admin/smart_network?form=qos")}}),t.su.storeManager.define("qosDevicePriorityStore",{type:"store",fields:[{"name":"deviceType"},{"name":"deviceName"},{"name":"deviceTag"},{"name":"mac"},{"name":"downloadSpeed"},{"name":"uploadSpeed"},{"name":"trafficUsage"},{"name":"enablePriority"},{"name":"timePeriod"},{"name":"remainTime"},{"name":"timeMode","mapping":"time_mode"},{"name":"timeFrom","mapping":"time_begin"},{"name":"timeTo","mapping":"time_end"},{"name":"repeat","mapping":"repeat_weeks","defaultValue":""},{"name":"status"},{"name":"timing"}],convert:function(e){return t.each(e,function(e,t){"schedule"===t.time_mode?t.timing="-2":t.timing=t.timePeriod,t.time_begin||(t.time_begin="10:00",t.time_end="18:00",t.repeat_weeks="Mon,Tue,Wed,Thu,Fri")}),e},serialize:function(e){return t.each(e,function(e,t){"-2"===t.timing?t.time_mode="schedule":(t.time_mode="period",t.timePeriod=t.timing),delete t.timing,delete t.status}),e},proxy:{url:t.su.url("/admin/smart_network?form=device_priority")}})}(jQuery),function(l){l.su.moduleManager.define("bandwidth",{deps:["main"],services:["ajax","device"],models:["totalBandwidth","bandwidthSpeedTestControl","speedTestStatusModel"],stores:["bandwidthSetTypeStore","bandwidthUnitStore"],views:["bandwidthView"],listeners:{"ev_on_launch":function(e,a,i,r,t,s,o){this.unRegisterAutoSaveData([r.totalBandwidth,r.bandwidthSpeedTestControl,r.speedTestStatusModel]),this.control({".total-bandwidth .edit-icon":{"click":function(){a.showBandwithMsg()}},"#set-bandwidth-msg":{"ev_msg_ok":function(e,t){var n;t.preventDefault(),!0===r.totalBandwidth.validate()&&("manual"===r.totalBandwidth.bandwidthMode.getValue()?(t={},(n={}).value=Number(r.totalBandwidth.upstreamSpeedTrans.getValue()),t.value=Number(r.totalBandwidth.downstreamSpeedTrans.getValue()),n.unit=r.totalBandwidth.upstreamUnitTrans.getValue(),t.unit=r.totalBandwidth.downstreamUnitTrans.getValue(),n=a.joinSpeed(n),t=a.joinSpeed(t),r.totalBandwidth.upstreamBandwidth.setValue(n),r.totalBandwidth.downstreamBandwidth.setValue(t),r.totalBandwidth.submit({success:function(e){r.totalBandwidth.loadData(e),i.bandwidthView.setBandwidthMsg.close()}})):o.ajax.request({proxy:"bandwidthCheckInternetProxy",success:function(){r.totalBandwidth.submit({success:function(e){a.noRecord?o.ajax.request({proxy:"checkPrivicyProxy",method:"read",success:function(e){i.bandwidthView.setBandwidthMsg.close(),e.enable?(a.initSpeedtest(),i.bandwidthView.speedtestMsg.show(),a.startSpeedTest()):i.bandwidthView.speedtestPrivacyMsg.show()}}):(r.totalBandwidth.loadData(e),i.bandwidthView.setBandwidthMsg.close())}})},fail:function(){s.main.showError(l.su.CHAR.BANDWIDTH.NO_INTERNET_NOTE)},error:function(){s.main.showError(l.su.CHAR.BANDWIDTH.NO_INTERNET_NOTE)}}))},"ev_msg_cancel":function(e,t){this.trigger("ev_qos_save_cancel")},"ev_msg_close":function(e,t){this.trigger("ev_qos_save_close")}},"#speedtest-privacy-msg":{"ev_msg_ok":function(e,t){t.preventDefault(),o.ajax.request({proxy:"checkPrivicyProxy",method:"write",data:{enable:!0},success:function(){i.bandwidthView.speedtestPrivacyMsg.close(),a.initSpeedtest(),i.bandwidthView.speedtestMsg.show(),a.startSpeedTest()}})},"ev_msg_cancel":function(e,t){i.bandwidthView.setBandwidthMsg.show()}},"#speedtest-msg":{"ev_msg_close":function(e){i.bandwidthView.setBandwidthMsg.show(),a.stopSpeedTest()}},"#speedtest-msg-cancel-btn":{"ev_button_click":function(e){i.bandwidthView.speedtestMsg.hide(),i.bandwidthView.setBandwidthMsg.show(),a.stopSpeedTest()}},".bandwidth-speedtest-btn":{"ev_button_click":function(){a.startSpeedTest()}}}),this.listen({"models.totalBandwidth.bandwidthMode":{"ev_value_change":function(e,t){"manual"===t?i.bandwidthView.bandwidthSetManual.show():(i.bandwidthView.bandwidthSetManual.hide(),a.noRecord?r.totalBandwidth.bandwidthMode.showItemContent(["auto"]):r.totalBandwidth.bandwidthMode.hideItemContent(["auto"]))}},"models.totalBandwidth":{"ev_loaded":function(e,t,n){a.getSpeedTestStatus()}},"models.totalBandwidth.upstreamUnitTrans":{"ev_value_change":function(e,t,n){"kbps"===t?r.totalBandwidth.upstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:r.totalBandwidth.maxUpload.getValue()}):r.totalBandwidth.upstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:Math.floor(r.totalBandwidth.maxUpload.getValue()/1024)})}},"models.totalBandwidth.downstreamUnitTrans":{"ev_value_change":function(e,t,n){"kbps"===t?r.totalBandwidth.downstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:r.totalBandwidth.maxDownload.getValue()}):r.totalBandwidth.downstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:Math.floor(r.totalBandwidth.maxDownload.getValue()/1024)})}}}),r.totalBandwidth.load()}},init:function(e,t,n,a,i,r){}},function(i,t,n,e,a,r){var s=null;return{hasConfigured:function(){return-1!==parseInt(n.totalBandwidth.downstreamBandwidth.getValue(),10)},showBandwithMsg:function(){t.bandwidthView.setBandwidthMsg.show()},isSpeedTesting:!1,joinSpeed:function(e){var t=e.value;return"mbps"===e.unit&&(t*=1024),t},initSpeedtest:function(){i.initDownloadChart(),i.initUploadChart()},initDownloadChart:function(){n.bandwidthSpeedTestControl.speedTestDownload.setOption({name:l.su.CHAR.NETWORK_MAP.DOWNLOAD_SPEED_UPPER,convert:[0,5,10,25,50,100,300,1e3,2500]})},initUploadChart:function(){n.bandwidthSpeedTestControl.speedTestUpload.setOption({name:l.su.CHAR.NETWORK_MAP.UPLOAD_SPEED_UPPER,convert:[0,5,10,25,50,100,300,1e3,2500]})},setDownloadChartSpeed:function(e){n.bandwidthSpeedTestControl.speedTestDownload.setOption({value:i.normalizeSpeed(e),name:l.su.CHAR.NETWORK_MAP.DOWNLOAD_SPEED_UPPER,convert:[0,5,10,25,50,100,300,1e3,2500]})},setUploadChartSpeed:function(e){n.bandwidthSpeedTestControl.speedTestUpload.setOption({value:i.normalizeSpeed(e),name:l.su.CHAR.NETWORK_MAP.UPLOAD_SPEED_UPPER,convert:[0,5,10,25,50,100,300,1e3,2500]})},startSpeedTest:function(){n.bandwidthSpeedTestControl.speedTestBtn.hide(),n.bandwidthSpeedTestControl.speedTestInfo.setText("&nbsp;"),i.setDownloadChartSpeed(i.transformSpeedUnit(0)),i.setUploadChartSpeed(i.transformSpeedUnit(0)),i.isSpeedTesting=!0,clearInterval(s),i.getSpeedTestResult({proxy:"startSpeedTestProxy",success:function(e){s=setInterval(function(){i.continueSpeedTest()},2e3)}})},continueSpeedTest:function(){i.getSpeedTestResult({proxy:"readSpeedTestProxy",success:function(e){"idle"===e.status?(i.isSpeedTesting=!1,clearInterval(s),i.setSpeedTestResult(e),n.totalBandwidth.load(),t.bandwidthView.speedtestMsg.close()):"down_test"===e.status?(n.bandwidthSpeedTestControl.speedTestInfo.setText(l.su.CHAR.NETWORK_MAP.DOWNLOAD_SPEED_TEST),i.setDownloadChartSpeed(i.transformSpeedUnit(e.downSpeed)),i.setUploadChartSpeed(i.transformSpeedUnit(e.upSpeed))):"up_test"===e.status?(n.bandwidthSpeedTestControl.speedTestInfo.setText(l.su.CHAR.NETWORK_MAP.UPLOAD_SPEED_TEST),i.setDownloadChartSpeed(i.transformSpeedUnit(e.downSpeed)),i.setUploadChartSpeed(i.transformSpeedUnit(e.upSpeed))):"fail"===e.status?(n.bandwidthSpeedTestControl.speedTestInfo.setText(l.su.CHAR.BANDWIDTH.SPEED_TEST_FAILED),i.isSpeedTesting=!1,clearInterval(s),i.setSpeedTestResult(e),n.bandwidthSpeedTestControl.speedTestBtn.show()):(n.bandwidthSpeedTestControl.speedTestInfo.setText("&nbsp;"),i.setDownloadChartSpeed(0),i.setUploadChartSpeed(0))},fail:function(e){i.isSpeedTesting=!1,clearInterval(s),s=null,i.setSpeedTestResult(data)}})},getSpeedTestResult:function(e){var t,n,a="readSpeedTestProxy";e&&(t=e.success,n=e.fail,a=e.proxy||a),r.ajax.request({proxy:a,preventSuccessEvent:e.preventSuccessEvent,success:function(e){i.isRunning()&&t&&t(e)},fail:function(e){i.isRunning()&&n&&n(e)}})},setSpeedTestResult:function(e){var t=i.transformSpeedUnit(e.upSpeed),e=i.transformSpeedUnit(e.downSpeed);i.setDownloadChartSpeed(e),i.setUploadChartSpeed(t)},stopSpeedTest:function(){i.getSpeedTestResult({proxy:"stopSpeedTestProxy",success:function(e){i.isSpeedTesting=!1,clearInterval(s),s=null,i.setSpeedTestResult(e)}})},normalizeSpeed:function(e){return isNaN(e)||e<0?0:e},transformSpeedUnit:function(e){return(!e||e<0)&&(e=0),1e3<=(e/=1024)?parseInt(e,10):parseFloat(e.toFixed(2))},getSpeedTestStatus:function(){n.speedTestStatusModel.getProxy().getStatus({success:function(e){i.getRecord(0!=e.is_available),0==e.is_available&&n.totalBandwidth.bandwidthMode.setValue("manual")},error:function(){i.getRecord(!0)},fail:function(){i.getRecord(!0)}})},getRecord:function(e){0!=r.device.getConfig().supportAutoSpeedTest&&e?(i.noRecord=!1,r.ajax.request({proxy:"speedRecordProxy",ajax:{"async":!1},success:function(e){l.isArray(e)&&0!==e.length||(i.noRecord=!0)}})):n.totalBandwidth.bandwidthMode.hide()}}})}(jQuery),function(r){r.su.modelManager.define("totalBandwidth",{type:"model",fields:[{name:"bandwidthMode",mapping:"bandwidth_mode"},{name:"upstreamBandwidth",mapping:"upstream_bandwidth"},{name:"downstreamBandwidth",mapping:"downstream_bandwidth"},{name:"maxUpload",mapping:"max_upload",disabled:!0},{name:"maxDownload",mapping:"max_download",disabled:!0},{name:"upstreamBandwidthTrans",mapping:"upstream_bandwidth_trans",disabled:!0},{name:"downstreamBandwidthTrans",mapping:"downstream_bandwidth_trans",disabled:!0},{name:"upstreamSpeedTrans",mapping:"upstream_speed_trans",allowBlank:!1,disabled:!0},{name:"upstreamUnitTrans",mapping:"upstream_unit_trans",disabled:!0},{name:"downstreamSpeedTrans",mapping:"downstream_speed_trans",allowBlank:!1,disabled:!0},{name:"downstreamUnitTrans",mapping:"downstream_unit_trans",disabled:!0},{name:"gameMode",mapping:"game_mode"}],convert:function(e){var t={"mbps":r.su.CHAR.BANDWIDTH.SPEED_M,"kbps":r.su.CHAR.BANDWIDTH.SPEED_K};function n(e){var t={value:0,unit:"kbps"};return e/1024<1?(t.value=e<1e3?e.toFixed(1):e.toFixed(0),t.unit="kbps"):(t.value=(e/1024).toFixed(1),t.unit="mbps"),t}var a=n(e.upstream_bandwidth),i=n(e.downstream_bandwidth);return a.value&&"NaN"!=a.value&&-1!=e.upstream_bandwidth?(e.upstream_bandwidth_trans=a.value+" "+t[a.unit],e.upstream_speed_trans=a.value,e.upstream_unit_trans=a.unit):(e.upstream_bandwidth_trans="---",e.upstream_speed_trans="",e.upstream_unit_trans="mbps"),i.value&&"NaN"!=i.value&&-1!=e.downstream_bandwidth?(e.downstream_bandwidth_trans=i.value+" "+t[i.unit],e.downstream_speed_trans=i.value,e.downstream_unit_trans=i.unit):(e.downstream_bandwidth_trans="---",e.downstream_speed_trans="",e.downstream_unit_trans="mbps"),e},proxy:{url:r.su.url("/admin/smart_network?form=tm_qos")}}),r.su.storeManager.define("bandwidthSetTypeStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"},{name:"content"}],data:[{name:r.su.CHAR.BANDWIDTH.BAND_TYPE_AUTO,value:"auto",boxlabel:r.su.CHAR.BANDWIDTH.BAND_TYPE_AUTO,content:"<span>"+r.su.CHAR.BANDWIDTH.BAND_TYPE_AUTO_NOTE+"</span>"},{name:r.su.CHAR.BANDWIDTH.BAND_TYPE_MANUAL,value:"manual",boxlabel:r.su.CHAR.BANDWIDTH.BAND_TYPE_MANUAL,content:""}]}),r.su.storeManager.define("bandwidthUnitStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:r.su.CHAR.BANDWIDTH.SPEED_M,value:"mbps",boxlabel:r.su.CHAR.BANDWIDTH.SPEED_M},{name:r.su.CHAR.BANDWIDTH.SPEED_K,value:"kbps",boxlabel:r.su.CHAR.BANDWIDTH.SPEED_K}]}),r.su.define("speedRecordProxy",{extend:"IPFProxy",preventSuccessEvent:!0,preventFailEvent:!0,preventErrorEvent:!0,url:r.su.url("/admin/status?form=speedtest"),writeFilter:function(e){return{operation:"get"}}}),r.su.define("bandwidthCheckInternetProxy",{extend:"IPFProxy",url:r.su.url("/admin/quick_setup?form=check_internet"),writeFilter:function(e){return{operation:"read"}}}),r.su.define("checkPrivicyProxy",{extend:"IPFProxy",url:r.su.url("/admin/qos?form=check_privicy")}),r.su.modelManager.define("bandwidthSpeedTestControl",{type:"model",fields:[{name:"speedTestInfo"},{name:"speedTestChartContainer"},{name:"speedTestDownload"},{name:"speedTestUpload"},{name:"speedTestBtn"}],proxy:null}),r.su.define("startSpeedTestProxy",{extend:"IPFProxy",url:r.su.url("/admin/status?form=speedtest"),preventSuccessEvent:!0,writeFilter:function(e){return r.extend({operation:"start"},e)}}),r.su.define("readSpeedTestProxy",{extend:"IPFProxy",url:r.su.url("/admin/status?form=speedtest"),writeFilter:function(e){return r.extend({operation:"read"},e)},readFilter:function(e){return{testTime:e.data.test_time,upSpeed:e.data.up_speed,downSpeed:e.data.down_speed,status:e.data.status}}}),r.su.define("stopSpeedTestProxy",{extend:"IPFProxy",url:r.su.url("/admin/status?form=speedtest"),preventSuccessEvent:!0,writeFilter:function(e){return r.extend({operation:"stop"},e)},readFilter:function(e){return{testTime:e.data.test_time,upSpeed:e.data.up_speed,downSpeed:e.data.down_speed}}})}(jQuery);