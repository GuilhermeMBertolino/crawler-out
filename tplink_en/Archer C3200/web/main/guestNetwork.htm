<script type="text/javascript">
var wlanObj_2g, mssidObj_2g, vapList_2g, vapObj, guestnetObj, qosEntryList, upQosEntry, downQosEntry, wlanObj_5g, mssidObj_5g, guestnetObj_5g, vapObj_5g, vapObj_2g, guestnetObj_2g, vapList_5g;
var vapIndx, loop, wlan_index, wlan_index5G;
var qssEnable_2g, qssEnable_5g;

function checkSSID(band) {
    var s = $('#ssid' + band);
    var ssidLen = $.realLen(s.prop('value'));

    if ( /*INCLUDE_LAN_WLAN_MSSID*/ 1) {
        /*var index = 1;

         for (index = 1; index < ssidNum; index++) {
         var cp1 = $.id("ssid").value;
         var cp2 = $.id("ssid" + index).value;
         if (cp1 == cp2) {
         $.alert(CMM_WLAN_SSID_CONFLICTE);
         s.focus();
         s.select();
         return false;
         }
         }

         for (index = 1; index < ssidNum; index++) {
         var cp1 = $.id("ssid" + index).value;
         var loop = 0;
         for (loop = index + 1; loop < ssidNum; loop++) {
         var cp2 = $.id("ssid" + loop).value;
         if (cp1 == cp2) {
         $.alert(CMM_WLAN_SSID_CONFLICTE);
         $.id("ssid" + index).focus();
         $.id("ssid" + index).select();
         return false;
         }
         }
         }*/

        if ( /*INCLUDE_LAN_WLAN_GUESTNETWORK*/ 1) {
            if (s.prop('value') == wlanObj_2g.SSID || s.prop('value') == wlanObj_5g.SSID) {
                $.alert(CMM_WLAN_SSID_CONFLICTE);
                s.focus();
                s.select();
                return false;
            }
            /*            for (index = 1; index < ssidNum; index++) {
             if ($.id("ssid" + index).value == guestVap.ssid) {
             $.alert(CMM_WLAN_SSID_CONFLICTE_WITH_GUESTNET);
             $.id("ssid" + index).focus();
             $.id("ssid" + index).select();
             return false;
             }
             }*/
        }
    }
    if (ssidLen <= 0) {
        $.alert(ERR_WLAN_SSID_IS_EMPTY);
        s.focus();
        s.select();
        return false;
    } else if (ssidLen > 32) {
        $.alert(ERR_WLAN_SSID_LEN_OUTRANGE);
        s.focus();
        s.select();
        return false;
    }
    /* else if (INCLUDE_LAN_WLAN_MSSID) {
     for (index = 1; index < ssidNum; index++) {
     var s2 = $.id("ssid" + index);
     var ssidLen2 = $.realLen(s2.value);
     if (ssidLen2 <= 0) {
     $.alert(ERR_WLAN_SSID_IS_EMPTY);
     s2.focus();
     s2.select();
     return false;
     } else if (ssidLen2 > 32) {
     $.alert(ERR_WLAN_SSID_LEN_OUTRANGE);
     s2.focus();
     s2.select();
     return false;
     }
     }
     }*/

    return true;
}

function checkPersonal(band) {
    var t = $('#passwd' + band);
    var pwd = t.prop('value');

    if (pwd.length == 0) {
        $.alert(ERR_WLAN_WPA_PSK_EMPTY);
        t.focus();
        t.select();
        return false;
    } else if (pwd.length < 8) {
        $.alert(ERR_WLAN_WPA_PSK_LENGTH_INVALID);
        t.focus();
        t.select();
        return false;
    } else if (pwd.length >= 64) {
        if (!isHex(pwd, 0)) {
            $.alert(ERR_WLAN_WPA_PSK_HEX_INVALID);
            t.focus();
            t.select();
            return false;
        }
        t.prop('value', t.prop('value').substr(0, 64));
    } else {
        if ($.asc(pwd, true)) {
            $.alert(ERR_WLAN_WPA_PSK_ASCII_INVALID);
            t.focus();
            t.select();
            return false;
        }
    }

    if ((qssEnable_2g == 1 && band == '_2g') ||
        (qssEnable_5g == 1 && band == '_5g')) {
        if ($("#tkipEncryption" + band).prop('checked')) {
            $.alert(ERR_WLAN_QSS_TKIP_CONFLICT);
            return false;
        }
    }
    return true;
}

function check(band) {
    if (checkSSID(band) == false) {
        return false;
    }
    if ($('#wpaSec' + band).prop('checked')) {
        if (checkPersonal(band) == false) {
            return false;
        }
    }
}

function clickSave(band) {
    var encryType;
    var vapParamSave = {};
    if (check(band) == false) {
        return;
    }
    vapParamSave.enable = $('#wlEn' + band).prop('data-checked') ? 1 : 0;
    vapParamSave.SSID = $('#ssid' + band).prop('value');
    if ($('#noSec' + band).prop('checked')) {
        vapParamSave.beaconType = 'Basic';
        vapParamSave.basicEncryptionModes = 'None';
        vapParamSave.basicAuthenticationMode = 'None';
        if (band == '_2g') {
            $.act(ACT_SET, LAN_WLAN_MSSIDENTRY, vapObj_2g.__stack, null, vapParamSave);
        } else {
            $.act(ACT_SET, LAN_WLAN_MSSIDENTRY, vapObj_5g.__stack, null, vapParamSave);
        }
    } else if ($('#wpaSec' + band).prop('checked')) {
        if ($('#autoEncryption' + band).prop('checked')) {
            encryType = 'TKIPandAESEncryption';
        } else if ($("#tkipEncryption" + band).prop('checked')) {
            encryType = 'TKIPEncryption';
        } else if ($("#aesEncryption" + band).prop('checked')) {
            encryType = 'AESEncryption';
        }

        if ($('#autoVersion' + band).prop('checked')) {
            vapParamSave.beaconType = 'WPAand11i';
            vapParamSave.WPAAuthenticationMode = 'PSKAuthentication';
            vapParamSave.WPAEncryptionModes = encryType;
            vapParamSave.IEEE11iAuthenticationMode = 'PSKAuthentication';
            vapParamSave.IEEE11iEncryptionModes = encryType;
            vapParamSave.preSharedKey = $('#passwd' + band).prop('value');
        }

        if ($('#wpaVersion' + band).prop('checked')) {
            vapParamSave.beaconType = 'WPA';
            vapParamSave.WPAAuthenticationMode = 'PSKAuthentication';
            vapParamSave.WPAEncryptionModes = encryType;
            vapParamSave.preSharedKey = $('#passwd' + band).prop('value');
        }

        if ($('#wpa2Version' + band).prop('checked')) {
            vapParamSave.beaconType = '11i';
            vapParamSave.IEEE11iAuthenticationMode = 'PSKAuthentication';
            vapParamSave.IEEE11iEncryptionModes = encryType;
            vapParamSave.preSharedKey = $('#passwd' + band).prop('value');
        }
        if (band == '_2g') {
            $.act(ACT_SET, LAN_WLAN_MSSIDENTRY, vapObj_2g.__stack, null, vapParamSave);
        } else {
            $.act(ACT_SET, LAN_WLAN_MSSIDENTRY, vapObj_5g.__stack, null, vapParamSave);
        }
    }

    $.exe(function(ret) {});
}

function clickSaveAdv() {
    var guestIsolation = $('#seeEachOther').prop('data-checked') ? 1 : 0;
    var guestLanAccessEn = $('#accessLocal').prop('data-checked') ? 1 : 0;
    var guestUsbAccessEn = $('#accessUSB').prop('data-checked') ? 1 : 0;
    $.act(ACT_SET, LAN_WLAN_MSSIDENTRY, vapObj_2g.__stack, null, ['IsolateClients=' + guestIsolation]);
    $.act(ACT_SET, LAN_WLAN_MSSIDENTRY, vapObj_5g.__stack, null, ['IsolateClients=' + guestIsolation]);
    $.act(ACT_SET, LAN_WLAN_GUESTNET, wlanObj_2g.__stack, null, ['LANAccessEnable=' + guestLanAccessEn, 'USBAccessEnable=' + guestUsbAccessEn]);
    $.act(ACT_SET, LAN_WLAN_GUESTNET, wlanObj_5g.__stack, null, ['LANAccessEnable=' + guestLanAccessEn, 'USBAccessEnable=' + guestUsbAccessEn]);
    $.exe(function(ret) {});
}

function initSecType(vapParam, band) {
    if (vapParam.beaconType == "Basic" && vapParam.basicEncryptionModes == "None") {
        $('#noSec' + band).prop('checked', 'checked');
    } else if (vapParam.beaconType == "WPA") {
        if (vapParam.WPAAuthenticationMode == "PSKAuthentication") {
            $('#wpaSec' + band).prop('checked', 'checked');
        }
    } else if (vapParam.beaconType == "11i" || vapParam.beaconType == "WPAand11i") {
        if (vapParam.IEEE11iAuthenticationMode == "PSKAuthentication") {
            $('#wpaSec' + band).prop('checked', 'checked');
        }
    } else
    ;
}

function initPSKShow(vapParam, band) {
    if (vapParam.beaconType == "WPAand11i" && vapParam.WPAAuthenticationMode == "PSKAuthentication") {
        $('#autoVersion' + band).prop('checked', 'checked');
        if (vapParam.IEEE11iEncryptionModes == "TKIPEncryption") {
            $("#tkipEncryption" + band).prop('checked', 'checked');
        } else if (vapParam.IEEE11iEncryptionModes == "AESEncryption") {
            $("#aesEncryption" + band).prop('checked', 'checked');
        } else {
            $("#autoEncryption" + band).prop('checked', 'checked');
        }
    } else if (vapParam.beaconType == "WPA" && vapParam.WPAAuthenticationMode == "PSKAuthentication") {
        $('#wpaVersion' + band).prop('checked', 'checked');
        if (vapParam.WPAEncryptionModes == "TKIPEncryption") {
            $("#tkipEncryption" + band).prop('checked', 'checked');
        } else if (vapParam.WPAEncryptionModes == "AESEncryption") {
            $("#aesEncryption" + band).prop('checked', 'checked');
        } else {
            $("#autoEncryption" + band).prop('checked', 'checked');
        }
    } else if (vapParam.beaconType == "11i" && vapParam.IEEE11iAuthenticationMode == "PSKAuthentication") {
        $('#wpa2Version' + band).prop('checked', 'checked');
        if (vapParam.IEEE11iEncryptionModes == "TKIPEncryption") {
            $("#tkipEncryption" + band).prop('checked', 'checked');
        } else if (vapParam.IEEE11iEncryptionModes == "AESEncryption") {
            $("#aesEncryption" + band).prop('checked', 'checked');
        } else {
            $("#autoEncryption" + band).prop('checked', 'checked');
        }
    } else {
        $('#wpa2Version' + band).prop('checked', 'checked');
        $("#autoEncryption" + band).prop('checked', 'checked');
    }
    if (vapParam.preSharedKey == undefined) {
        $('#passwd' + band).prop('value', '');
    } else {
        $('#passwd' + band).prop('value', vapParam.preSharedKey);
    }
}

function initAdvancedShow() {
    if (vapObj_2g.isolateClients == 1) {
        $('#seeEachOther').prop('checked', 'checked');
    }
    if (vapObj_5g.isolateClients == 1) {
        $('#seeEachOther').prop('checked', 'checked');
    }
    if (guestnetObj_2g.LANAccessEnable == 1) {
        $('#accessLocal').prop('checked', 'checked');
    }
    if (guestnetObj_5g.LANAccessEnable == 1) {
        $('#accessLocal').prop('checked', 'checked');
    }
    if (guestnetObj_2g.USBAccessEnable == 1) {
        $('#accessUSB').prop('checked', 'checked');
    }
    if (guestnetObj_5g.USBAccessEnable == 1) {
        $('#accessUSB').prop('checked', 'checked');
    }
}

function initShow() {
    if ($.mainParam == undefined) {
        if (vapObj_2g.enable == 1) {
            $('#wlEn_2g').prop('checked', true);
            if (wlanObj_2g.enable == 0) {
                $.errorTip('wlEn_2g', ERR_WLAN_DISABLED);
            }
        }
        if (vapObj_5g.enable == 1) {
            $('#wlEn_5g').prop('checked', true);
            if (wlanObj_5g.enable == 0) {
                $.errorTip('wlEn_5g', ERR_WLAN_DISABLED);
            }
        }
        $('#ssid_2g').prop('value', vapObj_2g.SSID);
        $('#ssid_5g').prop('value', vapObj_5g.SSID);

        if (vapObj_2g.SSIDAdvertisementEnable == 0) {
            $('#hideSSID_2g').prop('checked', 'checked');
        }
        if (vapObj_5g.SSIDAdvertisementEnable == 0) {
            $('#hideSSID_5g').prop('checked', 'checked');
        }

        initSecType(vapObj_2g, '_2g');
        initSecType(vapObj_5g, '_5g');
        initPSKShow(vapObj_2g, '_2g');
        initPSKShow(vapObj_5g, '_5g');
        initAdvancedShow();
    } else {
        /*        $.id("guestEn2G").checked = $.mainParam[1][0] == 1 ? 1 : 0;
         $.id("guestDis").checked = $.mainParam[1][3] == 1 ? 1 : 0;
         $.id("guestEn5G").checked = $.mainParam[1][2] == 1 ? 1 : 0;
         $.id("guestSSID").value = $.mainParam[1][1];
         showGuestEnable();
         $.id("SecurityType").selectedIndex = $.mainParam[2][0];
         if ($.mainParam[2][0] == 1) {
         $.id("pskAuthType").selectedIndex = $.mainParam[2][1];
         $.id("pskCipher").selectedIndex = $.mainParam[2][2];
         $.id("pskSecret").value = $.mainParam[2][3];
         $.id("interval").value = $.mainParam[2][4];
         showPSK();
         }

         $.id("lan_access").selectedIndex = $.mainParam[3][0];
         $.id("usb_access").selectedIndex = $.mainParam[3][1];
         $.id("wlan_iso").selectedIndex = $.mainParam[3][2];

         $.id("guestTcEn").selectedIndex = 1;
         $.id("guestTcMinUpBW").value = $.mainParam[4][1];
         $.id("guestTcMaxUpBW").value = $.mainParam[4][2];
         $.id("guestTcMinDownBW").value = $.mainParam[4][3];
         $.id("guestTcMaxDownBW").value = $.mainParam[4][4];
         showTCAccess();
         showAdvanced($.id("advancedClick"));
         }
         if (wlanObj_2g.standard == "n-only") {
         $.id("pskCipher").selectedIndex = 2;
         $.id("pskCipher").disabled = true;
         }*/
    }
}

function init() {
    var basicList = $.act(ACT_GL, LAN_WLAN, null, null, ["Enable", "SSID", "X_TP_Band"]);
    if (!$.exe()) {
        $.each(basicList, function() {
            if ("2.4GHz" == this.X_TP_Band) {
                wlanObj_2g = this;
            }
            if ( /*INCLUDE_LAN_WLAN_DUALBAND &&*/ "5GHz" == this.X_TP_Band) {
                wlanObj_5g = this;
            }
        });
        wpsObj_2g = $.act(ACT_GET, LAN_WLAN_WPS, wlanObj_2g.__stack, null, ["Enable"]);
        wpsObj_5g = $.act(ACT_GET, LAN_WLAN_WPS, wlanObj_5g.__stack, null, ["Enable"]);
        mssidObj_2g = $.act(ACT_GET, LAN_WLAN_MULTISSID, wlanObj_2g.__stack, null, ["MultiSSIDEnable"]);
        mssidObj_5g = $.act(ACT_GET, LAN_WLAN_MULTISSID, wlanObj_5g.__stack, null, ["MultiSSIDEnable"]);
        vapList_2g = $.act(ACT_GS, LAN_WLAN_MSSIDENTRY, null, wlanObj_2g.__stack, ["Name", "Enable", "SSID", "SSIDAdvertisementEnable", "isolateClients", "BeaconType", "BasicAuthenticationMode", "WEPKeyIndex", "BasicEncryptionModes", "WPAEncryptionModes", "WPAAuthenticationMode", "IEEE11iEncryptionModes", "IEEE11iAuthenticationMode", "PreSharedKey", "GroupKeyUpdateInterval", "RadiusServerIP", "RadiusServerPort", "RadiusServerPassword"]);
        vapList_5g = $.act(ACT_GS, LAN_WLAN_MSSIDENTRY, null, wlanObj_5g.__stack, ["Name", "Enable", "SSID", "SSIDAdvertisementEnable", "isolateClients", "BeaconType", "BasicAuthenticationMode", "WEPKeyIndex", "BasicEncryptionModes", "WPAEncryptionModes", "WPAAuthenticationMode", "IEEE11iEncryptionModes", "IEEE11iAuthenticationMode", "PreSharedKey", "GroupKeyUpdateInterval", "RadiusServerIP", "RadiusServerPort", "RadiusServerPassword"]);

        guestnetObj_2g = $.act(ACT_GET, LAN_WLAN_GUESTNET, wlanObj_2g.__stack, null, ["Enable", "Name", "IsModified", "LANAccessEnable", "USBAccessEnable", "TCEnable", "TCMaxUpBW", "TCMinUpBW", "TCMaxDownBW", "TCMinDownBW", "TCRuleID"]);
        guestnetObj_5g = $.act(ACT_GET, LAN_WLAN_GUESTNET, wlanObj_5g.__stack, null, ["Enable", "Name", "IsModified", "LANAccessEnable", "USBAccessEnable", "TCEnable", "TCMaxUpBW", "TCMinUpBW", "TCMaxDownBW", "TCMinDownBW", "TCRuleID"]);
        tcEntry = $.act(ACT_GET, TC, null, null);
        if (!$.exe()) {
            qssEnable_2g = wpsObj_2g.enable;
            qssEnable_5g = wpsObj_5g.enable;
            $.each(vapList_2g, function(arg, index) {
                if (this.name == guestnetObj_2g.name)
                    vapObj_2g = this;
            });
            $.each(vapList_5g, function(arg, index) {
                if (this.name == guestnetObj_5g.name)
                    vapObj_5g = this;
            });
            if (guestnetObj_2g.enable == true) {
                /*                vapObj = vapObj_2g;
                 guestnetObj = guestnetObj_2g;*/
            }
            if (guestnetObj_5g.enable == true) {
                /*                vapObj = vapObj_5g;
                 guestnetObj = guestnetObj_5g;*/
            }
        }
        initShow();
    }
}
$("#wpaSec_2g").on('click.guestNetwork', function(e) {
    $("#hideWpaSec_2g").show("fast");
});
$("#noSec_2g").on('click.guestNetwork', function(e) {
    $("#hideWpaSec_2g").hide("fast");
});
$("#wpaSec_5g").on('click.guestNetwork', function(e) {
    $("#hideWpaSec_5g").show("fast");
});
$("#noSec_5g").on('click.guestNetwork', function(e) {
    $("#hideWpaSec_5g").hide("fast");
});
$('#save_2g').on('click.guestNetwork', function(e) {
    clickSave('_2g');
});
$('#save_5g').on('click.guestNetwork', function(e) {
    clickSave('_5g');
});
$('#saveAdv').on('click.guestNetwork', function(e) {
    clickSaveAdv();
});
</script>
<h3>Settings</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div>
            <b>See each other:</b>
            <input type="checkbox" id="seeEachOther" />
            <label>Allow guests to see each other</label>
        </div>
        <div>
            <b>Access my local network:</b>
            <input type="checkbox" id="accessLocal" />
            <label>Allow guests to access to my local network</label>
        </div>
        <div>
            <b>USB Storage Sharing:</b>
            <input type="checkbox" id="accessUSB" />
            <label>Allow Guests to access my USB Storage Sharing</label>
        </div>
        <button type="submit" class="green" id="saveAdv">Save</button>
    </form>
</div>

<h3>Wireless</h3>
<div class="content-container">
    <div class="mode-change">
        <span class="mode-select">2.4GHz</span>
        <span>5GHz</span>
    </div>
    <form class="pure-form pure-form-aligned">
        <div>
            <b>Wireless radio:</b>
            <input type="checkbox" id="wlEn_2g" />
            <label>Enable Wireless Radio</label>
        </div>
        <div class="inline">
            <b>Name(SSID):</b>
            <input type="text" id="ssid_2g" class="xl" />
        </div>
        <div class="inline">
            <input type="checkbox" id="hideSSID_2g" />
            <label>Hide SSID</label>
        </div>

        <div>
            <b>Security:</b>
            <input type="radio" name="security_2g" id="noSec_2g" />
            <label>No Security</label>
            <input type="radio" name="security_2g" id="wpaSec_2g" />
            <label>WPA/WPA2 Personal</label>
        </div>
        <div id="hideWpaSec_2g" class="nd">
            <div>
                <b>Version:</b>
                <input type="radio" name="version_2g" id="autoVersion_2g" />
                <label>Auto</label>
                <input type="radio" name="version_2g" id="wpaVersion_2g" />
                <label>WPA-PSK</label>
                <input type="radio" name="version_2g" id="wpa2Version_2g" />
                <label>WPA2-PSK</label>
            </div>

            <div>
                <b>Encryption:</b>
                <input type="radio" name="encryption_2g" id="autoEncryption_2g" />
                <label>Auto</label>
                <input type="radio" name="encryption_2g" id="tkipEncryption_2g" />
                <label>TKIP</label>
                <input type="radio" name="encryption_2g" id="aesEncryption_2g" />
                <label>AES</label>
            </div>

            <div class="pure-control-group">
                <label class="label_title"><b>Wireless Password:</b>
                </label>
                <input type="text" class="tp-input-text" id="passwd_2g" />
            </div>
        </div>

        <button type="submit" class="green" id="save_2g">Save</button>
    </form>

    <form class="pure-form pure-form-aligned">
        <div>
            <b>Wireless radio:</b>
            <input type="checkbox" id="wlEn_5g" />
            <label>Enable Wireless Radio</label>
        </div>

        <div class="inline">
            <b>Name(SSID):</b>
            <input type="text" id="ssid_5g" class="xl" />
        </div>
        <div class="inline">
            <input type="checkbox" id="hideSSID_5g" />
            <label>Hide SSID</label>
        </div>

        <div>
            <b>Security:</b>
            <input type="radio" name="security_5g" id="noSec_5g" />
            <label>No Security</label>
            <input type="radio" name="security_5g" id="wpaSec_5g" />
            <label>WPA/WPA2 Personal</label>
        </div>
        <div id="hideWpaSec_5g" class="nd">
            <div>
                <b>Version:</b>
                <input type="radio" name="version_5g" id="autoVersion_5g" />
                <label>Auto</label>
                <input type="radio" name="version_5g" id="wpaVersion_5g" />
                <label>WPA-PSK</label>
                <input type="radio" name="version_5g" id="wpa2Version_5g" />
                <label>WPA2-PSK</label>
            </div>

            <div>
                <b>Encryption:</b>
                <input type="radio" name="encryption_5g" id="autoEncryption_5g" />
                <label>Auto</label>
                <input type="radio" name="encryption_5g" id="tkipEncryption_5g" />
                <label>TKIP</label>
                <input type="radio" name="encryption_5g" id="aesEncryption_5g" />
                <label>AES</label>
            </div>

            <div class="pure-control-group">
                <label class="label_title"><b>Wireless Password:</b>
                </label>
                <input type="text" class="tp-input-text" id="passwd_5g" />
            </div>
        </div>

        <button type="submit" class="green" id="save_5g">Save</button>
    </form>
</div>

<script type="text/javascript">
$.tpInit(init);
</script>
