<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" manifest="app.manifest">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- <link type="text/css" href="css/reset.css" rel="stylesheet" /> -->
<link type="text/css" href="css/widget.css" rel="stylesheet" />

<link type="text/css" href="themes/blue/css/widget.css" rel="stylesheet" />
<link type="text/css" href="themes/blue/css/style.css" rel="stylesheet" />

<!--[if lte IE 8]>
<meta http-equiv="X-UA-Compatible" content="IE=8" />
<link href="themes/blue/css/ie.css" rel="stylesheet" type="text/css" />
<![endif]-->

<!--[if lte IE 7]>
<link href="themes/blue/css/ie.css" rel="stylesheet" type="text/css" />
<![endif]-->

<!--[if lte IE 6]>
<link href="themes/blue/css/ie.css" rel="stylesheet" type="text/css" />
<![endif]-->

<title>Opening...</title>
</head>

<body>
<!--主界面-->
<div class="top" id="top-wrapper">
    <div class="top-bg">
        <div class="top-bg-l"></div>
        <!-- <div class="top-bg-r"></div> -->
    </div><!-- background -->
    <div class="top-header">
		<div class="top-header-wrap">
        	<h1 id="product-tag"></h1>
            <div class="top-nav" id="top-nav">
                <!-- 菜单需要考虑的问题：1、动态加载；2、字符由charset控制 -->
                <ul id="ul-nav">
                    <li class="fst"><a class="nav" name="quick_setup" href="pages/frame/quick-setup.html">
                        <span></span>
                    </a></li><li><a id="settings_link" class="nav" name="setting" href="pages/frame/settings.html">
                        <span></span>
                    </a></li><!--<li><a class="nav" name="advanced" href="pages/frame/advanced.html">
                        <span></span>
                    </a></li>-->
                </ul><!-- <li class="separator"></li> -->
            </div><!-- top-nav -->
            
            <div id="top-control" class="top-control">
            	<!--<div id="lan-select" class="lan-select-container">
                    <select id="lan-select">
                        <option>English</option>
                        <option>中文</option>
                    </select>--><!-- lan-select -->
                <!--</div>-->
                <div class="lan-select-container">
                    <input id="lan-select" />
                </div>
                
                
             <!--    <a class="top-control-btn" id="top-control-led" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span class="text">LED</span>
                </a> -->
                <a class="top-control-btn" id="top-control-sysmode" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="txt-sysmode" class="text"></span>
                </a>
                <a class="top-control-btn" id="top-control-logout" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="txt-logout" class="text"></span>
                </a>
                <a class="top-control-btn" id="top-control-reboot" href="javascript:void(0);" >
                    <span class="icon"></span>
                    <span id="txt-reboot" class="text"></span>
                </a>
            </div>
        </div>
    </div><!-- top-header -->
    
    <div class="top-main">
        <div class="top-main-wrap">
            <div class="top-content">
                <div class="top-content-wrap" id="top-content">
                </div>
            </div><!-- top-content -->
            
            
            <div class="top-footer">
                <div class="top-footer-wrap">
                    <span id="product-info">
                        <span id="firmware-version-title"></span>
                        <span id="firmware-version-content"></span>
                        <span id="hardware-version-title"></span>
                        <span id="hardware-version-content"></span>
                    </span>
                            
                    <span class="help-faq">
                        <a id="btn-faq" class="btn-faq" href="http://www.tp-link.com/en/Support/" target="_blank"></a>
                    </span>
                </div>
            </div><!-- top-footer -->
        </div>
    </div>

</div><!-- top-wrapper -->

<!--遮蔽层-->
<div id="mask" class="mask"></div>
<!--loading-->
<div class="loading-container" id="loading-container">
    <div class="loading-container-wrap">
        <div class="loading-container-inner">
            <div class="loading-waiting-icon"></div>
        </div>
    </div>
</div>

<!-- 重启和登出的确认 -->
<div id="reboot_confirm_msg" class="hidden warning">
    <div id="reboot_confirm_qa">
        <h4 class="title">
            <span class="icon"></span>
            <span class="text" id="reboot-confirm-msg-text"></span>
        </h4>
    </div>

    <div id="loading_msg" class="reboot-loading-msg hidden">
        <p id="reboot_progressbar_text" class="reboot-progressbar-text"></p>
        <input id="reboot_loading_progressbar" />
    </div>
</div>

<!-- /////////////////////////////////////////////////////////////// -->
<div id="mode_choose_msg" class="hidden">
    <div class="reboot-confirm-qa">
        <h4 class="title">
            <span class="icon"></span>
            <span id="mode_choose_text" class="text mode-switch-text"></span>
        </h4>

        <div id="mode_reboot_content">
            <input id="mode_choose_input" name="mode" type="text" class=""/>
            <p id="ap_tips" class="mode-slt-p"></p>
            <p id="router_tips" class="mode-slt-p"></p>
            <p id="repeater_tips" class="mode-slt-p"></p>
        </div>
    </div>
</div>

<div id="mode_reboot_msg">
    <div id="mode_reboot_note_content">
        <p id="mode_reboot_note"></p>
    </div>
</div>

<div id="mode_fail_msg" class="warning hidden">
    <div id="mode_change_fail" class="">
        <h4 class="title">
            <span class="icon"></span>
            <span id="mode_fail_title" class="text"></span>
        </h4>
    </div>    
</div>

<div id="logout_confirm_msg" class="hidden warning">
    <div class="reboot-confirm-qa">
        <h4 class="title">
            <span class="icon"></span>
            <span class="text" id="logout_confirm_msg_text"></span>
        </h4>
    </div>
</div>

<!-- 提示用户设置登录名和密码 -->
<div id="reset-user-msg-container" class="hidden">
    <div id="reset-user-form">
        <!--<h4 id="reset-user-title" class="title title"></h4>-->
        <div class="reset-user-content">
            <input id="reset-user-new-username" name="new_acc" />
            <input id="reset-user-new-password" />
            <input id="reset-user-confirm-password" />
            <input id="new-password" name="new_pwd" />
            <input id="confirm-password" name="cfm_pwd" />
            <input id="reset-user-confirm-password-status" />
            <input id="md5_pwd" name="md5_pwd" />
        </div>
        <button type="button" id="btn-reset-user"></button>
    </div>
</div>

<!--全局警告提示框-->
<div id="global-warning-msg" class="hidden warning">
    <h4 class="title">
        <span class="icon"></span>
        <span class="text" id="global-warning-text-perssion-denied"></span>
    </h4>
</div>

<!--
以下是js部分
-->



<!--  jquery框架加载  -->
<script type="text/javascript" src="js/libs/jquery.min.js"></script>
<script type="text/javascript" src="js/libs/jquery.scrollTo.min.js"></script>
<!-- <script type="text/javascript" src="js/libs/jquery.json-2.4.min.js"></script> -->
<!-- <script type="text/javascript" src="js/libs/jquery.extend.js"></script> -->
<!-- <script type="text/javascript" src="js/libs/jquery.cookies.min.js"></script> -->

<!--  语言部分加载  -->

<!-- <script id="lan-js" type="text/javascript" src="locale/en_US/lan.js"></script>
<link id="lan-css" type="text/css" rel="stylesheet" href="locale/en_US/lan.css" /> -->

<script type="text/javascript" src="js/su/locale.js"></script>
<script type="text/javascript">
//<![CDATA[
    try{
        $.su.locale.URL_LAN_CHECK = "./data/lang.json";  //$.su.url("/locale?form=lang");
    $.su.locale.get();
    }catch(error){
        location.href = "./error.html";
    };
//]]>
</script>

<!--  引入框架代码， 最后需要统一到一个文件下面  -->
<!--<script type="text/javascript" src="js/su/su.full-min.js"></script>
<script type="text/javascript" src="js/libs/encrypt.js"></script>-->
<script type="text/javascript" src="js/su/su.js"></script>
<script type="text/javascript" src="js/libs/encrypt.js"></script>
<script type="text/javascript" src="js/libs/md5.js"></script>

<script type="text/javascript" src="js/su/data/proxy.js"></script>
<script type="text/javascript" src="js/su/data/store.js"></script>
<script type="text/javascript" src="js/su/data/treestore.js"></script>

<script type="text/javascript" src="js/su/widget/widget.js"></script>

<script type="text/javascript" src="js/su/widget/window/panel.js"></script>
<script type="text/javascript" src="js/su/widget/window/page.js"></script>
<script type="text/javascript" src="js/su/widget/window/wizard.js"></script>
<script type="text/javascript" src="js/su/widget/window/msg.js"></script>
<script type="text/javascript" src="js/su/widget/window/foldertree.js"></script>
<script type="text/javascript" src="js/su/widget/window/keyword.js"></script>

<script type="text/javascript" src="js/su/widget/grid/grid.js"></script>
<script type="text/javascript" src="js/su/widget/grid/editor.js"></script>
<script type="text/javascript" src="js/su/widget/grid/paging.js"></script>

<script type="text/javascript" src="js/su/widget/form/form.js"></script>
<script type="text/javascript" src="js/su/widget/form/fieldset.js"></script>
<script type="text/javascript" src="js/su/widget/form/combobox.js"></script>
<script type="text/javascript" src="js/su/widget/form/checkbox.js"></script>
<script type="text/javascript" src="js/su/widget/form/radio.js"></script>
<script type="text/javascript" src="js/su/widget/form/textbox.js"></script>
<script type="text/javascript" src="js/su/widget/form/textarea.js"></script>
<script type="text/javascript" src="js/su/widget/form/button.js"></script>
<script type="text/javascript" src="js/su/widget/form/time.js"></script>
<script type="text/javascript" src="js/su/widget/form/file.js"></script>
<script type="text/javascript" src="js/su/widget/form/buttongroup.js"></script>
<script type="text/javascript" src="js/su/widget/form/timepicker.js"></script>
<script type="text/javascript" src="js/su/widget/form/progressbar.js"></script>
<script type="text/javascript" src="js/su/widget/form/tip.js"></script>
<script type="text/javascript" src="js/su/widget/form/region.js"></script>
<script type="text/javascript" src="js/su/widget/form/password.js"></script>
<script type="text/javascript" src="js/su/widget/form/switch.js"></script>
<script type="text/javascript" src="js/su/widget/form/status.js"></script>

<!--  运行时代码  -->
<script type="text/javascript">
//<![CDATA[
$(document).ready(function(e){

//用户登出url
var URL_LOGOUT = "./data/logout.json"; //"./data/login.json"
var URL_REBOOT = "./data/reboot.json"; //"./data/login.json"

var logoutProxy = new $.su.Proxy({
    url: URL_LOGOUT,
    autoLoad: false
});

var rebootProxy = new $.su.Proxy({
    url: URL_REBOOT,
    autoLoad: false
});


//index页面初始化
/**********SRT*多语言选择框*SRT*********/
//注意：需要判断是否更改，否则不发送信息~
var lanSelectCombo = $("input#lan-select").combobox({
    cls: "top-lan-select",
    items: [
        {"value": "en_US", "name": $.su.CHAR.LANGUAGE.EN_US},
        {"value": "zh_CN", "name": $.su.CHAR.LANGUAGE.ZH_CN}
    ],
    fieldLabel: null
}).on("ev_click", function(e, vOld, vNew){
    //console.log(vOld, vNew)
    if (vOld[0] == vNew[0]){
        return;
    };
    $.su.locale.set(vNew[0], function(){
        lanSelectCombo.combobox("setValue", [$.su.locale.locale]);
    }, function(){
        lanSelectCombo.combobox("setValue", [$.su.locale.locale]);
    });
}).combobox("setValue", [$.su.locale.locale]);

document.title = $.su.locale.model;
$("h1#product-tag").text($.su.locale.model);

$("span#txt-sysmode").text($.su.CHAR.CONTROL.MODE);
$("span#txt-logout").text($.su.CHAR.CONTROL.LOGOUT);
$("span#txt-reboot").text($.su.CHAR.CONTROL.REBOOT);

$("span#firmware-version-title").html($.su.CHAR.INDEX.FIRMWARE_VERSION);
$("span#hardware-version-title").html($.su.CHAR.INDEX.HARDWARE_VERSION);
$("a#btn-faq").html($.su.CHAR.INDEX.HELP_SUPPORT);

$('span#mode_fail_title').html($.su.CHAR.INDEX.MODE_FAIL_TIP);

if ($.su.locale.force){
    lanSelectCombo.combobox("hide");
};
/**********END*多语言选择框*END*********/

/**********STR*用户登录信息*STR**********/
var rebootConfirmMsg = $("div#reboot_confirm_msg").msg({
    type: "confirm",
    global: true,
    cls: 'reboot-confirm-size',
    closeBtn: false,
    okHandler: function(e){
        $('div#reboot_confirm_qa').hide();
        $('div#loading_msg').show();
        rebootConfirmMsg.msg('hideButtons');

        rebootProxy.write();
        reboot_pro_bar.progressbar("reset").progressbar('animate',  0, 1, 50*1000, function(){
            location.href = "/";
        });
        
        return false;
	},
    cancelHandler: function(){
        rebootConfirmMsg.msg('hide');
    }
});

/*var rebootLoadingMsg = $("div#reboot-loading-msg").msg({
    type: "window",
    global: true
});*/

$('p#ap_tips').html($.su.CHAR.INDEX.ACCESS_POINT_TIPS);
$('p#router_tips').html($.su.CHAR.INDEX.ROUTER_TIPS);
$('p#repeater_tips').html($.su.CHAR.INDEX.REPEATER_TIPS);
$('span#mode_choose_text').html($.su.CHAR.INDEX.MODE_SWITCH);
$('p#mode_reboot_note').html($.su.CHAR.INDEX.MODE_REBOOT_TIP);

var sysMode = '';

var modeProxy = new $.su.Proxy({
    url: './data/sysmode.json'
});

modeProxy.read({}, function(data){
    window.sysMode = data.mode;

    if(data.support.toUpperCase()=='YES'){
        $('a#top-control-sysmode').show();
        $('input#mode_choose_input').radio('setValue', data.mode);
    }else{
        $('a#top-control-sysmode').hide();
    }
});

var modeSltMsg = $("div#mode_choose_msg").msg({
    type: "confirm",
    global: true,
    closeBtn: false,
    cls: "l",
    yesText: $.su.CHAR.OPERATION.SAVE,
    noText: $.su.CHAR.OPERATION.CANCEL,
    okHandler: function(e){
        var modePara = $('input#mode_choose_input').radio('getValue');

        if(window.sysMode.toUpperCase() != modePara.toUpperCase()){
            modeRebootMsg.msg('show');
        }
    },
	noHandler:function(){
		$('input#mode_choose_input').radio('setValue', window.sysMode);
    }
});


var modeFailMsg = $("div#mode_fail_msg").msg({
    type: "alert",
    global: true,
    closeBtn: false,
    cls: "l"
});

var modeRebootMsg = $("div#mode_reboot_msg").msg({
    type: "confirm",
    global: true,
    closeBtn: false,
    cls: "l",
    // yesText: $.su.CHAR.OPERATION.SAVE,
    // noText: $.su.CHAR.OPERATION.CANCEL,
    okHandler: function(e){

        modeProxy.write({mode: $('input#mode_choose_input').radio('getValue')}, function(data){
            $('div#reboot_confirm_qa').hide();
            $('div#loading_msg').show();
            rebootConfirmMsg.msg('hideButtons');
            
            rebootConfirmMsg.msg("show");

            // rebootProxy.write();
            reboot_pro_bar.progressbar("reset").progressbar('animate',  0, 1, 60*1000, function(){
                if (localStorage){
                    localStorage.setItem("token", "");
                };

                location.href = 'http://tplinkwifi.net';

                /*if(data.mode=='router'){
                    location.href = 'http://tplinkwifi.net';
                }else{
                    location.href = 'http://tplinkrepeater.net';
                }*/
            });            

        }, function(){
            modeFailMsg.msg('show');
            // $('div#mode_reboot_note_content').hide();
            $('div#mode_change_fail').show();
        }, function(){
            modeFailMsg.msg('show');
            // $('div#mode_reboot_note_content').hide();
            $('div#mode_change_fail').show();
        });
    }
});

$('input#mode_choose_input').radio({
    fieldLabel: null,
    items:[
        {boxlabel: $.su.CHAR.INDEX.ACCESS_POINT, inputValue:'ap', id:'ap', name:'mode', content:'#ap_tips'},
        {boxlabel: $.su.CHAR.INDEX.ROUTER, inputValue: 'router', id:'router', name:'mode', content:'#router_tips'},
        {boxlabel: $.su.CHAR.INDEX.REPEATER, inputValue: 'repeater', id:'repeater', name:'mode', content:'#repeater_tips'}
    ]
});	

var logoutConfirmMsg = $("div#logout_confirm_msg").msg({
    type: "confirm",
    global: true,
    closeBtn: false,
    cls: "reboot-confirm-size",
    okHandler: function(e){
        logoutProxy.write({}, function(){
            location.href = "/";
        });
	}
});

var reboot_pro_bar = $('input#reboot_loading_progressbar').progressbar({
    fieldLabel: null,
    width: 326,
    height: 6,
    isProgressbar: true,
    cls: 'reboot-loading-probar'
});

$('span#reboot-confirm-msg-text').html($.su.CHAR.INDEX.CONFIRM_REBOOT);
$('p#reboot_progressbar_text').html($.su.CHAR.INDEX.REBOOTING);
$('span#logout_confirm_msg_text').html($.su.CHAR.INDEX.CONFIRM_LOGOUT);

$("a#top-control-sysmode").click(function(e){
    modeSltMsg.msg("show");
});

$("a#top-control-logout").click(function(e){
    logoutConfirmMsg.msg("show");
});

$("a#top-control-reboot").click(function(e){
    rebootConfirmMsg.msg("show");
});

/**********END*用户登录信息*END**********/

/**********SRT*警告信息*SRT**********/
$("span#global-warning-text-perssion-denied").html($.su.CHAR.ERROR["00000088"]);
var warningMsg = $("div#global-warning-msg").msg({
    type: "alert",
    global: true,
    cls: "m",
    closeBtn: false
});

/**********END*警告信息*END**********/

/**********SRT*软硬件版本信息*SRT*********/

var firmwareProxy = new $.su.Proxy({
    async: false,
    url: './data/firmware.set.json'
});

var firstLog = false;
var rsa;
firmwareProxy.read({}, function(data){


	var rsaURL = new $.su.Proxy({
		async: false,
		url: './data/account.pwd.json'
	});
	rsaURL.read({operation:"read"}, function(data){
		if (data) rsa=data.new_pwd;
	}, function(){
	}, function(){
	});
	
    var firmware = $("span#firmware-version-content");
    var hardware = $("span#hardware-version-content");
    if (data){
        if (data.firmware_version){
            firmware.html(data.firmware_version);
        }else{
            firmware.css("display", "none");
        };
        if (data.hardware_version){
            hardware.html(data.hardware_version);
        }else{
            hardware.css("display", "none");
        };

        if (data.is_default == true){
            firstLog = true;
        };
    }else{
        $("span#product-info").css("display", "none");
    };
}, function(){
    $("span#product-info").css("display", "none");
}, function(){
    $("span#product-info").css("display", "none");
});

/**********END*软硬件版本信息*END*********/

/**********STR*app定义*STR*********/
$.su.app = {
    /*runningModule: $({
        name: ""
    }),
    init: function(){
        $.su.app.runningModule.on("ev_unload", function(e, name){
            $.su.app.runningModule[0]["name"] = name;
            //console.log("ev_unload");
            $.su.app.runningModule.off("ev_beforeunload");
        });
    },*/
    runningModule: {
        name: "",
        addUnloadHandler: function(fn){
            if ($.isFunction(fn)){
                this.unloadHandlers.push(fn);
            }
        },
        clearUnloadHandler: function(){
            this.unloadHandlers = [];
        },
        unload: function(oldN, newN){
            this.name = newN;
            var handlers = this.unloadHandlers;
            for (var index in handlers){
                var fn = handlers[index];
                if ($.isFunction(fn)){
                    fn();
                }
            };
            this.clearUnloadHandler();
        },
        unloadHandlers: []
    },
    errorOperation: {
        denied: function(){
            $("div#global-warning-msg").msg("show");
        },
        userConflict: function(){
            //操作中用户冲突的回调
        }
    },
    navGoTo: function(name, url){
        var contentContainer = $("div#top-content");
        //旧模块卸载
        $.su.Manager.removeLocal();
        $.su.loading.show();

        /*if (name != "quick_setup"){
            //非quicksetup
            
            
            contentContainer.load(url, {}, function(response,status,xhr){
                $.su.layout.doLayout();
                $.su.loading.hide();
            });
        }else{*/
            //$.su.app.runningModule.trigger("ev_beforeunload", [$.su.app.runningModule[0].name, name]);
            var runningModule = $.su.app.runningModule;
                runningModule.unload(runningModule.name, name);

            contentContainer.load(url, {}, function(response,status,xhr){
                //$.su.app.runningModule.trigger("ev_unload", [name]);
                $.su.layout.doLayout();
            //$.su.loading.hide();
            });

        //}
    },
    menuGoTo: function(name, url, isAdvanced){
        var contentContainer = isAdvanced ? $("div#func-advanced") : $("div#func-basic");
        //旧模块卸载
        $.su.Manager.removeLocal();
        //var runningModule = $.su.app.runningModule;
        //$.su.app.runningModule.trigger("ev_beforeunload", [$.su.app.runningModule[0].name, name]);
        //console.log("menuGoTo", runningModule)
        var runningModule = $.su.app.runningModule;
            runningModule.unload(runningModule.name, name);

        $.su.loading.show();
        contentContainer.load(url, {}, function(response,status,xhr){
            //$.su.app.runningModule.trigger("ev_unload", [name]);
            
            $.su.layout.doLayout();
            /*$("div.top-main").scrollTo({
                top: 0,
                left: 0
            }, 100);*/
            $("div.top-main").scrollTo(0);
            $.su.loading.hide();
        });
    }   
};
//$.su.app.init();
/**********END*app定义*END*********/

/**********STR*菜单部分效果*STR**********/
$.su.nav = (function(){
	var nav = {};
	//字符串初始化
	var navItems = $("ul#ul-nav li a");
	navItems.each(function(index, element){
		var me = $(element),
			name = me.attr("name");
        me.html("<span>"+$.su.CHAR.NAV[name.toUpperCase()]+"</span>");
    });
	
	navItems.on("click", function(e){
		e.preventDefault();
		var me = $(this),
            name = me.attr("name");
		
		$.su.nav.goTo(name);
		
	});
	
	nav.goTo = function(name){
        var item = $("ul#ul-nav li a[name='"+name+"']");
        var url = item.attr("href");

        $("ul#ul-nav li").removeClass("selected");
        item.closest("li").addClass("selected");
        $.su.app.navGoTo(name, url);
	};
	
	return nav;
})();

if (firstLog){
    $.su.nav.goTo("quick_setup");

	
	
	
    var resetUserMsg = $("div#reset-user-msg-container").msg({
        type: "window",
        global: true,
        title: $.su.CHAR.QUICK_SETUP.RESET_USER_TITLE,
        cls: "l reset-user"
    });

    //$("h4#reset-user-title").html($.su.CHAR.QUICK_SETUP.RESET_USER_TITLE);

    $("input#reset-user-new-username").textbox({
        fieldLabel: $.su.CHAR.QUICK_SETUP.NEW_USERNAME,
		vtype:"name",
		minLength:1,
		maxLength:15,
        allowBlank: false
    });

    var passwordCheck = function(new_pwd, cfm_val){
        
        if(cfm_val == new_pwd){
            resetUserConfirmPasswordStatus.status("setSuccess");
            return true;
        }else{
            resetUserConfirmPasswordStatus.status("setFailed");
            return false;
        };
    };
    
    var resetUserNewPassword = $("input#reset-user-new-password").password({
        fieldLabel: $.su.CHAR.QUICK_SETUP.NEW_PASSWORD,
        showLevel: true,
        allowBlank: false,
		vtype:"password",
		encrypt: $.su.encrypt,
		encryptParam: rsa,
    }).on("ev_change", function(){
        resetUserConfirmPasswordStatus.status('setNormal');
        resetUserConfirmPassword.password('setNormal');
        
        var new_pwd = resetUserNewPassword.password("getValue");
        var cfm_val = resetUserConfirmPassword.password("getValue");
		$("input#md5_pwd").textbox('setValue', $.su.md5(new_pwd).toUpperCase());
		$("input#new-password").textbox('setValue', $.su.encrypt(new_pwd,rsa).toUpperCase());
		$("input#confirm-password").textbox('setValue', $("input#new-password").textbox('getValue'));
        if (cfm_val){
            passwordCheck(new_pwd, cfm_val);
        }
    }).on("ev_validatechange", function(){  
        
        var new_pwd = resetUserNewPassword.password("getValue");
        var cfm_val = resetUserConfirmPassword.password("getValue");

        if( cfm_val=='' ){
            resetUserConfirmPasswordStatus.status('setNormal');
            return true;
        }else{
            passwordCheck(new_pwd, cfm_val);
        };
    });

    var resetUserConfirmPassword = $("input#reset-user-confirm-password").password({
        fieldLabel: $.su.CHAR.QUICK_SETUP.CONFIRM_PASSWORD,
        showLevel: false,
        cls: "inline-block",
        allowBlank: false,
		vtype:"password",
		encrypt: $.su.encrypt,
		encryptParam: rsa,
    }).on("ev_change ev_validatechange", function(e, value, key, keyCode){
        var new_pwd = resetUserNewPassword.password("getValue");
        var cfm_val = resetUserConfirmPassword.password("getValue");
        
        if (new_pwd == ""){
            if ( cfm_val == "" ){
                resetUserConfirmPasswordStatus.status("setNormal");
            }else{
                if (!passwordCheck(new_pwd, cfm_val)){
                    resetUserConfirmPassword.password("setError");
                };
            }
        }else{
            if (!passwordCheck(new_pwd, cfm_val)){
                resetUserConfirmPassword.password("setError");
            }
        }

        if (key == "Enter" || keyCode == 13){
                resetUserForm.form("submit", {
                    "operation": "write",
					"old_acc": "admin",
					"old_pwd": $.su.md5("admin").toUpperCase()
                }, function(){
                    resetUserMsg.msg("close");
                });
        };

    });

    var resetUserConfirmPasswordStatus = $("input#reset-user-confirm-password-status").status({
        cls: "inline-block"
    });

    $("button#btn-reset-user").button({
        text: $.su.CHAR.QUICK_SETUP.CONFIRM,
        cls: "submit",
        handler: function(){
            resetUserForm.form("submit", {
                "operation": "write",
				"old_acc": "admin",
				"old_pwd": $.su.md5("admin").toUpperCase()
            }, function(){
                resetUserMsg.msg("close");
            });
        }
    });
	$("input#new-password").textbox({
		fieldLabel: $.su.CHAR.ACCOUNT.NEWPWD,
		cls: 'hidden'
	});
	$("input#confirm-password").textbox({
		fieldLabel: $.su.CHAR.ACCOUNT.NEWPWD,
		cls: 'hidden'
	});
	$("input#md5_pwd").textbox({
		fieldLabel: $.su.CHAR.ACCOUNT.NEWPWD,
		cls: 'hidden'
	});
	
    var resetUserForm = $("div#reset-user-form").form({
        proxy: {
            url: "./data/account.pwd.json"
        },
        autoLoad: false,
        fields: [
            {name: "new_pwd", mapping: "new_pwd"},
            {name: "new_acc", mapping: "new_acc"},
            {name: "cfm_pwd", mapping: "cfm_pwd"},
            {name: "md5_pwd", mapping: "md5_pwd"}
        ],
        submitBtn: "#btn-reset-user",
        validator: function(){
            var p1 = resetUserNewPassword.password("getValue");
            var p2 = resetUserConfirmPassword.password("getValue");
            if (p1 === p2){
                resetUserConfirmPasswordStatus.status("setSuccess");
                return true;
            }else{
                resetUserConfirmPassword.password("setError", $.su.CHAR.ERROR["00000080"]);
                return false;
            }
        }
    });

    //console.log("show resetUserMsg")
    resetUserMsg.msg("show");
	setTimeout(function(){
		$("input#reset-user-new-username").focus();
	},10);
}else{
    $.su.nav.goTo("setting");
    $("div#reset-user-msg-container").remove();
};
/**********END*菜单部分效果*END**********/

/**********SRT*布局调整*SRT*********/
$.su.layout.doLayout = function(){
    //alert("layout");
    //console.log($.su.app.runningModule.name);

    var mh = $("div.menu-container").height(),
        hh = $("div.top-header").height(),
        fh = $("div.top-footer").height(),
        wh = $(window).height();

    //$("div.function-container").css("height", "inherit");

    $("div.top-main").css({
        height: wh - hh
    });

    var th = $("div.top-main").height(),
        ch = wh - hh - fh,
        h = Math.max(mh, ch);

    $("body").css({
        "height": wh
    });

    var c = $("div.function-container");
    var pT = parseInt(c.css("paddingTop"), 10);
    var pB = parseInt(c.css("paddingBottom"), 10);

    $("div.function-container").css({
        "min-height": h - pT -pB
    });

    //alert(wh, hh, fh, mh, ch, h, pT, pB);
        
    if ($.su.app.runningModule.name === "quick_setup"){
        var wh = $(window).height(),
            fh = $("div.top-footer").height(),
            hh = $("div.top-header").height();

        var c = $("div#quicksetup-form").css("height", "inherit");

        var ch = $("div#top-content").height(),
            h = ch;

        if (fh+hh+ch >= wh){
            c.css("height", h);
        }else{
            c.css("height", wh - hh - fh);
        };
        
    };
};
/**********END*布局调整*END*********/

/**页面初始化**/
$(window).on("resize load", function(){
    $.su.layout.doLayout();
});

/////////////////////////////////////
var ledProxy = new $.su.Proxy({
        url: './data/led.json'
    });
$('a#top-control-led').click(function(){
    ledProxy.read({}, function(data){
        
    });
});


});
//]]>
</script>
</body>
</html>
