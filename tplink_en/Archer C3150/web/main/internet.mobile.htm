<div class="section-container mt15 nd">
    <div class="section-box">
        <div>
            <span></span>
        </div>
        <input type='checkbox' id='ethWan_en' />
    </div>
</div>
<div id="internet-edit">
    <div class="titleBar">
        <a id="back" url="network.mobile.htm"><span class="icon-back sprite c-arrow-blue-left"></span></a>
        <h1>
            <script type="text/html" class="title-string">
                <%=$.tpLang.menu_str.internet%>
            </script>
        </h1>
        <a id="save" data-status="save">
            <script type="text/html" class="title-string">
                <%=$.tpLang.m_str.save%>
            </script>
        </a>
    </div>
    <div class="section-title mt15">
        <script type="text/html" class="title-string">
            <%=$.tpLang.menu_str.internet%>
        </script>
    </div>
    <div class="item-list">
    <div class="section-container">
        <div class="section-box">
            <label class="section-labelTitle" for="connection-type">
                <script type="text/html" class="title-string">
                    <%=$.tpLang.s_str.conntype%>
                </script>
            </label>
            <select id="connection-type" class="section-inputText s">
                <option value="dynamicIp">
                    <script type="text/html" class="title-string">
                        <%=$.tpLang.s_str.dynip%>
                    </script>
                </option>
                <option value="staticIp">
                    <script type="text/html" class="title-string">
                        <%=$.tpLang.s_str.staip%>
                    </script>
                </option>
                <option value="pppoe">
                    <script type="text/html" class="title-string">
                        <%=$.tpLang.ethWan_nstr.t_pppoe%>
                    </script>
                </option>
            </select>
        </div>
    </div>
    </div>
    <div id="dynamic-ip" class="item-list mt15 nd">
        <div class="section-container" id="dyn-info">
            <div class="section-box">
                <div class="text-right-title">
                    <span>
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.s_str.ipaddr%>
                        </script>
                    </span>
                </div>
                <div class="text-right" id="i-d-ip">
                    <span></span>
                </div>
            </div>
            <div class="section-box">
                <div class="text-right-title">
                    <span>
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.s_str.netmask%>
                        </script>
                    </span>
                </div>
                <div class="text-right" id="i-d-mask">
                    <span></span>
                </div>
            </div>
            <div class="section-box">
                <div class="text-right-title">
                    <span>
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.s_str.defgw%>
                        </script>
                    </span>
                </div>
                <div class="text-right" id="i-d-gateway">
                    <span></span>
                </div>
            </div>
            <div class="section-box">
                <div class="text-right-title">
                    <span>
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.s_str.dns%>
                        </script>
                    </span>
                </div>
                <div class="text-right" id="i-d-pdns">
                    <span></span>
                </div>
            </div>
            <div class="section-box">
                <div class="text-right-title">
                    <span>
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.s_str.secdns%>
                        </script>
                    </span>
                </div>
                <div class="text-right" id="i-d-sdns">
                    <span></span>
                </div>
            </div>
            <div class="section-box" id="dyn-btn">
                <input type="button" class="button-mobile" id="dyn-renew">
                <input type="button" class="button-mobile" disabled id="dyn-release">
            </div>
        </div>
        <div class="section-container mtNo">
            <div class="section-box single">
                <input type="checkbox" id="dyn-advance" />
                <label for="dyn-advance">
                    <script type="text/html" class="title-string">
                        <%=$.tpLang.s_str.adv%>
                    </script>
                </label>
            </div>
        </div>
        <div id="dyn-advance-info" class="nd">
            <div class="section-container mtNo border-top-none">
                <div class="section-box">
                    <input id="i-d-mtu" maxlength="4" type="text" />
                </div>
            </div>
            <div class="section-container mtNo">
                <div class="section-box">
                    <div>
                        <span></span>
                    </div>
                    <input type="checkbox" id="i-d-igmp" />
                </div>
            </div>
            <div class="section-container mtNo">
                <div class="section-box">
                    <label class="section-labelTitle" for="dyn-select-dns">
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.ethWan_nstr.t_dnsaddr%>
                        </script>
                    </label>
                    <select id="dyn-select-dns">
                        <option value="0">
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.getauto%>
                            </script>
                        </option>
                        <option value="1">
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.dnsmanual%>
                            </script>
                        </option>
                    </select>
                </div>
                <div class="section-box dyn-dns">
                    <div class="text-right-title">
                        <span>
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.dns%>
                            </script>
                        </span>
                    </div>
                    <div class="text-right" id="i-d-isp-pdns">
                        <span></span>
                    </div>
                </div>
                <div class="section-box dyn-dns">
                    <div class="text-right-title">
                        <span>
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.secdns%>
                            </script>
                        </span>
                    </div>
                    <div class="text-right" id="i-d-isp-sdns">
                        <span></span>
                    </div>
                </div>
                <div class="section-box dyn-dns-flo nd">
                    <input id="i-d-fol-pdns" type="text" />
                </div>
                <div class="section-box dyn-dns-flo nd">
                    <input id="i-d-fol-sdns" type="text" />
                </div>
            </div>
            <div class="section-container mtNo">
                <div class="section-box">
                    <div>
                        <span></span>
                    </div>
                    <input type="checkbox" id="get-ip-unicast" />
                </div>
                <p class="section-tips">
                    <script type="text/html" class="title-string">
                        <%=$.tpLang.s_str.noreq%>
                    </script>
                </p>
                <div class="section-box">
                    <input id="i-d-hostname" maxlength="62" type="text" />
                </div>
            </div>
        </div>
    </div>
    <div id="static-ip" class="item-list mt15 nd">
        <div class="section-container" id="static-info">
            <div class="section-box">
                <input id="i-a-ip" maxlength="15" type="text" />
            </div>
            <div class="section-box">
                <input id="i-a-mask" maxlength="15" type="text" />
            </div>
            <div class="section-box">
                <input id="i-a-gateway" maxlength="15" type="text" />
            </div>
            <div class="section-box">
                <input id="i-a-pdns" maxlength="15" type="text" />
            </div>
            <div class="section-box">
                <input id="i-a-sdns" maxlength="15" type="text" />
            </div>
        </div>
        <div class="section-container mtNo">
            <div class="section-box single">
                <input type="checkbox" id="sta-advance" />
                <label for="sta-advance">
                    <script type="text/html" class="title-string">
                        <%=$.tpLang.s_str.adv%>
                    </script>
                </label>
            </div>
        </div>
        <div id="sta-advance-info" class="nd">
            <div class="section-container mtNo border-top-none">
                <div class="section-box">
                    <input id="i-a-mtu" maxlength="4" type="text" />
                </div>
                <div class="section-box">
                    <div>
                        <span></span>
                    </div>
                    <input type="checkbox" id="i-a-igmp" />
                </div>
            </div>
        </div>
    </div>
    <div id="pppoe-conn" class="item-list mt15 nd">
        <div class="section-container" id="pppoe-info">
            <div class="section-box">
                <input id="i-p-username" maxlength="63" type="text" />
            </div>
            <div class="section-box">
                <input id="i-p-password" maxlength="63" type="password" />
            </div>
            <div class="section-box">
                <label class="section-labelTitle" for="ppp-select-conn">
                    <script type="text/html" class="title-string">
                        <%=$.tpLang.s_str.connmode%>
                    </script>
                </label>
                <select id="ppp-select-conn">
                    <option value="0">
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.s_str.typeauto%>
                        </script>
                    </option>
                    <option value="1">
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.s_str.typedemand%>
                        </script>
                    </option>
                    <option value="2">
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.s_str.typemanual%>
                        </script>
                    </option>
                </select>
            </div>
            <div class="section-box">
                <input id="i-p-idle" maxlength="2" type="text" />
            </div>
            <div class="section-box">
                <label class="section-labelTitle" for="ppp-select-auth">
                    <script type="text/html" class="title-string">
                        <%=$.tpLang.s_str.authtype%>
                    </script>
                </label>
                <select id="ppp-select-auth">
                    <option value="AUTO_AUTH" selected="selected">
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.ethWan_nstr.t_autoauth%>
                        </script>
                    </option>
                    <option value="PAP">
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.ethWan_nstr.t_pap%>
                        </script>
                    </option>
                    <option value="CHAP">
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.ethWan_nstr.t_chap%>
                        </script>
                    </option>
                    <option value="MS-CHAP">
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.ethWan_nstr.t_mschap%>
                        </script>
                    </option>
                </select>
            </div>
        </div>
        <div class="section-container mtNo">
            <div class="section-box single">
                <input type="checkbox" id="ppp-advance" />
                <label for="ppp-advance">
                    <script type="text/html" class="title-string">
                        <%=$.tpLang.s_str.adv%>
                    </script>
                </label>
            </div>
        </div>
        <div id="ppp-advance-info" class="nd">
            <div class="section-container mtNo border-top-none">
                <div class="section-box">
                    <input id="i-p-service" maxlength="31" type="text" />
                </div>
                <div class="section-box">
                    <input id="i-p-server" maxlength="31" type="text" />
                </div>
                <div class="section-box">
                    <input id="i-p-mtu" maxlength="4" type="text" />
                </div>
            </div>
            <div class="section-container mtNo">
                <div class="section-box">
                    <div>
                        <span></span>
                    </div>
                    <input type="checkbox" id="i-p-igmp" />
                </div>
            </div>
            <div class="section-container mtNo">
                <div class="section-box">
                    <input id="i-p-echo" maxlength="3" type="text" />
                </div>
				<div class="section-box">
                    <label class="section-labelTitle" for="ppp-select-ip">
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.s_str.ipaddr%>
                        </script>
                    </label>
                    <select id="ppp-select-ip">
                        <option value="0">
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.getauto%>
                            </script>
                        </option>
                        <option value="1">
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.useispaddr%>
                            </script>
                        </option>
                    </select>
                </div>
                <div class="section-box ppp-ip">
                    <div class="text-right-title">
                        <span>
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.ipaddr%>
                            </script>
                        </span>
                    </div>
                    <div class="text-right" id="i-p-ip">
						<span></span>
					</div>
				</div>
                <div class="section-box ppp-ip-flo nd">
                    <input id="i-p-isp-ip" type="text" />
                </div>
                <div class="section-box">
                    <label class="section-labelTitle" for="ppp-select-dns">
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.ethWan_nstr.t_dnsaddr%>
                        </script>
                    </label>
                    <select id="ppp-select-dns">
                        <option value="0">
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.getauto%>
                            </script>
                        </option>
                        <option value="1">
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.dnsmanual%>
                            </script>
                        </option>
                    </select>
                </div>
                <div class="section-box ppp-dns">
                    <div class="text-right-title">
                        <span>
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.dns%>
                            </script>
                        </span>
            </div>
                    <div class="text-right" id="i-p-pdns">
                        <span></span>
                    </div>
                </div>
                <div class="section-box ppp-dns">
                    <div class="text-right-title">
                        <span>
                            <script type="text/html" class="title-string">
                                <%=$.tpLang.s_str.secdns%>
                            </script>
                        </span>
                    </div>
                    <div class="text-right" id="i-p-sdns">
						<span></span>
					</div>
				</div>
				<div class="section-box ppp-dns-flo nd">
					<input id="i-p-fol-pdns" type="text" />
				</div>
				<div class="section-box ppp-dns-flo nd">
					<input id="i-p-fol-sdns" type="text" />
				</div>
			</div>
        </div>
        <div class="section-container mtNo">
            <div class="section-box" id="ppp-btn">
                <input type="button" class="button-mobile" disabled id="ppp-conn">
                <input type="button" class="button-mobile" disabled id="ppp-disconn">
            </div>
        </div>
    </div>
    <div id="mac-clone">
        <div class="section-title mt15">
            <script type="text/html" class="title-string">
                <%=$.tpLang.menu_str.macclone%>
            </script>
        </div>
        <div class="item-list">
        <div class="section-container">
            <div class="section-box single">
                <div>
                    <span>
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.ethWan_nstr.t_notclone%>
                        </script>
                    </span>
                </div>
                <input type="radio" name="cloneRadio" id="i-clone-n" />
            </div>
        </div>
        <div class="section-container">
            <div class="section-box single">
                <div>
                    <span>
                        <script type="text/html" class="title-string">
                            <%=$.tpLang.ethWan_nstr.t_clonecus%>
                        </script>
                    </span>
                </div>
                <input type="radio" name="cloneRadio" id="i-clone-c"/>
            </div>
            <div class="section-box nd" id="radio2Div">
                <input id="i-clone-mac" type="text" />
            </div>
        </div>
    </div>
</div>
</div>
<script type="text/javascript">
    (function() {
        var wanTypes, wanIPList, wanPPPList, wanL2tpList, wanPptpList;
        var pStk, staticStk, staticEnable, dynStk, dynEnable, PPPoEStk, PPPoEEnable;
        var l2tpStk, l2tpEnable, pptpStk, pptpEnable;
        var ethWan, wan_iplist_sta, wan_iplist_dyn, wan_pppoelist, wan_l2tp_list, wan_pptp_list;
        var pcMacAddr;
        var connStatusTimeout;
        var wan_iplistarg_sta = {};
        var wan_iplistarg_dyn = {};
        var wan_pppoelistarg = {};
        var wan_l2tp_listarg = {};
        var wan_pptp_listarg = {};
        var l3ForwardingObj = {};
        (function() {
            $.tpLocal('title-string', $.tpLang);
            $('#internet-status').addClass('nd');
            $('#internet-edit .titleBar').titleBar();

            init();
        })();
        function initBox() {
            $('#ethWan_en').flipSwitch({
                'hasTitle': true,
                'title': $.tpLang.ethWan_nstr.t_en
            });
            $('#connection-type').selectMobile();

            //Dynamic IP config
            $('#dyn-advance').checkboxMobile({
                'text': $.tpLang.s_str.adv,
                'advanced': 'collapsible'
            }).bind('check.checkboxMobile', function() {
                $('#dyn-advance-info').show();
                $('#dyn-advance-info input[type=checkbox]').checkboxMobile('refresh');
            }).bind('uncheck.checkboxMobile', function() {
                $('#dyn-advance-info').hide();
            });
            $('#dyn-renew').buttonMobile({ 'text': $.tpLang.m_str.renew });
            $('#dyn-release').buttonMobile({ 'text': $.tpLang.m_str.release });
            $('#dyn-select-dns').selectMobile();
            $('#i-d-igmp').checkboxMobile({ 'hasTitle': true, 'title': $.tpLang.ethWan_nstr.t_igmp });
            $('#i-d-mtu').inputBoxMobile({
                'value': 1500,
                'title': $.tpLang.ethWan_nstr.t_mtu,
                'following': $.tpLang.s_str.bytes,
                'notice': $.tpLang.ethWan_nstr.t_mtu1500,
                'warnings': [{
                    func: function() {
                        var mtu = this.inputBoxMobile('option', 'value');
                        if ((mtu >= 576) && (mtu <= 1500)) {
                            return true;
                        } else {
                            return false;
                        }
                    },
                    text: e_str[ERR_WAN_MTU_INVAD]
                }]
            });
            $('#i-d-hostname').inputBoxMobile({
                'title': $.tpLang.s_str.hostname,
                'warnings': [{
                    func: function() {
                        var name = this.inputBoxMobile('option', 'value');
                        return $.charCompareA(name, 63, 0);
                    },
                    text: e_str[ERR_WAN_HOST_NAME_INVALID]
                }]
            });
            $('#i-d-fol-pdns').inputBoxMobile({
                'title': $.tpLang.s_str.dns,
                'ipOrMac': 'ip',
                'warnings': [{
                    func: function() {
                        var pdns = this.inputBoxMobile('option', 'value');
                        return e_str[$.ifip(pdns, true)];
                    },
                    text: e_str[ERR_WAN_DNSADDR_INVAD]
                }]
            });
            $('#i-d-fol-sdns').inputBoxMobile({
                'title': $.tpLang.s_str.secdns,
                'ipOrMac': 'ip',
                'warnings': [{
                    func: function() {
                        var sdns = this.inputBoxMobile('option', 'value');
                        if ((sdns === "") || (sdns === "0.0.0.0")) {
                            return true;
                        }
                        return e_str[$.ifip(sdns, true)];
                    },
                    text: e_str[ERR_WAN_DNSADDR_INVAD]
                }]
            });
            $('#get-ip-unicast').checkboxMobile({
                'hasTitle': true,
                'title': $.tpLang.s_str.unicast,
                'checked': false
            });

            //Clone MAC config
            $('#i-clone-n').radioMobile({
                'hasTitle': true
            }).bind('check.radioMobile', function() {
                $.hideBlock('radio2Div');
            });
            $('#i-clone-c').radioMobile({
                'hasTitle': true
            }).bind('check.radioMobile', function() {
                $.showBlock('radio2Div');
            });
            $('#i-clone-mac').inputBoxMobile({
                'ipOrMac': 'mac',
                'warnings': [{
                    func: function() {
                        var mac = this.inputBoxMobile('option', 'value');
                        return e_str[$.mac(mac, true)];
                    },
                    text: e_str[ERR_MAC_FORMAT]
                }]
            });

            //Static IP config
            $('#i-a-ip').inputBoxMobile({
                'title': $.tpLang.s_str.ipaddr,
                'ipOrMac': 'ip',
                'warnings': [{
                    func: function() {
                        var ip = this.inputBoxMobile('option', 'value');
                        return e_str[$.ifip(ip, true)];
                    }
                }]
            });
            $('#i-a-mask').inputBoxMobile({
                'title': $.tpLang.s_str.netmask,
                'ipOrMac': 'ip',
                'warnings': [{
                    func: function() {
                        var mask = this.inputBoxMobile('option', 'value');
                        return e_str[$.mask(mask, true)];
                    }
                }]
            });
            $('#i-a-gateway').inputBoxMobile({
                'title': $.tpLang.s_str.defgw,
                'ipOrMac': 'ip',
                'warnings': [{
                    func: function() {
                        var gate = this.inputBoxMobile('option', 'value');
                        return e_str[$.ifip(gate, true)];
                    }
                }]
            });
            $('#i-a-pdns').inputBoxMobile({
                'title': $.tpLang.s_str.dns,
                'ipOrMac': 'ip',
                'warnings': [{
                    func: function() {
                        var pdns = this.inputBoxMobile('option', 'value');
                        return e_str[$.ifip(pdns, true)];
                    },
                    text: e_str[ERR_WAN_DNSADDR_INVAD]
                }]
            });
            $('#i-a-sdns').inputBoxMobile({
                'title': $.tpLang.s_str.secdns,
                'ipOrMac': 'ip',
                'warnings': [{
                    func: function() {
                        var sdns = this.inputBoxMobile('option', 'value');
                        if ((sdns === "") || (sdns === "0.0.0.0")) {
                            return true;
                        }
                        return e_str[$.ifip(sdns, true)];
                    },
                    text: e_str[ERR_WAN_DNSADDR_INVAD]
                }]
            });
            $('#sta-advance').checkboxMobile({
                'text': $.tpLang.s_str.adv,
                'advanced': 'collapsible'
            }).bind('check.checkboxMobile', function() {
                $('#sta-advance-info').show();
                $('#sta-advance-info input[type=checkbox]').checkboxMobile('refresh');
            }).bind('uncheck.checkboxMobile', function() {
                $('#sta-advance-info').hide();
            });
            $('#i-a-mtu').inputBoxMobile({
                'value': 1500,
                'title': $.tpLang.ethWan_nstr.t_mtu,
                'following': $.tpLang.s_str.bytes,
                'notice': $.tpLang.ethWan_nstr.t_mtu1500,
                'warnings': [{
                    func: function() {
                        var mtu = this.inputBoxMobile('option', 'value');
                        if ((mtu >= 576) && (mtu <= 1500)) {
                            return true;
                        } else {
                            return false;
                        }
                    },
                    text: e_str[ERR_WAN_MTU_INVAD]
                }]
            });
            $('#i-a-igmp').checkboxMobile({ 'hasTitle': true, 'title': $.tpLang.ethWan_nstr.t_igmp });

            //PPPoE config
            $('#i-p-username').inputBoxMobile({
                'title': $.tpLang.s_str.username,
                'warnings': [{
                    func: function() {
                        var user = this.inputBoxMobile('option', 'value');
                        return user != '';
                    },
                    text: e_str[ERR_USERNAME_INVAD]
                }]
            });
            $('#i-p-password').inputBoxMobile({'title': $.tpLang.s_str.passwd});
            $('#ppp-advance').checkboxMobile({
                'text': $.tpLang.s_str.adv,
                'advanced': 'collapsible'
            }).bind('check.checkboxMobile', function() {
                $('#ppp-advance-info').show();
                $('#ppp-advance-info input[type=checkbox]').checkboxMobile('refresh');

            }).bind('uncheck.checkboxMobile', function() {
                $('#ppp-advance-info').hide();
            });
            $('#ppp-conn').buttonMobile({ 'text': $.tpLang.m_str.conn });
            $('#ppp-disconn').buttonMobile({ 'text': $.tpLang.m_str.disconn });
            $('#ppp-select-conn').selectMobile();
            $('#ppp-select-auth').selectMobile();
            $('#ppp-select-ip').selectMobile();
            $('#ppp-select-dns').selectMobile();
            $('#i-p-idle').inputBoxMobile({
                'title': $.tpLang.s_str.midle,
                'following': $.tpLang.s_str.minutes,
                'notice': $.tpLang.s_str.zmean,
                'warnings': [{
                    func: function() {
                        var idle = this.inputBoxMobile('option', 'value');
                        return idle && $.isnum(idle) ? true : false;
                    },
                    text: e_str[ERR_IDLETIME_INVAD]
                }]
            });
            $('#i-p-service').inputBoxMobile({
                'title': $.tpLang.s_str.srvname,
                'notice': $.tpLang.s_str.nochg2
            });
            $('#i-p-server').inputBoxMobile({
                'title': $.tpLang.s_str.acname,
                'notice': $.tpLang.s_str.nochg2
            });
            $('#i-p-mtu').inputBoxMobile({
                'value': 1480,
                'title': $.tpLang.ethWan_nstr.t_mtu,
                'following': $.tpLang.s_str.bytes,
                'notice': $.tpLang.usb3g_nstr.t_mtu1480,
                'warnings': [{
                    func: function() {
                        var mtu = this.inputBoxMobile('option', 'value');
                        if ((mtu >= 576) && (mtu <= 1492)) {
                            return true;
                        } else {
                            return false;
                        }
                    },
                    text: e_str[ERR_WAN_PPPOE_MTU_INVAD]
                }]
            });
            $('#i-p-isp-ip').inputBoxMobile({
                'title': $.tpLang.s_str.ispaddr,
                'ipOrMac': 'ip',
                'warnings': [{
                    func: function() {
                        var ip = this.inputBoxMobile('option', 'value');
                        if ((ip === "") || (ip === "0.0.0.0")) {
                            return true;
                        }
                        return e_str[$.ifip(ip, true)];
                    },
                    text: e_str[ERR_IP_FORMAT]
                }]
            });
            $('#i-p-fol-pdns').inputBoxMobile({
                'title': $.tpLang.s_str.dns,
                'ipOrMac': 'ip',
                'warnings': [{
                    func: function() {
                        var pdns = this.inputBoxMobile('option', 'value');
                        if ((pdns != "") && (pdns != "0.0.0.0") && $.ifip(pdns, true)) {
                            return false;
                        } else {
                            return true;
                        }
                    },
                    text: e_str[ERR_WAN_DNSADDR_INVAD]
                }]
            });
            $('#i-p-fol-sdns').inputBoxMobile({
                'title': $.tpLang.s_str.secdns,
                'ipOrMac': 'ip',
                'warnings': [{
                    func: function() {
                        var sdns = this.inputBoxMobile('option', 'value');
                        if ((sdns != "") && (sdns != "0.0.0.0") && $.ifip(sdns, true)) {
                            return false;
                        } else {
                            return true;
                        }
                    },
                    text: e_str[ERR_WAN_SECDNS_INVAD]
                }]
            });
            $('#i-p-echo').inputBoxMobile({
                'value': 30,
                'title': $.tpLang.s_str.echo,
                'following': $.tpLang.s_str.seconds,
                'notice': $.tpLang.ethWan_nstr.t_defecho,
                'warnings': [{
                    func: function() {
                        var echo = this.inputBoxMobile('option', 'value');
                        if ((parseInt(echo, 10) >= 0) && (parseInt(echo, 10) <= 120)) {
                            return true;
                        } else {
                            return false;
                        }
                    },
                    text: e_str[ERR_WAN_ECHOTIME_INVAD]
                }]
            });
            $('#i-p-igmp').checkboxMobile({ 'hasTitle': true, 'title': $.tpLang.ethWan_nstr.t_igmp });
        }
        function init() {
            var type = '';
            wanTypes = $.act(ACT_GL, WAN_COMMON_INTF_CFG, null, null, ["WANAccessType"]);
            wanIPList = $.act(ACT_GL, WAN_IP_CONN, null, null, ["enable", "X_TP_IPv4Enabled", "addressingType"]);
            wanPPPList = $.act(ACT_GL, WAN_PPP_CONN, null, null, ["enable", "X_TP_IPv4Enabled", "transportType"]);
            if (INCLUDE_L2TP) {
                wanL2tpList = $.act(ACT_GL, WAN_L2TP_CONN, null, null, ["enable", "addressingType", "transportType"]);
            }
            if (INCLUDE_PPTP) {
                wanPptpList = $.act(ACT_GL, WAN_PPTP_CONN, null, null, ["enable", "addressingType", "transportType"]);
            }


            if (!$.exe(function() {
                $.each(wanTypes, function () {
                    if (this.WANAccessType == "Ethernet" ) {
                        pStk = this.__stack;
                    }
                });
                ethWan = $.act(ACT_GET, WAN_ETH_INTF, pStk, null, ["enable", "X_TP_lastUsedIntf"]);
                $.each(wanIPList, function () {
                    var tmpStk = $.stkPop(this.__stack, 2);
                    if (pStk == tmpStk && this.X_TP_IPv4Enabled == 1) {
                        if (this.addressingType == "Static") {
                            staticStk = this.__stack;
                            staticEnable = this.enable;
                            if (this.enable == 1) type = "staticIp";
                            wan_iplist_sta = $.act(ACT_GET, WAN_IP_CONN, this.__stack, null, null);
                        }
                        if (this.addressingType == "DHCP") {
                            dynStk = this.__stack;
                            dynEnable = this.enable;
                            if (this.enable == 1) type = "dynamicIp";
                            wan_iplist_dyn = $.act(ACT_GET, WAN_IP_CONN, this.__stack, null, null);
                        }
                    }
                });
                $.each(wanPPPList, function () {
                    var tmpStk = $.stkPop(this.__stack, 2);
                    if (pStk == tmpStk && this.X_TP_IPv4Enabled == 1) {
                        if (this.transportType == "PPPoE") {
                            PPPoEStk = this.__stack;
                            PPPoEEnable = this.enable;
                            if (this.enable == 1) type = "pppoe";
                            wan_pppoelist = $.act(ACT_GET, WAN_PPP_CONN, this.__stack, null, null);
                        }
                    }
                });
                if (INCLUDE_L2TP) {
                    $.each(wanL2tpList, function() {
                        var tmpStk = $.stkPop(this.__stack, 1);
                        if (pStk == tmpStk) {
                            l2tpStk = this.__stack;
                            l2tpEnable = this.enable;
                            wan_l2tp_list = $.act(ACT_GET, WAN_L2TP_CONN, this.__stack, null, null);
                            if (this.enable == 1) type = "l2tp";
                        }
                    });
                }
                if (INCLUDE_PPTP) {
                    $.each(wanPptpList, function() {
                        var tmpStk = $.stkPop(this.__stack, 1);
                        if (pStk == tmpStk) {
                            pptpStk = this.__stack;
                            pptpEnable = this.enable;
                            wan_pptp_list = $.act(ACT_GET, WAN_PPTP_CONN, this.__stack, null, null);
                            if (this.enable == 1) type = "pptp";
                        }
                    });
                }

                if (!$.exe(function () {
                    $("#ethWan_en").flipSwitch({on: ((ethWan.enable === '1') ? true : false)});
                    showLnkType(type);
                })) {}
            })) {}
            setEvent();
            initBox();
        }
        function setEvent() {
            $('#connection-type').on('change', function () {
                clearTimeout(connStatusTimeout);
                changeBlock();
            });
            $('#dyn-renew').on('click', function () {
                dhcpRenew();
            });
			$('#dyn-release').on('click', function () {
                dhcpRelease();
            });
            $('#dyn-select-dns').on('change', function () {
                var val = $('#dyn-select-dns').selectMobile('value');
                if (val === '0') {
                    $('#dyn-advance-info .dyn-dns-flo').hide();
                    $('#dyn-advance-info .dyn-dns').show();
                } else if (val === '1') {
                    $('#dyn-advance-info .dyn-dns').hide();
                    $('#dyn-advance-info .dyn-dns-flo').show();
                }
            });
            $('#ppp-select-ip').on('change', function () {
                var val = $('#ppp-select-ip').selectMobile('value');
                if (val === '0') {
                    $('#ppp-advance-info .ppp-ip-flo').hide();
                    $('#ppp-advance-info .ppp-ip').show();
                } else if (val === '1') {
                    $('#ppp-advance-info .ppp-ip').hide();
                    $('#ppp-advance-info .ppp-ip-flo').show();
                }
            });
            $('#ppp-select-dns').on('change', function () {
                var val = $('#ppp-select-dns').selectMobile('value');
                if (val === '0') {
                    $('#ppp-advance-info .ppp-dns-flo').hide();
                    $('#ppp-advance-info .ppp-dns').show();
                } else if (val === '1') {
                    $('#ppp-advance-info .ppp-dns').hide();
                    $('#ppp-advance-info .ppp-dns-flo').show();
                }
            });
            $('#ppp-conn').on('click', function() {
                doConn();
            });
            $('#ppp-disconn').on('click', function() {
                doDisConn();
            });
            $('#save').on('click', function () {
                save(0);
            });
        }
        function changeBlock() {
            var val = $('#connection-type').selectMobile('value');
            if (val === 'dynamicIp') {
                initDynamicIP();
                $('#static-ip').hide();
                $('#pppoe-conn').hide();
                $('#dynamic-ip').show();
                $('#ppp-advance').checkboxMobile('option', 'checked', false).trigger('uncheck.checkboxMobile');;
            } else if (val === 'staticIp') {
                initStaticIP();
                $('#dynamic-ip').hide();
                $('#pppoe-conn').hide();
                $('#static-ip').show();
                $('#dyn-advance').checkboxMobile('option', 'checked', false).trigger('uncheck.checkboxMobile');;
            } else if (val === 'pppoe') {
                initPPPoE();
                $('#dynamic-ip').hide();
                $('#static-ip').hide();
                $('#pppoe-conn').show();
                $('#sta-advance').checkboxMobile('option', 'checked', false).trigger('uncheck.checkboxMobile');;
            }
        }
        function dhcpRenew() {
            $("#dyn-renew").prop("disabled", true);
            $.act(ACT_OP, ACT_OP_DHCP_RENEW, wan_iplist_dyn.__stack);
            $("#dyn-renew").val($.tpLang.m_str.connecting);
            if (!$.exe()) {
                $.timeout(function () {
                    $.reload();
                }, 1500);
            }
        }
		function dhcpRelease() {
            $("#dyn-release").prop("disabled", true);
            $.act(ACT_OP, ACT_OP_DHCP_RELEASE, wan_iplist_dyn.__stack);
            if (!$.exe())
                $.timeout(function () {
                    $.reload();
                }, 1500);
        }
        function initMacClone(wanConn) {
            $.act(ACT_CGI, "/cgi/info");
            if ($.exe()) return false;
            pcMacAddr = clientMac;

            var type = $("#connection-type").selectMobile("value");
            if (wanConn.MACAddressOverride == 1) {
                if (wanConn.X_TP_ClonedMACAddress == pcMacAddr || wanConn.clonedMACAddress == pcMacAddr) {
					$("#i-clone-curcomputer").radioMobile("option", 'checked', true);
					$("#i-clone-n").radioMobile("option", 'checked', false);
					$("#i-clone-c").radioMobile("option", 'checked', false);
					$("#i-clone-mac").val("");
                } else {
                    $("#i-clone-c").radioMobile("option", 'checked', true);
                    if (type == "l2tp" || type == "pptp") {
                        $("#i-clone-mac").val(wanConn.clonedMACAddress);
                    } else {
                        $("#i-clone-mac").val(wanConn.X_TP_ClonedMACAddress);
                    }
                    $("#i-clone-n").radioMobile("option", 'checked', false);
					$("#i-clone-curcomputer").radioMobile("option", 'checked', false);
                    $('#i-clone-c').trigger('check.radioMobile');
                }
            } else {
                $("#i-clone-n").radioMobile("option", 'checked', true);
				$("#i-clone-curcomputer").radioMobile("option", 'checked', false);
                $("#i-clone-c").radioMobile("option", 'checked', false);
                $("#i-clone-mac").val("");
            }
        }
        function initDynamicIP() {
            var dns1 = wan_iplist_dyn.DNSServers.split(",")[0];
            var dns2 = wan_iplist_dyn.DNSServers.split(",")[1];
            $("#i-d-mac span").text(wan_iplist_dyn.MACAddress);
            $("#i-d-ip span").text(wan_iplist_dyn.externalIPAddress);
            $("#i-d-mask span").text(wan_iplist_dyn.subnetMask);
            $("#i-d-gateway span").text(wan_iplist_dyn.defaultGateway);
            $("#i-d-pdns span").text(dns1 ? dns1 : "0.0.0.0");
            $("#i-d-sdns span").text(dns2 ? dns2 : "0.0.0.0");
            if (wan_iplist_dyn.DNSOverrideAllowed === '0') {
                $('#i-d-isp-pdns span').text(dns1 ? dns1 : "0.0.0.0");
                $('#i-d-isp-sdns span').text(dns2 ? dns2 : "0.0.0.0");
            } else if (wan_iplist_dyn.DNSOverrideAllowed === '1') {
                $('#i-d-fol-pdns').inputBoxMobile('option', 'value', dns1 ? dns1 : "0.0.0.0");
                $('#i-d-fol-sdns').inputBoxMobile('option', 'value', dns2 ? dns2 : "0.0.0.0");
            }
            $('#i-d-mtu').val(wan_iplist_dyn.maxMTUSize);
            $('#i-d-igmp').checkboxMobile('option', 'checked', wan_iplist_dyn.X_TP_IGMPProxyEnabled === '1' ? true : false);
            $('#dyn-select-dns').selectMobile('value', wan_iplist_dyn.DNSOverrideAllowed);
            $('#get-ip-unicast').checkboxMobile('option', 'checked', wan_iplist_dyn.X_TP_Unicast === '1' ? true : false);
            $('#i-d-hostname').val(wan_iplist_dyn.X_TP_Hostname);


            initMacClone(wan_iplist_dyn);
			/* delete for AC3150 by jy */
            //changeDNSType(wan_iplist_dyn.DNSOverrideAllowed);

            if (wan_iplist_dyn.enable == 1) {
                if (wan_iplist_dyn.connectionStatus == "Connected") {
                    $("#dyn-renew").prop("disabled", true);
                    $("#dyn-release").prop("disabled", false);
                } else if (wan_iplist_dyn.connectionStatus == "Disconnected") {
                    $("#dyn-renew").prop("disabled", false);
                    $("#dyn-release").prop("disabled", true);
                } else {
                    $("#dyn-renew").prop("disabled", true);
                    $("#dyn-release").prop("disabled", true);
                    connStatusTimeout = $.timeout($.reload, 10000);
                }
            }
        }
        function initStaticIP() {
            var dns1 = wan_iplist_sta.DNSServers.split(",")[0];
            var dns2 = wan_iplist_sta.DNSServers.split(",")[1];
            $("#i-a-ip").inputBoxMobile('option', 'value', wan_iplist_sta.externalIPAddress);
            $("#i-a-mask").inputBoxMobile('option', 'value', wan_iplist_sta.subnetMask);
            $("#i-a-gateway").inputBoxMobile('option', 'value', wan_iplist_sta.defaultGateway);
            $("#i-a-pdns").inputBoxMobile('option', 'value', dns1 ? dns1 : "0.0.0.0");
            $("#i-a-sdns").inputBoxMobile('option', 'value', dns2 ? dns2 : "0.0.0.0");
            $('#i-a-mtu').val(wan_iplist_sta.maxMTUSize);
            $('#i-a-igmp').checkboxMobile('option', 'checked', wan_iplist_sta.X_TP_IGMPProxyEnabled === '1' ? true : false);

            initMacClone(wan_iplist_sta);
        }
        function initPPPoE() {
            $('#i-p-username').val(wan_pppoelist.username);
            $('#i-p-password').val(wan_pppoelist.password);
            if (wan_pppoelist.connectionTrigger === "OnDemand") {
                $("#ppp-select-conn").selectMobile("value", '1');
            } else if (wan_pppoelist.connectionTrigger === "AlwaysOn") {
                $("#ppp-select-conn").selectMobile("value", '0');
            } else if (wan_pppoelist.connectionTrigger === "Manual") {
                $("#ppp-select-conn").selectMobile("value", '2');
            }
            $("#i-p-idle").val(wan_pppoelist.idleDisconnectTime);
            $('#ppp-select-auth').selectMobile('value', wan_pppoelist.PPPAuthenticationProtocol);
            $("#i-p-server").val(wan_pppoelist.PPPoEACName);
            $("#i-p-service").val(wan_pppoelist.PPPoEServiceName);
            $("#i-p-mtu").val(wan_pppoelist.maxMRUSize);
            $("#i-p-igmp").checkboxMobile('option', 'checked', (wan_pppoelist.X_TP_IGMPProxyEnabled === '1') ? true : false);
            $('#i-p-echo').val(wan_pppoelist.PPPLCPEcho ? wan_pppoelist.PPPLCPEcho : 0);
            if (wan_pppoelist.X_TP_UseStaticIP === '1') {
                $('#ppp-select-ip').selectMobile('value', '1').trigger('change');
                $('#i-p-isp-ip').inputBoxMobile('option', 'value', wan_pppoelist.externalIPAddress);
            } else {
                $('#ppp-select-ip').selectMobile('value', '0').trigger('change');
                $('#i-p-ip').val(wan_pppoelist.externalIPAddress);
            }
            if (wan_pppoelist.DNSOverrideAllowed === '1') {
                $("#ppp-select-dns").selectMobile('value', '1').trigger('change');
                $("#i-p-fol-pdns").inputBoxMobile('option', 'value', (wan_pppoelist.DNSServers.split(",")[0]) ? wan_pppoelist.DNSServers.split(",")[0] : "0.0.0.0");
                $("#i-p-fol-sdns").inputBoxMobile('option', 'value', (wan_pppoelist.DNSServers.split(",")[1]) ? wan_pppoelist.DNSServers.split(",")[1] : "0.0.0.0");
            } else {
                $("#ppp-select-dns").selectMobile('value', '0').trigger('change');
                $("#i-p-pdns").val((wan_pppoelist.DNSServers.split(",")[0]) ? wan_pppoelist.DNSServers.split(",")[0] : "0.0.0.0");
                $("#i-p-sdns").val((wan_pppoelist.DNSServers.split(",")[1]) ? wan_pppoelist.DNSServers.split(",")[1] : "0.0.0.0");
            }
            if (wan_pppoelist.enable === '1') {
                $.auto(function() {
                    getPPPoEConnStatus();
                }, 5000, true);
            }
            initMacClone(wan_pppoelist);
        }
        function initL2TP() {
            $("#i-s-type span").text('L2TP');
        }
        function initPPTP() {
            $("#i-s-type span").text('PPTP');
        }
        function showLnkType(type) {
            if (type == "") {
                switch (ethWan.X_TP_lastUsedIntf) {
                    case "ipoe_eth3_d":
                        $('#connection-type').selectMobile('value', 'dynamicIp');
                        break;
                    case "ipoe_eth3_s":
                        $('#connection-type').selectMobile('value', 'staticIp');
                        break;
                    case "pppoe_eth3_d":
                        $('#connection-type').selectMobile('value', 'pppoe');
                        break;
                    case "l2tp_eth3_d":
                        break;
                    case "pptp_eth3_d":
                        break;
                    default:
                        $('#connection-type').selectMobile('value', 'dynamicIp');
                        break;
                }
            } else {
                switch (type) {
                    case "staticIp":
                        $('#connection-type').selectMobile('value', 'staticIp');
                        break;
                    case "dynamicIp":
                        $('#connection-type').selectMobile('value', 'dynamicIp');
                        break;
                    case "pppoe":
                        $('#connection-type').selectMobile('value', 'pppoe');
                        break;
                    case "l2tp":
                        break;
                    case "pptp":
                        break;
                    default:
                        $('#connection-type').selectMobile('value', 'dynamicIp');
                        break;
                }
            }
        }
        function getPPPoEConnStatus() {
            var pppoelist = $.act(ACT_GET, WAN_PPP_CONN, PPPoEStk, null, null);
            var bConnecting = false;
            if (!$.exe() && (pppoelist.enable == 1)) {
                if (!INCLUDE_IPV6) {
                    if (pppoelist.connectionStatus == "Connecting") {
                        bConnecting = true;
                    }
                } else {
                    if (pppoelist.X_TP_IPv4Enabled == true && pppoelist.connectionStatus == "Connecting") {
                        bConnecting = true;
                    } else if (pppoelist.X_TP_IPv4Enabled == false && pppoelist.X_TP_IPv6Enabled == true && pppoelist.X_TP_IPv6ConnStatus == "Connecting") {
                        bConnecting = true;
                    }
                }

                if (bConnecting) {
                    $("#ppp-conn").buttonMobile({ 'text': $.tpLang.m_str.connecting });
                } else {
                    $("#ppp-conn").buttonMobile({ 'text': $.tpLang.m_str.conn });
                }

                if (INCLUDE_IPV6 && pppoelist.X_TP_IPv4Enabled == 0) {
                    $("#ppp-conn").prop("disabled", true);
                    $("#ppp-disconn").prop("disabled", true);
                } else if (pppoelist.connectionStatus == "Connected") {
                    $("#ppp-conn").prop("disabled", true);
                    $("#ppp-disconn").prop("disabled", false);
                } else if ((pppoelist.connectionStatus == "Disconnected") || (pppoelist.connectionStatus == "Unconfigured")) {
                    $("#ppp-conn").prop("disabled", false);
                    $("#ppp-disconn").prop("disabled", true);
                } else {
                    $("#ppp-conn").prop("disabled", true);
                    $("#ppp-disconn").prop("disabled", false);
                }
            }
        }
        function doConn() {
            save(1);
            $("#ppp-conn").prop("disabled", true);
            $.act(ACT_OP, ACT_OP_PPP_CONN, wan_pppoelist.__stack);
            $("#ppp-conn").buttonMobile({ 'text': $.tpLang.m_str.connecting });
            if (!$.exe())
                $.timeout(function() {
                    $.reload();
                }, 1500);
        }

        function doDisConn() {
            $("#ppp-disconn").prop("disabled", true);
            $.act(ACT_OP, ACT_OP_PPP_DISCONN, wan_pppoelist.__stack);
            if (!$.exe()) {
                save(1);
                $.timeout(function() {
                    $.reload();
                }, 1500);
            }
        }
        function addMacCloneAttrs(wanArg) {
            var type = $("#connection-type").selectMobile('value');
            var macAddr;
            if ($("#i-clone-n").radioMobile('option', 'checked') || $("#i-clone-c").radioMobile('option', 'checked')) {
                if ($("#i-clone-n").radioMobile('option', 'checked')) {
                    wanArg.MACAddressOverride = 0;
                    return true;
				} else if ($("#i-clone-c").radioMobile('option', 'checked')) {
                    if (!$('#i-clone-mac').inputBoxMobile('checkValue')) {
                        return false;
                    }
                    macAddr = $("#i-clone-mac").val();
                }
                wanArg.MACAddressOverride = 1;
                if (type == "l2tp" || type == "pptp") {
                    wanArg.clonedMACAddress = macAddr;
                } else {
                    wanArg.X_TP_ClonedMACAddress = macAddr;
                }
            } else {}

            return true;
        }
        function addStaticIpAttrs() {
            var temp_ip = $("#i-a-ip").val();
            var temp_mask = $("#i-a-mask").val();
            var temp_gateway = $("#i-a-gateway").val();
            if ($('#i-a-ip').inputBoxMobile('checkValue') && $('#i-a-mask').inputBoxMobile('checkValue') && !$.ipmask(temp_ip, temp_mask)) {
                wan_iplistarg_sta.externalIPAddress = $.ip2ip(temp_ip);
                wan_iplistarg_sta.subnetMask = $.ip2ip(temp_mask);
            } else {
                return false;
            }
            if (!$('#i-a-gateway').inputBoxMobile('checkValue')) {
                return false;
            }
            if (!$.isSameLan(temp_gateway, temp_mask, temp_ip, temp_mask)) {
                $.alert(ERR_GATEWAY_INVAD);
                return false;
            }
            wan_iplistarg_sta.defaultGateway = (temp_gateway) ? $.ip2ip(temp_gateway) : "0.0.0.0";
            wan_iplistarg_sta.X_TP_IGMPProxyEnabled = $("#i-a-igmp").checkboxMobile('option', 'checked') ? 1 : 0;

            if ($('#i-a-mtu').inputBoxMobile('checkValue')) {
                wan_iplistarg_sta.maxMTUSize = parseInt($("#i-a-mtu").val(), 10);
            } else {
                return false;
            }

            var temp_dnsaddr = $("#i-a-pdns").val();
            var temp_secdnsaddr = $("#i-a-sdns").val();
            var temp_dnsServers = "";
            if (!$('#i-a-pdns').inputBoxMobile('checkValue')) {
                return false;
            }
            if (!$('#i-a-sdns').inputBoxMobile('checkValue')) {
                return false;
            }
            temp_dnsaddr = (temp_dnsaddr) ? $.ip2ip(temp_dnsaddr) : "0.0.0.0";
            temp_secdnsaddr = (temp_secdnsaddr) ? $.ip2ip(temp_secdnsaddr) : "0.0.0.0";
            temp_dnsServers = temp_dnsaddr + "," + temp_secdnsaddr;
            wan_iplistarg_sta.DNSOverrideAllowed = ((temp_dnsServers == "0.0.0.0,0.0.0.0") ? 0 : 1);
            wan_iplistarg_sta.DNSServers = temp_dnsServers;

            if (false == addMacCloneAttrs(wan_iplistarg_sta)) {
                return false;
            }
            wan_iplistarg_sta.X_TP_IPv4Enabled = 1;
            return true;
        }

        function addDynIpAttrs() {
            wan_iplistarg_dyn.X_TP_IGMPProxyEnabled = $("#i-d-igmp").checkboxMobile('option', 'checked') ? 1 : 0;

            if ($('#i-d-mtu').inputBoxMobile('checkValue')) {
                wan_iplistarg_dyn.MaxMTUSize = parseInt($("#i-d-mtu").val(), 10);
            } else {
                return false;
            }
            if ($("#dyn-select-dns").selectMobile('value') === '1') {
                wan_iplistarg_dyn.DNSOverrideAllowed = 1;

                var temp_dnsServers = "";
                if (!$('#i-d-fol-pdns').inputBoxMobile('checkValue')) {
                    return false;
                }
                if (!$('#i-d-fol-sdns').inputBoxMobile('checkValue')) {
                    return false;
                }
                var temp_dnsaddr = $("#i-d-fol-pdns").val();
                var temp_secdnsaddr = $("#i-d-fol-sdns").val();
                temp_dnsaddr = (temp_dnsaddr) ? $.ip2ip(temp_dnsaddr) : "0.0.0.0";
                temp_secdnsaddr = (temp_secdnsaddr) ? $.ip2ip(temp_secdnsaddr) : "0.0.0.0";

                if ((temp_dnsaddr + "," + temp_secdnsaddr) == "0.0.0.0,0.0.0.0") {
                    $.alert(ERR_WAN_DNS_INVAD);
                    $("#i-d-fol-pdns").focus();
                    return false;
                }
                wan_iplistarg_dyn.DNSServers = temp_dnsaddr + "," + temp_secdnsaddr;
            } else {
                wan_iplistarg_dyn.DNSOverrideAllowed = 0;
            }
            if (!$('#i-d-hostname').inputBoxMobile('checkValue')) {
                return false;
            }
            wan_iplistarg_dyn.X_TP_Hostname = $("#i-d-hostname").val();
            wan_iplistarg_dyn.X_TP_Unicast = $("#get-ip-unicast").checkboxMobile('option', 'checked') ? 1 : 0;

            wan_iplistarg_dyn.X_TP_IPv4Enabled = 1;
            if (false == addMacCloneAttrs(wan_iplistarg_dyn)) {
                return false;
            }
            return true;
        }

        function addPPPoEAttrs() {
            if (!$("#i-p-username").inputBoxMobile('checkValue')) {
                return false;
            }
            wan_pppoelistarg.username = $("#i-p-username").val();
            wan_pppoelistarg.password = $("#i-p-password").val();

            if ($("#ppp-select-conn").selectMobile('value') === '0') {
                wan_pppoelistarg.connectionTrigger = "AlwaysOn";
            } else {
                if ($("#i-p-idle").inputBoxMobile('checkValue')) {
                    wan_pppoelistarg.idleDisconnectTime = parseInt($("#i-p-idle").val(), 10);
                } else {
                    return false;
                }

                if ($("#ppp-select-conn").selectMobile('value') === '1')
                    wan_pppoelistarg.connectionTrigger = "OnDemand";
                else if ($("#ppp-select-conn").selectMobile('value') === '2')
                    wan_pppoelistarg.connectionTrigger = "Manual";
            }
            wan_pppoelistarg.PPPAuthenticationProtocol = $("#ppp-select-auth").selectMobile('value');

            wan_pppoelistarg.PPPoEACName = $("#i-p-server").val();
            wan_pppoelistarg.PPPoEServiceName = $("#i-p-service").val();
            if ($('#i-p-mtu').inputBoxMobile('checkValue')) {
                wan_pppoelistarg.maxMRUSize = parseInt($("#i-p-mtu").val(), 10);
            } else {
                return false;
            }
            wan_pppoelistarg.NATEnabled = 1;
            wan_pppoelistarg.X_TP_IGMPProxyEnabled = $("#i-p-igmp").checkboxMobile('option', 'checked') ? 1 : 0;
            if ($("#ppp-select-ip").selectMobile('value') === '1') {
                if (!$('#i-p-isp-ip').inputBoxMobile('checkValue')) {
                    return false;
                }
                wan_pppoelistarg.externalIPAddress = ($("#i-p-isp-ip").val()) ? $.ip2ip($("#i-p-isp-ip").val()) : "0.0.0.0";
                wan_pppoelistarg.X_TP_UseStaticIP = 1;
            } else if ($("#ppp-select-ip").selectMobile('value') === '0') {
                wan_pppoelistarg.X_TP_UseStaticIP = 0;
            }
            if ($('#i-p-echo').inputBoxMobile('checkValue')) {
                wan_pppoelistarg.PPPLCPEcho = parseInt($("#i-p-echo").val(), 10);
            } else {
                return false;
            }
            if ($("#ppp-select-dns").selectMobile('value') === '1') {
                if (!$('#i-p-fol-pdns').inputBoxMobile('checkValue')) {
                    return false;
                }
                if (!$('#i-p-fol-sdns').inputBoxMobile('checkValue')) {
                    return false;
                }
                var tmpDns1 = ($("#i-p-fol-pdns").val()) ? $.ip2ip($("#i-p-fol-pdns").val()) : "0.0.0.0";
                var tmpDns2 = ($("#i-p-fol-sdns").val()) ? $.ip2ip($("#i-p-fol-sdns").val()) : "0.0.0.0";
                wan_pppoelistarg.DNSOverrideAllowed = 1;
                wan_pppoelistarg.DNSServers = tmpDns1 + "," + tmpDns2;
            } else {
                wan_pppoelistarg.DNSOverrideAllowed = 0;
            }

            if (false == addMacCloneAttrs(wan_pppoelistarg)) {
                return false;
            }
            wan_pppoelistarg.X_TP_IPv4Enabled = 1;

            return true;
        }
        function save(val) {
            var ret;
            var type = $("#connection-type").selectMobile('value');
            if (type == "staticIp") {
                if (!(ret = addStaticIpAttrs())) return;
            } else if (type == "dynamicIp") {
                if (!(ret = addDynIpAttrs())) return;
            } else if (type == "pppoe") {
                if (!(ret = addPPPoEAttrs())) return;
            }

            var ethEnable = $("#ethWan_en").prop('checked') ? 1 : 0;
            $.startWaitingMobile($.tpLang.m_str.waiting);
            if (ethEnable == 0)
                $.act(ACT_SET, WAN_ETH_INTF, pStk, null, ["enable=0"]);
            else if (ethEnable == 1)
                $.act(ACT_SET, WAN_ETH_INTF, pStk, null, ["enable=1"]);

            if (type == "staticIp") {
                if (dynEnable == 1)
                    $.act(ACT_SET, WAN_IP_CONN, dynStk, null, ["enable=0"]);
                if (PPPoEEnable == 1)
                    $.act(ACT_SET, WAN_PPP_CONN, PPPoEStk, null, ["enable=0"]);
                if (l2tpEnable == 1)
                    $.act(ACT_SET, WAN_L2TP_CONN, l2tpStk, null, ["enable=0"]);
                if (pptpEnable == 1)
                    $.act(ACT_SET, WAN_PPTP_CONN, pptpStk, null, ["enable=0"]);
                if ((ethEnable == 0) && (staticEnable == 1))
                    $.act(ACT_SET, WAN_IP_CONN, staticStk, null, ["enable=0"]);
                if (!$.exe()) {
                    wan_iplistarg_sta.enable = 1;
                    $.act(ACT_SET, WAN_IP_CONN, staticStk, null, wan_iplistarg_sta);
                    $.act(ACT_SET, WAN_ETH_INTF, pStk, null, ["X_TP_lastUsedIntf=ipoe_eth3_s"]);
                } else
                    return;
            } else if (type == "dynamicIp") {
                if (staticEnable == 1)
                    $.act(ACT_SET, WAN_IP_CONN, staticStk, null, ["enable=0"]);
                if (PPPoEEnable == 1)
                    $.act(ACT_SET, WAN_PPP_CONN, PPPoEStk, null, ["enable=0"]);
                if (l2tpEnable == 1)
                    $.act(ACT_SET, WAN_L2TP_CONN, l2tpStk, null, ["enable=0"]);
                if (pptpEnable == 1)
                    $.act(ACT_SET, WAN_PPTP_CONN, pptpStk, null, ["enable=0"]);
                if ((ethEnable == 0) && (dynEnable == 1))
                    $.act(ACT_SET, WAN_IP_CONN, dynStk, null, ["enable=0"]);
                if (!$.exe()) {
                    wan_iplistarg_dyn.enable = 1;
                    $.act(ACT_SET, WAN_IP_CONN, dynStk, null, wan_iplistarg_dyn);
                    $.act(ACT_SET, WAN_ETH_INTF, pStk, null, ["X_TP_lastUsedIntf=ipoe_eth3_d"]);
                } else
                    return;
            } else if (type == "pppoe") {
                if (staticEnable == 1)
                    $.act(ACT_SET, WAN_IP_CONN, staticStk, null, ["enable=0"]);
                if (dynEnable == 1)
                    $.act(ACT_SET, WAN_IP_CONN, dynStk, null, ["enable=0"]);
                if (l2tpEnable == 1)
                    $.act(ACT_SET, WAN_L2TP_CONN, l2tpStk, null, ["enable=0"]);
                if (pptpEnable == 1)
                    $.act(ACT_SET, WAN_PPTP_CONN, pptpStk, null, ["enable=0"]);
                if ((ethEnable == 0) && (PPPoEEnable == 1))
                    $.act(ACT_SET, WAN_PPP_CONN, PPPoEStk, null, ["enable=0"]);
                if (!$.exe()) {
                    wan_pppoelistarg.enable = 1;

                    $.act(ACT_SET, WAN_PPP_CONN, PPPoEStk, null, wan_pppoelistarg);
                    $.act(ACT_SET, WAN_ETH_INTF, pStk, null, ["X_TP_lastUsedIntf=pppoe_eth3_d"]);
                } else
                    return;
            }

            $.exe(function(err) {
                if (!err) {
                    $.stopWaitingMobile()
                    if (val === 0) {
                        if (type == "staticIp") {
                            var ipConns = $.act(ACT_GET, WAN_IP_CONN, staticStk, null, ["name"]);
                            if (!$.exe()) {
                                l3ForwardingObj.__ifAliasName = ipConns.name;
                            } else
                                return;
                        } else if (type == "dynamicIp") {
                            var ipConnd = $.act(ACT_GET, WAN_IP_CONN, dynStk, null, ["name"]);
                            if (!$.exe()) {
                                l3ForwardingObj.__ifAliasName = ipConnd.name;
                            } else
                                return;
                        } else if (type == "pppoe") {
                            var pppConn = $.act(ACT_GET, WAN_PPP_CONN, PPPoEStk, null, ["name"]);
                            if (!$.exe()) {
                                l3ForwardingObj.__ifAliasName = pppConn.name;
                            } else
                                return;
                        } else if (type == "l2tp") {
                            var l2tpConn = $.act(ACT_GET, WAN_L2TP_CONN, l2tpStk, null, ["name"]);
                            if (!$.exe()) {
                                l3ForwardingObj.__ifAliasName = l2tpConn.name;
                            } else
                                return;
                        } else if (type == "pptp") {
                            var pptpConn = $.act(ACT_GET, WAN_PPTP_CONN, pptpStk, null, ["name"]);
                            if (!$.exe()) {
                                l3ForwardingObj.__ifAliasName = pptpConn.name;
                            } else
                                return;
                        }

                        l3ForwardingObj.__ifName = "";
                        l3ForwardingObj.defaultConnectionService = "";

                        $.act(ACT_SET, L3_FORWARDING, null, null, l3ForwardingObj);

                        if (!$.exe()) $.reload();
                    }
                }
            });
        }
    })();
</script>
