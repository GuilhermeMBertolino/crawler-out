<div class="titleBar">
    <a id="back" url="wireless.mobile.htm">
        <span class="icon-back sprite c-arrow-blue-left"></span>
    </a>
    <h1>Wireless Schedule</h1>
    <a id="save">Save</a>
</div>
<div class="button-group">
    <input type="radio" name="mode" advanced="button-group-first" id="2ghz" checked="true" />
    <label for="2ghz"><script type="text/html" class="trans"><%=$.tpLang.s_str.tap2g%></script></label>
    <input type="radio" name="mode" advanced="button-group-last" id="5ghz" />
    <label for="5ghz"><script type="text/html" class="trans"><%=$.tpLang.s_str.tap5g%></script></label>
</div>
<div id="2gShow">
    <div class="section-container mt15">
        <div class="section-box">
            <div></div>
            <input type="checkbox" id="enableWirelessSchedule" />
        </div>

    </div>
    <div class="section-container mt15 nd">
        <div class="section-box">
            <div></div>
            <input type="checkbox" id="enableWirelessSchedule5G" />
        </div>

    </div>
    <div id="access-time" class="mb20">
    </div>
</div>


<script type="text/javascript">
(function() {
    $.tpLocal('trans', $.tpLang);
    $('.titleBar').titleBar({
        title: $.tpLang.menu_str.wlsche
    });
    $('#save').titleButton('status', 'save', $.tpLang.m_str.save);

    //    2.4|5
    $('#2ghz').radioMobile().bind('check.radioMobile', function() {
        $.hideBlock('enableWirelessSchedule5G');
        $.showBlock('enableWirelessSchedule');
        timeObjBackup5G = $('#access-time').timeCircle('data');
        initATShow(timeObjBackup ? timeObjBackup : scheCfg);

    });
    $('#5ghz').radioMobile().bind('check.radioMobile', function() {
        $.hideBlock('enableWirelessSchedule');
        $.showBlock('enableWirelessSchedule5G');
        timeObjBackup = $('#access-time').timeCircle('data');
        initATShow(timeObjBackup5G ? timeObjBackup5G : scheCfg5G, '5G');

    });

    $("#access-time").show().timeCircle();
    $(".timeCircle").height(Math.floor($("#access-time").parent().innerWidth() * 0.81) + 100);
    $(".timeCircle svg").height(Math.floor($("#access-time").parent().innerWidth() * 0.81) + 100);


    $('#enableWirelessSchedule').flipSwitch({
        hasTitle: true,
        title: $.tpLang.wirelessSchedule_nstr.c_en
    }).on('on.flipSwitch', function(e) {
        enWS(stk, 1);
    }).on('off.flipSwitch', function(e) {
        enWS(stk, 0);
    });

    $('#enableWirelessSchedule5G').flipSwitch({
        hasTitle: true,
        title: $.tpLang.wirelessSchedule_nstr.c_en
    }).on('on.flipSwitch', function(e) {
        enWS(stk5G, 1);
    }).on('off.flipSwitch', function(e) {
        enWS(stk5G, 0);
    });


    $('#save').on('click', function() {
        if ($('#2ghz').radioMobile('option', 'checked') === true) {
            doSave(stk, '2g');
//            ÁÇπÂáª‰øùÂ≠òÊó∂ÔºåÂè¶‰∏ÄÈ¢ëÈÅìÈíüÁöÑÂÄºÊÅ¢Â§çÂàùÂßãÂÄ?
            init(true);
            timeObjBackup5G = scheCfg5G;
        } else {
            doSave(stk5G, '5g');
            //            ÁÇπÂáª‰øùÂ≠òÊó∂ÔºåÂè¶‰∏ÄÈ¢ëÈÅìÈíüÁöÑÂÄºÊÅ¢Â§çÂàùÂßãÂÄ?
            init(true);
            timeObjBackup = scheCfg;
        }
    });
    var stk;
    var stk5G;
    var scheCfg;
    var scheCfg5G

    var timeObjBackup;
    var timeObjBackup5G;
    //ÊâìÂºÄÂÖ≥Èó≠2g/5g schedule

    function enWS(stack, enable) {
        $.startWaitingMobile();

        $.act(ACT_SET, LAN_WLAN_TASK_SCHEDULE, stack, null, ["enable=" + enable, "isUsrCtrl=0"]);
        $.exe(function(err) {
            $.stopWaitingMobile();
            if (!err) {
                if (enable) {
                    $("#access-time").show();
                } else {
                    $("#access-time").hide();
                }
            }
        })
    }
    //ÊéßÂà∂ÂºÄÂÖ≥ÁöÑÊòæÁ§∫

    function initEnShow(scheCfg, band) {
        if (band != '5G') {
            band = '';
        }
        if (1 == scheCfg.enable) {
            $("#enableWirelessSchedule" + band).flipSwitch({
                'on': true
            });
        } else {
            $("#enableWirelessSchedule" + band).flipSwitch({
                'on': false
            });
        }
    }
    //ÊéßÂà∂ÈíüÁöÑÊòæÁ§∫

    function initATShow(scheCfg, band) {
        if (band != '5G') {
            band = '';
        }
        if ($('#enableWirelessSchedule' + band).flipSwitch('option', 'on')) {
            $('#access-time').show();
        } else {
            $('#access-time').hide();
        }
        $('#access-time').timeCircle('set', scheCfg);
    }

    function init(dataOnly) {
        idIndex = [];
        var wlanList = $.act(ACT_GL, LAN_WLAN, null, null, ["X_TP_Band"]);
        var wlanObj;
        var wlanObj5G;

        if (!$.exe()) {
            $.each(wlanList, function() {
                if ("2.4GHz" == this.X_TP_Band) {
                    wlanObj = this;
                }
                //    5G
                else if ("5GHz" == this.X_TP_Band) {
                    wlanObj5G = this;
                }
            });
        }
        var basicList = $.act(ACT_GS, LAN_WLAN_TASK_SCHEDULE, null, wlanObj.__stack, ["enable", "timeDot", "monAm", "monPm", "tueAm", "tuePm", "wedAm", "wedPm", "thuAm", "thuPm", "friAm", "friPm", "satAm", "satPm", "sunAm", "sunPm"]);
        //    5G
        var basicList5G = $.act(ACT_GS, LAN_WLAN_TASK_SCHEDULE, null, wlanObj5G.__stack, ["enable", "timeDot", "monAm", "monPm", "tueAm", "tuePm", "wedAm", "wedPm", "thuAm", "thuPm", "friAm", "friPm", "satAm", "satPm", "sunAm", "sunPm"]);
        if (!$.exe()) {
            scheCfg = basicList[0];
            stk = scheCfg.__stack;

            //    5G
            scheCfg5G = basicList5G[0];
            stk5G = scheCfg5G.__stack;

            if (!dataOnly) {
                initEnShow(scheCfg);
                initATShow(scheCfg);
            initEnShow(scheCfg5G, '5G');

        }

    }

    }

    function doSave(stk, band) {
        var taskSche = {};
        $.startWaitingMobile();
        var timeObj = $('#access-time').timeCircle('data');

        if (band == '2g') {
            taskSche.enable = $('#enableWirelessSchedule').flipSwitch('option', 'on') ? 1 : 0;
        } else {
            taskSche.enable = $('#enableWirelessSchedule5G').flipSwitch('option', 'on') ? 1 : 0;
        }

        taskSche.isUsrCtrl = 0;
        $.extend(taskSche, timeObj);

        $.act(ACT_SET, LAN_WLAN_TASK_SCHEDULE, stk, null, taskSche);

        $.exe(function(err) {
            $.stopWaitingMobile();
            if (!err) {
                $.toastMobile($.tpLang.s_str.saved);
            }
        });

    }

    init();
})();
</script>
