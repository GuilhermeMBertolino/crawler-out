<style type="text/css">
    #cloud-form {
        text-align: center;
    }

    div.pc-login-field {
        margin: 8px 0;
    }

    .pure-form input[type="text"].tp-input-text, .pure-form input[type="password"].tp-input-text {
        padding-left: 30px;
    }

    div.pc-inputarea {
        position: relative;
        display: inline-block;
    }

    label.pc-login-password-label, label.pc-login-username-label {
        position: absolute;
        left: 0;
        top: 0;
        margin: 7px 4px 7px 7px;
        height: auto;
        z-index: 1;
    }

    label.pc-login-username-label span.icon, label.pc-login-password-label span.icon {
        background: url("./img/icons.png") no-repeat scroll -193px -1185px;
        display: inline-block;
        height: 18px;
        /* margin-right: 14px; */
        width: 18px;
        vertical-align: middle;
    }

    label.pc-login-password-label span.icon {
        background-position: -337px -1116px;
    }

    label.pc-login-username-label span.icon {
        background-position: -357px -1115px;
    }

    span.pc-forgetPwd {
        position: absolute;
        top: 0;
        left: 190px;
    }

    span.pc-forgetPwd a {
        line-height: 32px;
        text-decoration: none;
        color: #4acbd6;
        white-space: nowrap;
    }

    div.button-container {
        /* margin-top: 40px; */
        text-align: center;
    }
    .pc-login-content {
        margin-top: 50px;
    }
    button#btn-cloud-login, button#register-now {
        width: 186px;
    }

    div#basic-account div.no-account {
        margin-top: 30px;
    }
    #no_account_tip {
        margin-left: 241px;
        margin-bottom: 5px;
        display: inline-block;
    }
    div#cloud-account-0 div#cloud_account_wizard_cnt, div#basic-account div#status-0 {
        position: relative;
        display: inline-block;
        padding-right: 24px;
    }

    ul {
        padding: 0;
    }
    a.link {
        display: inline-block;
        color: #4acbd6;
        vertical-align: inherit;
        text-decoration: none;
        cursor: default;
        font-style: italic;
    }
    div#basic-account #cloud-login {
        width: 100%;
        margin: 0px;
        padding: 0px;
    }
    #status-0 {
        margin-top: 15px;
    }
    span.input-hint{
        background: #ffffff;
        overflow: hidden;
        position: absolute;
        line-height: 20px;
        color:#cccccc;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        text-align: left;
        margin: 0.5em 0.6em 0.5em 30px ;
    }
</style>
<div id="basic-account">
    <div class="func_container">
        <div id="status-0">
            <span id="t_wizard"></span>

            <div class="cloud_hover_container">
                <span class="cloud_account_icon"></span>

                <div id="connect-area"></div>
                <div id="cloud_account_wizard_tip" class="cloud_account_wizard_tip_cnt">
                    <div class="tips-content-container">
                        <!-- <span class="tips-content-delta"></span> -->
                        <div class="position-top-left"></div>
                        <div class="position-top-center"></div>
                        <div class="position-top-right"></div>
                        <div class="position-center-left">
                            <div class="position-center-right">
                                <div class="tips-content-wrap">
                                    <div class="tips-content-container-wrap">
                                        <div class="tips-content">
                                            <span id="cloud_account_wizard_total"></span>
                                            <ul>
                                                <li class="cloud_account_wizard_tip">
                                                    <span id="cloud_account_wizard_tip1"></span>
                                                </li>
                                                <li class="cloud_account_wizard_tip">
                                                    <span id="cloud_account_wizard_tip2"></span>
                                                </li>
                                                <li class="cloud_account_wizard_tip">
                                                    <span id="cloud_account_wizard_tip3"></span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="position-bottom-left"></div>
                        <div class="position-bottom-center"></div>
                        <div class="position-bottom-right"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="status-1" class="nd"></div>
        <div id="status-2" class="nd">
            <h3 id="offline"></h3>
            <p id="offline-note-title" class="note"></p>
            <p id="offline-note-content" class="note"></p>
        </div>
    </div>

    <iframe id="cloud-login" class="nd" name="cloud-login" frameborder="no" scrolling="no" src=""></iframe>
    <form class="pc-login-content nd pure-form" id="cloud-form">
        <div class="login-field">
            <div class="pc-inputarea">
                <label class="pc-login-username-label">
                    <span class="icon"></span>
                </label>
                <input type="text" id="cloud-email" autocomplete="off">
                <span class="input-hint">Email</span>
            </div>
        </div>
        <div class="pc-login-field">
            <div class="pc-inputarea">
                <label class="pc-login-password-label">
                    <span class="icon"></span>
                </label>
                <input type="password" id="cloud-password" autocomplete="off">
                <span class="pc-forgetPwd"><a href="#" id="cloud-forgot">For get password</a></span>
                <span class="input-hint">Password1</span>
            </div>
        </div>
        <div class="button-wrapper">
            <button type="submit" class="green T_login2" id="btn-cloud-login"></button>
            <!--<button id="cloud_login_status" class="button-button" type="button">-->
            <!--<span class="text button-text">Log in</span>-->
            <!--</button>-->
            <!--<div class="button-error-tips widget-error-tips">-->
            <!--<div class="shadow-top-left"></div>-->
            <!--<div class="shadow-top"></div>-->
            <!--<div class="shadow-top-right"></div>-->
            <!--<div class="shadow-left">-->
            <!--<div class="shadow-right">-->
            <!--<span class="widget-error-tips-delta"></span>-->

            <!--<div class="widget-error-tips-wrap">-->
            <!--<div class="content error-tips-content">-->
            <!--<span id="errorContent"></span>-->
            <!--</div>-->
            <!--</div>-->
            <!--</div>-->
            <!--</div>-->
            <!--<div class="shadow-bot-left"></div>-->
            <!--<div class="shadow-bot"></div>-->
            <!--<div class="shadow-bot-right"></div>-->
            <!--</div>-->
        </div>
    </form>
    <!--<div id="cloud-form" class="form-margin-left-cnt hidden">-->
    <!--<form id="form-cloud-login" class="part-separate">-->
    <!--<div class="init-field">-->
    <!--<label id="login-username-label">-->
    <!--<span class="icon"></span>-->
    <!--<span class="text"></span>-->
    <!--</label>-->
    <!--<input id="cloud-email"   tabindex="1" name="username" type="text" />-->
    <!--</div>-->
    <!--<div class="init-field">-->
    <!--<label id="init-password-label">-->
    <!--<span class="icon"></span>-->
    <!--<span class="text"></span>-->
    <!--</label>-->
    <!--<input id="cloud-password"  name="password" type="password" />-->
    <!--<div class="inline-block forget-cnt"><a href="#" class="link" id="cloud-forgot"></a></div>-->
    <!--</div>-->
    <!--<button type="button" tabindex="3" id="btn-cloud-login"></button>-->
    <!--<input class="cloud_login_status" value="" />-->
    <!--<p><span id="not-account-tip"></span></p>-->
    <!--</form>-->
    <!--</div>-->

    <div class="no-account nd">
        <span id="no_account_tip"></span>
        <button type="submit" id="register-now" class="green T_REGISTER_NOW"></button>
    </div>
</div>
<script type="text/javascript">
(function () {
//    var URL_CHECK_INTERNET = $.su.url("/admin/cloud_account?form=check_internet");
//    var URL_CHECK_LOGIN = $.su.url("/admin/cloud_account?form=check_login"); //"./data/basic.check_login.json";
//    var URL_CLOUD_LOGIN = $.su.url("/admin/cloud_account?form=user_login");//"./data/quicksetup.cloud_login.json";
//    var URL_LOGIN = $.su.url("/admin/cloud_account?form=user_login");//"./data/basic.login.json";
//    var URL_REGISTER = $.su.url("/admin/cloud_account?form=user_register");//"./data/basic.register.json";
//    var URL_RESET = $.su.url("/admin/cloud_account?form=cloud_reset_pwd_login_cloud");//"./data/basic.reset.json";
//    var URL_CHANGE_PWD = $.su.url("/admin/cloud_account?form=modify_cloud_password");//"./data/basic.change.json";
//    var URL_INFO = $.su.url("/admin/cloud_account?form=user_info");//"./data/basic.info.json";
//    var URL_DOMAIN_LIST = $.su.url("/admin/ddns?form=tplink");
//    var URL_RESET_SEND_MAIL = $.su.url("/admin/cloud_account?form=get_reset_pwd_verify_code");//"./data/basic.reset_send.json";
//    var URL_UPLOAD_IMAGE = $.su.url("/admin/cloud_account?form=upload_image");//"./data/basic.upload.json";
//    var URL_UPLOAD_CHECK = $.su.url("/admin/cloud_account?form=upload_check");//"./data/basic.upload_check.json";
//    var URL_CHECK_REGISTER_EMAIL = $.su.url("/admin/cloud_account?form=user_check_mail_verified");//"./data/quicksetup.register_mail.json";
//    var URL_REGISTER_LOGIN = $.su.url("/admin/cloud_account?form=cloud_register_login");//./data/quicksetup.register_login.json";
//
//    var URL_UNBIND_ACCOUNT = $.su.url("/admin/cloud_account?form=cloud_unbind");
//
//    var unbindProxy = new $.su.Proxy({
//        url: URL_UNBIND_ACCOUNT,
//    });
//
//    var checkLoginProxy = new $.su.Proxy({
//        url: URL_CHECK_LOGIN,
//    });
//
//    var checkInternetProxy = new $.su.Proxy({
//        url: URL_CHECK_INTERNET,
//    });
//
//    var checkRegisterEmailStatusProxy = new $.su.Proxy({
//        url: URL_CHECK_REGISTER_EMAIL,
//    });
//
//    var cloudLoginProxy = new $.su.Proxy({
//        url: URL_CLOUD_LOGIN
//    });
//
//    var registerLoginProxy = new $.su.Proxy({
//        url: URL_REGISTER_LOGIN,
//    });
    var CURR_USER_DEFUALT = 0,
            CURR_USER_LOGING = 1,
            CURR_USER_LOGIN_SUCC = 2, /* user login successfully. */
            CURR_USER_BINDING = 3,	  /* binding is a part of login, user may not need to care about it */
            CURR_USER_BIND_SUCC = 4,
            CURR_USER_UNBINDING = 5,
            CURR_USER_UNBIND_SUCC = 6,
            CURR_USER_TOKEN_GETTING = 7,
            CURR_USER_TOKEN_GET_SUCC = 8,
            CURR_USER_DEV_USER_RMING = 9, /*表示当前user角色用户移除中*/
            CURR_USER_DEV_USER_RM_SUCC = 10, /*表示移除用户成功*/
            CURR_USER_LOGIN_FAILED = 20000,
            CURR_USER_TOKEN_GET_FAILED = 20001,
            CURR_USER_NO_INTERNET = 20002,    //"Internet is unavailable.",
            CURR_USER_BIND_FAILED = 20003,   //"E20502": 					"Unable to bind the device. Please try again later.",
            CURR_USER_UNBIND_FAILED = 20004,//"E20503": 					"Unable to unbind the device. Please try again later.",
            CURR_USER_BAD_USER = 20005, /* username not correct for local authentication. */
            CURR_USER_NOT_REG = 20006, 	/* not registered in cloud server, return from cloud server. *///"E20600": 					"This email is not registered.",
            CURR_USER_ERR_PWD = 20007,  /* pwd error from cloud server or local authentication. */
            CURR_USER_INACTIVE = 20008, /* user account not active in cloud server. *///"E20602": 					"This account is not yet activated.",
            CURR_USER_DEV_USER_RM_FAILED= 20009;  /*表示移除用户失败。*/

    $.helpControl = $.helpControl || {};
    $.helpControl.cloudLogin = 0;       //用于控制help的显示。
    $.helpControl.cloudRole = null;
    var disabledButton;

    var registerEmailCheck = false;

    var checkRegisterEmailStatusTime = 0;

    $("#t_wizard").html($.tpLang.cloudBasic_nstr.CLOUD_WIZARD);
    $("#no_account_tip").html($.tpLang.cloudBasic_nstr.NO_ACCOUNT);

    $("#cloud_account_wizard_total").html($.tpLang.quicksetup_nstr.ACCOUNT_DESP);
    $("#cloud_account_wizard_tip1").html($.tpLang.quicksetup_nstr.ACCOUNT_DESP_SUB1);
    $("#cloud_account_wizard_tip2").html($.tpLang.quicksetup_nstr.ACCOUNT_DESP_SUB2);
    $("#cloud_account_wizard_tip3").html($.tpLang.quicksetup_nstr.ACCOUNT_DESP_SUB3);

    $("#cloud-forgot").html($.tpLang.login.forgetPwd);
    $("#cloud-login").hide();
    $("#status-0").hide();

    $("#cloud-forgot").on("click", function () {
        onReceive({data: {eType: "ev_goto", url: "findBackPassword"}, source: null, origin: "_self"});
    });

//    var cloudLoginForm = $("form#form-cloud-login").form({
//        proxy: cloudLoginProxy,
//        cls:"no-padding",
//        showPrompt: false,
//        fields: [
//            {"name": "username"},
//            {"name": "password"}
//        ],
//        submitBtn: false
//    }).on("ev_beforeLoadData",function(e,data){
//        if(data){
//            $("#cloud-password-hidden").password("setValue", data.password);
//        }
//    });

    // $("input#cloud-email").attr('placeholder', $.tpLang.login.email);
    $("input#cloud-email ~ .input-hint").text($.tpLang.login.email);

//    textbox({
//        fieldLabel: null,
//        allowBlank: false,
//        //minLength:1,
//        hint: $.tpLang.cloudBasic_nstr.EMAIL,
//        maxLength:64,
//        vtype:"cloud_email",
//        cls: "part-separate inline-block"
//    }).on("ev_change", function(){
//
//    });
    $("input#cloud-password ~ .input-hint").text($.tpLang.login.password);
    $("input#cloud-password").on('keyup', function (e) {
        if (e.keyCode == 13) {
            $('#btn-cloud-login').click();
        }
    }).tpPassword();


//    $("input#cloud-password").password({
//        fieldLabel: null,
//        allowBlank: false,
//        showLevel: false,
//        minLength: 6,
//        maxLength: 32,
//        hint: $.tpLang.cloudBasic_nstr.PASSWORD,
//        cls: "inline-block",
//        vtype: "cloud_pwd"
//    }).on("ev_change", function(e,value,key,keyCode){
//        if(key == "Enter" || keyCode == 13){
//            if(cloudLoginForm.form("validate")){
//                if(!$("button#btn-cloud-login").prop('disabled')){
//                    $("button#btn-cloud-login").button("disable");
//                    var username = $("#cloud-email").textbox("getValue");
//                    var password = $("#cloud-password").password("getValue");
//                    $("input.cloud_login_status").status("setLoading");
//                    onReceive({data:{eType:"ev_login",account:{cloudUserName: username, cloudPassword: password}},source:null,origin:"_self"});
//                }
//            }
//        }
//    });

//    $("input#cloud-password").password("getContainer").find(".password-text").attr("tabindex","2");

//    $("input.cloud_login_status").status({
//        cls:"inline"
//    });

    var cloudLoginBtn = $("button#btn-cloud-login").on('click', function () {
        $.addLoading($(this));
        var $password = $("#cloud-password");
        var $user = $("#cloud-email");
        var pwd = $password.val();
        var user = $user.val();

        if (user == '') {
            $.alert($.tpLang.login.tipsText);
            $user.focus();
            return;
        }
        var regex = /^[a-zA-Z0-9\.\!\#\$\%\&\'\*\+\/\=\?\^\_\`\{\|\}\~\-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*$/;
        if (!regex.test(user)) {
            $.alert($.tpLang.login.emailFormat);
            $user.focus();
            return;
        }
        if (pwd == "") {
            $.alert($.tpLang.login.tipsText);
            $password.focus();
            return;
        }
        onReceive({data:{eType:"ev_login",account:{cloudUserName: user, cloudPassword: pwd}},source:null,origin:"_self"});
    });

    /*button({
     text: $.tpLang.login.login,
     cls: "submit inline-block account-login-btn",
     handler: function(){
     if(cloudLoginForm.form("validate")){
     $("button#btn-cloud-login").button("disable");
     var username = $("#cloud-email").textbox("getValue");
     var password = $("#cloud-password").password("getValue");
     $("input.cloud_login_status").status("setLoading");
     onReceive({data:{eType:"ev_login",account:{cloudUserName: username, cloudPassword: password}},source:null,origin:"_self"});
     }
     }
     });*/


    $("#register-now").on('click', function () {
        onReceive({data: {eType: "ev_goto", url: "register"}, source: null, origin: "_self"});
    });
    /*button({
     text: $.tpLang.cloudBasic_nstr.REGISTER_NOW,
     cls: "submit register-account",
     btnCls: "login-full",
     handler: function(){
     onReceive({data:{eType:"ev_goto",url:"register"},source:null,origin:"_self"});
     }
     });*/


//    var infoProxy = new $.su.Proxy({
//        url: URL_INFO
//    });
    var userObj;
    function init() {
        $.addLoading();
        userObj = $.act(ACT_GET, CURRENT_USER);
        if ($.exe()) {
            return;
        }
        $.doInternetDiag(function () {
            if (userObj.userSetting == 2 && userObj.loginStatus == 2) {
                //已登录
                onReceive({data: {eType: "ev_goto", url: "devicePages&page=account"}, source: null, origin: "_self"});
            } else {
                $("#status-0").show();
                $("#cloud-form").show();
                $(".no-account").show();
            }
            $.removeLoading();
        }, function () {
            $("div#status-2").removeClass("nd");
            $.removeLoading();
        });

    }

//    $.su.loading.show("account_check");
//    checkLoginProxy.read({}, function(data){
//        if(data.islogined){
//            $("div#help_login").addClass("hidden");
//            $("div#help_information").removeClass("hidden");
//            checkInternetProxy.read({}, function(data){
//                onReceive({data:{eType:"ev_goto",url:"devicePages&page=account"},source:null,origin:"_self"});
//            }, function(){
//                $("div#status-2").removeClass("hidden");
//            });
//        }else{
//            checkInternetProxy.read({}, function(data){
//                $("#status-0").show();
//                $("#cloud-form").show();
//                $(".no-account").show();
//            }, function(){
//                $("div#status-2").removeClass("hidden");
//            });
//        }
//    }, function(){
//        checkInternetProxy.read({}, function(data){
//            $("div#status-0").show();
//        },function(){
//            $("div#status-2").removeClass("hidden");
//        });
//    });

//    $(checkInternetProxy).on("ev_read ev_failed ev_error", function(){
//        $.su.loading.hide("account_check");
//    });

//    var loginProxy = new $.su.Proxy({
//        url: URL_LOGIN
//    });

//    function loadDomainData(hideLoading){
//        if(hideLoading===true){
//            $.su.loading.hide("iframeResize");
//        }
//        storeDomain.load({}, function(data){
//            var bindArray = [];
//            var occupiedArray = [];
//            var freeArray = [];
//            for(var index = 0, len = data.length; index < len; index++){
//                if(data[index].current_domain === true){
//                    bindArray.push(data[index]);
//                    $("input#tp-link-current-domain").textbox("setValue",data[index].domain);
//                }else if(data[index].status.toUpperCase() === "OCCUPIED"){
//                    occupiedArray.push(data[index])
//                }else{
//                    freeArray.push(data[index])
//                }
//            }
//            this.data = bindArray.concat(occupiedArray,freeArray);
//        });
//    }

    /*status 2*/
    $("#offline").html($.tpLang.cloudBasic_nstr.OFFLINE_NOTE_TITLE);
    $("p#offline-note-title").html($.tpLang.cloudBasic_nstr.LOGIN_NOTE_TITLE);
    $("p#offline-note-content").html($.tpLang.cloudBasic_nstr.LOGIN_OFFLINE_NOTE);

    function onReceive(eObject) {
        var e = eObject.originalEvent || eObject;

        //console.log("parent receive from "+ e.origin, e.data, e)
        if (e.origin !== $.cloudOrigin && e.origin !== "_self" && e.origin != undefined) {
            return;
        }
        var data = e.data;
        if (typeof(e.data) == "string") {
            data = $.parseJSON(data);
        }
        if (data) {
            switch (data.eType) {
                //module change
                case "ev_goto":
                {
                    if (data.url) {
                        //getToken and set iframe's src, then set wating event(10s timeout)
                        $.getToken(data.url);
                    }
                    else {
                        if (data.index == "activation") {
                            ;
                        }
                    }
                    if ("login" == data.url || "login" == data.index) {
                        //用户未登录
                        $("#cloud-login").hide();
                        $("#status-0").show();
                        $("#cloud-form").show();
                        $("div.no-account").show();
                    }
                    else if ("register" == data.url || "register" == data.index) {
                        //注册
                        $.addLoading();
                        $("#status-0").hide();
                        $("#cloud-form").hide();
                        $("div.no-account").hide();
                    }
                    else if ("findBackPassword" == data.url || "findBackPassword" == data.index) {
                        //找回密码
                        $.addLoading();
                        $("#status-0").hide();
                        $("#cloud-form").hide();
                        $("div.no-account").hide();
                    }
                    else if ("devicePages&page=account" == data.url || "devicePages&page=account" == data.index) {
                        //
                        $.addLoading();
                        // added by CCy, if we login as offline owner user, we shoud try login again here, but we did not
                        // store cloud account passwd in dut,so just set login success here. 
                        $.cloudLogin(true, userObj.userName);
                        $.adjustTop();

                        $("#status-0").hide();
                        $("#cloud-form").hide();
                        $("div.no-account").hide();
                        $.helpControl.cloudLogin = 1;
                        $.helpControl.cloudRole = (userObj.userRole == 1 ?  0 : 1);
                        $.loadHelp($.curPage.replace(/\.htm$/, ''));
//                        $("div#help_login").addClass("hidden");
//                        $("div#help_information").removeClass("hidden");
                    }
                    break;
                }
                case "ev_unbind":
                {
                    //解绑操作
                    var action;
                    if (userObj.userRole == 1) {
                        //owner
                        action = 1;
                    } else if (userObj.userRole == 2){
                        //normal user
                        action = 6;
                    }
                    $.act(ACT_SET, CURRENT_USER_INFO, null, null, ["action=" + action, "status=0"]) ;
                    $.exe();

                    var count = 0;
                    var timesMax = 10;
                    setTimeout(function() {
                        count++;
                        var currentUser = $.act(ACT_GET, CURRENT_USER_INFO, null, null);
                        $.exe();
                        if (currentUser.status == CURR_USER_UNBIND_SUCC || currentUser.status == CURR_USER_DEV_USER_RM_SUCC) {
                            //解绑成功退出登录
                            $.act(ACT_CGI, '/cgi/logout');
                            $.exe();
                            //$.deleteCookie('Authorization');
                            $.refresh();
                        } else if(currentUser.loginStatus >= 20000){
                            //unbind failed
                            if (currentUser.loginStatus == CURR_USER_DEV_USER_RM_FAILED) {
                                $.alert($.tpLang.cloudBasic_nstr['E20004']);
                            }
                            $.alert($.tpLang.cloudBasic_nstr['E' + currentUser.loginStatus]);

                        } else if (count < timesMax) {
                            setTimeout(arguments.callee, 1000);
                        } else {
                            $.alert($.tpLang.ddns_nstr['E20002']);
                        }
                    }, 1000);

//                    var URL_LOGOUT = $.su.url("/admin/system?form=logout"); //"./data/login.json"
//                    var logoutProxy = new $.su.Proxy({
//                        url: URL_LOGOUT,
//                        autoLoad: false
//                    });
//                    var h = function () {
//                        if (localStorage) {
//                            localStorage.setItem("token", "");
//                        }
//                        ;
//                        location.href = "/";
//                    };
//                    //owner----unbind & logout   user----unbind(actually delete) & logout
//                    unbindProxy.write({}, function () {
//                        logoutProxy.write({}, h, h);
//                    }, function (errcode, others, data) {
//                        var errorcode = data.errorcode;
//                        errorcode && (errorcode = String(errorcode).replace(/^-/, 'E'));
//                        if (errorcode && $.su.cloudErrorCode.indexOf(errorcode) != -1) {
//                            $("span#cloud-error-msg-text").html($.su.CHAR.ERROR[errorcode]);
//                            $("div#cloud-error-msg").msg("show");
//                        }
//                    }, function () {
//                    });
                    break;
                }
                //cloud login status
                case "ev_login":
                {
                    var account = data.account;
                    if (e.origin == $.cloudOrigin) {
                        //cloud des decrypt
                        account.cloudPassword = $.DES3.decrypt(account.cloudPassword);
                    }

                    $.act(ACT_SET, CURRENT_USER, null, null, ["userName=" + account.cloudUserName, "passwd=" + account.cloudPassword, "action=2", "loginStatus=0", "needReconn=1"]) ;
                    if ($.exe()) {
                        return;
                    }

                    var count = 0;
                    var timesMax = 10;
                    setTimeout(function() {
                        count++;
                        userObj = $.act(ACT_GET, CURRENT_USER, null, null);
                        if ($.exe()) {
                            return;
                        }

                        if (userObj.loginStatus == CURR_USER_LOGIN_SUCC) {
                            //登录成功
                            $.cloudLogin(true, userObj.userName);
                            $.adjustTop();
                            onReceive({data: {eType: "ev_goto", url: "devicePages&page=account"}, source: null, origin: "_self"});
                            $.removeLoading();
                        } else if(userObj.loginStatus >= 20000){
                            //登录失败
                            $.alert($.tpLang.cloudBasic_nstr['E' + userObj.loginStatus]);
                        } else if (count < timesMax) {
                            //
                            setTimeout(arguments.callee, 1000);
                        } else {
                            $.alert($.tpLang.ddns_nstr['E20002']);
                        }
                    }, 1000);

//                    $("#cloud-password-hidden").password("setValue", account.cloudPassword);
//                    $("#cloud-password-hidden").password("doEncrypt");
//                    account.cloudPassword = $("#cloud-password-hidden").textbox("getValue");
//                    //send user message to server
//                    cloudLoginProxy.write({"username": account.cloudUserName, "password": account.cloudPassword}, function (data) {
//                        $("#top-control-account span.icon").addClass("logined");
//                        $("#top-control-account #txt-account").html(account.cloudUserName);
//
//                        onReceive({data: {eType: "ev_goto", url: "devicePages&page=account"}, source: null, origin: "_self"});
//                        $("input.cloud_login_status").status("setNormal");
//                    }, function (errcode, others, data) {
//                        var errorcode = data.errorcode;
//                        errorcode && (errorcode = String(errorcode).replace(/^-/, 'E'));
//                        if (errorcode && $.su.cloudErrorCode.indexOf(errorcode) != -1) {
//                            $("span#cloud-error-msg-text").html($.su.CHAR.ERROR[errorcode]);
//                            $("div#cloud-error-msg").msg("show");
//                        }
//                        $("input.cloud_login_status").status("setNormal");
//                        cloudLoginBtn.button("enable");
//                    }, function () {
//                        $("input.cloud_login_status").status("setNormal");
//                        cloudLoginBtn.button("enable");
//                    });
                    break;
                }
            }
        }
    };

    $(window).off('.cloudBasic').on("message.cloudBasic", onReceive);

    //卸载时候调用
//    $.su.app.runningModule.addUnloadHandler(function(){
//        clearInterval(checkRegisterEmailStatusTime);
//        //remove eventlistener
//        $(window).off("message", onReceive);
//    });
//
//    var helpLogin = new $.su.Help({
//        container: "div#help_login",
//        content: ["BASIC_ACCOUNT_LOGIN"]
//    });
//
//    var helpInformation = new $.su.Help({
//        container: "div#help_information",
//        content: ["BASIC_ACCOUNT_LOGIN","ACCOUNT_INFO","DEVICE_INFO","BOUND_ACCOUNT"]
//    });
    $.tpInit(init);
    $('.input-hint').click(function(e){
        var inputArea = $(e.target).parents('.pc-inputarea').find('input:visible');
        if (inputArea.length > 0) {
            inputArea.focus();
        }       
    });
    $('.pc-inputarea input').bind('blur',function(e){
        var val = $(e.target).val();
        if (!val){
            var inputHint = $(e.target).parents('.pc-inputarea').find('.input-hint');
            inputHint.show();
        }
    }).bind('focus',function(e){
        $(e.target).parents('.pc-inputarea').find('.input-hint').hide();
    });
})();
//]]>
</script>
