<div>
    <div class="titleBar">
        <a url="networkMap.mobile.htm"><span class="icon-back sprite c-arrow-blue-left"></span></a>
        <h1>USB Disk</h1>
        <a id="edit" data-status="edit">Edit</a>
    </div>

    <div class="section-title mt15">
        <span>
            <script type="text/html" class="title-string">
                <%=$.tpLang.networkMap_nstr.c_printer%>
            </script>  
        </span>      
    </div>
    <div class="info-list">
        <div class="section-container">
        <div class="section-box">
            <span>
	            <script type="text/html" class="title-string">
	                <%=$.tpLang.printSrv_nstr.t_pn%>
	            </script>            	
            </span>
            <span class="text-readonly" id="printerName"></span>
        </div>
    </div>
    </div>

    <div class="section-title mt15" id="listHead">
        <span>
            <script type="text/html" class="title-string">
                <%=$.tpLang.networkMap_nstr.c_usbdisk%>
            </script>  
        </span>      
    </div>
    <div class="info-list" id="usbList"></div>
</div>
<div class="item-list nd" id="no-dev">
    <div class="section-container">
        <div class="section-box">
            <div class="device-div">
                <div class="device-content-none">
                    <span class="sprite grid-no-usb"></span>
                </div>
                <div class="device-content-none-text">
                    <script type="text/html" class="title-string">
                        <%=$.tpLang.networkMap_nstr.t_nousb%>
                    </script>  
                </div>
            </div>
        </div>
    </div>
</div>

<script type='text/javascript'>
(function() {
    $.tpLocal('title-string', $.tpLang);
    $('.titleBar').titleBar();
    $('.titleBar').titleBar('title', $.tpLang.networkMap_nstr.c_usbdisk);
    $('#edit').titleButton('status', 'edit', $.tpLang.m_str.edit).bind('click', function() {
        $.loadPhoneMain('usbSettings.mobile.htm');
    });

		function refresh() {	
			var curStatus = $.act(ACT_GET, XTP_PRINT_SERVICE, null, null, null);

			if ($.exe()) {
				return;
			}

			if (curStatus.serverName == 'No Printer') {
				$("#printerName").text($.tpLang.printSrv_nstr.t_noprint);
			} else {
				$("#printerName").text(curStatus.serverName);
			}
		}

    var usbDeviceList;
    var volumeList;
    var smbService;
    var accessFolderList;
    var numAliveDev = 0;
    var numAliveLog = 0;

    (function init() {
			refresh();

        appendParent = $('#usbList');

        usbDeviceList = $.act(ACT_GL, USB_DEVICE, null, null);
        volumeList = $.act(ACT_GL, LOGICAL_VOLUME, null, null);
        smbService = $.act(ACT_GET, SMB_SERVICE, null, null, null);
        accessFolderList = $.act(ACT_GL, SMB_SERVICE_FOLDER, null, null, null);

        if (!$.exe()) {
            if (0 == usbDeviceList.length) {
                $('#usbList').addClass('nd');
                $('#no-dev').removeClass('nd');
                return;
            }

            var idx;
            for (idx = 0; idx < usbDeviceList.length; idx++) {
                if ("Online" == usbDeviceList[idx].status) {
                    numAliveDev++;
                }
            }

            for (idx = 0; idx < volumeList.length; idx++) {
                if ("Online" == volumeList[idx].status) {
                    numAliveLog++;
                }
            }

            for (idx = 1; idx <= usbDeviceList.length; idx++) {
                if ("Online" == usbDeviceList[idx - 1].status) {

                    var diskInfo = usbDeviceList[idx - 1].vendor/* + ' ' + usbDeviceList[idx - 1].model*/;
                    var deviceDiv = $('<div class="section-container"><div class="section-box"><div class="device-div" id="volumeTbl' +
                        idx + '"><div class="device-label"><span class="sprite grid-row-usb"></span><span class="text">' + diskInfo + '</span></div>' 
                        + '<div class="device-content"></div>'
                        + '</div></div></div>').appendTo(appendParent);

                    
                    for (var i = 0; i < volumeList.length; i++) {
                        if (((usbDeviceList[idx - 1].__stack).split(','))[0] == ((volumeList[i].__stack).split(','))[0]) {

                            var lineDiv = $('<div class="device-line">'
                                        + '<div class="device-info">'
                                        + '<div class="device-info-name">' + volumeList[i].name + '</div>'
                                        + '<div class="device-info-item">'
                                        + '<span class="device-info-title">' + $.tpLang.table_str.capacity + ':' + '</span>'
                                        + '<span class="device-info-text">' + volumeList[i].capacity + '</span>'
                                        + '</div><div class="device-info-item">'
                                        + '<span class="device-info-title">' + $.tpLang.table_str.freeSpace + ':' + '</span>'
                                        + '<span class="device-info-text">' + volumeList[i].freeSpace + '</span>'
                                        + '</div></div></div>');

                            lineDiv.appendTo($('#volumeTbl' + idx).find('.device-content').first());
                        }
                    }

                    $.addDeviceBlock($('#volumeTbl' + idx));
                }
            }
        }

			$.auto(function() {
				refresh();
			}, 5000);
    }) ();

})();
</script>
