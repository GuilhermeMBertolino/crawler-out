<div id="quicksetup_wan_type_container content-container">
    <form class="pure-form pure-form-aligned">
        <div class="inline">
            <button type="submit" class="blue T_detect" id="detect" value="Detect" onclick="doWanDetect()">Auto Detect</button>
        </div>
        <div class="inline">
            <span id="status" class="blue"></span>
        </div>
        <div>
            <input type="radio" name="wanType" id="qsDynIp" value="DynamicIp"/>
            <label id="c_qsDynIp">Dynamic IP</label>
        </div>
        <div>
            <input type="radio" name="wanType" id="qsStaIp" value="StaticIp" />
            <label id="c_qsStaIp">Static IP</label>
        </div>
        <div>
            <input type="radio" name="wanType" id="qsPppoe" value="PPPoE" />
            <label id="c_qsPPPoE">PPPoE</label>
        </div>
        <div>
            <input type="radio" name="wanType" id="qsL2tp" value="L2tp" />
            <label id="c_qsL2TP">L2TP</label>
        </div>
        <div>
            <input type="radio" name="wanType" id="qsPptp" value="Pptp" />
            <label id="c_qsPPTP">PPTP</label>
        </div>
		
		<div class="advanced-block" type="button" id="iptv_module_hide" onclick="IptvModeClick(this)">
            <span class="advanced-icon advanced-hide-icon"></span>
            <span class="T_iptv_isp">Special ISP Settings</span>
		</div>	
			
		<div id="iptv_mode_adv" class="nd">	
            <form class="pure-form pure-form-aligned">
    			<b class="T_mode">Mode:</b>
                <select id="iptvMode" class="xl">
    				<option value='None' class="T_NONE">None</option>
    				<option value='Bridge' class="T_BRIDGE">Bridge</option>
                    <option value='ExStream' class="T_EXSTREAM" >Singapore-Singtel</option>
                    <option value='Unifi' class="T_UNIFI" >Malaysia-Unifi</option>
                    <option value='Maxis' class="T_MAXIS" >Malaysia-Maxis</option>
                    <option value='Ufb' class="T_UFB">New Zealand-UFB</option>
                    <option value='Nbn' class="T_NBN">Australia-NBN</option>
                    <option value='Custom' class="T_CUSTOM">Custom</option>
                </select>
                <div class = "part-separate">
                </div>
                <div id="internetVIDSetup" >
                    <div class="inline">
                        <b id="internetVIDCon">Internet Vlan ID(1-4094):</b>
                        <input type="text" id="internetVID" class="s" value="0" />
                    </div>
                    <div class="inline pure-control-group" style="margin-left: 20px;">
                        <label id="internetVPriCon" class="label-title-second" style="text-align:left; line-height:14px; width:150px;">Internet Vlan Priority:</label>
                        <div style="margin-left: 0px;" class="inline">
                            <select id="internetVPri"  class="xs">
                                <option value='0'>0</option>
                                <option value='1'>1</option>
                                <option value='2'>2</option>
                                <option value='3'>3</option>
                                <option value='4'>4</option>
                                <option value='5'>5</option>
                                <option value='6'>6</option>
                                <option value='7'>7</option>
                            </select>
                        </div>
                    </div>
                    <div class="inline" style="margin-left: 20px;">
                        <input type="checkbox" id="iptvQtagEn" />
                        <label id="t_iptv_qtag_enable">802.1Q Tag</label>
                    </div>
                </div>
                <div id="IPPhoneVIDSetup" >
                    <div class="inline">
                        <b id="ipphoneVIDCon">IP-Phone Vlan ID(1-4094):</b>
                        <input type="text" id="ipphoneVID" class="s" value="0" />
                    </div>
                    <div class="inline pure-control-group" style="margin-left: 20px;">
                        <label id="ipphoneVPriCon"  class="label-title-second" style="text-align:left; line-height:14px; width:150px;">IP-Phone Vlan Priority:</label>
                        <div style="margin-left: 0px;" class="inline">
                            <select id="ipphoneVPri"  class="xs">
                                <option value='0'>0</option>
                                <option value='1'>1</option>
                                <option value='2'>2</option>
                                <option value='3'>3</option>
                                <option value='4'>4</option>
                                <option value='5'>5</option>
                                <option value='6'>6</option>
                                <option value='7'>7</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="IPTVVIDSetup" >
                    <div class="inline">
                        <b id="iptvVIDCon">IPTV Vlan ID(1-4094):</b>
                        <input type="text" id="iptvVID" class="s" value="0" />
                    </div>
                    <div class="inline pure-control-group" style="margin-left: 20px;">
                        <label id="iptvVPriCon"  class="label-title-second" style="text-align:left; line-height:14px; width:150px;">IPTV Vlan Priority:</label>
                        <div style="margin-left: 0px;" class="inline">
                            <select id="iptvVPri"  class="xs">
                                <option value='0'>0</option>
                                <option value='1'>1</option>
                                <option value='2'>2</option>
                                <option value='3'>3</option>
                                <option value='4'>4</option>
                                <option value='5'>5</option>
                                <option value='6'>6</option>
                                <option value='7'>7</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="IPTVMultiVIDSetup">
                    <div class="inline">
                        <b id="iptvMultiVIDCon">IPTV Multicast Vlan ID(1-4094):</b>
                        <input type="text" id="iptvMultiVID"  class="s" value="0" />
                    </div>
                    <div class="inline pure-control-group" style="margin-left: 20px;">
                        <label id="iptvMultiVPriCon"  class="label-title-second" style="text-align:left; line-height:14px; width:150px;">IPTV Multicast Vlan Priority:</label>
                        <div style="margin-left: 0px;" class="inline">
                            <select id="iptvMultiVPri"  class="xs"  disabled="disabled">
                                <option value='0'>0</option>
                                <option value='1'>1</option>
                                <option value='2'>2</option>
                                <option value='3'>3</option>
                                <option value='4'>4</option>
                                <option value='5'>5</option>
                                <option value='6'>6</option>
                                <option value='7'>7</option>
                            </select>
                        </div>
                    </div>
                    <div class="inline" style="margin-left: 20px;">
                        <input type="checkbox" id="iptvMultiVIDEn" onclick="onIptvMultiVIDEnClick();"/>
                        <label class="T_enable">Enable</label>
                    </div>
                </div>               
                <div id="lanOptions">
                    <div class = "part-separate">
                        <b id="portSelectLAN1Con">LAN1:</b>
                        <select id="portSelectLAN1" class="l">
                        </select>
                    </div>
                    <div>
                        <b id="portSelectLAN2Con">LAN2:</b>
                        <select id="portSelectLAN2" class="l">
                        </select>
                    </div>
                    <div>
                        <b id="portSelectLAN3Con">LAN3:</b>
                        <select id="portSelectLAN3" class="l">
                        </select>
                    </div>
                    <div>
                        <b id="portSelectLAN4Con">LAN4:</b>
                        <select id="portSelectLAN4" class="l">
                        </select>
                    </div>
                </div>
                <div id="aggNote" class="part-separate nd">
                    <span class="T_note2" style="color: #0094bc">Note:</span>
                    <span class="T_aggNote">
                    Link aggregation and IPTV should not be enabled at the same time.
                    </span>
                </div> 
             </form>       
        </div>	
    </form>

    <p class="note">
        <span class="note_title" id="t_note_title">Note:</span>
        <span id="t_typeNote">If you are not sure which Internet Connection Type you have, use Auto Detect or contact your Internet Service Provider (ISP) for assistance.</span>
    </p>
</div>

<div class="inline-btn-right quicksetup-button-container">
    <div class="inline">
        <button type="submit" class="green T_back" id="back" onclick="goPrev()">Back</button>
    </div>
    <div class="inline">
        <button type="submit" class="green T_next" id="next" onclick="goNext()">Next</button>
    </div>
</div>

<script type="text/javascript" language="javascript">

function initType() 
{
    var wanTypes = $.act(ACT_GL, WAN_COMMON_INTF_CFG, null, null, ["WANAccessType"]);
    var wanIPList = $.act(ACT_GL, WAN_IP_CONN, null, null, ["enable", "addressingType", "X_TP_IPv4Enabled"]);
    var wanPPPList = $.act(ACT_GL, WAN_PPP_CONN, null, null, ["enable", "transportType", "X_TP_IPv4Enabled"]);
    var conStk;
    if (INCLUDE_L2TP)
        var wanL2tpList = $.act(ACT_GL, WAN_L2TP_CONN, null, null, ["enable", "addressingType", "transportType"]);
 
    if (INCLUDE_PPTP) 
        var wanPptpList = $.act(ACT_GL, WAN_PPTP_CONN, null, null, ["enable", "addressingType", "transportType"]);
 
    if (!$.exe()) 
   {
        $.each(wanTypes, function() 
    {
            if (this.WANAccessType == "Ethernet")
                conStk = this.__stack;
        });
       // var ethWan = $.act(ACT_GET, WAN_ETH_INTF, conStk, null, ["enable", "X_TP_lastUsedIntf"]);
        $.each(wanIPList, function() 
    {
            var tmpStk = $.stkPop(this.__stack, 2);
            if (conStk == tmpStk && this.X_TP_IPv4Enabled == 1) 
        {
                 if (this.addressingType == "Static" && this.enable == 1)
            {
                      initConType = "StaticIp";
               // alert("initConType = StaticIp");
                return;
                  }
                  if (this.addressingType == "DHCP" && this.enable == 1) 
            {
                initConType = "DynamicIp";
                //  alert("initConType = DynamicIp");
                 return;
                   }
            }
         });
        $.each(wanPPPList, function() {
            var tmpStk = $.stkPop(this.__stack, 2);
            if (conStk == tmpStk && this.X_TP_IPv4Enabled == 1) {
                if (this.transportType == "PPPoE" && this.enable == 1) 
          {
                    initConType = "PPPoE";
            // alert("initConType = PPPoE");
             return;
                }
            }
        });
        if (INCLUDE_L2TP) {
            $.each(wanL2tpList, function() {
                var tmpStk = $.stkPop(this.__stack, 1);
                if (conStk == tmpStk) {
            if (this.enable == 1)
            {
                        initConType = "L2tp";
                // alert("initConType = L2tp");
                 return;
            }
                }
            });
        }
        if (INCLUDE_PPTP) {
            $.each(wanPptpList, function() {
                var tmpStk = $.stkPop(this.__stack, 1);
                if (conStk== tmpStk) {
                   if (this.enable == 1)
                    {
                      initConType = "Pptp";
            // alert("initConType = Pptp");
               return;
                    }
                }
            });
        }
        if ($.exe())
        {
         initConType = "DynamicIp";
        //  alert("initConType = DynamicIp");
        return;
      }
    }
}

function goPrev() {
    $.qf.prev();
}
function goNext() {
    /* set $.qd.eth.connectionType */
    var value = $("input[type=radio][name=wanType]:checked").val();
    if (typeof(value) == "undefined") {
        return 
    }
    $.qd.eth.connectionType = value;
    doCollectIsp();
    if(!doCheck()) return;
    $.qf.next();
}

function IptvModeClick(obj) {
    if ($(obj).hasClass("cln")) {
        $("#iptv_mode_adv").addClass("nd");
        $(obj).removeClass("cln");
    } else {
        $("#iptv_mode_adv").removeClass("nd");
        $(obj).addClass("cln");
    }
}

function IptvModeInit(){
    if(INCLUDE_JP_SPEC) {
        $("#iptv_module_hide").addClass("nd");
        return;
    }
    if (doGet()) return;
    doFill();
}

function doGet() {
    console.log($.iptvIsp);
    if($.iptvIsp.enable === undefined) {
		//console.log("csk	");
	    $.iptvobj = $.act(ACT_GET, ETH_IPTV_CFG);
	    var ret = $.exe();
	    if (!ret) {
	        $.iptvIsp.enable = $.iptvobj.enable;
	        $.iptvIsp.mode = $.iptvobj.mode;
	        $.iptvIsp.IGMPVer = $.iptvobj.IGMPVer;
	        $.iptvIsp.internetVID = $.iptvobj.internetVID;
	        $.iptvIsp.internetVlanPrio = $.iptvobj.internetVlanPrio;
	        $.iptvIsp.QTagEnable = $.iptvobj.QTagEnable;
	        $.iptvIsp.IPPhoneVID = $.iptvobj.IPPhoneVID;
	        $.iptvIsp.IPPhoneVlanPrio = $.iptvobj.IPPhoneVlanPrio;
	        $.iptvIsp.IPTVVID = $.iptvobj.IPTVVID;
	        $.iptvIsp.IPTVVlanPrio = $.iptvobj.IPTVVlanPrio;
	        $.iptvIsp.IPTVMultiEnable = $.iptvobj.IPTVMultiEnable;
	        $.iptvIsp.IPTVMultiVID = $.iptvobj.IPTVMultiVID;
	        $.iptvIsp.IPTVMultiPrio = $.iptvobj.IPTVMultiPrio;
	        $.iptvIsp.LAN1CONF = $.iptvobj.LAN1CONF;
	        $.iptvIsp.LAN2CONF = $.iptvobj.LAN2CONF;
	        $.iptvIsp.LAN3CONF = $.iptvobj.LAN3CONF;
	        $.iptvIsp.LAN4CONF = $.iptvobj.LAN4CONF;
	        if (INCLUDE_LINK_AGGREGATION)
	        {
	            $.iptvIsp.aggEnable = $.iptvobj.aggEnable;
	        }
	    }
	}
    return ret;
}

function doFill() {
    if (INCLUDE_LINK_AGGREGATION)
    {
        /* iptv and link agg should not be enabled at the same time */
        if ($.iptvIsp.aggEnable == true)
        {               
            handleNoneMode(); 
            $("#iptvMode").prop("disabled", true);
            $('#iptvMode').tpSelect({refresh:1});          
            $("#aggNote").removeClass("nd");           
            return;
        }
    }
    
    if ($.iptvIsp.enable == false) {
        //init mode to None
        $("#iptvMode option[value = None]").prop('selected', 'selected');
        $('#iptvMode').tpSelect({refresh:1});
        handleNoneMode();
        console.log("$.iptvIsp.enable == false");
        return;
    }
   
    $("#iptvMode option[value='"+ $.iptvIsp.mode +"']").prop('selected', 'selected');
    $('#iptvMode').tpSelect({refresh:1});
   
    //if ($.iptvIsp.mode == "Bridge" || $.iptvIsp.mode == "Custom")
    {
        $("#portSelectLAN1 option[value="+ $.iptvIsp.LAN1CONF +"]").prop('selected', 'selected');
        $("#portSelectLAN2 option[value="+ $.iptvIsp.LAN2CONF +"]").prop('selected', 'selected');
        $("#portSelectLAN3 option[value="+ $.iptvIsp.LAN3CONF +"]").prop('selected', 'selected');
        $("#portSelectLAN4 option[value="+ $.iptvIsp.LAN4CONF +"]").prop('selected', 'selected');
        LANOptionRefresh();
    }
    if ($.iptvIsp.mode == "Russia" || $.iptvIsp.mode == "Custom")
    {
        if ($.iptvIsp.IPTVMultiEnable == true) {
            $("#iptvMultiVIDEn").prop("checked", true);
        } else if ($.iptvIsp.IPTVMultiEnable == false) {
            $("#iptvMultiVIDEn").prop("checked", false);
        }
        $("#iptvMultiVIDEn").data("tpCheckbox").refresh();
        
        $('#iptvMultiVID').prop("value", $.iptvIsp.IPTVMultiVID);
        $('#iptvMultiVPri').prop("value", $.iptvIsp.IPTVMultiPrio);
        onIptvMultiVIDEnClick();
    }
    if ($.iptvIsp.mode == "Maxis" || $.iptvIsp.mode == "Custom")
    {
        $("#internetVPri option[value='"+$.iptvIsp.internetVlanPrio+"']").prop('selected', 'selected');
        $("#ipphoneVPri option[value='"+$.iptvIsp.IPPhoneVlanPrio+"']").prop('selected', 'selected');
        $("#iptvVPri option[value='"+$.iptvIsp.IPTVVlanPrio+"']").prop('selected', 'selected');

        $('#internetVPri').tpSelect({refresh:1});
        $('#ipphoneVPri').tpSelect({refresh:1});
        $('#iptvVPri').tpSelect({refresh:1});
    }

    if ($.iptvIsp.mode == "Custom")
    {
        $('#internetVID').prop("value", $.iptvIsp.internetVID);
        if ($.iptvIsp.QTagEnable == true) {
            $("#iptvQtagEn").prop("checked", true);
        } else if ($.iptvIsp.QTagEnable == false) {
            $("#iptvQtagEn").prop("checked", false);
        }
        $("#iptvQtagEn").data("tpCheckbox").refresh();
        $('#ipphoneVID').prop("value", $.iptvIsp.IPPhoneVID);
        $('#iptvVID').prop("value", $.iptvIsp.IPTVVID);
    }
}

function doCheck() {
    if (INCLUDE_LINK_AGGREGATION)
    {
        /* luodan add for link aggregation */
        if (($.iptvobj.LAN1CONF == 3 && ($.iptvIsp.LAN1CONF == 1 || $.iptvIsp.LAN1CONF == 2)) ||
            ($.iptvobj.LAN2CONF == 3 && ($.iptvIsp.LAN2CONF == 1 || $.iptvIsp.LAN2CONF == 2)) ||
            ($.iptvobj.LAN3CONF == 3 && ($.iptvIsp.LAN3CONF == 1 || $.iptvIsp.LAN3CONF == 2)) ||
            ($.iptvobj.LAN4CONF == 3 && ($.iptvIsp.LAN4CONF == 1 || $.iptvIsp.LAN4CONF == 2))){
            $.alert(CMM_IPTV_AGG_PORT_CONFLICT);
            return false;
        }
    }
    
    if ($.iptvIsp.mode == "Russia")
    {
        if ($.iptvIsp.IPTVMultiEnable == true)
        {
            if ($.num($.iptvIsp.IPTVMultiVID, [1, 4094], true)) {
                $.alert(CMM_IPTV_INVALIED_VLAN_ID);
                return false;
            }
            if (($.iptvIsp.IPTVMultiVID == 1257) || ($.iptvIsp.IPTVMultiVID == 263) || ($.iptvIsp.IPTVMultiVID == 4000))
            {
                $.alert(CMM_IPTV_VLAN_ID_SAME);
                return false;
            }
        }
        return true;
    }
    else if ($.iptvIsp.mode != "Custom")
    {
        return true;
    }
    
    if ($.num($.iptvIsp.internetVID, [1, 4094], true)) {
        $.alert(CMM_IPTV_INVALIED_VLAN_ID);
        return false;
    }
    if ($.num($.iptvIsp.IPPhoneVID, [1, 4094], true)) {
        $.alert(CMM_IPTV_INVALIED_VLAN_ID);
        return false;
    }
    if ($.num($.iptvIsp.IPTVVID, [1, 4094], true)) {
        $.alert(CMM_IPTV_INVALIED_VLAN_ID);
        return false;
    }
    if ($.iptvIsp.IPTVMultiEnable == true) {
        if ($.num($.iptvIsp.IPTVMultiVID, [1, 4094], true)) {
            $.alert(CMM_IPTV_INVALIED_VLAN_ID);
            return false;
        }
        if (($.iptvIsp.IPTVMultiVID == $.iptvIsp.IPPhoneVID) || ($.iptvIsp.IPTVVID == $.iptvIsp.IPTVMultiVID) || ($.iptvIsp.internetVID == $.iptvIsp.IPTVMultiVID))
        {
            $.alert(CMM_IPTV_VLAN_ID_SAME);
            return false;
        }
    }

    if (($.iptvIsp.internetVID == $.iptvIsp.IPPhoneVID) || ($.iptvIsp.IPTVVID == $.iptvIsp.IPPhoneVID) || ($.iptvIsp.internetVID == $.iptvIsp.IPTVVID))
    {
        $.alert(CMM_IPTV_VLAN_ID_SAME);
        return false;
    }
    
    return true;
}

function LANOptionEmpty()
{
    $("#portSelectLAN1").empty();
    $("#portSelectLAN2").empty();
    $("#portSelectLAN3").empty();
    $("#portSelectLAN4").empty();
}

function LANOptionProp(option, val)
{
    $("#portSelectLAN1").prop(option, val);
    $("#portSelectLAN2").prop(option, val);
    $("#portSelectLAN3").prop(option, val);
    $("#portSelectLAN4").prop(option, val);
}

function LANOptionRefresh()
{
    $('#portSelectLAN1').tpSelect({refresh:1});
    $('#portSelectLAN2').tpSelect({refresh:1});
    $('#portSelectLAN3').tpSelect({refresh:1});
    $('#portSelectLAN4').tpSelect({refresh:1});
}

function appendLANOption(option)
{
    var val;
    var textStr = option;
    if (option=="Internet")
    {
        val = 0;
        textStr=internetStr;
    }
    else if (option=="IPTV")
    {
        val = 1;
    }
    else if (option=="IP-Phone")
    {
        val = 2;
        textStr=ipphoneStr;
    }
    $("#portSelectLAN1").append("<option value="+val+">"+textStr+"</option>");
    $("#portSelectLAN2").append("<option value="+val+">"+textStr+"</option>");
    $("#portSelectLAN3").append("<option value="+val+">"+textStr+"</option>");
    $("#portSelectLAN4").append("<option value="+val+">"+textStr+"</option>");
}

function handleNoneMode()
{
    $("#internetVIDSetup").addClass("nd");
    $("#IPPhoneVIDSetup").addClass("nd");
    $("#IPTVVIDSetup").addClass("nd");
    $("#IPTVMultiVIDSetup").addClass("nd");
    $("#lanOptions").addClass("nd");
}

function handleBridgeMode()
{
    $("#internetVIDSetup").addClass("nd");
    $("#IPPhoneVIDSetup").addClass("nd");
    $("#IPTVVIDSetup").addClass("nd");
    $("#IPTVMultiVIDSetup").addClass("nd");
    $("#lanOptions").removeClass("nd");
    
    LANOptionEmpty();
    appendLANOption("Internet");
    appendLANOption("IPTV");

    LANOptionProp("disabled", false);
}

function handleSingaMode()
{
    $("#internetVIDSetup").removeClass("nd");
    $("#IPPhoneVIDSetup").addClass("nd");
    $("#IPTVVIDSetup").removeClass("nd");
    $("#IPTVMultiVIDSetup").addClass("nd");
    $("#lanOptions").removeClass("nd");

    LANOptionEmpty();
    $("#portSelectLAN1").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN2").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN3").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN4").append("<option value=1>IPTV</option>");

    LANOptionProp("disabled", true);

    $('#internetVID').prop("value", 10);
    $("#internetVPri option[value='0']").prop('selected', 'selected');
    $("#iptvQtagEn").prop("checked", true);
    $('#iptvVID').prop("value", 20);
    $("#iptvVPri option[value='4']").prop('selected', 'selected');

    $('#internetVID').prop("disabled", true);
    $('#internetVPri').prop("disabled", true);
    $('#iptvVID').prop("disabled", true);
    $('#iptvVPri').prop("disabled", true);

    $('#iptvQtagEn').prop("disabled", true);

    $("#iptvQtagEn").data("tpCheckbox").refresh();
    $('#internetVPri').tpSelect({refresh:1});
    $('#iptvVPri').tpSelect({refresh:1});


}

function handleMalayUMode()
{
    $("#internetVIDSetup").removeClass("nd");
    $("#IPPhoneVIDSetup").addClass("nd");
    $("#IPTVVIDSetup").removeClass("nd");
    $("#IPTVMultiVIDSetup").addClass("nd");
    $("#lanOptions").removeClass("nd");
    
    LANOptionEmpty();
    $("#portSelectLAN1").append("<option value=1>IPTV</option>");
    $("#portSelectLAN2").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN3").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN4").append("<option value=0>"+internetStr+"</option>");

    LANOptionProp("disabled", true);
    
    $('#internetVID').prop("value", 500);
    $("#internetVPri option[value='0']").prop('selected', 'selected');
    $("#iptvQtagEn").prop("checked", true);
    $('#iptvVID').prop("value", 600);
    $("#iptvVPri option[value='0']").prop('selected', 'selected');

    $('#internetVID').prop("disabled", true);
    $('#internetVPri').prop("disabled", true);
    $('#iptvVID').prop("disabled", true);
    $('#iptvVPri').prop("disabled", true);

    $('#iptvQtagEn').prop("disabled", true);

    $("#iptvQtagEn").data("tpCheckbox").refresh();
    $('#internetVPri').tpSelect({refresh:1});
    $('#iptvVPri').tpSelect({refresh:1});


}

function handleMalayMMode()
{
    $("#internetVIDSetup").removeClass("nd");
    $("#IPPhoneVIDSetup").removeClass("nd");
    $("#IPTVVIDSetup").removeClass("nd");
    $("#IPTVMultiVIDSetup").addClass("nd");
    $("#lanOptions").removeClass("nd");

    LANOptionEmpty();
    $("#portSelectLAN1").append("<option value=1>IPTV</option>");
    $("#portSelectLAN2").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN3").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN4").append("<option value=2>"+ipphoneStr+"</option>");

    LANOptionProp("disabled", true);

    $('#internetVID').prop("value", 621);
    $("#internetVPri option[value='0']").prop('selected', 'selected');
    $("#iptvQtagEn").prop("checked", true);
    $('#ipphoneVID').prop("value", 822);
    $("#ipphoneVPri option[value='0']").prop('selected', 'selected');
    $('#iptvVID').prop("value", 823);
    $("#iptvVPri option[value='0']").prop('selected', 'selected');

    $('#internetVID').prop("disabled", true);
    $('#internetVPri').prop("disabled", false);
    $('#iptvQtagEn').prop("disabled", true);
    $('#ipphoneVID').prop("disabled", true);
    $('#ipphoneVPri').prop("disabled", false);
    $('#iptvVID').prop("disabled", true);
    $('#iptvVPri').prop("disabled", false);

    $("#iptvQtagEn").data("tpCheckbox").refresh();
    $('#internetVPri').tpSelect({refresh:1});
    $('#ipphoneVPri').tpSelect({refresh:1});
    $('#iptvVPri').tpSelect({refresh:1});

}

function handleNewZealandMode()
{
    $("#internetVIDSetup").removeClass("nd");
    $("#IPPhoneVIDSetup").addClass("nd");
    $("#IPTVVIDSetup").addClass("nd");
    $("#IPTVMultiVIDSetup").addClass("nd");
    $("#lanOptions").removeClass("nd");

    LANOptionEmpty();
    $("#portSelectLAN1").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN2").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN3").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN4").append("<option value=0>"+internetStr+"</option>");
    LANOptionProp("disabled", true);

    $('#internetVID').prop("value", 10);
    $("#internetVPri option[value='0']").prop('selected', 'selected');
    $("#iptvQtagEn").prop("checked", true);

    $('#internetVID').prop("disabled", true);
    $('#internetVPri').prop("disabled", true);
    $('#iptvQtagEn').prop("disabled", true);

    $("#iptvQtagEn").data("tpCheckbox").refresh();
    $('#internetVPri').tpSelect({refresh:1});
}

function handleAustraliaMode()
{
    $("#internetVIDSetup").removeClass("nd");
    $("#IPPhoneVIDSetup").addClass("nd");
    $("#IPTVVIDSetup").addClass("nd");
    $("#IPTVMultiVIDSetup").addClass("nd");
    $("#lanOptions").removeClass("nd");

    LANOptionEmpty();
    $("#portSelectLAN1").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN2").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN3").append("<option value=0>"+internetStr+"</option>");
    $("#portSelectLAN4").append("<option value=0>"+internetStr+"</option>");

    LANOptionProp("disabled", true);

    $('#internetVID').prop("value", 100);
    $("#internetVPri option[value='0']").prop('selected', 'selected');
    $("#iptvQtagEn").prop("checked", true);

    $('#internetVID').prop("disabled", true);
    $('#internetVPri').prop("disabled", true);
    $('#iptvQtagEn').prop("disabled", true);

    $("#iptvQtagEn").data("tpCheckbox").refresh();
    $('#internetVPri').tpSelect({refresh:1});
}

function handleCustomMode()
{
    $("#internetVIDSetup").removeClass("nd");
    $("#IPPhoneVIDSetup").removeClass("nd");
    $("#IPTVVIDSetup").removeClass("nd");
    $("#IPTVMultiVIDSetup").removeClass("nd");
    $("#lanOptions").removeClass("nd");

    LANOptionEmpty();
    appendLANOption("Internet");
    appendLANOption("IPTV");
    appendLANOption("IP-Phone");

    LANOptionProp("disabled", false);
    
    $('#internetVID').prop("value", 0);
    $("#internetVPri option[value='0']").prop('selected', 'selected');
    $("#iptvQtagEn").prop("checked", true);
    $('#ipphoneVID').prop("value", 0);
    $("#ipphoneVPri option[value='0']").prop('selected', 'selected');
    $('#iptvVID').prop("value", 0);
    $("#iptvVPri option[value='0']").prop('selected', 'selected');
    $('#iptvMultiVID').prop("value", 0);
    $("#iptvMultiVPri option[value='0']").prop('selected', 'selected');

    $('#internetVID').prop("disabled", false);
    $('#internetVPri').prop("disabled", false);
    $('#iptvQtagEn').prop("disabled", false);
    $('#ipphoneVID').prop("disabled", false);
    $('#ipphoneVPri').prop("disabled", false);
    $('#iptvVID').prop("disabled", false);
    $('#iptvVPri').prop("disabled", false);

    $("#iptvQtagEn").data("tpCheckbox").refresh();
    $('#internetVPri').tpSelect({refresh:1});
    $('#ipphoneVPri').tpSelect({refresh:1});
    $('#iptvVPri').tpSelect({refresh:1});
    $('#iptvMultiVPri').tpSelect({refresh:1});
}

function onIptvMultiVIDEnClick()
{
    if ($("#iptvMultiVIDEn").prop("data-checked"))
    {
        $('#iptvMultiVID').prop("disabled", false);
        $('#iptvMultiVPri').prop("disabled", false);
    }
    else
    {
        $('#iptvMultiVID').prop("disabled", true);
        $('#iptvMultiVPri').prop("disabled", true);
    }

    $('#iptvMultiVPri').tpSelect({refresh:1});
    
}

function doCollectIsp() {
    //console.log($.iptvIsp);
    //$.iptvIsp = {};//clear the data before saving again
    //console.log($.iptvIsp);
    if (!INCLUDE_LINK_AGGREGATION || (INCLUDE_LINK_AGGREGATION && ($.iptvobj.aggEnable == false)))//else do nothing
    {
        if($('#iptvMode').data("value") == "None")
        {
            $.iptvIsp.enable = 0;
        }
        else
        {  
            $.iptvIsp.enable = 1;
            $.iptvIsp.mode = $('#iptvMode').data("value");

            if ($.iptvIsp.mode == "Bridge" || $.iptvIsp.mode == "Custom")
            {
                $.iptvIsp.LAN1CONF = $('#portSelectLAN1').data("value");
                $.iptvIsp.LAN2CONF = $('#portSelectLAN2').data("value");
                $.iptvIsp.LAN3CONF = $('#portSelectLAN3').data("value");
                $.iptvIsp.LAN4CONF = $('#portSelectLAN4').data("value");
            }
            if ($.iptvIsp.mode == "Custom")
            {
                $.iptvIsp.IPTVMultiEnable = $("#iptvMultiVIDEn").prop("data-checked") ? 1 : 0;
                $.iptvIsp.IPTVMultiVID = $('#iptvMultiVID').val();
                $.iptvIsp.IPTVMultiPrio = $('#iptvMultiVPri').data("value");
            }
            if ($.iptvIsp.mode == "Maxis" || $.iptvIsp.mode == "Custom")
            {
                $.iptvIsp.internetVlanPrio = $('#internetVPri').data("value");
                $.iptvIsp.IPPhoneVlanPrio = $('#ipphoneVPri').data("value");
                $.iptvIsp.IPTVVlanPrio = $('#iptvVPri').data("value");
            }
            if ($.iptvIsp.mode == "Custom")
            {
                $.iptvIsp.internetVID = $('#internetVID').val();
                $.iptvIsp.QTagEnable = $("#iptvQtagEn").prop("data-checked") ? 1 : 0;
                $.iptvIsp.IPPhoneVID = $('#ipphoneVID').val();
                $.iptvIsp.IPTVVID = $('#iptvVID').val();
            }
        }
    }
    //console.log($.iptvIsp);
}

function wanDetecting() {
   // var wanTypeObj = $.act(ACT_GET, WAN_TYPE_DETECT, null, null, ["state", "wanType"]);
   var wanTypeObj = $.act(ACT_GET,WAN_DETECT,null,null,["searchState", "detectedConnType"]);
   detectTime++;
   //console.log("maxTime:"+maxDetectTime+"  detectTime: "+detectTime);
    if (!$.exe()) {
      if(wanTypeObj.searchState == 2) /* STATE_SEARCH_OK = 2, in wanDetect.h */
      	{
      		var qtype;
            switch(wanTypeObj.detectedConnType)
	     	{
                case "0":
                    $("#status").html(s_str.pppoe);
					qtype="PPPoE";
                    break;
                case "1":
                    $("#status").html(s_str.dynip);
					qtype="DynamicIp";
                    break;
                case "2":
                    $("#status").html(s_str.staip);
                    qtype="StaticIp";
                    break;
                default: /* detect failed */
					$("#status").html(s_str.staip);
                    qtype="StaticIp";
                    break;
            }
			
        	if (qtype != undefined)
        	{
        		$("input[type=radio][name=wanType][value=" + qtype + "]").prop("checked", true);

				$("#qsDynIp").tpRadio({
				       refresh: 1
				});
				$("#qsPppoe").tpRadio({
				      refresh: 1
				});
				$("#qsStaIp").tpRadio({
				       refresh: 1
				});
				$("#qsL2tp").tpRadio({
				      refresh: 1
				});
				$("#qsPptp").tpRadio({
				       refresh: 1
				});

			}
			$("#detect").prop("disabled", false);
			detecting = false;
	    //$("#back").prop("disabled", false);
	       $("#next").prop("disabled", false);
        }
	  else //if(detectTime <= maxDetectTime)
            $.timeout(function() {wanDetecting();}, 1500);
	  /*
	 else
	 {
	 	 $("#status").html("Unknown");
		 $("#detect").prop("disabled", false);
		  detecting = false;
	       $("#next").prop("disabled", false);
	 }
	 */
    }
}

function doWanDetect()
{
	//internetDiagInit();
    var pStk;
    var wanTypes = $.act(ACT_GL, WAN_COMMON_INTF_CFG, null, null, ["WANAccessType"]);   
	detectTime = 0;
    if (!$.exe())
    {
        $.each(wanTypes, function()
        {
       	//alert(this.WANAccessType);
		//alert(this.__stack);
		if (this.WANAccessType == "Ethernet")
                pStk = this.__stack;
        });
    }
	
	var wanEthIntfObj = $.act(ACT_GET,WAN_ETH_INTF,pStk,null,["status"]);	

	if(!$.exe())
	{
		if(wanEthIntfObj.status == "NoLink")
		{	
			//$("#autoDetectStatus").text("Unplugged");
			 $("#status").html(m_str.unplugged);
			 $("#detect").prop("disabled", false);
			 detecting = false;
			// $("#back").prop("disabled", false);
	    		 $("#next").prop("disabled", false);
			 return;
		}
		else
		{
			$.act(ACT_OP, ACT_OP_DO_WAN_DETECT, null);
	
			if(!$.exe())
			{
				//$("#autoDetectStatus").text("Detecting...");
				 $("#status").html(m_str.detecting);
				 $("#detect").prop("disabled", true);
				 detecting = true;
				// $("#back").prop("disabled", true);
	    			  $("#next").prop("disabled", true);
				$.timeout(function(){wanDetecting(); }, 1500);
			}
		}
	}	
}

var initConType = "DynamicIp";
var detecting = false;
var detectTime = 0;

var internetStr = $.tpLang? ($.tpLang.s_str.internet? $.tpLang.s_str.internet:"Internet"): "Internet";
var ipphoneStr = $.tpLang? ($.tpLang.s_str.ipphone? $.tpLang.s_str.ipphone:"IP-Phone"): "IP-Phone";

//$.iptvIsp & $.iptvobj should be cleared after they've been transfered to the back end
if($.iptvIsp === undefined) $.iptvIsp = {};
if($.iptvobj === undefined) $.iptvobj = {};

if (typeof($.qd.eth) == "undefined") {
    $.qd.eth = {};
    initType();
    $.qd.eth.connectionType = initConType;
}

$("input[type=radio][name=wanType][value=" + $.qd.eth.connectionType + "]").prop("checked", true);

$("#iptvMode").click(function() {

    if($("#iptvMode").data("value") == "None")
    {
        handleNoneMode();
    }
    else if ($("#iptvMode").data("value") == "Bridge")
    {
        handleBridgeMode();
    }
    else if ($("#iptvMode").data("value") == "ExStream")
    {
        handleSingaMode();
    }
    else if ($("#iptvMode").data("value") == "Unifi")
    {
        handleMalayUMode();
    }
    else if ($("#iptvMode").data("value") == "Maxis")
    {
        handleMalayMMode();
    }
    else if ($("#iptvMode").data("value") == "Ufb")
    {
        handleNewZealandMode();
    }
    else if ($("#iptvMode").data("value") == "Nbn")
    {
        handleAustraliaMode();
    }
    else if ($("#iptvMode").data("value") == "Custom")
    {
        handleCustomMode();
    }
    
    LANOptionRefresh();
});

$.tpInit(IptvModeInit);

</script>
