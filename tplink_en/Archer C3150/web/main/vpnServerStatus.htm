<script language="javascript" type="text/javascript">
var ovpnClientsGetAct       = 1;
var ovpnClientConnAct       = 1;
var ovpnClientDisconnAct    = 2;

var pvpnClientsGetAct       = 1;
var pvpnClientConnAct       = 1;
var pvpnClientDisconnAct    = 2;

function doDisConn(type, index) {
    if (type == "openvpn") {
        $.addLoading($("#disconn_openvpn_" + index));
        var ovpnClient = $.act(ACT_SET, OVPN_CLIENTS, ovpnClientsList[index-1].__stack, null, ["connAct=" + ovpnClientDisconnAct]);
        $.exe(function(ret) {
            $.removeLoading();
            if (!ret) {
                $.reload();
            }
        });
    }

    if (type == "pptpvpn") {
        $.addLoading($("#disconn_pptpvpn_" + index));
        var pvpnClient = $.act(ACT_SET, PVPN_CLIENTS, pvpnClientsList[index-1].__stack, null, ["connAct=" + pvpnClientDisconnAct]);
        $.exe(function(ret) {
            $.removeLoading();
            if (!ret) {
                $.reload();
            }
        });
    }
}

function initOvpnClientTable() {
    $.act(ACT_SET, OPENVPN, null, null, ["actGetClients=" + ovpnClientsGetAct]);
    if ($.exe()) {
        return;
    }

    var array = new Array();
    ovpnClientsList = $.act(ACT_GL, OVPN_CLIENTS, null, null);
    $.exe(function(err) {
        if (err) return;
        var index = 0;

        $.each(ovpnClientsList, function() {

            array.push([{
                "text": ++index,
                "width": "10%"
            }, {
                "text": this.wanIp,
                "width": "30%"
            }, {
                "text": this.tunIp,
                "width": "30%"
            }, {
                // the icon exits, just add it in tpTable.css
                "text": "<span class='table-grid-icon disconnect02-icon' id='disconn_openvpn_" + index + "' onclick='doDisConn(\"openvpn\", " + index + ");'></span>",
                "width": ""
            }]);
        });

        $.initTableBody($("#tableOvpnClientList"), array);
        $.tablePages($("#tableOvpnClientList"), 5);
        return array;
    });

}

function OpenVpnInit() {
    var ovpnClientListHeadArray = [{
        "text": table_str.id,
        "width": "10%"
    }, {
        "text": table_str.remoteIp,
        "width": "30%"
    }, {
        "text": table_str.assignedIp,
        "width": "30%"
    }, {
        "text": table_str.modify,
        "width": ""
    }];
    $.initTableHead($("#tableOvpnClientList"), ovpnClientListHeadArray);

    $("#tableOvpnClientList").tpTable(initOvpnClientTable);
}



function initPvpnClientTable() {
    $.act(ACT_SET, PPTPVPN, null, null, ["actGetClients=" + pvpnClientsGetAct]);
    if ($.exe()) {
        return;
    }

    var array = new Array();
    pvpnClientsList = $.act(ACT_GL, PVPN_CLIENTS, null, null);
    $.exe(function(err) {
        if (err) return;
        var index = 0;

        $.each(pvpnClientsList, function() {

            array.push([{
                "text": ++index,
                "width": "10%"
            }, {
                "text": this.wanIp,
                "width": "30%"
               }, {
                "text": this.ptpIp,
                "width": "30%"
            }, {
                // the icon exits, just add it in tpTable.css
                "text": "<span class='table-grid-icon disconnect02-icon' id='disconn_pptpvpn_" + index + "' onclick='doDisConn(\"pptpvpn\", " + index + ");'></span>",
                "width": ""
            }]);
        });

        $.initTableBody($("#tablePvpnClientList"), array);
        $.tablePages($("#tablePvpnClientList"), 5);
        return array;
    });

}

function PptpVpnInit() {
    var pvpnClientListHeadArray = [{
        "text": table_str.id,
        "width": "10%"
    }, {
        "text": table_str.remoteIp,
        "width": "30%"
    }, {
        "text": table_str.assignedIp,
        "width": "30%"
    }, {
        "text": table_str.modify,
        "width": ""
    }];
    $.initTableHead($("#tablePvpnClientList"), pvpnClientListHeadArray);

    $("#tablePvpnClientList").tpTable(initPvpnClientTable);
}

function init() {
    if (INCLUDE_OPENVPN_SERVER) {
        OpenVpnInit();
    } else {
        $('#openvpn_div').addClass('nd');
    }

    if (INCLUDE_PPTPVPN_SERVER) {
        PptpVpnInit();
    } else {
        $('#pptpvpn_div').addClass('nd');        
    }
}

</script>
<h3 id="t_vpnConn">VPN Connections</h3>
<div class="content-container" id="openvpn_div">
    <h5 id="t_ovpnConn">OpenVPN Connection</h5>
    <form class="pure-form pure-form-aligned">
        <table id="tableOvpnClientList">
            <thead></thead>
            <tbody id="tableOvpnClientListBody">
            </tbody>
        </table>
    </form>
</div>

<div class="content-container" id="pptpvpn_div">
    <h5 id="t_pvpnConn">PPTP VPN Connection</h5>
    <form class="pure-form pure-form-aligned">
        <table id="tablePvpnClientList">
            <thead></thead>
            <tbody id="tablePvpnClientListBody">
            </tbody>
        </table>
    </form>
</div>

<script language="javascript" type="text/javascript">
$.tpInit(init);
</script>
