!function(s){s.su.moduleManager.define("lanAPAdv",{models:["lanAPModel"],stores:["lanAdvSubnetCombo","ipTypeStore"],services:[],deps:["utils"],views:["lanAPView"],listeners:{"ev_on_launch":function(e,l,a,n,o,t,s){n.lanAPModel.load()}},init:function(e,s,i,l,a,n){this.control({".index-common-save-btn":{"ev_will_auto_save":function(e,l){l.preventDefault();var a=i.lanAPModel.lan_type.getValue(),n=i.lanAPModel.isDirty(),o=i.lanAPModel.ipaddr.isDirty();if("dynamic"!==a){if(i.lanAPModel.validate()&&n&&this.lanValidate())if(o)s.lanAPView.lanApIpChangeMsg.show();else{var t=i.lanAPModel.ipaddr.getValue();this.startReboot(t)}}else this.startReboot("tplinkwifi.net")}},"#lan-ap-ip-change":{"ev_msg_ok":function(){var e=i.lanAPModel.ipaddr.getValue();this.startReboot(e)}}}),this.listen({"models.lanAPModel.mask_type":{"ev_value_change":function(e,l,a){3===l?(i.lanAPModel.custom_value.show(),"static"===i.lanAPModel.lan_type.getValue()?i.lanAPModel.custom_value.enable():i.lanAPModel.custom_value.disable()):(i.lanAPModel.custom_value.hide(),i.lanAPModel.custom_value.disable())}},"models.lanAPModel.lan_type":{"ev_value_change":function(e,l,a){"static"===l?(i.lanAPModel.ipaddr.enable(),i.lanAPModel.mask_type.enable(),3===parseInt(i.lanAPModel.mask_type.getValue())?i.lanAPModel.custom_value.enable():i.lanAPModel.custom_value.disable(),i.lanAPModel.lan_gw.enable(),i.lanAPModel.pri_dns.enable(),i.lanAPModel.snd_dns.enable()):(i.lanAPModel.ipaddr.disable(),i.lanAPModel.mask_type.disable(),i.lanAPModel.custom_value.disable(),i.lanAPModel.lan_gw.disable(),i.lanAPModel.pri_dns.disable(),i.lanAPModel.snd_dns.disable())}}})}},function(l,a,o,e,t,n){return{lanValidate:function(){var e=o.lanAPModel.ipaddr.getValue(),l=parseInt(o.lanAPModel.mask_type.getValue()),a=3===l?o.lanAPModel.custom_value.getValue():["255.255.255.0","255.255.0.0","255.0.0.0"][l],n=o.lanAPModel.lan_gw.getValue();return t.utils.isNetIp(e,a)||t.utils.isBroadCastIp(e,a)?(o.lanAPModel.ipaddr.setError(s.su.CHAR.ERROR["00000059"]),!1):t.utils.isSameNet(n,e,a)?!t.utils.isNetIp(n,a)&&!t.utils.isBroadCastIp(n,a)||(o.lanAPModel.lan_gw.setError(s.su.CHAR.ERROR["00000059"]),!1):(o.lanAPModel.lan_gw.setError(s.su.CHAR.ERROR["00000045"]),!1)},goToNewUrl:function(e){var l=top.location.href,a=l.indexOf("//");top.location.href=l.slice(0,a+2)+e},startReboot:function(e){a.lanAPView.lanApAdvRebootAnimate.show(),o.lanAPModel.submit({success:function(){setTimeout(function(){a.lanAPView.lanApAdvRebootAnimate.close(function(){l.goToNewUrl(e)})},4e4)}})}}})}(jQuery);