!function(s){s.su.moduleManager.define("lanAPAdv",{models:["lanAPModel"],stores:["lanAdvSubnetCombo","ipTypeStore"],services:["device"],deps:["utils"],views:["lanAPView"],listeners:{"ev_on_launch":function(e,l,a,n,o,d,s){n.lanAPModel.load(),1==s.device.getConfig().supportRELanDns?(n.lanAPModel.pri_dns.enable(),n.lanAPModel.snd_dns.enable(),n.lanAPModel.pri_dns.show(),n.lanAPModel.snd_dns.show()):(n.lanAPModel.pri_dns.disable(),n.lanAPModel.snd_dns.disable(),n.lanAPModel.pri_dns.hide(),n.lanAPModel.snd_dns.hide())}},init:function(e,s,t,l,a,n){this.control({".index-common-save-btn":{"ev_will_auto_save":function(e,l){l.preventDefault();var a=t.lanAPModel.lan_type.getValue(),n=t.lanAPModel.isDirty(),o=t.lanAPModel.ipaddr.isDirty();if("dynamic"!==a){if(t.lanAPModel.validate()&&n&&this.lanValidate())if(o)s.lanAPView.lanApIpChangeMsg.show();else{var d=t.lanAPModel.ipaddr.getValue();this.startReboot(d)}}else this.startReboot("tplinkwifi.net")}},"#lan-ap-ip-change":{"ev_msg_ok":function(){var e=t.lanAPModel.ipaddr.getValue();this.startReboot(e)}}}),this.listen({"models.lanAPModel.mask_type":{"ev_value_change":function(e,l,a){3===l?(t.lanAPModel.custom_value.show(),"static"===t.lanAPModel.lan_type.getValue()?t.lanAPModel.custom_value.enable():t.lanAPModel.custom_value.disable()):(t.lanAPModel.custom_value.hide(),t.lanAPModel.custom_value.disable())}},"models.lanAPModel.lan_type":{"ev_value_change":function(e,l,a){"static"===l?(t.lanAPModel.ipaddr.enable(),t.lanAPModel.mask_type.enable(),3===parseInt(t.lanAPModel.mask_type.getValue())?t.lanAPModel.custom_value.enable():t.lanAPModel.custom_value.disable(),t.lanAPModel.lan_gw.enable(),1==n.device.getConfig().supportRELanDns&&(t.lanAPModel.pri_dns.enable(),t.lanAPModel.snd_dns.enable())):(t.lanAPModel.ipaddr.disable(),t.lanAPModel.mask_type.disable(),t.lanAPModel.custom_value.disable(),t.lanAPModel.lan_gw.disable(),t.lanAPModel.pri_dns.disable(),t.lanAPModel.snd_dns.disable())}}})}},function(l,a,o,e,d,n){return{lanValidate:function(){var e=o.lanAPModel.ipaddr.getValue(),l=parseInt(o.lanAPModel.mask_type.getValue()),a=3===l?o.lanAPModel.custom_value.getValue():["255.255.255.0","255.255.0.0","255.0.0.0"][l],n=o.lanAPModel.lan_gw.getValue();return d.utils.isNetIp(e,a)||d.utils.isBroadCastIp(e,a)?(o.lanAPModel.ipaddr.setError(s.su.CHAR.ERROR["00000059"]),!1):d.utils.isSameNet(n,e,a)?!d.utils.isNetIp(n,a)&&!d.utils.isBroadCastIp(n,a)||(o.lanAPModel.lan_gw.setError(s.su.CHAR.ERROR["00000059"]),!1):(o.lanAPModel.lan_gw.setError(s.su.CHAR.ERROR["00000045"]),!1)},goToNewUrl:function(e){var l=top.location.href,a=l.indexOf("//");top.location.href=l.slice(0,a+2)+e},startReboot:function(e){a.lanAPView.lanApAdvRebootAnimate.show(),o.lanAPModel.submit({success:function(){setTimeout(function(){a.lanAPView.lanApAdvRebootAnimate.close(function(){l.goToNewUrl(e)})},4e4)}})}}})}(jQuery);