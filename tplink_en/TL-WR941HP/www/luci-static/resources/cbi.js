var cbi_d=[];var cbi_t=[];var cbi_c=[];var cbi_validators={integer:function(){return(this.match(/^-?[0-9]+$/)!=null)},uinteger:function(){return(cbi_validators.integer.apply(this)&&(this>=0))},"float":function(){return !isNaN(parseFloat(this))},ufloat:function(){return(cbi_validators["float"].apply(this)&&(this>=0))},ipaddr:function(){return cbi_validators.ip4addr.apply(this)||cbi_validators.ip6addr.apply(this)},ip4addr:function(){if(this.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})(\/(\S+))?$/)){return(RegExp.$1>=0)&&(RegExp.$1<=255)&&(RegExp.$2>=0)&&(RegExp.$2<=255)&&(RegExp.$3>=0)&&(RegExp.$3<=255)&&(RegExp.$4>=0)&&(RegExp.$4<=255)&&((RegExp.$6.indexOf(".")<0)?((RegExp.$6>=0)&&(RegExp.$6<=32)):(cbi_validators.ip4addr.apply(RegExp.$6)))}return false},ip6addr:function(){if(this.match(/^([a-fA-F0-9:.]+)(\/(\d+))?$/)){if(!RegExp.$2||((RegExp.$3>=0)&&(RegExp.$3<=128))){var f=RegExp.$1;if(f=="::"){return true}if(f.indexOf(".")>0){var e=f.lastIndexOf(":");if(!(e&&cbi_validators.ip4addr.apply(f.substr(e+1)))){return false}f=f.substr(0,e)+":0:0"}if(f.indexOf("::")>=0){var c=0;var d="0";for(var a=1;a<(f.length-1);a++){if(f.charAt(a)==":"){c++}}if(c>7){return false}for(var a=0;a<(7-c);a++){d+=":0"}if(f.match(/^(.*?)::(.*?)$/)){f=(RegExp.$1?RegExp.$1+":":"")+d+(RegExp.$2?":"+RegExp.$2:"")}}return(f.match(/^(?:[a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}$/)!=null)}}return false},port:function(){return cbi_validators.integer.apply(this)&&(this>=0)&&(this<=65535)},portrange:function(){if(this.match(/^(\d+)-(\d+)$/)){var c=RegExp.$1;var a=RegExp.$2;return cbi_validators.port.apply(c)&&cbi_validators.port.apply(a)&&(parseInt(c)<=parseInt(a))}else{return cbi_validators.port.apply(this)}},macaddr:function(){return(this.match(/^([a-fA-F0-9]{2}:){5}[a-fA-F0-9]{2}$/)!=null)},host:function(){return cbi_validators.hostname.apply(this)||cbi_validators.ipaddr.apply(this)},hostname:function(){if(this.length<=253){return(this.match(/^[a-zA-Z0-9]+$/)!=null||(this.match(/^[a-zA-Z0-9_][a-zA-Z0-9_\-.]*[a-zA-Z0-9]$/)&&this.match(/[^0-9.]/)))}return false},network:function(){return cbi_validators.uciname.apply(this)||cbi_validators.host.apply(this)},wpakey:function(){var a=this;if(a.length==64){return(a.match(/^[a-fA-F0-9]{64}$/)!=null)}else{return(a.length>=8)&&(a.length<=63)}},wepkey:function(){var a=this;if(a.substr(0,2)=="s:"){a=a.substr(2)}if((a.length==10)||(a.length==26)){return(a.match(/^[a-fA-F0-9]{10,26}$/)!=null)}else{return(a.length==5)||(a.length==13)}},uciname:function(){return(this.match(/^[a-zA-Z0-9_]+$/)!=null)},range:function(c,a){var d=parseFloat(this);if(!isNaN(c)&&!isNaN(a)&&!isNaN(d)){return((d>=c)&&(d<=a))}return false},min:function(a){var c=parseFloat(this);if(!isNaN(a)&&!isNaN(c)){return(c>=a)}return false},max:function(a){var c=parseFloat(this);if(!isNaN(a)&&!isNaN(c)){return(c<=a)}return false},rangelength:function(c,a){var d=""+this;if(!isNaN(c)&&!isNaN(a)){return((d.length>=c)&&(d.length<=a))}return false},minlength:function(a){var c=""+this;if(!isNaN(a)){return(c.length>=a)}return false},maxlength:function(a){var c=""+this;if(!isNaN(a)){return(c.length<=a)}return false},or:function(){for(var a=0;a<arguments.length;a+=2){if(typeof arguments[a]!="function"){if(arguments[a]==this){return true}a--}else{if(arguments[a].apply(this,arguments[a+1])){return true}}}return false},and:function(){for(var a=0;a<arguments.length;a+=2){if(typeof arguments[a]!="function"){if(arguments[a]!=this){return false}a--}else{if(!arguments[a].apply(this,arguments[a+1])){return false}}}return true},neg:function(){return cbi_validators.or.apply(this.replace(/^[ \t]*![ \t]*/,""),arguments)},list:function(a,e){if(typeof a!="function"){return false}var d=this.match(/[^ \t]+/g);for(var c=0;c<d.length;c++){if(!a.apply(d[c],e)){return false}}return true},phonedigit:function(){return(this.match(/^[0-9\*#]+$/)!=null)}};function cbi_d_add(g,f,c){var e=document.getElementById(g);if(e){var d;for(var a=0;a<cbi_d.length;a++){if(cbi_d[a].id==g){d=cbi_d[a];break}}if(!d){d={node:e,id:g,parent:e.parentNode.id,next:c,deps:[]};cbi_d.unshift(d)}d.deps.push(f)}}function cbi_d_checkvalue(g,e){var d=document.getElementById(g);var f;if(!d){var a=document.getElementsByName(g);if(a.length>0&&a[0].type=="radio"){for(var c=0;c<a.length;c++){if(a[c].checked){f=a[c].value;break}}}f=f?f:""}else{if(!d.value){f=""}else{f=d.value;if(d.type=="checkbox"){f=d.checked?f:""}}}return(f==e)}function cbi_d_check(g){var c;var e=false;for(var d=0;d<g.length;d++){var f=true;c=false;for(var a in g[d]){if(a=="!reverse"){c=true}else{if(a=="!default"){e=true;f=false}else{f=(f&&cbi_d_checkvalue(a,g[d][a]))}}}if(f){return !c}}return e}function cbi_d_update(){var g=false;for(var a=0;a<cbi_d.length;a++){var f=cbi_d[a];var d=document.getElementById(f.next);var e=document.getElementById(f.id);var c=document.getElementById(f.parent);if(e&&e.parentNode&&!cbi_d_check(f.deps)){e.parentNode.removeChild(e);g=true;if(f.parent){cbi_c[f.parent]--}}else{if((!e||!e.parentNode)&&cbi_d_check(f.deps)){if(!d){c.appendChild(f.node)}else{d.parentNode.insertBefore(f.node,d)}g=true;if(f.parent){cbi_c[f.parent]++}}}}if(f&&f.parent){if(!cbi_t_update()){cbi_tag_last(c)}}if(g){cbi_d_update()}}function cbi_bind(c,a,e,d){if(!c.addEventListener){c.attachEvent("on"+a,function(){var f=window.event;if(!f.target&&f.srcElement){f.target=f.srcElement}return !!e(f)})}else{c.addEventListener(a,e,!!d)}return c}function cbi_combobox(c,o,e,d){var k="cbi.combobox."+c;if(document.getElementById(k)){return}var m=document.getElementById(c);var f=document.createElement("select");f.id=k;f.className=m.className.replace(/cbi-input-text/,"cbi-input-select");if(m.nextSibling){m.parentNode.insertBefore(f,m.nextSibling)}else{m.parentNode.appendChild(f)}var g=m.getAttribute("cbi_datatype");var n=m.getAttribute("cbi_optional");if(g){cbi_validate_field(f,n=="true",g)}if(!o[m.value]){if(m.value==""){var j=document.createElement("option");j.value="";j.appendChild(document.createTextNode(e));f.appendChild(j)}else{var a=document.createElement("option");a.value=m.value;a.selected="selected";a.appendChild(document.createTextNode(m.value));f.appendChild(a)}}for(var l in o){var a=document.createElement("option");a.value=l;if(m.value==l){a.selected="selected"}a.appendChild(document.createTextNode(o[l]));f.appendChild(a)}var h=document.createElement("option");h.value="";h.appendChild(document.createTextNode(d));f.appendChild(h);m.style.display="none";cbi_bind(f,"change",function(){if(f.selectedIndex==f.options.length-1){m.style.display="inline";f.parentNode.removeChild(f);m.focus()}else{m.value=f.options[f.selectedIndex].value}try{cbi_d_update()}catch(i){}});f.focus();f.blur()}function cbi_combobox_init(f,a,c,e){var d=document.getElementById(f);cbi_bind(d,"blur",function(){cbi_combobox(f,a,c,e)});cbi_combobox(f,a,c,e)}function cbi_filebrowser(f,d,a){var e=document.getElementById(f);var c=window.open(d+(e.value||a||"")+"?field="+f,"luci_filebrowser","width=300,height=400,left=100,top=200,scrollbars=yes");c.focus()}function cbi_browser_init(h,g,c,a){function f(i){cbi_filebrowser(h,c,a);return false}var e=document.getElementById(h);var d=document.createElement("img");d.className="cbi-image-button";d.src=g+"/cbi/folder.gif";e.parentNode.insertBefore(d,e.nextSibling);cbi_bind(d,"click",f)}function cbi_dynlist_init(a,l,e,i,o){var f=document.getElementsByName(a)[0];var h=f.name;var m=f.parentNode;var j=f.placeholder;var n;function g(r,x,q){n=[];while(m.firstChild){var y=m.firstChild;var w=parseInt(y.index);if(w!=q){if(y.nodeName.toLowerCase()=="input"){n.push(y.value||"")}else{if(y.nodeName.toLowerCase()=="select"){n[n.length-1]=y.options[y.selectedIndex].value}}}m.removeChild(y)}if(x>=0){r=x+1;n.splice(r,0,"")}else{if(n.length==0){r=0;n.push("")}}for(var w=0;w<n.length;w++){var u=document.createElement("input");u.id=h+"."+(w+1);u.name=h;u.value=n[w];u.type="text";u.index=w;u.className="cbi-input-text";if(w==0&&j){u.placeholder=j}var p=document.createElement("img");p.src=l+((w+1)<n.length?"/cbi/remove.gif":"/cbi/add.gif");p.className="cbi-image-button";m.appendChild(u);m.appendChild(p);m.appendChild(document.createElement("br"));if(e){cbi_validate_field(u.id,((w+1)==n.length)||i,e)}if(o){cbi_combobox_init(u.id,o[0],"",o[1]);u.nextSibling.index=w;cbi_bind(u.nextSibling,"keydown",c);cbi_bind(u.nextSibling,"keypress",d);if(w==r||-w==r){u.nextSibling.focus()}}else{cbi_bind(u,"keydown",c);cbi_bind(u,"keypress",d);if(w==r){u.focus()}else{if(-w==r){u.focus();var s=u.value;u.value=" ";u.value=s}}}cbi_bind(p,"click",k)}}function d(p){p=p?p:window.event;var q=p.target?p.target:p.srcElement;if(q.nodeType==3){q=q.parentNode}switch(p.keyCode){case 8:case 46:if(q.value.length==0){if(p.preventDefault){p.preventDefault()}return false}return true;case 13:case 38:case 40:if(p.preventDefault){p.preventDefault()}return false}return true}function c(t){t=t?t:window.event;var u=t.target?t.target:t.srcElement;if(u.nodeType==3){u=u.parentNode}var s=u.previousSibling;while(s&&s.name!=a){s=s.previousSibling}var r=u.nextSibling;while(r&&r.name!=a){r=r.nextSibling}if(r&&r.nextSibling.name==a){r=r.nextSibling}switch(t.keyCode){case 8:case 46:var q=(u.nodeName.toLowerCase()=="select")?true:(u.value.length==0);if(q){if(t.preventDefault){t.preventDefault()}var p=u.index;if(t.keyCode==8){p=-p+1}g(p,-1,u.index);return false}break;case 13:g(-1,u.index,-1);break;case 38:if(s){s.focus()}break;case 40:if(r){r.focus()}break}return true}function k(p){p=p?p:window.event;var q=p.target?p.target:p.srcElement;if(q.src.indexOf("remove")>-1){q.previousSibling.value="";c({target:q.previousSibling,keyCode:8})}else{c({target:q.previousSibling,keyCode:13})}return false}g(NaN,-1,-1)}function cbi_hijack_forms(e,g,a,f){var c=e.getElementsByTagName("form");for(var d=0;d<c.length;d++){$(c[d]).observe("submit",function(h){h.stop();h.element().request({onSuccess:g,onFailure:a});if(f){f()}})}}function cbi_t_add(e,d){var a=document.getElementById("tab."+e+"."+d);var f=document.getElementById("container."+e+"."+d);if(a&&f){cbi_t[e]=(cbi_t[e]||[]);cbi_t[e][d]={tab:a,container:f,cid:f.id}}}function cbi_t_switch(f,c){if(cbi_t[f]&&cbi_t[f][c]){var g=cbi_t[f][c];var a=document.getElementById("tab."+f);for(var e in cbi_t[f]){var d=cbi_t[f][e];if(g.tab.id!=d.tab.id){d.tab.className=d.tab.className.replace(/(^| )cbi-tab( |$)/," cbi-tab-disabled ");d.container.style.display="none"}else{if(a){a.value=c}d.tab.className=d.tab.className.replace(/(^| )cbi-tab-disabled( |$)/," cbi-tab ");d.container.style.display="block"}}}return false}function cbi_t_update(){var d=[];var c=false;for(var a in cbi_t){for(var f in cbi_t[a]){if(cbi_c[cbi_t[a][f].cid]==0){cbi_t[a][f].tab.style.display="none"}else{if(cbi_t[a][f].tab&&cbi_t[a][f].tab.style.display=="none"){cbi_t[a][f].tab.style.display="";var e=cbi_t[a][f].tab;e.className+=" cbi-tab-highlighted";d.push(e)}}cbi_tag_last(cbi_t[a][f].container);c=true}}if(d.length>0){window.setTimeout(function(){for(var g=0;g<d.length;g++){d[g].className=d[g].className.replace(/ cbi-tab-highlighted/g,"")}},750)}return c}function cbi_validate_form(d,e){if(d.cbi_state=="add-section"||d.cbi_state=="del-section"){return true}if(d.cbi_validators){for(var c=0;c<d.cbi_validators.length;c++){var a=d.cbi_validators[c];if(!a()&&e){alert(e);return false}}}return true}function cbi_validate_reset(a){window.setTimeout(function(){cbi_validate_form(a,null)},100);return true}function cbi_validate_compile(f){var h=0;var c=false;var g=0;var a=[];f+=",";for(var e=0;e<f.length;e++){if(c){c=false;continue}switch(f.charCodeAt(e)){case 92:c=true;break;case 40:case 44:if(g<=0){if(h<e){var d=f.substring(h,e);d=d.replace(/\\(.)/g,"$1");d=d.replace(/^[ \t]+/g,"");d=d.replace(/[ \t]+$/g,"");if(d&&!isNaN(d)){a.push(parseFloat(d))}else{if(d.match(/^(['"]).*\1$/)){a.push(d.replace(/^(['"])(.*)\1$/,"$2"))}else{if(typeof cbi_validators[d]=="function"){a.push(cbi_validators[d]);a.push(null)}else{throw"Syntax error, unhandled token '"+d+"'"}}}}h=e+1}g+=(f.charCodeAt(e)==40);break;case 41:if(--g<=0){if(typeof a[a.length-2]!="function"){throw"Syntax error, argument list follows non-function"}a[a.length-1]=arguments.callee(f.substring(h,e));h=e+1}break}}return a}function cbi_validate_field(d,c,h){var j=(typeof d=="string")?document.getElementById(d):d;var g;try{g=cbi_validate_compile(h)}catch(i){}if(j&&g&&typeof g[0]=="function"){var f=function(){if(j.form){j.className=j.className.replace(/ cbi-input-invalid/g,"");var e=(j.options&&j.options.selectedIndex>-1)?j.options[j.options.selectedIndex].value:j.value;if(!(((e.length==0)&&c)||g[0].apply(e,g[1]))){j.className+=" cbi-input-invalid";return false}}return true};if(!j.form.cbi_validators){j.form.cbi_validators=[]}j.form.cbi_validators.push(f);cbi_bind(j,"blur",f);cbi_bind(j,"keyup",f);if(j.nodeName=="SELECT"){cbi_bind(j,"change",f);cbi_bind(j,"click",f)}j.setAttribute("cbi_validate",f);j.setAttribute("cbi_datatype",h);j.setAttribute("cbi_optional",(!!c).toString());f();var a=document.getElementById("cbi.combobox."+j.id);if(a){cbi_validate_field(a,c,h)}}}function cbi_row_swap(c,d,i){var g=c.parentNode;while(g&&g.nodeName.toLowerCase()!="tr"){g=g.parentNode}if(!g){return false}var k=g.parentNode;while(k&&k.nodeName.toLowerCase()!="table"){k=k.parentNode}if(!k){return false}var l=d?3:2;var f=d?k.rows.length:k.rows.length-1;for(var j=l;j<f;j++){if(k.rows[j]==g){if(d){g.parentNode.insertBefore(k.rows[j],k.rows[j-1])}else{g.parentNode.insertBefore(k.rows[j+1],k.rows[j])}break}}var a=[];for(j=2;j<k.rows.length;j++){k.rows[j].className=k.rows[j].className.replace(/cbi-rowstyle-[12]/,"cbi-rowstyle-"+(1+(j%2)));if(k.rows[j].id&&k.rows[j].id.match(/-([^\-]+)$/)){a.push(RegExp.$1)}}var h=document.getElementById(i);if(h){h.value=a.join(" ")}return false}function cbi_tag_last(a){var e;for(var d=0;d<a.childNodes.length;d++){var f=a.childNodes[d];if(f.nodeType==1&&f.nodeName.toLowerCase()=="div"){f.className=f.className.replace(/ cbi-value-last$/,"");e=f}}if(e){e.className+=" cbi-value-last"}}String.prototype.serialize=function(){var e=this;switch(typeof(e)){case"object":if(e==null){return"null"}else{if(e.length){var c,d="";for(var c=0;c<e.length;c++){d+=(d?", ":"")+String.serialize(e[c])}return"[ "+d+" ]"}else{var a,d="";for(a in e){d+=(d?", ":"")+a+": "+String.serialize(e[a])}return"{ "+d+" }"}}break;case"string":if(e.match(/[^a-zA-Z0-9_,.: -]/)){return'decodeURIComponent("'+encodeURIComponent(e)+'")'}else{return'"'+e+'"'}break;default:return e.toString()}};String.prototype.format=function(){if(!RegExp){return}var n=[/&/g,"&#38;",/"/g,"&#34;",/'/g,"&#39;",/</g,"&#60;",/>/g,"&#62;"];var o=[/"/g,"&#34;",/'/g,"&#39;"];function E(m,J){for(var a=0;a<J.length;a+=2){m=m.replace(J[a],J[a+1])}return m}var r=this;var x="";var p=/^(([^%]*)%('.|0|\x20)?(-)?(\d+)?(\.\d+)?(%|b|c|d|u|f|o|s|x|X|q|h|j|t|m))/;var G=b=[],e=0,j=0;while(G=p.exec(r)){var s=G[1];var q=G[2],B=G[3],H=G[4],A=G[5];var v=G[6],l=G[7];j++;if(l=="%"){g="%"}else{if(e<arguments.length){var h=arguments[e++];var C="";if(B&&B.substr(0,1)=="'"){C=q.substr(1,1)}else{if(B){C=B}}var z=true;if(H&&H==="-"){z=false}var D=-1;if(A){D=parseInt(A)}var y=-1;if(v&&l=="f"){y=parseInt(v.substring(1))}var g=h;switch(l){case"b":g=(parseInt(h)||0).toString(2);break;case"c":g=String.fromCharCode(parseInt(h)||0);break;case"d":g=(parseInt(h)||0);break;case"u":g=Math.abs(parseInt(h)||0);break;case"f":g=(y>-1)?((parseFloat(h)||0)).toFixed(y):(parseFloat(h)||0);break;case"o":g=(parseInt(h)||0).toString(8);break;case"s":g=h;break;case"x":g=(""+(parseInt(h)||0).toString(16)).toLowerCase();break;case"X":g=(""+(parseInt(h)||0).toString(16)).toUpperCase();break;case"h":g=E(h,n);break;case"q":g=E(h,o);break;case"j":g=String.serialize(h);break;case"t":var k=0;var f=0;var d=0;var c=(h||0);if(c>60){d=Math.floor(c/60);c=(c%60)}if(d>60){f=Math.floor(d/60);d=(d%60)}if(f>24){k=Math.floor(f/24);f=(f%24)}g=(k>0)?String.format("%dd %dh %dm %ds",k,f,d,c):String.format("%dh %dm %ds",f,d,c);break;case"m":var F=A?parseInt(A):1000;var u=v?Math.floor(10*parseFloat("0"+v)):2;var w=0;var I=parseFloat(h||0);var t=["","K","M","G","T","P","E"];for(w=0;(w<t.length)&&(I>F);w++){I/=F}g=I.toFixed(u)+" "+t[w];break}}}x+=q+g;r=r.substr(s.length)}return x+r};String.prototype.nobr=function(){return this.replace(/[\s\n]+/g,"&#160;")};String.serialize=function(){var c=[];for(var d=1;d<arguments.length;d++){c.push(arguments[d])}return"".serialize.apply(arguments[0],c)};String.format=function(){var c=[];for(var d=1;d<arguments.length;d++){c.push(arguments[d])}return"".format.apply(arguments[0],c)};String.nobr=function(){var c=[];for(var d=1;d<arguments.length;d++){c.push(arguments[d])}return"".nobr.apply(arguments[0],c)};