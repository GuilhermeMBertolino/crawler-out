<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Priority</title>
<script src="./js/libs/jquery.json-2.4.min.js"></script>
<style type="text/css">
	div.container.widget-container.text-container.offset{
		position: absolute;
		top:200px;
		left:540px;
	}
</style>
</head>
<body>
<div class="func-container">
	 <div id="priority_panel">
	 	<p id="priority_tip" class="note"></p>
	 	<input id="priority_type" type="text"/>
	 	<div id="priority_grid"></div>
	 	<button id="priority_submit"></button>
	 </div>
	 <div id="priority_help"></div>
</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(i){$("div.func-container").page({title:"",help:""});var h=[];$("div#priority_panel").panel({title:$.su.CHAR.PRIORITY.PRIORITY,collapsible:false});$("p#priority_tip").html($.su.CHAR.PRIORITY.PRIORITY_TIPS);$("input#priority_type").radio({fieldLabel:null,columns:2,items:[{boxlabel:$.su.CHAR.PRIORITY.ALL_DEVICE,name:"type",inputValue:"all",checked:true},{boxlabel:$.su.CHAR.PRIORITY.ACTIVE_DEVICE,name:"type",inputValue:"active"}]}).on("ev_change",function(l,j,k){if(k=="all"){}else{if(k=="active"){}}});$("button#priority_submit").button({fieldLabel:null,text:$.su.CHAR.PRIORITY.SAVE,cls:"submit",handler:function(){for(var j=0;j<h.length;j++){var l=$.toJSON(h[j]);var k=$.su.ozkerurl("/api/nodes");$.ajax({url:k,type:"PUT",dataType:"JSON",data:l,success:function(){}});d.read({},function(n,m,o){f(n.nodes)})}}});var g=new $.su.Store({proxy:null,preventErrorDefault:true,fields:[{name:"name"},{name:"type"},{name:"mac_addr"},{name:"stick"},{name:"priority"}],keyProperty:"mac_addr",autoLoad:false});$("div#priority_grid").grid({store:g,minLines:0,columns:[{text:$.su.CHAR.PRIORITY.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.PRIORITY.DEVICE,dataIndex:"name",width:100},{text:$.su.CHAR.PRIORITY.TYPE,width:100,dataIndex:"type"},{text:$.su.CHAR.PRIORITY.MAC_ADDRESS,width:180,dataIndex:"mac_addr"},{text:$.su.CHAR.PRIORITY.STICK,xtype:"actioncolumn",width:100,items:[{xtype:"html",dataIndex:"stick",renderer:function(k,j){var l=j.mac_addr;switch(k){case 0:return'<span class=""></span>';case 3:return'<span class=""></span>';default:return'<span class="stick-top" mac="'+l+'">TOP</span><span class="stick-top-text">top</span>'}}}]},{text:$.su.CHAR.PRIORITY.PRIORITY,xtype:"actioncolumn",items:[{xtype:"html",dataIndex:"priority",renderer:function(k,j){var l=j.mac_addr;switch(k){case 0:return'<span class="priority-down" mac="'+l+'">DOWN</span><span class="priority-down-text">down</span>';case 1:return'<span class="priority-up" mac="'+l+'">UP</span><span class="priority-up-text">up</span><span class="priority-down" mac="'+l+'">DOWN</span><span class="priority-down-text">down</span>';case 2:return'<span class="priority-up" mac="'+l+'">UP</span><span class="priority-up-text">up</span>';case 3:return'<span class=""></span><span class=""></span>'}}}]}]}).delegate("span.stick-top","click",function(l){var k=$(this).attr("mac");var j=g.getData(k);g.removeDataByKey(k);g.insertData(0,j);h=c(g.data);f(h)}).delegate("span.priority-up","click",function(m){var k=$(this).attr("mac");var j=g.getData(k);var l=g.getIndex(k);g.removeDataByKey(k);g.insertData(l-1,j);h=c(g.data);f(h)}).delegate("span.priority-down","click",function(m){var k=$(this).attr("mac");var j=g.getData(k);var l=g.getIndex(k);g.removeDataByKey(k);g.insertData(l+1,j);h=c(g.data);f(h)});var b=$.su.ozkerurl("/api/nodes");var d=new $.su.Proxy({url:b,preventErrorDefault:true,reader:{root:"data",type:"GET"},writer:{root:"data",type:"GET"}});function c(l){var j=[];for(var k=0;k<l.length;k++){j.push({Pipeline:l[k],UI:{priority:k+1}})}return j}function f(j){var m=[];var p=[];var l=[];var n=0;for(var k=0;k<j.length;k++){if(j[k].UI.priority==undefined){p.push(j[k])}else{m[j[k].UI.priority]=j[k]}}m=m.concat(p);for(var o in m){n++;if(m[o].Pipeline.name==undefined){m[o].Pipeline.name=m[o].Pipeline.ip_addr}m[o].Pipeline.stick=1;m[o].Pipeline.priority=1;l.push(m[o].Pipeline)}n==0?1:(l[0].stick=0,l[0].priority=0);n==1?(l[0].stick=3,l[0].priority=3):1;n>1?(l[n-1].stick=2,l[n-1].priority=2):1;g.loadData(l);h=c(l)}d.read({},function(k,j,l){f(k.nodes)});var a=new $.su.Help({container:"div#priority_help",content:"STREAM_BOOST_PRIORITY"})});</script>
</body>
</html>