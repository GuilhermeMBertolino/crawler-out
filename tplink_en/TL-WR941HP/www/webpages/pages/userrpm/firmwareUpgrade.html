<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<style type="text/css">
	div.offset{
		margin-left:500px;
	}
</style>
</head>
<body>
<div class="func-container">
	<div id="device-info">
		<input type="text"  id="firmware_ver" name="firmware_version" value="" />
		<input type="text"  id="hardware_ver" name="hardware_version" value="" />
	</div>
	<div id="remote-firmware">
		<form id="remote-setting">
			<input type="text"  id="remote_latest_version" name="latest_version" value="" />
			<span id="remote_version_detail"></span>
			<button type="button" id="remote-upgrade"></button><span id="scan_result"></span>
			<div id="check-button-container">
				<span id="check-result"></span>
				<button type="button" id="check-upgrade"></button>
				<div class="custom_loading_ctn">
					<span id="check_upgrade_loading" class="loading"></span>
				</div>
			</div>
		</form>
	</div>
	<div id="local-firmware">
		<form  id="firmware-setting">
			<input name="keep" value="on" type="hidden" />
			<input id="file" name="image" type="file" />
			<input type="text" id="firmware_version" name="firmware_version" value="" />
			<input type="text" id="hardware_version" name="hardware_version" value="" />
			<button type="button" id="upgrade" name="upgrade"></button>
		</form>
	</div>
	<div id="upgrade_alert_cnt">
		<h4 class="title" id="confirm_cnt">
			<span class="icon"></span>
			<span class="text" id="confirm_content"></span>
		</h4>
		<div id="upload_loading_msg" class="reboot-loading-msg hidden">
			<p id="note" class="reboot-progressbar-text"></p>
			<div id="multi_probar_note" class="hidden">
				<div id="upgrade_step1">
					<span class="multi_probar_step">1</span>
					<span id="note1" class="text"></span>
					<span class="probar_finish"></span>
				</div>
				<div id="upgrade_step2">
					<span class="multi_probar_step">2</span>
					<span id="note2" class="text"></span>
					<span class="probar_finish"></span>
				</div>
				<div id="upgrade_step3">
					<span class="multi_probar_step">3</span>
					<span id="note3" class="text"></span>
					<span class="probar_finish"></span>
				</div>
			</div>
			<input id="pro_bar" type="text" />
			<div>
				<span id="upgrade_failed_note" class="tips_red"></span>
			</div>
		</div>
	</div>
	<div id="online-upgrade-alert-container">
		<h4 class="title" id="online-upgrade-comfirm">
			<span class="icon"></span>
			<span class="text" id="online-confirm-content"></span>
		</h4>
		<div id="online-upgrade-container" class="hidden">
			<span id="online-upgrade-info" class="text"></span>
			<input id="online-download-progressbar"/>
			<input id="online-upgrade-progressbar"/>
			<input id="online-reboot-progressbar"/>
			<p class="note hidden" id="online-upgrade-note-container">
				<span class="title note-title"></span>
				<span class="text" id="online-upgrade-note"></span>
			</p>
		</div>
		<div id="failure-msg-container" class="hidden">
			<h4 class="title">
				<span class="icon"></span>
				<span class="title" id="upload-error-title"></span>
				<span class="text" id="failure-content"></span>
			</h4>
			<div id="failure-btn-container">
				<button type="button" id="cancel-btn"></button>
				<button type="button" id="retry-btn"></button>
			</div>
		</div>
	</div>
	<div id="upgrade_failed_cnt">
		<h4 class="title">
			<span class="icon" ></span>
			<span class="text" id="error_str"></span>
		</h4>
	</div> 
	<div id="upgrade_error_cnt">
		<h4 class="title">
			<span class="icon" ></span>
			<span class="text" id="upgrade_error_str"></span>
		</h4>
	</div> 
	<div id="help_firmware"></div>
</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(L){var p="./data/firmware.set.json";var H=$.su.url("/admin/firmware?form=upgrade");var f=$.su.url("/admin/cloud_account?form=cloud_upgrade");var g=$.su.url("/admin/cloud_account?form=detect_upgrade_status");var J=$.su.url("/admin/cloud_account?form=check_internet");var m=$.su.url("/admin/cloud_account?form=check_device");var F=new $.su.Proxy({url:H});var r=new $.su.Proxy({url:$.su.url("/admin/firmware?form=config")});var C=new $.su.Proxy({url:g});var y=new $.su.Proxy({url:J});var v=new $.su.Proxy({url:m});$("#check_upgrade_loading").css("display","none");$("div.func-container").page({title:$.su.CHAR.FIRMWARE.TITLE,help:""});$("div#device-info").panel({title:$.su.CHAR.FIRMWARE.INFO,collapsible:false});$("div#remote-firmware").panel({title:$.su.CHAR.FIRMWARE.REMOTE_TITLE,collapsible:false});$("div#local-firmware").panel({title:$.su.CHAR.FIRMWARE.TITLE,collapsible:false});$("div#device-info").hide();$("div#remote-firmware").hide();$("div#local-firmware").panel("setTitle",$.su.CHAR.FIRMWARE.TITLE);var k=2*60*1000;var x=3*1000;var B=0.2;var o=false;var A=true;var G=0;var z=0;var i=5;var h=false;var d=false;$("span#upgrade_failed_note").hide();$("span#upgrade_failed_note").html($.su.CHAR.FIRMWARE.UPGRADE_FAILED);$("#check-result").html($.su.CHAR.FIRMWARE.FIRMWARE_INFO);$("#check-result").hide();$("input#firmware_ver").textbox({fieldLabel:$.su.CHAR.FIRMWARE.FIRMWAREVERSION,inputCls:"xxl",readOnly:true});$("input#hardware_ver").textbox({fieldLabel:$.su.CHAR.FIRMWARE.HARDWAREVERSION,inputCls:"xxl",readOnly:true});$("input#firmware_version").textbox({fieldLabel:$.su.CHAR.FIRMWARE.FIRMWAREVERSION,inputCls:"xxl",readOnly:true});$("input#hardware_version").textbox({fieldLabel:$.su.CHAR.FIRMWARE.HARDWAREVERSION,inputCls:"xxl",readOnly:true});$("#file").file({fieldLabel:$.su.CHAR.FIRMWARE.NEWFILE,allowBlank:false,extension:"bin"});$("#upgrade_failed_cnt").msg({cls:"warning reboot-confirm-size",type:"alert"});$("#upgrade_error_cnt").msg({cls:"warning reboot-confirm-size",type:"alert"});$("#upgrade_error_str").html($.su.CHAR.FIRMWARE.ILEGAL_DEVICE);$("#upgrade_alert_cnt").msg({okHandler:function(){$("#upgrade_alert_cnt").msg("hideButtons");$("#confirm_cnt").hide();if(d){$("#note").html($.su.CHAR.FIRMWARE.DO_NOT_OPERATE);$("div#multi_probar_note").show();$("#note1").css("color","#96CC56")}else{$("#note").html($.su.CHAR.FIRMWARE.WARNING);$("div#multi_probar_note").hide()}$("#firmware-setting").form("submit",{operation:"firmware"},function(){M()},function(){M()},function(){});return false},cancelHandler:function(){return true},cls:"warning reboot-confirm-size",closeBtn:false,type:"confirm"});var n=$("span#firmware-version-content").text().slice(0,-4);var a=$("span#hardware-version-content").text();$("input#firmware_version").textbox("setValue",n);$("input#hardware_version").textbox("setValue",a);var t=$("input#pro_bar").progressbar({fieldLabel:null,width:326,height:6,value:0,cls:"reboot-loading-probar"});$("#note").html($.su.CHAR.FIRMWARE.WARNING);$("#note1").html($.su.CHAR.FIRMWARE.FIRMWARE_UPDATING_NOTE);$("#note2").html($.su.CHAR.FIRMWARE.REBOOTING_NOTE);$("#note3").html($.su.CHAR.FIRMWARE.SCREEN_UPDATING_NOTE);$("button#upgrade").button({text:$.su.CHAR.FIRMWARE.UPGRADE,cls:"m",handler:function(){r.write({operation:"check"},function(O){if($("#firmware-setting").form("validate")){$("#upgrade_alert_cnt").msg("show")}else{return false}})},cls:"submit"});function M(){$("#upload_loading_msg").show();t.progressbar("animate",0,1,2*60*1000,function(){if(localStorage){localStorage.setItem("token","")}location.href="http://tplinkwifi.net"});F.write({operation:"fwup_check"},function(O){},function(O){if(O=="err_form"){$("#error_str").html($.su.CHAR.ERROR["00000001"]);u();q()}else{if(O=="err_check"){$("#error_str").html($.su.CHAR.ERROR["00000002"]);u();q()}else{if(O=="err_sizex"){$("#error_str").html($.su.CHAR.ERROR["00000003"]);u();q()}else{if(O=="err_flash"){$("#error_str").html($.su.CHAR.ERROR["00000004"]);u();q()}else{if(O=="err_reboot"){$("#error_str").html($.su.CHAR.ERROR["00000005"]);u();q()}else{if(O=="err_other"){$("#error_str").html($.su.CHAR.ERROR["00000006"]);u();q()}else{if(O=="err_failed"){$("#error_str").html($.su.CHAR.ERROR["00000135"]);u();q()}else{u()}}}}}}}},function(){})}function u(){clearInterval(o);clearInterval(h);o=false;h=false;t.progressbar("stop");t.progressbar("reset");$("#upgrade_alert_cnt").hide();$("#upgrade_alert_cnt").msg("close",function(){$("#upgrade_alert_cnt").msg("showButtons");$("#confirm_cnt").show();$("#upload_loading_msg").hide()})}function q(){$("#upgrade_failed_cnt").msg("show",function(){})}$("#confirm_content").html($.su.CHAR.FIRMWARE.CONFIRM_CONTENT);var l=new $.su.Proxy({url:H});$("#firmware-setting").form({proxy:l,formEnctype:"multipart/form-data",traditional:true,hiddenFrame:true,fields:[{name:"image"},{name:"firmware_version",mapping:"firmware_version"},{name:"hardware_version",mapping:"hardware_version"}],submitBtn:null}).on("ev_loadData",function(P,O){d=O.multi_progressbar=="yes"?true:false;k=Number(O.totaltime*1000||k)});$.su.app.runningModule.addUnloadHandler(function(){if(o){clearInterval(o);o=false}t.progressbar("stop");t.progressbar("reset");if(c){clearInterval(c)}N.progressbar("stop");N.progressbar("reset");I.progressbar("stop");I.progressbar("reset")});$("input#remote_latest_version").textbox({fieldLabel:$.su.CHAR.FIRMWARE.LATESTVERSION,inputCls:"xxl",readOnly:true});var b=$("div#online-upgrade-alert-container").msg({okHandler:function(){y.read({operation:"read"},function(O){$("#remote-setting").form("setNormal");v.read({operation:"read"},function(P){$("#remote-setting").form("setNormal");$("#online-upgrade-alert-container").msg("hide");$("span#online-upgrade-info").html($.su.CHAR.FIRMWARE.DOWNLOADING);b.msg("hideButtons");$("#online-upgrade-comfirm").hide();$("#online-upgrade-container").show();$("#online-upgrade-alert-container").msg("show");K.read({operation:"upgrade"},function(){j()},function(){$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000212"]);$("#online-upgrade-alert-container").msg("close");$("#online-upgrade-comfirm").hide();$("#online-upgrade-container").hide();$("#failure-msg-container").hide()},function(){$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000212"]);$("#online-upgrade-alert-container").msg("close");$("#online-upgrade-comfirm").hide();$("#online-upgrade-container").hide();$("#failure-msg-container").hide()})},function(){$("#upgrade_error_cnt").msg("show")},function(){$("#upgrade_error_cnt").msg("show")})},function(){$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000159"]);$("#remote-setting").form("hideLoading")},function(){$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000159"]);$("#remote-setting").form("hideLoading")})},cancelHandler:function(){b.msg("close");$("#online-upgrade-comfirm").hide();$("#online-upgrade-container").hide();$("#failure-msg-container").hide();return true},cls:"warning",closeBtn:false,type:"confirm"});$("span#online-upgrade-info").html($.su.CHAR.FIRMWARE.DOWNLOADING);$("span.note-title").html($.su.CHAR.FIRMWARE.NOTE);$("span#online-upgrade-note").html($.su.CHAR.FIRMWARE.UPGRADE_INOF);$("#online-confirm-content").html($.su.CHAR.FIRMWARE.CONFIRM_CONTENT);$("#upload-error-title").html($.su.CHAR.OPERATION.SORRY);$("#failure-content").html($.su.CHAR.FIRMWARE.UPGRADE_FAIL);var D=$("input#online-download-progressbar").progressbar({fieldLabel:null,width:326,height:6,value:0,expression:"percentage*100",cls:"reboot-loading-probar"});var N=$("input#online-upgrade-progressbar").progressbar({fieldLabel:null,width:326,height:6,value:0,expression:"percentage*100",cls:"reboot-loading-probar"}).progressbar("hide");var I=$("input#online-reboot-progressbar").progressbar({fieldLabel:null,width:326,height:6,value:0,cls:"reboot-loading-probar"}).progressbar("hide");$("button#remote-upgrade").button({text:$.su.CHAR.FIRMWARE.UPGRADE,cls:"m  submit",handler:function(){b.msg("showButtons");$("#online-upgrade-comfirm").show();$("#online-upgrade-container").hide();$("failure-msg-container").hide();b.msg("show")}});$("button#check-upgrade").button({text:$.su.CHAR.FIRMWARE.CHECK_UPGRADE,cls:"submit inline-block",handler:function(){$("#check-result").hide();$("button#check-upgrade").button("disable");$("#check_upgrade_loading").fadeIn(150);y.read({operation:"read"},function(O){$("#remote-setting").form("setNormal");v.read({operation:"read"},function(P){$("#remote-setting").form("setNormal");K.read({operation:"read"},function(Q){if(Q.latest_flag){$("#check-result").html($.su.CHAR.FIRMWARE.FIRMWARE_INFO);$("#check-result").show();$("button#check-upgrade").button("enable");$("#check_upgrade_loading").fadeOut(150);return true}else{$.su.app.menuGoTo("firmware-upgrade","./pages/userrpm/firmwareUpgrade.html",true)}},function(Q){$("button#check-upgrade").button("enable");$("#check_upgrade_loading").fadeOut(150)},function(Q){$("button#check-upgrade").button("enable");$("#check_upgrade_loading").fadeOut(150)})},function(){$("#upgrade_error_cnt").msg("show");$("button#check-upgrade").button("enable");$("#check_upgrade_loading").fadeOut(150)},function(){$("#upgrade_error_cnt").msg("show");$("button#check-upgrade").button("enable");$("#check_upgrade_loading").fadeOut(150)})},function(){$("#check-result").html($.su.CHAR.ERROR["00000159"]);$("#check-result").show();$("button#check-upgrade").button("enable");$("#check_upgrade_loading").fadeOut(150)},function(){$("#check-result").html($.su.CHAR.ERROR["00000159"]);$("#check-result").show();$("button#check-upgrade").button("enable");$("#check_upgrade_loading").fadeOut(150)})}});var c;var K=new $.su.Proxy({url:f});$("button#remote-upgrade").button("hide");$("button#check-upgrade").button("hide");$("form#remote-setting").form({proxy:K,fields:[{name:"latest_version",mapping:"latest_version"}],submitBtn:"#remote-upgrade",autoLoad:false}).on("ev_loadData",function(Q,P){if(typeof P=="undefined"){return true}var O=P.detail.replace(/\n/g,"<br/>");O=O.replace(/\t/g,"	");O=O.replace(/\'/g,"'");$("#remote_version_detail").html(O);if(P.latest_flag){$("button#remote-upgrade").closest(".form-submit").hide();$("button#check-upgrade").button("show")}else{$("button#check-upgrade").button("hide");$("button#remote-upgrade").closest(".form-submit").show()}$("button#remote-upgrade").button("show")});K.read({operation:"load"});var E=0;var s=0;var j=function(){clearInterval(c);D.progressbar("hide");N.progressbar("hide");I.progressbar("hide");D.progressbar("reset");N.progressbar("reset");I.progressbar("reset");var O;D.progressbar("show");c=setInterval(function(){C.read({},function(P){G=0;E=P.percent*1/100;D.progressbar("setValue",E);if(E==1){clearInterval(c);$("span#online-upgrade-info").html($.su.CHAR.FIRMWARE.UPGRADING);D.progressbar("reset");D.progressbar("hide");N.progressbar("show");o=setInterval(function(){F.write({operation:"fwup_check"},function(Q){z=0;s=Q.percent*1/100;N.progressbar("setValue",s);if(s==1){clearInterval(o);N.progressbar("reset");N.progressbar("hide");I.progressbar("show");$("span#online-upgrade-info").html($.su.CHAR.FIRMWARE.REBOOTING);I.progressbar("animate",0,1,k,function(){if(localStorage){localStorage.setItem("token","")}location.href="/"})}},function(Q){z++;if(z==i){z=0;clearInterval(o);switch(Q){case"err_reboot":$("#failure-content").html($.su.CHAR.ERROR["00000005"]);break;case"err_other":$("#failure-content").html($.su.CHAR.ERROR["00000212"]);break;case"err_failed":$("#failure-content").html($.su.CHAR.ERROR["00000135"]);break;default:$("#failure-content").html($.su.CHAR.ERROR["00000212"]);break}$("#online-upgrade-container").hide();$("#online-upgrade-alert-container").msg("show");$("#failure-msg-container").show();N.progressbar("reset");N.progressbar("hide")}})},1000)}},function(P){G++;if(G==i){G=0;var Q=$.su.cloudError(P);$("#failure-content").html(Q);clearInterval(c);D.progressbar("reset");D.progressbar("hide");$("#online-upgrade-container").hide();$("#online-upgrade-alert-container").msg("show");$("#failure-msg-container").show()}},function(){G++;if(G==i){G=0;clearInterval(c);D.progressbar("reset");D.progressbar("hide");$("#online-upgrade-container").hide();$("#online-upgrade-alert-container").msg("show");$("#failure-msg-container").show()}})},1000)};$("button#retry-btn").button({text:$.su.CHAR.FIRMWARE.RETRY,cls:"m submit inline-block",handler:function(){D.progressbar("reset");N.progressbar("reset");I.progressbar("reset");$("span#online-upgrade-info").html($.su.CHAR.FIRMWARE.DOWNLOADING);$("#online-upgrade-container").show();$("#failure-msg-container").hide();K.read({operation:"upgrade"},function(){j()},function(){$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000212"]);$("#online-upgrade-alert-container").msg("close");$("#online-upgrade-comfirm").hide();$("#online-upgrade-container").hide();$("#failure-msg-container").hide()},function(){$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000212"]);$("#online-upgrade-alert-container").msg("close");$("#online-upgrade-comfirm").hide();$("#online-upgrade-container").hide();$("#failure-msg-container").hide()})}});$("button#cancel-btn").button({text:$.su.CHAR.FIRMWARE.CANCEL,cls:"m submit inline-block gap",handler:function(){b.msg("close");$("#online-upgrade-comfirm").hide();$("#online-upgrade-container").hide();$("#failure-msg-container").hide()}});$("#scan_result").status({cls:"inline-block",textCls:"scan-result"}).hide();var w=new $.su.Help({container:"div#help_firmware",content:["FIRMWARE"]})});</script>
</body>
</html>
