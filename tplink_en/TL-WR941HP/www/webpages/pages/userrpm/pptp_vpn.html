<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>PPTP VPN</title>
</head>
<body>
<div class="func-container">
	<div id="pptp_vpn">
		<input type="text" id="enable_vpn_server" name="enabled" />
		<div id="ip_addr_setting">
			<input type="text" id="from_ip_addr" name="from_ip_addr" />
			<input type="text" id="remoteip" name="remoteip" />
			<p class="inline-block"><span id="to_ip_addr_note"></span></p>
			<input type="text" id="to_ip_addr" name="to_ip_addr" />
			<p class="inline-block"><span id="client_ip_note"></span></p>
		</div>
		<input type="text" id="username" name="username" />
		<input type="text" id="password" name="password" />
	</div>
	<div id="vpn_help"></div>
<div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(z){var o="1732";var f=$.su.url("/admin/nat?form=vs");var C=$.su.url("/admin/nat?form=pt");var t=$.su.url("/admin/nat?form=dmz");var m=$.su.url("/admin/pptpd?form=config");var b=$.su.url("/admin/upnp?form=service_vpn");var w="";var a="";var x=new $.su.Proxy({url:$.su.url("/admin/dhcps?form=setting")});x.read({},function(D){w=D.ipaddr_start;a=D.ipaddr_end});var u=0;var v=new $.su.Proxy({url:f});var q=0;var y=new $.su.Proxy({url:C});var s=0;var h=new $.su.Proxy({url:t});var c=0;var n=new $.su.Proxy({url:b});v.read({operation:"load"},function(D){u=D});y.read({operation:"load"},function(D){q=D});h.read({},function(D){s=D.enable});n.read({operation:"load"},function(D){c=D});var i="";var j=new $.su.Proxy({url:$.su.url("/admin/dhcps?form=reservation")});j.read({operation:"load"},function(D){i=D});var g="";var l="";var B=new $.su.Proxy({url:$.su.url("/admin/openvpn?form=config")});B.read({},function(D){g=D.serverip;l=D.mask});var A=new $.su.Proxy({url:$.su.url("/admin/network?form=lan_ipv4")});var k="";var p="";A.read({},function(D){k=D.ipaddr;p=D.mask_type});$("div#pptp_vpn").panel({title:$.su.CHAR.VPN.PPTPVPN,collapsible:false});var d=new $.su.Proxy({url:m});$("div#pptp_vpn").form({proxy:d,fields:[{name:"enabled",mapping:"enabled"},{name:"remoteip",mapping:"remoteip"},{name:"username",mapping:"username"},{name:"password",mapping:"password"},{name:"from_ip_addr"},{name:"to_ip_addr"}],submitBtn:"default",validator:function(){var E=$("input#from_ip_addr").val();var H=$("input#to_ip_addr").val();var D=E.substr(0,E.lastIndexOf(".")+1)+H;var J=$("input#chk_enable_vpn_server").checkbox("getValue");$("input#remoteip").val(E+"-"+H);var K="1723";if(J=="enabled"){for(var I in u){var L=u[I].external_port;var N=u[I].enable;if(N=="on"&&L==K){$("div#pptp_vpn").form("setError",$.su.CHAR.ERROR["00000220"]);return false}}for(var I in q){var M=q[I].external_port;var G=q[I].enable;if(G=="on"&&M==K){$("div#pptp_vpn").form("setError",$.su.CHAR.ERROR["00000221"]);return false}}for(var I in c){var F=c[I].external_port;if(F==K){$("div#pptp_vpn").form("setError",$.su.CHAR.ERROR["00000223"]);return false}}if(s=="on"){$("div#pptp_vpn").form("setError",$.su.CHAR.ERROR["00000222"]);return false}}if($.su.func.ipToInt(E)>=$.su.func.ipToInt(w)&&$.su.func.ipToInt(E)<=$.su.func.ipToInt(a)){$("div#pptp_vpn").form("setError",$.su.CHAR.VPN.CONFLICT_WITH_DHCP);$("input#from_ip_addr").textbox("setError");return false}if($.su.func.ipToInt(D)>=$.su.func.ipToInt(w)&&$.su.func.ipToInt(D)<=$.su.func.ipToInt(a)){$("div#pptp_vpn").form("setError",$.su.CHAR.VPN.CONFLICT_WITH_DHCP);$("input#from_ip_addr").textbox("setError");return false}for(var I=0;I<i.length;++I){if($.su.func.ipToInt(i[I].ip)>=$.su.func.ipToInt(E)&&$.su.func.ipToInt(i[I].ip)<=$.su.func.ipToInt(D)){$("div#pptp_vpn").form("setError",$.su.CHAR.VPN.CONFLICT_WITH_RESERVED);$("input#from_ip_addr").textbox("setError");return false}}if(k&&p){if($.su.func.isSameNet(E,k,p)){$("div#pptp_vpn").form("setError",$.su.CHAR.VPN.CONFLICT_WITH_DHCP);$("input#from_ip_addr").textbox("setError");return false}if($.su.func.isSameNet(D,k,p)){$("div#pptp_vpn").form("setError",$.su.CHAR.VPN.CONFLICT_WITH_DHCP);$("input#from_ip_addr").textbox("setError");return false}}if(g&&l){if($.su.func.isSameNet(E,g,l)){$("div#pptp_vpn").form("setError",$.su.CHAR.VPN.CONFLICT_WITH_OPENVPN);$("input#from_ip_addr").textbox("setError");return false}if($.su.func.isSameNet(D,g,l)){$("div#pptp_vpn").form("setError",$.su.CHAR.VPN.CONFLICT_WITH_OPENVPN);$("input#from_ip_addr").textbox("setError");return false}}return true}}).on("ev_loadData",function(I,H){if(H&&H.remoteip){var E=H.remoteip.split("-")[0]?H.remoteip.split("-")[0]:H.remoteip;var J=H.remoteip.split("-")[1]?H.remoteip.split("-")[1]:"";$("input#from_ip_addr").val(E);$("input#to_ip_addr").val(J);var G=$("input#from_ip_addr").val().split(".");var F="";for(var D=0;D<3;++D){F+=G[D]+"."}$("span#to_ip_addr_note").html("-"+F)}});$("input#enable_vpn_server").checkbox({fieldLabel:"",tips:"",cls:"",items:[{boxlabel:$.su.CHAR.VPN.ENABLE_VPN_SERVER,uncheckedValue:"off",inputValue:"on",id:"chk_enable_vpn_server"}]});$("input#from_ip_addr").textbox({fieldLabel:$.su.CHAR.VPN.CLIENT_IP_ADDRESS,cls:"inline-block",inputCls:"m",allowBlank:false,vtype:"ip",textFormat:$.su.format.ip,validator:function(F){var D=F.split(".")[3];var E=$("input#to_ip_addr").textbox("getValue");if(E){if(E-D<10&&E-D>=0){$("input#to_ip_addr").textbox("setValid")}else{$("input#to_ip_addr").textbox("setError")}}return true}}).on("ev_validatechange",function(I,G,E,H){if(G==true){G=$("input#from_ip_addr").val().split(".");var F="";for(var D=0;D<3;++D){F+=G[D]+"."}$("span#to_ip_addr_note").html(" - "+F)}else{$("input#to_ip_addr").textbox("setValid")}});$("input#to_ip_addr").textbox({fieldLabel:null,cls:"inline-block",inputCls:"xxs",allowBlank:false,textFormat:$.su.format.number,vtype:"number",validator:function(E){var D=$("input#from_ip_addr").textbox("getValue").split(".")[3];if(D!=undefined&&parseInt(D)){if(E-D<10&&E-D>=0){return true}else{return false}}return true}});$("span#client_ip_note").html($.su.CHAR.VPN.CLIENT_IP_NOTE);$("input#username").textbox({fieldLabel:$.su.CHAR.VPN.ACCOUNT_USERNAME,allowBlank:false,vtype:"name_in_vpn",validator:function(D){return true}});$("input#password").textbox({fieldLabel:$.su.CHAR.VPN.ACCOUNT_PASSWORD,allowBlank:false,vtype:"pwd_in_vpn",validator:function(D){return true}});$("div#pptp_vpn").on("click","a#go-to-vs",function(){$.su.menu.advanced.goTo("virtual-servers")});$("div#pptp_vpn").on("click","a#go-to-pt",function(){$.su.menu.advanced.goTo("port-triggering")});$("div#pptp_vpn").on("click","a#go-to-dmz",function(){$.su.menu.advanced.goTo("dmz")});$("div#pptp_vpn").on("click","a#go-to-upnp",function(){$.su.menu.advanced.goTo("upnp")});var r=new $.su.Help({container:"div#vpn_help",content:["PPTP_VPN","PPTP_VPN_GUIDE"]})});</script>
</body>
</html>