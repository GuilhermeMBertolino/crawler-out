<script type="text/javascript" language="javascript">
var bParamsChanged = false;
var bSettingStatus = 0;
var bNext = true;
function doEnable24g(bChecked) {
	if (bChecked == true)
		$("#form24G :input[type='text']").attr("disabled", false);
	else
		$("#form24G :input[type='text']").attr("disabled", true);
}
function doEnable5g(bChecked) {
	if (bChecked == true)
		$("#form5G :input[type='text']").attr("disabled", false);
	else
		$("#form5G :input[type='text']").attr("disabled", true);
}
function doCollect() {
	$.qd.wl.en = $("#enWl24g").prop("data-checked") ? true : false;
	$.qd.wl.ssid = $("#wl24gSSID").val();
	$.qd.wl.pwd = $("#wl24gPwd").val();

	if (INCLUDE_LAN_WLAN_DUALBAND) {
		$.qd.wl5g.en = $("#enWl5g").prop("data-checked") ? true : false;
		$.qd.wl5g.ssid = $("#wl5gSSID").val();
		$.qd.wl5g.pwd = $("#wl5gPwd").val();
	}
}
function isHex(str, arg) {
    str = str.toLowerCase();
    for (var i = 0; i < str.length; i++) {
        if ((str.charAt(i) >= '0' && str.charAt(i) <= '9') || (str.charAt(i) >= 'a' && str.charAt(i) <= 'f'))
            continue;
        else {
            if (arg != 0)
                $.alert(ERR_WLAN_WEP_KEY_HEX_INVALID);
            return false;
        }
    }
    if (parseInt(str, 16) == 0) {
        if (arg != 0)
            $.alert(ERR_WLAN_WEP_KEY_HEX_INVALID);
        return false;
    }
    return true;
}
function checkSSID(inputBox) {
    var ssidLen = $.realLen(inputBox.prop('value'));

    if (ssidLen <= 0) {
        $.alert(ERR_WLAN_SSID_IS_EMPTY);
        inputBox.focus();
        inputBox.select();
        return false;
    } else if (ssidLen > 32) {
        $.alert(ERR_WLAN_SSID_LEN_OUTRANGE);
        inputBox.focus();
        inputBox.select();
        return false;
    }

    return true;
}
function checkPassword(inputBox) {
	var pwd = inputBox.prop("value");
	if (pwd.length == 0) {
		return true;
	}
	else if (pwd.length < 8) {
		$.alert(ERR_QS_WLAN_PWD_LENGTH_INVALID);
		inputBox.focus();
		inputBox.select();
		return false;
	}
	else if (pwd.length >= 64) {
		if (!isHex(pwd, 0)) {
			$.alert(ERR_QS_WLAN_PWD_HEX_INVALID);
			inputBox.focus();
			inputBox.select();
			return false;
		}
		inputBox.val(inputBox.val().substr(0, 64));
	}
	else {
		if ($.asc(pwd, true)) {
			$.alert(ERR_QS_WLAN_PWD_ASCII_INVALID);
			inputBox.focus();
			inputBox.select();
			return false;
		}
	}
}
function chkParamsChange() {
	var ret = false;
	var currWlan24g = {en: $("#enWl24g").prop("data-checked") ? 1 : 0, ssid: $("#wl24gSSID").val(), pwd: $("#wl24gPwd").val()};
	if (INCLUDE_LAN_WLAN_DUALBAND)
		var currWlan5g = {en: $("#enWl5g").prop("data-checked") ? 1 : 0, ssid: $("#wl5gSSID").val(), pwd: $("#wl5gPwd").val()};
	
	$.each(dmWlanList, function() {
		if (this.X_TP_Band == "2.4GHz") {
			if (this.enable != currWlan24g.en || this.SSID != currWlan24g.ssid || this.X_TP_PreSharedKey != currWlan24g.pwd) {
				ret = true;
				return false;
			}
		}
		else if (INCLUDE_LAN_WLAN_DUALBAND && this.X_TP_Band == "5GHz") {
			if (this.enable != currWlan5g.en || this.SSID != currWlan5g.ssid || this.X_TP_PreSharedKey != currWlan5g.pwd) {
				ret = true;
				return false;
			}
		}
	});
	
	return ret;
}
function showWlanNote() {
	if ($.qd.wl.en == true) {
		$("#note_wl24gEn > input").prop("value", m_str.enabled);
		$("#note_wl24gSSID").removeClass("nd");
		$("#note_wl24gPwd").removeClass("nd");
		$("#note_wl24gSSID > input").prop("value", $.qd.wl.ssid);
		$("#note_wl24gPwd > input").prop("value", $.qd.wl.pwd);		
	}
	else {
		$("#note_wl24gEn > input").prop("value", m_str.disabled);
		$("#note_wl24gSSID").addClass("nd");
		$("#note_wl24gPwd").addClass("nd");
	}

	if (INCLUDE_LAN_WLAN_DUALBAND) {
		$("#note_wl5g").removeClass("nd");
		if ($.qd.wl5g.en == true) {
			$("#note_wl5gEn > input").prop("value", m_str.enabled);
			$("#note_wl5gSSID").removeClass("nd");
			$("#note_wl5gPwd").removeClass("nd");
			$("#note_wl5gSSID > input").prop("value", $.qd.wl5g.ssid);
			$("#note_wl5gPwd > input").prop("value", $.qd.wl5g.pwd);
		}
		else {
			$("#note_wl5gEn > input").prop("value", m_str.disabled);
			$("#note_wl5gSSID").addClass("nd");
			$("#note_wl5gPwd").addClass("nd");
		}
	}
}
function preGoNext() {
	var empty_2G_PW=false;

	if (bParamsChanged == false) {
		if ($("#enWl24g").prop("data-checked")) {
			if (checkSSID($("#wl24gSSID")) == false)
				return ;
			if (checkPassword($("#wl24gPwd")) == false)
				return ;
			if ($("#wl24gPwd").prop("value").length == 0)
			{
				empty_2G_PW = true;
			}
		}
		if (INCLUDE_LAN_WLAN_DUALBAND) {
			if ($("#enWl5g").prop("data-checked")) {
				if (checkSSID($("#wl5gSSID")) == false)
					return ;
				if (checkPassword($("#wl5gPwd")) == false)
					return ;
				if ($("#wl5gPwd").prop("value").length == 0)
				{
					if(empty_2G_PW)
						$.confirm(e_str[ERR_QS_WLAN_PWD_ENCRYPTION_NONE_BOTH],goNext,null);
					else
						$.confirm(e_str[ERR_QS_WLAN_PWD_ENCRYPTION_NONE_5G],goNext,null);
					return ;
				}
			}
		}
		if(empty_2G_PW)
			$.confirm(e_str[ERR_QS_WLAN_PWD_ENCRYPTION_NONE_2G],goNext,null);
		else
			goNext();
	}
	else if(!INCLUDE_USB_3G_DONGLE) {
		/* if setting action is done, go to next page, otherwise, show loading icon then goto next page */
		switch (bSettingStatus) {
			case 0:
				/* setting action hasn't been started yet */
				break;
			case 1:
				/* processing setting action, add loading... */
			/*	qsAddLoading();*/
				/* $.addLoading($("#next")); */
				bSettingStatus++;
				break;
			case 2:
				/* already add loading... */
				break;
			case 3:
				/* setting action has been done */
				$.removeLoading();
				$.qf.next();
				break;
			default:
				/* Can't be here */
				break;
		}
	}
}
function goNext() {
	var arg24g = {};
	var arg5g = {};
	if (bParamsChanged == false) {

		doCollect();
		if (chkParamsChange() == true) {
            if(!INCLUDE_USB_3G_DONGLE)
            {
				$("#div_wlanSetting").css("display", "none");
				$("#div_wlanNote").fadeIn(200, function() {
					$(this).css("display", "block");
					showWlanNote();
					$("#btnPermitWireless").prop('checked', false).data('tpRadio').refresh();
					$("#btnPermitWired").prop('checked', false).data('tpRadio').refresh();
					$("#back").prop("disabled", "disabled");
					$("#next").prop("disabled", "disabled");
				});
		    }
			if(!INCLUDE_USB_3G_DONGLE)
				$.addLoading($("#next"));
			bParamsChanged = true;			

			arg24g.enable = ($.qd.wl.en == true) ? 1 : 0;
			if (arg24g.enable == 1) {
				arg24g.SSID = $.qd.wl.ssid;
				arg24g.X_TP_PreSharedKey = $.qd.wl.pwd;	
				arg24g.SSIDAdvertisementEnabled=1
				arg24g.standard="n";
				arg24g.X_TP_Bandwidth="Auto";
				arg24g.autoChannelEnable=1
				arg24g.transmitPower=100
				if (arg24g.X_TP_PreSharedKey.length > 0){
					arg24g.IEEE11iEncryptionModes="AESEncryption";
					arg24g.WPAEncryptionModes="AESEncryption";
					arg24g.IEEE11iAuthenticationMode="PSKAuthentication";
					arg24g.WPAAuthenticationMode="PSKAuthentication";
					arg24g.beaconType="11i";
				}else{
					arg24g.beaconType="Basic";
					arg24g.basicEncryptionModes="None";
					arg24g.basicAuthenticationMode="None";
				}
			}
			$.qd.wl.arg24g=arg24g;
            if(!INCLUDE_USB_3G_DONGLE)
			    $.act(ACT_SET, LAN_WLAN, $.qd.wl.stack, null, arg24g);
			if (INCLUDE_LAN_WLAN_DUALBAND) {
				arg5g.enable = ($.qd.wl5g.en == true) ? 1 : 0;
				if (arg5g.enable == 1) {
					arg5g.SSID = $.qd.wl5g.ssid;
					arg5g.X_TP_PreSharedKey = $.qd.wl5g.pwd;
					arg5g.SSIDAdvertisementEnabled=1;
					arg5g.standard="ac";
					arg5g.X_TP_Bandwidth="Auto";
					arg5g.autoChannelEnable=1;
					arg5g.transmitPower=100;
					if (arg5g.X_TP_PreSharedKey.length > 0){
						arg5g.IEEE11iEncryptionModes="AESEncryption";
						arg5g.WPAEncryptionModes="AESEncryption";
						arg5g.IEEE11iAuthenticationMode="PSKAuthentication";
						arg5g.WPAAuthenticationMode="PSKAuthentication";
						arg5g.beaconType="11i";
					}else{
						arg5g.beaconType="Basic";
						arg5g.basicEncryptionModes="None";
						arg5g.basicAuthenticationMode="None";
					}
				}
				$.qd.wl.arg5g=arg5g;
                if(!INCLUDE_USB_3G_DONGLE)
				   $.act(ACT_SET, LAN_WLAN, $.qd.wl5g.stack, null, arg5g);
			}
            if(!INCLUDE_USB_3G_DONGLE)
            {
			  $.exe(function(err) {
				$.removeLoading();
				  if (err) {
					  bSettingStatus = 0;
					  $.alert(err);
					  return ;
				  }
				  /* This code structure may be a little strange for 'bSettingStatus' */
				  if (bSettingStatus == 2) {
				  /*	qsRemoveLoading();*/
				/*	$.removeLoading(); */
					  bSettingStatus = 3;
					  if (bNext == true)
						  $.qf.next();
					  else
						  goPrev();
				  }
				  else
					  bSettingStatus = 3;
			  });
           }
			bSettingStatus = 1;
		}
		else {
			if(!INCLUDE_USB_3G_DONGLE) {
			/* next page */
			$.qd.wl.wlParamsChanged = bParamsChanged;
			$.qf.next();
			}
		}

		if(INCLUDE_USB_3G_DONGLE) {
				/* next page */
		$.qd.wl.wlParamsChanged = bParamsChanged;
		$.qf.next();
		}
	}
}
function goPrev() {
	if (bParamsChanged == false) {
		doCollect();
		$.qf.prev();
	}
	else {
		switch (bSettingStatus) {
			case 0:
				break;
			case 1:
				bNext = false;
			/*	qsAddLoading();*/
				$.addLoading($("#next"));
				bSettingStatus++;
				break;
			case 2:
				break;
			case 3:
				$.removeLoading();
				$("#div_wlanNote").css("display", "none");
				$("#div_wlanSetting").fadeIn(200, function() {
					$(this).css("display", "block");
					init();
				});
				break;
			default:
				break;
		}
	}
}
$("input[name='radioPermit']").on("click.qswl", function() {
	if ($(this).prop("checked")) {
		$("#back").prop("disabled", false);
		$("#next").prop("disabled", false);
	} else {
		$("#back").prop("disabled", true);
		$("#next").prop("disabled", true);		
	}
});
</script>
<div id="quicksetup_wl_container">
	<div id="div_wlanSetting">
		<p id="t_wlSettingNote">You can rename your wireless network name and create your own password.</p>
		<div>
			<form id="form24G" class="pure-form pure-form-aligned">
				<div>
					<b class="T_gn24 l">2.4GHz Wireless:</b>
					<input type="checkbox" id="enWl24g"/>
					<label class="T_c_enWl">Enable Wireless Radio</label>
				</div>
				<div>
					<b class="T_c_ssid l">Wireless Network Name (SSID):</b>
					<input type="text" id="wl24gSSID" maxlength="32" class="xl"/>
				</div>
				<div>
					<b class="T_c_wlPwd l">Password:</b>
					<input type="text" id="wl24gPwd" maxlength="64" class="tp-input-text xl"/>
				</div>
				<div id="24gWarn">
					<label class="label-title"></label>
					<span></span>
				</div>
			</form>
		</div>
		<div style="margin-top: 40px;">
			<form id="form5G" class="pure-form pure-form-aligned nd">
				<div>
					<b class="T_gn5 l">5GHz Wireless:</b>
					<input type="checkbox" id="enWl5g" />
					<label class="T_c_enWl">Enable Wireless Radio</label>
				</div>
				<div>
					<b class="T_c_ssid l">Wireless Network Name (SSID):</b>
					<input type="text" id="wl5gSSID" maxlength="32" class="xl"/>
				</div>
				<div>
					<b class="T_c_wlPwd l">Password:</b>
					<input type="text" id="wl5gPwd" maxlength="64" class="tp-input-text xl"/>
				</div>
			</form>
		</div>
	</div>
	<div id="div_wlanNote" style="display: none;">
		<form class="pure-form pure-form-aligned">
			<div class="pure-control-group"  style="height:auto;">
				<p class="cfg-line" style="margin-bottom: 0.5em;"><span class="T" id="t_noteRejoin">Wireless settings have been changed successfully.Please use the following SSID and password for wireless connection.</span></p>
			</div>
			<div id="note_wl24g" style="margin-top: 28px;">
				<div id="note_wl24gEn" class="pure-control-group group-spec">
					<b class="T_gn24 l">2.4GHz Wireless:</b>
					<input type="text" readonly="ture" class="tp-input-text l" />
				</div>
				<div id="note_wl24gSSID" class="pure-control-group group-spec">
					<b class="T_c_ssid l">Wireless Network Name (SSID):</b>
					<input type="text" readonly="ture" class="tp-input-text xl" />
				</div>
				<div id="note_wl24gPwd" class="pure-control-group group-spec">
					<b class="T_c_wlPwd l">Password:</b>
					<input type="text" readonly="ture" class="tp-input-text xl" />
				</div>
			</div>
			<div id="note_wl5g" class="nd" style="margin-top: 28px;">
				<div id="note_wl5gEn" class="pure-control-group group-spec">
					<b class="T_gn5 l">5GHz Wireless:</b>
					<input type="text" readonly="ture" class="tp-input-text l" />
				</div>
				<div id="note_wl5gSSID" class="pure-control-group group-spec">
					<b class="T_c_ssid l">Wireless Network Name (SSID):</b>
					<input type="text" readonly="ture" class="tp-input-text xl" />
				</div>
				<div id="note_wl5gPwd" class="pure-control-group group-spec">
					<b class="T_c_wlPwd l">Password:</b>
					<input type="text" readonly="ture" class="tp-input-text xl" />
				</div>
			</div>
			<div style="margin-top: 50px;">
				<div style="margin-bottom: 16px;">
					<p class="cfg-line" id="t_permit">Please choose your current connection to continue:</p>
				</div>
				<input type="radio" id="btnPermitWireless" name="radioPermit" />
				<label id="t_permit_wireless">I have successfully reconnected to the router using the new wireless settings.</label>
				<input type="radio" id="btnPermitWired" name="radioPermit" />
				<label id="t_permit_wired">I am using wired connection.</label>
			</div>
		</form>
	</div>
</div>
<div class="inline-btn-right quicksetup-button-container">
    <div class="inline">
        <button type="submit" class="green T_back" id="back" onclick="goPrev()">Back</button>
    </div>
    <div class="inline">
        <button type="submit" class="green T_next" id="next" onclick="preGoNext()">Next</button>
    </div>
</div>
<script type="text/javascript" language="javascript">
var dmWlanList = {};
function init24g(wl24cfg) {	
	$("#wl24gSSID").val(wl24cfg.ssid);
	$("#wl24gPwd").val(wl24cfg.pwd);
	if (wl24cfg.en == 1)
		$("#enWl24g").attr("checked", true);
	else {
		$("#enWl24g").attr("checked", false);
		$("#wl24gSSID").attr("disabled", true);
		$("#wl24gPwd").attr("disabled", true);
	}
	$("#enWl24g").on("click", function() {
		doEnable24g($(this).prop("data-checked"));
	});
}
function init5g(wl5cfg) {	
	$("#wl5gSSID").val(wl5cfg.ssid);
	$("#wl5gPwd").val(wl5cfg.pwd);
	if (wl5cfg.en == 1)
		$("#enWl5g").attr("checked", true);
	else {
		$("#enWl5g").attr("checked", false);
		$("#wl5gSSID").attr("disabled", true);
		$("#wl5gPwd").attr("disabled", true);
	}
	$("#enWl5g").on("click", function() {
		doEnable5g($(this).prop("data-checked"));
	});
}
function init() {
	var err;

        var wlArg = {};
	var wl5gArg = {};

	if (INCLUDE_LAN_WLAN_DUALBAND) 
		$("#form5G").removeClass("nd");	
	
	dmWlanList = $.act(ACT_GL, LAN_WLAN, null, null, ["Enable", "SSID", "X_TP_Band", "X_TP_PreSharedKey","beaconType","basicEncryptionModes"]);
	err = $.exe();
	if (err) {
		$.alert(err);
		return ;
	}				
	$.each(dmWlanList, function() {
		if (this.X_TP_Band == "2.4GHz") {
			wlArg.stack = this.__stack;
			wlArg.en = this.enable == 1 ? true : false;
			wlArg.ssid = this.SSID;
			wlArg.pwd = "";
			if (this.beaconType != 'Basic' || this.basicEncryptionModes != 'None'){
				wlArg.pwd = this.X_TP_PreSharedKey;
			}
		}
		else if (INCLUDE_LAN_WLAN_DUALBAND && this.X_TP_Band == "5GHz") {
			wl5gArg.stack = this.__stack;
			wl5gArg.en = this.enable == 1 ? true : false;
			wl5gArg.ssid = this.SSID;
			wl5gArg.pwd = this.X_TP_PreSharedKey;
			wl5gArg.pwd = "";
			if (this.beaconType != 'Basic' || this.basicEncryptionModes != 'None'){
				wl5gArg.pwd = this.X_TP_PreSharedKey;
			}
		}
	});
	if (!$.qd.wl) $.qd.wl = wlArg;
	init24g($.qd.wl);
	if (INCLUDE_LAN_WLAN_DUALBAND)
	{
		if (!$.qd.wl5g) $.qd.wl5g =wl5gArg;
		init5g($.qd.wl5g);
	}
	bSettingStatus = 0;
	bParamsChanged = false;
	bNext = true;
}
(function() {
	$.tpInit(init);
})();
</script>