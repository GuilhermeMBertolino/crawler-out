<script language="javascript">function initInternetDiagPara(){step=1,bDiagFinished=!0,step3RetryCnt=20,step1RetryCnt=5,bStart=!1,internetDiagId=$.getAsync()}function doInternetDiag(){var e={};if($.checkAsync(internetDiagId))switch(step){case 1:lteLinkCfg=$.act(ACT_GET,WAN_LTE_LINK_CFG,lteLinkCfgStk,null,null),$.exe(function(e){if(e)return $.alert(e),void(bDiagFinished=!0);2==lteLinkCfg.connectStatus||3==lteLinkCfg.connectStatus||1==lteLinkCfg.connectStatus&&step1RetryCnt-- >0?($("#a_internetStatus").prop("value",m_str.detecting),setTimeout(doInternetDiag,1e3)):4==lteLinkCfg.connectStatus?(step++,doInternetDiag()):(bDiagFinished=!0,$("#a_internetStatus").prop("value",m_str.disconnected),ManualRefresh=1)});break;case 2:e=$.act(ACT_GET,DIAG_TOOL,null,null,["LastResult"]),$.exe(function(a){if(a)return $.alert(a),void(bDiagFinished=!0);if(step3RetryCnt--,3==e.lastResult)$("#a_internetStatus").prop("value",m_str.detecting),setTimeout(doInternetDiag,1e3);else if(1==bStart){if(1==e.lastResult)$("#a_internetStatus").prop("value",m_str.connected),ManualRefresh=1;else{if(step3RetryCnt>0)return step=2,bStart=!1,void doInternetDiag();$("#a_internetStatus").prop("value",m_str.disconnected),ManualRefresh=1}step++,bDiagFinished=!0}else $("#a_internetStatus").prop("value",m_str.detecting),bStart=!0,$.act(ACT_OP,ACT_OP_DIAG_STARTDIAG,e.__stack),$.exe(function(e){if(e)return $.alert(e),void(bDiagFinished=!0);setTimeout(doInternetDiag,1e3)})})}}function chg(e,a){$("#a_pdpType").prop(e,a),$("#a_pdpType").tpSelect({refresh:1}),$("#a_apnType0").prop(e,a),$("#a_apnType0").tpSelect({refresh:1}),$("#a_apn0").prop(e,a),$("#a_usrLte0").prop(e,a),$("#a_pwdLte0").prop(e,a),$("#a_authType0").prop(e,a),$("#a_authType0").tpSelect({refresh:1})}function showProfileList(e){$("#a_profile_list_sel").empty();for(var a=0,t=0;t<profileList.length;t++)if("NONE"!=profileList[t].profileName||1!=e.defaultProfile){a++;var n,l,i=t+1;t<e.defaultProfile?(l=$.htmlEncodeStr(profileList[t].profileName)+"("+s_str.defaultIndex+":"+i+")",n=$("<option></option>")):(l=$.htmlEncodeStr(profileList[t].profileName),n=$('<option class="selDelIcon"></option>')),n.val(profileList[t].profileID),n.text(l),$("#a_profile_list_sel").append(n)}$("#a_profile_list_sel option[value='"+profileList[e.activeProfile].profileID+"']").prop("selected","selected"),e.activeProfile<e.defaultProfile?(showApnType(0),chg("disabled",!0)):(showApnType(1),chg("disabled",!1)),0==a&&$("#a_profile_list_sel").prop("disabled",!0),$("#a_profile_list_sel").tpSelect({refresh:1}),$("select#a_profile_list_sel option").click(function(){var e=this.value;$.confirm(c_str.delProfile,function(){$.addLoading($("#save")),$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,["profileID="+e,"profileAction=3"]),$.exe(function(e){$.removeLoading(),$.reload()})},function(){})})}function showApnType(e){0==e?$("#a_ipv4ApnType").addClass("nd"):$("#a_ipv4ApnType").removeClass("nd")}function showProfileInfo(e){$("#a_pdpType option[value='"+e.pdpType+"']").prop("selected","selected"),$("#a_pdpType").tpSelect({refresh:1}),1!=e.pdpType?($("#a_apnType0 option[value='"+e.ipv4ApnType+"']").prop("selected","selected"),$("#a_apnType0").tpSelect({refresh:1}),$("#a_apn0").val(e.ipv4Apn),$("#a_usrLte0").val(e.ipv4Username),$("#a_pwdLte0").val(e.ipv4Password),$("#pw_ipv4 input").first().next().val(e.ipv4Password),$("#a_authType0 option[value='"+e.ipv4AuthType+"']").prop("selected","selected"),$("#a_authType0").tpSelect({refresh:1})):($("#a_apnType0 option[value='"+e.ipv6ApnType+"']").prop("selected","selected"),$("#a_apnType0").tpSelect({refresh:1}),$("#a_apn0").val(e.ipv6Apn),$("#a_usrLte0").val(e.ipv6Username),$("#a_pwdLte0").val(e.ipv6Password),$("#pw_ipv4 input").first().next().val(e.ipv6Password),$("#a_authType0 option[value='"+e.ipv6AuthType+"']").prop("selected","selected"),$("#a_authType0").tpSelect({refresh:1}))}function delProfile(){var e=$("#a_profile_list_sel").data("value"),a=0,t={},n=!1,l=wanCfg.activeProfile;if(!(e<wanCfg.defaultProfile)){for(a=0;a<profileList.length;a++)if(profileList[a].profileID==e){n=!0;break}0!=n&&(l==e&&(l=(l=0==l?1:0)>=profileList.length?0:l),t.profileID=e,t.activeProfile=l,t.profileAction=3,$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,t),$.addLoading($("#delBtn")),$.exe(function(e){$.removeLoading(),$.reload()}))}}function getSimStatus(){var e=$.act(ACT_GET,WAN_LTE_LINK_CFG,lteLinkCfgStk,null,null);return $.exe()?-1:e.simStatus}function init(){var e,a=$.act(ACT_GL,LTE_WAN_CFG,null,null,["dataSwitchStatusBackup"]),t=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]),n=0;if(!$.exe()){if($.each(t,function(){"LTE"==this.WANAccessType&&(e=this.__stack)}),$.each(a,function(){var a=$.stkPop(this.__stack,1);if(e==a)return wanCfgStk=this.__stack,lteLinkCfgStk=this.__stack,$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,["profileAction=4"]),wanCfg=$.act(ACT_GET,LTE_WAN_CFG,this.__stack,null,null),profileList=$.act(ACT_GL,LTE_PROFILE,null,null,null),n=1,!1}),0==n||$.exe())return!1;if(1==wanCfg.dataSwitchStatusBackup?$("#a_mdEn").addClass("selected"):$("#a_mdDis").addClass("selected"),1==wanCfg.roamingEnabled?$("#a_mrEn").addClass("selected"):$("#a_mrDis").addClass("selected"),1==wanCfg.NATEnabled?$("#a_mnEn").addClass("selected"):$("#a_mnDis").addClass("selected"),$("#a_network_mode_sel option[value='"+wanCfg.networkPreferredMode+"']").prop("selected","selected"),$("#a_netSel option[value='"+wanCfg.networkSelectionMode+"']").prop("selected","selected"),"undefined"!=typeof INCLUDE_LTE_SEARCH_BAND&&INCLUDE_LTE_SEARCH_BAND){$("#a_bandSel option[value='"+wanCfg.bandSelectSwitch+"']").prop("selected","selected"),"1"==wanCfg.networkSelectionMode?$("#search-network-btn").show():$("#search-network-btn").hide(),"1"==wanCfg.bandSelectSwitch?$("#search-band-btn").show():$("#search-band-btn").hide();var l=wanCfg.bandSelectedMaskL,i=wanCfg.bandSelectedMaskH,d=[];if(catType=wanCfg.catType,(wanCfg.networkPreferredMode==NET_PREF_MODE.G4_ONLY||wanCfg.networkPreferredMode==NET_PREF_MODE.G4_PREF)&&($("#bandSelect_div").removeClass("nd"),1==wanCfg.bandSelectSwitch&&(d=band_mask_to_band_list(l,i)).length>0)){var r=document.getElementById("bandlabel");$(r).css({fontWeight:"bold",display:"inline-block",width:"10em",whiteSpace:"normal"}),r.innerHTML="",$("#bandlabel").addClass("inline"),$("#bandlabel_div").addClass("inline"),$("#bandlabel").removeClass("nd"),$("#bandlabel_div").removeClass("nd"),$.each(d,function(){r.innerHTML=r.innerHTML+" B"+this}),$.isIE?r.innerHTML='"'+r.innerHTML.replace(/(^\s*)|(\s*$)/g,"")+'"':r.innerHTML='"'+r.innerHTML.trim()+'"'}}var s=document.getElementById("isplabel"),o=0;$(s).css({fontWeight:"bold",display:"inline-block",width:"10em",whiteSpace:"normal"}),"undefined"!=typeof INCLUDE_LTE_SEARCH_BAND&&INCLUDE_LTE_SEARCH_BAND?1==wanCfg.networkSelectionMode?($("#isplabel").addClass("inline"),$("#isplabel_div").addClass("inline"),$("#isplabel").removeClass("nd"),$("#isplabel_div").removeClass("nd"),s.innerHTML='"'+this.wanCfg.networkSelectionISP+'"'):($("#isplabel").removeClass("inline"),$("#isplabel_div").removeClass("inline"),$("#isplabel").addClass("nd"),$("#isplabel_div").addClass("nd")):1==wanCfg.networkSelectionMode&&(lteNetList=$.act(ACT_GL,LTE_NET_SEL_LIST,null,null,null),$.exe(),$.each(lteNetList,function(){10==this.itemStat&&(o=1,$("#isplabel").addClass("inline"),$("#isplabel_div").addClass("inline"),$("#isplabel").removeClass("nd"),$("#isplabel_div").removeClass("nd"),s.innerHTML='"'+this.ispName+'"')}),0==o&&($("#isplabel").removeClass("inline"),$("#isplabel_div").removeClass("inline"),$("#isplabel").addClass("nd"),$("#isplabel_div").addClass("nd"))),showProfileList(wanCfg),showProfileInfo(profileList[wanCfg.activeProfile]),profileList.length-wanCfg.defaultProfile>=MAX_PROFILE_NUM?$("#a_createProfile").addClass("nd"):$("#a_createProfile").removeClass("nd"),wanCfg.activeProfile<wanCfg.defaultProfile&&$("#delBtn").prop("disabled",!0),initInternetDiagPara(),doInternetDiag()}}function selectObj(e){e&&(e.focus(),e.select())}function isValidString(e){return!/\s/.test(e)&&!/['"]/.test(e)}function isValidLength(e){return e.length>0&&e.length<32}function checkParam(e){var a,t,n,l,i=$("#a_pdpType").data("value"),d=0;if(1!=i){if(a=$("#a_usrLte0").val(),t=$("#a_pwdLte0").val(),n=$("#a_apn0").val(),(l=$("#a_apnType0").data("value"))!=e.ipv4ApnType&&(d=1),0==l){if(!n)return $.alert(ERR_LTE_PROFILE_APN_EMPTY),selectObj($("#a_apn0")),-1;if(!isValidLength(n))return $.alert(ERR_LTE_PROFILE_APN_MAXLEN_ERROR),selectObj($("#a_apn0")),-1;if(!isValidString(n))return $.alert(ERR_LTE_PROFILE_APN_ILLEGAL_CHAR),selectObj($("#a_apn0")),-1;n!=e.ipv4Apn&&(d=1)}if(e.ipv4Username!=a){if(a){if(!isValidLength(a))return $.alert(ERR_LTE_PROFILE_USERNAME_MAXLEN_ERROR),selectObj($("#a_usrLte0")),-1;if(!isValidString(a))return $.alert(ERR_LTE_PROFILE_USERNAME_ILLEGAL_CHAR),selectObj($("#a_usrLte0")),-1}d=1}if(e.ipv4Password!=t){if(t){if(!isValidLength(t))return $.alert(ERR_LTE_PROFILE_PASSWORD_MAXLEN_ERROR),selectObj($("#a_pwdLte0")),-1;if(!isValidString(t))return $.alert(ERR_LTE_PROFILE_PASSWORD_ILLEGAL_CHAR),selectObj($("#a_pwdLte0")),-1}d=1}}if(0!=i){if(a=$("#a_usrLte0").val(),t=$("#a_pwdLte0").val(),n=$("#a_apn0").val(),(l=$("#a_apnType0").data("value"))!=e.ipv6ApnType&&(d=1),0==l){if(!n)return $.alert(ERR_LTE_PROFILE_APN_EMPTY),selectObj($("#a_apn0")),-1;if(!isValidLength(n))return $.alert(ERR_LTE_PROFILE_APN_MAXLEN_ERROR),selectObj($("#a_apn0")),-1;if(!isValidString(n))return $.alert(ERR_LTE_PROFILE_APN_ILLEGAL_CHAR),selectObj($("#a_apn0")),-1;n!=e.ipv6Apn&&(d=1)}if(e.ipv6Username!=$("#a_usrLte0").val()){if(a){if(!isValidLength(a))return $.alert(ERR_LTE_PROFILE_USERNAME_MAXLEN_ERROR),selectObj($("#a_usrLte0")),-1;if(!isValidString(a))return $.alert(ERR_LTE_PROFILE_USERNAME_ILLEGAL_CHAR),selectObj($("#a_usrLte0")),-1}d=1}if(e.ipv6Password!=$("#a_pwdLte0").val()){if(t){if(!isValidLength(t))return $.alert(ERR_LTE_PROFILE_PASSWORD_MAXLEN_ERROR),selectObj($("#a_pwdLte0")),-1;if(!isValidString(t))return $.alert(ERR_LTE_PROFILE_PASSWORD_ILLEGAL_CHAR),selectObj($("#a_pwdLte0")),-1}d=1}}return e.pdpType!=$("#a_pdpType").data("value")&&(d=1),1!=i?e.ipv4AuthType!=$("#a_authType0").data("value")&&(d=1):e.ipv6AuthType!=$("#a_authType0").data("value")&&(d=1),wanCfg.activeProfile!=activeProfile&&(d=1),d}function band_select_check(){var e=0,a=0,t=0;for(a=0;a<current_searched_band_list.length;a++)t=document.getElementById(a),1==$(t).prop("checked")&&e++,0==e?$.each($("#band-selection-container").find("button"),function(){$(this).find("span").html()==$.tpLang.m_str.save&&$(this).attr("disabled",!0)}):$.each($("#band-selection-container").find("button"),function(){$(this).find("span").html()==$.tpLang.m_str.save&&$(this).attr("disabled",!1)})}function band_list_to_band_mask(e){var a={},t=0;for(a.bandMaskLow=0,a.bandMaskHigh=0,t=0;t<e.length;t++)e[t]>0&&e[t]<=32?a.bandMaskLow|=1<<e[t]-1:e[t]>32&&e[t]<=64&&(a.bandMaskHigh|=1<<e[t]-32-1);return a}function checkBandSelectShow(){if("undefined"!=typeof INCLUDE_LTE_SEARCH_BAND&&INCLUDE_LTE_SEARCH_BAND){var e=$("#a_network_mode_sel").data("value");e!=NET_PREF_MODE.G4_ONLY&&e!=NET_PREF_MODE.G4_PREF||wanCfg.networkPreferredMode!=NET_PREF_MODE.G4_ONLY&&wanCfg.networkPreferredMode!=NET_PREF_MODE.G4_PREF?$("#bandSelect_div").addClass("nd"):$("#bandSelect_div").removeClass("nd")}}function band_mask_to_band_list(e,a){var t=[],n=0;if(e<=0&&a<=0)return t;if(e>0)for(n=0;n<32;n++)0!=(e>>n&1)&&(t[t.length]=n+1);if(a>0)for(n=0;n<32;n++)0!=(a>>n&1)&&(t[t.length]=n+1+32);return t}function prepareQuerySearch(){$("#isplabel").removeClass("inline"),$("#isplabel_div").removeClass("inline"),$("#isplabel").addClass("nd"),$("#isplabel_div").addClass("nd"),$("#load_text").tpModal("show"),$("#mode-selection").empty();$("#a_netSel").data("value");$.act(ACT_SET,LTE_NET_SEL,null,null,["searchAction=1"]),$.exe(),querySearch()}function querySearch(){if(retrys++,lteNetSel=$.act(ACT_GET,LTE_NET_SEL,null,null,null),$.exe(),$.exe(function(e){e&&$.alert(e)}),retrys<maxretryTimes&&0==lteNetSel.itemNum)setTimeout(querySearch,2e3);else if(retrys>=maxretryTimes)retrys=0,$("#load_text").tpModal("hide"),$.alert(ERR_LTE_NO_NET_SEARCH);else if(lteNetSel.itemNum>0){searched_flag=1,retrys=0,lteNetList=$.act(ACT_GL,LTE_NET_SEL_LIST,null,null,null),$.exe();var e=document.getElementById("mode-selection");NetSelIndex=0,$.each(lteNetList,function(){var a=document.createElement("DIV"),t=document.createElement("input"),n=document.createElement("label");switch(this.itemStat){case"-1":"(Invalid)";break;case"0":"(Unknown)";break;case"1":"(Available)";break;case"2":"(Current)";break;case"3":"(Forbidden)";break;default:"(Unknown)"}a.id="div"+NetSelIndex,a.className="pure-control-group",t.type="radio",t.name="topMode",t.id=NetSelIndex,n.id="label"+NetSelIndex,n.innerHTML=this.ispName,n.style.textAlign="center",n.style.width="16em",a.appendChild(t),a.appendChild(n),e.appendChild(a),NetSelIndex++}),$("#load_text").tpModal("hide"),$("#mode-selection").tpModal("show")}}function searchFunc(){if("undefined"!=typeof INCLUDE_LTE_SEARCH_BAND&&INCLUDE_LTE_SEARCH_BAND)modifyNetworkSearchMode();else if(0!=k){e=$("#a_netSel").data("value");if($("#isplabel").removeClass("inline"),$("#isplabel_div").removeClass("inline"),$("#isplabel").addClass("nd"),$("#isplabel_div").addClass("nd"),1==e){$("#load_text").tpModal("show");e=$("#a_netSel").data("value");(a={}).netSelType=e,$.act(ACT_SET,LTE_NET_SEL,null,null,a),$.exe(),querySearch()}else{var e=$("#a_netSel").data("value"),a={};a.netSelType=e,$.act(ACT_SET,LTE_NET_SEL,null,null,a),$.addLoading($(this)),$.exe(function(e){$.removeLoading($(this)),$.reload()})}}else k=1}function modifyNetworkSearchMode(){if(0!=k)if(1==$("#a_netSel").data("value"))$("#search-network-btn").show(),prepareQuerySearch();else{$("#search-network-btn").hide(),$("#isplabel").removeClass("inline"),$("#isplabel_div").removeClass("inline"),$("#isplabel").addClass("nd"),$("#isplabel_div").addClass("nd");$("#a_netSel").data("value");var e={};e.networkSelectionMode=0,e.networkSelectionMCC=0,e.networkSelectionMNC=0,e.networkSelectionISP="",$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,e),$.addLoading($(this)),$.exe(function(e){$.removeLoading($(this)),$.reload()})}else k=1}function modifyBandSelectMode(){if(0!=kk){var e={};if(1==$("#a_bandSel").data("value"))prepareQueryBand(),$("#search-band-btn").show();else{$("#a_band_sel").data("value");(e={}).bandSelectSwitch=0,e.bandSelectedMaskL=0,e.bandSelectedMaskH=0,$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,e),$.exe(),$.removeLoading(),$.reload()}}else kk=1}function prepareQueryBand(){$("#bandlabel").removeClass("inline"),$("#bandlabel_div").removeClass("inline"),$("#bandlabel").addClass("nd"),$("#bandlabel_div").addClass("nd"),$("#load_text").tpModal("show"),$("#band-selection").empty(),band_search_retrys=0,$.act(ACT_SET,LTE_BAND_SEL,null,null,["searchAction=1"]),$.exe(),bandSearchingFlag=1,queryBandSearch()}function queryBandSearch(){band_search_retrys++,lteBandSel=$.act(ACT_GET,LTE_BAND_SEL,null,null,null),$.exe(),$.exe(function(e){e&&(setTimeout(postQueryBand,2e3),$.alert(e))}),band_search_retrys<maxretryTimes&&lteBandSel.searchStatus==SEARCH_STATUS.MP_SEL_STAT_SEARCHING||lteBandSel.searchStatus==SEARCH_STATUS.MP_SEL_STAT_IDLE?searchBandTimer=setTimeout(queryBandSearch,2e3):lteBandSel.searchStatus==SEARCH_STATUS.MP_SEL_STAT_SEARCH_FAIL?setTimeout(postQueryBand,2e3):(lteBandSel.searchStatus,SEARCH_STATUS.MP_SEL_STAT_SEARCHED,setTimeout(postQueryBand,2e3))}function postQueryBand(){if(band_search_retrys=0,bandSearchingFlag=0,current_searched_band_list=band_mask_to_band_list(lteBandSel.bandSearchedMaskL,lteBandSel.bandSearchedMaskH),current_searched_band_pref_list=band_mask_to_band_list(lteBandSel.bandPrefMaskL,lteBandSel.bandPrefMaskH),0==current_searched_band_list.length)$("#load_text").tpModal("hide"),$.alert(ERR_LTE_NO_BAND_SEARCH);else{var e="",a=0,t=0;for(lteBandSel.ispName.length>0&&(e="("+lteBandSel.ispName+")"),a=current_searched_band_pref_list.length>0?current_searched_band_pref_list[0]:current_searched_band_list[0],t=0;t<current_searched_band_list.length;t++){var n=current_searched_band_list[t],l=current_searched_band_pref_list.indexOf(n),i=document.getElementById("band-selection"),d=document.createElement("DIV"),r=document.createElement("input"),s=document.createElement("label"),o=document.createElement("label");d.id="div"+t,d.className="pure-control-group",r.type="checkbox",r.name="topMode",r.id=t,r.onclick=band_select_check,n==a&&(r.checked=!0,$.each($("#band-selection-container").find("button"),function(){$(this).find("span").html()==$.tpLang.m_str.save&&$(this).attr("disabled",!1)})),s.id="lablel"+t,s.innerHTML="Band "+n,s.style.textAlign="left",s.style.width="4em",s.style.padding="0px 0px 0px 10px",o.innerHTML=l>=0?e:"",o.style.textAlign="left",o.style.width="15em",d.appendChild(r),d.appendChild(s),d.appendChild(o),i.appendChild(d)}if(catType==CAT_TYPE.CAT6){var _=$.tpLang.advanceLte_nstr.t_tip?$.tpLang.advanceLte_nstr.t_tip:"To enable a specific 4G+ carrier aggregation, select the corresponding bands.",i=document.getElementById("band-selection"),d=document.createElement("DIV"),s=document.createElement("label");d.id="div"+current_searched_band_list.length,d.className="pure-control-group",s.innerHTML=_,s.style.textAlign="left",s.style.lineHeight=1.5,s.style.width="20em",s.style.color="#c11c66",d.appendChild(s),i.appendChild(d)}$("#load_text").tpModal("hide"),$("#band-selection").tpModal("show")}}var wanCfg,lteLinkCfg,netSel,lteNetSel,lteNetList,NetSelIndex,wanCfgStk,lteLinkCfgStk,MAX_PROFILE_NUM=8,activeProfile=0,profileList=new Array,step=2,bDiagFinished=!0,step1RetryCnt,step3RetryCnt,ManualRefresh=0,bStart=!1,internetDiagId=$.getAsync(),lteBandSel,catType=0,current_searched_band_list=[],current_searched_band_pref_list=[],searchBandTimer,bandSearchingFlag=0,SEARCH_STATUS={MP_SEL_STAT_INVALID:-1,MP_SEL_STAT_IDLE:0,MP_SEL_STAT_REGISTERING:1,MP_SEL_STAT_REGISTERED:2,MP_SEL_STAT_SEARCHING:3,MP_SEL_STAT_SEARCHED:4,MP_SEL_STAT_SEARCH_FAIL:5,MP_SEL_STAT_REG_FAIL:6,MP_SEL_STAT_REG_DENIED:7,MP_SEL_STAT_SIM_ERROR:8,MP_SEL_STAT_SAVING:9,MP_SEL_STAT_SAVED:10,MP_SEL_STAT_CANCELLING:11,MP_SEL_STAT_CANCELLED:12,MP_SEL_STAT_FAIL_SMS:13},NET_PREF_MODE={G4_PREF:3,G4_ONLY:2,G3_ONLY:1},CAT_TYPE={CAT4:4,CAT6:6};$("select#a_profile_list_sel").click(function(){for(var e=$("#a_profile_list_sel").data("value"),a=0;a<profileList.length;a++)if(profileList[a].profileID==e){showProfileInfo(profileList[a]),a<wanCfg.defaultProfile?(showApnType(0),chg("disabled",!0),$("#delBtn").prop("disabled",!0)):(showApnType(1),chg("disabled",!1),$("#delBtn").prop("disabled",!1));break}}),$("select#a_apnType0").on("click.advanceLte",function(e){1==$("#a_apnType0").data("value")?$("#a_ipv4Apn").addClass("nd"):$("#a_ipv4Apn").removeClass("nd")}),$("#a_mdEn").on("click.advanceLte",function(e){$.addLoading($(this)),$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,["dataSwitchStatusBackup=1","profileAction=0"]),$.exe(function(e){e&&(1==wanCfg.dataSwitchStatusBackup?$("#a_mdEn").addClass("selected"):$("#a_mdDis").addClass("selected")),initInternetDiagPara(),doInternetDiag(),$.removeLoading()})}),$("#a_mdDis").on("click.advanceLte",function(e){$.addLoading($(this)),$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,["dataSwitchStatusBackup=0","profileAction=0"]),$.exe(function(e){e&&(1==wanCfg.dataSwitchStatusBackup?$("#a_mdEn").addClass("selected"):$("#a_mdDis").addClass("selected")),initInternetDiagPara(),doInternetDiag(),$.removeLoading()})}),$("#a_mrEn").on("click.advanceLte",function(e){$.addLoading($(this)),$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,["roamingEnabled=1","profileAction=0"]),$.exe(function(e){e&&(1==wanCfg.roamingEnabled?$("#a_mrEn").addClass("selected"):$("#a_mrDis").addClass("selected")),initInternetDiagPara(),doInternetDiag(),$.removeLoading()})}),$("#a_mrDis").on("click.advanceLte",function(e){$.addLoading($(this)),$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,["roamingEnabled=0","profileAction=0"]),$.exe(function(e){e&&(1==wanCfg.roamingEnabled?$("#a_mrEn").addClass("selected"):$("#a_mrDis").addClass("selected")),initInternetDiagPara(),doInternetDiag(),$.removeLoading()})}),$("#a_mnEn").on("click.advanceLte",function(e){$.addLoading($(this)),$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,["NATEnabled=1","profileAction=0"]),$.exe(function(e){e&&(1==wanCfg.NATEnabled?$("#a_mrEn").addClass("selected"):$("#a_mrDis").addClass("selected")),$.removeLoading()})}),$("#a_mnDis").on("click.advanceLte",function(e){$.addLoading($(this)),$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,["NATEnabled=0","profileAction=0"]),$.exe(function(e){e&&(1==wanCfg.NATEnabled?$("#a_mrEn").addClass("selected"):$("#a_mrDis").addClass("selected")),$.removeLoading()})}),$("#a_netSel").on("change",function(){}),$("#a_netSel").on("click",function(e){}),$("#mode-selection").tpModal({global:!0,confirmBtn:{str:$.tpLang.m_str.save,callback:function(){var e=0,a=0,t=0;for(l=document.getElementById("mode-selection"),e=0;e<NetSelIndex;e++)if(a=document.getElementById(e),1==$(a).prop("checked")){t=e;break}e=0,"undefined"!=typeof INCLUDE_LTE_SEARCH_BAND&&INCLUDE_LTE_SEARCH_BAND?$.each(lteNetList,function(){if(e==t){var a={};a.networkSelectionMCC=this.mcc,a.networkSelectionMNC=this.mnc,a.networkSelectionISP=this.ispName,a.networkSelectionMode=1,$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,a),$.exe()}e++}):$.each(lteNetList,function(){e==t&&($.act(ACT_SET,LTE_NET_SEL_LIST,this.__stack,null,["itemStat=10"]),$.exe()),e++});var n=document.getElementById("mode-selection");for(e=NetSelIndex-1;e>=0;e--){var l=document.getElementById("div"+e);n.removeChild(l)}$.removeLoading(),$.reload()},disabled:!1},cancelBtn:{show:!1},closeIcon:{show:!0,callback:function(){$("#mode-selection").empty(),$.removeLoading(),$.reload()}}}),$("#load_text").tpModal({global:!0,confirmBtn:{disabled:!0,show:!1},cancelBtn:{disabled:!0,show:!1},closeIcon:{show:!1,callback:null}}),$("#band-selection").tpModal({global:!0,confirmBtn:{str:$.tpLang.m_str.save,callback:function(){var e=0,a=0;d=document.getElementById("band-selection");var t=[],n={},l={};for(e=0;e<current_searched_band_list.length;e++)a=document.getElementById(e),1==$(a).prop("checked")&&(t[t.length]=current_searched_band_list[e]);if(!(t.length>0))return!1;n=band_list_to_band_mask(t),l.bandSelectSwitch=1,l.bandSelectedMaskL=n.bandMaskLow,l.bandSelectedMaskH=n.bandMaskHigh,$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,l),$.exe();var i=document.getElementById("band-selection");for(e=current_searched_band_list.length-1;e>=0;e--){d=document.getElementById("div"+e);i.removeChild(d)}if(catType==CAT_TYPE.CAT6){var d=document.getElementById("div"+current_searched_band_list.length);i.removeChild(d)}$.removeLoading(),$.reload()},disabled:!1},cancelBtn:{show:!1},closeIcon:{show:!0,callback:function(){$("#band-selection").empty(),$.removeLoading(),$.reload()}}});var retrys=0,maxretryTimes=30,searched_flag=0,band_search_retrys=0,band_search_debug=0,k=0,kk=0;window.onbeforeunload=function(){if(1==bandSearchingFlag){var e=window.navigator.userAgent.indexOf("Chrome")>-1;$.act(ACT_SET,LTE_BAND_SEL,null,null,["searchAction=3"]);e?$.exe(function(){}):$.exe()}},$("#search-network-btn").on("click",function(){prepareQuerySearch()}),$("#search-band-btn").on("click",function(){prepareQueryBand()}),$("#saveBtn").click(function(){var e=$("#a_profile_list_sel").data("value"),a={},t=0,n={},l=!1,i=!1,d={},r=$("#a_network_mode_sel").data("value"),s=$("#a_netSel").data("value");if(wanCfg.networkPreferredMode!=r){var o=getSimStatus();if("3"!=o&&"5"!=o)return $("#a_network_mode_sel option[value='"+wanCfg.networkPreferredMode+"']").prop("selected","selected"),$("#a_network_mode_sel").tpSelect({refresh:1}),$.alert(ERR_LTE_NTWKNODE_CARD_NOTOK),!1;n.networkPreferredMode=r,l=!0}for(t=0;t<profileList.length;t++)if(profileList[t].profileID==e){a=profileList[t],activeProfile=t;break}if(t<profileList.length){var _=checkParam(a);if(1==_)n.profileID=a.profileID,n.profileName=a.profileName,n.pdpType=$("#a_pdpType").data("value"),1!=n.pdpType&&(n.ipv4ApnType=$("#a_apnType0").data("value"),0==n.ipv4ApnType?n.ipv4Apn=$("#a_apn0").val():n.ipv4Apn="",n.ipv4Username=$("#a_usrLte0").val(),n.ipv4Password=$("#a_pwdLte0").val(),n.ipv4AuthType=$("#a_authType0").data("value")),0!=n.pdpType&&(n.ipv6ApnType=$("#a_apnType0").data("value"),0==n.ipv6ApnType?n.ipv6Apn=$("#a_apn0").val():n.ipv6Apn="",n.ipv6Username=$("#a_usrLte0").val(),n.ipv6Password=$("#a_pwdLte0").val(),n.ipv6AuthType=$("#a_authType0").data("value")),n.profileAction=1,n.activeProfile=activeProfile,l=!0;else if(-1==_)return!1}"undefined"!=typeof INCLUDE_LTE_SEARCH_BAND&&INCLUDE_LTE_SEARCH_BAND?l&&($.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,n),$.addLoading($(this)),$.exe(function(e){$.removeLoading(),$.reload()})):(s!=wanCfg.networkSelectionMode&&(i=!0,d.netSelType=s),l&&!i?($.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,n),$.addLoading($(this)),$.exe(function(e){$.removeLoading(),$.reload()})):!l&&i?($.act(ACT_SET,LTE_NET_SEL,null,null,d),$.addLoading($(this)),$.exe(),0==s?($.removeLoading(),$.reload()):querySearch()&&($.removeLoading(),$.reload())):l&&i&&($.addLoading($(this)),$.act(ACT_SET,LTE_WAN_CFG,wanCfgStk,null,n),$.act(ACT_SET,LTE_NET_SEL,null,null,d),$.exe(),0==s?($.removeLoading(),$.reload()):querySearch()&&(alert("error!"),$.removeLoading(),$.reload())))}),$("#t_createProfileBtn").click(function(){$.loadMain("lteProfileAdd.htm")}),$("#createProfileIcon").click(function(){$.loadMain("lteProfileAdd.htm")}),$("#delBtn").click(function(){$.confirm(c_str.delProfile,delProfile,function(){},"","Yes","No")})</script>

<h3 id="t_sett">WAN Interface</h3>

<div class="content-container">
    <form class="pure-form pure-form-aligned">
		<div class="pure-control-group">
             <b class="xl T_internetStatus" id="a_netstatus">Internet Status:</b>
            <input type="text" readonly="ture" class="tp-input-text xl" id="a_internetStatus">
        </div>

        <div class="button-group-container" id="a_mobileDataSwitch">
            <b class="xl T_mobileData">Mobile Data:</b>
            <ul><li><button id="a_mdEn" class="fst" value="on">On</button></li>
                <li><button id="a_mdDis" class="lst" value="off">Off</button></li>
            </ul>
        </div>
        <div class="button-group-container" id="a_mobileRoamingSwitch">
            <b class="xl T_mobileRoaming">Data Roaming:</b>
            <ul><li><button id="a_mrEn" class="fst" value="on">On</button></li>
                <li><button id="a_mrDis" class="lst" value="off">Off</button></li>
            </ul>
        </div>

		<div class="button-group-container" id="a_natSwitch">
			<b class="xl T_ennat">NAT:</b>
            <ul><li><button id="a_mnEn" class="fst" value="on">On</button></li>
                <li><button id="a_mnDis" class="lst" value="off">Off</button></li>
			</ul>
        </div>

        <div><b class="xl T_networkMode">Network Mode:</b>
            <select id="a_network_mode_sel" class="lte" onclick="checkBandSelectShow()">
                <option value="3" class="T_Preferred4g">4G Preferred</option>
                <option value="2" class="T_only4g">4G Only</option>
                <option value="1" class="T_only3g">3G Only</option>
            </select>
        </div>

		<div id="bandSelect_div" style="white-space:nowrap" class="nd"><b class="xl T_bandMode">Band:</b>
			<select id="a_bandSel" class="inline" onclick="modifyBandSelectMode()">
				<option value="0" selected="selected" id="t_auto">Auto</option>
				<option value="1" id="t_manual">Manual</option>
			</select>
			<button type="submit" id="search-band-btn" class="green inline T_band_search_btn" style="margin-left:10px">Search</button>
			<div id="bandlabel_div" class="nd" style="">
				<label class="blue inline" id="bandlabel">band name</label>
			</div>
		</div>

        <div><p></p><label class="label-title l T_dialupSet" style="font-weight:700">Dial-up Settings</label><p></p></div>



		<div class="inline" style="white-space:nowrap"><b class="xl T_network_search">Network Search:</b>
			<select id="a_netSel" class="lte" onclick="searchFunc()">
				<option value="0" selected="selected" id="t_autosec">Auto</option>
                <option value="1" id="t_manualsec">Manual</option>
			</select>

	

		
			<button type="submit" id="search-network-btn" class="green inline T_network_search_btn" style="margin-left:10px;display:none">Search</button>
			<div id="isplabel_div" class="nd" style="">
				<label class="blue inline" id="isplabel">ISPNAME</label>
			</div>
        </div>



        <div class="divCp"><b class="xl T_profileName">Profile Name:</b>
            <select id="a_profile_list_sel" class="lte"></select>
        </div>

        <div class="divCp"><b class="xl T_pdpType">PDP Type:</b>
            <select id="a_pdpType" class="lte">
                <option value="0">IPv4</option>
                <option value="1">IPv6</option>
                <option value="2">IPv4 & IPv6</option>
            </select>
        </div>

        <div>
			<div id="a_ipv4ApnType" class="divCp"><b id="a_ipv4ApnType_b" class="xl T_lteApnType">APN Type:</b>
                <select id="a_apnType0" class="lte">
                    <option value="0">Static</option>
                    <option value="1" selected="selected">Dynamic</option>
                </select>
            </div>
            <div id="a_ipv4Apn" class="divCp"><b class="xl T_lteApn">APN:</b>
                    <input type="text" class="lte" id="a_apn0" maxlength="31">
            </div>
            <div class="divCp"><b class="xl T_lteUsername">Username:</b>
                    <input type="text" class="lte" id="a_usrLte0" maxlength="31">
            </div>
            <div class="divCp" id="pw_ipv4"><b class="xl T_ltePassword">Password:</b>
                    <input type="password" class="lte" id="a_pwdLte0" maxlength="31">
            </div>

            <div class="divCp"><b class="xl T_lteAuthType">Authentication Type:</b>
                <select id="a_authType0" class="lte">
                    <option value="0">NONE</option>
                    <option value="1">PAP </option>
                    <option value="2">CHAP</option>
                </select>
            </div>
        </div>

        <div class="part-separate" id="a_createProfile">
            <div class="createProfile inline" id="createProfileIcon"></div>
            <span class="inline" id="t_createProfileBtn" style="color:#10abe1;border-bottom:#10abe1 solid 1px;cursor:pointer;vertical-align:baseline">Create Profile</span>
            <span id="t_cinfo">&nbsp;&nbsp;&nbsp;&nbsp;If the dial-up setting is incorrect, please click here to configure manually. At most 8 profiles can be added.</span>
        </div>
        <br>
        <br>
        <div style="text-align:right" class="part-separate">
        	<button type="submit" class="green inline T_del" id="delBtn">Delete</button>
            <button type="submit" class="green inline T_save" id="saveBtn">Save</button>
        </div>
    </form>



		 <div id="load_text" style="text-align:center">
			<div id="t_searching" style="position:relative;margin-top:auto;margin-left:auto;font-size:20px">Searching...</div>
		 	<div id="loading_gif" style="background:url(../img/waiting.gif) no-repeat;width:39px;height:39px;display:inline_block;margin:26px auto -18px auto">  </div>
        </div>
		<div id="mode-selection" class="pure-form-aligned"></div>
		<div id="band-selection" class="pure-form-aligned"></div>

</div>

<script>$(document).ready(function(){$.tpInit(init)})</script>
