<script language="javascript">function showL2TP(){$("#l2tp_elem_basic").removeClass("nd"),$("#l2tp_mtu_msg").removeClass("nd")}function initEditL2tp(){var e=$.wd.conn[$.wd.editIndex].obj;$("#ppp_username").val(e.username),$("#ppp_pwd").val(e.password),$("#ppp_pwd").next("input").val(e.password),$("#srvAddrName").val(e.serverIpOrName),"DHCP"==e.addressingType?($("#ipType_stc").prop("checked",!1),$("#ipType_stc").data("tpRadio").refresh(),$("#ipType_dyn").prop("checked",!0),$("#ipType_dyn").data("tpRadio").refresh(),$("#l2tp_dyn_ip_elem").removeClass("nd"),$("#l2tp_stc_ip_elem").addClass("nd"),$("#isp_ip_dyn").html(e.externalIPAddressIP?e.externalIPAddressIP:"0.0.0.0"),$("#isp_net_mask_dyn").html(e.subnetMaskIP?e.subnetMaskIP:"0.0.0.0"),$("#isp_gw_dyn").html(e.defaultGatewayIP?e.defaultGatewayIP:"0.0.0.0"),$("#isp_dns_1_dyn").html(e.DNSServersIP.split(",")[0]?e.DNSServersIP.split(",")[0]:"0.0.0.0"),$("#isp_dns_2_dyn").html(e.DNSServersIP.split(",")[1]?e.DNSServersIP.split(",")[1]:"0.0.0.0")):"Static"==e.addressingType&&($("#ipType_dyn").prop("checked",!1),$("#ipType_dyn").data("tpRadio").refresh(),$("#ipType_stc").prop("checked",!0),$("#ipType_stc").data("tpRadio").refresh(),$("#l2tp_stc_ip_elem").removeClass("nd"),$("#l2tp_dyn_ip_elem").addClass("nd"),$("#isp_ip_stc").tpAddress("val",e.externalIPAddressIP),$("#isp_net_mask_stc").tpAddress("val",e.subnetMaskIP),$("#isp_gw_stc").tpAddress("val",e.defaultGatewayIP?e.defaultGatewayIP:"0.0.0.0"),$("#isp_dns_1_stc").tpAddress("val",e.DNSServersIP.split(",")[0]?e.DNSServersIP.split(",")[0]:"0.0.0.0"),$("#isp_dns_2_stc").tpAddress("val",e.DNSServersIP.split(",")[1]?e.DNSServersIP.split(",")[1]:"0.0.0.0")),$("#internet_ip").html(e.externalIPAddress),$("#internet_dns_1").html(e.DNSServers.split(",")[0]?e.DNSServers.split(",")[0]:"0.0.0.0"),$("#internet_dns_2").html(e.DNSServers.split(",")[1]?e.DNSServers.split(",")[1]:"0.0.0.0"),$("#l2tp_mtu").val(e.maxMRUSize),$("#da_connOnDemand").prop("checked",!1),$("#da_connAlwaysOn").prop("checked",!1),$("#da_connManual").prop("checked",!1),$("#da_connOnDemand").data("tpRadio").refresh(),$("#da_connAlwaysOn").data("tpRadio").refresh(),$("#da_connManual").data("tpRadio").refresh(),"OnDemand"==e.connectionTrigger?($("#da_connOnDemand").prop("checked",!0),$("#da_connOnDemand").data("tpRadio").refresh(),$("#da_maxIdle-container").removeClass("nd")):"AlwaysOn"==e.connectionTrigger?($("#da_connAlwaysOn").prop("checked",!0),$("#da_connAlwaysOn").data("tpRadio").refresh(),$("#da_maxIdle-container").addClass("nd")):"Manual"==e.connectionTrigger&&($("#da_connManual").prop("checked",!0),$("#da_connManual").data("tpRadio").refresh(),$("#da_maxIdle-container").removeClass("nd")),$("#da_idleTime").val(e.idleDisconnectTime)}function initL2TP(){showL2TP(),dftGtw=$("#defaut_gateway_l2tp"),"l2tp"==$.wd.conn[$.wd.editIndex].type?initEditL2tp():($("#da_connAlwaysOn").prop("checked",!0),$("#da_connAlwaysOn").data("tpRadio").refresh(),$("#da_maxIdle-container").addClass("nd"));var e,a=$.act(ACT_GL,L2_BRIDGING_ENTRY,null,null,["bridgeName"]);$.exe()||($.each(a,function(){"Default"==this.bridgeName&&(e=this.__stack)}),lanIPv4Cfg=$.act(ACT_GS,LAN_IP_INTF,null,this.__stack,["IPInterfaceIPAddress","IPInterfaceSubnetMask","X_TP_MACAddress"]),$.exe()),initDefaultGwDNS(),$("#divMacClone").removeClass("nd")}function addL2tpAttrs(){if(wanArg.username=$("#ppp_username").val(),wanArg.password=$("#ppp_pwd").val(),""==$("#srvAddrName").val())return $.alert(ERR_WAN_DA_SERVER_NAME_EMPTY),$("#srvAddrName").focus().select(),!1;if(wanArg.serverIpOrName=$("#srvAddrName").val(),$("#ipType_stc").prop("checked")){var e=$("#isp_ip_stc").tpAddress("val"),a=$("#isp_net_mask_stc").tpAddress("val"),s=$("#isp_gw_stc").tpAddress("val");if(wanArg.addressingType="Static",$.ifip(e)||$.mask(a)||$.ipmask(e,a))return!1;if(wanArg.externalIPAddressIP=$.ip2ip(e),wanArg.subnetMaskIP=$.ip2ip(a),""==s||"0.0.0.0"!=s&&$.ifip(s,!0))return $.alert(ERR_IP_FORMAT),$("#isp_gw_stc").tpAddress("focus"),!1;if("0.0.0.0"==s||!$.isSameLan(s,a,e,a))return $.alert(ERR_GATEWAY_INVAD),$("#isp_gw_stc").tpAddress("focus"),!1;wanArg.defaultGatewayIP=$.ip2ip(s);var n=$("#isp_dns_1_stc").tpAddress("val"),d=$("#isp_dns_2_stc").tpAddress("val"),t="";if($.ifip(n,!0))return $.alert(ERR_WAN_DNSADDR_INVAD),$("#isp_dns_1_stc").tpAddress("focus"),!1;if(""!=n&&"0.0.0.0"!=n&&$.ifip(n,!0))return $.alert(ERR_WAN_DNSADDR_INVAD),$("#isp_dns_1_stc").tpAddress("focus"),!1;if(""!=n&&"0.0.0.0"!=n&&$.isSameLan(n,lanIPv4Cfg[0].IPInterfaceSubnetMask,lanIPv4Cfg[0].IPInterfaceIPAddress,lanIPv4Cfg[0].IPInterfaceSubnetMask))return $.alert(ERR_WAN_DNSADDR_LAN_CONFLICT),$("#isp_dns_1_stc").tpAddress("focus"),!1;if(""!=d&&"0.0.0.0"!=d&&$.ifip(d,!0))return $.alert(ERR_WAN_SECDNS_INVAD),$("#isp_dns_2_stc").tpAddress("focus"),!1;if(""!=d&&"0.0.0.0"!=d&&$.isSameLan(d,lanIPv4Cfg[0].IPInterfaceSubnetMask,lanIPv4Cfg[0].IPInterfaceIPAddress,lanIPv4Cfg[0].IPInterfaceSubnetMask))return $.alert(ERR_WAN_DNSADDR_LAN_CONFLICT),$("#isp_dns_2_stc").tpAddress("focus"),!1;if(n=n?$.ip2ip(n):"0.0.0.0",d=d?$.ip2ip(d):"0.0.0.0",t=n+","+d,wanArg.DNSServersIP=t,$.ifip(wanArg.serverIpOrName,!0)&&"0.0.0.0"==n&&"0.0.0.0"==d)return $.alert(ERR_WAN_DA_DNS_EMPTY),$("#isp_dns_1_stc").tpAddress("focus"),!1}else wanArg.addressingType="DHCP";if(!($("#l2tp_mtu").val()>=576&&$("#l2tp_mtu").val()<=1500))return $.alert(ERR_WAN_MTU_INVAD),$("#l2tp_mtu").focus().select(),!1;if(wanArg.maxMRUSize=parseInt($("#l2tp_mtu").val(),10),$("#da_connAlwaysOn").prop("checked"))wanArg.connectionTrigger="AlwaysOn";else{if(!$("#da_idleTime").val()||!$.isnum($("#da_idleTime").val()))return $.alert(ERR_IDLETIME_INVAD),$("#da_idleTime").focus().select(),!1;wanArg.idleDisconnectTime=parseInt($("#da_idleTime").val(),10),1==$("#da_connOnDemand").prop("checked")?wanArg.connectionTrigger="OnDemand":1==$("#da_connManual").prop("checked")&&(wanArg.connectionTrigger="Manual")}return"l2tp"==$.wd.conn[$.wd.editIndex].type&&($.wd.l3ForwardingObj.__ifAliasName=dftGtw.data("text")),!0}function showDyn(){$("#l2tp_dyn_ip_elem").removeClass("nd"),$("#l2tp_stc_ip_elem").addClass("nd")}function showStc(){$("#l2tp_stc_ip_elem").removeClass("nd"),$("#l2tp_dyn_ip_elem").addClass("nd")}var lanIPv4Cfg={};$("#da_connAlwaysOn").click(function(e){$("#da_maxIdle-container").addClass("nd")}),$("#da_connOnDemand").click(function(e){$("#da_maxIdle-container").removeClass("nd")}),$("#da_connManual").click(function(e){$("#da_maxIdle-container").removeClass("nd")})</script>

<div id="l2tp_elem_basic" class="nd">
	<div><b class="T_username">Username:</b>
		<input type="text" size="15" id="ppp_username" maxlength="255" class="xl">
	</div>
	<div><b class="T_passwd">Password:</b>
		<input type="password" size="15" id="ppp_pwd" maxlength="255" class="xl">
	</div>

	<div><b id="t_addrType">test Type:</b>   
		<input type="radio" name="ipType" id="ipType_dyn" onclick="showDyn()" checked="checked">
		<label class="T_dynip">Dynamic IP</label>
		<input type="radio" name="ipType" id="ipType_stc" onclick="showStc()">
		<label class="T_staip">Static IP</label>
	</div>

	<div><b class="T_srvIpName">Server IP Address/Name:</b>
		<input type="text" size="15" id="srvAddrName" maxlength="80">
	</div>
	<div id="l2tp_dyn_ip_elem">
		<div class="pure-control-group cfg-line">
			<label class="label-title T_ipaddr" id="isp_ip_addr">IP Address:</label>
			<span class="text" id="isp_ip_dyn">0.0.0.0</span>
		</div>
		<div class="pure-control-group cfg-line">
			<label class="label-title T_netmask" id="isp_subnet_mask">Subnet Mask:</label>
			<span class="text" id="isp_net_mask_dyn">0.0.0.0</span>
		</div>
		<div class="pure-control-group cfg-line">
			<label class="label-title T_gateway" id="isp_gateway">Gateway:</label>
			<span class="text" id="isp_gw_dyn">0.0.0.0</span>
		</div>
		<div class="pure-control-group cfg-line">
			<label class="label-title" id="t_dns">DNS Server:</label>   
			<span class="text" id="isp_dns_1_dyn">0.0.0.0</span>
			<span class="text" id="isp_dns_2_dyn">0.0.0.0</span>
		</div>
	</div>
	<div id="l2tp_stc_ip_elem" class="nd">
		<div><b class="T_ipaddr">IP Address:</b>
			<input type="text" id="isp_ip_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
		</div>
		<div><b class="T_netmask">Subnet Mask:</b>
			<input type="text" id="isp_net_mask_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
		</div>
		<div><b class="T_gateway">Gateway:</b>
			<input type="text" id="isp_gw_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
		</div>
		<div><b id="t_primdns">Primary DNS:</b>  
			<input type="text" id="isp_dns_1_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
		</div>
		<div><b id="t_secdns">Secondary DNS:</b>  
			<input type="text" id="isp_dns_2_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
			<span class="T_optional">(Optional)</span>
		</div>
	</div>
	<p class="br"></p>
	<div class="pure-control-group cfg-line">
		<label class="label-title T_ipaddr" id="internet_ip_addr">Internet IP Address:</label>
		<span class="text" id="internet_ip">0.0.0.0</span>
	</div>
	<div class="pure-control-group cfg-line">
		<label class="label-title" id="t_internet_dns">Internet DNS:</label>
		<span class="text" id="internet_dns_1">0.0.0.0</span>
		<span class="text" id="internet_dns_2">0.0.0.0</span>
	</div>
	<p class="br"></p>
	<div>
        <b class="T_defgw">Default Gateway:</b>
        <select id="defaut_gateway_l2tp" class="l"></select>
    </div>
	<div>
		<div id="l2tp_mtu_msg">
			<b class="T_mtuSize">MTU Size:</b>
			<input type="text" id="l2tp_mtu" size="5" maxlength="4" value="1460">
			<div class="textbox-tips">
				<span class="T_mtu1460">1460 as default</span>,
				<span class="T_nochg">do not change unless necessary</span>
			</div>
		</div>
	</div>

	<div><b class="T_connmode">Connection Mode:</b>
		<input type="radio" name="linkMode" id="da_connAlwaysOn">
		<label class="T_typeauto">Always on</label>
		<input type="radio" name="linkMode" id="da_connOnDemand">
		<label class="T_typedemand">Connect on demand</label>
		<input type="radio" name="linkMode" id="da_connManual">
		<label class="T_typemanual">Connect manually</label>
	</div>
	<div id="da_maxIdle-container">
		<b class="T_midle">Max Idle Time:</b>
		<input type="text" id="da_idleTime" size="3" maxlength="2" value="15" class="s">
		<div class="textbox-tips">
			<span class="T_minutes">minutes.</span>
			<span class="T_zmean">(0 means always active.)</span>
		</div>
	</div>
</div>

<script language="JavaScript">$.tpInit(initL2TP)</script>

