(function(a){a.su.Widget("grid",{defaults:{columns:[],store:null,operation:null,sortable:false,paging:null,editor:null,update:"operation",autoRefresh:false,refreshDuration:500,minLines:0,maxLines:0,rows:[],promptTextSuccessed:a.su.CHAR.OPERATION.GRID_SAVED,promptTextFailed:a.su.CHAR.OPERATION.GRID_FAILED,noneSelectedMsgText:a.su.CHAR.OPERATION.GRID_NONE_SELECT,deleteConfirmMsgText:a.su.CHAR.OPERATION.GRID_DELETE_COMFIRM,maxRulesMsgText:a.su.CHAR.OPERATION.GRID_MAX_RULES,deleteAllConfirmMsgText:a.su.CHAR.OPERATION.GRID_DELETE_ALL_COMFIRM,maxRulesProperty:"max_rules",showPrompt:true},create:function(g,d){var e=this;e.each(function(p,o){var q=a(o);a.extend(this,g,d);o.id=o.id||a.su.randomId("gird");if(!o.isPanel){a(o).panel(d).addClass("grid-panel")}var n=this.columns;if(n.length===0){return false}var l="";if(o.sortable){l='<button class="grid-header-btn btn-sort"></button>'}var k='<style type="text/css">';var j='<div class="container grid-container">';j+='<div class="container grid-header-container">';j+='<table border="0" cellspacing="0" cellpadding="0">';j+='<tr class="grid-header-tr">';for(var r=0;r<n.length;r++){var m=n[r];m.cls=m.cls||"",m.dataIndex=m.dataIndex||m.name||"",m.renderer=m.renderer||function(i){return a.su.func.escapeHtml(i)};if(m.width){k+="div#"+o.id+" th.grid-header-"+r+",";k+="div#"+o.id+" td.grid-content-td-"+r;k+="{width:"+m.width+"px;}"}var t="";switch(m.xtype){case"checkcolumn":t+='<div class="checkbox-group-container grid-header-checkbox checkcolumn inline">';t+='<div class="widget-wrap">';t+='<label class="checkbox-label">';t+='<input class="checkbox-checkbox" type="checkbox" value=""/>';t+='<span class="icon"></span>';t+="</label>";t+="</div>";t+="</div>";m.text=m.text||"";m.name=m.name||"select";break;case"rownumberer":m.text=m.text||a.su.CHAR.GRID.ID;m.name=m.name||"seq";break;case"settings":m.text=m.text||a.su.CHAR.GRID.MODIFY;m.name=m.name||"settings";break;case"statuscolumn":m.text=m.text||a.su.CHAR.GRID.STATUS;m.dataIndex=m.dataIndex||"status";m.name=m.name||m.dataIndex;break;default:m.text=m.text||"";m.name=m.name||m.dataIndex}j+='<th class="grid-header grid-header-'+r+" "+m.dataIndex+(r==n.length-1?" lst":"")+'" name="'+m.dataIndex+'">';j+=t;j+='<span class="content '+m.xtype+'">'+m.text+"</span>";j+=l;j+="</th>"}j+="</tr>";j+="</table>";j+="</div>";j+='<div class="grid-content-container-outer">';j+='<div class="grid-content-container">';j+='<table border="0" cellspacing="0" cellpadding="0">';j+='<tbody class="grid-content-data">';j+="</tbody>";j+="</table>";j+="</div>";j+="</div>";j+="</div>";var h=a(j);a(o).find("div.panel-content-container").append(h);h.find("tbody.grid-content-data").append(e.grid("initEmptyRow"));k+="div#"+o.id+" div.grid-content-container{";var s=h.find("tr.grid-content-tr").outerHeight()+1;if(o.minLines){k+="min-height:"+o.minLines*s+"px;"}if(o.maxLines){k+="max-height:"+(o.maxLines-1+o.maxLines*s)+"px;";h.addClass("allow-scroll")}k+="}";k+="</style>";h.prepend(a(k));if(!o.store){return null}else{if(!o.store.isStore){o.store=new a.su.Store(o.store)}}this.isGrid=true;if(o.operation){q.grid("initTBar")}if(o.editor){q.grid("initEditor")}if(o.paging){q.grid("initPaging")}});var f=e.get(0),c=f.store;f.rows=[];if(c.updateMode=="operation"){a(c).on("ev_insertdata",function(j,h,i){e.grid("insert",h,i);e.find("tr.grid-content-tr.add").remove();e.find("tr.grid-content-tr.empty").remove()}).on("ev_loaddata",function(j,i,h){if(e.grid("isEditing")){a(f.editor).editor("cancelEdit")}e.grid("load",i);if(h){var k=h[f.maxRulesProperty];f.maxRules=k||0}}).on("ev_updatedata",function(k,i,h,j){e.grid("update",i,h,j)}).on("ev_removedata",function(j,h,i){e.grid("remove",h)})}else{a(c).on("ev_loaddata",function(j,i,h){if(e.grid("isEditing")){a(f.editor).editor("cancelEdit")}e.grid("load",i);if(h){var k=h[f.maxRulesProperty];f.maxRules=k||0}})}e.delegate("tr.grid-content-tr","click",function(k){k.stopPropagation();k.preventDefault();var i=a(this).attr("data-key"),h=e.grid("getStore");if(h&&i!==undefined&&i!=="undefined"){var j=h.getData(i);e.trigger("ev_lineclicked",[i,j])}return false});e.delegate("td.grid-content-td-check-column label.checkbox-label","click",function(n){n.stopPropagation();n.preventDefault();var k=a(this),m=k.closest("tr.grid-content-tr"),l=k.find("input[type=checkbox]");m.toggleClass("selected");if(m.hasClass("selected")){l.prop("checked",true);k.addClass("checked")}else{l.prop("checked",false);k.removeClass("checked")}var i=i=e.find("tr.grid-content-tr");var k=e.find("tr.grid-header-tr label.checkbox-label");var h=k.closest("div.checkbox-group-container");if(i.length>0){if(!i.hasClass("selected")){h.removeClass("selected");k.removeClass("checked")}for(var j=0;j<i.length;++j){if(!a(i[j]).hasClass("selected")){h.removeClass("selected");k.removeClass("checked");break}}if(j==i.length){h.addClass("selected");k.addClass("checked")}}return false}).delegate("th.grid-header div.checkcolumn label.checkbox-label","click",function(k){k.stopPropagation();k.preventDefault();var j=a(this),h=a(this).closest("div.checkbox-group-container"),i=e.find("tr.grid-content-tr");if(h.hasClass("selected")){h.removeClass("selected");i.removeClass("selected");i.find("label.checkbox-label").removeClass("checked");i.find("input[type=checkbox]").prop("checked",false);j.find("input[type=checkbox]").prop("checked",false);j.removeClass("checked")}else{h.addClass("selected");i.addClass("selected");i.find("input[type=checkbox]").prop("checked",true);i.find("label.checkbox-label").addClass("checked");j.find("input[type=checkbox]").prop("checked",true);j.addClass("checked")}return false});e.delegate("a.grid-content-btn.grid-content-btn-status","click",function(q){q.preventDefault();q.stopPropagation();var k=a(this),r=a(this).closest("tr.grid-content-tr");if(r.hasClass("disabled")){return}var n=e.grid("getEditor");if(n&&n.isEditor){if(n.editing){a(n).editor("shake");return}}var u=k.attr("data-key"),t=k.attr("data-value"),m=k.attr("data-on"),o=k.attr("data-off"),h=k.attr("data-name"),s=e.grid("getStore"),l=s.keyProperty,j=s.getData(u);var i={};i[h]=(t===m)?o:m;var p=a.extend({},j,i);delete p[l];e.grid("runProgress");s.update(u,{old:a.su.json.toJSONString(j),"new":a.su.json.toJSONString(p)},function(){e.grid("prompt",true)},function(){e.grid("prompt",false)})}).delegate("a.grid-content-btn.grid-content-btn-delete","click",function(k){k.preventDefault();k.stopPropagation();var i=a(this),j=i.closest("tr.grid-content-tr");if(j.hasClass("disabled")){return}var h=i.attr("data-key"),l=e.grid("getEditor");if(l&&l.isEditor){if(l.editing===false){c=e.get(0).store;e.grid("runProgress");c.remove([h],{},function(){e.grid("prompt",true)},function(){e.grid("prompt",false)},function(){e.grid("prompt",false)})}else{a(l).editor("shake")}}});var b=e.get(0);b.autoRefreshTime=0;if(b.autoRefresh){b.autoRefreshTime=setTimeout(function(h){e.grid("getStore").load()},b.refreshDuration)}return e},initRow:function(q,c){var q=q||this,e=q.get(0),p=c[1]||0,N=c[2],r=N[e.store.keyProperty],k=q.grid("getColumns");var P='<tr class="grid-content-tr grid-content-tr-'+r+'" data-key="'+r+'" >';var s=k.length,n=[];for(var g=0;g<s;g++){var F=k[g],m=(N[F.dataIndex]==undefined)?"---":N[F.dataIndex],v=(g===0)?"fst":"",E=(g===s-1)?"lst":"";switch(F.xtype){case"rownumberer":P+='<td class="grid-content-td grid-content-td-'+g+" grid-content-td-row-numberer "+v+" "+E+'" name="row-numberer">';P+='<span class="grid-row-numberer content">'+(p+1)+"</span>";P+="</td>";break;case"checkcolumn":P+='<td class="grid-content-td grid-content-td-'+g+" grid-content-td-check-column "+v+" "+E+'" name="check-column">';P+='<div class="checkbox-group-container">';P+='<div class="widget-wrap">';P+='<label class="checkbox-label">';P+='<input class="checkbox-checkbox" type="checkbox" value="'+r+'"/>';P+='<span class="icon"></span>';P+="</label>";P+="</div>";P+="</div>";P+='<span class="content">--</span>';P+="</td>";break;case"statuscolumn":var B="",h="",y="",l=F.trueValue||"on",I=F.falseValue||"off";if(N[F.dataIndex]===l){B=a.su.CHAR.GRID.ENABLED;h="enabled";y=l}else{B=a.su.CHAR.GRID.DISABLED;h="disabled";y=I}P+='<td class="grid-content-td grid-content-td-'+g+" grid-content-td-status-column "+v+" "+E+'" name="check-column">';P+='<a href="javascript:void(0);" data-index="'+p+'" data-name="'+F.dataIndex+'" data-value="'+y+'" data-key="'+r+'" data-on="'+l+'" data-off="'+I+'" class="grid-content-btn grid-content-btn-status btn-status '+h+'">';P+='<span class="icon"></span>';P+='<span class="text">'+B+"</span>";P+="</a>";P+="</td>";break;case"settings":P+='<td class="grid-content-td grid-content-td-'+g+" grid-content-td-settings-column "+v+" "+E+'" name="settings-column">';P+='<a href="javascript:void(0);" data-index="'+p+'" data-key="'+r+'" class="grid-content-btn grid-content-btn-edit btn-edit">';P+='<span class="icon"></span>';P+='<span class="text">'+a.su.CHAR.OPERATION.EDIT+"</span>";P+="</a>";P+='<a href="javascript:void(0);" data-index="'+p+'" data-key="'+r+'" class="grid-content-btn grid-content-btn-delete btn-delete">';P+='<span class="icon"></span>';P+='<span class="text">'+a.su.CHAR.OPERATION.DELETE+"</span>";P+="</a>";P+="</td>";break;case"actioncolumn":var t=F.items;P+='<td class="grid-content-td grid-content-td-'+g+" grid-content-td-action-column "+v+" "+E+'" name="action-column">';P+='<div class="grid-content-td-wrap">';for(var A=0;A<t.length;A++){var z=t[0];P+='<input class="actioncolumn-input" data-index="'+p+'" data-type="'+z.xtype+'" data-property="'+F.dataIndex+'" data="'+F.renderer.call(q,m,p)+'" />'}P+="</div>";P+="</td>";n.push(g);break;default:P+='<td class="grid-content-td grid-content-td-'+g+" grid-content-td-"+F.name+" "+v+" "+E+" "+F.cls+'" name="'+F.name+'">';P+='<div class="content">'+F.renderer.call(q,m,p,N)+"</div>";P+="</td>";break}}P+="</tr>";var o=a(P);if(n.length>0){for(var A=0;A<n.length;A++){var L=n[A],t=k[L].items,J=o.find("td.grid-content-td-"+L);var w=J.find("input.actioncolumn-input"),O=w.attr("data-index"),K=w.attr("data-property"),m=q.grid("getStore").data[O]||{};for(var G=0;G<t.length;G++){var u={},z=t[G],O=z.dIndex;if(z.properties){var b=z.properties;for(var x=0;x<b.length;x++){var H=b[x];if(H.value===undefined||H.value===null){u[H.property]=H.index}else{u[H.property]=(N[H.index]===H.value)?true:false}}}var f=w.eq(G),z=t[G],i=z.xtype,O=z.dIndex,D=z.dataIndex||K,j=f.attr("data-index");if(i=="html"){var C=z.renderer||function(R,Q){return"<span>"+R+"</span>"},P="";if(!O||O==""){P=C(m[D],m,j)}else{var M="";if(m[K]){M=m[K][O]||""}P=C(M,m)}f.replaceWith(a(P))}else{f[i](a.extend({},z,u));if(!O||O==""){f[i]("setValue",m[D])}else{if(m[K]){var M="";if(m[K]){M=m[K][O]||""}f[i]("setValue",M)}}}}}}return o},initEmptyRow:function(g){var g=g||this,e=g.grid("getColumns");var f='<tr class="grid-content-tr empty">';for(var d=0,c=e.length;d<c;d++){var b=(d==c-1)?"lst":"";f+='<td class="grid-content-td grid-content-td-'+d+" "+b+'">--</td>'}f+="</tr>";var h=a(f);return h},initTBar:function(n,f){var n=n||this,i=n.get(0);if(!i){return null}var o=a.type(i.operation);var c=null;if(o==="string"){c=i.operation.split("|")}else{if(o==="array"){c=i.operation}else{return null}}i.operation=c;var b='<div class="operation-container">';for(var j=0,k=c.length;j<k;j++){var d=(j===0)?"fst":"",h=(j===k-1)?"lst":"";switch(c[j]){case"add":b+='<a href="javascript:void(0);" class="operation-btn btn-add '+d+" "+h+'">';b+='<span class="icon"></span>';b+='<span class="text">'+a.su.CHAR.OPERATION.ADD+"</span>";b+="</a>";var m='<div class="grid-warning-msg warning">';m+='<h4 class="title">';m+='<span class="icon"></span>';m+='<span class="text">'+i.maxRulesMsgText+"</span>";m+="</h4>";m+="</div>";var l=a('<div class="grid-max-rules-msg"></div>').msg({type:"alert",cls:"grid-popup-msg",innerHTML:m});i.maxRulesMsg=l;break;case"edit":b+='<a href="javascript:void(0);" class="operation-btn btn-edit '+d+" "+h+'">';b+='<span class="icon"></span>';b+='<span class="text">'+a.su.CHAR.OPERATION.EDIT+"</span>";b+="</a>";break;case"prompt":b+='<div class="grid-prompt hidden widget-container successed inline-block left">';b+='<div class="content">';b+='<span class="icon"></span>';b+='<span class="text text-successed">'+i.promptTextSuccessed+"</span>";b+='<span class="text text-failed">'+i.promptTextFailed+"</span>";b+="</div>";b+="</div>";i.showPrompt=true;break;case"delete":b+='<a href="javascript:void(0);" class="operation-btn btn-delete '+d+" "+h+'">';b+='<span class="icon"></span>';b+='<span class="text">'+a.su.CHAR.OPERATION.DELETE+"</span>";b+="</a>";var m='<div class="grid-warning-msg warning">';m+='<h4 class="title">';m+='<span class="icon"></span>';m+='<span class="text">'+i.noneSelectedMsgText+"</span>";m+="</h4>";m+="</div>";var g=a('<div class="grid-none-selected-msg"></div>').msg({type:"alert",cls:"grid-popup-msg",innerHTML:m});m='<div class="grid-warning-msg warning">';m+='<h4 class="title">';m+='<span class="icon"></span>';m+='<span class="text">'+i.deleteConfirmMsgText+"</span>";m+="</h4>";m+="</div>";var r=a('<div class="grid-delete-comfirm-msg"></div>').msg({type:"prompt",cls:"grid-popup-msg",innerHTML:m,okHandler:function(u){var t=n.grid("getSelected"),s=n.grid("getStore");if(t.length>0){n.grid("runProgress");s.remove(t,{},function(){n.grid("prompt",true)},function(){n.grid("prompt",false)},function(){n.grid("prompt",false)})}}});i.noneSelectMsg=g;i.deleteConfirmMsg=r;break;case"deleteAll":b+='<a href="javascript:void(0);" class="operation-btn btn-delete-all '+d+" "+h+'">';b+='<span class="icon"></span>';b+='<span class="text">'+a.su.CHAR.OPERATION.DELETE_ALL+"</span>";b+="</a>";var m='<div class="grid-warning-msg warning">';m+='<h4 class="title">';m+='<span class="icon"></span>';m+='<span class="text">'+i.deleteAllConfirmMsgText+"</span>";m+="</h4>";m+="</div>";var r=a('<div class="grid-delete-comfirm-msg"></div>').msg({type:"prompt",cls:"grid-popup-msg",innerHTML:m,okHandler:function(y){var u=n.grid("getStore"),t=u.keyProperty,x=[],w=u.data;for(var v=0,s=w.length;v<s;v++){x.push(w[v][t])}if(x.length>0){u.remove(x,{},null,function(){n.grid("prompt",false)},function(){n.grid("prompt",false)})}}});i.deleteConfirmMsg=r;break;case"enable":b+='<a href="javascript:void(0);" class="operation-btn btn-enable '+d+" "+h+'">';b+='<span class="icon"></span>';b+='<span class="text">'+a.su.CHAR.OPERATION.ENABLE+"</span>";b+="</a>";break;case"disable":b+='<a href="javascript:void(0);" class="operation-btn btn-disable '+d+" "+h+'">';b+='<span class="icon"></span>';b+='<span class="text">'+a.su.CHAR.OPERATION.DISABLE+"</span>";b+="</a>";break;case"search":b+='<div class="container widget-container text-container search-container inline">';b+='<span class="widget-wrap text-wrap search-wrap">';b+='<input type="text" class="text-text search-text" value="'+a.su.CHAR.OPERATION.SEARCH+'" />';b+='<span class="pos"></span>';b+='<a href="javascript:void(0);" class="search-switch"></a>';b+="</span>";b+="</div>";break;case"refresh":b+='<a href="javascript:void(0);" class="operation-btn btn-refresh '+d+" "+h+'">';b+='<span class="icon"></span>';b+='<span class="text">'+a.su.CHAR.OPERATION.REFRESH+"</span>";b+="</a>";break;case"autoRefresh":b+='<input class="operation-auto-refresh '+d+" "+h+'"/>';break;default:var e=c[j].xtype;if(e){b+='<input operation-index="'+j+'" class="operation-user-defined operation-'+j+" "+d+" "+h+" "+e+'"/>'}break}}b+="</div>";var p=a(b);if(i.isPanel){n.panel("getContainer").find("div.panel-tbar-container").append(p);p.find("input.operation-auto-refresh").checkbox({fieldLabel:null,items:[{boxlabel:a.su.CHAR.GRID.AUTO_REFRESH,inputValue:true,name:"auto-refesh"}],cls:"inline"}).on("ev_change",function(t,s,u){clearTimeout(i.autoRefreshTime);if(u.length>0&&u[0]==="auto-refesh"){i.autoRefreshTime=setTimeout(function(){n.grid("getStore").load()},i.refreshDuration)}});p.find("input.operation-user-defined").each(function(v){var s=a(this),u=s.attr("operation-index"),t=c[u],w=t.xtype;switch(w){case"totalCount":t=a.extend({fieldLabel:"",labelCls:"s",readOnly:true,inputCls:"xs",value:0,cls:"inline-block"},t);s.textbox(t);break;case"display":t=a.extend({cls:"grid-display",fieldLabel:null,labelCls:"s",readOnly:true,inputCls:"xl grid-display",cls:"inline-block"},t);s.textbox(t);break;default:t=a.extend(t,{cls:"inline-block"});s[w](t)}});p.delegate("a.btn-add","click",function(x){x.stopPropagation();x.preventDefault();if(a(this).hasClass("disabled")){return}var w=n.get(0),v=n.grid("getEditor"),u=n.grid("isEditing");if(a.type(w.beforeStartAdd)=="function"){if(!w.beforeStartAdd()){return}}if(u===true){a(v).editor("shake")}else{if(u===false){var t=w.paging,s=n.grid("getStore");if(w.maxRules&&w.maxRules<=s.data.length){w.maxRulesMsg.msg("show");return}if(t&&t.isPaging){a(t).paging("goToPage",0)}a(v).editor("startEdit","add")}}}).delegate("a.btn-delete","click",function(w){w.stopPropagation();w.preventDefault();var t=n.grid("getEditor"),v=n.get(0),s=n.grid("isEditing");if(s===true){a(t).editor("shake")}else{var u=n.grid("getSelected");if(u.length==0){v.noneSelectMsg.msg("show")}else{v.deleteConfirmMsg.msg("show")}}}).delegate("a.btn-delete-all","click",function(v){v.stopPropagation();v.preventDefault();var t=n.grid("getEditor"),u=n.get(0),s=n.grid("isEditing");if(s===true){a(t).editor("shake")}else{u.deleteConfirmMsg.msg("show")}}).delegate("a.btn-refresh","click",function(s){s.stopPropagation();s.preventDefault();n.grid("runProgress");n.grid("getStore").load({},function(){n.grid("prompt",true)},function(){n.grid("prompt",false)},function(){n.grid("prompt",false)})});p.delegate("input.search-text","focus",function(s){s.stopPropagation();a(this).closest("div.search-container").addClass("focus")}).delegate("input.search-text","blur",function(s){s.stopPropagation();a("div.search-container").removeClass("focus")}).delegate("button.operation-btn","mousedown",function(s){s.stopPropagation();a(this).closest("div.button-container").addClass("clicked")}).delegate("a.search-switch","click",function(u){u.stopPropagation();var s=a(this).closest("div.grid-container"),t=a(this).prevAll("input.search-text").val();s.grid("search",t)});var q=i.store;a(q).on("ev_datachanged",function(u,s,t){p.find("input.totalCount").textbox("setValue",t.length)})}if(i.showPrompt){b='<div class="container widget-container progressbar-container progressbar-horizontal gird-prompt-progressbar ">';b+='<div class="widget-wrap progressbar-wrap">';b+='<div class="widget-wrap progressbar-content">';b+='<div class="progressbar-value">';b+="</div>";b+="</div>";b+="</div>";p.append(a(b))}i.operation=p.get(0)},initPaging:function(f,h){var f=f||this,g=f.get(0),d={};if(!g||!g.paging){return null}d=a.extend({grid:f},g.paging);var e=f.panel("getContainer"),b=e.find("div.panel-fbar-container");var c=a('<input type="hidden" class="hidden paging-input">').paging(d);b.append(c.paging("getContainer"));g.paging=c.get(0);return f},initEditor:function(e,h){var e=e||this,f=e.get(0),d;if(!f){return null}var c=f.editor;if(!c||!c.isEditor){var b=a.type(c),d={columns:f.columns,grid:e};if(b=="string"&&c!=="default"){d=a.extend(d,{content:c})}else{d=a.extend(d,c)}var g=a('<tr class="editor-container"></tr>').editor(d)}f.editor=g.get(0);return e},load:function(f,i){var f=f||this,h=f.get(0),g=i[1]||h.store.data,e=f.grid("getContainer").find("tbody.grid-content-data");h.rows=[];e.empty();for(var d=0,c=g.length;d<c;d++){if(!g[d]){break}var b=f.grid("initRow",d,g[d]);h.rows.push(b);e.append(b)}f.grid("updateRowNumber");f.trigger("ev_load",[g]);return f},insert:function(i,c){var i=i||this,d=i.get(0),g=parseInt(c[1],10)||0,e=c[2]||[{}],b=i.find("tbody.grid-content-data");if(!a.isArray(e)){e=[e]}e.reverse();for(var f=0,h=e.length;f<h;f++){var j=i.grid("initRow",g+f,e[f]);if(g==0){b.prepend(j)}else{j.insertBefore(d.rows[g])}d.rows.splice(g,0,j)}i.grid("updateRowNumber");i.trigger("ev_insert",[g,e]);return i},update:function(h,c){var h=h||this,e=h.get(0),k=e.rows,b=h.find("tbody.grid-content-data"),j=c[1],g=c[2]||0,f=c[3];if(a.isArray(f)){f=f[0]}var i=h.grid("initRow",g,f),d=k[g];if(j==d.attr("data-key")){d.replaceWith(i);k[g]=i}h.trigger("ev_update",[j,g,f]);return h},remove:function(g,b){var g=g||this,c=g.get(0),j=c.rows,i=b[1],h={};if(!(i===undefined)&&!(i===null)){if(a.type(i)==="number"){i=[i]}for(var e=0,f=i.length;e<f;e++){h[i[e]]=true}}for(var e=j.length-1;e>=0;e--){var d=c.rows[e];if(d.attr("data-key") in h){d.remove();c.rows.splice(e,1)}}g.grid("updateRowNumber");g.trigger("ev_remove",[i]);return g},removeAllData:function(b,d){var b=b||this,c=b.get(0);c.rows=[];b.grid("updateRowNumber");b.trigger("ev_remove",["all"]);return b},updateRowNumber:function(g,b){var g=g||this,d=g.get(0),j=d.rows,f=j.length,c=g.find("tbody.grid-content-data");if(f==0){var h=g.grid("initEmptyRow");c.empty();c.append(h);h.css("display","table-row");return g}for(var e=0;e<f;e++){var i=j[e];if(i){a(i).find("span.grid-row-numberer").html(e+1)}}return g},getColumns:function(b){var b=b||this;return b.get(0).columns},getSelected:function(c){var c=c||this;var d=c.find("tr.grid-content-tr.selected");var b=[];d.each(function(f,g){var e=a(g).attr("data-key");b.push(e)});return b},getStore:function(b){var b=b||this;return b.get(0).store||null},getEditor:function(c){var c=c||this,b=c.get(0).editor;if(b&&a.type(b)==="object"&&b.isEditor===true){return b}else{return undefined}},getDisplay:function(c){var c=c||this,b=c.closest("div.grid-panel");var d=c.find("input.grid-display");if(d.length>0){return d}else{return null}},search:function(c,b){var c=c||this,b=b[1];if(!b){return null}return c},isEditing:function(d){var d=d||this,c=d.grid("getEditor"),b=d.get(0).store;if(c&&c.isEditor){if(c.editing===true){return true}}else{return null}return false},runProgress:function(e){var e=e||this,f=e.get(0),d=a(f.operation),b=d.find("div.gird-prompt-progressbar"),c=b.find("div.progressbar-value");c.stop();c.css("width","0px");b.clearQueue().fadeIn(100,function(){c.animate({width:"50%"},5*1000)});return e},prompt:function(h,c){var h=h||this,d=h.get(0),g=c[1],k=c[2],i=a(d.operation),e=i.find("div.gird-prompt-progressbar"),b=h.find("tr.grid-content-tr.editing"),f=a(h.grid("getEditor")),j=i.find("div.grid-prompt");e.find("div.progressbar-value").clearQueue().animate({width:"100%"},150,function(){e.fadeOut(100,function(){if(g){j.find("span.text-successed").html((k||d.promptTextSuccessed));j.removeClass("failed").addClass("successed")}else{j.find("span.text-failed").html((k||d.promptTextFailed));j.removeClass("successed").addClass("failed");b.addClass("error");f.addClass("error")}j.fadeIn(50,function(){setTimeout(function(){j.css("display","none");f.removeClass("error");b.removeClass("error")},3*1000)})})});return h},disableRow:function(l,h){var l=l||this,f=l.get(0),e=f.columns,h=h[1],o=null;if(!isNaN(h)){o=f.rows[h]}if(o){o=a(o);o.addClass("disabled");for(var h=0,i=e.length;h<i;h++){var d=e[h],k=d.items;if(d.xtype==="actioncolumn"){for(var g=0,b=k.length;g<b;g++){var n=k[g],c=n.xtype,m=d.dataIndex,j=o.find("input[data-property="+m+"][data-type="+c+"]");if(j&&a.type(j[c])=="function"){j[c]("disable")}}}}}return l},enableRow:function(j,f){var j=j||this;obj=j.get(0),columns=obj.columns,f=f[1],row=null;if(!isNaN(f)){row=obj.rows[f]}if(row){row=a(row);row.removeClass("disabled");for(var f=0,g=columns.length;f<g;f++){var d=columns[f],i=d.items;if(d.xtype==="actioncolumn"){for(var e=0,b=i.length;e<b;e++){var l=i[e],c=l.xtype,k=d.dataIndex,h=row.find("input[data-property="+k+"][data-type="+c+"]");if(h&&a.type(h[c])=="function"){h[c]("enable")}}}}}return j}})})(jQuery);