(function(a){a.su.Widget("wizard",{defaults:{autoStart:true,items:[{name:"",label:"",content:"",prevButton:true,prevHandler:null,nextButton:true,nextHandler:null}],currentIndex:0,finishHandler:null},create:function(d,b){var c=this;c.each(function(l,k){var g=a(k);a.extend(k,d,b);var f='<div class="process-flow">';f+='<div class="process-flow-wrap">';var e='<div class="form-container">';var p=k.items,o=p.length,q="up";for(var n=0;n<o;n++){var s=p[n],r=(n==(o-1))?"lst":"",q=(q==="up")?"down":"up",j=s.labelCls||"";f+='<div name="'+s.name+'" class="process-flow-step step'+n+" "+r+'">';f+='<span class="icon"></span>';if(s.label){f+='<span class="text '+q+" "+j+'">'+s.label+"</span>"}f+="</div>";if(r!="lst"){f+='<span class="bar">';f+='<span class="bar-inner">';f+="</span>";f+="</span>"}e+='<div class="form-step" data-step="'+n+'" name="'+s.name+'">';e+='<div class="form-content" data-step="'+n+'" name="'+s.name+'"></div>';e+='<div class="form-buttons-container">';if(s.prevButton!==false){e+='<button type="button" class="button-prev wizard-buttons" data-name="'+s.name+'" data-step="'+n+'"></button>'}if(s.nextButton!==false){e+='<button type="button" class="button-next wizard-buttons" data-name="'+s.name+'" data-step="'+n+'"></button>'}e+="</div>";e+="</div>"}f+="</div>";f+="</div>";e+="</div>";g.append(a(f)).append(a(e)).addClass("container widget-container wizard-container");for(var n=0;n<o;n++){var s=p[n];var h=a(s.content).attr("name",s.name),m=g.find("div.form-step[name="+s.name+"]").css("display","none");m.find("div.form-content").append(h);if(s.prevButton!==false){m.find("button.button-prev").button({text:s.prevButtonText||a.su.CHAR.OPERATION.BACK,cls:"wizard-btn btn-prev",handler:function(i){c.wizard("goPrev")}})}if(s.nextButton!==false){m.find("button.button-next").button({text:s.nextButtonText||a.su.CHAR.OPERATION.NEXT,cls:"wizard-btn btn-next",handler:function(i){c.wizard("goNext")}})}}});c.wizard("geToIndex",0);return c},setCurrent:function(d,e){var d=d||this,f=e[1];var c=d.find("div.process-flow-step[name='"+f+"']");c.addClass("current");var b=c.prev("span.bar").addClass("processed");b.find("span.bar-inner").css("width","0").animate({width:"+=100%"},200);d.find("div.form-container div.form-step").css("display","none");d.find("div.form-container div.form-step[name='"+f+"']").fadeIn(200)},setProcessed:function(d,e){var d=d||this,f=e[1];var c=d.find("div.process-flow-step[name='"+f+"']");c.addClass("processed");var b=c.prev("span.bar").addClass("processed");b.find("span.bar-inner").css("width","0").animate({width:"+=100%"},200)},setNormal:function(d,e){var d=d||this,f=e[1];var c=d.find("div.process-flow-step[name='"+f+"']");c.removeClass("current, processed");var b=c.prev("span.bar").removeClass("current, processed");b.find("span.bar-inner").css("width","100%").animate({width:"-=0"},200)},setNormalAll:function(b,c){b.find("div.process-flow-step, span.bar").removeClass("current processed")},goNext:function(){var l=l||this,c=l.get(0),k=c.items,h=k.length,i=c.currentIndex,d=i+1;var o=k[i],j;if(o.nextHandler){j=o.nextHandler.call(l)}if(j===false){return}if(i>=h){return false}else{if(i===h-1){d=i}}var n=o.name,b=k[d]["name"];var g=l.find("div.process-flow-step[name='"+n+"']").removeClass("current").addClass("processed"),f=g.next("span.bar"),e=f.find("span.bar-inner");var m=l.find("div.process-flow-step[name='"+b+"']");e.width(0);f.addClass("processed");e.animate({width:"+=100%"},200,function(){e.css("width","100%");m.addClass("current");l.find("div.form-container div.form-step").css("display","none");l.find("div.form-container div.form-step[name='"+b+"']").fadeIn(150,function(){if(a.su.layout.doLayout){a.su.layout.doLayout()}})});c.currentIndex=d;return l},goPrev:function(){var l=l||this,e=l.get(0),k=e.items,h=k.length,i=e.currentIndex,b=i-1;var o=k[i],j;if(o.prevHandler){j=o.prevHandler.call(l)}if(j===false){return l}if(i<0){return false}else{if(i===0){b=0}}var n=o.name,m=k[b]["name"];var g=l.find("div.process-flow-step[name='"+n+"']").removeClass("current processed"),d=g.prev("span.bar"),c=d.find("span.bar-inner");var f=l.find("div.process-flow-step[name='"+m+"']");c.css("width","100%");d.addClass("processed");c.animate({width:"-=0px"},200,function(){d.removeClass("processed");c.css("width","0");f.removeClass("processed").addClass("current");g.removeClass("current processed");l.find("div.form-container div.form-step").css("display","none");l.find("div.form-container div.form-step[name='"+m+"']").fadeIn(150,function(){if(a.su.layout.doLayout){a.su.layout.doLayout()}})});e.currentIndex=b;return l},goTo:function(i,c){var i=i||this,j=c[1];var d=i.get(0),g=d.items,f=d.currentIndex;i.wizard("setNormalAll");var h=false;for(var e=0;e<g.length;e++){var k=g[e],b=k.name;if(h==false){if(b==j){i.wizard("setCurrent",b);f=e;h=true;continue}else{i.wizard("setProcessed",b);continue}}else{i.wizard("setNormal",b);continue}}if(h){if(f>=0&&f<=g.length-1){i.find("div.form-step[data-step="+f+"]")}d.currentIndex=f;if(a.su.layout.doLayout){a.su.layout.doLayout()}return true}else{return false}return i},geToIndex:function(c,f){var c=c||this,d=f[1];var e=c.get(0),b=e.items,g=b[d].name;if(!g){return false}else{return c.wizard("goTo",g)}return c},getContainer:function(b){var b=b||this;return b},showButtons:function(c){var c=c||this,b=c.find("button.wizard-buttons");b.each(function(d,e){a(e).button("show")});return c},hideButtons:function(c){var c=c||this,b=c.find("button.wizard-buttons");b.each(function(d,e){a(e).button("hide")});return c}})})(jQuery);