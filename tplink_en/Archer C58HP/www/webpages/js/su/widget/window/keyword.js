(function(a){a.su.Widget("keyword",{defaults:{fieldLabel:null,addBtnText:a.su.CHAR.OPERATION.ADD_A_NEW_KEYWORD,removeBtnText:a.su.CHAR.OPERATION.REMOVE,keywordType:"textbox",keywordProperty:{fieldLabel:null,cls:"inline-block"},columns:3,maxHeight:160,maxKeys:99999,maxKeysText:a.su.CHAR.OPERATION.KEYWORD_MAX_OVERFLOW,keyNumbers:0,keyTag:0},create:function(e,c){var d=this;d.each(function(h,k){var f=a(k);a.extend(k,e,c);var j='<div class="container widget-container keyword-container '+this.cls+'">';if(this.fieldLabel!==null){j+='<div class="widget-fieldlabel-wrap '+this.labelCls+'">';j+='<label class="widget-fieldlabel keyword-fieldlabel">'+this.fieldLabel+"</label>";if(this.fieldLabel!==""){j+='<span class="widget-separator">'+this.separator+"</span>"}j+="</div>"}j+='<div class="widget-wrap keyword-container-wrap">';j+='<div class="keyword-btn-container">';j+='<a class="keyword-btn keyword-add-btn" href="javascript:void(0);">';j+='<span class="keyword-add-btn-wrap">';j+='<span class="keyword-icon add-icon icon"></span>';j+='<span class="keyword-text add-text text">'+k.addBtnText+"</span>";j+="</span>";j+="</a>";j+='<span class="keyword-overflow-warning hidden">'+this.maxKeysText+"</span>";j+="</div>";j+='<div class="keyword-container-div">';j+="<table>";j+='<tbody class="keyword-container-body">';j+="</tbody>";j+="</table>";j+="</div>";j+="</div>";j+="</div>";var g=a(j);f.replaceWith(g);g.append(f.addClass("hidden"))});var b=d.closest("div.keyword-container");b.delegate("a.keyword-remove-btn","click",function(f){f.stopPropagation();f.preventDefault();d.keyword("removeKey",a(this).attr("data-index"))}).delegate("a.keyword-add-btn","click",function(f){f.stopPropagation();f.preventDefault();if(a(this).hasClass("disabled")){return}d.keyword("addKey","")});return d},addKey:function(j,m){var j=j||this;if(j.keyword("hasEmpty")){return j}var i=j.get(0),m=m[1]||"",d=i.keywordType,k=i.keywordProperty,h=i.columns||1,e=j.closest("div.keyword-container"),f=e.find("div.keyword-container-div tbody.keyword-container-body");if(i.maxKeys<=i.keyNumbers){return j}e.removeClass("empty");var n=f.find("tr:last"),g=n.find("td.keyword-td");if(g.length>=h||n.length==0){f.append(a("<tr></tr>"))}n=f.find("tr:last");var c=a('<td class="keyword-td" style="display: none; width: '+i.tdWidth+'px;"></td>');n.append(c);i.keyTag++;i.keyNumbers++;var l=a('<input class="keyword-content" data-index="'+i.keyTag+'" />');c.append(l);l[d](k)[d]("setValue",m);var b='<a class="keyword-btn keyword-remove-btn" href="javascript:void(0);" data-index="'+i.keyTag+'">';b+='<span class="keyword-icon remove-icon icon"></span>';b+='<span class="keyword-text remove-text text">'+i.removeBtnText+"</span>";b+="</a>";c.append(a(b)).fadeIn(250);if(i.maxKeys<=i.keyNumbers){e.find("a.keyword-add-btn").addClass("disabled");e.find("span.keyword-overflow-warning").css("display","inline-block")}return j},getKeyByIndex:function(e,d){var e=e||this;var d=d[1];var b=e.closest("div.keyword-container");var c=b.find("input.keyword-content").get(d);return c},removeKey:function(d,c){var d=d||this,f=d.get(0),b=d.closest("div.keyword-container"),c=c[1];f.keyNumbers--;var e=b.find("a.keyword-remove-btn[data-index="+c+"]").closest("td.keyword-td");e.fadeOut(350,function(){a(this).remove();d.keyword("refreshLayout")});if(f.maxKeys<=f.keyNumbers){}else{b.find("a.keyword-add-btn").removeClass("disabled");b.find("span.keyword-overflow-warning").css("display","none")}return d},refreshLayout:function(j,i){var j=j||this,g=j.get(0),f=g.columns,c=j.closest("div.keyword-container"),d=c.find("div.keyword-container-div tbody.keyword-container-body");var e=c.find("td.keyword-td");e.detach();d.empty();var k=0;for(var i=0,h=e.length;i<h;i++){var b=a(e[i]);if(k>=f||k==0){d.append(a("<tr></tr>"));k=1}else{k++}d.find("tr:last").append(b);b.find("a.keyword-remove-btn").attr("data-index",i)}if(e.length==0){c.addClass("empty")}return j},getValue:function(g){var g=g||this,i=g.closest("div.keyword-container").find("div.keyword-container-div tbody.keyword-container-body"),h=[];var f=i.find("input.keyword-content");for(var e=0,b=f.length;e<b;e++){var d=f.eq(e),c=d.val();if(c!=""){h.push(c)}}return a.su.json.toJSONString(h)},setValue:function(e,f){var e=e||this,f=f[1]||"",c=e.closest("div.keyword-container"),g=c.find("div.keyword-container-div tbody.keyword-container-body");f=a.su.json.parseJSON(f);e.keyword("removeAll");for(var d=0,b=f.length;d<b;d++){e.keyword("addKey",f[d])}if(b==0){c.addClass("empty")}return e},removeAll:function(c){var c=c||this,d=c.get(0),b=c.closest("div.keyword-container"),e=b.find("div.keyword-container-div tbody.keyword-container-body");e.empty();d.keyTag=0;d.keyNumbers=0;b.addClass("empty");b.find("a.keyword-add-btn").removeClass("disabled");b.find("span.keyword-overflow-warning").css("display","none");return c},removeEmpty:function(g){var g=g||this,h=g.get(0),i=g.closest("div.keyword-container").find("div.keyword-container-div tbody.keyword-container-body"),f=h.keywordType;var e=i.find("input.keyword-content");for(var d=0,b=e.length;d<b;d++){var c=e.eq(d);if(c.val()==""){g.keyword("removeKey",c.attr("data-index"))}}return g},hasEmpty:function(g){var g=g||this,h=g.get(0),i=g.closest("div.keyword-container").find("div.keyword-container-div tbody.keyword-container-body"),f=h.keywordType;var e=i.find("input.keyword-content");for(var d=0,b=e.length;d<b;d++){var c=e.eq(d);if(c.val()==""){c[f]("setError");return true}}return false},setMaxKeys:function(e,b){var e=e||this,f=e.get(0),d=b[1],c=e.closest("div.keyword-container");if(d){f.maxKeys=d}if(f.maxKeys<=f.keyNumbers){c.find("a.keyword-add-btn").addClass("disabled");c.find("span.keyword-overflow-warning").css("display","inline-block")}return e},validate:function(i){var i=i||this,d=i.get(0),c=i.closest("div.keyword-container").find("div.keyword-container-div tbody.keyword-container-body"),b=d.keywordType,k=true;var e=c.find("input.keyword-content"),h=e.length;for(var g=0;g<h-1;g++){var f=e.eq(g);if(f.val()==""){if(!d.allowBlank){f[b]("setError");return false}}else{if(!f[b]("validate")){return false}}}if(h){f=e.eq(h-1);if(f.val()==""){i.keyword("removeKey",h-1)}else{if(!f[b]("validate")){return false}}}if(d.validator){k=d.validator.call(i)}if(!k){return false}else{var j=i.keyword("getValue");i.val(j);return true}}})})(jQuery);