(function(a){a.su.Widget("timepicker",{defaults:{fieldLabel:"",viewOnly:false,legendText:a.su.CHAR.TIMESET.TIME||"Time",inputCls:"",cls:""},create:function(f,c){var d=this;d.each(function(n,m){var o=a(m);a.extend(m,f,c);var l="",q=false;if(m.viewOnly){l="view-only";q=true}var h='<div class="container widget-container timepicker-container '+m.cls+'">';if(this.fieldLabel!==null){h+='<div class="widget-fieldlabel-wrap '+this.labelCls+'">';h+='<label class="widget-fieldlabel timepicker-fieldlabel">'+this.fieldLabel+"</label>";if(this.fieldLabel!==""){h+='<span class="widget-separator">'+this.separator+"</span>"}h+="</div>"}h+='<div class="widget-wrap timepicker-wrap inline">';h+='<a class="timepicker-switch" href="javascript:void(0);">';h+='<span class="icon"></span>';h+='<span class="text"></span>';h+="</a>";h+="</div>";h+='<div class="timepicker-msg-container '+l+'">';h+='<div class="canvas">';h+='<div class="timepicker-msg-container-wrap">';h+='<table class="timepicker">';h+="<thead>";h+="<tr>";h+='<th class="fst"></th>';h+='<th class="week-picker" data-week="mon">'+a.su.CHAR.DATE.MONDAY+"</th>";h+='<th class="week-picker" data-week="tue">'+a.su.CHAR.DATE.TUESDAY+"</th>";h+='<th class="week-picker" data-week="wed">'+a.su.CHAR.DATE.WEDNESDAY+"</th>";h+='<th class="week-picker" data-week="thu">'+a.su.CHAR.DATE.THURSDAY+"</th>";h+='<th class="week-picker" data-week="fri">'+a.su.CHAR.DATE.FRIDAY+"</th>";h+='<th class="week-picker" data-week="sat">'+a.su.CHAR.DATE.SATURDAY+"</th>";h+='<th class="week-picker" data-week="sun">'+a.su.CHAR.DATE.SUNDAY+"</th>";h+="</tr>";h+="</thead>";h+="<tbody>";for(var p=0;p<24;p++){h+="<tr>";h+='<td class="fst"><div data-time="'+p+"-"+(p+1)+'" class="row-picker"></div></td>';h+='<td><div data-time-start="'+p+'" data-time-end="'+(p+1)+'" data-week="mon" class="timepicker-picker"></div></td>';h+='<td><div data-time-start="'+p+'" data-time-end="'+(p+1)+'" data-week="tue" class="timepicker-picker"></div></td>';h+='<td><div data-time-start="'+p+'" data-time-end="'+(p+1)+'" data-week="wed" class="timepicker-picker"></div></td>';h+='<td><div data-time-start="'+p+'" data-time-end="'+(p+1)+'" data-week="thu" class="timepicker-picker"></div></td>';h+='<td><div data-time-start="'+p+'" data-time-end="'+(p+1)+'" data-week="fri" class="timepicker-picker"></div></td>';h+='<td><div data-time-start="'+p+'" data-time-end="'+(p+1)+'" data-week="sat" class="timepicker-picker"></div></td>';h+='<td><div data-time-start="'+p+'" data-time-end="'+(p+1)+'" data-week="sun" class="timepicker-picker"></div></td>';h+="</tr>"}h+="</tbody>";h+="</table>";if(q){h+='<div class="timepicker-view-only timepicker-view-only-cover"></div>'}h+="</div>";h+='<div class="x-axis">';h+='<div class="x-axis-wrap">';for(var p=0;p<=24;p++){var k=(p.toString().length==1)?("0"+p):p.toString();h+="<span>"+k+":00</span>"}h+="</div>";h+="</div>";h+='<div class="legend-container">';h+='<span class="icon"></span>';h+='<span class="text">'+m.legendText+"</span>";h+="</div>";h+="</div>";if(!q){h+='<div class="msg-btn-container">';h+='<div class="msg-btn-wrap">';h+='<div class="button-container inline">';h+='<button type="button" class="button-button btn-msg btn-msg-cancel"><span class="button-button-before"></span><span class="text button-text">'+a.su.CHAR.OPERATION.CANCEL+"</span></button>";h+="</div>";h+='<div class="button-container inline">';h+='<button type="button" class="button-button btn-msg btn-msg-clear"><span class="button-button-before"></span><span class="text button-text">'+a.su.CHAR.OPERATION.CLEAR+"</span></button>";h+="</div>";h+='<div class="button-container inline">';h+='<button type="button" class="button-button btn-msg btn-msg-reset"><span class="button-button-before"></span><span class="text button-text">'+a.su.CHAR.OPERATION.RESET+"</span></button>";h+="</div>";h+='<div class="button-container inline">';h+='<button type="button" class="button-button btn-msg btn-msg-ok"><span class="button-button-before"></span><span class="text button-text">'+a.su.CHAR.OPERATION.SAVE+"</span></button>";h+="</div>";h+="</div>";h+="</div>"}h+="</div>";h+="</div>";var j=a(h);o.addClass(m.inputCls).replaceWith(j);j.append(o.addClass("hidden"));var r=j.find("div.timepicker-msg-container");r.msg({cls:"timepicker-container "+m.cls,type:"window"});m.msg=r});var b=d.closest("div.timepicker-container");var e=d.get(0);var g=e.msg;b.delegate("a.timepicker-switch","click",function(i){if(a(this).hasClass("disabled")){return}else{var h=e.snapshot||"[]";d.timepicker("setValue",h);d.trigger("ev_beforeshow",[d,g]);g.msg("show")}});g.on("ev_close",function(h,i){d.trigger("ev_close",[d,i])});g.delegate("div.timepicker-picker","click",function(h){h.stopPropagation();h.preventDefault()}).delegate("button.btn-msg-cancel","click",function(h){d.timepicker("restore")}).delegate("a.msg-close","click",function(h){d.timepicker("restore")}).delegate("button.btn-msg-clear","click",function(h){d.timepicker("reset")}).delegate("button.btn-msg-ok","click",function(i){var h=d.timepicker("getValue");d.timepicker("setValue",h)}).delegate("button.btn-msg-reset","click",function(h){d.timepicker("restore")});var e=d.get(0);g.delegate("div.timepicker-msg-container-wrap","mousedown",function(j){j.stopPropagation();j.preventDefault();if(e.viewOnly){return}var l=j.pageX||j.screenX,k=j.pageY||j.screenY;var h=a(this);l=l-h.offset().left;k=k-h.offset().top;var i=h.find("div.timepicker-select-wrap");if(i.length==0){i=a('<div class="timepicker-select-wrap"></div>');h.append(i)}i.attr("fl",l);i.attr("ft",k);i.css({left:l,top:k,display:"block"});g.attr("dragFlag",true)}).delegate("div.timepicker-msg-container-wrap","mouseup",function(n){n.stopPropagation();n.preventDefault();if(e.viewOnly){return}var i=g.find("div.timepicker-select-wrap");if(i.length>0){var k=i.offset().left;var q=i.offset().top;var h=k+i.width();var p=q+i.height();var j=a(this);var o=j.find("div.timepicker-picker");var m=false;if(k==0&&q==0&&h==0&&p==0){return}o.each(function(w,u){var r=a(u);var s=r.offset().left;var y=r.offset().top;var l=s+r.width();var x=y+r.height();var v=(s<=k&&k<=l)||(k<=s&&l<=h)||(s<=h&&h<=l);var t=(y<=q&&q<=x)||(q<=y&&x<=p)||(y<=p&&p<=x);if(v&&t){if(r.hasClass("selected")){return}else{m=true;return false}}});o.each(function(w,u){var r=a(u);var s=r.offset().left;var y=r.offset().top;var l=s+r.width();var x=y+r.height();var v=(s<=k&&k<=l)||(k<=s&&l<=h)||(s<=h&&h<=l);var t=(y<=q&&q<=x)||(q<=y&&x<=p)||(y<=p&&p<=x);if(v&&t){if(m){r.addClass("selected")}else{r.toggleClass("selected")}}});i.css({display:"none",width:0,height:0});g.removeAttr("dragFlag")}}).delegate("div.timepicker-msg-container-wrap","mousemove",function(o){o.stopPropagation();o.preventDefault();if(e.viewOnly){return}var j=o.pageX||o.screenX,i=o.pageY||o.screenY;var l=a(this);j=j-l.offset().left;i=i-l.offset().top;if(g.attr("dragFlag")){var k=g.find("div.timepicker-select-wrap");var p=parseInt(k.attr("fl"),10);var n=parseInt(k.attr("ft"),10);var q=j-p;if(q>0){k.css({width:q})}else{q=Math.abs(q);k.css({width:q,left:j})}var m=i-n;if(m>0){k.css({height:m})}else{m=Math.abs(m);k.css({height:m,top:i})}}});return d},enable:function(d){var d=d||this,c=d.closest("div.timepicker-container"),b=c.find("a.timepicker-switch");c.removeClass("disabled");b.removeClass("disabled");return d},disable:function(d){var d=d||this,c=d.closest("div.timepicker-container"),b=c.find("a.timepicker-switch");c.addClass("disabled");b.addClass("disabled");return d},setValue:function(l,n){var l=l||this,n=n[1]||"{}",p={};var e=l.get(0).msg,k=e.find("div.timepicker-picker").removeClass("selected");l.val(n);l.get(0).snapshot=n;var n=a.su.json.parseJSON(n);for(var b in n){var f=b.toLowerCase(),o=n[b];var d=k.filter("[data-week="+f+"]");for(var j=0,i=o.length;j<i;j++){var g=o[j],c=g[0],m=g[1];for(var h=c;h<m;h++){d.filter('[data-time-start="'+h+'"]').addClass("selected")}}}return l},getValue:function(o){var o=o||this,g=o.get(0).msg;var n=g.find("div.timepicker-picker");var s={};for(var k=0,l=n.length;k<l;k++){var j=a(n[k]),h=j.attr("data-week"),f=parseInt(j.attr("data-time-start"),10),p=parseInt(j.attr("data-time-end"),10);if(j.hasClass("selected")){s[h]=s[h]||[];s[h].push([f,p])}else{continue}}for(var c in s){var q=s[c],b=[],r=[],i=-1;q.sort(function(t,d){return t[0]-d[0]});for(var k=0,l=q.length;k<l;k++){var m=q[k];if(l==1){b.push(m);i=-1;r=[];continue}if(i==-1){i=m;r=[i[0]];continue}if(i[1]==m[0]){i=m}else{r.push(i[1]);b.push(r);i=m;r=[i[0]]}if(k==l-1){r.push(m[1]);b.push(r);i=-1;r=[];continue}}s[c]=b}var e=a.su.json.toJSONString(s);o.val(e);return e},restore:function(c){var c=c||this,d=c.get(0),e=d.msg,b=d.snapshot;if(!b){b="[]"}c.timepicker("setValue",b);return c},reset:function(b){var b=b||this,d=b.get(0),e=d.msg;var c=e.find("div.timepicker-picker");c.removeClass("selected");b.val("");return b}})})(jQuery);