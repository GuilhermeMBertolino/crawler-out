(function(a){a.su.Widget("buttongroup",{defaults:{btnsType:"on/off",handler:null,onHandler:null,onCallback:null,onValue:"on",offValue:"off",lowValue:"low",middleValue:"middle",highValue:"high",offHandler:null,offCallback:null,lowHandler:null,middleHandler:null,highHandler:null,items:null,url:null,cls:"",value:"",proxy:null,field:null,autoLoad:true},create:function(i,c){var e=this;e.each(function(m,l){var n=a(l);a.extend(l,i,c);var r="";if(l.btnsType=="on/off"&&l.items==null){r="on-off-container"}if(l.proxy&&!l.proxy.isProxy){l.proxy=new a.su.Proxy(l.proxy)}var j='<div class="container widget-container button-group-container '+l.cls+" "+r+'">';if(this.fieldLabel!==null){j+='<div class="widget-fieldlabel-wrap '+this.labelCls+'">';j+='<label class="widget-fieldlabel button-group-fieldlabel">'+this.fieldLabel+"</label>";if(this.fieldLabel!==""){j+='<span class="widget-separator">'+this.separator+"</span>"}j+="</div>"}j+='<div class="widget-wrap-outer button-group-wrap-outer">';j+='<div class="widget-wrap button-group-wrap">';j+='<ul class="button-group-container"></ul>';j+="</div>";if(this.tips!=null&&this.tips!=undefined){j+='<div class="widget-tips textbox-tips '+l.tipsCls+'">';j+='<div class="content tips-content"></div>';j+="</div>"}j+='<div class="widget-error-tips textbox-error-tips '+l.errorTipsCls+'">';j+='<span class="widget-error-tips-delta"></span>';j+='<div class="widget-error-tips-wrap">';j+='<div class="content error-tips-content"></div>';j+="</div>";j+="</div>";j+="</div>";j+="</div>";var k=a(j);n.replaceWith(k);k.append(n.addClass("hidden button-group-value"));if(l.items==null){switch(l.btnsType){case"on/off":l.items=[{text:a.su.CHAR.OPERATION.ON,handler:l.onHandler,value:l.onValue,callback:l.onCallback},{text:a.su.CHAR.OPERATION.OFF,handler:l.offHandler,value:l.offValue,callback:l.offCallback}];break;case"low/middle/high":l.items=[{text:a.su.CHAR.OPERATION.LOW,handler:l.lowHandler,value:l.lowValue,callback:l.lowCallback},{text:a.su.CHAR.OPERATION.MIDDLE,handler:l.middleHandler,value:l.middleValue,callback:l.middleCallback},{text:a.su.CHAR.OPERATION.HIGH,handler:l.highHandler,value:l.highValue,callback:l.highCallback}];break;default:return false;break}}var p=l.items,s=k.find("ul.button-group-container");for(var o=0;o<p.length;o++){var t=p[o],q=(o===0)?"fst":(o===(p.length-1)?"lst":"");var j="<li>";j+='<button type="button" value="'+((t.value===undefined||t.value===null)?"":t.value)+'" class="button-group-button '+q+" "+(t.cls||"s")+'" item-index="'+o+'">';j+='<span class="button-text">'+t.text+"</span>";j+="</button>";j+="</li>";s.append(a(j))}});var b=e.closest("div.button-group-container");b.delegate("button.button-group-button","click",function(n){var k=a(this),p=k.val()||k.attr("value"),o=k.closest("ul.button-group-container"),m=e.get(0),r=m.items[k.attr("item-index")];if(!r){return}o.find("button").removeClass("selected");o.find("li").removeClass("selected");k.addClass("selected");k.closest("li").addClass("selected");if(!m.proxy||!m.proxy.isProxy){e.buttongroup("setValue",r.value)}else{var q={},j=e.attr("name"),l=r.value;q[j]=l;m.proxy.write(q,function(){if(r.callback){r.callback.call(e,p)}})}});var h=e.get(0),f=h.value,d=h.proxy,g=h.field;if(f!==undefined&&f!==null){e.buttongroup("setValue",f)}if(d&&d.isProxy){if(!g){return false}d=a(d);d.on("ev_read",function(l,j,k,m){e.buttongroup("loadData",j)});d.on("ev_write",function(l,j,k,m){e.buttongroup("loadData",j)});if(h.autoLoad){h.proxy.read()}}e.buttongroup("setTips",c.tips);return e},loadData:function(e,f){var e=e||this,h=e.get(0),g=h.field,f=f[1]||[];var d=g.name,c=g.mapping||d,b=f[c];e.buttongroup("setValue",b);e.trigger("ev_loadData",[f,b]);return e},setValue:function(e,f){var e=e||this,b=e.closest("div.button-group-container"),g=b.find("input.button-group-value"),f=(f[1]===null||f[1]===undefined)?"":f[1],c=e.get(0).items;var d=b.find("button.button-group-button");d.removeClass("selected").closest("li").removeClass("selected");d.each(function(k,m){var j=a(m),h=m.value||j.attr(f)||j.val(),l=c[k];if(f==h){if(l.handler){l.handler.call(e,f)}if(m.handler){m.handler.call(e,f)}j.addClass("selected").closest("li").addClass("selected");return false}});g.val(f);return e},getValue:function(c){var c=c||this,b=c.closest("div.button-group-container"),d=b.find("input.button-group-value");return d.val()},getProxy:function(b){var b=b||this,c=b.get(0);if(c&&c.proxy&&c.proxy.isProxy){return c.proxy}else{return undefined}},disable:function(b){var b=b||this;container=b.closest("div.button-group-container"),buttons=container.find("button.button-group-button");buttons.prop("disabled",true);container.addClass("disabled");return b},enable:function(b){var b=b||this;container=b.closest("div.button-group-container"),buttons=container.find("button.button-group-button");buttons.prop("disabled",false);container.removeClass("disabled");return b}})})(jQuery);