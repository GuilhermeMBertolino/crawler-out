(function(a){a.su.Widget("switchbutton",{defaults:{handler:null,onHandler:null,onCallback:null,onValue:"on",offValue:"off",onText:a.su.CHAR.OPERATION.ON,offText:a.su.CHAR.OPERATION.OFF,offHandler:null,offCallback:null,cls:"",proxy:null,field:null,autoLoad:true},create:function(i,d){var f=this;f.each(function(l,n){var k=a(n);a.extend(n,i,d);if(n.proxy&&!n.proxy.isProxy){n.proxy=new a.su.Proxy(n.proxy)}var m='<div class="container widget-container switch-button-container off '+n.cls+'">';if(n.fieldLabel!==null){m+='<div class="widget-fieldlabel-wrap '+n.labelCls+'">';m+='<label class="widget-fieldlabel switch-button-fieldlabel">'+n.fieldLabel+"</label>";if(n.fieldLabel!==""){m+='<span class="widget-separator">'+n.separator+"</span>"}m+="</div>"}m+='<div class="widget-wrap-outer switch-button-wrap-outer">';m+='<a class="switch-button-btn off" href="javascript:void(0);">';m+='<span class="switch-button-btn-wrap">';m+='<span class="switch-button-text-wrap">';m+='<span class="switch-button-text on">'+n.onText+"</span>";m+='<span class="switch-button-text off">'+n.offText+"</span>";m+="</span>";m+='<span class="switch-button-btn-slider"></span>';m+="</span>";m+="</a>";m+='<div class="loading-wrap">';m+='<div class="loading-wrap-outer">';m+='<span class="loading"></span>';m+="</div>";m+="</div>";if(this.tips!=null&&this.tips!=undefined){m+='<div class="widget-tips switch-button-tips '+n.tipsCls+'">';m+='<div class="content tips-content"></div>';m+="</div>"}m+='<div class="widget-error-tips switch-button-error-tips '+n.errorTipsCls+'">';m+='<span class="widget-error-tips-delta"></span>';m+='<div class="widget-error-tips-wrap">';m+='<div class="content error-tips-content"></div>';m+="</div>";m+="</div>";m+="</div>";m+="</div>";var j=a(m);k.replaceWith(j);j.prepend(k.addClass("hidden"))});var b=f.closest("div.switch-button-container");b.delegate("a.switch-button-btn","click",function(p){var m=a(this);var o=f.get(0);if(m.hasClass("disabled")){return}var n=o.defaultValue;if(m.hasClass("on")){n=o.offValue}else{n=o.onValue}f.switchbutton("startWaiting");var l=o.proxy;if(!l||!l.isProxy){f.switchbutton("setValue",n);f.switchbutton("stopWaiting")}else{var j={};var k=f.attr("name");j[k]=n;l.write(j,function(){f.switchbutton("stopWaiting")},function(){f.switchbutton("stopWaiting")},function(){f.switchbutton("stopWaiting")})}f.trigger("ev_click")});var h=f.get(0);var c=h.value||h.defaultValue;if(c){f.switchbutton("setValue",c)}var e=h.proxy;var g=h.field;if(e&&e.isProxy){if(!g){return false}e=a(e);e.on("ev_read",function(l,j,k,m){f.switchbutton("loadData",j)}).on("ev_write",function(l,j,k,m){f.switchbutton("loadData",j)});if(h.autoLoad){h.proxy.read()}}return f},loadData:function(i,f){var i=i||this;var e=i.get(0);var j=e.field;var f=f[1];var d=j.name;var c=j.mapping||d;var k=f[c];i.switchbutton("setValue",k);var g=e.onValue;var b=e.onCallback;var h=e.offCallback;if(g==k){if(b){b.call(i,k)}}else{if(h){h.call(i,k)}}i.trigger("ev_loadData",[f,k]);return i},getValue:function(d){var d=d||this;var e=d.get(0);var b=d.closest("div.switch-button-container");var c=b.find("a.switch-button-btn");if(c.hasClass("on")){return e.onValue}else{return e.offValue}},setValue:function(j,k){var j=j||this;var g=j.get(0);var k=k[1]||g.offValue;var d="";var h="";d=j.val();var i=g.onValue;var f=g.offValue;var b=j.closest("div.switch-button-container");var e=b.find("a.switch-button-btn");var c=e.find("span.switch-button-btn-slider");if(i==k){h=i;c.css({right:0,left:"inherit"});e.addClass("on");b.addClass("on");e.removeClass("off");b.removeClass("off");if(g.handler){g.handler.call(j,k)}if(g.onHandler){g.onHandler.call(j,k)}}else{h=f;c.css({right:"inherit",left:0});e.removeClass("on");b.removeClass("on");e.addClass("off");b.addClass("off");if(g.handler){g.handler.call(j,k)}if(g.offHandler){g.offHandler.call(j,k)}}j.val(k);if(d!=h){j.trigger("ev_change",[d,h])}return j},disable:function(d){var d=d||this;var b=d.closest("div.switch-button-container");var c=b.find("a.switch-button-btn");b.addClass("disabled");c.addClass("disabled");return d},enable:function(d){var d=d||this;var b=d.closest("div.switch-button-container");var c=b.find("a.switch-button-btn");b.removeClass("disabled");c.removeClass("disabled");return d},startWaiting:function(d){var d=d||this;var b=d.closest("div.switch-button-container");var c=b.find("a.switch-button-btn");c.addClass("disabled");b.find("div.loading-wrap-outer").fadeIn(50);return d},stopWaiting:function(d){var d=d||this;var b=d.closest("div.switch-button-container");var c=b.find("a.switch-button-btn");b.find("div.loading-wrap-outer").fadeOut(50,function(){c.removeClass("disabled")});return d}})})(jQuery);