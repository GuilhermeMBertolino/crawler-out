(function(a){a.su.Widget("textbox",{defaults:{readOnly:false,isvalid:false,fieldLabel:"",tips:"",hint:"",validator:null,invalidText:a.su.CHAR.VTYPETEXT.INVALIDTEXT,vtype:null,vtypeText:null,allowBlank:true,blankText:a.su.CHAR.VTYPETEXT.BLANKTEXT,cls:"",validateIcon:false,textFormat:null,autoTrim:true,checkFocusTarget:null},create:function(f,d){var c=false;var e=this;e.each(function(n,m){var o=a(this);if(!o.is("input")){return null}a.extend(this,f,d);var k=d.id||this.id||a.su.randomId("textbox"),p=d.value||o.val()||o.attr("value")||f.value,h=d.name||o.attr("name")||this.name||f.name;a(this).attr({value:p,id:k,name:h}).val(p).addClass("text-text "+this.inputCls);if(this._maxLength){a(this).attr("maxlength",this._maxLength)}var g='<div class="container widget-container text-container '+this.cls+'">';if(this.fieldLabel!==null){g+='<div class="widget-fieldlabel-wrap '+this.labelCls+'">';g+='<label class="widget-fieldlabel text-fieldlabel">'+this.fieldLabel+"</label>";if(this.fieldLabel!==""){g+='<span class="widget-separator">'+this.separator+"</span>"}g+="</div>"}g+='<div class="widget-wrap-outer text-wrap-outer">';g+='<div class="widget-wrap text-wrap">';g+='<span class="text-wrap-before"></span>';g+='<span class="text-wrap"></span>';g+='<span class="text-wrap-after"></span>';if(this.hint){g+='<span class="hint text-hint">';g+='<input class="text-hint" value="'+this.hint+'" tabindex="-1" contenteditable="false" readonly="readonly"/>';g+="</span>"}g+="</div>";if(this.validateIcon){g+='<span class="widget-validate-icon"></span>'}if(this.tips!=null&&this.tips!=undefined){g+='<div class="widget-tips textbox-tips '+this.tipsCls+'">';g+='<div class="content tips-content"></div>';g+="</div>"}g+='<div class="widget-error-tips textbox-error-tips '+this.errorTipsCls+'">';g+='<span class="widget-error-tips-delta"></span>';g+='<div class="widget-error-tips-wrap">';g+='<div class="content error-tips-content"></div>';g+="</div>";g+="</div>";g+="</div>";g+="</div>";var j=a(g);o.replaceWith(j);j.find("span.text-wrap").append(o);if(this.vtype){var l=this.vtype;if(this.vtypeText){this.vtype.vtypeText=this.vtypeText}this.vtype=new a.su.vtype(l)}if(this.readOnly){j.addClass("read-only");a(this).attr("readOnly",true)}if(this.checkFocusTarget){var j=e.closest("div.widget-container");j.delegate("input.text-text","blur",function(q){var i=this.checkFocusTarget;setTimeout(function(){if(i(q)){clearTimeout(c)}},10)})}});var b=e.closest("div.widget-container");b.delegate("input.text-text","click",function(g){g.stopPropagation()}).delegate("input.text-text","focus",function(g){b.find("input.text-hint").fadeOut(50);a(this).textbox("setFocus")}).delegate("input.text-text","blur",function(h){if(a(this).attr("readonly")!=="readonly"){var g=a(this);c=setTimeout(function(){g.textbox("validate")},20)}}).delegate("input.text-text","keyup",function(g){a(this).trigger("ev_change",[a(this).val()])}).delegate("input.text-text","setValue",function(g){a(this).textbox("validate")}).delegate("input.text-text","blur",function(h){var i=a(this);var g=this.autoTrim?a.trim(i.val()):i.val();i.val(g);i.textbox("removeFocus");if(!g){b.find("input.text-hint").css({display:"inline"})}}).delegate("input.text-text","ev_validatechange",function(i,h,g){i.stopPropagation();if(h){a(this).textbox("setValid")}else{a(this).textbox("setError",g)}}).delegate("input.text-hint","focus click",function(g){g.preventDefault();a(this).fadeOut(50,function(h){e.focus()})});setTimeout(function(){if(e.val()!==""){b.find("input.text-hint").css("display","none")}},100);e.textbox("setTips",d.tips);return e},validate:function(e,d){var e=e||this,c=e.get(0),d=(d[1]===false)?false:true;var b=false,f=c.autoTrim?a.trim(c.value):c.value;if(a.type(c.textFormat)=="function"){f=c.textFormat(f);a(c).val(f)}var h=function(i,j,k){if(j===true){if(d){a(i).trigger("ev_validatechange",[true,i.tips])}return true}else{if(!j){j=i.tips}if(d){a(i).trigger("ev_validatechange",[false,j])}return false}};if(c){if(f===""){if(c.allowBlank!==true){b=false;return h(c,c.blankText)}else{b=true;return h(c,true)}}else{var g=c.vtype;if(g&&g.isVtype===true){b=g.validate(f);if(b!==true){if(b===false){return h(c,g.vtypeText)}else{return h(c,b)}}}if(c.validator){b=c.validator(c.value);if(a.type(b)!=="boolean"){return h(c,b)}if(b!==true){return h(c,c.invalidText)}}}return h(c,true)}return b},disable:function(c){var c=c||this,b=c.textbox("getContainer");b.addClass("disabled");c.prop("disabled",true);return c},enable:function(c){var c=c||this,b=c.textbox("getContainer");b.removeClass("disabled");c.prop("disabled",false);return c},setReadonly:function(c){var c=c||this,b=c.textbox("getContainer");b.addClass("read-only");c.attr("readonly","readonly");return c},removeReadonly:function(c){var c=c||this,b=c.textbox("getContainer");b.removeClass("read-only");c.removeAttr("readonly");return c},setTitle:function(c,b){var c=c||this,e=c.get(0),d=b[1];if(d){e.title=d}return c},setValue:function(c,b){var c=c||this,e=c.get(0),d=b[1],f=c.closest("div.text-container").find("span.hint");c.attr("snapshot",d);if(d===""||d===undefined||d===null){c.val("");if(e&&e.hint){f.css("display","block")}}else{c.val(d);if(e&&e.hint){f.css("display","none")}}return c},getValue:function(b){var b=b||this;return b.val()},getContainer:function(b){var b=b||this;return b.closest("div.text-container")}})})(jQuery);