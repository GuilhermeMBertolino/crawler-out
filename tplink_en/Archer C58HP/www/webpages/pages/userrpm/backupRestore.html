<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<style type="text/css">
div.button-container.submit button.button-button{
	min-width:122px;
}
</style>
</head>
<body>
<div class="func-container">
	<div id="backup_cnt">
		<form id="backup-setting" enctype="multipart/form-data">
			<p id="backupNote" name="backupNote" class="note first-line"></p>
			<button type="button" id="backup" name="backup"></button>
		</form>
	</div>
	<div id="restore_cnt">
		<div id="restore-setting">
			<p id="restoreNote" name="restoreNote" class="note first-line"></p>
			<input id="file" name="archive" type="file" />
			<button type="button" id="restore" name="restore"></button>
		</div>
	</div>
	<div id="factory_cnt">
		<div id="factory-setting">
			<p id="factoryNote" name="factoryNote" class="note first-line"></p>
			<button type="button" id="factory" name="factory"></button>
		</div>
	</div>
	<div id="restore_alert_cnt">
		<h4 class="title" id="restore_confirm_cnt">
			<span class="icon"></span>
			<span class="text" id="restore_confirm_content"></span>
		</h4>
		<div id="restore_pro_cnt" class="reboot-loading-msg hidden">
			<p id="restore_note" class="reboot-progressbar-text"></p>
			<input id="restore_pro_bar" type="text" />
		</div>
	</div>
	<div id="restore_failed_cnt">
		<h4 class="title">
			<span class="icon" ></span>
			<span class="text" id="error_str"></span>
		</h4>
	</div>
	<div id="factory_alert_cnt">
		<h4 class="title"  id="factory_confirm_cnt">
			<span class="icon"></span>
			<span class="text" id="factory_confirm_content"></span>
		</h4>
		<div id="factory_pro_cnt" class="reboot-loading-msg hidden">
			<p id="factory_note" class="reboot-progressbar-text"></p>
			<input id="factory_pro_bar" type="text" />
		</div>
	</div>
	<div id="factory_failed_cnt">
		<h4 class="title">
			<span class="icon" ></span>
			<span class="text" id="factory_error_str"></span>
		</h4>
	</div>
	<div id="help_backup"></div>
</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(r){var c=2*60*1000;var d=false;var l=false;var a=2*60*1000;var j=false;var b="./data/system.backup.json";var m=$.su.url("/admin/firmware?form=config");$("div.func-container").page({title:$.su.CHAR.BACKUP.TITLE,help:""});$("#backup_cnt").panel({title:$.su.CHAR.BACKUP.BACKUP,collapsible:false});$("#restore_cnt").panel({title:$.su.CHAR.BACKUP.RESTORE,collapsible:false});$("#factory_cnt").panel({title:$.su.CHAR.BACKUP.FACTORY,collapsible:false});$("#restore_note").html($.su.CHAR.BACKUP.RESTORE_WARN);$("#factory_note").html($.su.CHAR.BACKUP.FACTORY_WARN);$("p#backupNote").html($.su.CHAR.BACKUP.BACKUPTIP);$("p#restoreNote").html($.su.CHAR.BACKUP.RESTORETIP);$("p#factoryNote").html($.su.CHAR.BACKUP.FACTORYTIP);$("#file").file({fieldLabel:$.su.CHAR.BACKUP.FILE,allowBlank:false,extension:"bin"});$("#backup-setting").form({proxy:{url:m},formEnctype:"multipart/form-data",traditional:true,hiddenFrame:true,autoLoad:false});$("#restore-setting").form({proxy:{url:m},formEnctype:"multipart/form-data",traditional:true,hiddenFrame:true,fields:[{name:"archive"}],autoLoad:true}).on("ev_loadData",function(u,t){c=Number(t.totaltime*1000||c);a=Number(t.totaltime*1000||a)});$("#factory-setting").form({proxy:{url:m},formEnctype:"multipart/form-data",traditional:true,hiddenFrame:true,autoLoad:false});var n=new $.su.Proxy({url:m});var p=new $.su.Proxy({url:m});var g=new $.su.Proxy({url:m});$("#backup").button({text:$.su.CHAR.BACKUP.BACKUPBTN,cls:"submit",handler:function(){n.write({operation:"check"},function(t){$("#backup-setting").form("submit",{operation:"backup"})})}});$("#restore").button({text:$.su.CHAR.BACKUP.RESTOREBTN,handler:function(){p.write({operation:"check"},function(){if($("#restore-setting").form("validate")){$("#restore_alert_cnt").msg("show")}else{return false}})},cls:"submit"});function f(){p.write({operation:"check"},function(t){},function(u){function v(){$("#restore_failed_cnt").msg("show",function(){})}if(l){clearTimeout(l);l=false}function t(){clearTimeout(d);h.progressbar("stop");h.progressbar("reset");d=false;$("#restore_alert_cnt").hide();$("#restore_alert_cnt").msg("close",function(){$("#restore_alert_cnt").msg("showButtons");$("#restore_confirm_cnt").show();$("#restore_pro_cnt").hide()})}if(u=="err_form"){$("#error_str").html($.su.CHAR.ERROR["00000001"]);t();v()}else{if(u=="err_check"){$("#error_str").html($.su.CHAR.ERROR["00000002"]);t();v()}else{if(u=="err_sizex"){$("#error_str").html($.su.CHAR.ERROR["00000003"]);t();v()}else{if(u=="err_flash"){$("#error_str").html($.su.CHAR.ERROR["00000004"]);t();v()}else{if(u=="err_reboot"){$("#error_str").html($.su.CHAR.ERROR["00000005"]);t();v()}else{if(u=="err_other"){$("#error_str").html($.su.CHAR.ERROR["00000006"]);t();v()}else{if(u=="err_failed"){$("#error_str").html($.su.CHAR.ERROR["00000136"]);t();v()}else{t()}}}}}}}})}function q(){$("#restore-setting").form("submit",{operation:"restore"},function(){clearTimeout(d);d=setTimeout(f,1000);if(l){clearTimeout(l);l=false}l=setTimeout(function(){h.progressbar("animate",0,1,c,function(){if(localStorage){localStorage.setItem("token","")}location.href="http://tplinkwifi.net"})},1200)},function(){clearTimeout(d);f()},function(){})}$("#restore_failed_cnt").msg({cls:"warning reboot-confirm-size",type:"alert"});$("#restore_alert_cnt").msg({okHandler:function(){$("#restore_alert_cnt").msg("hideButtons");$("#restore_confirm_cnt").hide();$("#restore_pro_cnt").show();q();return false},cancelHandler:function(){return true},cls:"warning reboot-confirm-size",closeBtn:false,type:"confirm"});var h=$("input#restore_pro_bar").progressbar({fieldLabel:null,cls:"inline",width:326,height:6,value:0});$("#confirm_content").html($.su.CHAR.FIRMWARE.CONFIRM_CONTENT);function o(){g.write({operation:"check"},function(t){},function(u){function v(){$("#factory_failed_cnt").msg("show")}function t(){clearTimeout(j);k.progressbar("stop");k.progressbar("reset");j=false;$("#factory_alert_cnt").hide();$("#factory_alert_cnt").msg("close",function(){$("#factory_alert_cnt").msg("showButtons");$("#factory_confirm_cnt").show();$("#factory_pro_cnt").hide()})}if(u=="err_form"){$("#factory_error_str").html($.su.CHAR.ERROR["00000001"]);t();v()}else{if(u=="err_check"){$("#factory_error_str").html($.su.CHAR.ERROR["00000002"]);t();v()}else{if(u=="err_sizex"){$("#factory_error_str").html($.su.CHAR.ERROR["00000003"]);t();v()}else{if(u=="err_flash"){$("#factory_error_str").html($.su.CHAR.ERROR["00000004"]);t();v()}else{if(u=="err_reboot"){$("#factory_error_str").html($.su.CHAR.ERROR["00000005"]);t();v()}else{if(u=="err_other"){$("#factory_error_str").html($.su.CHAR.ERROR["00000006"]);t();v()}else{if(u=="err_failed"){$("#factory_error_str").html($.su.CHAR.ERROR["00000136"]);t();v()}else{t()}}}}}}}})}function i(){g.write({operation:"factory"},function(t){clearTimeout(j);j=setTimeout(o,1000);k.progressbar("animate",0,1,a,function(){if(localStorage){localStorage.setItem("token","")}location.href="http://tplinkwifi.net"})},function(){clearTimeout(j);o()},function(){})}$("#factory_failed_cnt").msg({cls:"warning reboot-confirm-size",type:"alert"});$("#factory_alert_cnt").msg({okHandler:function(){$("#factory_alert_cnt").msg("hideButtons");$("#factory_confirm_cnt").hide();$("#factory_pro_cnt").show();i();return false},cancelHandler:function(){return true},cls:"warning reboot-confirm-size",closeBtn:false,type:"confirm"});var k=$("input#factory_pro_bar").progressbar({fieldLabel:null,cls:"inline",width:326,height:6,value:0});$("#factory").button({text:$.su.CHAR.BACKUP.FACTORYBTN,handler:function(){g.write({operation:"check"},function(t){$("#factory_alert_cnt").msg("show")})},cls:"submit"});$.su.app.runningModule.addUnloadHandler(function(){if(d){clearTimeout(d);d=false}if(j){clearTimeout(j);j=false}h.progressbar("stop");h.progressbar("reset");k.progressbar("stop");k.progressbar("reset")});$("#restore_confirm_content").html($.su.CHAR.BACKUP.RESTORE_CONFIRM_CONTENT);$("#factory_confirm_content").html($.su.CHAR.BACKUP.FACTORY_CONFIRM_CONTENT);var s=new $.su.Help({container:"div#help_backup",content:["BACKUP","RESTORE","FACTORY"]})});</script>
</body>
</html>
