<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Internet</title>
<style type="text/css">
	div.container.widget-container.text-container.offset{
		position: absolute;
		top:200px;
		left:540px;
	}
</style>
</head>
<body>
<div class="func-container">
	 <div id="bandwidth-panel">
	 	<form id="bandwidth_setting">
	    	<input id="enable_streamboost" name="enable_streamboost" />
	    	<input type="text"  id="up_limitation_mbps" name="uplimit" />
	    	<input type="text"  id="down_limitation_mbps" name="downlimit"/>
	    	<input id="enable_auto" name="enable_auto" />
	    	<span id="manual_test" class="test-bandwidth inlineBlock"></span>
	    	<input id="manual_testing" name="" />
	    	<input id="manual_failed" name="" />
	    	<input id="manual_success" name="" />
	    	<input id="auto_update" name="auto_update" />
	    	<button id="save_setting_btn" type="button"></button>
	    </form>
	 </div>
	 <div id="bandwidth_help"></div>
</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(f){var h=0;var k=0;$("div.func-container").page({title:"Bandwidth",help:""});$("span#manual_test").html($.su.CHAR.BANDWIDTH.TEST_BANDWIDTH);var l=false;$("div#bandwidth-panel").panel({title:$.su.CHAR.BANDWIDTH.BANDWIDTH,collapsible:false});$("input#enable_streamboost").checkbox({fieldLabel:$.su.CHAR.BANDWIDTH.STREAMBOOST,labelCls:"l",items:[{boxlabel:$.su.CHAR.BANDWIDTH.ENABLE_STREAMBOOST,inputValue:1,uncheckedValue:0}]});$("input#up_limitation_mbps").textbox({fieldLabel:$.su.CHAR.BANDWIDTH.UP_LIMITATION,labelCls:"l"});$("input#down_limitation_mbps").textbox({fieldLabel:$.su.CHAR.BANDWIDTH.DOWN_LIMITATION,labelCls:"l"});$("input#manual_testing").textbox({fieldLabel:$.su.CHAR.BANDWIDTH.RUN_BANDWIDTH_TEST,labelCls:"l",cls:"hidden",readOnly:true,value:$.su.CHAR.BANDWIDTH.TESTING});$("input#manual_failed").textbox({fieldLabel:$.su.CHAR.BANDWIDTH.RUN_BANDWIDTH_TEST,labelCls:"l",cls:"hidden",readOnly:true,value:$.su.CHAR.BANDWIDTH.TEST_FAILED});$("input#manual_success").textbox({fieldLabel:$.su.CHAR.BANDWIDTH.RUN_BANDWIDTH_TEST,labelCls:"l",cls:"hidden",readOnly:true,value:$.su.CHAR.BANDWIDTH.TEST_SUCCEED});$("input#enable_auto").checkbox({fieldLabel:$.su.CHAR.BANDWIDTH.RUN_BANDWIDTH_TEST,cls:"inlineBlock",labelCls:"l",items:[{boxlabel:$.su.CHAR.BANDWIDTH.ENABLE_AUTOMATIC_TEST,inputValue:1,uncheckedValue:0,checked:false}]}).on("ev_change",function(q,o,p){if((p.length==0||p[0]==0)&&!l){$("span#manual_test").show()}else{$("span#manual_test").hide()}});var i=$.su.ozkerurl("/api/aperture");var g=new $.su.Proxy({url:i,preventErrorDefault:true,reader:{root:"data",type:"PUT"},writer:{root:"data",type:"PUT"}});$("span#manual_test").click(function(){$("input#enable_auto").checkbox("hide");$("input#manual_testing").textbox("show");$(this).hide();g.read({},function(q,p,s){if(!q.measuring&&(q.last.retcode==0||q.last.retcode==-99)){$("input#manual_testing").textbox("hide");$("input#manual_success").textbox("show");var r=setTimeout(function(){$("input#enable_auto").checkbox("show");$("span#manual_test").show();$("input#manual_success").textbox("hide");$(this).show();$("input#up_limitation_mbps").textbox("setValue",q.last.up*8/1000000);$("input#down_limitation_mbps").textbox("setValue",q.last.down*8/1000000)},1000)}else{if(!q.measuring&&q.last.retcode!=0&&q.last.retcode!=-99){$("input#manual_testing").textbox("hide");$("input#manual_failed").textbox("show");$(this).show();var r=setTimeout(function(){$("input#enable_auto").checkbox("show");$("span#manual_test").show();$("input#manual_failed").textbox("hide")},1000)}else{h=setInterval(function(){m.read({},function(u,t,w){if(!u.measuring&&(u.last.retcode==0||u.last.retcode==-99)){$("input#manual_testing").textbox("hide");$("input#manual_success").textbox("show");clearInterval(h);var v=setTimeout(function(){$("input#enable_auto").checkbox("show");$("span#manual_test").show();$("input#manual_success").textbox("hide");$(this).show();$("input#up_limitation_mbps").textbox("setValue",u.last.up*8/1000000);$("input#down_limitation_mbps").textbox("setValue",u.last.down*8/1000000)},1000)}else{if(!u.measuring&&u.last.retcode!=0&&u.last.retcode!=-99){$("input#manual_testing").textbox("hide");$("input#manual_failed").textbox("show");clearInterval(h);$(this).show();var v=setTimeout(function(){$("input#enable_auto").checkbox("show");$("span#manual_test").show();$("input#manual_failed").textbox("hide")},1000)}}})},1000)}}})});$("input#auto_update").checkbox({fieldLabel:$.su.CHAR.BANDWIDTH.KEEP_UP_TO_DATE,labelCls:"l",items:[{boxlabel:$.su.CHAR.BANDWIDTH.ENABLE_AUTOMATIC_UPDATE,inputValue:1,uncheckedValue:0}]});$("button#save_setting_btn").button({fieldLabel:null,text:"Save",cls:"submit",handler:function(){clearInterval(h);clearInterval(k);var o=$("form#bandwidth_setting").form("serialize");o.uplimit=o.uplimit*1000000/8;o.downlimit=o.downlimit*1000000/8;d.write(o,function(r,q,s){r.uplimit=r.uplimit*8/1000000;r.downlimit=r.downlimit*8/1000000;$("form#bandwidth_setting").form("loadData",r);var p=setTimeout(function(){m.read({},function(v,t,u){n(v)})},10000)})}});var b=$.su.url("/admin/streamboost");var d=new $.su.Proxy({url:b,preventErrorDefault:true});$("form#bandwidth_setting").form({proxy:null,preventErrorDefault:true,fields:[{name:"enable_streamboost",mapping:"enable_streamboost"},{name:"uplimit",mapping:"uplimit"},{name:"downlimit",mapping:"downlimit"},{name:"enable_auto",mapping:"enable_auto"},{name:"auto_update",mapping:"auto_update"}],autoLoad:false,submitBtn:false});d.read({},function(q,o,p){q.uplimit=q.uplimit*8/1000000;q.downlimit=q.downlimit*8/1000000;$("form#bandwidth_setting").form("loadData",q)});var i=$.su.ozkerurl("/api/aperture");var m=new $.su.Proxy({url:i,reader:{root:"data",type:"GET"},writer:{root:"data",type:"GET"}});var c=$.su.ozkerurl("/api/bw_config");var a=new $.su.Proxy({url:c,preventErrorDefault:true,reader:{root:"data",type:"GET"},writer:{root:"data",type:"GET"}});function n(o){if(!o.running&&!o.measuring){l=false;return}else{if(!o.running&&o.measuring){l=false;$("input#enable_auto").checkbox("hide");$("span#manual_test").hide();$("input#manual_testing").textbox("show");h=setInterval(function(){m.read({},function(q,p,s){if(!q.measuring&&(q.last.retcode==0||q.last.retcode==-99)){$("input#manual_testing").textbox("hide");$("input#manual_success").textbox("show");clearInterval(h);var r=setTimeout(function(){$("input#enable_auto").checkbox("show");$("span#manual_test").show();$("input#manual_success").textbox("hide");$("input#up_limitation_mbps").textbox("setValue",q.last.up*8/1000000);$("input#down_limitation_mbps").textbox("setValue",q.last.down*8/1000000)},1000)}else{if(!q.measuring&&q.last.retcode!=0&&q.last.retcode!=-99){$("input#manual_testing").textbox("hide");$("input#manual_failed").textbox("show");clearInterval(h);var r=setTimeout(function(){$("input#enable_auto").checkbox("show");$("span#manual_test").show();$("input#manual_failed").textbox("hide")},1000)}}})},1000)}else{if(o.running){l=true;k=setInterval(function(){if(!l){clearInterval(k);return}a.read({},function(q,p,r){$("input#up_limitation_mbps").textbox("setValue",q.bw_config.up_limit*8/1000000);$("input#down_limitation_mbps").textbox("setValue",q.bw_config.down_limit*8/1000000)})},1000)}}}}m.read({},function(q,o,p){n(q)});$.su.app.runningModule.addUnloadHandler(function(){clearInterval(h);clearInterval(k)});var j=new $.su.Help({container:"div#bandwidth_help",content:"STREAM_BOOST_BANDWIDTH"})});</script>
</body>
</html>