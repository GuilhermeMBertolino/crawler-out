<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Internet</title>
<script src="./js/libs/jquery.flot.js"></script>
<script src="./js/libs/jquery.flot.pie.min.js"></script>
<style type="text/css">
	div.container.widget-container.text-container.offset{
		position: absolute;
		top:200px;
		left:540px;
	}
</style>
</head>
<body>
<div class="func-container">
	 <div id="uptime_panel">
	 	<input id="chooseByTime"/>
	 	<input id="chooseByDevice"/>
	 	<div id="uptimeGrid" style="width:670px; height:400px;"></div>
	 </div>
	 <div id="downloads_panel">
	 	<div id="downloadsGrid" style="width:600px; height:600px;"></div>
	 </div>
	 <div id="statistics_help"></div>
</div>
<script type="text/javascript">function jsonpFlowsCallback(a){flowsName=a.flows}$(document).ready(function(x){var k=[];var d=$.su.ozkerurl("/api/global");var j=new $.su.Proxy({url:d,async:false,preventErrorDefault:true,reader:{root:"data",type:"GET"},});var n=$.su.ozkerurl("/api/events/flows");var s=new $.su.Proxy({url:n,async:false,preventErrorDefault:true,reader:{root:"data",type:"GET"},});var v=$.su.ozkerurl("/api/policies");var i=new $.su.Proxy({url:v,async:false,preventErrorDefault:true,reader:{root:"data",type:"GET"},writer:{root:"data",type:"GET"}});var o={};var p=0;var y={};var w=[];var u=[];var c={};var q={};var r={};var b=[];var g=24*60*60;var a=g*7;var t=g*30;function l(A,e){return A.time-e.time}function z(A,e){return A.rxBytes-e.rxBytes}$.ajax({url:"http://static.ap135.qualcomm.streamboost.yeti.bigfootnetworks.com/luci-app-streamboost-assets/v2.0/trans/flows_EN-US.js?callback=jsonpFlowsCallback",dataType:"jsonp",jsonp:"callback",async:false,success:function(e){}});function f(I,N){var L={};var M=[];var K=[];var J=[];if(N=="0"){for(var H in q){for(var B in q[H]){L[B]=q[H][B]}}}else{for(var B in q[N]){L[B]=q[N][B]}}for(var H in L){M[L[H].policyName]==undefined?M[L[H].policyName]=0:1;if(L[H].closeTime&&L[H].closeTime<=I){continue}if(L[H].openTime>=I){M[L[H].policyName]+=L[H].wholeTime;continue}if(L[H].openTime<I){for(var E=0;E<L[H][H].length;E++){if((E+1)<=(L[H][H].length-1)&&L[H][H][E].time<I&&L[H][H][E+1].time>=I){M[L[H].policyName]+=(L[H][H][L[H][H].length-1].time-L[H][H][E+1].time)}else{if(L[H][H][E].time<I&&E==L[H][H].length-1){M[L[H].policyName]+=(L[H][H][L[H][H].length-1].time-L[H][H][E].time)}}}}}var G=[];for(var H in M){G.push({name:H,num:M[H]})}function C(P,e){return e.num-P.num}G.sort(C);if(G.length>5){G=G.slice(G.length-6)}var F=0;var A=0;for(var E=0;E<G.length;E++){o[G[E]["name"]]==undefined?1:G[E]["name"]=o[G[E]["name"]];K.push([F,G[E]["name"]]);J.push([F,G[E].num/60]);F++;if(A<G[E].num/60){A=G[E].num/60}}A=Number(Math.ceil(A));if(A>=0&&A<5){A=5}else{if(A>=5&&A<10){A=10}else{if(A>=10){var D=A.toString();if(Number(D[1])<5){A=(Number(D[0]+"5"))*(Math.pow(10,D.length-2))}else{if(Number(D[1])>=5){A=(Number(D[0])+1)*(Math.pow(10,D.length-1))}}}}}var O=$.plot($("#uptimeGrid"),[{bars:{show:true,barWidth:0.6},data:J}],{shadowSize:5,highlightColor:"red",legend:{noColumns:1,position:"sw",margin:10,backgroundColor:"#CEDF99",backgroundOpacity:0.5},xaxis:{max:6,min:0,tickColor:"#ccc",tickSize:1,labelWidth:10,ticks:K},yaxis:{ticks:10,max:A,min:0},grid:{aboveData:true,color:"#4D8CBC",borderColor:"#6A9F7F",labelMargin:5,minBorderMargin:null,axisMargin:5},crosshair:{mode:"x"}})}$("div.func-container").page({title:$.su.CHAR.STREAMBOOST_STATISTICS.STATISTICS,help:""});var m=false;$("div#uptime_panel").panel({title:$.su.CHAR.STREAMBOOST_STATISTICS.UP_TIME,collapsible:false});$("div#downloads_panel").panel({title:$.su.CHAR.STREAMBOOST_STATISTICS.DOWNLOADS,collapsible:false});$("input#chooseByTime").combobox({fieldLabel:null,disabled:true,items:[{name:$.su.CHAR.STREAMBOOST_STATISTICS.LAST_DAY,cls:"m",value:"0",selected:true},{name:$.su.CHAR.STREAMBOOST_STATISTICS.LAST_WEEK,cls:"m",value:"1"},{name:$.su.CHAR.STREAMBOOST_STATISTICS.LAST_MONTH,cls:"m",value:"2"}]}).on("ev_change",function(C,A,B){switch(B[0]){case"0":f(p-g,$("input#chooseByDevice").combobox("getValue")[0]);break;case"1":f(p-a,$("input#chooseByDevice").combobox("getValue")[0]);break;case"2":f(p-t,$("input#chooseByDevice").combobox("getValue")[0]);break}});$("input#chooseByDevice").combobox({fieldLabel:null,disabled:true,items:[{name:$.su.CHAR.STREAMBOOST_STATISTICS.ALL_LAN_HOSTS,value:"0",selected:true}]}).on("ev_change",function(C,A,B){if(B[0]=="0"){switch($("input#chooseByTime").combobox("getValue")[0]){case"0":f(p-g,"0");break;case"1":f(p-a,"0");break;case"2":f(p-t,"0");break}}else{switch($("input#chooseByTime").combobox("getValue")[0]){case"0":f(p-g,B[0]);break;case"1":f(p-a,B[0]);break;case"2":f(p-t,B[0]);break}}});$("input#chooseByTime").combobox("disable");$("input#chooseByDevice").combobox("disable");i.read({},function(B,A,D){for(var C in B){y[C]=B[C]}s.read({},function(E,e,F){w=E.events.sort(l);j.read({},function(K,I,O){p=K.epoch;for(var L=0;L<w.length;L++){u[w[L].uuid]==undefined?u[w[L].uuid]=[]:1;u[w[L].uuid].push(w[L])}for(var N in u){c[N]={};c[N][N]=u[N];for(var L=0;L<u[N].length;L++){c[N]["wholeTime"]=u[N][u[N].length-1].time-u[N][0].time;if(u[N][L]["event"]=="open"){c[N]["openTime"]=u[N][L].time;c[N]["policyName"]=y[u[N][L].details.policy_id].emit;u[N][L].details.tx_bytes=0;u[N][L].details.rx_bytes=0}c[N]["txBytes"]=u[N][u[N].length-1].details.tx_bytes-u[N][0].details.tx_bytes;c[N]["rxBytes"]=u[N][u[N].length-1].details.rx_bytes-u[N][0].details.rx_bytes;if(u[N][L].event=="close"){c[N]["closeTime"]=u[N][L].time}}}for(var N in c){if(c[N].policyName!=undefined){r[c[N].policyName]==undefined?r[c[N].policyName]={}:1;r[c[N].policyName][c[N].policyName]==undefined?r[c[N].policyName][c[N].policyName]=[]:1;r[c[N].policyName]["txBytes"]==undefined?r[c[N].policyName]["txBytes"]=0:1;r[c[N].policyName]["txBytes"]+=c[N].txBytes;r[c[N].policyName]["rxBytes"]==undefined?r[c[N].policyName]["rxBytes"]=0:1;r[c[N].policyName]["rxBytes"]+=Math.abs(c[N].rxBytes);r[c[N].policyName][c[N].policyName].push(c[N]);q[c[N][N][0].mac]==undefined?q[c[N][N][0].mac]={}:1;q[c[N][N][0].mac][N]=c[N];r[c[N].policyName]["name"]==undefined?r[c[N].policyName]["name"]=c[N].policyName:1}else{r.other==undefined?r.other={}:1;r.other["other"]==undefined?r.other["other"]=[]:r.other["other"].push(c[N]);r.other["txBytes"]==undefined?r.other["txBytes"]=0:1;r.other["txBytes"]+=c[N].txBytes;r.other["rxBytes"]==undefined?r.other["rxBytes"]=0:1;r.other["rxBytes"]+=c[N].rxBytes}}var M=[];M.push({name:$.su.CHAR.STREAMBOOST_STATISTICS.ALL_LAN_HOSTS,value:"0",selected:true});for(var N in q){M.push({name:N,value:N})}$("input#chooseByDevice").combobox("loadData",M);$("input#chooseByTime").combobox("enable");$("input#chooseByDevice").combobox("enable");f(p-g,"0");var J=0;var H=[];var G=0;for(var N in r){b.push(r[N]);J+=r[N].rxBytes;G+=r[N].rxBytes}b.sort(z);if(b.length>5){b=b.slice(b.length-5)}for(var L=0;L<b.length;L++){H.push({label:b[L].name,data:b[L].rxBytes/J});G-=b[L].rxBytes}H.push({label:$.su.CHAR.STREAMBOOST_STATISTICS.OTHER,data:G/J});for(var L=0;L<H.length;L++){o[H[L]["label"]]==undefined?1:H[L]["label"]=o[H[L]["label"]]}$.plot($("div#downloadsGrid"),H,{series:{pie:{show:true,combine:{color:"#999",threshold:0.01}}},legend:{show:false}})})})});var h=new $.su.Help({container:"div#statistics_help",content:["STREAM_BOOST_STATISTICS_UPTIME","STREAM_BOOST_STATISTICS_DOWNLOADS"]})});</script>
</body>
</html>