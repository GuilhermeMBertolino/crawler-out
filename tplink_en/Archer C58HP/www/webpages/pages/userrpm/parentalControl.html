<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Parental Control</title>
</head>
<body>
<div class="func-container">
	 <div id="parental">
	    	<input type="text"  id="enable_parental" name="enable" value="" />
			<p class="note hidden" id="note_title">
            	<span class="title note-title"></span>
            	<span class="note" id="parental_note"></span>
       	 	</p>
	 </div>
	 <div id="under_parental">
 		<div id="parentalGrid">
		</div>
	 </div>
 	<div id="own_editor">
		<input id="device_name" name="name">
		<button   type="button"  id="device_view"></button>
		<input id="mac_addr" name="mac">
		<input id="access_calendar" name="calendar">
		<input id="device_description" name="note">
		<input id="entry_enable" name="enable">
	</div>
	<div id="device_survey">
 		<div id="device_result">
		</div>
 	</div>	 
	 <div id="content">
	 	<form id="parental-setting">
			<input type="text"  id="restriction_mode" name="access_mode" value="" />
			<div id="black_control">
	    		<input type="text"  id="add_black" name="black" value="" />
	    	</div>
	    	<div id="white_control"> 
	    		<input type="text"  id="add_white" name="white" value=""/>
	    	</div>
	    </form>
	 </div>
	 <div id="help_parental_control"></div>
</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(s){var r=$.su.url("/admin/parental_control?form=enable");var m=$.su.url("/admin/parental_control?form=device");var z=$.su.url("/admin/parental_control?form=mode");var c=$.su.url("/admin/access_control?form=black_devices");var u=$.su.url("/admin/time?form=settings");var t="";var b={"0":"GMT-12:00","60":"GMT-11:00","120":"GMT-10:00","180":"GMT-09:00","240":"GMT-08:00","300":"GMT-07:00","360":"GMT-06:00","420":"GMT-05:00","450":"GMT-04:30","480":"GMT-04:00","510":"GMT-03:30","540":"GMT-03:00","600":"GMT-02:00","660":"GMT-01:00","720":"GMT","780":"GMT+01:00","840":"GMT+02:00","900":"GMT+03:00","930":"GMT+03:30","960":"GMT+04:00","990":"GMT+04:30","1020":"GMT+05:00","1050":"GMT+05:30","1065":"GMT+05:45","1080":"GMT+06:00","1110":"GMT+06:30","1140":"GMT+07:00","1200":"GMT+08:00","1260":"GMT+09:00","1290":"GMT+09:30","1320":"GMT+10:00","1380":"GMT+11:00","1440":"GMT+12:00","1500":"GMT+13:00"};var v={"1":$.su.CHAR.ORDER["1ST_"],"2":$.su.CHAR.ORDER["2ND"],"3":$.su.CHAR.ORDER["3RD"]};var f={mon:$.su.CHAR.DATE.MON,tue:$.su.CHAR.DATE.TUES,wed:$.su.CHAR.DATE.WED,thu:$.su.CHAR.DATE.THUR,fri:$.su.CHAR.DATE.FRI,sat:$.su.CHAR.DATE.SAT,sun:$.su.CHAR.DATE.SUN};var d={"1":$.su.CHAR.DATE.JAN,"2":$.su.CHAR.DATE.FEB,"3":$.su.CHAR.DATE.MAR,"4":$.su.CHAR.DATE.APR,"5":$.su.CHAR.DATE.MAY,"6":$.su.CHAR.DATE.JUN,"7":$.su.CHAR.DATE.JUL,"8":$.su.CHAR.DATE.AUG,"9":$.su.CHAR.DATE.SEP,"10":$.su.CHAR.DATE.OCT,"11":$.su.CHAR.DATE.NOV,"12":$.su.CHAR.DATE.DEC};$("div.func-container").page({title:$.su.CHAR.PARENTAL_CTR.TITLE,help:""});$("div#parental").panel({title:$.su.CHAR.PARENTAL_CTR.TITLE,collapsible:false});$("div#parental").on("click","a#go-to-time",function(){if(window.sysMode=="router"){if($.su.menu.advanced){$.su.menu.advanced.goTo("time-settings")}else{$("div#mask").css("display","block");$.su.nav.goTo("advanced");setTimeout(function(){$.su.menu.advanced.goTo("time-settings")},500)}}});$("input#device_name").textbox({fieldLabel:$.su.CHAR.PARENTAL_CTR.DEVICE,vtype:"string_visible_allow_blank",minLength:0,maxLength:32,tipsCls:"after-button xl",allowBlank:false,cls:"inline-block "});$("input#mac_addr").textbox({fieldLabel:$.su.CHAR.PARENTAL_CTR.MAC_ADDRESS,vtype:"mac",maxLength:17,allowBlank:false,vtype:"mac"});var h=new $.su.Proxy({url:u,autoLoad:false});var k=0;var x=function(C,B,D){clearInterval(k);var E=function(H){var K="";var G=H.date.split("/");var F=parseInt(G[0],10);var J=parseInt(G[1],10);var L=G[2];K+=f[H.day.toLowerCase()]+" ";K+=(v[J]||J+$.su.CHAR.ORDER.TH)+" ";K+=d[F]+" ";K+=L+" ";K+=H.time+" ";K+=b[H.timezone];var I='<span class="label">'+$.su.CHAR.PARENTAL_CTR.SYSTEM_TIME+":</span>";I+="<span>";I+=K;I+="</span>";return I};h.read({},function(G){if(G){var H={date:G.date,day:G.day,time:G.time,timezone:G.timezone,support24:G.hour24_support,enable24:G.hour24_enable};var F=function(M){var L=H.time.split(":");var I=false;if(L[0]==23&&L[1]==59&&L[2]==59){I=true}var K=function(N){var O=parseInt(N,10);if(O<10){return("0"+O)}return O};if(M!=true){if(L[2]==59){L[2]=-1;L[1]=L[1]==59?0:parseInt(L[1],10)+1;L[0]=L[1]==0?parseInt(L[0],10)+1:L[0];L[0]=L[0]==24?0:L[0]}H.time=K(L[0])+":"+K(L[1])+":"+K((parseInt(L[2],10)+1))}var J=H.time;if(H.support24=="yes"){if(H.enable24=="off"){if(parseInt(L[0],10)>=12){if(parseInt(L[0],10)==12){L[0]=24}H.time=(L[0]-12)+":"+K(L[1])+":"+K((parseInt(L[2],10)+1))+" PM"}else{if(parseInt(L[0],10)==0){L[0]=12}H.time=parseInt(L[0],10)+":"+K(L[1])+":"+K((parseInt(L[2],10)+1))+" AM"}}}var L=E(H);D.msg("setTitle",L);H.time=J;if(I==true){h.read({},function(N){H={date:N.date,day:N.day,time:N.time,timezone:N.timezone,support24:N.hour24_support,enable24:N.hour24_enable}})}};F(true);k=setInterval(F,1*1000)}})};var i=function(){clearInterval(k)};$("input#access_calendar").timepicker({fieldLabel:$.su.CHAR.PARENTAL_CTR.TIME,cls:"time-settings"}).on("ev_beforeshow",x).on("ev_close",i);$("input#device_description").textbox({fieldLabel:$.su.CHAR.PARENTAL_CTR.DESCRIPTION,vtype:"string_visible_allow_blank",maxLength:32,tipsCls:"s",allowBlank:true,tips:$.su.CHAR.PARENTAL_CTR.OPTIONAL});$("input#entry_enable").checkbox({fieldLabel:"",defaultValue:"on",items:[{boxlabel:$.su.CHAR.PARENTAL_CTR.ENABLE_THIS_ENTRY,uncheckedValue:"off",inputValue:"on",id:"chk_enable",checked:true}]});$("#device_view").button({text:$.su.CHAR.PARENTAL_CTR.BTN_VIEW,cls:"inline-block ml5",handler:function(){$("div#device_survey").msg("show");o.load()}});var A=$("div#device_survey").msg({autoshow:false,title:$.su.CHAR.PARENTAL_CTR.ACCESS_DEVICES_LIST,type:"window"});var y=new $.su.Proxy({url:c});var o=new $.su.Store({proxy:y,fields:[{name:"name"},{name:"ipaddr"},{name:"mac"}],autoLoad:false});var q=$("div#device_result").grid({store:o,maxLines:5,columns:[{text:$.su.CHAR.ACCESS_CTR.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.ACCESS_CTR.NAME,width:150,dataIndex:"name"},{text:$.su.CHAR.ACCESS_CTR.IP_ADDRESS,width:150,dataIndex:"ipaddr"},{text:$.su.CHAR.ACCESS_CTR.MAC_ADDRESS,width:170,dataIndex:"mac"},{text:$.su.CHAR.GRID.OPERATION,renderer:function(C,B){return'<a href="javascript:void(0);" data-index="'+B+'" class="choose-existing-service choose" >'+$.su.CHAR.OPERATION.CHOOSE+"</a>"}}]});$(q).delegate("a.choose-existing-service","click",function(E){E.preventDefault();var B=q.grid("getStore"),C=$(this).attr("data-index"),D=B.data[C]||undefined;if(D){$("input#device_name").textbox("setValue",D.name);$("input#mac_addr").textbox("setValue",D.mac)}A.msg("close")});$("span.note-title").html($.su.CHAR.OPERATION.NOTE);$("span#parental_note").html($.su.CHAR.PARENTAL_CTR.CHECK_TIME_NOTE);var a=new $.su.Proxy({url:r});$("input#enable_parental").switchbutton({fieldLabel:$.su.CHAR.PARENTAL_CTR.TITLE,proxy:a,labelCls:"s",cls:"form-inner",field:{name:"enable"}}).on("ev_loadData",function(C,B){t=B.host_mac});$("div#under_parental").panel({title:$.su.CHAR.PARENTAL_CTR.DEVICE_CTR,collapsible:false});var j=new $.su.Proxy({url:m});var l=new $.su.Store({proxy:j,fields:[{name:"name"},{name:"mac"},{name:"calendar"},{name:"note"},{name:"enable"}],autoLoad:true});var g=$("div#parentalGrid").grid({store:l,minLines:0,paging:{},editor:{content:"#own_editor",validator:function(){var E=g.grid("getStore");keyProperty=E.keyProperty;grid_array=E.data;var F=$(g.grid("getEditor"));var C=F.find("input[name=mac]").val();if(t.toUpperCase()==C.toUpperCase()){$(g.grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000064"]);return false}var B=grid_array.length;if($.isArray(grid_array)&&B>0){for(var D=0;D<B;D++){if(F[0].editing){if(grid_array[D].key==F[0].editingId){continue}}var G=grid_array[D];if(G.mac.toUpperCase()==C.toUpperCase()){$(g.grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000051"]);return false}}}if($("#access_calendar").timepicker("getValue")=="{}"){$(g.grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000152"]);return false}return true},fields:[{name:"name"},{name:"mac"},{name:"calendar"},{name:"note"},{name:"enable"}]},columns:[{xtype:"checkcolumn",width:32},{text:$.su.CHAR.PARENTAL_CTR.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.PARENTAL_CTR.DEVICE,width:100,dataIndex:"name",renderer:function(B){if(B=="UNKNOWN"){return $.su.CHAR.PARENTAL_CTR.UNKNOWN}else{return B}}},{text:$.su.CHAR.PARENTAL_CTR.MAC_ADDRESS,width:130,dataIndex:"mac"},{text:$.su.CHAR.PARENTAL_CTR.TIME,width:100,dataIndex:"calendar",xtype:"actioncolumn",items:[{xtype:"timepicker",cls:"time-settings",inputCls:"time-settings",fieldLabel:null,viewOnly:true}]},{text:$.su.CHAR.PARENTAL_CTR.DESCRIPTION,width:110,dataIndex:"note"},{text:$.su.CHAR.PARENTAL_CTR.ENABLE,width:70,dataIndex:"enable",xtype:"statuscolumn"},{xtype:"settings"}],operation:"prompt|add|delete"}).delegate("input.time-settings","ev_beforeshow",x).delegate("input.time-settings","ev_close",i);$("#black_control").fieldset({fields:[{name:"black"}]}).hide();$("#white_control").fieldset({fields:[{name:"white"}]}).hide();$("div#content").panel({title:$.su.CHAR.PARENTAL_CTR.RESTR,collapsible:false});$("input#restriction_mode").radio({fieldLabel:$.su.CHAR.PARENTAL_CTR.MODE,columns:2,cls:"form-inner",labelCls:"l",items:[{boxlabel:$.su.CHAR.PARENTAL_CTR.BLACKMODE,inputValue:"black"},{boxlabel:$.su.CHAR.PARENTAL_CTR.WHITEMODE,inputValue:"white"}]}).on("ev_change",function(D,B,C){$("form#parental-setting").form("setNormal");if(C=="black"){$("div#black_control").fieldset("show");$("div#white_control").fieldset("hide")}else{$("div#white_control").fieldset("show");$("div#black_control").fieldset("hide")}});$("input#add_black").keyword({keywordProperty:{vtype:{vtype:"string_visible_no_comma",maxLength:255},maxLength:255,minLength:0,allowBlank:true,fieldLabel:null,tipsCls:"key_pos xl",cls:"inline-block key_reset"},allowBlank:true,addBtnText:$.su.CHAR.PARENTAL_CTR.ADD_A_NEW_KEYWORD});$("input#add_white").keyword({maxKeysText:$.su.CHAR.ERROR["00000118"],keywordProperty:{vtype:{vtype:"domain",maxLength:255},maxLength:255,minLength:0,allowBlank:true,fieldLabel:null,tipsCls:"key_pos xl",cls:"inline-block key_reset"},allowBlank:true,addBtnText:$.su.CHAR.PARENTAL_CTR.ADD_A_NEW_DOMAIN_NAME});var p=new $.su.Proxy({url:z});function w(D){var F={};var C=D.length;D=JSON.parse(D);for(var E=0;E<C;E++){for(var B=0;B<C;B++){if(E!=B&&D[E]==D[B]){return[E,B]}}}return false}$("form#parental-setting").form({proxy:p,cls:"no-padding",fields:[{name:"access_mode",mapping:"access_mode"},{name:"black",mapping:"black"},{name:"white",mapping:"white"}],validator:function(){var D=$("input#add_white").keyword("getValue");var C=$("input#add_black").keyword("getValue");var G=$("input#restriction_mode").radio("getValue");var B=[];if(G=="black"){B=C.split(",");if(w(B)!==false){var F=$("input#add_black").keyword("getKeyByIndex",w(B)[0]);$(F).textbox("setError");var E=$("input#add_black").keyword("getKeyByIndex",w(B)[1]);$(E).textbox("setError");$("form#parental-setting").form("setError",$.su.CHAR.ERROR["00000096"]);return false}}else{B=D.split(",");if(w(B)!=false){var F=$("input#add_white").keyword("getKeyByIndex",w(B)[0]);$(F).textbox("setError");var E=$("input#add_white").keyword("getKeyByIndex",w(B)[1]);$(E).textbox("setError");$("form#parental-setting").form("setError",$.su.CHAR.ERROR["00000117"]);return false}}return true},submitBtn:"default"}).on("ev_loadData",function(E,D){if(D.others){var B=D.others.max_rules_black;var C=D.others.max_rules_white;$("input#add_black").keyword("setMaxKeys",B);$("input#add_white").keyword("setMaxKeys",C)}if(D.access_mode==""||!D.access_mode){$("#restriction_mode").radio("setValue","black")}});var n=new $.su.Help({container:"div#help_parental_control",content:["PARENTAL_CONTROL","PARENTAL_CONTROL_DEVICES","PARENTAL_CONTROL_RESTRICTION"]});$.su.app.runningModule.addUnloadHandler(i)});</script>
</body>
</html>
