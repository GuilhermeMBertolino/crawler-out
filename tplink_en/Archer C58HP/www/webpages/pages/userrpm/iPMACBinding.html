<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Internet</title>
</head>
<body>
<div class="func-container">
	<div id="binding_setting">
		<input type="text" id="enable_binding" name="enable" value="" />
	</div>
	 <div id="arp_list">
	 	<div id="arpGrid">
		</div>
	 </div>
	 <div id="binding_list">
	 	<div id="bindingGrid">
		</div>
		<div id="add_arpBinding">
			<input id="bind_macaddr" name="mac"/>
			<input id="bind_ipaddr" name="ipaddr"/>
			<input id="bind_description" name="description"/>
			<input id="bind_enable" name="enable"/>
		</div>
	 </div>
	 <div id="help_ipmac_bind"></div>
</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(m){var o=$.su.url("/admin/imb?form=setting");var b=$.su.url("/admin/imb?form=arp_list");var l=$.su.url("/admin/imb?form=bind_list");$("div.func-container").page({title:$.su.CHAR.IP_MAC.TITLE,help:""});$("div#binding_setting").panel({title:$.su.CHAR.IP_MAC.TITLE,collapsible:false});var g=0;var p=0;var k=new $.su.Proxy({url:$.su.url("/admin/network?form=lan_ipv4")});k.read({},function(q){g=q.ipaddr;p=q.mask_type.toUpperCase()=="CUSTOM"?q.custom_value:q.mask_type});var j=new $.su.Proxy({url:o});$("input#enable_binding").switchbutton({fieldLabel:$.su.CHAR.IP_MAC.ENABLE_ARP,proxy:j,cls:"form-inner",onCallback:function(){var q=d.grid("getStore");q.load()},offCallback:function(){var q=d.grid("getStore");q.load()},field:{name:"enable"}});$("div#arp_list").panel({title:$.su.CHAR.IP_MAC.ARP_LIST,collapsible:false});var f=new $.su.Proxy({url:b});var d=$("div#arpGrid").grid({store:{proxy:f,fields:[{name:"mac"},{name:"ipaddr"},{name:"enable"}],autoLoad:false},paging:{},columns:[{text:$.su.CHAR.IP_MAC.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.IP_MAC.MAC_ADDRESS,width:180,dataIndex:"mac"},{text:$.su.CHAR.IP_MAC.IP_ADDRESS,width:120,dataIndex:"ipaddr"},{text:$.su.CHAR.IP_MAC.BOUND,width:80,dataIndex:"enable",renderer:function(q){if(q=="on"){return $.su.CHAR.IP_MAC.BOUND}else{return $.su.CHAR.IP_MAC.UNBOUND}}},{text:$.su.CHAR.GRID.MODIFY,dataIndex:"enable",renderer:function(t,q){var s=(t=="on")?"disabled":"";var r='<div class="button-container">';r+='<a href="javascript:void(0);" class="grid-content-btn btn-ipmac-bind btn-bind '+s+'" data-index="'+q+'" data-disabled="'+s+'">';r+='<span class="icon"></span>';r+='<span class="text">'+$.su.CHAR.IP_MAC.BOUND+"</span>";r+="</a>";r+='<a href="javascript:void(0);" class="grid-content-btn btn-ipmac-delete btn-delete" data-index="'+q+'">';r+='<span class="icon"></span>';r+='<span class="text">'+$.su.CHAR.OPERATION.DELETE+"</span>";r+="</a>";r+="</div>";return r}}],operation:[{xtype:"totalCount",cls:"left",fieldLabel:$.su.CHAR.IP_MAC.ARP_NUM},"refresh"]});d.delegate("a.btn-ipmac-bind","click",function(){var x=$(this).attr("data-index"),z=d.grid("getStore"),t=z.keyProperty;var D={};D.data=$.su.clone(z.data);var y=D.data[x],B=y[t];y=$.su.json.toJSONString(y);var C=D.data[x];var u=c[0].maxRules;var w=c.grid("getStore").data.length;var r=false;var q=c.grid("getStore");t=q.keyProperty;grid_array=q.data;if($.isArray(grid_array)&&grid_array.length>0){for(var s=0;s<grid_array.length;s++){var v=grid_array[s];if(v.ipaddr==C.ipaddr){r=true;break}}}if(!r&&(u<=w)){c[0].maxRulesMsg.msg("show");return}var A=$("input#enable_binding").textbox("getValue");if(!B||C.enable=="on"||A=="off"){return}else{z.update(B,{operation:"bind",data:y},function(E,G){var F=c.grid("getStore");F.load()})}delete D});d.delegate("a.btn-ipmac-delete","click",function(){var t=$(this).attr("data-index"),s=d.grid("getStore"),q=s.keyProperty;var r={};r.data=$.su.clone(s.data);var v=r.data[t],u=v[q];v=$.su.json.toJSONString(v);if(!u){return}else{s.remove(u,{operation:"remove",data:v},function(w,y){var x=c.grid("getStore");x.load()})}delete r});$("div#binding_list").panel({title:$.su.CHAR.IP_MAC.BINDING_LIST,collapsible:false});var i=new $.su.Proxy({url:l});$("input#bind_macaddr").textbox({fieldLabel:$.su.CHAR.IP_MAC.MAC_ADDRESS,maxLength:17,vtype:"mac"});$("input#bind_ipaddr").textbox({fieldLabel:$.su.CHAR.IP_MAC.IP_ADDRESS,textFormat:$.su.format.ip,maxLength:15,vtype:"ip"});$("input#bind_description").textbox({fieldLabel:$.su.CHAR.IP_MAC.DESCRIPTION,vtype:"string_visible_allow_blank",maxLength:32,tipsCls:"xs",tips:$.su.CHAR.IP_MAC.OPTIONAL});$("input#bind_enable").checkbox({fieldLabel:"",defaultValue:["on"],items:[{boxlabel:$.su.CHAR.IP_MAC.ENABLE_THIS_ENTRY,inputValue:"on",uncheckedValue:"off",checked:true}]});var c=$("div#bindingGrid").grid({store:{proxy:i,fields:[{name:"mac"},{name:"ipaddr"},{name:"description"},{name:"enable"}],autoLoad:true},paging:{},editor:{validator:function(){var v=$("input#bind_macaddr").textbox("getValue");var u=$("input#bind_ipaddr").textbox("getValue");var r=c.grid("getStore");keyProperty=r.keyProperty;grid_array=r.data;var s=$(c.grid("getEditor"));editingId=s.editor("getEditingId");if($.isArray(grid_array)&&grid_array.length>0){for(var q=0;q<grid_array.length;q++){var t=grid_array[q];if(t[keyProperty]==editingId){continue}else{if(t.ipaddr==u){$("input#bind_ipaddr").textbox("setError");s.form("setError",$.su.CHAR.ERROR["00000007"]);return false}}}}if(!$.su.func.isSameNet(u,g,p)){$("#bind_ipaddr").textbox("setError");$(c.grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000047"]);return false}if(u==g){$("#bind_ipaddr").textbox("setError");$(c.grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000077"]);return false}return true},content:"#add_arpBinding",fields:[{name:"mac"},{name:"ipaddr"},{name:"description"},{name:"enable"}]},columns:[{xtype:"checkcolumn",width:32},{text:$.su.CHAR.IP_MAC.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.IP_MAC.MAC_ADDRESS,width:180,dataIndex:"mac"},{text:$.su.CHAR.IP_MAC.IP_ADDRESS,width:100,dataIndex:"ipaddr"},{text:$.su.CHAR.IP_MAC.DESCRIPTION,width:120,dataIndex:"description"},{text:$.su.CHAR.IP_MAC.ENABLE,width:80,dataIndex:"enable",xtype:"statuscolumn"},{xtype:"settings"}],operation:"prompt|add|delete"});var h=d.grid("getStore");var n=c.grid("getStore");$(n).on("ev_updatedata",function(r,q,s){h.load()});$(n).on("ev_removedata",function(r,q,s){h.load()});$(n).on("ev_insertdata",function(r,q){h.load()});var a=new $.su.Help({container:"div#help_ipmac_bind",content:["IPMAC_BIND_SETTING","IPMAC_BIND_ARP","IPMAC_BIND_LIST"]})});</script>
</body>
</html>
