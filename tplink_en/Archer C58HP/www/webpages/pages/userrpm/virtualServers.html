<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Virtual Server</title>
</head>
<body>
	<div class="func-container" >
		<div id="virtual-servers">
				<div id="virtualServersGrid" class="natSeries">
				</div>
		</div>
		<div id="own_editor">
			<input id="virtual_name" name="name">
			<button  type="button" id="virtual_view"></button>
			<input id="external_port" name="external_port">
			<input id="virtual_ipaddr" name="ipaddr">
			<input id="internal_port" name="internal_port">
			<input id="virtual_protocol" name="protocol">
			<input id="virtual_enable" name="enable">
		</div>
	 	<div id="virtual_survey">
	 		<div id="virtual_result">
			</div>
	 	</div>
	 	<div id="virtual_alert_cnt">
			<h4 class="title">
		    	<span class="icon"></span>
		 		<span class="text" id="virtual_confirm_content"></span>
		 	</h4>
		</div> 
		<span id="nat_notice" class="hidden"></span>
	 	<div id="virtual_server_help"></div>
	</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(A){var C=0;var l="on";var E=$.su.url("/admin/nat?form=vs");var f=$.su.url("/admin/administration?form=remote");var n=$.su.url("/admin/openvpn?form=config");var F=$.su.url("/admin/pptpd?form=config");var G=new $.su.Proxy({url:n});var v=new $.su.Proxy({url:F});var B=new $.su.Proxy({url:f});var i=0;var u=0;var g=0;var h=0;G.read({},function(o){g=o.proto;u=o.port;i=o.enabled});v.read({},function(o){h=o.enabled});B.read({},function(o){C=o.port;l=o.enable});$("span#nat_notice").html($.su.CHAR.VIRTUAL_SERVERS.NAT_ENABLE_NOTICE);function m(I,o,J){if(I=="enable"){if(i=="on"&&(g==J.toLowerCase()||J=="ALL")&&u==o){$($("#virtualServersGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000218"]);$("input#external_port").textbox("setError");return true}if(h=="on"&&o=="1723"){$($("#virtualServersGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000219"]);$("input#external_port").textbox("setError");return true}}return false}function w(J,I){var K;for(var o=0;o<J.length;o++){K=J.charAt(o);if(I.indexOf(K)==-1){return false}}return true}var a=0;var y=0;var b=new $.su.Proxy({url:$.su.url("/admin/network?form=lan_ipv4")});b.read({},function(o){a=o.ipaddr;y=o.mask_type.toUpperCase()=="CUSTOM"?o.custom_value:o.mask_type});function t(o){if(!w(o,"0123456789")){return false}if(parseInt(o,10)<=0||parseInt(o,10)>65535){return false}return true}function D(o){if(!t(o)){return false}return true}function d(K){var o="";if(!w(K,"-0123456789")){return false}var J;J=K.split("-");if(J.length>2){return false}if(J.length==2){for(var I=0;I<2;I++){if(J[I]==""){return false}if(!D(J[I])){return false}}o=parseInt(J[0],10)+"-"+parseInt(J[1],10)}if(J.length==1){if(!D(J[0])){return false}}return true}$("div.func-container").page({title:$.su.CHAR.VIRTUAL_SERVERS.TITLE,help:""});$("div#virtual-servers").panel({title:$.su.CHAR.VIRTUAL_SERVERS.TITLE,collapsible:false});$("input#virtual_name").textbox({fieldLabel:$.su.CHAR.VIRTUAL_SERVERS.SERVICE_NAME,maxLength:32,vtype:"string_visible_allow_blank",cls:"inline"});$("input#external_port").textbox({fieldLabel:$.su.CHAR.VIRTUAL_SERVERS.EXTERNAL_PORT,tips:$.su.CHAR.VIRTUAL_SERVERS.EXTERNAL_UNIT,tipsCls:"xs",maxLength:11,allowBlank:false,textFormat:function(J){var I=J;var o=J.split("-");if(o.length==1){if(!isNaN(parseInt(o[0],10))){I=parseInt(o[0],10)}}else{if(o.length==2){if((!isNaN(parseInt(o[0],10)))&&(!isNaN(parseInt(o[1],10)))){I=parseInt(o[0],10)+"-"+parseInt(o[1],10)}}}return I},validator:function(o){return d(o)},validateIcon:true});$("input#virtual_ipaddr").textbox({fieldLabel:$.su.CHAR.VIRTUAL_SERVERS.INTERNAL_IP,tipsCls:"m",allowBlank:false,textFormat:$.su.format.ip,maxLength:15,vtype:"ip"});$("input#internal_port").textbox({fieldLabel:$.su.CHAR.VIRTUAL_SERVERS.INTERNAL_PORT,tips:$.su.CHAR.VIRTUAL_SERVERS.INTERNAL_UNIT,textFormat:$.su.format.number,vtype:{vtype:"number",max:65535,min:1},maxLength:5,tipsCls:"s",tips:$.su.CHAR.VIRTUAL_SERVERS.INT_PORT_TIPS,validateIcon:true});$("input#virtual_protocol").combobox({fieldLabel:$.su.CHAR.VIRTUAL_SERVERS.PROTOCAL,inputCls:"l",items:[{value:"ALL",name:$.su.CHAR.VIRTUAL_SERVERS.PROTOCAL_ALL,selected:"selected"},{value:"TCP",name:$.su.CHAR.VIRTUAL_SERVERS.PROTOCAL_TCP},{value:"UDP",name:$.su.CHAR.VIRTUAL_SERVERS.PROTOCAL_UDP}]});$("input#virtual_enable").checkbox({fieldLabel:"",defaultValue:["on"],items:[{boxlabel:$.su.CHAR.VIRTUAL_SERVERS.ENABLE_THIS_ENTRY,uncheckedValue:"off",inputValue:"on",id:"chk_enable",checked:true}]});$("#virtual_view").button({text:$.su.CHAR.VIRTUAL_SERVERS.BTN_VIEW,cls:"inline-block  ml5",handler:function(){$("div#virtual_survey").msg("show");s.loadData(q)}});var H=$("div#virtual_survey").msg({title:$.su.CHAR.VIRTUAL_SERVERS.EXSITTING_SERVICE,autoshow:false,type:"window"});var s=new $.su.Store({fields:[{name:"name"}],autoLoad:false});var q=[{name:"DNS",external_port:"53",internal_port:"53",protocol:"ALL"},{name:"FTP",external_port:"21",internal_port:"21",protocol:"TCP"},{name:"GOPHER",external_port:"70",internal_port:"70",protocol:"TCP"},{name:"HTTP",external_port:"80",internal_port:"80",protocol:"TCP"},{name:"NNTP",external_port:"119",internal_port:"119",protocol:"TCP"},{name:"POP3",external_port:"110",internal_port:"110",protocol:"TCP"},{name:"PPTP",external_port:"1723",internal_port:"1723",protocol:"ALL"},{name:"SMTP",external_port:"25",internal_port:"25",protocol:"TCP"},{name:"SOCK",external_port:"1080",internal_port:"1080",protocol:"ALL"},{name:"TELNET",external_port:"23",internal_port:"23",protocol:"TCP"}];var z=$("div#virtual_result").grid({store:s,maxLines:5,columns:[{text:$.su.CHAR.VIRTUAL_SERVERS.ID,xtype:"rownumberer",width:80},{text:$.su.CHAR.VIRTUAL_SERVERS.SERVICE_NAME,width:380,dataIndex:"name"},{text:$.su.CHAR.GRID.OPERATION,renderer:function(I,o){return'<a href="javascript:void(0);" data-index="'+o+'" class="choose" >'+$.su.CHAR.OPERATION.CHOOSE+"</a>"}}]});$(z).delegate("a.choose","click",function(K){K.preventDefault();var o=z.grid("getStore"),I=$(this).attr("data-index"),J=o.data[I]||undefined;if(J){$("input#virtual_name").textbox("setValue",J.name);$("input#external_port").textbox("setValue",J.external_port);$("input#internal_port").textbox("setValue",J.internal_port);$("input#virtual_protocol").combobox("setValue",[J.protocol])}H.msg("close")});var x=new $.su.Proxy({url:E});function p(I,o){if(I=="ALL"){return true}if((I=="TCP")&&(o!="UDP")){return true}if((I=="UDP")&&(o!="TCP")){return true}return false}var r=$("div#virtualServersGrid").grid({store:{proxy:x,fields:[{name:"name"},{name:"external_port"},{name:"ipaddr"},{name:"internal_port"},{name:"protocol"},{name:"enable"}],autoLoad:true},editor:{beforeSubmit:function(){var o=$("input#external_port").textbox("getValue");var K=$("input#virtual_protocol").combobox("getValue")[0];var J=$("#virtual_enable").checkbox("getValue")[0];var L=o.split("-");if(L.length==2){L[0]=parseInt(L[0],10);L[1]=parseInt(L[1],10);if(parseInt(L[0],10)>parseInt(L[1],10)){var I=L[0];L[0]=L[1];L[1]=I}}if(l=="off"){return true}if((K!="UDP")&&(J)){if(L.length==1){L[0]=parseInt(L[0],10);if(L[0]==C){$("#virtual_alert_cnt").msg("show");return false}}if(L.length==2){if((L[0]<=C)&&(L[1]>=C)){$("#virtual_alert_cnt").msg("show");return false}}}return true},validator:function(){var M=$("input#external_port").textbox("getValue");var S=$("input#virtual_protocol").combobox("getValue")[0];var O=$("#virtual_enable").checkbox("getValue")[0];if(m(O,M,S)){return false}var I=M.split("-");if(I.length==2){if(parseInt(I[0],10)>parseInt(I[1],10)){var N=I[0];I[0]=I[1];I[1]=N}}var R=$(r).grid("getStore");keyProperty=R.keyProperty;extport_data=R.data;var P=$(r.grid("getEditor"));editingId=P.editor("getEditingId");if(!$.su.func.isSameNet($("#virtual_ipaddr").textbox("getValue"),a,y)){$("#virtual_ipaddr").textbox("setError");$($("div#virtualServersGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000110"]);return false}if($("#virtual_ipaddr").textbox("getValue")==$.su.func.getLimitIp(a,y,"min")){$("#virtual_ipaddr").textbox("setError");$($("div#virtualServersGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000134"]);return false}if($("#virtual_ipaddr").textbox("getValue")==$.su.func.getLimitIp(a,y,"max")){$("#virtual_ipaddr").textbox("setError");$($("div#virtualServersGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000134"]);return false}if($("#virtual_ipaddr").textbox("getValue")==a){$("#virtual_ipaddr").textbox("setError");$($("div#virtualServersGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000077"]);return false}if($.isArray(extport_data)&&extport_data.length>0){for(var L=0;L<extport_data.length;L++){var Q=extport_data[L];var o=Q.protocol;if(Q[keyProperty]==editingId){continue}else{var K=Q.external_port.split("-");if(K.length==2){if(parseInt(K[0],10)>parseInt(K[1],10)){var J=K[0];K[0]=K[1];K[1]=J}}if(I.length==1){if(K.length==1){if((parseInt(I[0],10)==parseInt(K[0],10))&&(p(o,S))){$("input#external_port").textbox("setError");$($("div#virtualServersGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000065"]);return false}}else{if((parseInt(I[0],10)>=parseInt(K[0],10)&&parseInt(I[0],10)<=parseInt(K[1],10))&&(p(o,S))){$("input#external_port").textbox("setError");$($("div#virtualServersGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000065"]);return false}}}else{if(K.length==1){if((parseInt(I[0],10)<=parseInt(K[0],10)&&parseInt(I[1],10)>=parseInt(K[0],10))&&(p(o,S))){$("input#external_port").textbox("setError");$($("div#virtualServersGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000065"]);return false}}else{if((!(parseInt(I[0],10)>parseInt(K[1],10)||parseInt(I[1],10)<parseInt(K[0],10)))&&(p(o,S))){$("input#external_port").textbox("setError");$($("div#virtualServersGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000065"]);return false}}}}}}return true},content:"#own_editor",fields:[{name:"name"},{name:"external_port"},{name:"ipaddr"},{name:"internal_port"},{name:"protocol"},{name:"enable"}]},paging:{},columns:[{xtype:"checkcolumn",width:32},{text:$.su.CHAR.VIRTUAL_SERVERS.ID,xtype:"rownumberer",width:30},{text:$.su.CHAR.VIRTUAL_SERVERS.SERVICE_NAME,width:100,dataIndex:"name"},{text:$.su.CHAR.VIRTUAL_SERVERS.EXTERNAL_PORT,width:80,dataIndex:"external_port"},{text:$.su.CHAR.VIRTUAL_SERVERS.INTERNAL_IP,width:100,dataIndex:"ipaddr"},{text:$.su.CHAR.VIRTUAL_SERVERS.INTERNAL_PORT,width:80,dataIndex:"internal_port"},{text:$.su.CHAR.VIRTUAL_SERVERS.PROTOCAL,width:80,dataIndex:"protocol"},{text:$.su.CHAR.VIRTUAL_SERVERS.ENABLE,width:70,dataIndex:"enable",xtype:"statuscolumn"},{xtype:"settings"}],operation:"prompt|add|delete"});var c=$("div#virtualServersGrid").grid("getEditor");$(c).on("ev_startEdit",function(K,o,J){if(o=="add"){$("#virtual_protocol").combobox("setValue","ALL")}var I=$("input#internal_port").textbox("getValue");if(I.indexOf("-")>=0){$("input#internal_port").textbox("setValue","")}});$("#virtual_alert_cnt").msg({cls:"m warning",type:"alert"});$("#virtual_confirm_content").html($.su.CHAR.VIRTUAL_SERVERS.NOTICE);var k=new $.su.Proxy({url:$.su.url("/admin/nat?form=setting")});k.read({},function(o){if(o.enable=="off"){$("span#nat_notice").show()}else{$("span#nat_notice").hide()}});$("div#virtualServersGrid").on("click","a#go-to-openvpn",function(){$.su.menu.advanced.goTo("openvpn")});$("div#virtualServersGrid").on("click","a#go-to-pptpvpn",function(){$.su.menu.advanced.goTo("pptpvpn")});var j=new $.su.Help({container:"div#virtual_server_help",content:"VIRTUAL_SERVERS"})});</script>
</body>
</html>