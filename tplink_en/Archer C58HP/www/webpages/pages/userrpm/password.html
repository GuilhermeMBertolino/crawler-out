<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>account Control</title>
</head>
<body>
<div class="func-container">
	<div id="account">
	 	<form id="account-setting">
	    	<input type="password"  id="old_pwd" name="old_pwd" value="" />
	    	<input type="password"  id="new_pwd" name="new_pwd" value="" />
			<input type="password"  id="cfm_pwd" name="cfm_pwd" value="" />
			<input id="pwd_status"  value="" />
	    </form>
	</div>
	<div id="recovery">
		<form id="recovery-setting">	
			<input type="text"  id="enable_rec" name="enable_rec" value="" />
			<div id="recover_cnt" class="hidden">
				<input type="text"  id="log_from" name="from" value="" />
		    	<input type="text"  id="log_to" name="to" value="" />
		    	<input type="text"  id="log_smtp" name="smtp" value="" />
		    	<input type="text"  id="log_auth" name="enable_auth" value="" />
				<div id="auth_cnt">
			    	<input type="text"  id="username"  name="username" value="" />
					<input   id="password"  type="password" name="password" value="" />
				</div>
		    </div>
		    	<div class="form-submit button-container submit">
				<span class="form-error-tips error"></span>
				<div class="form-submit-wrap">
					<div class="container widget-container button-container submit">
						<div class="widget-wrap-outer button-wrap-outer">
							<div class="widget-wrap button-wrap" id="test_mail_btn_cnt">
								<button type="button" class="button-button"><span id="test_mail_btn" class="text button-text"></span></button>
							</div>
							<div class="widget-wrap button-wrap"  id="save_btn_cnt">
								<button type="button" class="button-button"><span id="save_btn" class="text button-text"></span></button>
							</div>
							<div class="widget-error-tips textbox-error-tips undefined">
								<span class="widget-error-tips-delta"></span>
								<div class="widget-error-tips-wrap">
								<div class="content error-tips-content">
								</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<span class="loading"></span>
			</div>
	    </form>
	 </div>
	 <div id="local">
	 	<form id="local-setting">
	    	<input type="text"  id="mode" name="mode" value="" />
			<span id="txt-mode-tips" class="inline-block"></span>
	    </form>
	    <div id="localGrid" name="localGrid"></div>
	 </div>
	 <div id="own_editor">
		<input id="mac" name="mac">
		<button id="view"></button>
		<input id="description" name="description">
		<input id="enable" name="enable">
	</div>
	 <div id="adv_mac_auth_survey">
	 	<div id="result">
		</div>
	 </div>
	 <div id="remote">
	 	<form id="remote-setting">
	 		<input type="text"  id="enable_remote" name="enable" value="" />
	 		<div id="ip_port_cnt">
	 			<input type="text"  id="port" name="port" value="" />
	 			<input type="text"  id="ipaddr" name="ipaddr" value="" />
	 		</div>
	    	<button type="button" id="submit-btn"></button>
	    </form>
	 </div>
	<div id="virtual_alert_cnt">
		<h4 class="title">
	    	<span class="icon"></span>
	 		<span class="text" id="virtual_confirm_content"></span>
	 	</h4>
	</div> 
	<div id="trigger_alert_cnt">
		<h4 class="title">
	    	<span class="icon"></span>
	 		<span class="text" id="trigger_confirm_content"></span>
	 	</h4>
	</div> 
	<div id="dmz_alert_cnt">
		<h4 class="title">
	    	<span class="icon"></span>
	 		<span class="text" id="dmz_confirm_content"></span>
	 	</h4>
	</div> 
	<div id="help_admin"></div>
</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(M){var q="./data/account.pwd.json";var y="./data/account.remote.json";var d="./data/account.grid.json";var O="./data/macFiltering.result.json";var A="./data/account.set.json";var C="./data/account.testmail.json";var u=$.su.url("/admin/administration?form=account");var i=$.su.url("/admin/administration?form=recovery");var w=$.su.url("/admin/administration?form=remote");var D=$.su.url("/admin/administration?form=local");var b=$.su.url("/admin/administration?form=view");var I=$.su.url("/admin/administration?form=mode");var K=$.su.url("/admin/administration?form=testmail");var a=$.su.url("/admin/nat?form=vs");var g=$.su.url("/admin/nat?form=pt");var E=$.su.url("/admin/nat?form=dmz");var t=[];var v=[];var j="on";var n=new $.su.Proxy({url:a});var k=new $.su.Proxy({url:g});var z=new $.su.Proxy({url:E});var J=0;var N=0;var f=new $.su.Proxy({url:$.su.url("/admin/network?form=lan_ipv4")});var F=true;if(window.sysMode=="ap"||window.sysMode=="re"){$("#recovery").hide();$("#local").hide();$("#remote").hide()}f.read({},function(o){J=o.ipaddr;N=o.mask_type.toUpperCase()=="CUSTOM"?o.custom_value:o.mask_type});n.read({},function(T){var P=T.length;var o=[];for(var S=0;S<P;S++){var R=T[S].enable;var U=T[S].protocol.toUpperCase();var Q=T[S].external_port;if((R=="on")&&(U!="UDP")){t.push(Q)}}});k.read({operation:"load"},function(T){var P=T.length;var o=[];for(var S=0;S<P;S++){var R=T[S].enable;var U=T[S].external_protocol.toUpperCase();var Q=T[S].external_port;console.log(U+Q);if((R=="on")&&(U!="UDP")){v.push(Q)}}});z.read({},function(o){j=o.enable});$("div.func-container").page({title:$.su.CHAR.ACCOUNT.TITLE,help:""});$("div#account").panel({title:$.su.CHAR.ACCOUNT.ACCOUNT_TITLE,collapsible:false});$("div#recovery").panel({title:$.su.CHAR.ACCOUNT.RECOVERYINFO,collapsible:false});$("input#old_pwd").password({fieldLabel:$.su.CHAR.ACCOUNT.OLDPWD,allowBlank:false,vtype:"ascii_visible",showLevel:false,minLength:1,maxLength:15});var r=function(P,o){if(o==P){$("#pwd_status").status("setSuccess");return true}else{$("#pwd_status").status("setFailed");return false}};$("input#new_pwd").password({fieldLabel:$.su.CHAR.ACCOUNT.NEWPWD,allowBlank:false,vtype:"ascii_visible",minLength:1,maxLength:15}).on("ev_change",function(o,P){$("#pwd_status").status("setNormal");$("input#cfm_pwd").password("setNormal");var R=$("input#new_pwd").password("getValue");var Q=$("input#cfm_pwd").password("getValue");if(Q){r(R,Q)}}).on("ev_validatechange",function(o,P){var R=$("input#new_pwd").password("getValue");var Q=$("input#cfm_pwd").password("getValue");if(Q==""){$("#pwd_status").status("setNormal");return true}else{r(R,Q)}});$("input#cfm_pwd").password({fieldLabel:$.su.CHAR.ACCOUNT.CONFIRM,vtype:"ascii_visible",minLength:1,maxLength:15,cls:"inline",allowBlank:false,validator:function(o){return true},showLevel:false}).on("ev_change ev_validatechange",function(){var P=$("input#new_pwd").password("getValue");var o=$("input#cfm_pwd").password("getValue");if(P==""){if(o==""){$("#pwd_status").status("setNormal")}else{if(!r(P,o)){$("input#cfm_pwd").password("setError")}}}else{if(!r(P,o)){$("input#cfm_pwd").password("setError")}}});$("#pwd_status").status({cls:"inline"});$("input#log_auth").checkbox({fieldLabel:"",items:[{boxlabel:$.su.CHAR.ACCOUNT.ENABLE_AUTHENTICATION,uncheckedValue:"off",inputValue:"on"}]}).on("ev_change",function(Q,o,P){var R=(P[0]=="enable_auth"||P[0]=="on")?"on":"off";switch(R){case"on":$("#auth_cnt").fieldset("show");break;case"off":$("#auth_cnt").fieldset("hide");break}});$("input#enable_rec").checkbox({fieldLabel:"",cls:"part-separate",items:[{boxlabel:$.su.CHAR.ACCOUNT.ENABLE_PASSWORD_RECOVERY,uncheckedValue:"off",inputValue:"on"}]}).on("ev_change",function(Q,o,P){var R=(P[0]=="enable_rec"||P[0]=="on")?"on":"off";switch(R){case"on":$("#recover_cnt").fieldset("show");$("#log_auth").checkbox("setValue","on");break;case"off":$("#recover_cnt").fieldset("hide");$("#auth_cnt").fieldset("hide");$("input#log_auth").checkbox("setValue","off");$("#log_auth").checkbox("setValue","off");break}});var s=$("#recover_cnt").fieldset({fields:[{name:"from"},{name:"to"},{name:"smtp"},]});$("input#log_from").textbox({fieldLabel:$.su.CHAR.ACCOUNT.FROM,allowBlank:false,minLength:2,maxLength:32,vtype:"email"});$("input#log_to").textbox({fieldLabel:$.su.CHAR.ACCOUNT.TO,allowBlank:false,minLength:2,maxLength:32,vtype:"email"});$("input#log_smtp").textbox({fieldLabel:$.su.CHAR.ACCOUNT.SMTP_SERVER,allowBlank:false,minLength:2,maxLength:32,vtype:"string_ip_domain"});$("#auth_cnt").fieldset({fields:[{name:"username"},{name:"password"},{name:"confirm"}]}).hide();$("#username").textbox({fieldLabel:$.su.CHAR.ACCOUNT.USERNAME,allowBlank:false,minLength:2,maxLength:32,vtype:"string_visible"}).on("blur",function(R,S){var U=/.outlook.com$/;var T=$("input#log_smtp").textbox("getValue");var Q=U.test(T);if(Q){var P=$("#username").textbox("getValue");var o=U.test(P);if(!o){$("#username").textbox("setValue",P+"@outlook.com")}}});$("#password").password({fieldLabel:$.su.CHAR.ACCOUNT.PASSWORD,allowBlank:false,showLevel:false,minLength:2,maxLength:32,vtype:"string_visible"});$("input#mac").textbox({fieldLabel:$.su.CHAR.ACCOUNT.MAC_ADDRESS,vtype:"mac",maxLength:17,allowBlank:false,tipsCls:"xs after-button",cls:"inline-block"});$("input#description").textbox({fieldLabel:$.su.CHAR.ACCOUNT.DESCRIPTION,allowBlank:true,vtype:"string_visible_allow_blank",maxLength:32});$("input#enable").checkbox({fieldLabel:"",items:[{boxlabel:$.su.CHAR.ACCOUNT.ENABLE_THIS_ENTRY,uncheckedValue:"off",inputValue:"on"}]});$("#view").button({text:$.su.CHAR.ACCOUNT.VIEW_BTN,cls:"inline  ml5",handler:function(){$("div#adv_mac_auth_survey").msg("show");c.load()}});$("div#adv_mac_auth_survey").msg({_title:$.su.CHAR.ACCOUNT.EXIST_DEVICE,autoshow:false,title:$.su.CHAR.ACCOUNT.ACCESS_DEVICE,type:"window"});var c=new $.su.Store({proxy:{url:b},fields:[{name:"mac"},{name:"ip"},{name:"name"}],autoLoad:false});var G=$("div#result").grid({store:c,paging:{},columns:[{text:$.su.CHAR.ACCOUNT.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.ACCOUNT.DEVICE_NAME,width:140,dataIndex:"name"},{text:$.su.CHAR.ACCOUNT.IP_ADDRESS,width:150,dataIndex:"ip"},{text:$.su.CHAR.ACCOUNT.MAC_ADDRESS,width:150,dataIndex:"mac"},{text:$.su.CHAR.GRID.OPERATION,renderer:function(){return'<a href="javascript:void(0);" class="choose" >'+$.su.CHAR.OPERATION.CHOOSE+"</a>"}}]});$("div#result").delegate("a.choose","click",function(Q){Q.preventDefault();var P=$(this).parents("tr.grid-content-tr")[0];var R=$(P).find("td.grid-content-td-mac div").eq(0).html();var o=$("div#result").grid("getEditor");$("input#mac").textbox("setValue",R);$("div#adv_mac_auth_survey").msg("close")});var p=new $.su.Proxy({url:u,autoLoad:false});$("form#account-setting").form({proxy:p,fields:[{name:"old_pwd",mapping:"old_pwd"},{name:"new_pwd",mapping:"new_pwd"},{name:"cfm_pwd",mapping:"cfm_pwd"}],autoLoad:true,validator:function(){var o=$("input#cfm_pwd").password("getValue");var P=$("input#new_pwd").password("getValue");if(o==P){$("#pwd_status").status("setSuccess");return true}else{$("input#cfm_pwd").password("setError",$.su.CHAR.ERROR["00000080"]);return false}},submitBtn:"default"}).on("ev_loadData",function(P,o){});$("#test_mail_btn").html($.su.CHAR.ACCOUNT.TEST_MAIL);$("#save_btn").html($.su.CHAR.OPERATION.SAVE);var h=new $.su.Proxy({url:i,autoLoad:false});$("#recovery-setting").form({proxy:h,fields:[{name:"enable_rec",mapping:"enable_rec"},{name:"from",mapping:"from"},{name:"to",mapping:"to"},{name:"smtp",mapping:"smtp"},{name:"enable_auth",mapping:"enable_auth"},{name:"username",mapping:"username"},{name:"password",mapping:"password"}],autoLoad:true,submitBtn:null}).on("ev_loadData",function(P,o){o&&o.hide_password_recovery=="yes"?F=false:F=true;F?$("div#recovery").show():$("div#recovery").hide();if(o.enable_rec=="off"){$("#test_mail_btn_cnt").hide()}else{$("#test_mail_btn_cnt").show()}});$("div#local").panel({title:$.su.CHAR.ACCOUNT.LOCAL,collapsible:false});var m=new $.su.Proxy({url:I});$("input#mode").switchbutton({fieldLabel:$.su.CHAR.ACCOUNT.ACCESS,proxy:m,onValue:"all",offValue:"partial",labelCls:"m",cls:"form-inner inline-block",field:{name:"mode"}}).on("ev_loadData",function(P,o){if(o.mode=="all"){H.css("display","none")}else{H.fadeIn(200);H.grid("getStore").load()}});$("span#txt-mode-tips").html($.su.CHAR.ACCOUNT.ACCESS_TIPS);$("div#folder").panel({});var x=new $.su.Store({proxy:{url:D},fields:[{name:"mac"},{name:"description"},{name:"host"},{name:"enable"}],autoLoad:true});var H=$("div#localGrid").grid({store:x,minLines:0,cls:"part-separate",paging:{},editor:{content:"#own_editor",validator:function(){var R=H.grid("getStore");keyProperty=R.keyProperty;grid_array=R.data;var S=$(H.grid("getEditor"));var P=S.find("input[name=mac]").val();var o=grid_array.length;if($.isArray(grid_array)&&o>0){for(var Q=0;Q<o;Q++){if(S[0].editing){if(grid_array[Q].key==S[0].editingId){continue}}var T=grid_array[Q];if(T.mac==P){S.find("input[name=mac]").textbox("setError");S.form("setError",$.su.CHAR.ERROR["00000007"]);return false}}}return true},fields:[{name:"mac"},{name:"enable"},{name:"host"},{name:"description"}]},columns:[{xtype:"checkcolumn",width:60},{text:"ID",xtype:"rownumberer",width:60},{text:$.su.CHAR.ACCOUNT.MAC_ADDRESS,width:180,dataIndex:"mac"},{text:$.su.CHAR.ACCOUNT.DESCRIPTION,width:180,dataIndex:"description"},{text:$.su.CHAR.GRID.STATUS,width:100,name:"enable",xtype:"statuscolumn"},{name:"index",xtype:"settings"}],operation:"prompt|add|delete"}).on("ev_load",function(Q,o){var P=$(this);$(o).each(function(R,S){if(S.host){P.grid("disableRow",R)}})});$("div#remote").panel({title:$.su.CHAR.ACCOUNT.REMOTE,collapsible:false});$("#ip_port_cnt").fieldset({fields:[{name:"ipaddr"},{name:"port"}]});$("input#enable_remote").radio({fieldLabel:"",labelCls:"l",items:[{boxlabel:$.su.CHAR.ACCOUNT.DISABLE_REMOTE_MANAGEMENR,inputValue:"off",id:"radio-1"},{boxlabel:$.su.CHAR.ACCOUNT.ENABLE_REMOTE_MANAGEMENR_ALL,inputValue:"all",id:"radio-2"},{boxlabel:$.su.CHAR.ACCOUNT.ENABLE_REMOTE_MANAGEMENR,inputValue:"partial",id:"radio-3"}],column:1}).on("ev_change",function(Q,o,P){if(P=="off"){$("#ip_port_cnt").fieldset("disable")}else{if(P=="all"){$("#ip_port_cnt").fieldset("enable");$("#ipaddr").textbox("disable")}else{$("#ip_port_cnt").fieldset("enable")}}});$("input#port").textbox({fieldLabel:$.su.CHAR.ACCOUNT.WEB,vtype:"number",textFormat:$.su.format.number,allowBlank:false,maxLength:5,validator:function(o){var o=parseInt(o,10);if((o!=80)&&(o<1024)){return $.su.CHAR.ERROR["00000042"]}if(o>=65536){return $.su.CHAR.ERROR["00000042"]}return true},labelCls:"l"});$("input#ipaddr").textbox({fieldLabel:$.su.CHAR.ACCOUNT.REMOTEIP,labelCls:"l",vtype:{vtype:"ip",allowAllOneFlag:false},textFormat:$.su.format.ip,maxLength:15,allowBlank:false});var L=new $.su.Proxy({url:w});function B(Q,S){var P=S.length;for(var R=P-1;R>=0;R--){if(S[R].indexOf("-")>=0){var o=S[R].split("-");if((Q>=o[0])&&(Q<=o[1])){return true}}else{if(Q==S[R]){return true}}}return false}$("form#remote-setting").form({proxy:L,fields:[{name:"enable",mapping:"enable"},{name:"port",mapping:"port"},{name:"ipaddr",mapping:"ipaddr"}],submitBtn:"default",validator:function(){var o=$("input#port").textbox("getValue");var P=$("#enable_remote").radio("getValue");if(P!="off"){if(B(o,t)){$("#virtual_alert_cnt").msg("show");return false}if(B(o,v)){$("#trigger_alert_cnt").msg("show");return false}if(j=="on"){$("#dmz_alert_cnt").msg("show");return false}}if($.su.func.isSameNet($("#ipaddr").textbox("getValue"),J,N)){$("#ipaddr").textbox("setError");$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000056"]);return false}return true}}).on("ev_loadData",function(P,o){if(o.enable==""||!o.enable){$("#enable_remote").radio("setValue","off")}});$("#virtual_alert_cnt").msg({cls:"m warning",type:"alert"});$("#virtual_confirm_content").html($.su.CHAR.ACCOUNT.NOTICE_VIRTUAL);$("#trigger_alert_cnt").msg({cls:"m warning",type:"alert"});$("#trigger_confirm_content").html($.su.CHAR.ACCOUNT.NOTICE_TRIGGER);$("#dmz_alert_cnt").msg({cls:"m warning",type:"alert"});$("#dmz_confirm_content").html($.su.CHAR.ACCOUNT.NOTICE_DMZ);$("#test_mail_btn_cnt").bind("click",function(){$("#test_mail_btn").closest("#test_mail_btn_cnt .button-button").addClass("disabled");$("#test_mail_btn").closest("#test_mail_btn_cnt .button-button").prop("disabled",true);$.post(K,null,function(P,Q,o){$("#test_mail_btn").closest("#test_mail_btn_cnt .button-button").removeClass("disabled");$("#test_mail_btn").closest("#test_mail_btn_cnt .button-button").prop("disabled",false);if(P.success){$("#recovery-setting").form("prompt",true,"success")}else{$("#recovery-setting").form("prompt",false,"failed")}},"json")});$("#save_btn_cnt").bind("click",function(){if($("#recovery-setting").form("validate")){$("#save_btn").closest("#save_btn_cnt .button-button").addClass("disabled");$("#save_btn").closest("#save_btn_cnt .button-button").prop("disabled",true)}else{return false}$("#recovery-setting").form("doSubmit",{},function(){$("#save_btn").closest("#save_btn_cnt .button-button").removeClass("disabled");$("#save_btn").closest("#save_btn_cnt .button-button").prop("disabled",false)},function(){$("#save_btn").closest("#save_btn_cnt .button-button").removeClass("disabled");$("#save_btn").closest("#save_btn_cnt .button-button").prop("disabled",false)},function(){$("#save_btn").closest("#save_btn_cnt .button-button").removeClass("disabled");$("#save_btn").closest("#save_btn_cnt .button-button").prop("disabled",false)})});$("#ip_port_cnt").fieldset("disable");var l;if(window.sysMode=="ap"||window.sysMode=="re"){l=["ADMIN_ACCOUNT_AP"]}if(window.sysMode=="router"){l=["ADMIN_ACCOUNT"]}setTimeout(function(){if(!F&&l.indexOf("ADMIN_RECOVERY")!=-1){}var o=new $.su.Help({container:"div#help_admin",content:l});$.su.layout.doLayout()},500)});</script>
</body>
</html>
