<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>portTriggering</title>
</head>
<body>
	<div class="func-container">
		<div id="port-trigger">
			<div id="PORTTRIGGERINGGrid" class="natSeries">
			</div>
		</div>
		<div id="own_editor">
		<input id="trigger_name" name="name">
		<button   type="button"  id="trigger_view"></button>
		<input id="trigger_port" name="trigger_port">
		<input id="trigger_protocol" name="trigger_protocol">
		<input id="external_port" name="external_port">
		<input id="external_protocol" name="external_protocol">
		<input id="trigger_enable" name="enable">
		</div>
	 	<div id="trigger_survey">
	 	<div id="trigger_result">
		</div>
		<button id="ok"></button>
		<button id="cancle"></button>
	 	</div>
		<div id="trigger_alert_cnt">
			<h4 class="title">
		    	<span class="icon"></span>
		 		<span class="text" id="trigger_confirm_content"></span>
		 	</h4>
		</div> 
		<span id="nat_notice" class="hidden"></span>
	 	<div id="port_trigger_help"></div>
	</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(w){var c=$.su.url("/admin/nat?form=pt");var l=$.su.url("/admin/openvpn?form=config");var A=$.su.url("/admin/pptpd?form=config");var d=$.su.url("/admin/administration?form=remote");$("span#nat_notice").html($.su.CHAR.PORT_TRIGGERING.NAT_ENABLE_NOTICE);function t(D,C){var E;for(var o=0;o<D.length;o++){E=D.charAt(o);if(C.indexOf(E)==-1){return false}}return true}function q(o){if(!t(o,"0123456789")){return false}if(parseInt(o,10)<=0||parseInt(o,10)>65535){return false}return true}function z(o){if(!q(o)){return false}return true}function h(I){if(!t(I,ch=",-0123456789")){return false}var H;var G;var E;var F;E=new RegExp(",");F=new RegExp("-");H=I.split(E);if(H.length>5||H.length<1){return false}for(var D=0;D<H.length;D++){if(H[D]==""){return false}for(var o=D+1;o<H.length;o++){if(H[D]==H[o]){return false}}G=H[D].split(F);if(G.length!=1&&G.length!=2){return false}for(var C=0;C<G.length;++C){if(G[C]==""){return false}if(!z(G[C])){return false}}}return true}var x=new $.su.Proxy({url:d});var k="on";x.read({},function(o){remote_port=o.port;k=o.enable});$("div.func-container").page({title:$.su.CHAR.PORT_TRIGGERING.TITLE,help:""});$("div#port-trigger").panel({title:$.su.CHAR.PORT_TRIGGERING.TITLE,collapsible:false});$("input#trigger_name").textbox({fieldLabel:$.su.CHAR.PORT_TRIGGERING.APPLICATION,vtype:"string_visible_allow_blank",maxLength:32,cls:"inline"});$("input#trigger_port").textbox({fieldLabel:$.su.CHAR.PORT_TRIGGERING.TRIGGER_PORT,textFormat:$.su.format.number,vtype:{vtype:"number",max:65535,min:1},maxLength:5,tipsCls:"xs",allowBlank:false,tips:$.su.CHAR.PORT_TRIGGERING.TRIGGER_TIPS,validateIcon:true});$("input#trigger_protocol").combobox({fieldLabel:$.su.CHAR.PORT_TRIGGERING.TRIGGER_PROTOCOL,inputCls:"l",allowBlank:false,items:[{value:"ALL",name:$.su.CHAR.PORT_TRIGGERING.PROTOCAL_ALL,selected:"selected"},{value:"TCP",name:$.su.CHAR.PORT_TRIGGERING.PROTOCAL_TCP},{value:"UDP",name:$.su.CHAR.PORT_TRIGGERING.PROTOCAL_UDP}]});$("input#external_port").textbox({fieldLabel:$.su.CHAR.PORT_TRIGGERING.EXTERNAL_PORTS,textFormat:function(F){var C="";var H=F.split(",");var G=H.length;var E=[];if(G>5){return F}for(var D=0;D<G;D++){var o=H[D].split("-");if(o.length==1){if(!isNaN(parseInt(o[0],10))){E.push(parseInt(o[0],10))}}else{if(o.length==2){if((!isNaN(parseInt(o[0],10)))&&(!isNaN(parseInt(o[1],10)))){E.push(parseInt(o[0],10)+"-"+parseInt(o[1],10))}}}}return E.join(",")},validator:function(o){return h(o)},tipsCls:"s",maxLength:59,allowBlank:false,tips:$.su.CHAR.PORT_TRIGGERING.EXTERNAL_TIPS,validateIcon:true});$("input#external_protocol").combobox({fieldLabel:$.su.CHAR.PORT_TRIGGERING.EXTERNAL_PROTOCOL,inputCls:"l",allowBlank:false,items:[{value:"ALL",name:$.su.CHAR.PORT_TRIGGERING.PROTOCAL_ALL,selected:"selected"},{value:"TCP",name:$.su.CHAR.PORT_TRIGGERING.PROTOCAL_TCP},{value:"UDP",name:$.su.CHAR.PORT_TRIGGERING.PROTOCAL_UDP}]});$("input#trigger_enable").checkbox({fieldLabel:"",defaultValue:["on"],items:[{boxlabel:$.su.CHAR.PORT_TRIGGERING.ENABLE_THIS_ENTRY,uncheckedValue:"off",inputValue:"on",id:"chk_enable",checked:true}]});$("#trigger_view").button({text:$.su.CHAR.PORT_TRIGGERING.BTN_VIEW,cls:"inline-block  ml5",handler:function(){$("div#trigger_survey").msg("show");p.loadData(y)}});$("#trigger_alert_cnt").msg({cls:"m warning",type:"alert"});$("#trigger_confirm_content").html($.su.CHAR.PORT_TRIGGERING.NOTICE);var B=new $.su.Proxy({url:l});var s=new $.su.Proxy({url:A});var i=0;var r=0;var f=0;var g=0;B.read({},function(o){f=o.proto;r=o.port;i=o.enabled});s.read({},function(o){g=o.enabled});var u=$("div#trigger_survey").msg({title:$.su.CHAR.PORT_TRIGGERING.EXSITTING_APPLICATION,autoshow:false,type:"window"});var p=new $.su.Store({fields:[{name:"name"}],autoLoad:false});var y=[{name:"Battle.net",trigger_port:"6112",external_port:"6112"},{name:"Dialpad",trigger_port:"7175",external_port:"51200-51201,51210"},{name:"ICU II",trigger_port:"2019",external_port:"2000-2038,2050-2051,2069,2085,3010-3030"},{name:"MSN Gaming Zone",trigger_port:"47624",external_port:"2300-2400,28800-29000"},{name:"PC-to-Phone",trigger_port:"12053",external_port:"12120,12122,24150-24220"},{name:"Quick Time 4",trigger_port:"554",external_port:"6970-6999"},{name:"AOE II Client",trigger_port:"47624",external_port:"2300-2400,28800-29000"},{name:"Sudden Strike",trigger_port:"47624",external_port:"2300-2400"},{name:"Baldurs Gate II",trigger_port:"47624",external_port:"2300-2400"}];var v=$("div#trigger_result").grid({store:p,maxLines:5,columns:[{text:$.su.CHAR.PORT_TRIGGERING.ID,xtype:"rownumberer",width:80},{text:$.su.CHAR.PORT_TRIGGERING.APPLICATION_NAME,width:380,dataIndex:"name"},{text:$.su.CHAR.GRID.OPERATION,renderer:function(C,o){return'<a href="javascript:void(0);" data-index="'+o+'" class="choose">'+$.su.CHAR.OPERATION.CHOOSE+"</a>"}}]});$(v).delegate("a.choose","click",function(E){E.preventDefault();var o=v.grid("getStore"),C=$(this).attr("data-index"),D=o.data[C]||undefined;if(D){$("input#trigger_name").textbox("setValue",D.name);$("input#trigger_port").textbox("setValue",D.trigger_port);$("input#external_port").textbox("setValue",D.external_port);$("input#trigger_protocol").combobox("setValue","ALL");$("input#external_protocol").combobox("setValue","ALL")}u.msg("close")});var b=new $.su.Proxy({url:c});var n=$("div#PORTTRIGGERINGGrid").grid({store:{proxy:b,fields:[{name:"name"},{name:"trigger_port"},{name:"trigger_protocol"},{name:"external_port"},{name:"external_protocol"},{name:"enable"}],autoLoad:true},editor:{beforeSubmit:function(){var o=$("input#external_port").textbox("getValue");var E=$("input#external_protocol").combobox("getValue")[0];var D=$("#trigger_enable").checkbox("getValue")[0];var F=o.split("-");if(F.length==2){F[0]=parseInt(F[0],10);F[1]=parseInt(F[1],10);if(parseInt(F[0],10)>parseInt(F[1],10)){var C=F[0];F[0]=F[1];F[1]=C}}if(k=="off"){return true}if((E!="UDP")&&(D)){if(F.length==1){F[0]=parseInt(F[0],10);if(F[0]==remote_port){$("#trigger_alert_cnt").msg("show");return false}}if(F.length==2){if((F[0]<=remote_port)&&(F[1]>=remote_port)){$("#trigger_alert_cnt").msg("show");return false}}}return true},validator:function(){var E=$("input#trigger_port").textbox("getValue");var H=$("input#trigger_protocol").combobox("getValue")[0];var D=$("input#external_port").textbox("getValue");var F=$("input#external_protocol").combobox("getValue")[0];var C=n.grid("getStore");keyProperty=C.keyProperty;grid_array=C.data;var G=$(n.grid("getEditor"));editingId=G.editor("getEditingId");if(i=="on"&&(f==F.toLowerCase()||F=="ALL")&&r==D){$($("#PORTTRIGGERINGGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000218"]);$("input#external_port").textbox("setError");return false}if(g=="on"&&D=="1723"){$($("#PORTTRIGGERINGGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000219"]);$("input#external_port").textbox("setError");return false}if($.isArray(grid_array)&&grid_array.length>0){for(var o=0;o<grid_array.length;o++){var I=grid_array[o];if(I[keyProperty]==editingId){continue}else{if(I.trigger_port==E&&I.trigger_protocol==H){$($("#PORTTRIGGERINGGrid").grid("getEditor")).form("setError",$.su.CHAR.ERROR["00000076"]);return false}}}}return true},content:"#own_editor",fields:[{name:"name"},{name:"trigger_port"},{name:"trigger_protocol"},{name:"external_port"},{name:"external_protocol"},{name:"enable"}]},paging:{},columns:[{xtype:"checkcolumn",width:32},{text:$.su.CHAR.PORT_TRIGGERING.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.PORT_TRIGGERING.APPLICATION,width:100,dataIndex:"name"},{text:$.su.CHAR.PORT_TRIGGERING.TRIGGER_PORT,width:80,dataIndex:"trigger_port"},{text:$.su.CHAR.PORT_TRIGGERING.TRIGGER_PROTOCOL,width:100,dataIndex:"trigger_protocol"},{text:$.su.CHAR.PORT_TRIGGERING.EXTERNAL_PORTS,width:80,dataIndex:"external_port"},{text:$.su.CHAR.PORT_TRIGGERING.EXTERNAL_PROTOCOL,width:80,dataIndex:"external_protocol"},{text:$.su.CHAR.PORT_TRIGGERING.ENABLE,width:70,dataIndex:"enable",xtype:"statuscolumn"},{xtype:"settings"}],operation:"prompt|add|delete"});var a=$("div#PORTTRIGGERINGGrid").grid("getEditor");$(a).on("ev_startEdit",function(D,o,C){if(o=="add"){$("#trigger_protocol").combobox("setValue","ALL");$("#external_protocol").combobox("setValue","ALL")}});var j=new $.su.Proxy({url:$.su.url("/admin/nat?form=setting")});j.read({},function(o){if(o.enable=="off"){$("span#nat_notice").show()}else{$("span#nat_notice").hide()}});$("#PORTTRIGGERINGGrid").on("click","a#go-to-openvpn",function(){$.su.menu.advanced.goTo("openvpn")});$("#PORTTRIGGERINGGrid").on("click","a#go-to-pptpvpn",function(){$.su.menu.advanced.goTo("pptpvpn")});var m=new $.su.Help({container:"div#port_trigger_help",content:"PORT_TRIGGERING"})});</script>
</body>
</html>