<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Internet</title>
</head>
<body>
<div class="func-container">
	 <div id="lan-ipv4">
	 	<form id="lan-ipv4-setting">
		<div id="dhcp_re_ap">
	    	<input type="text"  id="dhcpServer_radio" name="enable" value="" />
		</div>
		<div id="dhcp_router">
			<input type="text"  id="dhcpServer_check" name="enable1" value=""/>
		</div>
			<div id="all_grayout">
				<input type="text"  id="start_ip_address" name="ipaddr_start" value="" />
				<span style="position: relative; top: 25px;">-</span>
				<input type="text"  id="end_ip_address" name="ipaddr_end" value="" />
				<input   id="lease_time" name="leasetime" value="" />
				<input   id="gateway" name="gateway" value="" />
				<input   id="dns1" name="pri_dns" value="" />
				<input   id="dns2" name="snd_dns" value="" />
			</div>
	    </form>
	 </div>
	 <div id="addrReverse">
	 	<div id="addrReverseGrid" >
		</div>
		<div id="addrReverse_cnt">
			<input id="addr_macaddr" name="mac"/>
			<button type="button"  id="device_view"></button>
			<input id="addr_ipaddr" name="ip"/>
			<input id="addr_description" name="name"/>
			<input id="enable_addr_reverse" name="enable"/>
		</div>
	 </div>
	 <div id="checkList">
	 	<div id="checkListGrid">
		</div>
	 </div>
	 <div id="device_survey">
		 <div id="device_result">
		 </div>
	 </div>
	 <div id="dhcp_server_help"></div>
</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(j){var i=$.su.url("/admin/dhcps?form=client");$("div.func-container").page({title:$.su.CHAR.DHCP_SERVER.TITLE,help:""});$("div#lan-ipv4").panel({title:$.su.CHAR.DHCP_SERVER.SETTINGS});if(window.sysMode=="router"){$("#dhcp_re_ap").hide();$("#dhcp_router").show()}else{$("#dhcp_re_ap").show();$("#dhcp_router").hide();$("#addrReverse").hide()}var f=0;var n=0;var h=new $.su.Proxy({url:$.su.url("/admin/network?form=status_ipv4"),async:false});h.read({},function(o){f=o.lan_ipv4_ipaddr;n=o.lan_ipv4_netmask});$("#all_grayout").fieldset({fields:[{name:"ipaddr_start"},{name:"ipaddr_end"},{name:"leasetime"},{name:"gateway"},{name:"pri_dns"},{name:"snd_dns"}]});$("input#dhcpServer_check").checkbox({fieldLabel:$.su.CHAR.DHCP_SERVER.TITLE,items:[{boxlabel:$.su.CHAR.DHCP_SERVER.ENABLE_DHCP_SERVER,inputValue:"on",uncheckedValue:"off"}]}).on("ev_change",function(t,q,s){var u=(s[0]=="enable1"||s[0]=="on")?"on":"off";switch(u){case"on":$("#all_grayout").fieldset("enable");var r=$("div#addrReverseGrid").grid("getStore").data;var o=$("div#checkListGrid").grid("getStore").data;for(var p=0;p<r.length;p++){$("#addrReverseGrid").grid("enableRow",p)}for(var p=0;p<o.length;p++){$("#checkListGrid").grid("enableRow",p)}break;case"off":$("#all_grayout").fieldset("disable");var r=$("div#addrReverseGrid").grid("getStore").data;var o=$("div#checkListGrid").grid("getStore").data;for(var p=0;p<r.length;p++){$("#addrReverseGrid").grid("disableRow",p)}for(var p=0;p<o.length;p++){$("#checkListGrid").grid("disableRow",p)}break}});$("input#dhcpServer_radio").radio({fieldLabel:$.su.CHAR.DHCP_SERVER.TITLE,columns:3,items:[{boxlabel:$.su.CHAR.DHCP_SERVER.SERVER_AUTO,inputValue:"auto"},{boxlabel:$.su.CHAR.DHCP_SERVER.SERVER_ENABLE,inputValue:"enable"},{boxlabel:$.su.CHAR.DHCP_SERVER.SERVER_DISABLE,inputValue:"disable"}]}).on("ev_change",function(t,q,s){switch(s){case"auto":if(window.sysMode=="router"){$("#all_grayout").fieldset("enable")}else{$("#all_grayout").fieldset("disable")}var r=$("div#addrReverseGrid").grid("getStore").data;var o=$("div#checkListGrid").grid("getStore").data;for(var p=0;p<r.length;p++){$("#addrReverseGrid").grid("enableRow",p)}for(var p=0;p<o.length;p++){$("#checkListGrid").grid("enableRow",p)}break;case"enable":$("#all_grayout").fieldset("enable");var r=$("div#addrReverseGrid").grid("getStore").data;var o=$("div#checkListGrid").grid("getStore").data;for(var p=0;p<r.length;p++){$("#addrReverseGrid").grid("enableRow",p)}for(var p=0;p<o.length;p++){$("#checkListGrid").grid("enableRow",p)}break;case"disable":$("#all_grayout").fieldset("disable");var r=$("div#addrReverseGrid").grid("getStore").data;var o=$("div#checkListGrid").grid("getStore").data;for(var p=0;p<r.length;p++){$("#addrReverseGrid").grid("disableRow",p)}for(var p=0;p<o.length;p++){$("#checkListGrid").grid("disableRow",p)}break}});$("input#start_ip_address").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.IP_ADDR_POOL,cls:"inline part-seperate",allowBlank:false,textFormat:$.su.format.ip,vtype:"ip"});$("input#end_ip_address").textbox({fieldLabel:null,cls:"inline part-seperate",allowBlank:false,textFormat:$.su.format.ip,vtype:"ip"});$("input#lease_time").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.LEASETIME,tips:$.su.CHAR.DHCP_SERVER.LEASENOTE,inputCls:"s",tipsCls:"l",textFormat:$.su.format.number,vtype:{vtype:"number",max:2880,min:1}});$("input#gateway").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.GATEWAY,tips:$.su.CHAR.DHCP_SERVER.OPTIONAL,textFormat:$.su.format.ip,vtype:"ip",cls:"part-seperate"});$("input#dns1").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.PRIMARYDNS,tips:$.su.CHAR.DHCP_SERVER.OPTIONAL,textFormat:$.su.format.ip,vtype:"ip"});$("input#dns2").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.SECONDARYDNS,tips:$.su.CHAR.DHCP_SERVER.OPTIONAL,textFormat:$.su.format.ip,vtype:"ip"});var l=new $.su.Proxy({url:$.su.url("/admin/dhcps?form=setting")});var k=$("form#lan-ipv4-setting").form({proxy:l,fields:[{name:"enable",mapping:"enable"},{name:"enable1",mapping:"enable1"},{name:"ipaddr_start",mapping:"ipaddr_start"},{name:"ipaddr_end",mapping:"ipaddr_end"},{name:"leasetime",mapping:"leasetime"},{name:"gateway",mapping:"gateway"},{name:"pri_dns",mapping:"pri_dns"},{name:"snd_dns",mapping:"snd_dns"}],submitBtn:"default",validator:function(){if(window.sysMode!="router"){var o=$("input#dhcpServer_radio").textbox("getValue");if(o!="enable"){return true}}var p=$("input#start_ip_address").textbox("getValue");var q=$("input#end_ip_address").textbox("getValue");var r=$("input#gateway").textbox("getValue");if($.su.func.ipToInt(p)>$.su.func.ipToInt(q)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000053"]);$("input#end_ip_address").textbox("setError");return false}if(!$.su.func.isSameNet(p,f,n)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000054"]);$("input#start_ip_address").textbox("setError");return false}if(!$.su.func.isSameNet(q,f,n)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000054"]);$("input#end_ip_address").textbox("setError");return false}if($.su.func.isNetIp(p,n)||$.su.func.isBroadCastIp(p,n)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000059"]);$("input#start_ip_address").textbox("setError");return false}if($.su.func.isNetIp(q,n)||$.su.func.isBroadCastIp(q,n)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000059"]);$("input#end_ip_address").textbox("setError");return false}if(r&&!$.su.func.isSameNet(r,f,n)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000045"]);$("input#gateway").textbox("setError");return false}if($.su.func.isNetIp(r,n)||$.su.func.isBroadCastIp(r,n)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000059"]);$("input#gateway").textbox("setError");return false}return true}}).on("ev_loadData",function(p,o){if(o.enable==""||!o.enable){$("#dhcpServer_radio").radio("setValue","auto")}});$("div#checkList").panel({title:$.su.CHAR.DHCP_SERVER.CLIENTSLIST});$("div#addrReverse").panel({title:$.su.CHAR.DHCP_SERVER.RESERVATION});$("div#checkListGrid").grid({operation:[{xtype:"totalCount",fieldLabel:$.su.CHAR.DHCP_SERVER.CLIENT_NUMBER,cls:"left"},"refresh"],store:{proxy:{url:$.su.url("/admin/dhcps?form=client")},fields:[{name:"name"},{name:"macaddr"},{name:"ipaddr"},{name:"leasetime"}],autoLoad:true},minLines:0,columns:[{text:$.su.CHAR.DHCP_SERVER.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.DHCP_SERVER.CLIENT_NAME,dataIndex:"name",width:160},{text:$.su.CHAR.DHCP_SERVER.MAC_ADDR,width:140,dataIndex:"macaddr"},{text:$.su.CHAR.DHCP_SERVER.ASSIGNED_IP,width:150,dataIndex:"ipaddr"},{text:$.su.CHAR.DHCP_SERVER.LEASE_TIME,dataIndex:"leasetime"}]});$("input#addr_macaddr").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.MAC_ADDR,vtype:"mac",allowBlank:false,maxLength:17,cls:"inline-block",validator:function(o){return true}});$("button#device_view").button({text:$.su.CHAR.DHCP_SERVER.BTN_VIEW,cls:"inline-block ml5",handler:function(){$("div#device_survey").msg("show");m.load()}});var a=$("div#device_survey").msg({autoshow:false,title:$.su.CHAR.DHCP_SERVER.CLIENTSLIST,type:"window"});var b=new $.su.Proxy({url:i});var m=new $.su.Store({proxy:b,fields:[{name:"name"},{name:"ipaddr"},{name:"macaddr"}],autoLoad:false});var d=$("div#device_result").grid({store:m,maxLines:5,paging:{},columns:[{text:$.su.CHAR.DHCP_SERVER.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.DHCP_SERVER.CLIENT_NAME,width:150,dataIndex:"name"},{text:$.su.CHAR.DHCP_SERVER.MAC_ADDR,width:170,dataIndex:"macaddr"},{text:$.su.CHAR.DHCP_SERVER.IP_ADDRESS,width:150,dataIndex:"ipaddr"},{text:$.su.CHAR.GRID.OPERATION,renderer:function(p,o){return'<a href="javascript:void(0);" data-index="'+o+'" class="choose-existing-service choose" >'+$.su.CHAR.OPERATION.CHOOSE+"</a>"}}]});$(d).delegate("a.choose-existing-service","click",function(r){r.preventDefault();var o=d.grid("getStore"),p=$(this).attr("data-index"),q=o.data[p]||undefined;if(q){$("input#addr_ipaddr").textbox("setValue",q.ipaddr);$("input#addr_macaddr").textbox("setValue",q.macaddr)}a.msg("close")});$("input#addr_ipaddr").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.IP_ADDRESS,textFormat:$.su.format.ip,allowBlank:false,vtype:"ip",validator:function(o){return true}});$("input#addr_description").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.DESCRIPTION,tips:$.su.CHAR.DHCP_SERVER.DESCRIPTNOTE,tipsCls:"s",maxLength:32,vtype:{vtype:"string_visible_describe"}});$("input#enable_addr_reverse").checkbox({fieldLabel:"",items:[{boxlabel:$.su.CHAR.DHCP_SERVER.ENABLE,inputValue:"on",uncheckedValue:"off"}]});var c=$("div#addrReverseGrid").grid({store:{proxy:{url:$.su.url("/admin/dhcps?form=reservation")},fields:[{name:"mac"},{name:"ip"},{name:"name"},{name:"enable"}],autoLoad:true},minLines:0,paging:{},editor:{content:"#addrReverse_cnt",fields:[{name:"mac"},{name:"ip"},{name:"name"},{name:"enable"}],validator:function(){var t=$(c.grid("getEditor"));var o=c[0].editor.editingIndex;var r=$("div#addrReverseGrid").grid("getStore").data;var s=$("input#addr_macaddr").textbox("getValue");var p=$("input#addr_ipaddr").textbox("getValue");for(var q=0;q<r.length;q++){if(o!=q&&s==r[q].mac){$("input#addr_macaddr").textbox("setError");t.form("setError",$.su.CHAR.ERROR["00000051"]);return false}}for(var q=0;q<r.length;q++){if(o!=q&&p==r[q].ip){t.form("setError",$.su.CHAR.ERROR["00000052"]);return false}}if(!$.su.func.isSameNet(p,f,n)){t.form("setError",$.su.CHAR.ERROR["00000054"]);return false}if($.su.func.isNetIp(p,n)||$.su.func.isBroadCastIp(p,n)){t.form("setError",$.su.CHAR.ERROR["00000059"]);return false}if($.su.func.ipToInt(p)==$.su.func.ipToInt(f)){t.form("setError",$.su.CHAR.ERROR["00000106"]);return false}return true}},columns:[{xtype:"checkcolumn",width:40},{text:$.su.CHAR.DHCP_SERVER.ID,xtype:"rownumberer",width:50},{text:$.su.CHAR.DHCP_SERVER.MAC_ADDR,width:160,dataIndex:"mac"},{text:$.su.CHAR.DHCP_SERVER.RESERVED_IP,width:120,dataIndex:"ip"},{text:$.su.CHAR.DHCP_SERVER.DESCRIPTION,width:100,dataIndex:"name"},{text:$.su.CHAR.GRID.STATUS,width:100,dataIndex:"enable",renderer:function(x,u,t){var y=t[c.grid("getStore").keyProperty];var r=c.grid("getColumns");var q=r[0];var o="";var v="",z="",p="",w=q.trueValue||"on",s=q.falseValue||"off";if(t.enable==="on"){v=$.su.CHAR.GRID.ENABLED;z="enabled";p="on"}else{v=$.su.CHAR.GRID.DISABLED;z="disabled";p="off"}if(!$.su.func.isSameNet(t.ip,f,n)){v=$.su.CHAR.GRID.DISABLED;z="disabled";p="off"}o+='<a href="javascript:void(0);" data-index="'+u+'" data-name="'+q.dataIndex+'" data-value="'+p+'" data-key="'+y+'" data-on="on" data-off="off" data-ip="'+t.ip+'" class="grid-content-btn btn-status-change btn-status '+z+'">';o+='<span class="icon"></span>';o+='<span class="text">'+v+"</span>";o+="</a>";return o}},{xtype:"settings"}],operation:"prompt|add|delete"});c.delegate("a.btn-status-change","click",function(x){x.preventDefault();x.stopPropagation();var B=$(this).attr("data-key"),A=$(this).attr("data-value"),r=$(this).attr("data-on"),t=$(this).attr("data-off"),o=$(this).attr("data-name"),v=$(this).attr("data-index"),w=$(this).attr("data-ip"),z=c.grid("getStore"),q=z.keyProperty;dOld=z.getData(B);if(!B){return}else{var y=$(this).closest("tr.grid-content-tr");if(y.hasClass("disabled")){return}var s=c.grid("getEditor");if(s&&s.isEditor){if(s.editing){$(s).editor("shake");return}}if(!$.su.func.isSameNet(w,f,n)){return}var p={};p.enable=(A==="on")?"off":"on";var u=$.extend({},dOld,p);delete u[q];c.grid("runProgress");z.update(B,{old:$.su.json.toJSONString(dOld),"new":$.su.json.toJSONString(u)},function(){c.grid("prompt",true)},function(){c.grid("prompt",false)})}});var g=new $.su.Help({container:"div#dhcp_server_help",content:["DHCP_SERVER_SETTINGS","RESERVED_IP_ADDRESS","DHCP_CLIENT_LIST"]})});</script>
</body>
</html>