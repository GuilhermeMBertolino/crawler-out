<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Internet</title>
</head>
<body>
<div class="func-container">
	<div id="lan_panel">
		 <div id="lan_ipv4">
		 	<form id="lan_ipv4-setting">
		    	<input type="text"  id="ipv4_lan_mac_address" name="macaddr" value="" />
		    	<input type="text"  id="ipv4_lan_ip_address" name="ipaddr" value="" />
		    	<input id="ipv4_lan_mask_address" name="mask_type" value="" />
		    	<input id="custom" name="custom_value" value="" />
		    	<button id="lan_submit" type="button"></button>
		    </form>
		 </div>
	</div>
	<div id="lan_pro_msg" class="hidden">
		<div class="reboot-loading-msg">
			<p id="reboot_tips"></p>
			<input id="lan_pro" />
		</div>
	</div>
	 <div id="lan-ipv4">
	 	<form id="lan-ipv4-setting">
	    	<input type="text"  id="dhcpServer" name="enable" value=""/>
	    	<input type="text"  id="start_ip_address" name="ipaddr_start" value="" />
	    	<span>-</span>
	    	<input type="text"  id="end_ip_address" name="ipaddr_end" value="" />
	    	<input   id="lease_time" name="leasetime" value="" />
	    	<input   id="gateway" name="gateway" value="" />
	    	<input   id="dns1" name="pri_dns" value="" />
	    	<input   id="dns2" name="snd_dns" value="" />
	    </form>
	 </div>
	 <div id="addrReverse">
	 	<div id="addrReverseGrid">
		</div>
		<div id="addrReverse_cnt">
			<input id="addr_macaddr" name="mac"/>
			<button type="button"  id="device_view"></button>
			<input id="addr_ipaddr" name="ip"/>
			<input id="addr_description" name="name"/>
			<input id="enable_addr_reverse" name="enable"/>
		</div>
	 </div>
	 <div id="checkList">
	 	<div id="checkListGrid">
		</div>
	 </div>
	 <div id="device_survey">
		 <div id="device_result">
		 </div>
	 </div>
	 <div id="dhcp_server_help"></div>
</div>
<script type="text/javascript">try{$}catch(e){location.href="/"}$(document).ready(function(r){var p=$.su.url("/admin/dhcps?form=client");$("div.func-container").page({title:$.su.CHAR.DHCP_SERVER.TITLE,help:""});$("div#lan-ipv4").panel({title:$.su.CHAR.DHCP_SERVER.SETTINGS});var a=0;var o=0;var s=0;var j=0;var n=0;var b=0;var k=0;var d=new $.su.Proxy({url:$.su.url("/admin/network?form=status_ipv4")});d.read({},function(v){a=v.lan_ipv4_ipaddr;o=v.lan_ipv4_netmask;s=v.wan_ipv4_ipaddr;j=v.wan_ipv4_netmask;k=v.wan_ipv4_conntype;v.wan_ipv4_snd_ipaddr?n=v.wan_ipv4_snd_ipaddr:1;v.wan_ipv4_snd_netmask?b=v.wan_ipv4_snd_netmask:1});$("div#lan_panel").panel({title:$.su.CHAR.LAN.TITLE,collapsible:false});$("input#ipv4_lan_mac_address").textbox({fieldLabel:$.su.CHAR.LAN.MAC_ADDRESS,readOnly:true});$("input#ipv4_lan_ip_address").textbox({fieldLabel:$.su.CHAR.LAN.IP_ADDRESS,allowBlank:false,textFormat:$.su.format.ip,vtype:"ip"});$("input#ipv4_lan_mask_address").combobox({fieldLabel:$.su.CHAR.LAN.SUBNET_MASK,cls:"inline",items:[{name:"255.255.255.0",value:"255.255.255.0"},{name:"255.255.0.0",value:"255.255.0.0"},{name:"255.0.0.0",value:"255.0.0.0"},{name:$.su.CHAR.LAN.CUSTOM,value:"custom"}]}).on("ev_change",function(x,v,w){switch(w[0]){case"custom":$("input#custom").textbox("getContainer").css({display:"inline-block"});$("input#custom").textbox("enable");break;default:$("input#custom").textbox("hide");$("input#custom").textbox("disable")}});$("input#custom").textbox({fieldLabel:null,cls:"inline-block hidden",allowBlank:false,vtype:"netmask"});$("p#reboot_tips").html($.su.CHAR.LAN.REBOOT_TIP);var g=$("div#lan_pro_msg").msg({type:"window",global:true,closeBtn:false,cls:"warning reboot-confirm-size"});var c=$("input#lan_pro").progressbar({height:6,width:326});var t=new $.su.Proxy({timeout:20000,url:$.su.url("/admin/network?form=lan_ipv4")});$("form#lan_ipv4-setting").form({proxy:t,fields:[{name:"macaddr",mapping:"macaddr"},{name:"ipaddr",mapping:"ipaddr"},{name:"mask_type",mapping:"mask_type"},{name:"custom_value",mapping:"custom_value"}],submitBtn:"#lan_submit",validator:function(){var v=$("input#ipv4_lan_ip_address").textbox("getValue");var w=$("input#ipv4_lan_mask_address").combobox("getValue")[0]=="custom"?$("input#custom").textbox("getValue"):$("input#ipv4_lan_mask_address").combobox("getValue")[0];if(!$.su.func.isNetIpLegal(v,w)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000059"]);$("input#ipv4_lan_ip_address").textbox("setError");$("input#ipv4_lan_mask_address").combobox("setError");return false}if($.su.func.isNetIp(v,w)||$.su.func.isBroadCastIp(v,w)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000059"]);$("input#ipv4_lan_ip_address").textbox("setError");return false}if($.su.func.isSameNet(v,s,j)||$.su.func.isSameNet(s,v,w)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000060"]);$("input#ipv4_lan_ip_address").textbox("setError");return false}if((k=="l2tp"||k=="pptp"||k=="pppoe")&&n!=0&&b!=0&&($.su.func.isSameNet(v,n,b)||$.su.func.isSameNet(n,v,w))){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000060"]);$("input#ipv4_lan_ip_address").textbox("setError");return false}return true}});$("button#lan_submit").button({text:$.su.CHAR.LAN.SAVE,cls:"submit",handler:function(){$("form#lan-ipv4-setting").form("submit",{},function(w){function v(A){var y=top.location.href;var z=y.indexOf("//");if(-1!=y.indexOf("tplink")){top.location.href=top.location.href}else{top.location.href=y.slice(0,z+2)+A}}if(w.new_ipaddr){g.msg("show");c.progressbar("reset");c.progressbar("animate",0,1,32000);var x=setTimeout(function(){v("tplinkwifi.net")},32000)}})}});$("input#dhcpServer").checkbox({fieldLabel:$.su.CHAR.DHCP_SERVER.TITLE,items:[{boxlabel:$.su.CHAR.DHCP_SERVER.ENABLE_DHCP_SERVER,inputValue:"on",uncheckedValue:"off"}]});$("input#start_ip_address").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.IP_ADDR_POOL,cls:"inline part-seperate",allowBlank:false,textFormat:$.su.format.ip,vtype:"ip"});$("input#end_ip_address").textbox({fieldLabel:null,cls:"inline part-seperate",allowBlank:false,textFormat:$.su.format.ip,vtype:"ip"});$("input#lease_time").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.LEASETIME,tips:$.su.CHAR.DHCP_SERVER.LEASENOTE,inputCls:"s",tipsCls:"l",textFormat:$.su.format.number,vtype:{vtype:"number",max:2880,min:1}});$("input#gateway").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.GATEWAY,tips:$.su.CHAR.DHCP_SERVER.OPTIONAL,textFormat:$.su.format.ip,vtype:"ip",cls:"part-seperate"});$("input#dns1").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.PRIMARYDNS,tips:$.su.CHAR.DHCP_SERVER.OPTIONAL,textFormat:$.su.format.ip,vtype:"ip"});$("input#dns2").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.SECONDARYDNS,tips:$.su.CHAR.DHCP_SERVER.OPTIONAL,textFormat:$.su.format.ip,vtype:"ip"});var t=new $.su.Proxy({url:$.su.url("/admin/dhcps?form=setting")});var m=$("form#lan-ipv4-setting").form({proxy:t,fields:[{name:"enable",mapping:"enable"},{name:"ipaddr_start",mapping:"ipaddr_start"},{name:"ipaddr_end",mapping:"ipaddr_end"},{name:"leasetime",mapping:"leasetime"},{name:"gateway",mapping:"gateway"},{name:"pri_dns",mapping:"pri_dns"},{name:"snd_dns",mapping:"snd_dns"}],submitBtn:"default",validator:function(){var v=$("input#start_ip_address").textbox("getValue");var w=$("input#end_ip_address").textbox("getValue");var x=$("input#gateway").textbox("getValue");if($.su.func.ipToInt(v)>$.su.func.ipToInt(w)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000053"]);$("input#end_ip_address").textbox("setError");return false}if(!$.su.func.isSameNet(v,a,o)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000054"]);$("input#start_ip_address").textbox("setError");return false}if(!$.su.func.isSameNet(w,a,o)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000054"]);$("input#end_ip_address").textbox("setError");return false}if($.su.func.isNetIp(v,o)||$.su.func.isBroadCastIp(v,o)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000059"]);$("input#start_ip_address").textbox("setError");return false}if($.su.func.isNetIp(w,o)||$.su.func.isBroadCastIp(w,o)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000059"]);$("input#end_ip_address").textbox("setError");return false}if(x&&!$.su.func.isSameNet(x,a,o)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000045"]);$("input#gateway").textbox("setError");return false}if($.su.func.isNetIp(x,o)||$.su.func.isBroadCastIp(x,o)){$("form#lan-ipv4-setting").form("setError",$.su.CHAR.ERROR["00000059"]);$("input#gateway").textbox("setError");return false}return true}});$("div#checkList").panel({title:$.su.CHAR.DHCP_SERVER.CLIENTSLIST});$("div#addrReverse").panel({title:$.su.CHAR.DHCP_SERVER.RESERVATION});$("div#checkListGrid").grid({operation:[{xtype:"totalCount",fieldLabel:$.su.CHAR.DHCP_SERVER.CLIENT_NUMBER,cls:"left"},"refresh"],store:{proxy:{url:$.su.url("/admin/dhcps?form=client")},fields:[{name:"name"},{name:"macaddr"},{name:"ipaddr"},{name:"leasetime"}],autoLoad:true},minLines:0,columns:[{text:$.su.CHAR.DHCP_SERVER.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.DHCP_SERVER.CLIENT_NAME,dataIndex:"name",width:160},{text:$.su.CHAR.DHCP_SERVER.MAC_ADDR,width:140,dataIndex:"macaddr"},{text:$.su.CHAR.DHCP_SERVER.ASSIGNED_IP,width:150,dataIndex:"ipaddr"},{text:$.su.CHAR.DHCP_SERVER.LEASE_TIME,dataIndex:"leasetime"}]});$("input#addr_macaddr").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.MAC_ADDR,vtype:"mac",allowBlank:false,maxLength:17,cls:"inline-block",validator:function(v){return true}});$("button#device_view").button({text:$.su.CHAR.DHCP_SERVER.BTN_VIEW,cls:"inline-block ml5",handler:function(){$("div#device_survey").msg("show");l.load()}});var u=$("div#device_survey").msg({autoshow:false,title:$.su.CHAR.DHCP_SERVER.CLIENTSLIST,type:"window"});var i=new $.su.Proxy({url:p});var l=new $.su.Store({proxy:i,fields:[{name:"name"},{name:"ipaddr"},{name:"macaddr"}],autoLoad:false});var q=$("div#device_result").grid({store:l,maxLines:5,paging:{},columns:[{text:$.su.CHAR.DHCP_SERVER.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.DHCP_SERVER.CLIENT_NAME,width:150,dataIndex:"name"},{text:$.su.CHAR.DHCP_SERVER.MAC_ADDR,width:170,dataIndex:"macaddr"},{text:$.su.CHAR.DHCP_SERVER.IP_ADDRESS,width:150,dataIndex:"ipaddr"},{text:$.su.CHAR.GRID.OPERATION,renderer:function(w,v){return'<a href="javascript:void(0);" data-index="'+v+'" class="choose-existing-service choose" >'+$.su.CHAR.OPERATION.CHOOSE+"</a>"}}]});$(q).delegate("a.choose-existing-service","click",function(y){y.preventDefault();var v=q.grid("getStore"),w=$(this).attr("data-index"),x=v.data[w]||undefined;if(x){$("input#addr_ipaddr").textbox("setValue",x.ipaddr);$("input#addr_macaddr").textbox("setValue",x.macaddr)}u.msg("close")});$("input#addr_ipaddr").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.IP_ADDRESS,textFormat:$.su.format.ip,allowBlank:false,vtype:"ip",validator:function(v){return true}});$("input#addr_description").textbox({fieldLabel:$.su.CHAR.DHCP_SERVER.DESCRIPTION,tips:$.su.CHAR.DHCP_SERVER.DESCRIPTNOTE,tipsCls:"s",maxLength:32,vtype:{vtype:"string_visible_describe"}});$("input#enable_addr_reverse").checkbox({fieldLabel:"",items:[{boxlabel:$.su.CHAR.DHCP_SERVER.ENABLE,inputValue:"on",uncheckedValue:"off"}]});var h=$("div#addrReverseGrid").grid({store:{proxy:{url:$.su.url("/admin/dhcps?form=reservation")},fields:[{name:"mac"},{name:"ip"},{name:"name"},{name:"enable"}],autoLoad:true},minLines:0,paging:{},editor:{content:"#addrReverse_cnt",fields:[{name:"mac"},{name:"ip"},{name:"name"},{name:"enable"}],validator:function(){var A=$(h.grid("getEditor"));var v=h[0].editor.editingIndex;var y=$("div#addrReverseGrid").grid("getStore").data;var z=$("input#addr_macaddr").textbox("getValue");var w=$("input#addr_ipaddr").textbox("getValue");for(var x=0;x<y.length;x++){if(v!=x&&z==y[x].mac){$("input#addr_macaddr").textbox("setError");A.form("setError",$.su.CHAR.ERROR["00000051"]);return false}}for(var x=0;x<y.length;x++){if(v!=x&&w==y[x].ip){A.form("setError",$.su.CHAR.ERROR["00000052"]);return false}}if(!$.su.func.isSameNet(w,a,o)){A.form("setError",$.su.CHAR.ERROR["00000054"]);return false}if($.su.func.isNetIp(w,o)||$.su.func.isBroadCastIp(w,o)){A.form("setError",$.su.CHAR.ERROR["00000059"]);return false}if($.su.func.ipToInt(w)==$.su.func.ipToInt(a)){A.form("setError",$.su.CHAR.ERROR["00000106"]);return false}return true}},columns:[{xtype:"checkcolumn",width:40},{text:$.su.CHAR.DHCP_SERVER.ID,xtype:"rownumberer",width:50},{text:$.su.CHAR.DHCP_SERVER.MAC_ADDR,width:160,dataIndex:"mac"},{text:$.su.CHAR.DHCP_SERVER.RESERVED_IP,width:120,dataIndex:"ip"},{text:$.su.CHAR.DHCP_SERVER.DESCRIPTION,width:100,dataIndex:"name"},{text:$.su.CHAR.GRID.STATUS,width:100,dataIndex:"enable",renderer:function(E,B,A){var F=A[h.grid("getStore").keyProperty];var y=h.grid("getColumns");var x=y[0];var v="";var C="",G="",w="",D=x.trueValue||"on",z=x.falseValue||"off";if(A.enable==="on"){C=$.su.CHAR.GRID.ENABLED;G="enabled";w="on"}else{C=$.su.CHAR.GRID.DISABLED;G="disabled";w="off"}if(!$.su.func.isSameNet(A.ip,a,o)){C=$.su.CHAR.GRID.DISABLED;G="disabled";w="off"}v+='<a href="javascript:void(0);" data-index="'+B+'" data-name="'+x.dataIndex+'" data-value="'+w+'" data-key="'+F+'" data-on="on" data-off="off" data-ip="'+A.ip+'" class="grid-content-btn btn-status-change btn-status '+G+'">';v+='<span class="icon"></span>';v+='<span class="text">'+C+"</span>";v+="</a>";return v}},{xtype:"settings"}],operation:"prompt|add|delete"});h.delegate("a.btn-status-change","click",function(E){E.preventDefault();E.stopPropagation();var I=$(this).attr("data-key"),H=$(this).attr("data-value"),y=$(this).attr("data-on"),A=$(this).attr("data-off"),v=$(this).attr("data-name"),C=$(this).attr("data-index"),D=$(this).attr("data-ip"),G=h.grid("getStore"),x=G.keyProperty;dOld=G.getData(I);if(!I){return}else{var F=$(this).closest("tr.grid-content-tr");if(F.hasClass("disabled")){return}var z=h.grid("getEditor");if(z&&z.isEditor){if(z.editing){$(z).editor("shake");return}}if(!$.su.func.isSameNet(D,a,o)){return}var w={};w.enable=(H==="on")?"off":"on";var B=$.extend({},dOld,w);delete B[x];h.grid("runProgress");G.update(I,{old:$.su.json.toJSONString(dOld),"new":$.su.json.toJSONString(B)},function(){h.grid("prompt",true)},function(){h.grid("prompt",false)})}});var f=new $.su.Help({container:"div#dhcp_server_help",content:["LAN_IPV4","DHCP_SERVER_SETTINGS","RESERVED_IP_ADDRESS","DHCP_CLIENT_LIST"]})});</script>
</body>
</html>