<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>QoS</title>
</head>
<body>
<div class="func-container">
	<div id="qosset">
		<form id="qos-setting">
			<input type="text"  id="enable" name="enable" value="" />
			<div class="widget-container">
				<input type="text"  id="up_band" name="up_band" value="" />
				<input id="up_unit" name="up_unit" />
			</div>
			<div class="widget-container">
				<input type="text"  id="down_band" name="down_band" value="" />
				<input id="down_unit" name="down_unit" />	 
			</div>
			<div id="adv_btn" class="advanced-block part-seperate" type="button">
				<span class="advanced-icon"></span>
				<span class="advanced-text"></span>
			</div>
			<div id="basic_btn" class="basic-block part-seperate hidden" type="button">
				<span class="basic-icon"></span>
				<span class="basic-text"></span>
			</div>
			<div id="qos_adv" class="">
				<input type="text"  id="high" name="high" value="" />
				<input type="text"  id="middle" name="middle" value="" />
				<input type="text"  id="low" name="low" value="" />
			</div>
			<button type="button" id="submit_btn"> </button>
		</form>   	
	</div>
	<div id="qoslist">
		 <div id="high_panel"  class="status-panel qos-panel access-wired-panel access-priority-panel">
	     	<h4 class="status" id="high_status">
	     	</h4>
	     	<div id="access-panel" class="status-panel-main status-panel-main-pad access-panel-left">
		  		<div class="status-access-block wired-block">
		  			<div id="high_list" class="access-client-list">
		  			</div>
		  		</div>
		  		<button id="add_btn_high" class="add_btn" type="button"></button>
		    </div>
	     </div>
	      <div id="middle_panel"  class="status-panel qos-panel access-wired-panel access-priority-panel">
	     	<h4 class="status"  id="middle_status">
	     	</h4>
	     	<div id="access-panel" class="status-panel-main status-panel-main-pad access-panel-left">
		  		<div class="status-access-block wired-block">
		  			<div id="middle_list" class="access-client-list">
		  			</div>
		  		</div>
		  		<button id="add_btn_middle" class="add_btn"  type="button"></button>
		    </div>
	     </div>
	     <div id="low_panel"  class="status-panel qos-panel access-wired-panel  access-priority-panel">
	     	<h4 class="status"   id="low_status">
	     	</h4>
	     	<div id="access-panel" class="status-panel-main status-panel-main-pad access-panel-left">
		  		<div class="status-access-block wired-block">
		  			<div id="low_list" class="access-client-list">
		  			</div>
		  		</div>
		  		<button id="add_btn_low" class="add_btn" type="button"></button>
		    </div>
	     </div>
		<div id="qossetting-warning-msg" class="hidden warning">
			<h4 class="title">
				<span class="icon"></span>
				<span class="text" id="qossetting-warning-text-toomany-items"></span>
			</h4>
		</div>
	</div>
	<div id="app_list_content">
	<form id="add_item">
	   <div id="app_list_all_container">
	   	  <input type="text" id="method_rd" name="method" />
	   	  <div id="device_cnt">
	   	  	<input id="device_name" name="device_name">
			<button   type="button"  id="device_view"></button>
			<input id="mac_addr" name="mac">
	   	  </div>
	   	  <div id="phy_cnt"  class="">
	   	  	<input type="text"  id="rule_phy" name="phy" value="" />
	   	  </div>
			<div id="app_cnt"  class="">
				<div id="app_list_container">
				   <input type="hidden" name="rule_app" id="rule_app" />
				</div>
			</div>
	   </div>
	   <input type="hidden" name="priority" id="rule_priority" />
	</form>
	</div>
	<div id="upgrade_alert_cnt">
	 	<div id="upload_loading_msg" class="reboot-loading-msg">
    		      <p id="note" class="reboot-progressbar-text"></p>
	    	      <input id="pro_bar" type="text" />
	    </div>
	</div>
	<div id="device_survey">
 		<div id="device_result">	
		</div>
 	</div>	
	<div id="help_qos"></div>
</div>
<script type="text/javascript">var URL_QOS_STATUS_NEW=$.su.url("/admin/qos?form=enable");var URL_QOS_SET_NEW=$.su.url("/admin/qos?form=settings");var URL_QOS_ADD_NEW=$.su.url("/admin/qos?form=add");var URL_QOS_LIST_NEW=$.su.url("/admin/qos?form=list");var URL_QOS_APP_LIST_NEW=$.su.url("/admin/qos?form=applist");var URL_ONLINE_BLACK=$.su.url("/admin/access_control?form=black_devices");var UPGRADE_URL="./data/qos.upgrade.json";var UPGRADE_URL_NEW=$.su.url("/admin/qos?form=upgrade");var SYS_NAT_URL_NEW=$.su.url("/admin/nat?form=setting");var sysNatProxy=new $.su.Proxy({url:SYS_NAT_URL_NEW});var query_proxy=new $.su.Proxy({url:UPGRADE_URL_NEW});var appIdList={};var typeIdList={};var highCount=0;var middleCount=0;var lowCount=0;var scrollCount=3;var usedDeviceItem=[];var usedPhsicalPortItem=[];var usedAppItem=[];var usedCustomItem=[];var wait_time=1000;var max_items=32;var current_items=0;var allowDrag=false;var dragObj={};var doing_list_delete=false;var iptv_enable=false;var IPTV_URL_NEW=$.su.url("/admin/iptv?form=setting");var iptvProxy=new $.su.Proxy({url:IPTV_URL_NEW});var oldAction="";var lanIP=0;var lanMask=0;var lanProxy=new $.su.Proxy({url:$.su.url("/admin/network?form=lan_ipv4")});lanProxy.read({},function(a){lanIP=a.ipaddr;lanMask=a.mask_type.toUpperCase()=="CUSTOM"?a.custom_value:a.mask_type});$(document).ready(function(E){function u(N,P,M){var L=$("#high").slider("getValue");var K=$("#middle").slider("getValue");var O=$("#low").slider("getValue");if(L-5<K){$("#middle").slider("setValue",L-5);K=$("#middle").slider("getValue")}if(K-5<O){$("#low").slider("setValue",K-5);O=$("#low").slider("getValue")}var e=100;if(N=="high"){e=100-L-K;$("#low").slider("setRange",[0,e]);e=100-L-O;$("#middle").slider("setRange",[0,e])}if(N=="middle"){e=100-L-K;$("#low").slider("setRange",[0,e]);e=100-K-O;$("#high").slider("setRange",[0,e])}if(N=="low"){e=100-O-K;$("#high").slider("setRange",[0,e]);e=100-L-O;$("#middle").slider("setRange",[0,e])}}$("#qos_adv").fieldset({fields:[{name:"low"},{name:"middle"},{name:"high"}]});$("#qos_adv").fieldset("hide");$("#adv_btn").on("click",function(){$("#qos_adv").fieldset("show");$(this).hide();$("#basic_btn").css({display:"inline-block"})});$("#basic_btn").on("click",function(){$("#qos_adv").fieldset("hide");$(this).hide();$("#adv_btn").css({display:"inline-block"})});$("span.advanced-text").html($.su.CHAR.INTERNET.ADVANCED);$("span.basic-text").html($.su.CHAR.INTERNET.ADVANCED);$("div.func-container").page({title:$.su.CHAR.QOS.TITLE,help:""});$("input#enable").checkbox({fieldLabel:$.su.CHAR.QOS.TITLE,tips:"",items:[{boxlabel:$.su.CHAR.QOS.STATUS,inputValue:"on",uncheckedValue:"off"}]});$("div#qosset").panel({title:$.su.CHAR.QOS.TITLE,collapsible:false});var r=1;var x=1000;var s=100;$("input#up_band").textbox({fieldLabel:$.su.CHAR.QOS.UPBANDWIDTH,inputCls:"m",maxLength:4,vtype:"number",validator:function(K){var e=$("input#up_unit").combobox("getValue");if(e=="mbps"&&(K<r||K>s)){var L=$.su.CHAR.VTYPETEXT.NUMBER_MIN_MAX.replace("%min",r.toString()).replace("%max",s.toString());return L}else{if(e=="kbps"&&(K<r||K>x)){var L=$.su.CHAR.VTYPETEXT.NUMBER_MIN_MAX.replace("%min",r.toString()).replace("%max",x.toString());return L}}return true},allowBlank:false,cls:"inline-block",textFormat:$.su.format.floatFormat});$("input#up_unit").combobox({fieldLabel:null,inputCls:"s",cls:"inline-block",items:[{value:"mbps",name:$.su.CHAR.QOS.SPEED_M,selected:"selected"},{value:"kbps",name:$.su.CHAR.QOS.SPEED_K}]});$("input#down_band").textbox({fieldLabel:$.su.CHAR.QOS.DOWNBANDWIDTH,inputCls:"m",maxLength:4,cls:"inline-block",vtype:"number",validator:function(K){var e=$("input#down_unit").combobox("getValue");if(e=="mbps"&&(K<r||K>s)){var L=$.su.CHAR.VTYPETEXT.NUMBER_MIN_MAX.replace("%min",r.toString()).replace("%max",s.toString());return L}else{if(e=="kbps"&&(K<r||K>x)){var L=$.su.CHAR.VTYPETEXT.NUMBER_MIN_MAX.replace("%min",r.toString()).replace("%max",x.toString());return L}}return true},allowBlank:false,textFormat:$.su.format.floatFormat});$("input#down_unit").combobox({fieldLabel:null,inputCls:"s",cls:"inline-block",items:[{value:"mbps",name:$.su.CHAR.QOS.SPEED_M,selected:"selected"},{value:"kbps",name:$.su.CHAR.QOS.SPEED_K}]});$("input#high").slider({fieldLabel:$.su.CHAR.QOS.HIGH_PRIORITY,minValue:15}).on("ev_change",function(M,K,L){u("high",L,K)});$("input#middle").slider({fieldLabel:$.su.CHAR.QOS.MIDDLE_PRIORITY,minValue:10}).on("ev_change",function(M,K,L){u("middle",L,K)});$("input#low").slider({fieldLabel:$.su.CHAR.QOS.LOW_PRIORITY,minValue:5}).on("ev_change",function(M,K,L){u("low",L,K)});$("#upgrade_alert_cnt").msg({cls:"warning reboot-confirm-size",closeBtn:false,type:"window"});$("#note").html($.su.CHAR.QOS.SERVICE_RESTART);var f=$("#pro_bar").progressbar({fieldLabel:null,cls:"inline",width:300,height:6,value:0});$("#submit_btn").button({text:$.su.CHAR.OPERATION.SAVE,cls:"submit",handler:function(){if(!$("form#qos-setting").form("validate")){return false}$("form#qos-setting").form("submit",{},function(){},null,null,false);f.progressbar("animate",0,1,wait_time,function(){$("#upgrade_alert_cnt").msg("close");$("form#qos-setting").form("prompt",true)});$("#upgrade_alert_cnt").msg("show")}});var H=new $.su.Proxy({url:URL_QOS_SET_NEW});$("form#qos-setting").form({proxy:H,fields:[{name:"enable",mapping:"enable"},{name:"up_band",mapping:"up_band"},{name:"down_band",mapping:"down_band"},{name:"up_unit",mapping:"up_unit"},{name:"down_unit",mapping:"down_unit"},{name:"high",mapping:"high"},{name:"middle",mapping:"middle"},{name:"low",mapping:"low"}],submitBtn:"#submit_btn"}).on("ev_loadData",function(L,K){wait_time=K.time*1000||wait_time;$("#high_status").html($.su.CHAR.QOS.HIGH_PRIORITY_LBL+K.high+"%");$("#middle_status").html($.su.CHAR.QOS.MIDDLE_PRIORITY_LBL+K.middle+"%");$("#low_status").html($.su.CHAR.QOS.LOW_PRIORITY_LBL+K.low+"%")}).one("ev_loadData",function(M,L){enable_app=L.enable_app;enable_phy=L.enable_phy;var K=[];K.push({boxlabel:$.su.CHAR.QOS.BY_DEVICE,inputValue:"device",checked:true});if(enable_app=="on"){K.push({boxlabel:$.su.CHAR.QOS.BY_APP,inputValue:"app"})}if(enable_phy=="on"){K.push({boxlabel:$.su.CHAR.QOS.BY_PHY,inputValue:"phy"})}$("#method_rd").radio({fieldLabel:$.su.CHAR.QOS.TYPE,labelCls:"s",columns:3,allowBlank:false,items:K}).on("ev_change",function(P,N,O){if(O=="device"){$("#device_cnt").fieldset("show");$("#phy_cnt").fieldset("hide");$("#app_cnt").fieldset("hide")}if(O=="app"){$("#device_cnt").fieldset("hide");$("#phy_cnt").fieldset("hide");$("#app_cnt").fieldset("show");$("#custom_cnt").fieldset("hide")}if(O=="phy"){$("#device_cnt").fieldset("hide");$("#phy_cnt").fieldset("show");$("#app_cnt").fieldset("hide")}$("#app_list_content").msg("setPosition","center","center")})});var h=new $.su.Proxy({url:URL_QOS_ADD_NEW,autoLoad:false});$("div#qoslist").panel({title:$.su.CHAR.QOS.RULE_LIST,collapsible:false});$("#rule_name").textbox({fieldLabel:$.su.CHAR.QOS.NAME,labelCls:"s",vtype:"string_visible_allow_blank",minLength:0,maxLength:32,allowBlank:true});function v(L,K){var M;for(var e=0;e<L.length;e++){M=L.charAt(e);if(K.indexOf(M)==-1){return false}}return true}function q(e){if(!v(e,"0123456789")){return false}if(parseInt(e,10)<=0||parseInt(e,10)>65535){return false}return true}function G(e){if(!q(e)){return false}return true}function i(Q){if(!v(Q,ch=",-0123456789")){return false}var P;var O;var M;var N;M=new RegExp(",");N=new RegExp("-");P=Q.split(M);if(P.length>5||P.length<1){return false}for(var L=0;L<P.length;L++){if(P[L]==""){return false}for(var e=L+1;e<P.length;e++){if(P[L]==P[e]){return false}}O=P[L].split(N);if(O.length!=1&&O.length!=2){return false}for(var K=0;K<O.length;++K){if(O[K]==""){return false}if(!G(O[K])){return false}}}return true}$("#rule_mac").textbox({fieldLabel:$.su.CHAR.QOS.MAC_ADDR,labelCls:"s",vtype:"mac",maxLength:17,allowBlank:false});$("#rule_ip_start").textbox({fieldLabel:$.su.CHAR.QOS.IP_ADDR,vtype:"ip",maxLength:15,textFormat:$.su.format.ip,labelCls:"s",cls:"inline-block",allowBlank:false});$("#rule_ip_end").textbox({fieldLabel:null,cls:"inline-block",vtype:"ip",maxLength:15,textFormat:$.su.format.ip,allowBlank:false});function v(L,K){var M;for(var e=0;e<L.length;e++){M=L.charAt(e);if(K.indexOf(M)==-1){return false}}return true}function q(e){if(!v(e,"0123456789")){return false}if(parseInt(e,10)<=0||parseInt(e,10)>65535){return false}return true}function G(e){if(!q(e)){return false}return true}function i(Q){if(!v(Q,ch=",-0123456789")){return false}var P;var O;var M;var N;M=new RegExp(",");N=new RegExp("-");P=Q.split(M);if(P.length>5||P.length<1){return false}for(var L=0;L<P.length;L++){if(P[L]==""){return false}for(var e=L+1;e<P.length;e++){if(P[L]==P[e]){return false}}O=P[L].split(N);if(O.length!=1&&O.length!=2){return false}for(var K=0;K<O.length;++K){if(O[K]==""){return false}if(!G(O[K])){return false}}}return true}function j(O,M){var N=new RegExp("-");O=O.split(N);M=M.split(N);var K=-1;var L=parseInt(O[0],10);var e=O.length==1?L:parseInt(O[1],10);var Q=parseInt(M[0],10);var P=M.length==1?Q:parseInt(M[1],10);if(e<L){K=e;e=L;L=K}if(P<Q){K=P;P=Q;Q=K}if((L<=Q&&Q<=e)||(L<=P&&P<=e)){return true}if((Q<=L&&L<=P)||(Q<=e&&e<=P)){return true}return false}function o(e,P){var O=new RegExp(",");var K=e+","+P;var N=K.split(O);if(!i(e)||!i(P)){return false}for(var M=0;M<N.length;M++){for(var L=M+1;L<N.length;L++){if(j(N[M],N[L])){return true}}}return false}function m(K,e){if(K.name.toUpperCase()==e.name.toUpperCase()){return true}if(o(K.tcp_port,e.tcp_port)){return true}if(o(K.udp_port,e.udp_port)){return true}return false}var g=new $.su.Proxy({url:URL_QOS_LIST_NEW});function w(L,M){var e=L.length;for(var K=0;K<e;K++){if(M.toUpperCase()==L[K].mac.toUpperCase()){return true}}return false}function z(S,T,M,R,Q,L){var N=[];var K=0;for(var P=0;P<S.length;P++){N[K]={};N[K].name=appIdList[S[P].id].name;N[K].tcp_port=appIdList[S[P].id].tcp_port;N[K].udp_port=appIdList[S[P].id].udp_port;K++}for(var P=0;P<T.length;P++){N[K]={};N[K].name=T[P].name;N[K].tcp_port="";N[K].udp_port="";if(T[P].proto.toUpperCase()=="TCP"||T[P].proto.toUpperCase()=="ALL"){N[K].tcp_port=T[P].port}if(T[P].proto.toUpperCase()=="UDP"||T[P].proto.toUpperCase()=="ALL"){N[K].udp_port=T[P].port}K++}if(M!=""){var U=new RegExp(",");var e=M.split(U);for(var P=0;P<e.length;P++){N[K]={};N[K].name=appIdList[e[P]].name;N[K].tcp_port=appIdList[e[P]].tcp_port;N[K].udp_port=appIdList[e[P]].udp_port;K++}}if((R!="")&&(Q!="")&&(L!="")){N[K]={};N[K].name=R;N[K].tcp_port="";N[K].udp_port="";if(Q.toUpperCase()=="TCP"||Q.toUpperCase()=="ALL"){N[K].tcp_port=L}if(Q.toUpperCase()=="UDP"||Q.toUpperCase()=="ALL"){N[K].udp_port=L}K++}for(var P=0;P<N.length;P++){for(var O=P+1;O<N.length;O++){if(m(N[P],N[O])){return true}}}return false}function d(M,K){var e=M.length;for(var L=0;L<e;L++){if(K.toUpperCase()==M[L].port.toUpperCase()){return true}}return false}$("#high_status").html($.su.CHAR.QOS.HIGH_PRIORITY_LBL);$("#middle_status").html($.su.CHAR.QOS.MIDDLE_PRIORITY_LBL);$("#low_status").html($.su.CHAR.QOS.LOW_PRIORITY_LBL);function D(N){var K=N.split(",");var e=K.length;for(var L in typeIdList){var M=[];var O="type_"+L+"_list";$(K).each(function(P,Q){M.push(L+"_"+Q);return L+"_"+Q});$("#"+O).checkbox("setValue",M)}}function y(){for(var e in typeIdList){var K="type_"+e+"_list";$("#"+K).checkbox("setValue",[])}}function c(){$("#method_rd").radio("setValue","device");$("#device_name").textbox("setValue","");$("#mac_addr").textbox("setValue","");$("#rule_phy").radio("setValue","wireless");y();$("h5.type_collapse span.icon").removeClass("collapsed");$("#custom_cnt").fieldset("hide");$("#custom_name").textbox("setValue","");$("#rule_proto").combobox("setValue","all");$("#rule_port_list").textbox("setValue","")}$("#app_list_content").msg({autoshow:false,title:$.su.CHAR.QOS.RULE,cls:"qos-width",okHandler:function(){$("div.msg-btn-wrap span.form-error-tips").html("");if(current_items>=max_items){return false}var N="";var X=[];for(var V in typeIdList){var L="type_"+V+"_list";var U=[];container=$("#"+L).checkbox("getContainer"),container.find("input[type=checkbox]").each(function(Z,aa){if(aa.checked){var Y=aa.value.split("_");X.push(Y[1])}})}$("#rule_app").val(X);var e=$("#method_rd").radio("getValue");if(e=="device"){var K=$("#device_name").textbox("getValue");var T=$("#mac_addr").textbox("getValue");if(w(usedDeviceItem,T)){$("#mac_addr").textbox("setError");$("div.msg-btn-wrap span.form-error-tips").html($.su.CHAR.ERROR["00000065"]).fadeIn(150);return false}}if(e=="app"){var O=$("#rule_app").val();var S=$("#custom_name").textbox("getValue");var R=$("#rule_proto").combobox("getValue");var M=$("#rule_port_list").textbox("getValue");var Q=(O=="")?0:O.split(",").length;var P=(S=="")?Q:Q+1;P=P+current_items;if(P>max_items){$("div.msg-btn-wrap span.form-error-tips").html($.su.CHAR.ERROR["00000125"]).fadeIn(150);return false}if(z(usedAppItem,usedCustomItem,O,S,R[0],M)){$("div.msg-btn-wrap span.form-error-tips").html($.su.CHAR.ERROR["00000065"]).fadeIn(150);return false}}if(e=="phy"){var W=$("#rule_phy").textbox("getValue");if(W==""){$("#rule_phy").textbox("setError");$("div.msg-btn-wrap span.form-error-tips").html($.su.CHAR.ERROR["00000129"]).fadeIn(150);return false}if(d(usedPhsicalPortItem,W)){$("#rule_phy").textbox("setError");$("div.msg-btn-wrap span.form-error-tips").html($.su.CHAR.ERROR["00000065"]).fadeIn(150);return false}}if(!$("form#add_item").form("validate")){return false}$("form#add_item").form("submit",{operation:"add"},function(Y){$("div.msg-btn-wrap span.form-error-tips").html("");k(Y);c();$("div.msg-btn-wrap span.form-error-tips").html()})},cancelHandler:function(){$("#device_name").textbox("reset").textbox("setNormal");$("#mac_addr").textbox("reset").textbox("setNormal");c();var e=$("#rule_app").val();$("div.msg-btn-wrap span.form-error-tips").html("");D(e)},type:"prompt"});$("div.msg-btn-wrap .btn-msg-cancel").before('<span class="form-error-tips custom-xl" style="display: none;"></span>');$("form#add_item").form({proxy:h,showPrompt:false,fields:[{name:"method",mapping:"method"},{name:"device_name",mapping:"device_name"},{name:"mac",mapping:"mac"},{name:"phy",mapping:"phy"},{name:"rule_app",mapping:"rule_app"},{name:"custom_name",mapping:"custom_name"},{name:"proto",mapping:"proto"},{name:"port",mapping:"port"}],autoLoad:false,submitBtn:null});$("#add_btn_high").button({text:$.su.CHAR.OPERATION.ADD,cls:"right-pos",handler:function(){if(current_items<max_items){$("#app_list_content").msg("show");$("#rule_priority").val("high")}else{l()}}});$("#add_btn_middle").button({text:$.su.CHAR.OPERATION.ADD,cls:"right-pos",handler:function(){if(current_items<max_items){$("#app_list_content").msg("show");$("#rule_priority").val("middle")}else{l()}}});$("#add_btn_low").button({text:$.su.CHAR.OPERATION.ADD,cls:"right-pos",handler:function(){if(current_items<max_items){$("#app_list_content").msg("show");$("#rule_priority").val("low")}else{l()}}});function k(P){var R;if(!P){R=0}else{R=P.length}current_items=R;var M="";var O="";var K="";highCount=0;middleCount=0;lowCount=0;usedDeviceItem=[];usedPhsicalPortItem=[];usedAppItem=[];usedCustomItem=[];var T="";var N="";for(var Q=0;Q<R;Q++){var U=P[Q];U.name?T=$.su.func.escapeHtml(U.name):1;U.name?N=$.su.func.escapeHtml($.su.func.breakWordWithLen(U.name,15)):1;if(U.priority=="high"){highCount++;if(U.type=="device"){M+='<p class="access-client-list-p qos-list-p"><span title="'+T+'" class="qos-display-name" >'+N+'</span><span class="access-client-list-icon list-icon-pos"><span class="icon-del" index='+Q+"></span></span></p>";M+='<div class="access-client-detail qos-item-detail hidden"><p class="cfg_status"><label class="label_status_sss">'+$.su.CHAR.QOS.MAC_ADDR_P+'</label><span class="cfg_value">'+U.mac+'</span></p><p class="cfg_status"><label class="label_status_sss">'+$.su.CHAR.QOS.IP_P+'</label><span class="cfg_value">'+U.ip+"</span></p></div>";usedDeviceItem.push({name:N,mac:U.mac})}if(U.type=="port"){M+='<p class="access-client-list-pp">'+F[U.phy]+'<span class="icon-del" index='+Q+"></span></p>";usedPhsicalPortItem.push({port:U.phy})}if(U.type=="app"){if(U.custom){M+='<p class="access-client-list-p qos-list-p"><span title="'+T+'" class="qos-display-name" >'+N+'</span><span class="access-client-list-icon  list-icon-pos"><span class="icon-del" index='+Q+"></span></span></p>";M+='<div class="access-client-detail  qos-item-detail hidden"><p class="cfg_status"><label class="label_status_ss">'+$.su.CHAR.QOS.PROTO_P+'</label><span class="cfg_value">'+U.proto+'</span></p><p class="cfg_status"><label class="label_status_ss">'+$.su.CHAR.QOS.PORT_P+'</label><span class="cfg_value">'+U.port+"</span></p></div>";usedCustomItem.push({name:N,proto:U.proto,port:U.port})}else{var L=U.app;var e=appIdList[L].name;var S=$.su.CHAR.APPLIST[e]?$.su.CHAR.APPLIST[e]:e;M+='<p class="access-client-list-pp"><span title="'+T+'" class="qos-display-name" >'+S+'</span><span class="icon-del" index='+Q+"></p>";usedAppItem.push({id:U.app})}}}if(U.priority=="middle"){middleCount++;if(U.type=="device"){O+='<p class="access-client-list-p qos-list-p"><span title="'+T+'" class="qos-display-name" >'+N+'</span><span class="access-client-list-icon list-icon-pos"><span class="icon-del" index='+Q+"></span></span></p>";O+='<div class="access-client-detail qos-item-detail hidden"><p class="cfg_status"><label class="label_status_sss">'+$.su.CHAR.QOS.MAC_ADDR_P+'</label><span class="cfg_value">'+U.mac+'</span></p><p class="cfg_status"><label class="label_status_sss">'+$.su.CHAR.QOS.IP_P+'</label><span class="cfg_value">'+U.ip+"</span></p></div>";usedDeviceItem.push({name:N,mac:U.mac})}if(U.type=="port"){O+='<p class="access-client-list-pp">'+F[U.phy]+'<span class="icon-del" index='+Q+"></span></p>";usedPhsicalPortItem.push({port:U.phy})}if(U.type=="app"){if(U.custom){O+='<p class="access-client-list-p qos-list-p"><span title="'+T+'" class="qos-display-name" >'+N+'</span><span class="access-client-list-icon  list-icon-pos"><span class="icon-del" index='+Q+"></span></span></p>";O+='<div class="access-client-detail  qos-item-detail hidden"><p class="cfg_status"><label class="label_status_ss">'+$.su.CHAR.QOS.PROTO_P+'</label><span class="cfg_value">'+U.proto+'</span></p><p class="cfg_status"><label class="label_status_ss">'+$.su.CHAR.QOS.PORT_P+'</label><span class="cfg_value">'+U.port+"</span></p></div>";usedCustomItem.push({name:N,proto:U.proto,port:U.port})}else{var L=U.app;var e=appIdList[L].name;var S=$.su.CHAR.APPLIST[e]?$.su.CHAR.APPLIST[e]:e;O+='<p class="access-client-list-pp"><span title="'+T+'" class="qos-display-name" >'+S+'</span><span class="icon-del" index='+Q+"></p>";usedAppItem.push({id:U.app})}}}if(U.priority=="low"){lowCount++;if(U.type=="device"){K+='<p class="access-client-list-p qos-list-p"><span title="'+T+'" class="qos-display-name" >'+N+'</span><span class="access-client-list-icon list-icon-pos"><span class="icon-del" index='+Q+"></span></span></p>";K+='<div class="access-client-detail qos-item-detail hidden"><p class="cfg_status"><label class="label_status_sss">'+$.su.CHAR.QOS.MAC_ADDR_P+'</label><span class="cfg_value">'+U.mac+'</span></p><p class="cfg_status"><label class="label_status_sss">'+$.su.CHAR.QOS.IP_P+'</label><span class="cfg_value">'+U.ip+"</span></p></div>";usedDeviceItem.push({name:N,mac:U.mac})}if(U.type=="port"){K+='<p class="access-client-list-pp">'+F[U.phy]+'<span class="icon-del" index='+Q+"></span></p>";usedPhsicalPortItem.push({port:U.phy})}if(U.type=="app"){if(U.custom){K+='<p class="access-client-list-p qos-list-p"><span title="'+T+'" class="qos-display-name" >'+N+'</span><span class="access-client-list-icon  list-icon-pos"><span class="icon-del" index='+Q+"></span></span></p>";K+='<div class="access-client-detail  qos-item-detail hidden"><p class="cfg_status"><label class="label_status_ss">'+$.su.CHAR.QOS.PROTO_P+'</label><span class="cfg_value">'+U.proto+'</span></p><p class="cfg_status"><label class="label_status_ss">'+$.su.CHAR.QOS.PORT_P+'</label><span class="cfg_value">'+U.port+"</span></p></div>";usedCustomItem.push({name:N,proto:U.proto,port:U.port})}else{var L=U.app;var e=appIdList[L].name;var S=$.su.CHAR.APPLIST[e]?$.su.CHAR.APPLIST[e]:e;K+='<p class="access-client-list-pp"><span title="'+T+'" class="qos-display-name" >'+S+'</span><span class="icon-del" index='+Q+"></p>";usedAppItem.push({id:U.app})}}}}$("div#high_list").html(M);$("div#middle_list").html(O);$("div#low_list").html(K);$("p.access-client-list-pp").delegate("span.icon-del","click",function(X){if(doing_list_delete){return false}doing_list_delete=true;var V=$(this).attr("index");var W=this;g.write({operation:"del",index:V},function(Y){doing_list_delete=false;k(Y)})})}$("#device_cnt").fieldset({fields:[{name:"device_name"},{name:"mac"}]});$("#phy_cnt").fieldset({fields:[{name:"phy"}]});$("#app_cnt").fieldset({fields:[{name:"rule_app"},{name:"custom_name"},{name:"proto"},{name:"port"}]});$("#phy_cnt").fieldset("hide");$("#app_cnt").fieldset("hide");$("#rule_phy").radio({fieldLabel:$.su.CHAR.QOS.PORT,labelCls:"s",columns:3,allowBlank:false,items:[{boxlabel:$.su.CHAR.QOS.WIFI_HOME,inputValue:"wireless",checked:true},{boxlabel:$.su.CHAR.QOS.WIFI_GUEST,inputValue:"guest"},{boxlabel:$.su.CHAR.QOS.PORT1,inputValue:"port1"},{boxlabel:$.su.CHAR.QOS.PORT2,inputValue:"port2"},{boxlabel:$.su.CHAR.QOS.PORT3,inputValue:"port3"},{boxlabel:$.su.CHAR.QOS.PORT4,inputValue:"port4"}]});$("input#device_name").textbox({fieldLabel:$.su.CHAR.PARENTAL_CTR.DEVICE,vtype:"string_visible_allow_blank",minLength:0,maxLength:32,labelCls:"s",tipsCls:"after-button xl",allowBlank:false,cls:"inline-block "});var I=new $.su.Proxy({url:URL_ONLINE_BLACK});var p=new $.su.Store({proxy:I,fields:[{name:"name"},{name:"ipaddr"},{name:"mac"}],autoLoad:false});$("#device_view").button({text:$.su.CHAR.PARENTAL_CTR.BTN_VIEW,cls:"inline-block ml5",handler:function(){$("div#device_survey").msg("show");p.load()}});var J=$("div#device_survey").msg({autoshow:false,title:$.su.CHAR.PARENTAL_CTR.ACCESS_DEVICES_LIST,type:"window"});var B=$("div#device_result").grid({store:p,maxLines:5,columns:[{text:$.su.CHAR.ACCESS_CTR.ID,xtype:"rownumberer",width:40},{text:$.su.CHAR.ACCESS_CTR.NAME,width:150,dataIndex:"name"},{text:$.su.CHAR.ACCESS_CTR.IP_ADDRESS,width:150,dataIndex:"ipaddr"},{text:$.su.CHAR.ACCESS_CTR.MAC_ADDRESS,width:170,dataIndex:"mac"},{text:$.su.CHAR.GRID.OPERATION,renderer:function(K,e){return'<a href="javascript:void(0);" data-index="'+e+'" class="choose-existing-service choose" >'+$.su.CHAR.OPERATION.CHOOSE+"</a>"}}]});$(B).delegate("a.choose-existing-service","click",function(N){N.preventDefault();var K=B.grid("getStore"),L=$(this).attr("data-index"),M=K.data[L]||undefined;if(M){$("input#device_name").textbox("setValue",M.name);$("input#mac_addr").textbox("setValue",M.mac)}J.msg("close")});$("input#mac_addr").textbox({fieldLabel:$.su.CHAR.PARENTAL_CTR.MAC_ADDRESS,vtype:"mac",maxLength:17,labelCls:"s",allowBlank:false,vtype:"mac"});$("span#qossetting-warning-text-toomany-items").html($.su.CHAR.ERROR["00000125"]);var A=$("div#qossetting-warning-msg").msg({type:"alert",global:true,cls:"m",closeBtn:false});function l(){var e=$("div#qossetting-warning-msg");if(e.is(":hidden")){e.msg("show")}}function C(O){var Q=O.length;var L=0;var e="";var T={};var S=[];var U="";for(var P=0;P<Q;P++){e="";var N=O[P];typeIdList[N.id]=N.name;if(N.children){L=N.children.length}U=$.su.CHAR.APPLIST[N.name];e+='<h5 class="type_title">'+U+"</h5>";var K="type_"+N.id+"_list";e+="<input id="+K+" />";$("#app_list_container").append(e);S=[];for(var M=0;M<L;M++){T={};T.boxlabel=$.su.CHAR.APPLIST[N.children[M].name]?$.su.CHAR.APPLIST[N.children[M].name]:N.children[M].name;T.uncheckedValue="off";T.inputValue=N.id+"_"+N.children[M].id;T.name="app_list";T.itemCls="app_name_info";T.id=N.id+"_"+N.children[M].id;appIdList[N.children[M].id]={};appIdList[N.children[M].id].name=N.children[M].name;appIdList[N.children[M].id].tcp_port=N.children[M].tcp_port?N.children[M].tcp_port:"";appIdList[N.children[M].id].udp_port=N.children[M].udp_port?N.children[M].udp_port:"";S.push(T)}$("#"+K).checkbox({fieldLabel:null,defaultValue:"",cls:"app_info_cnt",columns:3,items:S})}var R=$.su.CHAR.QOS.CUSTOM_APP;e='<h5 class="type_title type_collapse"><span class="text">'+R+'</span><span class="icon"></span></h5>';e+='<div id="custom_cnt"><input id="custom_name" name="custom_name" />';e+='<input id="rule_proto" name="proto" >';e+='<input  type="text"   id="rule_port_list" name="port"></div>';$("#app_list_container").append(e);$("#rule_custom_lbl").html($.su.CHAR.QOS.CUSTOM);$("#custom_name").textbox({fieldLabel:$.su.CHAR.QOS.NAME,allowBlank:false,maxLength:32,vtype:"name"});$("#rule_proto").combobox({fieldLabel:$.su.CHAR.QOS.PROTO,defaultValue:["all"],items:[{name:$.su.CHAR.QOS.ALL,value:"all"},{name:$.su.CHAR.QOS.TCP,value:"tcp"},{name:$.su.CHAR.QOS.UDP,value:"udp"}]});$("#rule_proto").combobox("setValue","all");$("#rule_port_list").textbox({fieldLabel:$.su.CHAR.QOS.PORT,tips:$.su.CHAR.QOS.PORT_TIPS,tipsCls:"xs",cls:"inline-block",validator:function(V){return i(V)},allowBlank:false});$("#custom_cnt").fieldset({fields:[{name:"custom_name"},{name:"proto"},{name:"port"}]});$("#custom_cnt").fieldset("hide")}$.post(URL_QOS_APP_LIST_NEW,{operation:"load"},function(K,L,e){if(K.data){C(K.data)}g.read({},function(N,M){k(N);max_items=M.max_rules||max_items})},"json");var F={wireless:$.su.CHAR.QOS.WIFI_HOME,guest:$.su.CHAR.QOS.WIFI_GUEST,port1:$.su.CHAR.QOS.PORT1,port2:$.su.CHAR.QOS.PORT2,port3:$.su.CHAR.QOS.PORT3,port4:$.su.CHAR.QOS.PORT4};var b={all:$.su.CHAR.QOS.TCP_UDP,tcp:$.su.CHAR.QOS.TCP,udp:$.su.CHAR.QOS.UDP};$("#app_list_container").delegate(".type_collapse","click",function(){if($("h5.type_collapse span.icon").hasClass("collapsed")){$("h5.type_collapse span.icon").removeClass("collapsed");$("#custom_cnt").fieldset("hide")}else{$("h5.type_collapse span.icon").addClass("collapsed");$("#custom_cnt").fieldset("show")}});$(".access-client-list").delegate("p.access-client-list-p","click",function(M){M=M?M:window.event;var L=function(e){if(e.relatedTarget){return e.relatedTarget}else{if(e.toElement){return e.toElement}else{if(e.fromElement){return e.fromElement}else{if(e.target){return e.target}else{return null}}}}};t=L(M);if((t.tagName.toUpperCase()=="SPAN")&&($(t).hasClass("icon-del"))){if(doing_list_delete){return false}doing_list_delete=true;var K=$(t).attr("index");g.write({operation:"del",index:K},function(e){doing_list_delete=false;k(e)})}else{if($(this).hasClass("selected-list-p")){accessLeftFlag=true;$(this).removeClass("selected-list-p");$(this).next("div.access-client-detail").hide()}else{accessLeftFlag=false;$("div#access_wired_list").find("p.access-client-list-p qos-list-p").removeClass("selected-list-p");$("div#access_wired_list").find("p.access-client-list-p qos-list-p").next("div.access-client-detail").hide();$(this).addClass("selected-list-p");$(this).next("div.access-client-detail").fadeIn(150)}}}).delegate("p.access-client-list-p,p.access-client-list-pp","mousedown",function(K){if(!dragObj){dragObj=this}else{g.read({},function(L,e){k(L)})}allowDrag="waiting";setTimeout(function(){if(allowDrag=="waiting"){allowDrag=true}},200)});var a;$("#qoslist").on("mousemove",function(K){if(allowDrag===true){a=$(dragObj).closest(".status-panel").attr("id")=="high_panel"?0:($(dragObj).closest(".status-panel").attr("id")=="middle_panel"?216:432);$(dragObj).css("z-index","99");$(dragObj).css("position","absolute");$(dragObj).css("left",K.clientX-this.offsetLeft+$(document).scrollLeft()-$(".top-content").offset().left-a+"px");$(dragObj).css("top",K.clientY-this.offsetTop+$(".top-main").scrollTop()-127+"px");if($(dragObj).next().hasClass("access-client-detail")){$(dragObj).next().css("z-index","99");$(dragObj).next().css("position","absolute");$(dragObj).next().css("left",K.clientX-this.offsetLeft+$(document).scrollLeft()-$(".top-content").offset().left-a+"px");$(dragObj).next().css("top",K.clientY-this.offsetTop+$(".top-main").scrollTop()-94+"px")}}});$("#qoslist").on("mouseup",function(L){allowDrag=false;var K=L.clientX-this.offsetLeft+$(document).scrollLeft()-$(".top-content").offset().left-a;if(a==0){if(K>=216-30&&K<=246+30){g.write({operation:"update",index:$(dragObj).find(".icon-del").attr("index"),old:'{"priority":"high"}',"new":'{"priority":"middle"}'},function(e){k(e)})}else{if(K>=432-30&&K<=462+30){g.write({operation:"update",index:$(dragObj).find(".icon-del").attr("index"),old:'{"priority":"high"}',"new":'{"priority":"low"}'},function(e){k(e)})}else{$(dragObj).css("z-index","");$(dragObj).css("position","");$(dragObj).css("left","0");$(dragObj).css("top","0");$(dragObj).next().css("z-index","");$(dragObj).next().css("position","");$(dragObj).next().css("left","0");$(dragObj).next().css("top","0")}}}else{if(a==216){if(K>=-216&&K<=-187+30){g.write({operation:"update",index:$(dragObj).find(".icon-del").attr("index"),old:'{"priority":"middle"}',"new":'{"priority":"high"}'},function(e){k(e)})}else{if(K>=216-30){g.write({operation:"update",index:$(dragObj).find(".icon-del").attr("index"),old:'{"priority":"middle"}',"new":'{"priority":"low"}'},function(e){k(e)})}else{$(dragObj).css("z-index","");$(dragObj).css("position","");$(dragObj).css("left","0");$(dragObj).css("top","0");$(dragObj).next().css("z-index","");$(dragObj).next().css("position","");$(dragObj).next().css("left","0");$(dragObj).next().css("top","0")}}}else{if(a==432){if(K>=-216-30&&K<=-187+30){g.write({operation:"update",index:$(dragObj).find(".icon-del").attr("index"),old:'{"priority":"low"}',"new":'{"priority":"middle"}'},function(e){k(e)})}else{if(K<=-403+30){g.write({operation:"update",index:$(dragObj).find(".icon-del").attr("index"),old:'{"priority":"low"}',"new":'{"priority":"hight"}'},function(e){k(e)})}else{$(dragObj).css("z-index","");$(dragObj).css("position","");$(dragObj).css("left","0");$(dragObj).css("top","0");$(dragObj).next().css("z-index","");$(dragObj).next().css("position","");$(dragObj).next().css("left","0");$(dragObj).next().css("top","0")}}}}}dragObj=null});iptvProxy.read({},function(K){if(K.qos_iptv_compatible=="no"){var e=K.enable;if(e=="on"){$("input#enable").checkbox("disable");$("input#enable").checkbox("setTips",$.su.CHAR.ERROR["00000105"])}else{}}});sysNatProxy.read({},function(K){if(K.boost_traffic_compatible=="no"){var e=K.hw_enable;if(e=="on"){$("input#enable").checkbox("disable");$("input#enable").checkbox("setTips",$.su.CHAR.ERROR["00000111"])}else{}}});var n=new $.su.Help({container:"div#help_qos",content:["QOS","QOS_RULE"]})});</script>
</body>
</html>
