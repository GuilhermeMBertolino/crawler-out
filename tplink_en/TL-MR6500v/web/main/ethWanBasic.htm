<h3 id="t_title">Internet Connection Setup</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div id="profile-ctn">
            <b id="t_isplist">ISP List:</b>
            <select name="" id="profile" class="xl tpSelect"></select>
        </div>
        <div id="vlan-settings-ctn">
            <div>
                <b class="T T_c_vlantag">VLAN Tag:</b>
                <input type="checkbox" id="vlantag-en">
                <label for="" class="T T_en"></label>
            </div>
            <div id="vlanTag-ctn">
                <b class="T T_c_vlantag">VLAN Tag:</b>
                <input type="text" id="vlan-tag" class="tpInput">
            </div>
        </div>
        <div id="conntype-ctn">
            <b class="T T_connectiontype">Connection Type:</b>
            <select name="" id="conntype">
                <option value="PPPoE">PPPoE</option>
                <option value="Static IP">Static IP</option>
                <option value="Dynamic IP">Dynamic IP</option>
				<option value="L2TP">L2TP</option>
				<option value="PPTP">PPTP</option>
            </select>
        </div>
        <div id="pppoe-settings-ctn">
            <div>
                <b class="T T_username">Username:</b>
                <input type="text" id="pppoe-username">
            </div>
            <div>
                <b class="T T_passwd">Password:</b>
                <input type="password" id="pppoe-password">
            </div>
        </div>
        <div id="staticIp-settings-ctn">
            <div>
                <b class="T T_ipaddr"></b>
                <input type="text" id="staip-ipaddr" class="ip-address">
            </div>
            <div>
                <b class="T T_netmask"></b>
                <input type="text" id="staip-netmask" class="ip-address">
            </div>
            <div>
                <b class="T T_defgw"></b>
                <input type="text" id="staip-defgw" class="ip-address">
            </div>
            <div>
                <b class="T T_dns"></b>
                <input type="text" id="staip-dns" class="ip-address">
            </div>
            <div>
                <b class="T T_secdns"></b>
                <input type="text" id="staip-secdns" class="ip-address">
				<span class="T_optional">(Optional)</span>
            </div>
        </div>
        <div id="dhcp-settings-ctn" class="nd">
            <div>
                <b class="T T_merEnable">MerEnable:</b>
                <input type="checkbox" id="mer-en">
                <label for="" class="T T_en"></label>
            </div>
            <div id="dhcp-usr-psd-stn">
                <div>
                    <b class="T T_username"></b>
                    <input type="text" id="dhcp-username">
                </div>
                <div>
                    <b class="T T_password"></b>
                    <input type="text" id="dhcp-password">
                </div>
            </div>
        </div>
		<div id="pptp-settings-ctn">
			<div><b class="T_username">Username:</b>
				<input type="text" size="15" id="pptp_username" maxlength="255" class="xl">
			</div>
			<div><b class="T_passwd">Password:</b>
				<input type="password" size="15" id="pptp_pwd" maxlength="255" class="xl">
			</div>
			<div><b class="T_addrType">Addressing Type:</b>
				<input type="radio" name="ipType1" id="pptp_ipType_dyn" onclick="pptpshowDyn()" checked="checked">
				<label class="T_dynip">Dynamic IP</label>
				<input type="radio" name="ipType1" id="pptp_ipType_stc" onclick="pptpshowStc()">
				<label class="T_staip">Static IP</label>
			</div>
			<div><b class="T_srvIpName">Server IP Address/Name:</b>
				<input type="text" size="15" id="pptp_srvAddrName" maxlength="80">
			</div>
			<div id="pptp_stc_ip_elem">
				<div><b class="T_ipaddr">IP Address:</b>
					<input type="text" id="pptp_isp_ip_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
				</div>
				<div><b class="T_netmask">Subnet Mask:</b>
					<input type="text" id="pptp_isp_net_mask_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
				</div>
				<div><b class="T_gateway">Gateway:</b>
					<input type="text" id="pptp_isp_gw_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
				</div>
				<div><b class="T_dns">DNS Server:</b>
					<input type="text" id="pptp_isp_dns_1_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
				</div>
				<div><b class="T_secdns">Secondary DNS:</b>
					<input type="text" id="pptp_isp_dns_2_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
					<span class="T_optional">(Optional)</span>
				</div>
			</div>
		</div>
		<div id="l2tp-settings-ctn">
			<div><b class="T_username">Username:</b>
				<input type="text" size="15" id="l2tp_username" maxlength="255" class="xl">
			</div>
			<div><b class="T_passwd">Password:</b>
				<input type="password" size="15" id="l2tp_pwd" maxlength="255" class="xl">
			</div>
			<div><b class="T_addrType">Addressing Type:</b>
				<input type="radio" name="ipType2" id="l2tp_ipType_dyn" onclick="l2tpshowDyn()" checked="checked">
				<label class="T_dynip">Dynamic IP</label>
				<input type="radio" name="ipType2" id="l2tp_ipType_stc" onclick="l2tpshowStc()">
				<label class="T_staip">Static IP</label>
			</div>
			<div><b class="T_srvIpName">Server IP Address/Name:</b>
				<input type="text" size="15" id="l2tp_srvAddrName" maxlength="80">
			</div>
			<div id="l2tp_stc_ip_elem">
				<div><b class="T_ipaddr">IP Address:</b>
					<input type="text" id="l2tp_isp_ip_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
				</div>
				<div><b class="T_netmask">Subnet Mask:</b>
					<input type="text" id="l2tp_isp_net_mask_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
				</div>
				<div><b class="T_gateway">Gateway:</b>
					<input type="text" id="l2tp_isp_gw_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
				</div>
				<div><b class="T_dns">DNS Server:</b>
					<input type="text" id="l2tp_isp_dns_1_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
				</div>
				<div><b class="T_secdns">Secondary DNS:</b>
					<input type="text" id="l2tp_isp_dns_2_stc" value="0.0.0.0" size="15" maxlength="15" class="ip-address">
					<span class="T_optional">(Optional)</span>
				</div>
			</div>
		</div>
    </form>
    <button type="submit" class="green T_save" id="save">Save</button>
</div>
<script>var inifCfgStack,currentSettings={connectionType:"PPPoE",ispIndex:"0"},pStk=null,localObj=null,ethParam=null,ethIptvParam={},ethWan=null,wanParam=null,currentCountry="",initFlag=!1,conns=[];function pptpshowDyn(){$("#pptp_stc_ip_elem").addClass("nd")}function pptpshowStc(){$("#pptp_stc_ip_elem").removeClass("nd")}function l2tpshowDyn(){$("#l2tp_stc_ip_elem").addClass("nd")}function l2tpshowStc(){$("#l2tp_stc_ip_elem").removeClass("nd")}function showParam(e){if(null!=e.connectionType){switch(e.connectionType){case"PPPoE":$("#conntype option[value='PPPoE']").prop("selected","selected"),$("#pppoe-settings-ctn").removeClass("nd"),$("#staticIp-settings-ctn").addClass("nd"),$("#dhcp-settings-ctn").addClass("nd"),$("#pptp-settings-ctn").addClass("nd"),$("#l2tp-settings-ctn").addClass("nd");break;case"Static IP":$("#conntype option[value='Static IP']").prop("selected","selected"),$("#pppoe-settings-ctn").addClass("nd"),$("#staticIp-settings-ctn").removeClass("nd"),$("#dhcp-settings-ctn").addClass("nd"),$("#pptp-settings-ctn").addClass("nd"),$("#l2tp-settings-ctn").addClass("nd");break;case"Dynamic IP":$("#conntype option[value='Dynamic IP']").prop("selected","selected"),$("#pppoe-settings-ctn").addClass("nd"),$("#staticIp-settings-ctn").addClass("nd"),$("#pptp-settings-ctn").addClass("nd"),$("#l2tp-settings-ctn").addClass("nd"),INCLUDE_MER&&"GB"==currentCountry&&$("#dhcp-settings-ctn").removeClass("nd");break;case"L2TP":$("#conntype option[value='L2TP']").prop("selected","selected"),$("#l2tp-settings-ctn").removeClass("nd"),$("#pptp-settings-ctn").addClass("nd"),$("#pppoe-settings-ctn").addClass("nd"),$("#staticIp-settings-ctn").addClass("nd"),$("#dhcp-settings-ctn").addClass("nd");break;case"PPTP":$("#conntype option[value='PPTP']").prop("selected","selected"),$("#l2tp-settings-ctn").addClass("nd"),$("#pptp-settings-ctn").removeClass("nd"),$("#pppoe-settings-ctn").addClass("nd"),$("#staticIp-settings-ctn").addClass("nd"),$("#dhcp-settings-ctn").addClass("nd")}currentSettings.connectionType=e.connectionType,initFlag&&e.ispIndex&&$("#conntype").tpSelect({refresh:1})}void 0!==e.X_TP_VLanEnabled&&("1"==e.X_TP_VLanEnabled?($("#vlantag-en").prop("checked",!0),$("#vlanTag-ctn").removeClass("nd")):($("#vlantag-en").prop("checked",!1),$("#vlanTag-ctn").addClass("nd")),$("#vlantag-en").tpCheckbox({refresh:1})),INCLUDE_MER&&void 0!==e.merEnabled&&("1"==e.merEnabled?($("#mer-en").prop("checked",!0),$("#dhcp-settings-ctn").removeClass("nd")):($("#mer-en").prop("checked",!1),$("#dhcp-settings-ctn").addClass("nd")),$("#mer-en").tpCheckbox({refresh:1})),null!=e.X_TP_VID&&$("#vlan-tag").prop("value",e.X_TP_VID)}function initIspList(e,a){var t=[],s=[],n="";if(null!=$.ewanProfile.isp[e]){for(var p in $.ewanRegionIndex){var r=$.ewanRegionIndex[p];if($.ewanProfile.isp[r])for(var _=0;_<$.ewanProfile.isp[r].length;_++)r==e?s.push({name:$.ewanProfile.isp[r][_].name+"("+r+")",ispIndex:$.ewanProfile.isp[r][_].ispIndex,country:r}):t.push({name:$.ewanProfile.isp[r][_].name+"("+r+")",ispIndex:$.ewanProfile.isp[r][_].ispIndex,country:r})}function i(e,a){return e.name>a.name?1:-1}t.sort(i).sort(function(e,a){return e.country>a.country?1:-1}),s.sort(i);var l=s.concat(t);for(p=0;p<l.length;p++)e==l[p].country?n+='<option data-major="1" value="'+l[p].ispIndex+'">'+l[p].name+"</option>":n+='<option value="'+l[p].ispIndex+'">'+l[p].name+"</option>"}else $("#profile").addClass("nd");n+='<option data-major="1" value="-1">'+s_str.otherprovider+"</option>",$("#profile").html(n)}function switchToOthers(){$('#profile option[value="-1"]').prop("selected","selected"),$("#profile").tpSelect({refresh:1,search:!0})}function getParam(){var e,a,t,s,n=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);INCLUDE_WAN_VLAN?(e=INCLUDE_MER?$.act(ACT_GL,WAN_IP_CONN,null,null,["name","connectionType","addressingType","externalIPAddress","subnetMask","defaultGateway","DNSServers","X_TP_8021QEnabled","X_TP_VlanID","X_TP_MerEnabled","X_TP_Username","X_TP_Password"]):$.act(ACT_GL,WAN_IP_CONN,null,null,["name","connectionType","addressingType","externalIPAddress","subnetMask","defaultGateway","DNSServers","X_TP_8021QEnabled","X_TP_VlanID"]),a=$.act(ACT_GL,WAN_PPP_CONN,null,null,["name","transportType","username","password","X_TP_8021QEnabled","X_TP_VlanID"])):(e=INCLUDE_MER?$.act(ACT_GL,WAN_IP_CONN,null,null,["name","connectionType","addressingType","externalIPAddress","subnetMask","defaultGateway","DNSServers","X_TP_MerEnabled","X_TP_Username","X_TP_Password"]):$.act(ACT_GL,WAN_IP_CONN,null,null,["name","connectionType","addressingType","externalIPAddress","subnetMask","defaultGateway","DNSServers"]),a=$.act(ACT_GL,WAN_PPP_CONN,null,null,["name","transportType","username","password"]),INCLUDE_L2TP&&(t=$.act(ACT_GL,WAN_L2TP_CONN,null,null)),INCLUDE_PPTP&&(s=$.act(ACT_GL,WAN_PPTP_CONN,null,null)));var p=$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);if(INCLUDE_IPV6)var r=$.act(ACT_GET,L3_IP6_FORWARDING,null,null,["__ifAliasName"]);$.exe(),$.each(e,function(){if("Ethernet"===$.arr2obj(n,"__stack")[$.stkPop(this.__stack,2)].WANAccessType&&"ewan_iptv"!=this.name){if(conns.push(this),(this.name===p.__ifAliasName||INCLUDE_IPV6&&this.name===r.__ifAliasName)&&"LTE"!=this.name){var e,a=$.arr2obj(ethWan,"__stack")[$.stkPop(this.__stack)];gw=this,ethParam={X_TP_VLanEnabled:a.X_TP_VLanEnabled,X_TP_VID:a.X_TP_VID,stack:a.__stack,wan:this},wanParam="Static"==this.addressingType?(e="Static IP",dns=this.DNSServers.split(","),{linkType:e,ip:this.externalIPAddress,mask:this.subnetMask,gw:this.defaultGateway,dns:dns[0],dns2:dns[1]}):(e="Dynamic IP",INCLUDE_MER?{linkType:"Dynamic IP",merEnabled:this.X_TP_MerEnabled,merUsername:this.X_TP_Username,merPassword:this.X_TP_Password}:{linkType:"Dynamic IP"})}}else if("ewan_iptv"==this.name){var t=$.arr2obj(ethWan,"__stack")[$.stkPop(this.__stack)];ethIptvParam={stack:t.stack,wan:this}}}),$.each(a,function(){if("Ethernet"===$.arr2obj(n,"__stack")[$.stkPop(this.__stack,2)].WANAccessType&&"ewan_iptv"!=this.name){if(conns.push(this),"PPPoE"==this.transportType&&(this.name===p.__ifAliasName||INCLUDE_IPV6&&this.name===r.__ifAliasName||"LTE"==p.__ifAliasName)){var e=$.arr2obj(ethWan,"__stack")[$.stkPop(this.__stack)];gw=this,ethParam={X_TP_VLanEnabled:e.X_TP_VLanEnabled,X_TP_VID:e.X_TP_VID,stack:e.__stack,wan:this},wanParam={linkType:this.transportType,usr:this.username,pwd:this.password}}}else if("ewan_iptv"==this.name){var a=$.arr2obj(ethWan,"__stack")[$.stkPop(this.__stack)];ethIptvParam={stack:a.stack,wan:this}}}),$.each(t,function(){if("Ethernet"===$.arr2obj(n,"__stack")[$.stkPop(this.__stack,2)].WANAccessType&&"ewan_iptv"!=this.name){if(conns.push(this),this.name===p.__ifAliasName||"LTE"==p.__ifAliasName){var e,a=$.arr2obj(ethWan,"__stack")[$.stkPop(this.__stack)],t="L2TP";gw=this,ethParam={X_TP_VLanEnabled:a.X_TP_VLanEnabled,X_TP_VID:a.X_TP_VID,stack:a.__stack,wan:this},wanParam="Static"==this.addressingType?(dns=this.DNSServersIP.split(","),e="Static IP",{usr:this.username,pwd:this.password,linkType:t,addrType:e,ip:this.externalIPAddressIP,mask:this.subnetMaskIP,gw:this.defaultGatewayIP,serip:this.serverIpOrName,dns:dns[0],dns2:dns[1]}):(e="Dynamic IP",{usr:this.username,pwd:this.password,serip:this.serverIpOrName,linkType:t,addrType:e})}}else if("ewan_iptv"==this.name){var s=$.arr2obj(ethWan,"__stack")[$.stkPop(this.__stack)];ethIptvParam={stack:s.stack,wan:this}}}),$.each(s,function(){if("Ethernet"===$.arr2obj(n,"__stack")[$.stkPop(this.__stack,2)].WANAccessType&&"ewan_iptv"!=this.name){if(conns.push(this),this.name===p.__ifAliasName||"LTE"==p.__ifAliasName){var e,a=$.arr2obj(ethWan,"__stack")[$.stkPop(this.__stack)],t="PPTP";gw=this,ethParam={X_TP_VLanEnabled:a.X_TP_VLanEnabled,X_TP_VID:a.X_TP_VID,stack:a.__stack,wan:this},wanParam="Static"==this.addressingType?(dns=this.DNSServersIP.split(","),e="Static IP",{usr:this.username,pwd:this.password,linkType:t,addrType:e,ip:this.externalIPAddressIP,mask:this.subnetMaskIP,gw:this.defaultGatewayIP,serip:this.serverIpOrName,dns:dns[0],dns2:dns[1]}):(e="Dynamic IP",{usr:this.username,pwd:this.password,serip:this.serverIpOrName,linkType:t,addrType:e})}}else if("ewan_iptv"==this.name){var s=$.arr2obj(ethWan,"__stack")[$.stkPop(this.__stack)];ethIptvParam={stack:s.stack,wan:this}}}),wanParam||(wanParam={linkType:"Dynamic IP"}),ethParam||(ethParam={X_TP_VLanEnabled:0,X_TP_VID:0})}function initParam(e){switch(e.linkType){case"PPPoE":$("#pppoe-username").val(e.usr),$("#pppoe-password").val(e.pwd);break;case"Static IP":$("#staip-ipaddr").tpAddress("val",e.ip),$("#staip-netmask").tpAddress("val",e.mask),$("#staip-defgw").tpAddress("val",e.gw),$("#staip-dns").tpAddress("val",e.dns),$("#staip-secdns").tpAddress("val",e.dns2?e.dns2:"0.0.0.0");break;case"Dynamic IP":INCLUDE_MER&&($("#mer-en").prop("checked","1"==e.merEnabled),$("#dhcp-username").val(e.merUsername),$("#dhcp-password").val(e.merPassword));break;case"L2TP":$("#l2tp_username").val(e.usr),$("#l2tp_pwd").val(e.pwd),$("#l2tp_srvAddrName").val(e.serip),"Static IP"==e.addrType?($("#l2tp_ipType_dyn").prop("checked",!1),$("#l2tp_ipType_dyn").data("tpRadio").refresh(),$("#l2tp_ipType_stc").prop("checked",!0),$("#l2tp_ipType_stc").data("tpRadio").refresh(),$("#l2tp_stc_ip_elem").removeClass("nd"),$("#l2tp_isp_ip_stc").tpAddress("val",e.ip),$("#l2tp_isp_net_mask_stc").tpAddress("val",e.mask),$("#l2tp_isp_gw_stc").tpAddress("val",e.gw),$("#l2tp_isp_dns_1_stc").tpAddress("val",e.dns),$("#l2tp_isp_dns_2_stc").tpAddress("val",e.dns2?e.dns2:"0.0.0.0")):($("#l2tp_ipType_stc").prop("checked",!1),$("#l2tp_ipType_stc").data("tpRadio").refresh(),$("#l2tp_ipType_dyn").prop("checked",!0),$("#l2tp_ipType_dyn").data("tpRadio").refresh(),$("#l2tp_stc_ip_elem").addClass("nd"));break;case"PPTP":$("#pptp_username").val(e.usr),$("#pptp_pwd").val(e.pwd),$("#pptp_srvAddrName").val(e.serip),"Static IP"==e.addrType?($("#pptp_ipType_dyn").prop("checked",!1),$("#pptp_ipType_dyn").data("tpRadio").refresh(),$("#pptp_ipType_stc").prop("checked",!0),$("#pptp_ipType_stc").data("tpRadio").refresh(),$("#pptp_stc_ip_elem").removeClass("nd"),$("#pptp_isp_ip_stc").tpAddress("val",e.ip),$("#pptp_isp_net_mask_stc").tpAddress("val",e.mask),$("#pptp_isp_gw_stc").tpAddress("val",e.gw),$("#pptp_isp_dns_1_stc").tpAddress("val",e.dns),$("#pptp_isp_dns_2_stc").tpAddress("val",e.dns2?e.dns2:"0.0.0.0")):($("#pptp_ipType_stc").prop("checked",!1),$("#pptp_ipType_stc").data("tpRadio").refresh(),$("#pptp_ipType_dyn").prop("checked",!0),$("#pptp_ipType_dyn").data("tpRadio").refresh(),$("#pptp_stc_ip_elem").addClass("nd"))}}function getVlanParam(){var e={};if(e.ispIndex=$("#profile").data("value"),e.X_TP_VLanEnabled=$("#vlantag-en").prop("data-checked")?"1":"0","1"===e.X_TP_VLanEnabled){if(!0!==$("#vlan-tag").tpInput("validate"))return null;e.X_TP_VID=parseInt($("#vlan-tag").prop("value"),10)}else e.X_TP_VID="-1";return e}function addAttrsPPP(){var e={enable:1,transportType:"PPPoE",username:$("#pppoe-username").val(),password:$("#pppoe-password").val()};return""==e.username?($.alert(ERR_USERNAME_INVAD),$("#pppoe-username").focus().select(),null):e}function addAttrsStaIpoa(){var e=$("#staip-ipaddr").tpAddress("val"),a=$("#staip-netmask").tpAddress("val"),t=$("#staip-defgw").tpAddress("val");if($.ifip(e))return $("#staip-ipaddr").tpAddress("focus"),null;if($.mask(a))return $("#staip-netmask").tpAddress("focus"),null;if($.ipmask(e,a))return $("#staip-netmask").tpAddress("focus"),null;if($.ifip(t,!0))return $.alert(ERR_IP_FORMAT),$("#staip-defgw").tpAddress("focus"),null;if(!$.isSameLan(t,a,e,a))return $.alert(ERR_GATEWAY_INVAD),$("#staip-defgw").tpAddress("focus"),null;var s,n=$("#staip-dns").tpAddress("val"),p=$("#staip-secdns").tpAddress("val");return $.ifip(n,!0)?($.alert(ERR_WAN_DNSADDR_INVAD),$("#staip-dns").tpAddress("focus"),null):""!=p&&"0.0.0.0"!=p&&$.ifip(p,!0)?($.alert(ERR_WAN_SECDNS_INVAD),$("#staip-secdns").tpAddress("focus"),null):(s=(n=n?$.ip2ip(n):"0.0.0.0")+","+(p=p?$.ip2ip(p):"0.0.0.0"),{enable:1,connectionType:"IP_Routed",addressingType:"Static",NATEnabled:1,externalIPAddress:$.ip2ip(e),subnetMask:$.ip2ip(a),defaultGateway:t?$.ip2ip(t):"0.0.0.0",DNSOverrideAllowed:"0.0.0.0,0.0.0.0"==s?0:1,DNSServers:s})}function addAttrsDynIp(){var e={enable:1,connectionType:"IP_Routed",addressingType:"DHCP",NATEnabled:1,X_TP_Hostname:$.getDefaultHostname()};return INCLUDE_MER&&"GB"==currentCountry&&($("#mer-en").prop("data-checked")?(e.X_TP_MerEnabled=1,e.X_TP_Username=$("#dhcp-username").val(),e.X_TP_Password=$("#dhcp-password").val()):e.X_TP_MerEnabled=0),e}function addAttrsPptp(e){var a={MACAddressOverride:0,connectionTrigger:"AlwaysOn",maxMRUSize:"PPTP"==e?1420:1460};if(a.username=$("#pptp_username").val(),a.password=$("#pptp_pwd").val(),""==$("#pptp_srvAddrName").val())return $.alert(ERR_WAN_DA_SERVER_NAME_EMPTY),$("#pptp_srvAddrName").focus().select(),!1;if(a.serverIpOrName=$("#pptp_srvAddrName").val(),$("#pptp_ipType_stc").prop("checked")){var t=$("#pptp_isp_ip_stc").tpAddress("val"),s=$("#pptp_isp_net_mask_stc").tpAddress("val"),n=$("#pptp_isp_gw_stc").tpAddress("val");if(a.addressingType="Static",$.ifip(t)||$.mask(s)||$.ipmask(t,s))return!1;if(a.externalIPAddressIP=$.ip2ip(t),a.subnetMaskIP=$.ip2ip(s),""==n||"0.0.0.0"!=n&&$.ifip(n,!0))return $.alert(ERR_IP_FORMAT),$("#pptp_isp_gw_stc").tpAddress("focus"),!1;if("0.0.0.0"==n||!$.isSameLan(n,s,t,s))return $.alert(ERR_GATEWAY_INVAD),$("#pptp_isp_gw_stc").tpAddress("focus"),!1;a.defaultGatewayIP=$.ip2ip(n);var p,r=$("#pptp_isp_dns_1_stc").tpAddress("val"),_=$("#pptp_isp_dns_2_stc").tpAddress("val");if($.ifip(r,!0))return $.alert(ERR_WAN_DNSADDR_INVAD),$("#pptp_isp_dns_1_stc").tpAddress("focus"),!1;if(""!=r&&"0.0.0.0"!=r&&$.ifip(r,!0))return $.alert(ERR_WAN_DNSADDR_INVAD),$("#pptp_isp_dns_1_stc").tpAddress("focus"),!1;if(""!=_&&"0.0.0.0"!=_&&$.ifip(_,!0))return $.alert(ERR_WAN_SECDNS_INVAD),$("#pptp_isp_dns_2_stc").tpAddress("focus"),!1;if(p=(r=r?$.ip2ip(r):"0.0.0.0")+","+(_=_?$.ip2ip(_):"0.0.0.0"),a.DNSServersIP=p,$.ifip(a.serverIpOrName,!0)&&"0.0.0.0"==r&&"0.0.0.0"==_)return $.alert(ERR_WAN_DA_DNS_EMPTY),$("#pptp_isp_dns_1_stc").tpAddress("focus"),!1}else a.addressingType="DHCP";return a}function addAttrsL2tp(e){var a={MACAddressOverride:0,connectionTrigger:"AlwaysOn",maxMRUSize:"l2tp"==e?1420:1460};if(a.username=$("#l2tp_username").val(),a.password=$("#l2tp_pwd").val(),""==$("#l2tp_srvAddrName").val())return $.alert(ERR_WAN_DA_SERVER_NAME_EMPTY),$("#l2tp_srvAddrName").focus().select(),!1;if(a.serverIpOrName=$("#l2tp_srvAddrName").val(),$("#l2tp_ipType_stc").prop("checked")){var t=$("#l2tp_isp_ip_stc").tpAddress("val"),s=$("#l2tp_isp_net_mask_stc").tpAddress("val"),n=$("#l2tp_isp_gw_stc").tpAddress("val");if(a.addressingType="Static",$.ifip(t)||$.mask(s)||$.ipmask(t,s))return!1;if(a.externalIPAddressIP=$.ip2ip(t),a.subnetMaskIP=$.ip2ip(s),""==n||"0.0.0.0"!=n&&$.ifip(n,!0))return $.alert(ERR_IP_FORMAT),$("#l2tp_isp_gw_stc").tpAddress("focus"),!1;if("0.0.0.0"==n||!$.isSameLan(n,s,t,s))return $.alert(ERR_GATEWAY_INVAD),$("#l2tp_isp_gw_stc").tpAddress("focus"),!1;a.defaultGatewayIP=$.ip2ip(n);var p,r=$("#l2tp_isp_dns_1_stc").tpAddress("val"),_=$("#l2tp_isp_dns_2_stc").tpAddress("val");if($.ifip(r,!0))return $.alert(ERR_WAN_DNSADDR_INVAD),$("#l2tp_isp_dns_1_stc").tpAddress("focus"),!1;if(""!=r&&"0.0.0.0"!=r&&$.ifip(r,!0))return $.alert(ERR_WAN_DNSADDR_INVAD),$("#l2tp_isp_dns_1_stc").tpAddress("focus"),!1;if(""!=_&&"0.0.0.0"!=_&&$.ifip(_,!0))return $.alert(ERR_WAN_SECDNS_INVAD),$("#l2tp_isp_dns_2_stc").tpAddress("focus"),!1;if(p=(r=r?$.ip2ip(r):"0.0.0.0")+","+(_=_?$.ip2ip(_):"0.0.0.0"),a.DNSServersIP=p,$.ifip(a.serverIpOrName,!0)&&"0.0.0.0"==r&&"0.0.0.0"==_)return $.alert(ERR_WAN_DA_DNS_EMPTY),$("#l2tp_isp_dns_1_stc").tpAddress("focus"),!1}else a.addressingType="DHCP";return a}function getWanParam(){var e=$("#conntype").data("value"),a={};switch(e){case"PPPoE":a=addAttrsPPP();break;case"Static IP":a=addAttrsStaIpoa();break;case"Dynamic IP":a=addAttrsDynIp();break;case"L2TP":a=addAttrsL2tp(e);break;case"PPTP":a=addAttrsPptp(e)}return null!=a&&a}function doCollect(){var e=getVlanParam(),a=getWanParam();return e&&a?[e,a]:null}function doSaveWan(e,a){$.addLoading($("#save"));var t={__ifAliasName:ethParam.wan&&ethParam.wan.name,__ifName:"",defaultConnectionService:""};if("PPTP"!=e&&"L2TP"!=e&&(a.X_TP_IPv4Enabled=1),e==wanParam.linkType&&ethParam.wan)"L2TP"==e?$.act(ACT_SET,WAN_L2TP_CONN,ethParam.wan.__stack,null,a):"PPTP"==e?$.act(ACT_SET,WAN_PPTP_CONN,ethParam.wan.__stack,null,a):$.act(ACT_SET,e.indexOf("PPP")<0?WAN_IP_CONN:WAN_PPP_CONN,ethParam.wan.__stack,null,a);else{if(ethParam.wan&&("L2TP"==wanParam.linkType?$.act(ACT_DEL,WAN_L2TP_CONN,ethParam.wan.__stack,null):"PPTP"==wanParam.linkType?$.act(ACT_DEL,WAN_PPTP_CONN,ethParam.wan.__stack,null):$.act(ACT_DEL,wanParam.linkType.indexOf("PPP")<0?WAN_IP_CONN:WAN_PPP_CONN,ethParam.wan.__stack,null)),"L2TP"==e)var s=$.act(ACT_ADD,WAN_L2TP_CONN,null,ethParam.stack,a);else if("PPTP"==e)s=$.act(ACT_ADD,WAN_PPTP_CONN,null,ethParam.stack,a);else s=$.act(ACT_ADD,e.indexOf("PPP")<0?WAN_IP_CONN:WAN_PPP_CONN,null,ethParam.stack,a);if(ret=$.exe(),ret)return void(INCLUDE_EWAN_VLAN&&ret==CMM_WAN_VID_CONFLICT||ret==CMM_WAN_L2TP_ALREADY_EXIST||ret==CMM_WAN_PPTP_ALREADY_EXIST||($.act(ACT_DEL,WAN_CONN_DEVICE,ethParam.stack,null),$.exe()));if("L2TP"==e)var n=$.act(ACT_GET,WAN_L2TP_CONN,s.__stack,null,["name"]);else if("PPTP"==e)n=$.act(ACT_GET,WAN_PPTP_CONN,s.__stack,null,["name"]);else n=$.act(ACT_GET,e.indexOf("PPP")<0?WAN_IP_CONN:WAN_PPP_CONN,s.__stack,null,["name"]);$.exe(),t.__ifAliasName=n.name}$.act(ACT_SET,L3_FORWARDING,null,null,t)}function doAddEth(e,a){var t=$.act(ACT_ADD,WAN_CONN_DEVICE,null,pStk);$.exe()||(ethParam.stack=t.__stack)}function doSave(r,_){ethParam.stack||doAddEth(r,_);for(var e=!1,i=[],l=null,a=0;a<ethWan.length;a++)r[0].X_TP_VID==ethWan[a].X_TP_VID&&ethWan[a].X_TP_VID!=ethParam.X_TP_VID&&(e=!0,i.push(ethWan[a].__stack));if(e)$.confirm(c_str.del_conflict_conns,function(){for(var e=[],a=0;a<conns.length;a++)for(var t=0;t<i.length;t++)$.stkPop(conns[a].__stack,1)==i[t]&&e.push(conns[a]);for(a=0;a<i.length&&ethIptvParam.wan;a++)if($.stkPop(ethIptvParam.wan.__stack,1)==i[a]&&($.act(ACT_SET,ETH_IPTV_CFG,null,null,["enable=0"]),$.exe()))return void $.removeLoading();for(var s=[],n=[];instance=e.shift();)stack=$.stkPop(instance.__stack),"PPPoE"==instance.transportType?$.act(ACT_DEL,WAN_PPP_CONN,instance.__stack):"L2TP"==instance.transportType?$.act(ACT_DEL,WAN_L2TP_CONN,instance.__stack):"PPTP"==instance.transportType?$.act(ACT_DEL,WAN_PPTP_CONN,instance.__stack):$.act(ACT_DEL,WAN_IP_CONN,instance.__stack),$.inArray(stack,s)||s.push(stack);for(;stack=s.shift();)n.push($.act(ACT_GET,WAN_CONN_DEVICE,stack,null));if($.exe())$.removeLoading();else{for(;instance=n.shift();)"L2TP"!=instance.transportType&&"PPTP"!=instance.transportType?0==instance.WANIPConnectionNumberOfEntries&&0==instance.WANPPPConnectionNumberOfEntries&&$.act(ACT_DEL,WAN_CONN_DEVICE,instance.__stack):$.act(ACT_DEL,WAN_CONN_DEVICE,instance.__stack);$.exe(),l="1"==r[0].X_TP_VLanEnabled?{X_TP_VID:r[0].X_TP_VID,X_TP_VLanEnabled:r[0].X_TP_VLanEnabled}:{X_TP_VLanEnabled:r[0].X_TP_VLanEnabled};var p={ewanIspIndex:r[0].ispIndex};l.enable=1,$.act(ACT_SET,WAN_ETH_LINK_CFG,ethParam.stack,null,l),$.act(ACT_SET,LOCAL,null,null,p),doSaveWan(_,r[1]),INCLUDE_EWAN_IPTV&&$("#profile").data("value")!=localObj.ewanIspIndex&&doSaveIptv(),$.exe(function(e){e||($.removeLoading(),$.reload())})}},function(){!1});else{l="1"==r[0].X_TP_VLanEnabled?{X_TP_VID:r[0].X_TP_VID,X_TP_VLanEnabled:r[0].X_TP_VLanEnabled}:{X_TP_VLanEnabled:r[0].X_TP_VLanEnabled};var t={ewanIspIndex:r[0].ispIndex};l.enable=1,$.act(ACT_SET,WAN_ETH_LINK_CFG,ethParam.stack,null,l),$.act(ACT_SET,LOCAL,null,null,t),doSaveWan(_,r[1]),INCLUDE_EWAN_IPTV&&$("#profile").data("value")!=localObj.ewanIspIndex&&doSaveIptv(),$.exe(function(e){e||($.removeLoading(),$.reload())})}return!0}function doSaveIptv(){var e=$("#profile").data("value");if("-1"!=e){var a,t=e.substr(0,e.length-2),s=$.ewanRegionIndex[t],n=null,p=null,r=null;if($.ewanProfile.iptv[s]){for(var _=0;_<$.ewanProfile.isp[s].length;_++)if($.ewanProfile.isp[s][_].ispIndex==e){p=$.ewanProfile.isp[s][_].name;break}if(p)for(_=0;_<$.ewanProfile.iptv[s].length;_++)if($.ewanProfile.iptv[s][_].name==p){n=$.ewanProfile.iptv[s][_];break}n&&("Bridge"==n.connectionType&&(a=$.act(ACT_GET,ETH_IPTV_CFG,null,null,null),$.exe()),"Bridge"==(r={enable:1,vlanTag:n.vlanTag,priority:n.priority,enableVlanTag:n.enableVlanTag,connectionType:n.connectionType,ispIndex:n.ispIndex}).connectionType&&"Bridge"!=a.connectionType&&(r={ispIndex:"-1"}),$.act(ACT_SET,ETH_IPTV_CFG,null,null,r))}}}function init(){localObj=$.act(ACT_GET,LOCAL,null,null,["Country","ewanIspIndex"]);var e=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);$.exe()||(curCountry=localObj.country,$.each(e,function(){"Ethernet"==this.WANAccessType&&(pStk=this.__stack)}),ethWan=$.act(ACT_GS,WAN_ETH_LINK_CFG,null,pStk,null),$.exe()),getParam();for(var a=null,t=0;t<regionCodeInfo.length;t++)if(regionCodeInfo[t][1].slice(0,2)==localObj.country){a=regionCodeInfo[t][4];break}var s={X_TP_VID:ethParam.X_TP_VID,X_TP_VLanEnabled:ethParam.X_TP_VLanEnabled,connectionType:wanParam.linkType,ispIndex:localObj.ewanIspIndex};initIspList(a,s),initParam(wanParam),"-1"==localObj.ewanIspIndex||0<localObj.ewanIspIndex?$("#profile option[value='"+localObj.ewanIspIndex+"']").prop("selected","selected"):$("#profile option[value='-1']").prop("selected","selected"),showParam(s)}$("#profile").click(function(e){if(initFlag){var a=$("#profile").data("value"),t={};if("-1"!=a)for(var s=a.slice(0,a.length-2),n=$.ewanRegionIndex[s],p=0;p<$.ewanProfile.isp[n].length;p++)$.ewanProfile.isp[n][p].ispIndex==a&&(t=$.ewanProfile.isp[n][p]);t.ispIndex=a,showParam(t)}}),$("#conntype").click(function(e){var a=$("#conntype").data("value");a!=currentSettings.connectionType&&(showParam({connectionType:a}),switchToOthers())}),$("#vlantag-en").click(function(e){$("#vlantag-en").prop("data-checked")?showParam({X_TP_VLanEnabled:"1"}):showParam({X_TP_VLanEnabled:"0"}),switchToOthers()}),$("#vlan-tag").on("keydown",function(e){switchToOthers()}),$("#save").click(function(e){var a=$("#conntype").data("value"),t=doCollect();t&&doSave(t,a)}),$("#vlan-tag").tpInput({allowBlank:!1,vtype:{vtype:"number",max:4094,min:1},suffix:"(1-4094)",validator:function(e){return!(e<1||4094<e)},invalidText:s_str.vlanTagChk}),$.tpInit(init),$("#profile").tpSelect({search:!0}),initFlag=!0</script>
