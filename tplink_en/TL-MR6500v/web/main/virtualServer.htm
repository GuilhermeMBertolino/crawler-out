<script>var selAll,allStk,allStkType,vtlServ_stack,vtlServ_stackIndex,param,curIndex=-1,addIndex=-1,vtlServ=[],editFlag=0,curStk=[],curType=" ",serviceArray=new Array(["DNS",53,53],["FTP",21,21],["GOPHER",70,70],["HTTP",80,80],["NNTP",119,119],["POP3",110,110],["SMTP",25,25],["SOCK",1080,1080],["TELNET",23,23]);function initIntf(){var t=$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);if(INCLUDE_WAN_MODE)if(INCLUDE_3G4G_BACKUP)e=$.act(ACT_GET,SYS_MODE,null,null,["mode","lteBackupEnable"]);else var e=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);if(INCLUDE_USB_3G_DONGLE)var n=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"]);if(INCLUDE_IPV6){var l=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType","X_TP_IPv4Enabled"]),a=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","X_TP_IPv4Enabled","transportType"]);if(INCLUDE_L2TP)var r=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"]);if(INCLUDE_PPTP)var i=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"])}else{l=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType"]),a=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","transportType"]);if(INCLUDE_L2TP)r=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"]);if(INCLUDE_PPTP)i=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"])}if(!$.exe()){var o;wanInfName=t.__ifAliasName,INCLUDE_WAN_MODE&&(o=e.mode);var p=0;INCLUDE_USB_3G_DONGLE&&$.each(n,function(){if(1==this.enable)return p=this.backupEnable,!1});for(var P=0,_=0;_<l.length;_++)if(1!=$.isSpecialConnection(l[_])&&1==l[_].NATEnabled&&"IP_Routed"==l[_].connectionType&&(1==l[_].enable&&(!INCLUDE_IPV6||1==l[_].X_TP_IPv4Enabled)||INCLUDE_3G4G_BACKUP&&"ETH"==e.mode&&1==e.lteBackupEnable&&"LTE"==l[_].name)){var c=l[_].name,d="ip:"+l[_].__stack;$("#wanInf").append("<option value='"+d+"' text='"+c+"' >"+c+"</option>"),P=1}for(var s=0;s<a.length;s++)if(1!=$.isSpecialConnection(a[s])&&!(1!=a[s].NATEnabled||1!=a[s].enable&&("PPP3G"!=a[s].transportType||"USB_3G"!=o&&1!=p)||INCLUDE_IPV6&&1!=a[s].X_TP_IPv4Enabled)){c=a[s].name,d="ppp:"+a[s].__stack;$("#wanInf").append("<option value='"+d+"' text='"+c+"' >"+c+"</option>"),P=1}if(INCLUDE_L2TP)for(s=0;s<r.length;s++)if(1==r[s].enable){c=r[s].name,d="l2tp:"+r[s].__stack;$("#wanInf").append("<option value='"+d+"' text='"+c+"' >"+c+"</option>"),P=1}if(INCLUDE_PPTP)for(s=0;s<i.length;s++)if(1==i[s].enable){c=i[s].name,d="pptp:"+i[s].__stack;$("#wanInf").append("<option value='"+d+"' text='"+c+"' >"+c+"</option>"),P=1}if(0==P){c=s_str.nointf,d="";$("#wanInf").append("<option value='"+d+"' text='"+c+"' >"+c+"</option>"),$("#ok").prop("disabled",!0)}$("#wanInf").find("option[text="+wanInfName+"]").prop("selected","selected");$("#wanInf").tpSelect({refresh:1})}}function doEdit(t,e){var n;editFlag=1,curType=t,curStk=e;$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);if(INCLUDE_WAN_MODE)if(INCLUDE_3G4G_BACKUP)l=$.act(ACT_GET,SYS_MODE,null,null,["mode","lteBackupEnable"]);else var l=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);if(INCLUDE_USB_3G_DONGLE)var a=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"]);if(INCLUDE_IPV6){var r=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType","X_TP_IPv4Enabled"]),i=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","X_TP_IPv4Enabled","transportType"]);if(INCLUDE_L2TP)var o=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"]);if(INCLUDE_PPTP)var p=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"])}else{r=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType"]),i=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","transportType"]);if(INCLUDE_L2TP)o=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"]);if(INCLUDE_PPTP)p=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"])}if(!$.exe()){if(pStk=e[0]+","+e[1]+","+e[2]+",0,0,0","ip"==t?(vtlServCfg=$.act(ACT_GET,WAN_IP_CONN_PORTMAPPING,e,null,["portMappingEnabled","externalPort","X_TP_ExternalPortEnd","portMappingProtocol","internalPort","X_TP_InternalPortEnd","internalClient","serviceName"]),n=$.act(ACT_GET,WAN_IP_CONN,pStk,null,["name"])):"ppp"==t?(vtlServCfg=$.act(ACT_GET,WAN_PPP_CONN_PORTMAPPING,e,null,["portMappingEnabled","externalPort","X_TP_ExternalPortEnd","portMappingProtocol","internalPort","X_TP_InternalPortEnd","internalClient","serviceName"]),n=$.act(ACT_GET,WAN_PPP_CONN,pStk,null,["name"])):"l2tp"==t?(vtlServCfg=$.act(ACT_GET,WAN_L2TP_CONN_PORTMAPPING,e,null,["portMappingEnabled","externalPort","externalPortEnd","portMappingProtocol","internalPort","internalPortEnd","internalClient","serviceName"]),n=$.act(ACT_GET,WAN_L2TP_CONN,pStk,null,["name"])):"pptp"==t&&(vtlServCfg=$.act(ACT_GET,WAN_PPTP_CONN_PORTMAPPING,e,null,["portMappingEnabled","externalPort","externalPortEnd","portMappingProtocol","internalPort","internalPortEnd","internalClient","serviceName"]),n=$.act(ACT_GET,WAN_PPTP_CONN,pStk,null,["name"])),!$.exe()){if(wanInfName=n.name,"l2tp"==t||"pptp"==t){if(vtlServCfg.externalPort==vtlServCfg.externalPortEnd)$("#applyPort").prop("value",vtlServCfg.externalPort);else{var P=vtlServCfg.externalPort+"-"+vtlServCfg.externalPortEnd;$("#applyPort").prop("value",P)}if($("#ipAddr").tpAddress("val",vtlServCfg.internalClient),vtlServCfg.internalPort==vtlServCfg.externalPort&&vtlServCfg.internalPortEnd==vtlServCfg.externalPortEnd&&vtlServCfg.internalPort!=vtlServCfg.internalPortEnd)$("#interPort").prop("value","");else if(vtlServCfg.internalPort==vtlServCfg.internalPortEnd)$("#interPort").prop("value",vtlServCfg.internalPort);else{P=vtlServCfg.internalPort+"-"+vtlServCfg.internalPortEnd;$("#interPort").prop("value",P)}}else{if(vtlServCfg.externalPort==vtlServCfg.X_TP_ExternalPortEnd)$("#applyPort").prop("value",vtlServCfg.externalPort);else{P=vtlServCfg.externalPort+"-"+vtlServCfg.X_TP_ExternalPortEnd;$("#applyPort").prop("value",P)}if($("#ipAddr").tpAddress("val",vtlServCfg.internalClient),vtlServCfg.internalPort==vtlServCfg.externalPort&&vtlServCfg.X_TP_InternalPortEnd==vtlServCfg.X_TP_ExternalPortEnd&&vtlServCfg.internalPort!=vtlServCfg.X_TP_InternalPortEnd)$("#interPort").prop("value","");else if(vtlServCfg.internalPort==vtlServCfg.X_TP_InternalPortEnd)$("#interPort").prop("value",vtlServCfg.internalPort);else{P=vtlServCfg.internalPort+"-"+vtlServCfg.X_TP_InternalPortEnd;$("#interPort").prop("value",P)}}$("#serName").prop("value",vtlServCfg.serviceName),"TCP"==vtlServCfg.portMappingProtocol?$("#protol option[value='TCP']").prop("selected","selected"):"UDP"==vtlServCfg.portMappingProtocol?$("#protol option[value='UDP']").prop("selected","selected"):"TCP or UDP"==vtlServCfg.portMappingProtocol&&$("#protol option[value='TCP or UDP']").prop("selected","selected");var _={refresh:1};$("#protol").tpSelect(_),1==vtlServCfg.portMappingEnabled?$("#vtlServ_en").prop("checked","checked"):$("#vtlServ_en").prop("checked",!1),$("#vtlServ_en").tpCheckbox()}var c;INCLUDE_WAN_MODE&&(c=l.mode);var d=0;INCLUDE_USB_3G_DONGLE&&$.each(a,function(){if(1==this.enable)return d=this.backupEnable,!1});for(var s=0,T=0;T<r.length;T++)if(1==r[T].NATEnabled&&"IP_Routed"==r[T].connectionType&&(1==r[T].enable&&(!INCLUDE_IPV6||1==r[T].X_TP_IPv4Enabled)||INCLUDE_3G4G_BACKUP&&"ETH"==l.mode&&1==l.lteBackupEnable&&"LTE"==r[T].name)){var N=r[T].name,E="ip:"+r[T].__stack;$("#wanInf").append("<option value='"+E+"' text='"+N+"' >"+N+"</option>"),s=1}for(var C=0;C<i.length;C++)if(!(1!=i[C].NATEnabled||1!=i[C].enable&&("PPP3G"!=i[C].transportType||"USB_3G"!=c&&1!=d)||INCLUDE_IPV6&&1!=i[C].X_TP_IPv4Enabled)){N=i[C].name,E="ppp:"+i[C].__stack;$("#wanInf").append("<option value='"+E+"' text='"+N+"' >"+N+"</option>"),s=1}if(INCLUDE_L2TP)for(C=0;C<o.length;C++)if(1==o[C].enable){N=o[C].name,E="l2tp:"+o[C].__stack;$("#wanInf").append("<option value='"+E+"' text='"+N+"' >"+N+"</option>"),s=1}if(INCLUDE_PPTP)for(C=0;C<p.length;C++)if(1==p[C].enable){N=p[C].name,E="pptp:"+p[C].__stack;$("#wanInf").append("<option value='"+E+"' text='"+N+"' >"+N+"</option>"),s=1}if(0==s){N=s_str.nointf,E="";$("#wanInf").append("<option value='"+E+"' text='"+N+"' >"+N+"</option>"),$("#ok").prop("disabled",!0)}$("#wanInf").find("option[text="+wanInfName+"]").prop("selected","selected");_={refresh:1};$("#wanInf").tpSelect(_)}}function doEnable(t,e,n){var l={},a=!1,r=!1,i=$.act(ACT_GET,PPTPVPN,null,null),o=$.act(ACT_GET,OPENVPN,null,null);if("ip"==t){var p=$.act(ACT_GET,WAN_IP_CONN_PORTMAPPING,e,null,null);$.exe(),0==p.portMappingEnabled&&INCLUDE_USB_FTP_SERVER&&(l=checkConlictation(p.externalPort,p.X_TP_ExternalPortEnd,p.portMappingProtocol)),checkConflictPptpALGPort(p.externalPort,p.X_TP_ExternalPortEnd)&&"UDP"!=p.portMappingProtocol&&0==p.portMappingEnabled&&1==i.enable&&(a=!0),checkConflictOvpnVSPort(p.externalPort,p.X_TP_ExternalPortEnd,o.port)&&checkConflictOvpnVSProtocol(p.portMappingProtocol,o.proto)&&0==p.portMappingEnabled&&1==o.enable&&(r=!0)}else if("ppp"==t){p=$.act(ACT_GET,WAN_PPP_CONN_PORTMAPPING,e,null,null);$.exe(),0==p.portMappingEnabled&&INCLUDE_USB_FTP_SERVER&&(l=checkConlictation(p.externalPort,p.X_TP_ExternalPortEnd,p.portMappingProtocol)),checkConflictPptpALGPort(p.externalPort,p.X_TP_ExternalPortEnd)&&"UDP"!=p.portMappingProtocol&&0==p.portMappingEnabled&&1==i.enable&&(a=!0),checkConflictOvpnVSPort(p.externalPort,p.X_TP_ExternalPortEnd,o.port)&&checkConflictOvpnVSProtocol(p.portMappingProtocol,o.proto)&&0==p.portMappingEnabled&&1==o.enable&&(r=!0)}else if("l2tp"==t){p=$.act(ACT_GET,WAN_L2TP_CONN_PORTMAPPING,e,null,null);$.exe(),0==p.portMappingEnabled&&INCLUDE_USB_FTP_SERVER&&(l=checkConlictation(p.externalPort,p.externalPortEnd,p.portMappingProtocol)),checkConflictPptpALGPort(p.externalPort,p.X_TP_ExternalPortEnd)&&"UDP"!=p.portMappingProtocol&&0==p.portMappingEnabled&&1==i.enable&&(a=!0),checkConflictOvpnVSPort(p.externalPort,p.X_TP_ExternalPortEnd,o.port)&&checkConflictOvpnVSProtocol(p.portMappingProtocol,o.proto)&&0==p.portMappingEnabled&&1==o.enable&&(r=!0)}else if("pptp"==t){p=$.act(ACT_GET,WAN_PPTP_CONN_PORTMAPPING,e,null,null);$.exe(),0==p.portMappingEnabled&&INCLUDE_USB_FTP_SERVER&&(l=checkConlictation(p.externalPort,p.externalPortEnd,p.portMappingProtocol)),checkConflictPptpALGPort(p.externalPort,p.X_TP_ExternalPortEnd)&&"UDP"!=p.portMappingProtocol&&0==p.portMappingEnabled&&1==i.enable&&(a=!0),checkConflictOvpnVSPort(p.externalPort,p.X_TP_ExternalPortEnd,o.port)&&checkConflictOvpnVSProtocol(p.portMappingProtocol,o.proto)&&0==p.portMappingEnabled&&1==o.enable&&(r=!0)}if(1==l.conflicted)$.confirm(l.noteStr,function(){1==l.ftp?$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]):1==l.sftp?$.act(ACT_SET,FTP_SERVER,null,null,["accessSftpFromInternet=0"]):1==l.http?$.act(ACT_SET,HTTP_CFG,null,null,["httpRemoteEnabled=0"]):1==l.https?$.act(ACT_SET,HTTP_CFG,null,null,["httpsRemoteEnabled=0"]):1==l.storageService?$.act(ACT_SET,STORAGE_HTTP,null,null,["accessFromInternet=0"]):1==l.cwmp&&$.act(ACT_SET,MANAGEMENT_SERVER,null,null,["enableCWMP=0"]),$.exe(),"ip"==t?0==p.portMappingEnabled?$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==p.portMappingEnabled&&$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"ppp"==t?0==p.portMappingEnabled?$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==p.portMappingEnabled&&$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"l2tp"==t?0==p.portMappingEnabled?$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==p.portMappingEnabled&&$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"pptp"==t&&(0==p.portMappingEnabled?$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==p.portMappingEnabled&&$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"])),$.exe(function(t){0==p.portMappingEnabled?$("#en_"+n).removeClass("disable-icon").addClass("enable-icon"):$("#en_"+n).addClass("disable-icon").removeClass("enable-icon")})},function(){1==p.portMappingEnabled?$("#en_"+n).removeClass("disable-icon").addClass("enable-icon"):$("#en_"+n).addClass("disable-icon").removeClass("enable-icon")});else{if(1==a)return $.alert(CMM_PVPN_PORT_CONFLICT_WITH_VS),void $.exe(function(){0==p.portMappingEnabled?$("#en_"+n).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+n).removeClass("disable-icon").addClass("enable-icon")});if(1==r)return $.alert(CMM_OVPN_PORT_CONFLICT_WITH_VS),void $.exe(function(){0==p.portMappingEnabled?$("#en_"+n).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+n).removeClass("disable-icon").addClass("enable-icon")});"ip"==t?0==p.portMappingEnabled?$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==p.portMappingEnabled&&$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"ppp"==t?0==p.portMappingEnabled?$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==p.portMappingEnabled&&$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"l2tp"==t?0==p.portMappingEnabled?$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==p.portMappingEnabled&&$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"pptp"==t&&(0==p.portMappingEnabled?$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==p.portMappingEnabled&&$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"])),$.exe(function(t){t?1==p.portMappingEnabled?$("#en_"+n).removeClass("disable-icon").addClass("enable-icon"):$("#en_"+n).addClass("disable-icon").removeClass("enable-icon"):0==p.portMappingEnabled?$("#en_"+n).removeClass("disable-icon").addClass("enable-icon"):$("#en_"+n).addClass("disable-icon").removeClass("enable-icon")})}}function doDel(t,e){"ip"==t?$.act(ACT_DEL,WAN_IP_CONN_PORTMAPPING,e,null):"ppp"==t?$.act(ACT_DEL,WAN_PPP_CONN_PORTMAPPING,e,null):"l2tp"==t?$.act(ACT_DEL,WAN_L2TP_CONN_PORTMAPPING,e,null):"pptp"==t&&$.act(ACT_DEL,WAN_PPTP_CONN_PORTMAPPING,e,null),$.exe(function(t){t||$.loadMain("virtualServer.htm")})}function isPort(t,e){var n,l;if("applyPort"==e)l="0123456789-";else if("interPort"==e){if(""==t)return!0;l="0123456789"}for(var a=0;a<t.length;a++)if(n=t.charAt(a),-1==l.indexOf(n))return!1;return(1==t.split("-").length||2==t.split("-").length)&&((2!=t.split("-").length||""!=t.split("-")[0])&&(2!=t.split("-").length||""!=t.split("-")[1]))}function checkConflictPptpALGPort(t,e){var n=!1;return 0==e?1723==t&&(n=!0):0==t?1723==e&&(n=!0):t<=1723&&1723<=e&&(n=!0),!!n}function checkConflictOvpnVSPort(t,e,n){var l=!1;return 0==e?n==t&&(l=!0):0==t?n==e&&(l=!0):t<=n&&n<=e&&(l=!0),!!l}function checkConflictOvpnVSProtocol(t,e){var n=!1;return"TCP or UDP"==t?n=!0:t==e&&(n=!0),!!n}function checkConflictFtpDataPort(t,e){var n=!1;return 0==e?59990<=t&&t<=59999&&(n=!0):0==t?59990<=e&&e<=59999&&(n=!0):59999<t||e<59990||(n=!0),!!n&&($.alert(ERR_FTP_DATA_PORT_CONFLICT),!0)}function protocolIsTcp(t){var e=!1;return"TCP"!=t&&"TCP or UDP"!=t||(e=!0),e}function checkConlictation(t,e,n){var l={conflicted:!1,ftp:!1,sftp:!1,http:!1,https:!1,storageService:!1,cwmp:!1,noteStr:""};return INCLUDE_USB_FTP_SERVER&&1==protocolIsTcp(n)&&1==checkConflictFtpPort(t,e)?(l.conflicted=!0,l.ftp=!0,l.noteStr=c_str.forwarding_ftp_conflict):INCLUDE_USB_SFTP_SERVER&&1==protocolIsTcp(n)&&1==checkConflictSFtpPort(t,e)?(l.conflicted=!0,l.sftp=!0,l.noteStr=c_str.forwarding_sftp_conflict):1==protocolIsTcp(n)&&1==checkConflictHttpPort(t,e)?(l.conflicted=!0,l.http=!0,l.noteStr=c_str.forwarding_http_conflict):INCLUDE_HTTP_SSL&&1==protocolIsTcp(n)&&1==checkConflictHttpsPort(t,e)?(l.conflicted=!0,l.https=!0,l.noteStr=c_str.forwarding_https_conflict):INCLUDE_STORAGE_HTTP_SERVICE&&1==protocolIsTcp(n)&&1==checkConflictHttpStorageServicePort(t,e)?(l.conflicted=!0,l.storageService=!0,l.noteStr=c_str.forwarding_storageHttp_conflict):INCLUDE_CWMP&&1==protocolIsTcp(n)&&1==checkConflictCWMPPort(t,e)&&(l.conflicted=!0,l.cwmp=!0,l.noteStr=c_str.forwarding_cwmp_conflict),l}function checkConflictFtpPort(t,e){var n=$.act(ACT_GET,FTP_SERVER,null,null,null);if(!$.exe()){if(1==n.enable&&1==n.accessFromInternet)if(0==t){if(n.portNumber==e)return!0}else if(0==e){if(n.portNumber==t)return!0}else if(t<=n.portNumber&&n.portNumber<=e)return!0;return!1}}function checkConflictSFtpPort(t,e){var n=$.act(ACT_GET,FTP_SERVER,null,null,null);if(!$.exe()){if(1==n.sftpEnable&&1==n.accessSftpFromInternet)if(0==t){if(n.SPortNumber==e)return!0}else if(0==e){if(n.SPortNumber==t)return!0}else if(t<=n.SPortNumber&&n.SPortNumber<=e)return!0;return!1}}function checkConflictHttpPort(t,e){var n=$.act(ACT_GET,HTTP_CFG,null,null,null);if(!$.exe()){if(1==n.httpRemoteEnabled){if(INCLUDE_HTTP_SSL&&1==n.httpsRemoteEnabled)return!1;if(0==t){if(n.httpRemotePort==e)return!0}else if(0==e){if(n.httpRemotePort==t)return!0}else if(t<=n.httpRemotePort&&n.httpRemotePort<=e)return!0}return!1}}function checkConflictHttpsPort(t,e){var n=$.act(ACT_GET,HTTP_CFG,null,null,null);if(!$.exe()){if(1==n.httpRemoteEnabled&&1==n.httpsRemoteEnabled)if(0==t){if(n.httpsRemotePort==e)return!0}else if(0==e){if(n.httpsRemotePort==t)return!0}else if(t<=n.httpsRemotePort&&n.httpsRemotePort<=e)return!0;return!1}}function checkConflictHttpStorageServicePort(t,e){var n=$.act(ACT_GET,STORAGE_HTTP,null,null,null);if(!$.exe()){if(1==n.enable&&1==n.accessFromInternet)if(0==t){if(n.httpsPortNumber==e)return!0}else if(0==e){if(n.httpsPortNumber==t)return!0}else if(t<=n.httpsPortNumber&&n.httpsPortNumber<=e)return!0;return!1}}function checkConflictCWMPPort(t,e){var n=$.act(ACT_GET,MANAGEMENT_SERVER,null,null,null);if(!$.exe()){if(1==n.enableCWMP)if(0==t){if(n.X_TP_ConnReqPort==e)return!0}else if(0==e){if(n.X_TP_ConnReqPort==t)return!0}else if(t<=n.X_TP_ConnReqPort&&n.X_TP_ConnReqPort<=e)return!0;return!1}}function initTable(){var r;selAll=0,index=0,param=[],allStk=[],allStkType=[],vtlServ_param=[],vtlServ_stack=[],vtlServ_stackType=[],vtlServ_stackIndex=0;var i=new Array,e=$.act(ACT_GL,WAN_IP_CONN_PORTMAPPING,null,null),n=$.act(ACT_GL,WAN_PPP_CONN_PORTMAPPING,null,null);if(INCLUDE_USB_3G_DONGLE)var l=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"]);if(INCLUDE_L2TP)var a=$.act(ACT_GL,WAN_L2TP_CONN_PORTMAPPING,null,null);if(INCLUDE_PPTP)var o=$.act(ACT_GL,WAN_PPTP_CONN_PORTMAPPING,null,null);if(INCLUDE_WAN_MODE){if(INCLUDE_3G4G_BACKUP)p=$.act(ACT_GET,SYS_MODE,null,null,["mode","lteBackupEnable"]);else if(INCLUDE_USB_3G_BACKUP&&INCLUDE_EWAN_BACKUP)var p=$.act(ACT_GET,SYS_MODE,null,null,["mode","usb3gBackup","ewanBackup"]);else var p=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"])}$.exe(function(t){if(!t){if(INCLUDE_USB_3G_DONGLE&&$.each(l,function(){if(1==this.enable)return this.backupEnable,!1}),INCLUDE_WAN_MODE){"ETH"==p.mode||p.mode,1==p.lteBackupEnable&&p.mode;INCLUDE_USB_3G_BACKUP&&INCLUDE_EWAN_BACKUP&&(p.ewanBackup,p.usb3gBackup)}return $.each(e,function(){r=this.__stack.split(",")[0]+","+this.__stack.split(",")[1]+","+this.__stack.split(",")[2]+",0,0,0";var t=$.act(ACT_GET,WAN_IP_CONN,r,null,["name"]),e=0;if(INCLUDE_WAN_MODE)$.act(ACT_GET,SYS_MODE,null,null,["mode"]),$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);$.exe()||(e=1),index++;var n="["+this.__stack+"]",l=0,a=0;l=0!=this.externalPort&&0==this.X_TP_ExternalPortEnd?this.externalPort:0==this.externalPort&&0!=this.X_TP_ExternalPortEnd?this.X_TP_ExternalPortEnd:this.externalPort==this.X_TP_ExternalPortEnd?this.externalPort:this.externalPort+"-"+this.X_TP_ExternalPortEnd,a=0!=this.internalPort&&0==this.X_TP_InternalPortEnd?this.internalPort:0==this.internalPort&&0!=this.X_TP_InternalPortEnd?this.X_TP_InternalPortEnd:this.internalPort==this.X_TP_InternalPortEnd?this.internalPort:this.internalPort+"-"+this.X_TP_InternalPortEnd,1==e&&t.name,allStk[index-1]=this.__stack,allStkType[index-1]="ip",1==this.portMappingEnabled?i.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:l,width:"10%"},{text:this.internalClient,width:"20%"},{text:a,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"ip\", "+n+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ip\", "+n+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ip\", "+n+");'></span>",width:"10%"}]):i.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:l,width:"10%"},{text:this.internalClient,width:"20%"},{text:a,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"ip\", "+n+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ip\", "+n+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ip\", "+n+");'></span>",width:"10%"}])}),$.each(n,function(){r=this.__stack.split(",")[0]+","+this.__stack.split(",")[1]+","+this.__stack.split(",")[2]+",0,0,0";var t=$.act(ACT_GET,WAN_PPP_CONN,r,null,["name"]),e=0;if(INCLUDE_WAN_MODE)$.act(ACT_GET,SYS_MODE,null,null,["mode"]),$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);$.exe()||(e=1),index++;var n="["+this.__stack+"]",l=0,a=0;l=0!=this.externalPort&&0==this.X_TP_ExternalPortEnd?this.externalPort:0==this.externalPort&&0!=this.X_TP_ExternalPortEnd?this.X_TP_ExternalPortEnd:this.externalPort==this.X_TP_ExternalPortEnd?this.externalPort:this.externalPort+"-"+this.X_TP_ExternalPortEnd,a=0!=this.internalPort&&0==this.X_TP_InternalPortEnd?this.internalPort:0==this.internalPort&&0!=this.X_TP_InternalPortEnd?this.X_TP_InternalPortEnd:this.internalPort==this.X_TP_InternalPortEnd?this.internalPort:this.internalPort+"-"+this.X_TP_InternalPortEnd,1==e&&t.name,allStk[index-1]=this.__stack,allStkType[index-1]="ppp",1==this.portMappingEnabled?i.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:l,width:"10%"},{text:this.internalClient,width:"20%"},{text:a,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"ppp\", "+n+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ppp\", "+n+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ppp\", "+n+");'></span>",width:"10%"}]):i.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:l,width:"10%"},{text:this.internalClient,width:"20%"},{text:a,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"ppp\", "+n+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ppp\", "+n+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ppp\", "+n+");'></span>",width:"10%"}])}),INCLUDE_L2TP&&$.each(a,function(){r=this.__stack.split(",")[0]+","+this.__stack.split(",")[1]+","+this.__stack.split(",")[2]+",0,0,0";var t=$.act(ACT_GET,WAN_L2TP_CONN,r,null,["name"]),e=0;$.exe()||(e=1);var n="["+this.__stack+"]";index++;var l=0,a=0;l=0!=this.externalPort&&0==this.externalPortEnd?this.externalPort:0==this.externalPort&&0!=this.externalPortEnd?this.externalPortEnd:this.externalPort==this.externalPortEnd?this.externalPort:this.externalPort+"-"+this.externalPortEnd,a=0!=this.internalPort&&0==this.internalPortEnd?this.internalPort:0==this.internalPort&&0!=this.internalPortEnd?this.internalPortEnd:this.internalPort==this.internalPortEnd?this.internalPort:this.internalPort+"-"+this.internalPortEnd,1==e&&t.name,allStk[index-1]=this.__stack,allStkType[index-1]="l2tp",1==this.portMappingEnabled?i.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:l,width:"10%"},{text:this.internalClient,width:"20%"},{text:a,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"l2tp\", "+n+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"l2tp\", "+n+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"l2tp\", "+n+");'></span>",width:"10%"}]):i.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:l,width:"10%"},{text:this.internalClient,width:"20%"},{text:a,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"l2tp\", "+n+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"l2tp\", "+n+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"l2tp\", "+n+");'></span>",width:"10%"}])}),INCLUDE_PPTP&&$.each(o,function(){r=this.__stack.split(",")[0]+","+this.__stack.split(",")[1]+","+this.__stack.split(",")[2]+",0,0,0";var t=$.act(ACT_GET,WAN_PPTP_CONN,r,null,["name"]),e=0;$.exe()||(e=1);var n="["+this.__stack+"]";index++;var l=0,a=0;l=0!=this.externalPort&&0==this.externalPortEnd?this.externalPort:0==this.externalPort&&0!=this.externalPortEnd?this.externalPortEnd:this.externalPort==this.externalPortEnd?this.externalPort:this.externalPort+"-"+this.externalPortEnd,a=0!=this.internalPort&&0==this.internalPortEnd?this.internalPort:0==this.internalPort&&0!=this.internalPortEnd?this.internalPortEnd:this.internalPort==this.internalPortEnd?this.internalPort:this.internalPort+"-"+this.internalPortEnd,1==e&&t.name,1==this.portMappingEnabled?i.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:l,width:"10%"},{text:this.internalClient,width:"20%"},{text:a,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"pptp\", "+n+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"pptp\", "+n+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"pptp\", "+n+");'></span>",width:"10%"}]):i.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:l,width:"10%"},{text:this.internalClient,width:"20%"},{text:a,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"pptp\", "+n+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"pptp\", "+n+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"pptp\", "+n+");'></span>",width:"10%"}]),allStk[index-1]=this.__stack,allStkType[index-1]="pptp"}),$.initTableBody($("#table-virtual"),i),i}})}function initServiceTable(){for(var t=new Array,e=0;e<serviceArray.length;e++){var n=e+1;t.push([{text:n,width:"30%"},{text:serviceArray[e][0],width:"40%"},{text:"<span class='choose' >"+s_str.choose+"</span>",width:"30%"}])}$.initTableBody($("#table-service"),t),$("span.choose").click(function(){var t=$(this).parents("tr").find("td:eq(1)").text(),e=$(this).parents("tr").find("td:eq(0)").text();0<e&&t==serviceArray[e-1][0]&&($("#serName").prop("value",serviceArray[e-1][0]),$("#applyPort").prop("value",serviceArray[e-1][1]),$("#interPort").prop("value",serviceArray[e-1][2]),$("#accessDevList").fadeOut(200,function(){$("#accessDevList").removeClass("on-mask msg-container").addClass("nd")}),$("#mask").hide())})}function selectAll(){var t;for(t=0;t<allStk.length;t++)$("#checkbox_st").prop("data-checked")?$("#"+(t+1)).prop("checked",!0):$("#"+(t+1)).prop("checked",!1);$("#checkbox_st").prop("checked",$("#checkbox_st").prop("data-checked")),$.each($("input.checkbox-checkbox"),function(){$(this).data("tpCheckbox").refresh()})}$("#view").click(function(){0==$("#mask").length&&$("body").append('<div id="mask" class="mask"></div>'),$("#accessDevList").fadeIn(200,function(){$("#accessDevList").removeClass("nd").addClass("on-mask msg-container"),$.setFixedCentral($("#accessDevList"))}),$("#mask").show()}),$("#closeDeviceList").click(function(){$("#accessDevList").fadeOut(200,function(){$("#accessDevList").removeClass("on-mask msg-container").addClass("nd")}),$("#mask").hide()}),$("#cancel").click(function(){curType=" ";for(var t=editFlag=0;t<curStk.length;t++)curStk[t]=-1;$.loadMain("virtualServer.htm")}),$("#add").click(function(){initIntf(),editFlag=2}),$("#delAll").click(function(){vtlServ_stack=[],vtlServ_stackType=[],vtlServ_stackIndex=index;for(var t=0;t<vtlServ_stackIndex;t++)vtlServ_stack[t]=allStk[t],vtlServ_stackType[t]=allStkType[t];for(var e=0;e<vtlServ_stackIndex;e++)$("#"+(e+1)).prop("data-checked")&&("ip"==vtlServ_stackType[e]?$.act(ACT_DEL,WAN_IP_CONN_PORTMAPPING,vtlServ_stack[e],null):"ppp"==vtlServ_stackType[e]?$.act(ACT_DEL,WAN_PPP_CONN_PORTMAPPING,vtlServ_stack[e],null):"l2tp"==vtlServ_stackType[e]?$.act(ACT_DEL,WAN_L2TP_CONN_PORTMAPPING,vtlServ_stack[e],null):"pptp"==vtlServ_stackType[e]&&$.act(ACT_DEL,WAN_PPTP_CONN_PORTMAPPING,vtlServ_stack[e],null));0<vtlServ_stackIndex&&$.exe(function(t){t||$.loadMain("virtualServer.htm")})}),$("#ok").click(function(){var n=$("#wanInf").data("value").split(":")[0],l=$("#wanInf").data("value").split(":")[1],t=!1,a={},e=!1,r=!1;if($.ifip($("#ipAddr").tpAddress("val"),!0))return $.alert(ERR_IP_FORMAT),$("#ipAddr").tpAddress("focus"),!1;var i={};if(i.internalClient=$.ip2ip($("#ipAddr").tpAddress("val")),i.portMappingProtocol=$("#protol").data("value"),i.serviceName=$("#serName").prop("value"),i.portMappingEnabled=$("#vtlServ_en").prop("data-checked")?1:0,""==$("#applyPort").prop("value")||!isPort($("#applyPort").prop("value"),"applyPort"))return $.alert(ERR_VS_PORT_INVAD),(P=$("#applyPort"))&&(P.focus(),P.select()),!1;var o=$("#applyPort").prop("value");if("l2tp"==n||"pptp"==n){if(1==o.split("-").length?(i.externalPort=parseInt(o,10),i.externalPortEnd=parseInt(o,10)):o.split("-")[0]>o.split("-")[1]?(i.externalPort=parseInt(o.split("-")[1],10),i.externalPortEnd=parseInt(o.split("-")[0],10)):(i.externalPort=parseInt(o.split("-")[0],10),i.externalPortEnd=parseInt(o.split("-")[1],10)),INCLUDE_USB_FTP_SERVER&&"UDP"!=i.portMappingProtocol)if(checkConflictFtpDataPort(i.externalPort,i.externalPortEnd))return(P=$("#applyPort"))&&(P.focus(),P.select()),!1;i.portMappingEnabled&&(t=(a=checkConlictation(i.externalPort,i.externalPortEnd,i.portMappingProtocol)).conflicted),"UDP"!=i.portMappingProtocol&&i.portMappingEnabled&&checkConflictPptpALGPort(i.externalPort,i.externalPortEnd)&&(curPvpnObj=$.act(ACT_GET,PPTPVPN,null,null),$.exe(),1==curPvpnObj.enable&&(e=!0));var p=$.act(ACT_GET,OPENVPN,null,null);if($.exe())return!1;i.portMappingEnabled&&1==p.enable&&checkConflictOvpnVSPort(i.externalPort,i.externalPortEnd,p.port)&&checkConflictOvpnVSProtocol(i.portMappingProtocol,p.proto)&&(r=!0)}else{var P;if(1==o.split("-").length?(i.externalPort=parseInt(o,10),i.X_TP_ExternalPortEnd=parseInt(o,10)):o.split("-")[0]>o.split("-")[1]?(i.externalPort=parseInt(o.split("-")[1],10),i.X_TP_ExternalPortEnd=parseInt(o.split("-")[0],10)):(i.externalPort=parseInt(o.split("-")[0],10),i.X_TP_ExternalPortEnd=parseInt(o.split("-")[1],10)),INCLUDE_USB_FTP_SERVER&&"UDP"!=i.portMappingProtocol)if(checkConflictFtpDataPort(i.externalPort,i.X_TP_ExternalPortEnd))return(P=$("#applyPort"))&&(P.focus(),P.select()),!1;i.portMappingEnabled&&(t=(a=checkConlictation(i.externalPort,i.externalPortEnd,i.portMappingProtocol)).conflicted),"UDP"!=i.portMappingProtocol&&i.portMappingEnabled&&checkConflictPptpALGPort(i.externalPort,i.externalPortEnd)&&(curPvpnObj=$.act(ACT_GET,PPTPVPN,null,null),$.exe(),1==curPvpnObj.enable&&(e=!0));p=$.act(ACT_GET,OPENVPN,null,null);if($.exe())return!1;i.portMappingEnabled&&1==p.enable&&checkConflictOvpnVSPort(i.externalPort,i.externalPortEnd,p.port)&&checkConflictOvpnVSProtocol(i.portMappingProtocol,p.proto)&&(r=!0)}if(!isPort($("#interPort").prop("value"),"interPort"))return $.alert(ERR_VS_INTER_PORT_INVAD),(P=$("#interPort"))&&(P.focus(),P.select()),!1;if(t)$.confirm(a.noteStr,function(){if(1==a.ftp?$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]):1==a.sftp?$.act(ACT_SET,FTP_SERVER,null,null,["accessSftpFromInternet=0"]):1==a.http?$.act(ACT_SET,HTTP_CFG,null,null,["httpRemoteEnabled=0"]):1==a.https?$.act(ACT_SET,HTTP_CFG,null,null,["httpsRemoteEnabled=0"]):1==a.storageService?$.act(ACT_SET,STORAGE_HTTP,null,null,["accessFromInternet=0"]):1==a.cwmp&&$.act(ACT_SET,MANAGEMENT_SERVER,null,null,["enableCWMP=0"]),$.exe(),"l2tp"==n||"pptp"==n?""!=$("#interPort").prop("value")?i.internalPort=i.internalPortEnd=$("#interPort").prop("value"):(i.internalPort=i.externalPort,i.internalPortEnd=i.externalPortEnd):""!=$("#interPort").prop("value")?i.internalPort=i.X_TP_InternalPortEnd=$("#interPort").prop("value"):(i.internalPort=i.externalPort,i.X_TP_InternalPortEnd=i.X_TP_ExternalPortEnd),2==editFlag)"ip"==n?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,l,i):"ppp"==n?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,l,i):"l2tp"==n?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,l,i):"pptp"==n&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,l,i),$.exe(function(t){t||$.loadMain("virtualServer.htm")});else if(1==editFlag){var e=curType;wanInfName==$("#wanInf").data("text")?("ip"==e?$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,curStk,null,i):"ppp"==e?$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,curStk,null,i):"l2tp"==e?$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,curStk,null,i):"pptp"==e&&$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,curStk,null,i),$.exe(function(t){t||$.loadMain("virtualServer.htm")})):("ip"==e?$.act(ACT_DEL,WAN_IP_CONN_PORTMAPPING,curStk,null):"ppp"==e?$.act(ACT_DEL,WAN_PPP_CONN_PORTMAPPING,curStk,null):"l2tp"==e?$.act(ACT_DEL,WAN_L2TP_CONN_PORTMAPPING,curStk,null):"pptp"==e&&$.act(ACT_DEL,WAN_PPTP_CONN_PORTMAPPING,curStk,null),$.exe(function(t){t||("ip"==n?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,l,i):"ppp"==n?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,l,i):"l2tp"==n?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,l,i):"pptp"==n&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,l,i),$.exe(function(t){t?(i.portMappingEnabled=vtlServCfg.portMappingEnabled,i.externalPort=vtlServCfg.externalPort,i.internalPort=vtlServCfg.internalPort,i.internalClient=vtlServCfg.internalClient,"l2tp"==n||"pptp"==n?(i.externalPortEnd=vtlServCfg.externalPortEnd,i.internalPortEnd=vtlServCfg.internalPortEnd):(i.X_TP_ExternalPortEnd=vtlServCfg.X_TP_ExternalPortEnd,i.X_TP_InternalPortEnd=vtlServCfg.X_TP_InternalPortEnd),"ip"==e?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,pStk,i):"ppp"==e?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,pStk,i):"l2tp"==e?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,pStk,i):"pptp"==e&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,pStk,i),$.exe()):$.loadMain("virtualServer.htm")}))}))}});else{if(1==e)return $.alert(CMM_PVPN_PORT_CONFLICT_WITH_VS),void $.exe(function(){0==i.portMappingEnabled?$("#en_"+index).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+index).removeClass("disable-icon").addClass("enable-icon")});if(1==r)return $.alert(CMM_OVPN_PORT_CONFLICT_WITH_VS),void $.exe(function(){0==i.portMappingEnabled?$("#en_"+index).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+index).removeClass("disable-icon").addClass("enable-icon")});if("l2tp"==n||"pptp"==n?""!=$("#interPort").prop("value")?i.internalPort=i.internalPortEnd=$("#interPort").prop("value"):(i.internalPort=i.externalPort,i.internalPortEnd=i.externalPortEnd):""!=$("#interPort").prop("value")?i.internalPort=i.X_TP_InternalPortEnd=$("#interPort").prop("value"):(i.internalPort=i.externalPort,i.X_TP_InternalPortEnd=i.X_TP_ExternalPortEnd),2==editFlag)"ip"==n?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,l,i):"ppp"==n?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,l,i):"l2tp"==n?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,l,i):"pptp"==n&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,l,i),$.exe(function(t){t||$.loadMain("virtualServer.htm")});else if(1==editFlag){var _=curType;wanInfName==$("#wanInf").data("text")?("ip"==_?$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,curStk,null,i):"ppp"==_?$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,curStk,null,i):"l2tp"==_?$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,curStk,null,i):"pptp"==_&&$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,curStk,null,i),$.exe(function(t){t||$.loadMain("virtualServer.htm")})):("ip"==_?$.act(ACT_DEL,WAN_IP_CONN_PORTMAPPING,curStk,null):"ppp"==_?$.act(ACT_DEL,WAN_PPP_CONN_PORTMAPPING,curStk,null):"l2tp"==_?$.act(ACT_DEL,WAN_L2TP_CONN_PORTMAPPING,curStk,null):"pptp"==_&&$.act(ACT_DEL,WAN_PPTP_CONN_PORTMAPPING,curStk,null),$.exe(function(t){t||("ip"==n?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,l,i):"ppp"==n?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,l,i):"l2tp"==n?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,l,i):"pptp"==n&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,l,i),$.exe(function(t){t?(i.portMappingEnabled=vtlServCfg.portMappingEnabled,i.externalPort=vtlServCfg.externalPort,i.internalPort=vtlServCfg.internalPort,i.internalClient=vtlServCfg.internalClient,"l2tp"==n||"pptp"==n?(i.externalPortEnd=vtlServCfg.externalPortEnd,i.internalPortEnd=vtlServCfg.internalPortEnd):(i.X_TP_ExternalPortEnd=vtlServCfg.X_TP_ExternalPortEnd,i.X_TP_InternalPortEnd=vtlServCfg.X_TP_InternalPortEnd),"ip"==_?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,pStk,i):"ppp"==_?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,pStk,i):"l2tp"==_?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,pStk,i):"pptp"==_&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,pStk,i),$.exe()):$.loadMain("virtualServer.htm")}))}))}}})</script>
<h3 id="et">Virtual Server</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span id="add" class="add-icon"></span>
                <label class="T_add">Add</label>
                <span id="delAll" class="delete-all-icon"></span>
                <label class="T_del">Delete</label>
            </div>
        </div>
        <table id="table-virtual">
            <thead></thead>
            <tbody id="body-virtual">
                <tr id="edit-container-virtual" class="nd">
                    <td colspan="9">
                        <p class="cfg-line" id="t_note">Note: Virtual Server setup is supported only when there is available interface. Ports used by Remote Management or CWMP will not work.</p>
                        <div class="part-separate-m nd">
                            <b class="T_intfname tr-s">Interface Name:</b>
                            <select class="xl" id="wanInf">
                            </select>
                        </div>
                        <div>
                            <b class="T_servname tr-s">Service Name:</b>
                            <input class="xl" type="text" maxlength="15" id="serName" oninput="$.maxlength(this)">
                            <button type="submit" class="blue T_scan" id="view">View Existing Applications</button>
                        </div>
                        <div>
                            <b class="T_exterport tr-s">External Port:</b>
                            <input class="xl" type="text" id="applyPort">
                            <span id="t_iprange">(XX-XX or XX)</span>
                        </div>
                        <div>
                            <b class="T_interip tr-s">Internal IP:</b>
                            <input class="xl ip-address" type="text" id="ipAddr">
                        </div>
                        <div>
                            <b class="T_interport tr-s">Internal Port:</b>
                            <input class="xl" type="text" id="interPort">
                            <div style="display:inline-block;width:180px;vertical-align:middle;line-height:14px"><span id="t_port">(XX)</span></div>
                        </div>
                        <b class="T_proto tr-s">Protocol:</b>
                        <select class="xl" id="protol">
                            <option value="TCP" id="TCP">TCP</option>
                            <option value="UDP" id="UDP">UDP</option>
                            <option value="TCP or UDP" class="T_all" id="ALL">ALL</option>
                        </select>
                        <div>
                            <b class="tr-s"></b>
                            <input class="xl" type="checkbox" id="vtlServ_en" checked="checked">
                            <label class="T_enthisentry">Enable this Entry</label>
                        </div>
                        <div class="inline-btn-right">
                            <button type="submit" class="green T_cancel" id="cancel">Cancel</button>
                            <button type="submit" class="green T_save" id="ok">Save</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</div>
<div>
    <form class="pure-form pure-form-aligned">
        <div id="accessDevList" class="nd">
            <div id="closeDeviceList" class="table-op">
                <div class="panel-title">
                    <span id="t_existServices"></span>
                </div>
                <div class="table-btn">
                    <span class="close-icon table-icon"></span>
                </div>
            </div>
            <table id="table-service">
                <thead></thead>
                <tbody id="bodyAccessDevicesList">
                </tbody>
            </table>
        </div>
    </form>
</div>
<script>var headArray=[{text:'<div><input type="checkbox" id="checkbox_st" class="table-select-all" /><label></label></div>',width:"5%"},{text:table_str.id,width:"5%"},{text:table_str.servname,width:"10%"},{text:table_str.exterport,width:"20%"},{text:table_str.interip,width:"20%"},{text:table_str.interport,width:"10%"},{text:table_str.protocol,width:"10%"},{text:table_str.status,width:"10%"},{text:table_str.modify,width:"15%"}],AccessDevicesListHeadArray=[{text:table_str.id,width:"15%"},{text:table_str.servname,width:"40%"},{text:table_str.operation,width:"45%"}];$.initTableHead($("#table-virtual"),headArray),$("#table-virtual").tpTable(initTable),$.initTableHead($("#table-service"),AccessDevicesListHeadArray),$("#table-service").tpTable(initServiceTable),$.tpInit()</script>
