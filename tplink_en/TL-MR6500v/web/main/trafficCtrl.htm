<script language="javascript">var tcEntry,tcRuleList,guestnetObj,guestnetObj5g,upstreamCurrRate,downstreamCurrRate,wanDslStatus,tcRuleEntryIndex,ewanEnable,dslEnable;function init(){var t,e;if(tcRuleList=$.act(ACT_GL,TC_RULE,null,null),tcEntry=$.act(ACT_GET,TC,null,null),INCLUDE_LAN_WLAN_GUESTNETWORK){var n=$.act(ACT_GL,LAN_WLAN,null,null,["X_TP_Band"]);$.exe()||($.each(n,function(){"2.4GHz"==this.X_TP_Band?t=this:INCLUDE_LAN_WLAN_DUALBAND&&"5GHz"==this.X_TP_Band&&(e=this)}),guestnetObj=$.act(ACT_GET,LAN_WLAN_GUESTNET,t.__stack,null,null),INCLUDE_LAN_WLAN_DUALBAND&&(guestnetObj5g=$.act(ACT_GET,LAN_WLAN_GUESTNET,e.__stack,null,null)))}$.exe()||(initType(),initTc(),initRuleTable(),INCLUDE_LAN_WLAN_GUESTNETWORK&&initTcRuleTableForGN())}function initType(){var t,e,n=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);(dslEnable=ewanEnable=!1,$.exe())||$.each(n,function(){"DSL"==this.WANAccessType?t=this.__stack:"Ethernet"==this.WANAccessType&&(e=this.__stack)});var a=$.act(ACT_GET,WAN_DSL_INTF_CFG,t,null,["enable","status","upstreamCurrRate","downstreamCurrRate"]);$.exe()||(wanDslStatus=a.status,dslEnable=a.enable,"Up"==a.status&&($("#curDslUp").removeClass("nd"),$("#curDslDown").removeClass("nd"),$("#upStreamCurrRate").prop("value",a.upstreamCurrRate+" "+s_str.kbps),$("#downStreamCurrRate").prop("value",a.downstreamCurrRate+" "+s_str.kbps)));var l=$.act(ACT_GET,WAN_ETH_INTF,e,null,["enable"]);$.exe()||(ewanEnable=l.enable),upstreamCurrRate=a.upstreamCurrRate,downstreamCurrRate=a.downstreamCurrRate}function initRuleTable(){var t=[{text:'<div><input type="checkbox" id="tcAll" class="table-select-all" /><label></label></div>',width:"10%"},{text:table_str.descpt,width:"35%"},{text:table_str.priority,width:"5%"},{text:table_str.upbw,width:"15%"},{text:table_str.downbw,width:"15%"},{text:table_str.status,width:"10%"},{text:table_str.modify,width:"10%"}];$.initTableHead($("#tcTable"),t),$("#tcTable").tpTable(initRuleTableBody)}function initRuleTableBody(){var a=0,l=new Array,i="";return $.each(tcRuleList,function(){if(0==this.ruleType){var t="";0==this.startIP&&0==this.endIP?t="":0==this.startIP&&0!=this.endIP?t=$.num2ip(parseInt(this.endIP,10)):0!=this.startIP&&0==this.endIP?t=$.num2ip(parseInt(this.startIP,10)):this.startIP==this.endIP?t=$.num2ip(parseInt(this.startIP,10)):0!=this.startIP&&0!=this.endIP&&(t=$.num2ip(parseInt(this.startIP,10))+"-"+$.num2ip(parseInt(this.endIP,10)));var e="";0==this.startPort&&0==this.endPort?e="":0==this.startPort&&0!=this.endPort?e=this.endPort:0!=this.startPort&&0==this.endPort?e=this.startPort:this.startPort==this.endPort?e=this.startPort:0!=this.startPort&&0!=this.endPort&&(e=this.startPort+"-"+this.endPort);var n="";0==this.protocol?n="<span class='T_all'>"+s_str.all+"</span>":6==this.protocol?n="TCP":17==this.protocol&&(n="UDP"),""!=t?i=t:""!=e?i=e:""!=n&&(i=n),l.push([{text:'<div><input type="checkbox" id="tcCheckbox'+a+'" class="table-select-one" /><label></label></div>',width:"10%"},{text:i,width:"35%"},{text:this.precedence,width:"5%"},{text:(0==this.upMinBW?"":this.upMinBW)+"/"+(0==this.upMaxBW?"":this.upMaxBW)+" "+s_str.kbps,width:"15%"},{text:(0==this.downMinBW?"":this.downMinBW)+"/"+(0==this.downMaxBW?"":this.downMaxBW)+" "+s_str.kbps,width:"15%"},{text:1==this.enable?"<span class='table-grid-icon enable-icon' onClick='disableTcClk("+a+")'></span>":"<span class='table-grid-icon disable-icon' onClick='enableTcClk("+a+")'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' onClick='doTcEdit("+a+")'></span><span class='table-grid-icon edit-trash-icon' id='del_"+a+"' onclick='doTcDel("+a+");'></span>",width:"10%"}])}a++}),$.initTableBody($("#tcTable"),l),$.tablePages($("#tcTable"),8),l}function initTcRuleTableForGN(){var t=[{text:table_str.ssid,width:"35%"},{text:table_str.priority,width:"5%"},{text:table_str.upbw,width:"20%"},{text:table_str.downbw,width:"20%"},{text:"status",width:""}];$.initTableHead($("#guestTcTable"),t),$("#guestTcTable").tpTable(initTcRuleTableBodyForGN)}function initTcRuleTableBodyForGN(){var t,e=new Array,n="Unknown";return $.each(tcRuleList,function(){1==this.enable&&1==this.ruleType&&(t=$.act(ACT_GL,LAN_WLAN_MSSIDENTRY,null,null,["name","SSID"]),$.exe()||(this.id==guestnetObj.TCRuleID?$.each(t,function(){this.name==guestnetObj.name&&(n=this.SSID)}):this.id==guestnetObj5g.TCRuleID&&$.each(t,function(){this.name==guestnetObj5g.name&&(n=this.SSID)})),e.push([{text:n,width:"35%"},{text:this.precedence,width:"5%"},{text:(0==this.upMinBW?"":this.upMinBW)+"/"+(0==this.upMaxBW?"":this.upMaxBW)+" "+s_str.kbps,width:"15%"},{text:(0==this.downMinBW?"":this.downMinBW)+"/"+(0==this.downMaxBW?"":this.downMaxBW)+" "+s_str.kbps,width:"15%"},{text:1==this.enable?"Enabled":"Disabled",width:""}])),0}),$.initTableBody($("#guestTcTable"),e),e}function initTc(){INCLUDE_QOS?($("#tcHeader").addClass("nd"),$("#tcEnableBox").addClass("nd"),$("#tcCont").addClass("nd"),$("#saveBtn").addClass("nd")):($("#enableTc").prop("checked",0!=tcEntry.enable),0==tcEntry.enable&&$("#tcCont").addClass("nd"),$("#adsl_type").prop("checked",1==tcEntry.linkType),$("#other_type").prop("checked",0==tcEntry.linkType),$("#upTotalBW").val(0==tcEntry.upTotalBW?"":tcEntry.upTotalBW),$("#downTotalBW").val(0==tcEntry.downTotalBW?"":tcEntry.downTotalBW)),INCLUDE_IPTV&&1==dslEnable&&($("#iptvTcCont").removeClass("nd"),1==tcEntry.iptvEnable?($("#enableIptvTc").prop("checked",!0),$("#iptv_elem").removeClass("nd")):($("#enableIptvTc").prop("checked",!1),$("#iptv_elem").addClass("nd")),$("#iptvUpMinBW").val(0==tcEntry.iptvUpMinBW?"":tcEntry.iptvUpMinBW),$("#iptvDownMinBW").val(0==tcEntry.iptvDownMinBW?"":tcEntry.iptvDownMinBW)),INCLUDE_VOIP&&($("#voipTcCont").removeClass("nd"),$("#enableVoIPTc").prop("checked",1==tcEntry.voIPEnable)),INCLUDE_LAN_WLAN_GUESTNETWORK&&(1==guestnetObj.TCEnable&&1==guestnetObj.enable||INCLUDE_LAN_WLAN_DUALBAND&&1==guestnetObj5g.TCEnable&&1==guestnetObj5g.enable?$("#guestTcCont").removeClass("nd"):$("#guestTcCont").addClass("nd"))}function doSave(){var t={};if(INCLUDE_QOS)t.enable=tcEntry.enable,t.upTotalBW=tcEntry.upTotalBW,t.downTotalBW=tcEntry.upTotalBW,t.linkType=tcEntry.linkType;else if(t.enable=1==$("#enableTc").prop("data-checked")?3:0,0!=t.enable){if("Up"==wanDslStatus){if(parseInt($("#upTotalBW").val(),10)>upstreamCurrRate)return $.alert(ERR_TC_BW_UP_LARGER,upstreamCurrRate),$("#upTotalBW").focus(),$("#upTotalBW").select(),!1;if(parseInt($("#downTotalBW").val(),10)>downstreamCurrRate)return $.alert(ERR_TC_BW_DOWN_LARGER,downstreamCurrRate),$("#downTotalBW").focus(),$("#downTotalBW").select(),!1}if(""==$("#upTotalBW").val()||!$.isnum($("#upTotalBW").val())||0==$("#upTotalBW").val())return $.alert(ERR_TC_NUM_INVAD),$("#upTotalBW").focus(),$("#upTotalBW").select(),!1;if(""==$("#downTotalBW").val()||!$.isnum($("#downTotalBW").val())||0==$("#downTotalBW").val())return $.alert(ERR_TC_NUM_INVAD),$("#downTotalBW").focus(),$("#downTotalBW").select(),!1;t.upTotalBW=parseInt($("#upTotalBW").val(),10),t.downTotalBW=parseInt($("#downTotalBW").val(),10),t.linkType=1==$("#adsl_type").prop("checked")?1:0}if(0!=t.enable){if(INCLUDE_IPTV&&(t.iptvEnable=1==$("#enableIptvTc").prop("data-checked")?1:0,0!=t.iptvEnable)){if(1==(1&t.enable)&&(""==$("#iptvUpMinBW").val()||!$.isnum($("#iptvUpMinBW").val())||0==parseInt($("#iptvUpMinBW").val(),10)))return $.alert(ERR_TC_NUM_INVAD),$("#iptvUpMinBW").focus(),$("#iptvUpMinBW").select(),!1;if(2==(2&t.enable)&&(""==$("#iptvDownMinBW").val()||!$.isnum($("#iptvDownMinBW").val())||0==parseInt($("#iptvDownMinBW").val(),10)))return $.alert(ERR_TC_NUM_INVAD),$("#iptvDownMinBW").focus(),$("#iptvDownMinBW").select(),!1;t.iptvUpMinBW=parseInt($("#iptvUpMinBW").val(),10),t.iptvDownMinBW=parseInt($("#iptvDownMinBW").val(),10)}if(INCLUDE_VOIP&&(t.voIPEnable=1==$("#enableVoIPTc").prop("data-checked")?1:0),INCLUDE_IPTV&&INCLUDE_VOIP&&1==$("#enableTc").prop("data-checked")&&1==$("#enableIptvTc").prop("data-checked")&&1==$("#enableVoIPTc").prop("data-checked")&&parseInt($("#iptvUpMinBW").val(),10)>=parseInt($("#upTotalBW").val(),10))return $.alert(CMM_TC_UP_TOTAL_BW),$("#iptvUpMinBW").focus(),$("#iptvUpMinBW").select(),!1}$.act(ACT_SET,TC,null,null,t),$.exe(function(t){t||($.removeLoading(),$.reload())})}function doTcEdit(t){isEdit=1,tcRuleEntryIndex=t,$.loadPage("tcEditPage","trafCtrlEdit.htm")}function doTcDel(t){$.act(ACT_DEL,TC_RULE,tcRuleList[t].__stack,null),$.exe(function(t){t||$.reload()})}function enableTcClk(t){$.act(ACT_SET,TC_RULE,tcRuleList[t].__stack,null,["enable=1"]),$.exe()||$.reload()}function disableTcClk(t){$.act(ACT_SET,TC_RULE,tcRuleList[t].__stack,null,["enable=0"]),$.exe()||$.reload()}function clickTcRuleAdd(){isEdit=0,$.loadPage("tcEditPage","trafCtrlEdit.htm")}function clickTcRuleDel(){for(var t=0,e=0;e<tcRuleList.length;e++){if(0==tcRuleList[e].ruleType)if($("#tcCheckbox"+e).prop("data-checked")){t=1;break}}t&&$.confirm(c_str.del_choosed,function(){for(var t=0;t<tcRuleList.length;t++)if(0==tcRuleList[t].ruleType){var e=$("#tcCheckbox"+t);e.prop("data-checked")&&(e.parents("tr").first().remove(),$.act(ACT_DEL,TC_RULE,tcRuleList[t].__stack,null),$.exe(function(t){t||$.reload()}))}})}function clickToSet(t,e){$.act(ACT_SET,TC,null,null,t),$.exe()||(null!=e&&(null!=t.enable&&1<=t.enable||null!=t.iptvEnable&&1<=t.iptvEnable?e.removeClass("nd"):e.addClass("nd")),$.removeLoading(),$.reload())}function clickToShow(t,e){null!=e&&(t?e.removeClass("nd"):e.addClass("nd"))}$("#enableTc").on("click",function(){clickToShow($("#enableTc").prop("data-checked"),$("#tcCont"))}),$("#enableIptvTc").on("click",function(){clickToShow($("#enableIptvTc").prop("data-checked"),$("#iptv_elem"))}),$("#enableVoIPTc").on("click",function(){}),$("#editOK").on("click",function(){$.addLoading($(this)),doSave()})</script>
<div id="tcHeader">
    <h3 id="et">Bandwidth Control</h3>
</div>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div id="tcEnableBox">
            <b class="xxl" id="t_en">Bandwidth Control:</b>
            <input type="checkbox" id="enableTc">
            <label class="T_enable">Enable</label>
        </div>
        <div id="tcCont">
            <div>
                <b class="xxl" id="t_type">Line Type:</b>
                <input type="radio" id="adsl_type" name="lineTypeRadio">
                <label>ADSL</label>
                <input type="radio" id="other_type" name="lineTypeRadio">
                <label id="t_other">Other</label>
            </div>
            <div class="pure-control-group nd" id="curDslUp">
                <b class="xxl" id="t_dslUp">Current Up Stream Rate:</b>
                <input type="text" readonly="true" class="tp-input-text xxxl" id="upStreamCurrRate">
            </div>
            <div class="pure-control-group nd" id="curDslDown">
                <b class="xxl" id="t_dslDown">Current Down Stream Rate:</b>
                <input type="text" readonly="true" class="tp-input-text xxxl" id="downStreamCurrRate">
            </div>
            <div>
                <b class="xxl" id="t_tup">Total Upstream Bandwidth:</b>
                <input type="text" id="upTotalBW" maxlength="7">
                <span class="T_kbps">Kbps</span>
            </div>
            <div>
                <b class="xxl" id="t_tdown">Total Downstream Bandwidth:</b>
                <input type="text" id="downTotalBW" maxlength="7">
                <span class="T_kbps">Kbps</span>
            </div>
            <div id="iptvTcCont" class="nd">
                <div class="button-group-container">
                    <b class="xxl" id="t_graiptvon">IPTV Bandwidth Guarantee:</b>
                    <input type="checkbox" id="enableIptvTc">
                    <label class="T_enable">Enable</label>
                </div>
                <div id="iptv_elem" class="nd">
                    <div>
                        <b class="xxl" id="t_upgrabd">Upstream Bandwidth Guarantee:</b>
                        <input type="text" id="iptvUpMinBW">
                        <span class="T_kbps">Kbps</span>
                    </div>
                    <div>
                        <b class="xxl" id="t_downgrabd">Downstream Bandwidth Guarantee:</b>
                        <input type="text" id="iptvDownMinBW">
                        <span class="T_kbps">Kbps</span>
                    </div>
                </div>
            </div>
            <div id="voipTcCont" class="nd">
                <div>
                    <b class="xxl" id="t_enVoip">VoIP Bandwidth Guarantee:</b>
                    <input type="checkbox" id="enableVoIPTc">
                    <label class="T_enable">Enable</label>
                </div>
            </div>
        </div>
        <div id="saveBtn">
            <p class="br"></p>
            <div class="btn-right">
                <button type="submit" class="green T_save" id="editOK">Save</button>
            </div>
        </div>
    </form>
    <p class="br"></p>
    <h3 id="t_rule">Bandwidth Rules</h3>
    <div class="content-container">
        <form class="pure-form pure-form-aligned">
            <div class="table-op">
                <div class="table-note">
                </div>
                <div class="table-btn">
                    <span class="add-icon" id="tcRuleAddBtn" onclick="clickTcRuleAdd()"></span>
                    <label class="T_add">Add</label>
                    <span class="delete-icon" id="tcRuleDelBtn" onclick="clickTcRuleDel()"></span>
                    <label class="T_del">Delete</label>
                </div>
            </div>
            <table id="tcTable">
                <thead></thead>
                <tbody id="tcTableBody">
                    <tr id="tcTableEdit" class="nd">
                        <td colspan="7">
                            <div id="tcEditPage"></div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </form>
    </div>
    <div id="guestTcCont" class="nd">
        <p class="br"></p>
        <h3 id="t_guest_rule">Guest Network Bandwidth Rules</h3>
        <div class="content-container">
            <form class="pure-form pure-form-aligned">
                <table id="guestTcTable">
                    <thead></thead>
                    <tbody id="guestTcTableBody">
                        <tr id="guestTcTableEdit" class="nd">
                            <td colspan="5">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </form>
        </div>
    </div>
</div>
<script>$(document).ready(function(){$.tpInit(init)})</script>
