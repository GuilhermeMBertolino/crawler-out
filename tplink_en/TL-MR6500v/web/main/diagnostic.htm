<script language="javascript">var strPass="<span class='green'>"+m_str.pass+"</span>",strFail="<span class='red'>"+m_str.fail+"</span>",wanAccessType=INCLUDE_LTEWAN?"LTE":"",intfCfgStack="",wanConnStack="",wanType="",bStart=!1,step=0,currDslType=INCLUDE_VDSLWAN?"vdsl":"adsl",STATUS_INIT=0,STATUS_PHY_LINK_CHECK=1,STATUS_WAN_CONN_CHECK=2,STATUS_NCSI_CHECK=3,STATUS_DONE=4,status=STATUS_INIT;if(INCLUDE_USB_3G_DONGLE)var usb3gLinkCfg={};if(INCLUDE_WISP_WAN)var wispLinkCfg={};var internetDiagId=$.getAsync();if(INCLUDE_LTEWAN)var lteLinkCfgStk="",lteLinkCfg={},lteWanCfg={},lteIntfCfg={};function diagnosticInit(){var t=$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]),e=($.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]),$.act(ACT_GL,WAN_IP_CONN,null,null,["Name","AddressingType"])),s=$.act(ACT_GL,WAN_PPP_CONN,null,null,["Name"]),n=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);if(INCLUDE_IPV6)var a=$.act(ACT_GET,L3_IP6_FORWARDING,null,null,["__ifAliasName"]);if(INCLUDE_ADSLWAN)var i=INCLUDE_VDSLWAN?$.act(ACT_GL,WAN_DSL_INTF_CFG,null,null,["LinkEncapsulationUsed"]):{};var _=!1;if(INCLUDE_PPTP)var l=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["Name"]);if(INCLUDE_L2TP)var c=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["Name"]);if(INCLUDE_WAN_MODE)var r=$.act(ACT_GET,SYS_MODE,null,null,["Mode"]);if(INCLUDE_USB_3G_DONGLE)var T=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["Enable","CardName"]);if(INCLUDE_LTEWAN)var C=$.act(ACT_GL,WAN_LTE_LINK_CFG,null,null,["Enable","NetworkType","SimStatus","SignalStrength","connectStatus"]);if(INCLUDE_WISP_WAN)var o=$.act(ACT_GL,WAN_WISP_INTF,null,null,["enable","status"]);return!$.exe()&&($.each(e,function(){if(this.name==t.__ifAliasName||INCLUDE_IPV6&&this.name==a.__ifAliasName)return wanConnStack=this.__stack,intfCfgStack=$.stkPop(wanConnStack,2),wanType="ip",!(_=!0)}),$.each(s,function(){if(this.name==t.__ifAliasName||INCLUDE_IPV6&&this.name==a.__ifAliasName)return wanConnStack=this.__stack,intfCfgStack=$.stkPop(wanConnStack,2),wanType="ppp",!(_=!0)}),INCLUDE_PPTP&&0==_&&$.each(l,function(){if(this.name==t.__ifAliasName)return wanConnStack=this.__stack,intfCfgStack=$.stkPop(wanConnStack,2),wanType="pptp",!(_=!0)}),INCLUDE_L2TP&&0==_&&$.each(c,function(){if(this.name==t.__ifAliasName)return wanConnStack=this.__stack,intfCfgStack=$.stkPop(wanConnStack,2),wanType="l2tp",!(_=!0)}),0==_?(INCLUDE_WAN_MODE&&("DSL"==r.mode?wanAccessType="DSL":"ETH"==r.mode?wanAccessType="Ethernet":INCLUDE_USB_3G_DONGLE&&"USB_3G"==r.mode?wanAccessType="USB_3G":INCLUDE_LTEWAN&&"LTE"==r.mode?wanAccessType="LTE":INCLUDE_WISP_WAN&&"WISP"==r.mode&&(wanAccessType="WISP")),$.each(n,function(){if(this.WANAccessType==wanAccessType)return intfCfgStack=this.__stack,!1})):$.each(n,function(){if(this.__stack==intfCfgStack)return wanAccessType=this.WANAccessType,intfCfgStack=this.__stack,!1}),"DSL"==wanAccessType?INCLUDE_VDSLWAN&&$.each(i,function(){this.__stack==intfCfgStack&&("G.992.3_Annex_K_ATM"==this.linkEncapsulationUsed?currDslType="adsl":"G.993.2_Annex_K_PTM"==this.linkEncapsulationUsed&&(currDslType="vdsl"))}):"Ethernet"==wanAccessType?intfCfgStack=$.stkPop(wanConnStack,1):INCLUDE_USB_3G_DONGLE&&"USB_3G"==wanAccessType?$.each(T,function(){if(1==this.enable&&$.stkPop(this.__stack,1)==intfCfgStack)return usb3gLinkCfg=this,!1}):INCLUDE_LTEWAN&&"LTE"==wanAccessType?$.each(C,function(){if(1==this.enable&&$.stkPop(this.__stack,1)==intfCfgStack)return lteLinkCfgStk=this.__stack,!1}):INCLUDE_WISP_WAN&&"WISP"==wanAccessType&&$.each(o,function(){if(1==this.enable)return wispLinkCfg=this,!1}),!0)}function insNewRow(t,e){var s=$("#display_table").get(0).insertRow(-1),n={};s.style.backgroundColor="#F5F5F5",(n=s.insertCell(-1)).width="20px",$.h(n,""),(n=s.insertCell(-1)).width="300px",$.h(n,t),(n=s.insertCell(-1)).width="200px","waiting..."==e?$(n).append("<span class='diag-loading-icon' style='background: url(../img/loading.gif); height: 20px; width: 20px; display: inline-block;'></span>"):$.h(n,e)}function disResult(t){var e=$("#display_table").get(0),s=e.rows[e.rows.length-1],n=s.cells[s.cells.length-1];$("span.diag-loading-icon").remove(),$.h(n,t)}function doErr(t){$("#p_note").removeClass("nd"),$("#errNote").html(t)}function diagDone(){insNewRow(s_str.diag_end,""),$("#GetTime").prop("disabled",!1),$.unlock()}function doInternetDiag(){if(INCLUDE_ADSLWAN&&"DSL"==wanAccessType)var e={};var s={},n={},a="",i={},_="";if($.checkAsync(internetDiagId))switch(step){case 0:var t=function(t){t?$.alert(t):INCLUDE_LTEWAN&&"LTE"==wanAccessType?3==lteLinkCfg.simStatus||5==lteLinkCfg.simStatus?(disResult(strPass),step++,doInternetDiag()):(_=0==lteLinkCfg.simStatus?s_str.lteNoSimOrErr:1==lteLinkCfg.simStatus?s_str.lteNoSim:2==lteLinkCfg.simStatus?s_str.lteSimErr:4==lteLinkCfg.simStatus?s_str.ltePinLocked:6==lteLinkCfg.simStatus?s_str.ltePukLocked:7==lteLinkCfg.simStatus?s_str.lteSimLockedForever:s_str.lteOtherSimErr,disResult(strFail),doErr(_),diagDone()):("DSL"==wanAccessType?a=e.status:"Ethernet"==wanAccessType?a=s.ethernetLinkStatus:INCLUDE_USB_3G_DONGLE&&"USB_3G"==wanAccessType?a="":INCLUDE_WISP_WAN&&"WISP"==wanAccessType&&(a=wispLinkCfg.status),"Up"==a?(disResult(strPass),step++,doInternetDiag()):"DSL"==wanAccessType?"NoSignal"==a?(disResult(strFail),doErr(s_str.dslSyncFail),diagDone()):setTimeout(doInternetDiag,1e3):"Ethernet"==wanAccessType?(disResult(strFail),doErr(s_str.ethNoLink),diagDone()):INCLUDE_USB_3G_DONGLE&&"USB_3G"==wanAccessType?"Unplugged"==usb3gLinkCfg.cardName||"Unknown"==usb3gLinkCfg.cardName?(disResult(strFail),doErr(s_str.usb3gUnplugged),diagDone()):"Identifying..."==usb3gLinkCfg.cardName?setTimeout(doInternetDiag,1e3):(disResult(strPass),step++,doInternetDiag()):INCLUDE_WISP_WAN&&"WISP"==wanAccessType&&(disResult(strFail),doErr(s_str.wispNoLink),diagDone()))};status==STATUS_INIT&&("DSL"==wanAccessType?insNewRow(s_str.diag_dsl,"waiting..."):"Ethernet"==wanAccessType?insNewRow(s_str.diag_eth,"waiting..."):INCLUDE_USB_3G_DONGLE&&"USB_3G"==wanAccessType?insNewRow("","waiting..."):INCLUDE_LTEWAN&&"LTE"==wanAccessType?insNewRow(s_str.diag_lte,"waiting..."):INCLUDE_WISP_WAN&&"WISP"==wanAccessType&&insNewRow("","waiting..."),status=STATUS_PHY_LINK_CHECK),"DSL"==wanAccessType?(e=$.act(ACT_GET,WAN_DSL_INTF_CFG,intfCfgStack,null,["Status"]),$.exe(t)):"Ethernet"==wanAccessType?(s=$.act(ACT_GET,WAN_ETH_LINK_CFG,intfCfgStack,null,["EthernetLinkStatus"]),$.exe(t)):INCLUDE_USB_3G_DONGLE&&"USB_3G"==wanAccessType?(usb3gLinkCfg=$.act(ACT_GET,WAN_USB_3G_LINK_CFG,usb3gLinkCfg.__stack,null,["CardName"]),$.exe(t)):INCLUDE_LTEWAN&&"LTE"==wanAccessType?(lteLinkCfg=$.act(ACT_GET,WAN_LTE_LINK_CFG,lteLinkCfgStk,null,["SimStatus"]),$.exe(t)):INCLUDE_WISP_WAN&&"WISP"==wanAccessType&&(wispLinkCfg=$.act(ACT_GET,WAN_WISP_INTF,wispLinkCfg.__stack,null,["enable","status"]),$.exe(t));break;case 1:if(status==STATUS_PHY_LINK_CHECK&&(insNewRow(s_str.diag_wan,"waiting..."),status=STATUS_WAN_CONN_CHECK),INCLUDE_LTEWAN&&"LTE"==wanAccessType)lteLinkCfg=$.act(ACT_GET,WAN_LTE_LINK_CFG,lteLinkCfgStk,null,["networkType","roamingStatus","connectStatus","signalStrength"]),lteWanCfg=$.act(ACT_GET,LTE_WAN_CFG,lteLinkCfgStk,null,["dataSwitchStatus","networkPreferredMode","roamingEnabled"]),lteIntfCfg=$.act(ACT_GET,WAN_LTE_INTF_CFG,intfCfgStack,null,["dataLimit"]),$.exe(function(t){t?$.alert(t):2==lteLinkCfg.connectStatus||3==lteLinkCfg.connectStatus?setTimeout(doInternetDiag,1e3):4==lteLinkCfg.connectStatus?(disResult(strPass),step++,doInternetDiag()):(_=1!=lteWanCfg.dataSwitchStatus?s_str.lteDataSwtDis:2==lteIntfCfg.dataLimit?s_str.lteDataOverUsed:1==lteIntfCfg.roamingStatus&&1!=lteIntfCfg.roamingEnabled?s_str.lteRoamingDis:0==lteLinkCfg.signalStrength?s_str.lteNoSignalStrength:0==lteLinkCfg.networkType?s_str.lteModeErr:s_str.lteOtherFail,disResult(strFail),diagDone(),doErr(_))});else{if("ppp"==wanType)n=$.act(ACT_GET,WAN_PPP_CONN,wanConnStack,null,["LastConnectionError","ConnectionStatus","X_TP_IPv6ConnStatus"]);else if("ip"==wanType)n=$.act(ACT_GET,WAN_IP_CONN,wanConnStack,null,["ConnectionStatus","X_TP_IPv6ConnStatus"]);else if(INCLUDE_PPTP&&"pptp"==wanType)n=$.act(ACT_GET,WAN_PPTP_CONN,wanConnStack,null,["ConnectionStatus"]);else{if(!INCLUDE_PPTP||"l2tp"!=wanType)return disResult(strFail),diagDone(),void doErr(s_str.noAvaiIntf);n=$.act(ACT_GET,WAN_L2TP_CONN,wanConnStack,null,["ConnectionStatus"])}$.exe(function(t){t?$.alert(t):"Connected"==n.connectionStatus||("ip"==wanType||"ppp"==wanType)&&"Connected"==n.X_TP_IPv6ConnStatus?(disResult(strPass),step++,doInternetDiag()):"Connecting"==n.connectionStatus?setTimeout(doInternetDiag,1e3):(disResult(strFail),diagDone(),"ppp"==wanType?"ERROR_ISP_TIME_OUT"==n.lastConnectionError?"DSL"==wanAccessType?"adsl"==currDslType?doErr(s_str.adslPppTimeout):"vdsl"==currDslType&&doErr(s_str.vdslPppTimeout):"Ethernet"!=wanAccessType&&"WISP"!=wanAccessType||doErr(s_str.ethPppTimeout):"ERROR_AUTHENTICATION_FAILURE"==n.lastConnectionError?"DSL"==wanAccessType||"Ethernet"==wanAccessType||"WISP"==wanAccessType?doErr(s_str.pppAuthFail):INCLUDE_USB_3G_DONGLE&&"USB_3G"==wanAccessType&&doErr(s_str.usb3gAuthFail):"DSL"==wanAccessType||"Ethernet"==wanAccessType||"WISP"==wanAccessType?doErr(s_str.pppOtherFail):INCLUDE_USB_3G_DONGLE&&"USB_3G"==wanAccessType&&doErr(s_str.usb3gOtherFail):INCLUDE_USB_3G_DONGLE&&"DHCP4G"==n.X_TP_TransportType?doErr(s_str.usb3gOtherFail):"DSL"==wanAccessType?"adsl"==currDslType?doErr(s_str.adslPppTimeout):"vdsl"==currDslType&&doErr(s_str.vdslPppTimeout):"Ethernet"!=wanAccessType&&"WISP"!=wanAccessType||doErr(s_str.ethPppTimeout))})}break;case 2:status==STATUS_WAN_CONN_CHECK&&(insNewRow(s_str.diag_ncsi,"waiting..."),status=STATUS_NCSI_CHECK),i=$.act(ACT_GET,DIAG_TOOL,null,null,["LastResult"]),$.exe(function(t){t?$.alert(t):3==i.lastResult?setTimeout(doInternetDiag,1e3):1==bStart?(1==i.lastResult?disResult(strPass):(disResult(strFail),4==i.lastResult?INCLUDE_LTEWAN&&"LTE"==wanAccessType?doErr(s_str.lteOtherFail):doErr(s_str.dnsDiagFail):doErr(s_str.diagOtherFail)),diagDone()):(bStart=!0,$.act(ACT_OP,ACT_OP_DIAG_STARTDIAG,i.__stack),$.exe(function(t){t?$.alert(t):setTimeout(doInternetDiag,1e3)}))})}}function doStart(){for(var t=$("#display_table").get(0);0<t.rows.length;)t.deleteRow(-1);step=0,status=STATUS_INIT,bStart=!1,$("#p_note").addClass("nd"),$.lock(),$("#GetTime").prop("disabled",!0),doInternetDiag()}</script>
<h3 id="et">Diagnostic Tools</h3>
<div class="content-container">
	<form class="pure-form pure-form-aligned">
		<span id="t_info">The Internet connection status of this device can be tested on this page.</span>
		<button type="submit" class="blue T_start" id="GetTime">Start</button>
		<p class="br"></p>
		<div class="M tbody bdr ts" style="height:320px;overflow-y:scroll;background-color:#f5f5f5">
			<table id="display_table" cellspacing="0" cellpadding="0" class="tbody M"></table>
		</div>
	</form>
	<p id="p_note" class="nd"><span id="t_note" style="vertical-align:baseline;color:#4d4d4d">Note: </span><span id="errNote" style="vertical-align:baseline"></span></p>
</div>
<script language="javascript">var disTbl=$("#display_table").get(0),newRow=disTbl.insertRow(-1),newCell={};diagnosticInit(),INCLUDE_USB_3G_DONGLE&&"USB_3G"==wanAccessType&&$("#GetTime").prop("disabled",!0),INCLUDE_AP_MODE&&"AP"==$.sysMode&&$("#GetTime").prop("disabled",!0),$("#GetTime").click(doStart)</script>
