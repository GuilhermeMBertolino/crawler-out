<script>var voipUsbVoiceMail,voipUsbVoiceMailList,usbVStaus,usbVDevCap,usbVMailCapAvail,curLine,voipCallingFeaturesList,usbMailCapAvail,ITEM_PER_PAGE=100,goPageth=1,cfgLine=[],cfgList=[],clrFwd=[],urlArray=[],itemIndexArray=[];function enterCheck(){var a,i,e,t;try{e="Remote Access PIN",i=$("#vmPinNum1"),t="vmPinNum1",a=getValue(t,e,4,4),i.get(0).value=a,checkNum(i,e),e="Voice Duration Limit",i=$("#eachRD"),t="eachRD",a=getNumValue1(t,e,20,120),i.get(0).value=a}catch(a){if(!1===a)return!1;throw a}}function doPlayNotify(){var a=document.createElement("a");void 0===a.click?location.href="":(0==$("#selectNotify1").data("value")?a.href="/voicemail/voiceNotify/recNotifyDef_g711u.wav":a.href="/voicemail/voiceNotify/recNotifyCustom_g711u.wav",a.target="_blank",document.body.appendChild(a),a.click())}function doDownload(a,i){var e=document.createElement("a");void 0===e.click?location.href="":(e.href=urlArray[a]+"?storage="+i+"&download",e.target="_blank",document.body.appendChild(e),e.click())}function doPlay(a,i){var e=document.createElement("a");void 0===e.click?location.href="":(e.href=urlArray[a]+"?storage="+i+"&play",e.target="_blank",document.body.appendChild(e),e.click())}function doDel(a,i,e){$.addLoading($(this)),urlArray.splice(e,1);var t=a+"_"+i,l=$.act(ACT_GL,XTP_VOICE_PROCESS_STS,null,null,["usbVoiceUsingRecordedFile"]);if(0==$.exe())if(0==l[0].usbVoiceUsingRecordedFile){for(var s={op:"del",delString:""},n=0;n<usbMailList.length;){var o=usbMailList[n].split(",\r\n");o[0]+"_"+o[3]===t&&(s.delString+=t+",",900<s.delString.length&&($.cgi("/main/voice_usbmail.cgi",s,null),s.delString="")),n++}0<s.delString.length&&$.cgi("/main/voice_usbmail.cgi",s,null),$.removeLoading(),$.reload()}else $.alert(ERR_VOIP_USB_BUSY_ERROR)}function freshTable(a){var o=new Array;if(!a){var i=$.act(ACT_GL,XTP_USB_VOICEMAIL_PUBLICCFG,null,null,["usbStatus"]);if(0!=$.exe())return;i[0].usbStatus;var e={op:"get",lineToDis:4294967295};if(e.ITEM_PER_PAGE=ITEM_PER_PAGE,e.goPageth=goPageth,$.cgi("/main/voice_usbmail.cgi",e,null),null==usbMailString)return;usbMailList=usbMailString.split(";\r\n\r\n");var t=usbMailList.pop();0!=t.length&&usbMailList.push(t)}$("#table-mail").find("tbody tr:not(.nd)").remove();var c=0,d="";itemIndexArray=[];var r=[];$.each(usbMailList,function(){datalist=this.split(",\r\n");var a=10,i=0,e="",t="",l=datalist[0]+"_"+datalist[3];for(itemIndexArray.push(l),i=0;i<datalist[1].length/a;i++)e+=datalist[1].slice(i*a,(i+1)*a);for(e+=datalist[1].slice(i*a),i=0;i<datalist[2].length/a;i++)t+=datalist[2].slice(i*a,(i+1)*a);t+=datalist[2].slice(i*a);var s=1==datalist[9]?$.tpLang.voice_usbmail_nstr.t_usb:$.tpLang.voice_usbmail_nstr.t_flash;if("1"==datalist[6]){"1"==datalist[7]?r[c]=1:r[c]=0;var n=datalist[8].replace(/ /g,"%20").replace(/'/g,"%27").replace(/\+/g,"%2B");d="/voicemail/record/"+n,urlArray.push(d),o.push([{text:s,width:"5%"},{text:datalist[4],width:"30%"},{text:e,width:"20%"},{text:t,width:"20%"},{text:datalist[5],width:"10%"},{text:"<span class='table-grid-icon play-icon' id='play_"+c+"' onclick='doPlay("+c+","+datalist[9]+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+c+"' onclick='doDel("+datalist[0]+", "+datalist[3]+", "+c+");'></span><span class='table-grid-icon edit-dl-icon' id='dl_"+c+"' onclick='doDownload("+c+","+datalist[9]+");'></span>",width:"15%"}])}else"1"==datalist[7]?r[c]=1:r[c]=0,o.push([{text:s,width:"5%"},{text:datalist[4],width:"30%"},{text:e,width:"20%"},{text:t,width:"20%"},{text:datalist[5],width:"10%"},{text:"<span class='table-grid-icon noplay-icon' id='play_"+c+"'></span><span class='table-grid-icon edit-trash-icon' id='del_"+c+"' onclick='doDel();'></span><span class='table-grid-icon edit-nodl-icon' id='dl_"+c+"'></span>",width:"15%"}]);c++}),$.initTableBody($("#table-mail"),o),$.tablePages($("#table-mail"),8);var l=$("#table-mail").find("tbody tr");return $.each(r,function(a){1==this||l.eq(a).find("td").css({"font-weight":"bold"})}),o}function freshConfigStatus(){if(voipUsbVoiceMailList=$.act(ACT_GL,XTP_USB_VOICEMAIL_PUBLICCFG,null,null,["usbStatus","usbDevCapacity"]),0==$.exe())if(usbVStaus=voipUsbVoiceMailList[0].usbStatus,usbVDevCap=voipUsbVoiceMailList[0].usbDevCapacity,$.cgi("/main/voice_usbmail_cap.cgi",null,null),usbVMailCapAvail=usbMailCapAvail,$("#id_USBVM_cap").addClass("nd"),$("#t_noUSB").addClass("nd"),$("#t_notEnough").addClass("nd"),$("#t_noConfig").addClass("nd"),"0"==usbVStaus)$("#t_noUSB").removeClass("nd");else if("2"==usbVStaus)$("#t_noConfig").removeClass("nd");else{$("#id_USBVM_cap").removeClass("nd");var a="(3-"+usbVDevCap+"MB)";$("#usbCap").html(a),"0"==usbVMailCapAvail&&$("#t_notEnough").removeClass("nd")}}function initTable(){handsetList=$.act(ACT_GL,VOICE_PROF_LINE,null,null,["X_TP_PhoneName","X_TP_PhoneType"]),0==$.exe()&&freshTable()}function init(){if(voipCallingFeaturesList=$.act(ACT_GL,VOICE_PROF_LINE_CALLFEAT,null,null,["X_TP_UsbVoiceEnable","X_TP_CallForwardUnconditionalStart","X_TP_CallForwardOnBusyStart","X_TP_CallForwardOnNoAnswerStart"]),cfgList=$.act(ACT_GL,VOICE_PROF_LINE_XTPUSBVM,null,null,["UsbCustomNotify","UsbSelectNotify","UsbVoiceMailPinNum"]),voipUsbVoiceMailList=$.act(ACT_GL,XTP_USB_VOICEMAIL_PUBLICCFG,null,null,["usbStatus","usbDevCapacity","usbVoiceNotify","usbVoiceGlobalWav","usbVoiceDeleteExpired","usbVoiceExpiredDays","usbVoiceRecordDuration","usbVoiceMailCapacity"]),0==$.exe()){voipUsbVoiceMail=voipUsbVoiceMailList[0],usbVStaus=voipUsbVoiceMail.usbStatus,usbVDevCap=voipUsbVoiceMail.usbDevCapacity,$("#eachRD").prop("value",voipUsbVoiceMail.usbVoiceRecordDuration),$("#vmCap").prop("value",voipUsbVoiceMail.usbVoiceMailCapacity),2==voipCallingFeaturesList[0].X_TP_UsbVoiceEnable?($("#t_on").addClass("selected"),$("#t_off").removeClass("selected")):($("#t_off").addClass("selected"),$("#t_on").removeClass("selected"));var a=1024*voipUsbVoiceMail.usbVoiceMailCapacityAvail,i=Math.floor(a/28800),e=Math.floor((a-60*i*60*8)/480),t=showtype[7],l="<span style='color: #96cc56; vertical-align: bottom;'>",s="</span>",n=l+i+s+" "+s_str.hours+" "+l+e+s+" "+s_str.minute,o=typeArray[5];$("#usbCapRange").html(t.replace("%",n)).append(" ").append(o),$.cgi("/main/voice_usbmail_cap.cgi",null,null),usbVMailCapAvail=usbMailCapAvail,$("#id_USBVM_cap").addClass("nd"),$("#t_noUSB").addClass("nd"),$("#t_notEnough").addClass("nd"),$("#t_noConfig").addClass("nd"),"0"==usbVStaus?$("#t_noUSB").removeClass("nd"):"2"==usbVStaus?$("#t_noConfig").removeClass("nd"):($("#id_USBVM_cap").removeClass("nd"),"0"==usbVMailCapAvail&&$("#t_notEnough").removeClass("nd"));$('#selectNotify1 option[value="'+cfgList[0].usbSelectNotify+'"]').prop("selected","selected"),$("#selectNotify1").tpSelect({refresh:1}),$("#vmPinNum1").prop("value",cfgList[0].usbVoiceMailPinNum),$.auto(freshConfigStatus,VOICE_FRESH_TIME,!0)}}$("#fresh").click(function(){$.reload()}),$("#t_on").click(function(){$.addLoading($(this));var a={X_TP_CallForwardUnconditionalStart:0,X_TP_CallForwardOnNoAnswerStart:0,X_TP_UsbVoiceEnable:2};$.each(voipCallingFeaturesList,function(){$.act(ACT_SET,VOICE_PROF_LINE_CALLFEAT,this.__stack,null,a)}),actForSendMsg(),$.exe(function(a){$.removeLoading(),a||$.reload()})}),$("#t_off").click(function(){$.addLoading($(this));var a={X_TP_UsbVoiceEnable:0};$.each(voipCallingFeaturesList,function(){$.act(ACT_SET,VOICE_PROF_LINE_CALLFEAT,this.__stack,null,a)}),actForSendMsg(),$.exe(function(a){$.removeLoading(),a||$.reload()})}),$("#t_save").click(function(){if($.addLoading($(this)),0!=enterCheck()){var a={},i={};a.usbVoiceRecordDuration=$("#eachRD").prop("value"),i.usbVoiceMailPinNum=$("#vmPinNum1").prop("value"),i.usbSelectNotify=$("#selectNotify1").data("value"),$.each(cfgList,function(){$.act(ACT_SET,VOICE_PROF_LINE_XTPUSBVM,this.__stack,null,i)}),$.act(ACT_SET,XTP_USB_VOICEMAIL_PUBLICCFG,voipUsbVoiceMailList[0].__stack,null,a),actForSendMsg(),$.exe(function(a){$.removeLoading(),a||$.reload()})}}),$("#delAll").click(function(){$.confirm(c_str.voice_del_allcon,function(){$.addLoading($(this));var a=$.act(ACT_GL,XTP_VOICE_PROCESS_STS,null,null,["usbVoiceUsingRecordedFile"]);if(0==$.exe())if(0==a[0].usbVoiceUsingRecordedFile){for(var i={op:"del",delString:""},e=0;e<itemIndexArray.length;e++)for(var t=0;t<usbMailList.length;t++){var l=usbMailList[t].split(",\r\n");l[0]+"_"+l[3]==itemIndexArray[e]&&(i.delString+=itemIndexArray[e]+",",900<i.delString.length&&($.cgi("/main/voice_usbmail.cgi",i,null),i.delString=""))}0<i.delString.length&&$.cgi("/main/voice_usbmail.cgi",i,null),$.removeLoading(),$.reload()}else $.alert(ERR_VOIP_USB_BUSY_ERROR)})})</script>
<h3 class="T" id="t_et">USB Voice Mail Configuration</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div>
            <p class="cfg-line nd" id="t_note">NOTE: Please fresh this page when USB hotplug happened!</p>
            <p class="cfg-line nd" class="red" id="t_noUSB">USB Mass storage Disconnected!</p>
            <p class="cfg-line nd" class="red" id="t_noConfig">There is no proper files in USB Mass storage.</p>
            <p class="cfg-line nd" class="red" id="t_notEnough">USB MailBox Capacity avaliable is not enough!</p>
        </div>
        <div class="button-group-container">
            <b class="xxl T" id="t_usbmail">USB Voice Mail:</b>
            <ul>
                <li>
                    <button id="t_on" class="fst" value="on">On</button>
                </li>
                <li>
                    <button id="t_off" class="lst" value="off">Off</button>
                </li>
            </ul>
        </div>
        <div class="nd">
        <div>
            <b class="xxl" id="t_notify">Voice Notify for Record:</b>
            <select class="inline l" id="selectNotify1">
                <option class="T" id="t_def" value="0">default</option>
                <option class="T" id="t_custom" value="1">custom</option>
            </select>
            <span>1</span>
            <span class="table-grid-icon play-icon inline" id="play_notify" onclick="doPlayNotify()"></span>
        </div>
		<div>
			<p class="cfg-line T" id="t_pinInfo">Pick up the phone (Analog Phone or DECT handset) and dial *30 to record a voice notify.</p>
		</div>
        <div>
            <b class="xxl" id="t_rPIN">Remote Access PIN:</b>
            <input type="text" maxlength="10" id="vmPinNum1" value="0000">
        </div>
		<div>
			<p class="cfg-line T" id="t_pinInfo1">To listen to the voice messages remotely, please dial this phone number, press * when you hear the voice notify, and then follow the voice prompt to enter the Remote Access PIN.</p>
        </div>
        <div>
            <b class="xxl" id="t_duration">Voice Duration:</b>
            <input type="text" id="eachRD" value="20">
            <span class="textbox-tips">(20-120s)</span>
        </div>
        <div id="id_USBVM_cap">
            <b class="xxl" id="t_usbCapText">USB MailBox Capacity</b>
            <input type="text" id="vmCap" value="128">
            <span class="textbox-tips" id="usbCap">(0-0MB)</span>
        </div>
            <p id="usbCapRange" class="cfg-line"></p>
        <button type="submit" id="t_save" class="green T_save">Save</button>
        </div>
    </form>
</div>
<h3 class="T" id="t_et1">USB Voice Mail List</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span class="refresh-icon" id="fresh"></span>
                <label class="T T_refresh">Refresh</label>
                <span id="delAll" class="delete-all-icon"></span>
                <label class="T_delall">Delete All</label>
            </div>
        </div>
        <table id="table-mail">
            <thead></thead>
            <tbody></tbody>
        </table>
    </form>
</div>
<script>var headArray=[{text:table_str.position,width:"5%"},{text:table_str.logdate,width:"30%"},{text:table_str.usbinnum,width:"20%"},{text:table_str.telnumber,width:"20%"},{text:table_str.logdur,width:"10%"},{text:table_str.sett,width:"15%"}];$.tpInit(init),$.initTableHead($("#table-mail"),headArray),$("#table-mail").tpTable(initTable)</script>
