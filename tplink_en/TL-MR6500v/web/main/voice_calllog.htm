<script>var debug1,callLogString,callLogList,lineList,freshFlag,voipX_TP_CalllogCfg,voipAccounts,telContacts,processMask=0,processUnkown=!1,mailCfg={},CMLOG_IDLE=0,CMLOG_VOIP=8,CMLOG_INCOMING=9,CMLOG_CONNECTED=10,CMLOG_CONF=11,CMLOG_VOIP2VOIP_FWD_UNCON=12,CMLOG_VOIP2VOIP_FWD_BUSY=13,CMLOG_VOIP2VOIP_FWD_NOANS=14,CMLOG_VOIP_TRANS_VOIP=15,CMLOG_VOIP2PSTN_FWD_UNCON=16,CMLOG_VOIP2PSTN_FWD_BUSY=17,CMLOG_VOIP2PSTN_FWD_NOANS=18,CMLOG_VOIP2PSTN_GATE1=19,CMLOG_VOIP2PSTN_GATE2=20,CMLOG_VOIP_TRANS_PSTN=21,CMLOG_PSTN2VOIP_FWD_UNCON=22,CMLOG_PSTN2VOIP_FWD_BUSY=23,CMLOG_PSTN2VOIP_FWD_NOANS=24,CMLOG_PSTN_TRANS_VOIP=25,CMLOG_REMOTE_FORWARD=26,CMLOG_OUTGOING_REMOTE_TRANSFER=27,CMLOG_INCOMING_REMOTE_TRANSFER=28,CMLOG_UNKNOWN_REMOTE_TRANSFER=29,CMLOG_BOTH_OUTGOING=30,CMLOG_CALLING_CALLED_SWITCHED=31,CALLLOG_FWDUNCON_MASK=1<<CMLOG_VOIP2VOIP_FWD_UNCON|1<<CMLOG_VOIP2PSTN_FWD_UNCON|1<<CMLOG_PSTN2VOIP_FWD_UNCON,CALLLOG_FWDBUSY_MASK=1<<CMLOG_VOIP2VOIP_FWD_BUSY|1<<CMLOG_VOIP2PSTN_FWD_BUSY|1<<CMLOG_PSTN2VOIP_FWD_BUSY,CALLLOG_FWDNOANS_MASK=1<<CMLOG_VOIP2VOIP_FWD_NOANS|1<<CMLOG_VOIP2PSTN_FWD_NOANS|1<<CMLOG_PSTN2VOIP_FWD_NOANS,CALLLOG_FORWARD_MASK=CALLLOG_FWDUNCON_MASK|CALLLOG_FWDBUSY_MASK|CALLLOG_FWDNOANS_MASK|1<<CMLOG_VOIP2PSTN_GATE1|1<<CMLOG_VOIP2PSTN_GATE2,CALLLOG_TRANSFER_MASK=1<<CMLOG_VOIP_TRANS_VOIP|1<<CMLOG_VOIP_TRANS_PSTN|1<<CMLOG_PSTN_TRANS_VOIP,CALLLOG_REMOTE_TRANSFER_MASK=1<<CMLOG_OUTGOING_REMOTE_TRANSFER|1<<CMLOG_INCOMING_REMOTE_TRANSFER|1<<CMLOG_UNKNOWN_REMOTE_TRANSFER,SIP_ACCT_MASK_INCOMING=240,SIP_ACCT_MASK_INCOMING_SHIFT=4,SIP_ACCT_MASK_OUTGOING=15,CALLLOG_PROCESSALL_MASK=1<<CMLOG_CONNECTED|CALLLOG_FORWARD_MASK|1<<CMLOG_CONF|CALLLOG_TRANSFER_MASK|1<<CMLOG_OUTGOING_REMOTE_TRANSFER|1<<CMLOG_REMOTE_FORWARD|CALLLOG_REMOTE_TRANSFER_MASK,telType=new Array(["type1","number1"],["type2","number2"],["type3","number3"],["type4","number4"],["type5","number5"]);function gettransferType(e){var l="";return 0!=(e&SIP_ACCT_MASK_INCOMING)>>>SIP_ACCT_MASK_INCOMING_SHIFT&&(l=e&1<<CMLOG_BOTH_OUTGOING?callType[1]:callType[0]),l}function getCallType(e){var l=e&1<<CMLOG_BOTH_OUTGOING,t=(e&SIP_ACCT_MASK_INCOMING)>>>SIP_ACCT_MASK_INCOMING_SHIFT,_=e&SIP_ACCT_MASK_OUTGOING,a=processType[7];return 0==l?15!=t&&0!=t?a=callType[0]:15==t&&(a=callType[0]):15!=t&&0!=t?(a=callType[1],1):15==t&&(a=callType[1],1),15!=_&&0!=_?a=callType[1]:15==_&&(a=callType[1]),a}function getProcessType(e){var l={},t="",_="";return t=e&1<<CMLOG_CONNECTED?processType[1]:processType[0],e&1<<CMLOG_CONF&&(_=processType[2]),e&CALLLOG_TRANSFER_MASK?_=processType[3]:e&CALLLOG_REMOTE_TRANSFER_MASK?_=processType[4]:e&1<<CMLOG_REMOTE_FORWARD?_=processType[6]:e&1<<CMLOG_UNKNOWN_REMOTE_TRANSFER?_=processType[7]:e&CALLLOG_FORWARD_MASK?_=processType[5]:e&1<<CMLOG_CONF&&(_=processType[2]),l.status=t,l.type=_,l}function getTypeAndNum(e,l,t){var _={},a={};return(a=getProcessType(e)).type==processType[3]?(l=gettransferType(e),t=datalist[1].replace(/</g,"&lt;")):a.type==processType[4]?(l=getCallType(e),t=datalist[1].replace(/</g,"&lt;")):a.type==processType[6]||a.type==processType[2]?(l=getCallType(e))==callType[0]?t=datalist[1].replace(/</g,"&lt;"):l==callType[1]&&(t=datalist[2].replace(/</g,"&lt;")):a.type==processType[5]?(l=callType[3],t=datalist[1].replace(/</g,"&lt;")):a.status!=processType[1]&&a.status!=processType[0]||(t=(l=getCallType(e))==callType[0]?datalist[1].replace(/</g,"&lt;"):datalist[2].replace(/</g,"&lt;")),a.status==processType[0]&&l==callType[0]&&(l=callType[4],t=datalist[1].replace(/</g,"&lt;")),_.type=l,_.callNum=t,_.tmpType=a.type,_.status=a.status,_.tmpType==processType[3]||_.type==callType[3]?_.devNum=datalist[5].replace(/</g,"&lt;"):_.type==callType[0]||_.type==callType[4]?_.devNum=datalist[2].replace(/</g,"&lt;"):_.type==callType[1]&&(_.devNum=datalist[1].replace(/</g,"&lt;")),_}function getProfileNameByIndex(e){return null!=voipAccounts[e-=1]&&null!=voipAccounts[e].multiExtension&&""!=voipAccounts[e].multiExtension?voipAccounts[e].multiProfileName:""}function showPushTips(){$.errorTip("pushSwitch",$.tpLang.voice_calllog_nstr.t_enPushTip),$("#pushSwitch_tips").click(function(e){var l=e.target;$(l).is("a")?$.goToOtherPage("pushService.htm","advanced"):$("#push_off").trigger("click")})}function getContact(e){for(var l="",t=0;t<telContacts.length;t++){for(var _=0,a=0;a<telType.length;a++)telContacts[t][telType[a][1]]==e&&(_=1,l=telContacts[t].firstName+"."+telContacts[t].lastName);if(_)break}return l}function freshTable(){if(freshFlag){if(telContacts=$.act(ACT_GL,XTP_TELE_CONTACT,null,null,null),lineList=$.act(ACT_GL,VOICE_PROF_LINE,null,null,["X_TP_PhoneName"]),voipAccounts=$.act(ACT_GL,XTP_MULTI_ISP,null,null,["multiProfileName","multiAccountInRoute","multiExtension","multiIndexing"]),0!=$.exe())return;var a=new Array;if(callLogString="",$.cgi("/main/voice_calllog.cgi",null,null),null==callLogString)return;0<(callLogList=callLogString.split(";\r\n\r\n")).length&&""==callLogList[callLogList.length-1]&&callLogList.pop(),callLogList.reverse(),$("#table-calllog").find("tbody tr:not(.nd)").remove();return $.each(callLogList,function(){datalist=this.split(",\r\n");var e,l,t="",_="";l=getContact((e=getTypeAndNum(parseInt(datalist[3],16),"","")).callNum),"Phone 1"==(t=4294967295==datalist[6]||e.type==callType[4]?"--":lineList[datalist[6]].X_TP_PhoneName)?t=$.tpLang.s_str.phone1:"Phone 2"==t&&(t=$.tpLang.s_str.phone2),_=e.status==processType[0]&&e.type==callType[1]?"00:00:00":datalist[4],0,""==l||"*20"==e.callNum&&"Outgoing"==e.type?a.push([{text:datalist[0],width:"20%"},{text:e.type,width:"10%"},{text:_,width:"15%"},{text:e.callNum,width:"25%"},{text:e.devNum,width:"20%"},{text:t,width:"10%"}]):a.push([{text:datalist[0],width:"20%"},{text:e.type,width:"10%"},{text:_,width:"15%"},{text:l,width:"25%"},{text:e.devNum,width:"20%"},{text:t,width:"10%"}])}),$.initTableBody($("#table-calllog"),a),$.tablePages($("#table-calllog"),8),a}}function init(){if(voipX_TP_CalllogCfg=$.act(ACT_GET,XTP_CALLLOGCFG,null,null,["Status"]),INCLUDE_MAIL&&(mailCfg=$.act(ACT_GET,MAIL_CFG,null,null,["EnableFlags"])),0==$.exe()){if("1"!=voipX_TP_CalllogCfg.status)$("#t_on").removeClass("selected"),$("#t_off").addClass("selected"),$("#table-calllog").find("tbody tr:not(.nd)").remove(),freshFlag=!1;else $("#t_on").addClass("selected"),$("#t_off").removeClass("selected"),freshFlag=!0;INCLUDE_MAIL&&($("#pushSwitch").removeClass("nd"),0!=(2&mailCfg.enableFlags)?(0!=(1&mailCfg.enableFlags)&&""!=mailCfg.from&&""!=mailCfg.smtpServerAddr||showPushTips(),$("#push_on").addClass("selected"),$("#push_off").removeClass("selected")):($("#push_on").removeClass("selected"),$("#push_off").addClass("selected")))}}function initTable(){$.auto(freshTable,VOICE_FRESH_TIME,!0)}$("#fresh").click(function(){$.reload()}),$("#t_off").click(function(){$.addLoading($(this));var e={status:"0"};$.act(ACT_SET,XTP_CALLLOGCFG,voipX_TP_CalllogCfg.__stack,null,e),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()})}),$("#t_on").click(function(){$.addLoading($(this));var e={status:"1"};$.act(ACT_SET,XTP_CALLLOGCFG,voipX_TP_CalllogCfg.__stack,null,e),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()})}),$("#push_off").click(function(){INCLUDE_MAIL&&($.addLoading($(this)),mailCfg={},mailCfg=$.act(ACT_GET,MAIL_CFG,null,null,["EnableFlags"]),0==$.exe()&&(mailCfg.enableFlags=-3&mailCfg.enableFlags,mailCfg.password="",$.act(ACT_SET,MAIL_CFG,"0,0,0,0,0,0",null,mailCfg),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()})))}),$("#push_on").click(function(){if(INCLUDE_MAIL)if(0==(1&mailCfg.enableFlags)||""==mailCfg.from||""==mailCfg.smtpServerAddr)setTimeout(function(){$("#push_off").addClass("selected"),$("#push_on").removeClass("selected"),$("#pushSwitch").tpBtnGroup("refresh"),showPushTips()},10);else{if($.addLoading($(this)),mailCfg={},mailCfg=$.act(ACT_GET,MAIL_CFG,null,null,["EnableFlags"]),0!=$.exe())return;mailCfg.enableFlags=2|mailCfg.enableFlags,mailCfg.password="",$.act(ACT_SET,MAIL_CFG,"0,0,0,0,0,0",null,mailCfg),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()})}}),$("#delAll").click(function(){$.confirm(c_str.voice_del_allcon,function(){$.addLoading($(this)),$.act(ACT_OP,ACT_VOIP_CLEAR_LOG),$.exe(),$.removeLoading(),$.reload()})})</script>
<style>#pushSwitch_tips .widget-error-tips-wrap{width:300px}#pushSwitch_tips.widget-error-tips a{text-decoration:underline;color:#4acbd6}</style>
<h3 class="T" id="t_title">Call Log</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="button-group-container">
            <b class="T xxxl" id="t_en">Enable Call Log:</b>
            <ul>
                <li>
                    <button id="t_on" class="fst" value="on">On</button>
                </li>
                <li>
                    <button id="t_off" class="lst" value="off">Off</button>
                </li>
            </ul>
        </div>
        <div class="button-group-container nd" id="pushSwitch">
            <b class="T xxxl" id="t_enPushService">Enable Push your Missed call via E-mail:</b>
            <ul>
                <li>
                    <button id="push_on" class="fst" value="on">On</button>
                </li>
                <li>
                    <button id="push_off" class="lst" value="off">Off</button>
                </li>
            </ul>
        </div>
    </form>
</div>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span class="refresh-icon" id="fresh"></span>
                <label class="T_refresh">Refresh</label>
		<span id="delAll" class="delete-all-icon"></span>
                <label class="T_delall">Delete All</label>
            </div>
        </div>
        <table id="table-calllog">
            <thead></thead>
            <tbody></tbody>
        </table>
    </form>
</div>
<script>var headArray=[{text:table_str.logdate,width:"20%"},{text:table_str.logtype,width:"10%"},{text:table_str.logdur,width:"15%"},{text:table_str.lognum,width:"25%"},{text:table_str.logdev,width:"20%"},{text:table_str.logtel,width:"10%"}];$.tpInit(init),$.initTableHead($("#table-calllog"),headArray),$("#table-calllog").tpTable(initTable)</script>
