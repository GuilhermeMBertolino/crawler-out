<h3 class="T" id="t_et">Telephone Book</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span id="importIcon" class="import-icon"></span>
                <label class="T_importStr">import</label>
                <span id="exportIcon" class="export-icon"></span>
                <label class="T_exportStr">export</label>
                <span id="add" class="add-icon"></span>
                <label class="T_add">Add</label>
                <span id="delAll" class="delete-all-icon"></span>
                <label class="T_delall">Delete All</label>
            </div>
        </div>
        <table id="table-book">
            <thead></thead>
            <tbody id="body-book">
            <tr id="edit-container-book" class="nd">
                <td colspan="5">
                    <div>
                        <b class="1 pl-xl ru-l T" id="t_fname">First name:</b>
                        <input type="text" id="fname" maxlength="32">
                    </div>
                    <div>
                        <b class="1 pl-xl ru-l T" id="t_name">Name:</b>
                        <input type="text" id="name" maxlength="32">
                    </div>
                    <div>
                        <b class="1 pl-xl ru-l T" id="t_pri">Private telephone number:</b>
                        <input type="text" id="priNum" maxlength="32">
                    </div>
                    <div>
                        <b class="1 pl-xl ru-l T" id="t_work">Work telephone number:</b>
                        <input type="text" id="telNum" maxlength="32">
                    </div>
                    <div>
                        <b class="1 pl-xl ru-l T" id="t_cell">Cell number:</b>
                        <input type="text" id="cellNum" maxlength="32">
                    </div>
                    <br>
                    <div>
                        <b class="T pl-xl ru-l" id="t_speeddial">Speed dial number type:</b>
                        <select class="xl" id="selDialNum">
                            <option class="T" id="t_select" value="0">Please select</option>
                            <option class="T" id="t_prinumber" value="1">Private Number</option>
                            <option class="T" id="t_worknumber" value="2">Work Number</option>
                            <option class="T" id="t_cellnumber" value="3">Cell Number</option>
                        </select>
                    </div>
                    <div>
                        <b class="T pl-xl ru-l" id="t_speednumber">Speed dial number:</b>
                        <input type="text" id="t_speednum" maxlength="2">
                    </div>
                    <div class="btn-right">
                        <button type="submit" class="green T_cancel" id="cancel">Cancel</button>
                        <button type="submit" class="green T_save" id="t_save">Save</button>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </form>
</div>
<div id="import-editor">
    <h4 id="import-editor-title"></h4>
    <form class="pure-form pure-form-aligned" action="/telebook/restore" enctype="multipart/form-data" method="post" id="reConf">
        <p id="import-editor-formats" class="cfg-line">we support the csv file/xml formats.</p>
        <div id="filename-ctn">
            <div class="file-container telebook-import">
                <input type="file" name="filename" id="filename">
            </div>
        </div>
        <p class="cfg-line"><span class="note-sign"></span><span id="overwrite-note"></span></p>
    </form>
</div>
<br>
<br>
<h3 class="T" id="t_et2">Warmline Settings</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="button-group-container">
            <b class="T" id="t_enwarm">Enable Warmline:</b>
            <ul>
                <li>
                    <button id="warmline_on" class="fst" value="on">On</button>
                </li>
                <li>
                    <button id="warmline_off" class="lst" value="off">Off</button>
                </li>
            </ul>
        </div>
        <br>
        <div>
            <b class="T" id="t_warmtime">Warmline time:</b>
            <select id="wrmNumt" class="xs">
                <option value="2" selected="selected">2s</option>
                <option value="3">3s</option>
                <option value="4">4s</option>
                <option value="5">5s</option>
                <option value="6">6s</option>
                <option value="7">7s</option>
                <option value="8">8s</option>
            </select>
        </div>
        <div>
            <b class="T" id="t_warmnumber1">Warmline Number1: </b>
            <input type="text" maxlength="32" id="WarmNumber1">
        </div>
        <div>
            <b class="T" id="t_warmnumber2">Warmline Number2: </b>
            <input type="text" maxlength="32" id="WarmNumber2">
        </div>
        <div>
            <b class="T" id="t_warmnumber3">Warmline Number3: </b>
            <input type="text" maxlength="32" id="WarmNumber3">
        </div>
        <div>
            <b class="T" id="t_warmnumber4">Warmline Number4: </b>
            <input type="text" maxlength="32" id="WarmNumber4">
        </div>
        <div>
            <b class="T" id="t_warmnumber5">Warmline Number5: </b>
            <input type="text" maxlength="32" id="WarmNumber5">
        </div>
        <div class="btn-right">
            <button type="submit" class="green T_save" id="saveWarmline">Save</button>
        </div>
    </form>
</div>
<script>$(function(){var p,f=0,b=[],v=-1,N=[],T="",e="",h=[[n_str.voice_telebook.t_prinumber,8],[n_str.voice_telebook.t_worknumber,2],[n_str.voice_telebook.t_cellnumber,4]];function s(e,t,r){if(r&&d(),t){var a=e.split(",");for(n=0;n<T.length;n++){if((o=T[n].split(","))[1]==a[1]&&o[0]==a[0])return void T.splice(n,1)}}else for(var l=1;l<4;l++){var i="number"+l;if(e[i])for(var n=0;n<T.length;n++){var o;if((o=T[n].split(","))[1]==e[i]){for(var u=0,m=0;m<b.length;m++)b[m].firstName===e.firstName&&b[m].lastName===e.lastName||b[m].number1!=e[i]&&b[m].number2!=e[i]&&b[m].number13!=e[i]||(u=1);0==u&&T.splice(n,1)}}}}function E(e){for(var t=0;t<T.length;t++){var r=T[t].split(",");if(r[1]==e)return r[0]}return-1}function d(){e=$.act(ACT_GET,XTP_IGD_SPEED_DIAL_CFG,null,null,["NumberPairs"]),$.exe(),0<(T=e.numberPairs.split("|")).length&&-1==T[T.length-1].search(",")&&T.pop(),0<T.length&&-1==T[0].search(",")&&T.shift()}$("#filename").tpFile({supportFormat:["csv","CSV","xml","XML"],invalidFormatText:$.tpLang.voice_telebook_nstr.t_formatHint2,allowBlank:!1}),$("#filename").on("ev_change",function(e,t,r){r?$("#import-editor").tpModal("option","confirmBtn",{disabled:!1}):$("#import-editor").tpModal("option","confirmBtn",{disabled:!0})}),$("#import-editor").tpModal({width:450,confirmBtn:{str:$.tpLang.m_str.importStr,callback:function(){if(!0!==$("#filename").tpFile("validate"))return!1;if(!window.ActiveXObject&&0===$("#filename")[0].files[0].size)return $.alert(ERR_FILE_NOT_FOUND),!1;var e=$("#reConf")[0];try{e.target="up_frame",e.action="/telebook/restore",e.submit()}catch(e){}$.guage([null,"<span>"+$.tpLang.s_str.wait_upload+"</span>"],30,100,function(){$.cgi("/telebook/bnr",null,function(e){e&&e!=ERR_NETWORK&&e!=ERR_EXIT&&e!=ERR_NONE_FILE?$.alert(e):($.hideMsg(),$.prompt(!0,$.tpLang.m_str.importStr),$.reload())},!1,!0)},null,null,null,$.tpLang.c_str.noRefresh)},disabled:!0}}),$("#import-editor-title").html($.tpLang.m_str.importStr),$("#import-editor-formats").html($.tpLang.voice_telebook_nstr.t_formatHint1),$(".note-sign").html($.tpLang.m_str.note+": "),$("#overwrite-note").html($.tpLang.voice_telebook_nstr.t_overwriteNote),$("#exportIcon").click(function(){var e=document.createElement("a");void 0===e.click?location.href="/telebook/backup":(e.href="/telebook/backup",document.body.appendChild(e),e.click(),$(e).remove())}),$("#importIcon").click(function(){$("#import-editor").tpModal("show"),$("#filename").tpFile("val",""),$("#filename").tpFile("hideError"),$("#import-editor").tpModal("option","confirmBtn",{disabled:!0})}),$("#add").click(function(){30<=T.length&&$("#selDialNum").prop("disabled",!0).tpSelect({refresh:1})}),$("#delAll").click(function(){$.confirm(c_str.voice_del_allcon,function(){if($.addLoading($(this)),b=$.act(ACT_GL,XTP_TELE_CONTACT,null,null,null),0==$.exe()){$.each(b,function(){0==this.internal&&($.act(ACT_DEL,XTP_TELE_CONTACT,this.__stack,null),s(this,0,0))});var e={numberPairs:""};$.act(ACT_SET,XTP_IGD_SPEED_DIAL_CFG,null,null,e),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()})}})}),$("#selDialNum").click(function(){0==$("#selDialNum").data("value")?($("#t_speednum").prop("value",""),$("#t_speednum").prop("disabled",!0)):$("#t_speednum").prop("disabled",!1)}),$("#cancel").click(function(){$.reload("telephonebook.htm")}),$("#t_save").click(function(){if($.addLoading($(this)),0==function(){var e,t,r,a;try{for(var l=$("#name"),i=$("#fname"),n=l.prop("value"),o=i.prop("value"),u=0;u<b.length;u++)if(u!=v&&n==b[u].lastName&&o==b[u].firstName)throw $.alert(ERR_VOIP_CONTACT_CONFLICT_ERROR),setFocus(l),!1;if(""==$("#priNum").prop("value")&&""==$("#telNum").prop("value")&&""==$("#cellNum").prop("value")){var m=$("#priNum");throw $.alert(ERR_VOIP_CONTACT_NUMBER_EMPTY),setFocus(m),!1}if(""!=$("#priNum").prop("value")&&(e="Private telephone number",r=$("#priNum"),t="priNum",a=getValue(t,e,3,31),r.get(0).value=a,checkNum(r,e)),""!=$("#telNum").prop("value")&&(e="Work telephone number",r=$("#telNum"),t="telNum",a=getValue(t,e,3,31),r.get(0).value=a,checkNum(r,e)),""!=$("#cellNum").prop("value")&&(e="Cell number",r=$("#cellNum"),t="cellNum",a=getValue(t,e,3,31),r.get(0).value=a,checkNum(r,e)),d(),$("#selDialNum").data("value")&&""!=$("#t_speednum").prop("value")){var p,s=$("#t_speednum");t="t_speednum",e="Speed dial number",getNumValue(t,e,1,99),getValue(t,e,2,2);var c="",_=$("#selDialNum").data("value");if(1==_?(p=$("#priNum"),c=$("#priNum").prop("value")):2==_?(p=$("#telNum"),c=$("#telNum").prop("value")):3==_&&(p=$("#cellNum"),c=$("#cellNum").prop("value")),""==c)throw $.alert(ERR_VOIP_SPEEDDIAL_TEL_NUM_EMPTY),setFocus(p),!1;if(!f&&30<=T.length)return $.alert(ERR_VOIP_ENTRY_MAX_ERROR),!1;$.each(T,function(e){if(!f||N[0]!=this&&N[1]!=this&&N[2]!=this){var t=this.split(",");if(t[0].replace(/(^\s*)|(\s*$)/g,"")==$("#t_speednum").prop("value"))throw $.alert(ERR_VOIP_SPEEDDIAL_CONFLICT_ERROR),setFocus(s),!1;if(t[1].replace(/(^\s*)|(\s*$)/g,"")==c)throw $.alert(ERR_VOIP_SPEEDDIAL_CONFLICT_ERROR),setFocus(p),!1}})}}catch(e){if(!1===e)return!1;throw e}return!0}())return!1;var e={};e.lastName=$("#name").prop("value"),e.firstName=$("#fname").prop("value"),e.number1=$("#priNum").prop("value"),e.number2=$("#telNum").prop("value"),e.number3=$("#cellNum").prop("value"),e.type1=8,e.type2=2,e.type3=4;var t=$("#selDialNum").data("value"),r="",a="";if(0!=t&&""!=$("#t_speednum").prop("value")&&(r=$("#t_speednum").prop("value"),1==t?a=$("#t_speednum").prop("value")+","+$("#priNum").prop("value"):2==t?a=$("#t_speednum").prop("value")+","+$("#telNum").prop("value"):3==t&&(a=$("#t_speednum").prop("value")+","+$("#cellNum").prop("value"))),f){$.act(ACT_SET,XTP_TELE_CONTACT,b[v].__stack,null,e);for(var l=[e.number1,e.number2,e.number3],i=1;i<=3;i++)if(N[i-1]){var n=1;if(t==i){if(n=0,N[i-1].split(",")[0]!=$("#t_speednum").prop("value")&&N[i-1].split(",")[1]!=a.split(",")[1])for(var o=0;o<b.length;o++)o!=v&&(N[i-1].split(",")[1]!=b[o].number1&&N[i-1].split(",")[1]!=b[o].number2&&N[i-1].split(",")[1]!=b[o].number3||(n=1))}else if(N[i-1].split(",")[0]==$("#t_speednum").prop("value"))n=0;else if(N[i-1].split(",")[1]!=l[i-1])for(o=n=0;o<b.length;o++)o!=v&&(N[i-1].split(",")[1]!=b[o].number1&&N[i-1].split(",")[1]!=b[o].number2&&N[i-1].split(",")[1]!=b[o].number3||(n=1));0==n&&s(N[i-1],1,0)}}else $.act(ACT_ADD,XTP_TELE_CONTACT,null,p[0].__stack,e);if(""!=a){var u=0;for(i=0;i<T.length;i++)if(r==T[i].split(",")[0]){u=1;break}0==u&&T.push(a)}var m={};m.numberPairs=T.join("|"),$.act(ACT_SET,XTP_IGD_SPEED_DIAL_CFG,null,null,m),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()})}),$("#saveWarmline").click(function(){if($.addLoading($(this)),0==function(){try{for(var e=1;e<6;e++){var t="WarmNumber"+e,r=n_str.voice_telebook.t_warmnumber+e,a=$("#"+t),l=getValue(t,r,0,32,!1);0<(a.get(0).value=l).length&&(l=getValue(t,r,3,32,!1),a.get(0).value=l,checkNum(a,r))}}catch(e){if(!1===e)return!1;throw e}return!0}())return!1;for(var e="",t=new Array,r=1;r<6;r++)""!=$("#WarmNumber"+r).prop("value")&&(e=$("#WarmNumber"+r).prop("value")+"@auto",t.push(e));var a=t.join(";"),l=$("#wrmNumt").data("value"),i=$.act(ACT_GL,VOICE_PROF_LINE_CALLFEAT,null,null,["X_TP_WarmLineNumber","X_TP_WarmLineTimer"]);0==$.exe()&&($.each(i,function(){$.act(ACT_SET,VOICE_PROF_LINE_CALLFEAT,this.__stack,null,["X_TP_WarmLineNumber="+a,"X_TP_WarmLineTimer="+l])}),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()}))}),$("#warmline_on").click(function(){$.addLoading($(this));var e=$.act(ACT_GL,VOICE_PROF_LINE_CALLFEAT,null,null,["X_TP_WarmLineStart"]);0==$.exe()&&($.each(e,function(){$.act(ACT_SET,VOICE_PROF_LINE_CALLFEAT,this.__stack,null,["X_TP_WarmLineStart=1"])}),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()}),$("#WarmNumber1").prop("disabled",!1),$("#WarmNumber2").prop("disabled",!1),$("#WarmNumber3").prop("disabled",!1),$("#WarmNumber4").prop("disabled",!1),$("#WarmNumber5").prop("disabled",!1))}),$("#warmline_off").click(function(){$.addLoading($(this));var e=$.act(ACT_GL,VOICE_PROF_LINE_CALLFEAT,null,null,["X_TP_WarmLineStart"]);0==$.exe()&&($.each(e,function(){$.act(ACT_SET,VOICE_PROF_LINE_CALLFEAT,this.__stack,null,["X_TP_WarmLineStart=0"])}),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()}),$("#WarmNumber1").prop("disabled",!0),$("#WarmNumber2").prop("disabled",!0),$("#WarmNumber3").prop("disabled",!0),$("#WarmNumber4").prop("disabled",!0),$("#WarmNumber5").prop("disabled",!0))});var t=[{text:table_str.name,width:"25%"},{text:table_str.telnumber,width:"40%"},{text:table_str.speednumber,width:"15%"},{text:table_str.modify,width:"20%"}];$.tpInit(function(){var e=$.act(ACT_GL,VOICE_PROF_LINE_CALLFEAT,null,null,["X_TP_WarmLineStart","X_TP_WarmLineNumber","X_TP_WarmLineTimer"]);if(0==$.exe()){1==e[0].X_TP_WarmLineStart?($("#warmline_on").addClass("selected"),$("#warmline_off").removeClass("selected"),$("#WarmNumber1").prop("disabled",!1),$("#WarmNumber2").prop("disabled",!1),$("#WarmNumber3").prop("disabled",!1),$("#WarmNumber4").prop("disabled",!1),$("#WarmNumber5").prop("disabled",!1),$("#wrmNumt").prop("disabled",!1)):($("#warmline_on").removeClass("selected"),$("#warmline_off").addClass("selected"),$("#WarmNumber1").prop("disabled",!0),$("#WarmNumber2").prop("disabled",!0),$("#WarmNumber3").prop("disabled",!0),$("#WarmNumber4").prop("disabled",!0),$("#WarmNumber5").prop("disabled",!0),$("#wrmNumt").prop("disabled",!0));for(var t,r=e[0].X_TP_WarmLineNumber.split(";"),a=0;a<r.length;a++){var l=r[a].split("@");$("#WarmNumber"+(a+1)).prop("value",l[0])}(t=e[0].X_TP_WarmLineTimer)&&1!=isNaN(t)||(t=3),(t<2||8<t)&&(t=3),$('#wrmNumt option[value="'+t+'"]').prop("selected","selected"),$("#wrmNumt").tpSelect({refresh:1}),d()}}),$.initTableHead($("#table-book"),t),$("#table-book").tpTable({search:{filter:function(e,t,r){var a=new RegExp(e,"ig");if(a.test(t.children(":eq(0)").text()))return!0;var l=t.children(":eq(1)").text().match(/(\d)+/g);return l=l.join(";"),!!a.test(l)}},initTable:function(){p=$.act(ACT_GL,VOICE,null,null,null);var d=$.act(ACT_GL,XTP_TELE_CONTACT,null,null,null);$("#table-book").on("click",".edit-modify-icon",function(){!function(e,t){var r=0,a=$.act(ACT_GET,XTP_TELE_CONTACT,e,null,null);if(0==$.exe()){$("#name").prop("value",a.lastName),$("#fname").prop("value",a.firstName),N=[];for(var l=1;l<4;l++){var i="type"+l,n="number"+l;if(a[i]&&a[n]){8==a[i]?($("#priNum").prop("value",a[n]),u=1):2==a[i]?($("#telNum").prop("value",a[n]),u=2):4==a[i]&&($("#cellNum").prop("value",a[n]),u=3);var o=E(a[n]);if(-1!=o){var u=l;$('#selDialNum option[value="'+u+'"]').prop("selected","selected"),$("#t_speednum").prop("value",o),N[r]=o+","+a[n]}}r++}N[0]||N[1]||N[2]||$("#selDialNum option[value='0']").prop("selected","selected"),$("#selDialNum").tpSelect({refresh:1}),f=1,v=t}}($(this).data("stack"),$(this).data("index"))}),$("#table-book").on("click",".edit-trash-icon",function(){var r;r=$(this).data("stack"),$(this).data("index"),$.confirm(c_str.voice_del_con,function(){$.addLoading($(this));var e=$.act(ACT_GET,XTP_TELE_CONTACT,r,null,null);if(0==$.exe()){s(e,0,1);var t={};t.numberPairs=T.join("|"),$.act(ACT_SET,XTP_IGD_SPEED_DIAL_CFG,null,null,t),$.act(ACT_DEL,XTP_TELE_CONTACT,e.__stack,null),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()})}})}),$.exe(function(){var e,t,r=0,a=[],l=-1,i=0,n=[];$.each(d,function(){0==this.internal&&b.push(this)}),n=function(e){for(var t=[],r=[],a=0;a<e.length;a++){var l=(""!=e[a].firstName?e[a].firstName:e[a].lastName)+"$%^@#*"+a;r.push(l)}return t.sort(),r.sort(),t.concat(r)}(b);for(var o=0;o<n.length;o++){l=-1,i=0;var u="",m=n[o].split("$%^@#*")[1];if(1!=b[m].internal){for(r++,e=""==b[m].firstName?b[m].lastName:""==b[m].lastName?b[m].firstName:b[m].firstName+" "+b[m].lastName,t="",j=1;j<4;j++){var p="type"+j,s="number"+j;if(""!=b[m][s]){for(k=0;k<h.length;k++)if(b[m][p]&h[k][1]){t+=h[k][0]+":"+b[m][s]+"<br />";break}k<h.length&&-1!=(l=E(b[m][s]))&&(i&&(u+="<br />"),u+=h[k][0]+":"+l,i=1)}}var c;c=0==i?"--":u;var _="["+b[m].__stack+"]";a.push([{text:$.htmlEncodeStr(e),width:"25%"},{text:t,width:"40%"},{text:c,width:"15%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+r+"' data-stack='"+_+"' data-index='"+m+"'></span><span class='table-grid-icon edit-trash-icon' id='del_"+r+"' data-stack='"+_+"' data-index='"+m+"'></span>",width:"20%"}])}}return $.initTableBody($("#table-book"),a),$.tablePages($("#table-book"),8),a})}})})</script>
