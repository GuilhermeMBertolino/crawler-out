<script language="JavaScript">var dftGtw,pcMacAddr,currGtwIndex=null,dftGtw6=null,currGtw6Index=null,curSupIsPtm=0,curSetIsPtm=0,wanArg={},wanDsl={},wanEth={},ethDelConnFlag=!1,dsllinkcfglist={},ptmlinkcfglist={},ethlinkcfglist={};function initConnTypeSelect(t){var n=$("#link_type").data("value"),e="<option value='staticIp' text='"+s_str.staip+"'>"+s_str.staip+"</option><option value='dynamicIp' text='"+s_str.dynip+"'>"+s_str.dynip+"</option><option value='pppoe' text='"+s_str.pppoe+"'>"+s_str.pppoe+"</option>";"DSL"==$.sysMode&&"ATM"==t&&(e+="<option value='pppoa' text='"+s_str.pppoa+"'>"+s_str.pppoa+"</option><option value='ipoa' text='"+s_str.ipoa+"'>"+s_str.ipoa+"</option>"),INCLUDE_L2TP&&(e+="<option value='l2tp' text='"+s_str.l2tp+"'>"+s_str.l2tp+"</option>"),INCLUDE_PPTP&&(e+="<option value='pptp' text='"+s_str.pptp+"'>"+s_str.pptp+"</option>"),e+="<option value='bridge' text='"+s_str.bridge+"'>"+s_str.bridge+"</option>",$("#link_type").empty().append(e),n&&$("#link_type option[value='"+n+"']").prop("selected","selected");$("#link_type").tpSelect({refresh:1})}function initDiv(){$("input[type='text'].mac-address").tpAddress({connector:"-",connectorReal:":",cellLength:2,cellNumber:6}),(INCLUDE_VDSLWAN||INCLUDE_LTEWAN)&&($("#link_type option[value='pppoa']").remove(),$("#link_type option[value='ipoa']").remove()),INCLUDE_LTEWAN&&$("#link_type option[value='bridge']").remove(),"DSL"==$.sysMode?($.loadPage("divDslCfg","dsl.htm"),$("#divDslCfg").removeClass("nd")):$.loadPage("eth-cfg","eth.htm");var t=$.wd.editIndex==$.wd.conn.length?"pppoe":$.wd.conn[$.wd.editIndex].type;if($("#link_type option[value='"+t+"']").prop("selected","selected"),$.wd.editIndex==$.wd.conn.length){$("#addLinkType").removeClass("nd");$.wd.conn.push({type:null,obj:{},dsl:{},ptm:{}})}else"DSL"==$.sysMode?$("#editLinkType").removeClass("nd"):$("#addLinkType").removeClass("nd"),"bridge"==$.wd.conn[$.wd.editIndex].type&&$("#saveBtn").prop("disabled",!0);$("#link_type").tpSelect({refresh:1}),doSync(t),initMacClone()}function detectPvcConflict(){var t,n="PVC:"+$("#vpi").val()+"/"+$("#vci").val(),e=$.act(ACT_GL,WAN_DSL_LINK_CFG,null,null,["destinationAddress","linkType","ATMPeakCellRate","ATMMaximumBurstSize","ATMSustainableCellRate","ATMEncapsulation","ATMQoS"]);if(!$.exe())for(var d=0;d<e.length;d++)if(e[d].destinationAddress==n)return t=$.act(ACT_GET,WAN_CONN_DEVICE,e[d].__stack,null),void($.exe()||(0<t.WANIPConnectionNumberOfEntries||0<t.WANPPPConnectionNumberOfEntries)&&disablePvcParam(e[d].linkType))}function doSync(t){switch(t){case"staticIp":$.loadPage("divStaIp","staticIp.htm",function(){},function(){$("#divStaIp").show("fast")}),$("#divDynIp").hide("fast"),$("#divPPPoE").hide("fast"),$("#divPPPoA").hide("fast"),$("#divIPoA").hide("fast"),$("#divL2TP").hide("fast"),$("#divPPTP").hide("fast"),$("#linkTypeText").html("Static IP");break;case"dynamicIp":$.loadPage("divDynIp","dynamicIp.htm",function(){},function(){$("#divDynIp").show("fast")}),$("#divStaIp").hide("fast"),$("#divPPPoE").hide("fast"),$("#divPPPoA").hide("fast"),$("#divIPoA").hide("fast"),$("#divL2TP").hide("fast"),$("#divPPTP").hide("fast"),$("#linkTypeText").html("Dynamic IP");break;case"pppoe":$.loadPage("divPPPoE","pppoe.htm",function(){},function(){$("#divPPPoE").show("fast")}),$("#divStaIp").hide("fast"),$("#divDynIp").hide("fast"),$("#divPPPoA").hide("fast"),$("#divIPoA").hide("fast"),$("#divL2TP").hide("fast"),$("#divPPTP").hide("fast"),$("#linkTypeText").html("PPPoE");break;case"pppoa":$.loadPage("divPPPoA","pppoa.htm",function(){},function(){$("#divPPPoA").show("fast")}),$("#divStaIp").hide("fast"),$("#divDynIp").hide("fast"),$("#divPPPoE").hide("fast"),$("#divIPoA").hide("fast"),$("#divL2TP").hide("fast"),$("#divPPTP").hide("fast"),$("#linkTypeText").html("PPPoA");break;case"ipoa":$.loadPage("divIPoA","ipoa.htm",function(){},function(){$("#divIPoA").show("fast")}),$("#divStaIp").hide("fast"),$("#divDynIp").hide("fast"),$("#divPPPoE").hide("fast"),$("#divPPPoA").hide("fast"),$("#divL2TP").hide("fast"),$("#divPPTP").hide("fast"),$("#linkTypeText").html("IPoA");break;case"l2tp":$.loadPage("divL2TP","l2tp.htm",function(){},function(){$("#divL2TP").show("fast")}),$("#divStaIp").hide("fast"),$("#divDynIp").hide("fast"),$("#divPPPoE").hide("fast"),$("#divIPoA").hide("fast"),$("#divPPPoA").hide("fast"),$("#divPPTP").hide("fast"),$("#linkTypeText").html("L2TP");break;case"pptp":$.loadPage("divPPTP","pptp.htm",function(){},function(){$("#divPPTP").show("fast")}),$("#divStaIp").hide("fast"),$("#divDynIp").hide("fast"),$("#divPPPoE").hide("fast"),$("#divIPoA").hide("fast"),$("#divPPPoA").hide("fast"),$("#divL2TP").hide("fast"),$("#linkTypeText").html("PPTP");break;case"bridge":$("#divStaIp").hide("fast"),$("#divDynIp").hide("fast"),$("#divPPPoE").hide("fast"),$("#divPPPoA").hide("fast"),$("#divIPoA").hide("fast"),$("#divL2TP").hide("fast"),$("#divPPTP").hide("fast"),$("#linkTypeText").html("Bridge");break;default:$.loadPage("divPPPoE","pppoe.htm",function(){},function(){$("#divPPPoE").show("fast")}),$("#divStaIp").hide("fast"),$("#divDynIp").hide("fast"),$("#divPPPoA").hide("fast"),$("#divIPoA").hide("fast"),$("#divL2TP").hide("fast"),$("#divPPTP").hide("fast"),$("#linkTypeText").html("PPPoE")}if(null==$.wd.conn[$.wd.editIndex].type&&(!INCLUDE_VDSLWAN||0==curSetIsPtm)&&$("#atm_encapsulation")){if(INCLUDE_LTEWAN&&"ETH"==$.sysMode||detectPvcConflict(),$("#p_note")&&!$("#p_note").hasClass("nd"))return void $("#vpi").focus().select();$("#atm_encapsulation option[value='"+("pppoa"==t?"VCMUX":"LLC")+"']").prop("selected","selected"),$("#atm_encapsulation").tpSelect({refresh:1})}}function isConnDeviceExist(){var t=0;if("DSL"==$.sysMode){for(t=0;t<dsllinkcfglist.length;t++)if(INCLUDE_VDSLWAN&&1==curSetIsPtm){if(1==ptmlinkcfglist[t].X_TP_Used&&ptmlinkcfglist[t].X_TP_VID==wanPtm.X_TP_VID)return ptmlinkcfglist[t].__stack}else if(dsllinkcfglist[t].destinationAddress==wanDsl.destinationAddress)return dsllinkcfglist[t].__stack}else if("ETH"==$.sysMode)for(t=0;t<ethlinkcfglist.length;t++)if(1==ethlinkcfglist[t].enable&&ethlinkcfglist[t].X_TP_VID==wanEth.X_TP_VID&&$.wd.conn[$.wd.editIndex].ewan&&ethlinkcfglist[t].__stack!=$.wd.conn[$.wd.editIndex].ewan.__stack)return ethlinkcfglist[t].__stack;return""}function newConnApply(n,e,t,d){var a;"ETH"==$.sysMode&&$.act(ACT_SET,WAN_ETH_LINK_CFG,e.__stack,null,wanEth),"l2tp"!=n&&"pptp"!=n&&1==t&&s_str.cur_con==dftGtw6.data("text")&&(wanArg.X_TP_PDEnabled=1),a="l2tp"==n?$.act(ACT_ADD,WAN_L2TP_CONN,null,e.__stack,wanArg):"pptp"==n?$.act(ACT_ADD,WAN_PPTP_CONN,null,e.__stack,wanArg):$.act(ACT_ADD,n.indexOf("ppp")<0?WAN_IP_CONN:WAN_PPP_CONN,null,e.__stack,wanArg),$.exe(function(t){if(!t)return"bridge"==n?($.removeLoading(),void $.loadMain("wan.htm")):(conn="l2tp"==n?$.act(ACT_GET,WAN_L2TP_CONN,a.__stack,null,["name"]):"pptp"==n?$.act(ACT_GET,WAN_PPTP_CONN,a.__stack,null,["name"]):$.act(ACT_GET,n.indexOf("ppp")<0?WAN_IP_CONN:WAN_PPP_CONN,a.__stack,null,["name"]),void $.exe(function(t){t||($.wd.originIfAliasName!=dftGtw.data("text")&&("DSL"==$.sysMode?$.act(ACT_SET,LOCAL,null,null,{ispIndex:-1}):$.act(ACT_SET,LOCAL,null,null,{ewanIspIndex:-1})),s_str.cur_con==dftGtw.data("text")?$.wd.l3ForwardingObj.__ifAliasName=conn.name:$.wd.l3ForwardingObj.__ifAliasName=dftGtw.data("text"),"l2tp"==n||"pptp"==n?$.act(ACT_SET,L3_FORWARDING,null,null,$.wd.l3ForwardingObj):INCLUDE_IPV6&&1!=wanArg.X_TP_IPv4Enabled||$.act(ACT_SET,L3_FORWARDING,null,null,$.wd.l3ForwardingObj),INCLUDE_IPV6&&null!=dftGtw6&&(s_str.cur_con==dftGtw6.data("text")?$.wd.l3Ip6ForwardingObj.__ifAliasName=conn.name:$.wd.l3Ip6ForwardingObj.__ifAliasName=dftGtw6.data("text"),1==wanArg.X_TP_IPv6Enabled&&$.act(ACT_SET,L3_IP6_FORWARDING,null,null,$.wd.l3Ip6ForwardingObj)),"AlwaysOn"==wanArg.connectionTrigger&&("l2tp"==n&&$.act(ACT_OP,ACT_OP_L2TP_CONN,a.__stack),"pptp"==n&&$.act(ACT_OP,ACT_OP_PPTP_CONN,a.__stack)),$.exe(function(t){t||("l2tp"==n||"pptp"==n?$.timeout(function(){$.removeLoading(),$.loadMain("wan.htm")},1500):($.removeLoading(),$.loadMain("wan.htm")))}))}));""==d&&(INCLUDE_EWAN_VLAN&&t==CMM_WAN_VID_CONFLICT||t==CMM_WAN_L2TP_ALREADY_EXIST||t==CMM_WAN_PPTP_ALREADY_EXIST||($.act(ACT_DEL,WAN_CONN_DEVICE,e.__stack,null),$.exe(function(){$.removeLoading()})))})}function saveApply(n){var t;if("ETH"==$.sysMode&&($.act(ACT_SET,WAN_ETH_LINK_CFG,$.wd.conn[$.wd.editIndex].ewan.__stack,null,wanEth),n!=$.wd.conn[$.wd.editIndex].type?(ethDelConnFlag=!0,"l2tp"==$.wd.conn[$.wd.editIndex].type?$.act(ACT_DEL,WAN_L2TP_CONN,$.wd.conn[$.wd.editIndex].obj.__stack,null):"pptp"==$.wd.conn[$.wd.editIndex].type?$.act(ACT_DEL,WAN_PPTP_CONN,$.wd.conn[$.wd.editIndex].obj.__stack,null):$.act(ACT_DEL,$.wd.conn[$.wd.editIndex].type.indexOf("ppp")<0?WAN_IP_CONN:WAN_PPP_CONN,$.wd.conn[$.wd.editIndex].obj.__stack,null),t="l2tp"==n?$.act(ACT_ADD,WAN_L2TP_CONN,null,$.wd.conn[$.wd.editIndex].ewan.__stack,wanArg):"pptp"==n?$.act(ACT_ADD,WAN_PPTP_CONN,null,$.wd.conn[$.wd.editIndex].ewan.__stack,wanArg):$.act(ACT_ADD,n.indexOf("ppp")<0?WAN_IP_CONN:WAN_PPP_CONN,null,$.wd.conn[$.wd.editIndex].ewan.__stack,wanArg),$.exe()):"l2tp"==n?$.act(ACT_SET,WAN_L2TP_CONN,$.wd.conn[$.wd.editIndex].obj.__stack,null,wanArg):"pptp"==n?$.act(ACT_SET,WAN_PPTP_CONN,$.wd.conn[$.wd.editIndex].obj.__stack,null,wanArg):$.act(ACT_SET,n.indexOf("ppp")<0?WAN_IP_CONN:WAN_PPP_CONN,$.wd.conn[$.wd.editIndex].obj.__stack,null,wanArg)),1==("l2tp"==n||"pptp"==n?1:"bridge"==n||INCLUDE_IPV6&&1!=wanArg.X_TP_IPv4Enabled?0:1)){if(($.wd.originIfAliasName!=dftGtw.data("text")||ethDelConnFlag&&$.wd.l3ForwardingObj.__ifAliasName==$.wd.conn[$.wd.editIndex].obj.name)&&("DSL"==$.sysMode?$.act(ACT_SET,LOCAL,null,null,{ispIndex:-1}):$.act(ACT_SET,LOCAL,null,null,{ewanIspIndex:-1})),$.wd.l3ForwardingObj.__ifAliasName=dftGtw.data("text"),s_str.cur_con==dftGtw.data("text")&&($.wd.l3ForwardingObj.__ifAliasName=$.wd.conn[$.wd.editIndex].obj.name),ethDelConnFlag&&($.wd.l3ForwardingObj.__ifAliasName==$.wd.conn[$.wd.editIndex].obj.name||$.wd.l3ForwardingObj.__ifAliasName==s_str.cur_con))e="l2tp"==n?$.act(ACT_GET,WAN_L2TP_CONN,t.__stack,null,["name"]):"pptp"==n?$.act(ACT_GET,WAN_PPTP_CONN,t.__stack,null,["name"]):$.act(ACT_GET,n.indexOf("ppp")<0?WAN_IP_CONN:WAN_PPP_CONN,t.__stack,null,["name"]),$.exe(),$.wd.l3ForwardingObj.__ifAliasName=e.name;$.act(ACT_SET,L3_FORWARDING,null,null,$.wd.l3ForwardingObj)}if(INCLUDE_IPV6&&null!=dftGtw6){var e;if($.wd.l3Ip6ForwardingObj.__ifAliasName=dftGtw6.data("text"),!ethDelConnFlag||$.wd.l3Ip6ForwardingObj.__ifAliasName!=$.wd.conn[$.wd.editIndex].obj.name&&$.wd.l3Ip6ForwardingObj.__ifAliasName!=s_str.cur_con)s_str.cur_con==dftGtw6.data("text")||$.wd.conn[$.wd.editIndex].obj.name==dftGtw6.data("text")?$.wd.l3Ip6ForwardingObj.__ifAliasName=$.wd.conn[$.wd.editIndex].obj.name:$.wd.l3Ip6ForwardingObj.__ifAliasName=dftGtw6.data("text");else e="l2tp"==n?$.act(ACT_GET,WAN_L2TP_CONN,t.__stack,null,["name"]):"pptp"==n?$.act(ACT_GET,WAN_PPTP_CONN,t.__stack,null,["name"]):$.act(ACT_GET,n.indexOf("ppp")<0?WAN_IP_CONN:WAN_PPP_CONN,t.__stack,null,["name"]),$.exe(),$.wd.l3Ip6ForwardingObj.__ifAliasName=e.name;"bridge"!=n&&1==wanArg.X_TP_IPv6Enabled&&$.act(ACT_SET,L3_IP6_FORWARDING,null,null,$.wd.l3Ip6ForwardingObj)}"ETH"==$.sysMode&&"dynamicIp"==$.wd.conn[$.wd.editIndex].type&&"dynamicIp"==n&&"dynamicIp"==$.wd.conn[$.wd.editIndex].type&&1==wanArg.X_TP_IPv4Enabled&&$.act(ACT_OP,ACT_OP_DHCP_RENEW,$.wd.conn[$.wd.editIndex].obj.__stack),"AlwaysOn"==wanArg.connectionTrigger&&("l2tp"==n&&(1==ethDelConnFlag?$.act(ACT_OP,ACT_OP_L2TP_CONN,t.__stack):$.act(ACT_OP,ACT_OP_L2TP_CONN,$.wd.conn[$.wd.editIndex].obj.__stack)),"pptp"==n&&(1==ethDelConnFlag?$.act(ACT_OP,ACT_OP_PPTP_CONN,t.__stack):$.act(ACT_OP,ACT_OP_PPTP_CONN,$.wd.conn[$.wd.editIndex].obj.__stack))),$.exe(function(t){t||("l2tp"==n||"pptp"==n?$.timeout(function(){$.removeLoading(),$.loadMain("wan.htm")},1500):($.removeLoading(),$.loadMain("wan.htm")))})}function addAttrs(t){var n=!0;if(null==$.wd.conn[$.wd.editIndex].type){if("DSL"==$.sysMode){if(0==addDslCfgAttrs())return!1}else if(0==addEthCfgAttrs())return!1}else INCLUDE_WAN_VLAN&&"DSL"==$.sysMode&&addDslVlanAttrs();if(0==addMacCloneAttrs(t))return!1;switch(t){case"staticIp":n=addStaIpAttrs();break;case"dynamicIp":n=addDynIpAttrs();break;case"pppoe":n=addPPPoEAttrs();break;case"pppoa":n=addPPPoAAttrs();break;case"ipoa":n=addIPoAAttrs();break;case"l2tp":n=addL2tpAttrs();break;case"pptp":n=addPptpAttrs();break;case"bridge":wanArg.NATEnabled=0,wanArg.X_TP_FullconeNATEnabled=0,wanArg.X_TP_FirewallEnabled=0,wanArg.X_TP_IGMPProxyEnabled=0,wanArg.maxMTUSize=1500,wanArg.enable=1,wanArg.connectionType="IP_Bridged",n=!0}return n}function showIPv6(){$("p").each(function(){$(this).hasClass("IPv6")&&$(this).removeClass("nd")}),$("div").each(function(){$(this).hasClass("IPv6")&&$(this).removeClass("nd")})}function initDefaultGwDNS(){var t,n=0,e=$.wd.conn[$.wd.editIndex].type,d=null==e?$.wd.conn.length-1:$.wd.conn.length;if("DSL"==$.sysMode){if(INCLUDE_WAN_MODE&&INCLUDE_VDSLWAN){var a=$.act(ACT_GET,SYS_MODE,null,null,["mode","DSLL3ForwardingName","VDSLL3ForwardingName","DSLL3IPv6ForwardingName","VDSLL3IPv6ForwardingName"]);$.exe()}if(INCLUDE_USB_3G_DONGLE&&INCLUDE_WAN_MODE&&null!=$.wd.l3ForwardingObj.__ifAliasName.match("USB_3G")){var i,o,l=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]),_=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["backupEnable"]);if(INCLUDE_WAN_MODE)a=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);$.exe()||($.each(l,function(){"USB_3G"==this.WANAccessType&&(i=this.__stack)}),$.each(_,function(){var t=$.stkPop(this.__stack,1);i==t&&(o=$.act(ACT_GET,WAN_USB_3G_LINK_CFG,this.__stack,null,["mainConnObjName"]))}),$.exe()||INCLUDE_WAN_MODE&&"USB_3G"!=a.mode&&($.wd.l3ForwardingObj.__ifAliasName=o.mainConnObjName))}dftGtw.empty();for(var c=0;c<d;c++){if(1==("l2tp"==$.wd.conn[c].type||"pptp"==$.wd.conn[c].type?1:"bridge"==$.wd.conn[c].type||INCLUDE_IPV6&&1!=$.wd.conn[c].obj.X_TP_IPv4Enabled?0:1)){if(INCLUDE_VDSLWAN&&curSetIsPtm!=$.wd.conn[c].ptm.X_TP_Used)continue;if(INCLUDE_IPTV&&"iptv"==$.wd.conn[c].obj.name)continue;t="<option value='"+$.wd.conn[c].obj.name+"' text='"+$.wd.conn[c].obj.name+"''>"+$.wd.conn[c].obj.name+"</option>",dftGtw.append(t),$.wd.conn[c].obj.name==(INCLUDE_VDSLWAN?curSetIsPtm?a.VDSLL3ForwardingName:a.DSLL3ForwardingName:$.wd.l3ForwardingObj.__ifAliasName)&&dftGtw.find('option[value="'+$.wd.conn[c].obj.name+'"]').prop("selected","selected"),n++}}if(null!=e&&0!=n&&("l2tp"==e||"pptp"==e||INCLUDE_IPV6&&0!=$.wd.conn[$.wd.editIndex].obj.X_TP_IPv4Enabled)||(t="<option text='"+s_str.cur_con+"''>"+s_str.cur_con+"</option>",dftGtw.append(t),currGtwIndex=n,n++),"l2tp"!=e&&"pptp"!=e&&0==$.wd.conn[$.wd.editIndex].obj.X_TP_IPv4Enabled&&"iptv"==(INCLUDE_VDSLWAN?curSetIsPtm?a.VDSLL3ForwardingName:a.DSLL3ForwardingName:$.wd.l3ForwardingObj.__ifAliasName)&&dftGtw.find('option[text="'+s_str.cur_con+'"]').prop("selected","selected"),INCLUDE_IPV6&&null!=dftGtw6){n=0,dftGtw6.empty();for(c=0;c<d;c++)if("bridge"!=$.wd.conn[c].type&&1==$.wd.conn[c].obj.X_TP_IPv6Enabled){if(INCLUDE_VDSLWAN&&curSetIsPtm!=$.wd.conn[c].ptm.X_TP_Used)continue;if(INCLUDE_IPTV_V2&&"iptv"==$.wd.conn[c].obj.name)continue;t="<option value='"+$.wd.conn[c].obj.name+"' text='"+$.wd.conn[c].obj.name+"''>"+$.wd.conn[c].obj.name+"</option>",dftGtw6.append(t),$.wd.conn[c].obj.name==(INCLUDE_VDSLWAN?curSetIsPtm?a.VDSLL3IPv6ForwardingName:a.DSLL3IPv6ForwardingName:$.wd.l3Ip6ForwardingObj.__ifAliasName)&&dftGtw6.find('option[value="'+$.wd.conn[c].obj.name+'"]').prop("selected","selected"),n++}null!=e&&0!=$.wd.conn[$.wd.editIndex].obj.X_TP_IPv6Enabled&&0!=n||(t="<option text='"+s_str.cur_con+"''>"+s_str.cur_con+"</option>",dftGtw6.append(t),currGtw6Index=n,n++)}}else{dftGtw.empty();for(c=0;c<d;c++)if("pptp"==$.wd.conn[c].type||"l2tp"==$.wd.conn[c].type)t="<option value='"+$.wd.conn[c].obj.name+"' text='"+$.wd.conn[c].obj.name+"''>"+$.wd.conn[c].obj.name+"</option>",dftGtw.append(t),$.wd.conn[c].obj.name==$.wd.l3ForwardingObj.__ifAliasName&&dftGtw.find('option[value="'+$.wd.conn[c].obj.name+'"]').prop("selected","selected"),n++;else if("bridge"!=$.wd.conn[c].type&&(!INCLUDE_IPV6||1==$.wd.conn[c].obj.X_TP_IPv4Enabled)){if(INCLUDE_EWAN_IPTV&&"ewan_iptv"==$.wd.conn[c].obj.name)continue;t="<option value='"+$.wd.conn[c].obj.name+"' text='"+$.wd.conn[c].obj.name+"''>"+$.wd.conn[c].obj.name+"</option>",dftGtw.append(t),$.wd.conn[c].obj.name==$.wd.l3ForwardingObj.__ifAliasName&&dftGtw.find('option[value="'+$.wd.conn[c].obj.name+'"]').prop("selected","selected"),n++}if(null!=e&&0!=n&&("l2tp"==e||"pptp"==e||INCLUDE_IPV6&&0!=$.wd.conn[$.wd.editIndex].obj.X_TP_IPv4Enabled)||(t="<option text='"+s_str.cur_con+"''>"+s_str.cur_con+"</option>",dftGtw.append(t),currGtwIndex=n,n++),"l2tp"!=e&&"pptp"!=e&&0==$.wd.conn[$.wd.editIndex].obj.X_TP_IPv4Enabled&&"iptv"==$.wd.l3ForwardingObj.__ifAliasName&&dftGtw.find('option[text="'+s_str.cur_con+'"]').prop("selected","selected"),INCLUDE_IPV6&&null!=dftGtw6){n=0,dftGtw6.empty();for(c=0;c<d;c++)if("bridge"!=$.wd.conn[c].type&&1==$.wd.conn[c].obj.X_TP_IPv6Enabled){if(INCLUDE_EWAN_IPTV&&"ewan_iptv"==$.wd.conn[c].obj.name)continue;t="<option value='"+$.wd.conn[c].obj.name+"' text='"+$.wd.conn[c].obj.name+"''>"+$.wd.conn[c].obj.name+"</option>",dftGtw6.append(t),$.wd.conn[c].obj.name==$.wd.l3Ip6ForwardingObj.__ifAliasName&&dftGtw6.find('option[value="'+$.wd.conn[c].obj.name+'"]').prop("selected","selected"),n++}null!=e&&0!=$.wd.conn[$.wd.editIndex].obj.X_TP_IPv6Enabled&&0!=n||(t="<option text='"+s_str.cur_con+"''>"+s_str.cur_con+"</option>",dftGtw6.append(t),currGtw6Index=n,n++)}}null!=$.wd.conn[$.wd.editIndex].type&&$.wd.conn[$.wd.editIndex].type!=$("#link_type").data("value")&&(t="<option text='"+s_str.cur_con+"''>"+s_str.cur_con+"</option>",dftGtw.append(t),dftGtw.find('option[text="'+s_str.cur_con+'"]').prop("selected","selected"),INCLUDE_IPV6&&"pptp"!=$("#link_type").data("value")&&"l2tp"!=$("#link_type").data("value")&&(dftGtw6.append(t),dftGtw6.find('option[text="'+s_str.cur_con+'"]').prop("selected","selected")))}function addMacCloneAttrs(t){var n;if($("#dftMac").prop("checked"))return!(wanArg.MACAddressOverride=0);if($("#pcMac").prop("checked"))n=pcMacAddr;else if($("#customMac").prop("checked")&&(n=$("#customMacAddr").tpAddress("val"),$.mac(n)))return $("#customMacAddr").focus().select(),!1;return wanArg.MACAddressOverride=1,"l2tp"==t||"pptp"==t?wanArg.clonedMACAddress=n.toUpperCase():wanArg.X_TP_ClonedMACAddress=n.toUpperCase(),!0}function initMacClone(){if($.act(ACT_CGI,"/cgi/info"),$.exe())return!1;if(pcMacAddr=clientMac,$("input[type='text'].mac-address").tpAddress({connector:"-",connectorReal:":",cellLength:2,cellNumber:6}),$("#computerMacAddr").tpAddress("val",pcMacAddr),null!=$.wd.conn[$.wd.editIndex].type){var t=$.wd.conn[$.wd.editIndex].obj;1==t.MACAddressOverride&&(t.X_TP_ClonedMACAddress==pcMacAddr||t.clonedMACAddress==pcMacAddr?($("#pcMac").prop("checked",!0),$("#customMac").prop("checked",!1)):($("#customMac").prop("checked",!0),"l2tp"==$.wd.conn[$.wd.editIndex].type||"pptp"==$.wd.conn[$.wd.editIndex].type?$("#customMacAddr").tpAddress("val",t.clonedMACAddress):$("#customMacAddr").tpAddress("val",t.X_TP_ClonedMACAddress),$("#pcMac").prop("checked",!1)),$("#dftMac").prop("checked",!1))}}$("#saveConnBtn").click(function(){$.addLoading($(this));var n=$.wd.conn[$.wd.editIndex].type;null!=n&&"ETH"!=$.sysMode||(n=$("#link_type").data("value")),wanDsl={},wanPtm={},wanArg={};var t,e=!(wanEth={});if(t=$.act(ACT_GL,LAN_IP6_HOST_CFG,null,null),$.exe(),$.each(t,function(){"br0"==this.__ifName&&""==this.IPv6PDWANConnection&&"Delegated"==this.IPv6SitePrefixConfigType&&(e=!0)}),0!=addAttrs(n))if($.wd.l3ForwardingObj.__ifName="",$.wd.l3ForwardingObj.defaultConnectionService="",INCLUDE_IPV6&&($.wd.l3Ip6ForwardingObj.__ifName="",$.wd.l3Ip6ForwardingObj.defaultConnectionService=""),null==$.wd.conn[$.wd.editIndex].type){var d={};if(""==(o=isConnDeviceExist())){if(d=$.act(ACT_ADD,WAN_CONN_DEVICE,null,$.wd.pStk),$.exe())return;"DSL"==$.sysMode&&(INCLUDE_VDSLWAN&&1==curSetIsPtm?$.act(ACT_SET,WAN_PTM_LINK_CFG,d.__stack,null,wanPtm):$.act(ACT_SET,WAN_DSL_LINK_CFG,d.__stack,null,wanDsl))}else{if("DSL"!=$.sysMode)return void $.alert(CMM_WAN_VID_CONFLICT);d.__stack=o}var a={},i={};if(INCLUDE_L2TP)a=$.act(ACT_GL,WAN_L2TP_CONN,null,null);if(INCLUDE_PPTP)i=$.act(ACT_GL,WAN_PPTP_CONN,null,null);!INCLUDE_L2TP&&!INCLUDE_PPTP||"l2tp"!=n&&"pptp"!=n?newConnApply(n,d,e,o):$.exe(function(t){t||(0<a.length?($.alert(CMM_WAN_L2TP_ALREADY_EXIST),$.removeLoading(),$.loadMain("wan.htm")):0<i.length?($.alert(CMM_WAN_PPTP_ALREADY_EXIST),$.removeLoading(),$.loadMain("wan.htm")):newConnApply(n,d,e,o))})}else if("l2tp"!=n&&"pptp"!=n&&(1!=e||s_str.cur_con!=dftGtw6.data("text")&&$.wd.conn[$.wd.editIndex].obj.name!=dftGtw6.data("text")||(wanArg.X_TP_PDEnabled=1)),"DSL"==$.sysMode)$.act(ACT_SET,n.indexOf("ppp")<0?WAN_IP_CONN:WAN_PPP_CONN,$.wd.conn[$.wd.editIndex].obj.__stack,null,wanArg);else if("ETH"==$.sysMode){if(0==addEthCfgAttrs())return;var o;if(""!=(o=isConnDeviceExist())&&o!=$.wd.conn[$.wd.editIndex].obj.__stack)return void $.alert(CMM_WAN_VID_CONFLICT);a={},i={};if(INCLUDE_L2TP&&("l2tp"==n||"pptp"==n))a=$.act(ACT_GL,WAN_L2TP_CONN,null,null);if(INCLUDE_PPTP&&("l2tp"==n||"pptp"==n))i=$.act(ACT_GL,WAN_PPTP_CONN,null,null);!INCLUDE_L2TP&&!INCLUDE_PPTP||"l2tp"!=n&&"pptp"!=n||"l2tp"==$.wd.conn[$.wd.editIndex].type||"pptp"==$.wd.conn[$.wd.editIndex].type?"dynamicIp"==$.wd.conn[$.wd.editIndex].type&&"dynamicIp"==n?($.act(ACT_OP,ACT_OP_DHCP_RELEASE,$.wd.conn[$.wd.editIndex].obj.__stack),$.exe()||$.timeout(function(){saveApply(n)},1500)):saveApply(n):$.exe(function(t){t||(0<a.length?($.alert(CMM_WAN_L2TP_ALREADY_EXIST),$.removeLoading(),$.loadMain("wan.htm")):0<i.length?($.alert(CMM_WAN_PPTP_ALREADY_EXIST),$.removeLoading(),$.loadMain("wan.htm")):saveApply(n))})}else saveApply(n)}),$("#link_type").click(function(){"bridge"==$("#link_type").data("value")?$("#divMacClone").addClass("nd"):$("#divMacClone").removeClass("nd"),$("#addLinkType").hasClass("nd")||(INCLUDE_WAN_VLAN&&"ipoa"!=$("#link_type").data("value")&&"pppoa"!=$("#link_type").data("value")?$("#dsl_vlan_add").removeClass("nd"):$("#dsl_vlan_add").addClass("nd"),doSync($("#link_type").data("value")))}),$("#cancelBtn").click(function(){$.loadMain("wan.htm")}),$("#divMacClone").on("click","input[type=radio]",function(t){switch(this.id){case"dftMac":$("#computerMacAddr, #customMacAddr").tpAddress("hide");break;case"pcMac":$("#customMacAddr").tpAddress("hide"),$("#computerMacAddr").tpAddress("show");break;case"customMac":$("#computerMacAddr").tpAddress("hide"),$("#customMacAddr").tpAddress("show")}})</script>
<div id="divDslCfg" class="nd"></div>
<div class="part-separate"></div>
<div id="eth-cfg"></div>
<div id="addLinkType" class="nd"><b class="T_conntype">Connection Type</b>
    <select id="link_type">
        <option class="T_staip" value="staticIp">Static IP</option>
        <option class="T_dynip" value="dynamicIp">Dynamic IP</option>
        <option class="T_pppoe" value="pppoe">PPPoE</option>
        <option class="T_pppoa" value="pppoa">PPPoA</option>
        <option class="T_ipoa" value="ipoa">IPoA</option>
        <option class="T_l2tp" value="l2tp">L2TP</option>
        <option class="T_pptp" value="pptp">PPTP</option>
        <option class="T_bridge" value="bridge">Bridge</option>
    </select>
</div>
<div class="pure-control-group cfg-line nd" id="editLinkType">
    <label class="label-title T_conntype">Connection Type:</label>
    <span class="text" id="linkTypeText"></span>
</div>
<div id="divStaIp" class="nd"></div>
<div id="divDynIp" class="nd"></div>
<div id="divPPPoE" class="nd"></div>
<div id="divPPPoA" class="nd"></div>
<div id="divIPoA" class="nd"></div>
<div id="divL2TP" class="nd"></div>
<div id="divPPTP" class="nd"></div>
<div id="divMacClone" class="part-separate">
    <h3 id="et2">MAC Clone</h3>
    <div>
        <input type="radio" name="macClone" id="dftMac" checked="checked">
        <label id="t_defMac" class="xl">Use Default MAC Address</label>
    </div>
    <div>
        <input type="radio" name="macClone" id="pcMac">
        <label id="t_computerMac" class="xl">Use Current Computer MAC Address</label>
        <input type="text" id="computerMacAddr" disabled="true" class="mac-address">
    </div>
    <div>
        <input type="radio" name="macClone" id="customMac">
        <label id="t_customMac" class="xl">Use Custom MAC Address</label>
        <input type="text" id="customMacAddr" class="mac-address">
    </div>
</div>
<div class="inline-btn-right part-separate">
    <div class="inline">
        <button type="submit" class="green T_cancel" id="cancelBtn">Cancel</button>
    </div>
    <div class="inline">
        <button type="submit" class="green T_save" id="saveConnBtn">Save</button>
    </div>
</div>
<script language="JavaScript">initDiv()</script>
