<script language="javascript">var step=0;if(INCLUDE_ADSLWAN)var dslStk="";var bStart=!1,failNotePre=n_str.quicksetup.c_internetFailed,reconfigPage=INCLUDE_ADSLWAN?"qsIsp.htm":"",removeLoadingFlag=!1,bDiagCompleted=!1,handler="",step2RetryCnt=5,step3RetryCnt=2,step4RetryCnt=30,bNeedOpenRoam=!1;if(INCLUDE_LTEWAN)var wanAccessType="",lteStk="",lteLinkCfg={},lteLinkCfgStk="",lteWanCfg={},lteIntfCfg={};function goAdvLte(){$.qd.internetDiag=0,$.goToOtherPage("advanceLte.htm","advanced")}function internetDiagInit(){if(INCLUDE_LTEWAN&&"LTE"==wanAccessType){var e=$.act(ACT_GL,WAN_LTE_LINK_CFG,null,null,["enable","simStatus"]);$.exe()||$.each(e,function(){if(1==this.enable&&$.stkPop(this.__stack,1)==lteStk)return lteLinkCfgStk=(lteLinkCfg=this).__stack,!1})}}function doInternetDiag(){var t={},n={},a="",i="",e=new Array,o="";switch(step){case 0:if(INCLUDE_LTEWAN&&"LTE"==wanAccessType){if(""==lteStk||""==lteLinkCfgStk)return void doFail();lteLinkCfg=$.act(ACT_GET,WAN_LTE_LINK_CFG,lteLinkCfgStk,null,["SimStatus"]),$.exe(function(e){return e?(diagRemoveLoading(),void $.alert(e)):3!=lteLinkCfg.simStatus&&5!=lteLinkCfg.simStatus?(i=0==lteLinkCfg.simStatus?s_str.lteNoSimOrErr:1==lteLinkCfg.simStatus?s_str.lteNoSim:2==lteLinkCfg.simStatus?s_str.lteSimErr:4==lteLinkCfg.simStatus?s_str.ltePinLocked:6==lteLinkCfg.simStatus?s_str.ltePukLocked:7==lteLinkCfg.simStatus?s_str.lteSimLockedForever:s_str.lteOtherSimErr,handler=function(){$("#err_note").html(failNotePre+" "+i),doFail(),$("#p_reconfig").addClass("nd"),$("#p_retest").removeClass("nd")},bDiagCompleted=!0,void(1==removeLoadingFlag&&handler())):(step++,void doInternetDiag())})}else{if(""==dslStk)return void doFail();t=$.act(ACT_GET,WAN_DSL_INTF_CFG,dslStk,null,["Status"]),$.exe(function(e){if(e)return diagRemoveLoading(),void $.alert(e);if("Up"==t.status)step++,doInternetDiag();else{if("NoSignal"==t.status)return handler=function(){$("#err_note").html(failNotePre+" "+s_str.dslSyncFail),doFail(),$("#p_reconfig").addClass("nd"),$("#p_retest").removeClass("nd")},bDiagCompleted=!0,void(1==removeLoadingFlag&&handler());setTimeout(doInternetDiag,1e3)}})}break;case 1:INCLUDE_LTEWAN&&"LTE"==wanAccessType?(lteLinkCfg=$.act(ACT_GET,WAN_LTE_LINK_CFG,lteLinkCfgStk,null,["networkType","roamingStatus","connectStatus","signalStrength"]),lteWanCfg=$.act(ACT_GET,LTE_WAN_CFG,lteLinkCfgStk,null,["dataSwitchStatus","networkPreferredMode","roamingEnabled"]),lteIntfCfg=$.act(ACT_GET,WAN_LTE_INTF_CFG,lteStk,null,["dataLimit"]),$.exe(function(e){if(e)return diagRemoveLoading(),void $.alert(e);if(2==lteLinkCfg.connectStatus||3==lteLinkCfg.connectStatus){if(0<--step4RetryCnt)return void setTimeout(doInternetDiag,1e3);step++,doInternetDiag()}else{if(4!=lteLinkCfg.connectStatus)return 0<--step2RetryCnt?void setTimeout(doInternetDiag,1e3):(handler=function(){reconfigPage="qsLte.htm",$("#err_note").html(failNotePre+" "+i),doFail(),$("#p_reconfig").removeClass("nd"),1==bNeedOpenRoam&&$("#p_reconfig").addClass("nd"),$("#p_retest").addClass("nd")},bDiagCompleted=!0,i=1!=lteWanCfg.dataSwitchStatus?s_str.lteDataSwtDis:2==lteIntfCfg.dataLimit?s_str.lteDataOverUsed:1==lteLinkCfg.roamingStatus&&1!=lteWanCfg.roamingEnabled?(bNeedOpenRoam=!0,'Data Roaming is disabled. Go to <span class="inline" onClick="goAdvLte()" style="color:#10ABE1;border-bottom:#10ABE1 solid 1px;cursor:pointer;vertical-align:baseline;font-size:15px">Advanced > Network > Internet</span> to enable this function if you want to use your mobile network\'s data roaming service.'):0==lteLinkCfg.signalStrength?s_str.lteNoSignalStrength:0==lteLinkCfg.networkType?s_str.lteModeErr:s_str.lteOtherFail,void(1==removeLoadingFlag&&handler()));if($.qd.changeLteAttrs)return setTimeout(doInternetDiag,5e3),void($.qd.changeLteAttrs=!1);step++,doInternetDiag()}})):(INCLUDE_IPV6?e.push("ConnectionStatus","X_TP_IPv6ConnStatus","X_TP_IPv4Enabled","X_TP_IPv6Enabled"):e.push("ConnectionStatus"),o=WAN_IP_CONN,"ppp"!=$.qd.type&&"pppoa"!=$.qd.type||(e.push("LastConnectionError"),o=WAN_PPP_CONN),n=$.act(ACT_GET,o,$.qd.newConn.stack,null,e),$.exe(function(e){if(e)return diagRemoveLoading(),void $.alert(e);if(a=n.connectionStatus,INCLUDE_IPV6&&0==n.X_TP_IPv4Enabled&&1==n.X_TP_IPv6Enabled&&(a=n.X_TP_IPv6ConnStatus),"Connected"==a)step++,doInternetDiag();else{if("Disconnected"==a||"Unconfigured"==a)return handler=function(){("ppp"==$.qd.type||"pppoa"==$.qd.type)&&"ERROR_AUTHENTICATION_FAILURE"==n.lastConnectionError?($("#err_note").html(n_str.quicksetup.t_pppAuthFail),reconfigPage="qsDsl.htm"):$("#err_note").html(failNotePre+" "+s_str.diagOtherFail),doFail(),$("#p_reconfig").removeClass("nd"),$("#p_retest").addClass("nd")},bDiagCompleted=!0,void(1==removeLoadingFlag&&handler());setTimeout(doInternetDiag,1e3)}}));break;case 2:diagTool=$.act(ACT_GET,DIAG_TOOL,null,null,["LastResult"]),$.exe(function(e){if(e)$.alert(e);else if(3==diagTool.lastResult)setTimeout(doInternetDiag,1e3);else if(1==bStart){if(step3RetryCnt--,1==diagTool.lastResult)handler=function(){diagRemoveLoading(),$.qd.internetDiag=3,doSucc()};else{if(0<step3RetryCnt)return bStart=!(step=2),void doInternetDiag();handler=function(){INCLUDE_LTEWAN&&"LTE"==wanAccessType&&(reconfigPage="qsLte.htm"),$("#err_note").html(failNotePre+" "+s_str.diagOtherFail),doFail(),$("#p_reconfig").removeClass("nd"),$("#p_retest").addClass("nd")}}bDiagCompleted=!0,1==removeLoadingFlag&&handler()}else bStart=!0,$.act(ACT_OP,ACT_OP_DIAG_STARTDIAG,diagTool.__stack),$.exe(function(e){e?$.alert(e):setTimeout(doInternetDiag,1e3)})})}}function diagAddLoading(){$("div.diag-loading").css("display","block"),$("div.quicksetup-button-container").addClass("nd")}function diagRemoveLoading(){$("div.diag-loading").css("display","none"),$("div.quicksetup-button-container").removeClass("nd")}function doFail(){diagRemoveLoading(),$("#diagSucc").addClass("nd"),$("#diagFailed").removeClass("nd")}function doSucc(){diagRemoveLoading(),$("#diagFailed").addClass("nd"),$("#diagSucc").removeClass("nd")}function doReconfig(){INCLUDE_ADSLWAN?("qsIsp.htm"==reconfigPage?$.qd.internetDiag=1:"qsDsl.htm"==reconfigPage&&($.qd.internetDiag=2),loadSubPage(reconfigPage)):INCLUDE_LTEWAN&&(""==reconfigPage?($.qd.internetDiag=1,showNoSimInfo()):"qsLte.htm"==reconfigPage&&($.qd.internetDiag=2,loadSubPage(reconfigPage)))}function doRetest(){$("#diagFailed").addClass("nd"),bDiagCompleted=removeLoadingFlag=!1,diagAddLoading(),setTimeout(function(){removeLoadingFlag=!0,1==bDiagCompleted&&handler&&handler()},1e3),doInternetDiag()}function goNext(){$.addLoading("#next"),$.qf.next()}function goPrev(){$.addLoading("#next"),$.qf.prev()}</script>
<div id="quicksetup_diag_container">
	<form class="pure-form pure-form-aligned">
		<div id="diagFailed" class="nd">
			<div>
				<div style="height:50px;display:block">
					<span id="quicksetup-icon-diag-failed"></span>
					<span class="T" id="t_sorry">Sorry</span>
				</div>
				<p><span id="err_note" style="font-size:15px"></span></p>
			</div>
			<p style="margin-left:70px;margin-top:20px" id="p_reconfig"><button type="submit" class="green left T_reconfig l_auto" id="btnReconfig" onclick="doReconfig()">Reconfig</button></p>
			<p style="margin-left:70px;margin-top:20px" id="p_retest"><button type="submit" class="green left T_retest l ru-xl" id="btnRetest" onclick="doRetest()">Retest</button></p>
		</div>
		<div id="diagSucc" class="nd">
			<div>
				<div style="height:50px;display:block;text-align:center;margin:0 auto">
					<span id="quicksetup-icon-diag-seccessed"></span>
					<span class="T" id="t_success">Success</span>
				</div>
			</div>
		</div>
		<div class="diag-loading">
			<p><span class="diag-loading-icon"></span></p>
			<p><span id="t_diagLoadingText"></span></p>
		</div>
	</form>
</div>
<div class="inline-btn-right quicksetup-button-container">
    <div class="inline">
        <button type="submit" class="green T_back" onclick="goPrev()">Back</button>
    </div>
    <div class="inline">
        <button type="submit" class="green T_next" id="next" onclick="goNext()">Next</button>
    </div>
</div>
<script language="javascript">var diagRet=!0;function init(){$.removeLoading();var e=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);$.exe(),$.each(e,function(){return INCLUDE_ADSLWAN&&"DSL"==this.WANAccessType?(wanAccessType=this.WANAccessType,dslStk=this.__stack,!1):INCLUDE_LTEWAN&&"LTE"==this.WANAccessType?(wanAccessType=this.WANAccessType,lteStk=this.__stack,!1):void 0}),internetDiagInit(),$.qd.internetDiag=0,diagAddLoading(),setTimeout(function(){removeLoadingFlag=!0,1==bDiagCompleted&&handler&&handler()},1e3),doInternetDiag()}init()</script>
