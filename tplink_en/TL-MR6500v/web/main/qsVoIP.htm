<div class="content-container">
    <p id="t_qsVoipInfo">Add telephone accounts to the router and start using the Telephony function right away.</p>
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span id="refresh" class="refresh-icon"></span>
                <label class="T_refresh">Refresh</label>
                <span id="add" class="add-icon"></span>
                <label class="T_add">Add</label>
                <span id="delAll" class="delete-all-icon"></span>
                <label class="T_delall">Delete All</label>
            </div>
        </div>
        <table id="table-number">
            <thead></thead>
            <tbody id="body-number">
                <tr id="edit-container-number" class="nd">
                    <td colspan="4">
                        <div>
                            <b class="T_telephonyprovider">Telephony Provider: </b>
                            <select id="provider_list">
                            </select>
                        </div>
                        <div id="_isp_advanced" class="nd">
                            <div class="advanced-block">
                                <span class="advanced-icon advanced-hide-icon" id="moreCfg" onclick="moreCfgSwitch(this)"></span>
                                <span class="T_adv">Advanced</span>
                            </div>
                            <div id="con_More" class="nd">
                                <div>
                                    <b class="T_registrarport">Registrar Port:</b>
                                    <input type="text" size="30" id="regPort" value="5060">
                                </div>
                                <div>
                                    <b class="T_sipproxy">SIP Proxy:</b>
                                    <input type="text" maxlength="42" id="SipProxyAddr" value="0.0.0.0">
                                </div>
                                <div>
                                    <b class="T_sipproxy">SIP Proxy:</b>
                                    <select id="SipProxyAddr_select"></select>
                                </div>
                                <div>
                                    <b class="T_sipproxyport">SIP Proxy Port:</b>
                                    <input type="text" size="30" id="SipProxyPort" value="5060">
                                </div>
                                <div>
                                    <b class="T_outboundproxy">Outbound Proxy:</b>
                                    <input type="text" maxlength="42" id="ObProxyAddr" value="0.0.0.0">
                                </div>
                                <div>
                                    <b class="T_outboundproxy">Outbound Proxy:</b>
                                    <select id="ObProxyAddr_select"></select>
                                </div>
                                <div>
                                    <b class="T_outboundproxyport">Outbound Proxy Port:</b>
                                    <input type="text" size="30" id="ObProxyPort" value="5060">
                                </div>
                                <br>
                                <div>
                                    <input type="checkbox" id="RegViaOB">
                                    <label class="T_label1">Register via Outbound Proxy</label>
                                </div>
                            </div>
                        </div>
                        <div class="inline-btn-right">
                            <button type="submit" class="green T_cancel" id="cancel">Cancel</button>
                            <button type="submit" class="green T_save" id="t_save">Save</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
	<div class="part-separate">
		<p id="t_cw_choose">In case of call waiting, please:</p>
		<form class="pure-form pure-form-aligned">
			<div>
				<input type="checkbox" name="cw_beep" id="cw_beep">
				<label id="t_cw_on">Prompt me of the third party call (send me a prompt tone)</label>
			</div>
			<div>
				<input type="checkbox" name="cw_busy" id="cw_busy">
				<label id="t_cw_off">Reject the third party call (send the third party a busy tone)</label>
			</div>
		</form>
	</div>
</div>
<div class="inline-btn-right quicksetup-button-container">
    <div class="inline">
        <button type="submit" class="green T_finish" id="next" onclick="goNext()">Finish</button>
    </div>
</div>
<script>$("#main").empty();var voipCodecs,editIsp,country,ips,ppps,curStk=[],curIndex=-1,editFlag=0,intervalArray=[],ItalyVoIPInternetMap=[[0,3],[0,12],[1,4],[1,14],[2,6],[2,16],[11,9]],GermanyVoIPInternetMap=[[0,0],[0,1],[0,30],[0,31],[1,2],[1,3],[1,32],[1,33],[2,4],[2,5],[2,34],[2,35],[2,36],[4,9],[5,6],[5,7],[5,37],[5,38],[6,14],[6,54],[7,20],[7,21],[7,57],[8,18],[8,19],[9,8],[9,39],[11,22],[11,64],[16,13],[16,41],[21,27],[21,71],[25,25],[29,62],[29,63],[30,29],[30,72],[31,23],[31,69]],headArray=[{text:table_str.status,width:"5%"},{text:table_str.telnumber,width:"25%"},{text:table_str.provider,width:"20%"},{text:table_str.modify,width:"20%"}];function getGermanyVoIPIspIndex(){var e=$.qd.country,t=-1;INCLUDE_ADSLWAN&&(t=$.qd.dsl.ispIdx);if("Germany"!=e&&"Italy"!=e||-1==t)return 500;if("Germany"==e){for(var i=0;i<GermanyVoIPInternetMap.length;i++)if(GermanyVoIPInternetMap[i][1]==t)return GermanyVoIPInternetMap[i][0]}else if("Italy"==e)for(i=0;i<ItalyVoIPInternetMap.length;i++)if(ItalyVoIPInternetMap[i][1]==t)return console.log(),ItalyVoIPInternetMap[i][0];return 500}function getStack(){var e=$.act(ACT_GL,XTP_MULTI_ISP,null,null,["multiExtension"]);if(0==$.exe()){for(var t=0;t<e.length;t++)if(!e[t].multiExtension||""==e[t].multiExtension)return curStk=e[t].__stack,curIndex=t,!0;return!(curIndex=-1)}}function doDel(t){$.confirm(c_str.voice_del_con,function(){var e={multiExtension:"",multiAccountInRoute:0,multiAuthPassword:"",multiAuthUserName:"",multiIspName:"",multiOutboundProxy:"0.0.0.0",multiOutboundProxyPort:5060,multiProfileName:"",multiProxyServer:"0.0.0.0",multiProxyServerPort:5060,multiRegisterViaOB:2,multiRegistrarServer:"0.0.0.0",multiRegistrarServerPort:5060,multiVoipNum:"",multiVoipPrefixNum:""};$.act(ACT_SET,XTP_MULTI_ISP,t,null,e),actForSendMsg(),$.exe(function(e){e||($.voipTelePhoneNumbersNeedToRefresh=!0,pageReload())})})}function doEdit(e){editFlag=1,curStk=e;var t=$.act(ACT_GET,XTP_MULTI_ISP,e,null,null);0==$.exe()&&($("#provider_list").ispMgr("data",t),editIsp=$("#provider_list").data("value"))}function moreCfgSwitch(e){$(e).hasClass("cln")?($("#con_More").addClass("nd"),$(e).removeClass("cln")):($("#con_More").removeClass("nd"),$(e).addClass("cln"))}function initTable(){var i=[],e=$.act(ACT_GL,XTP_MULTI_ISP,null,null,["multiProfileName","multiRegistrarServer","multiExtension","multiStatus","multiIspName","multiVoipPrefixNum","multiVoipNum"]);if(0==$.exe()){var a=0;$.each(e,function(){var e=0;if(this.multiExtension&&""!=this.multiExtension){e=parseInt(this.multiStatus,10)<=0?0:1;var t="["+this.__stack+"]";e?i.push([{text:"<span class='table-grid-icon conn-status' data-stack=\""+this.__stack+'"></span>',width:"5%"},{text:"1&1 Internet"===this.multiIspName?""+this.multiVoipPrefixNum+this.multiVoipNum:this.multiProfileName,width:"25%"},{text:"Other"==this.multiIspName?$.tpLang.s_str.otherprovider:this.multiIspName,width:"25%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+a+"' onclick='doEdit("+t+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+a+"' onclick='doDel("+t+");'></span>",width:"20%"}]):i.push([{text:"<span class='table-grid-icon disconn-status' data-stack=\""+this.__stack+'"></span>',width:"5%"},{text:"1&1 Internet"===this.multiIspName?""+this.multiVoipPrefixNum+this.multiVoipNum:this.multiProfileName,width:"25%"},{text:"Other"==this.multiIspName?$.tpLang.s_str.otherprovider:this.multiIspName,width:"25%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+a+"' onclick='doEdit("+t+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+a+"' onclick='doDel("+t+");'></span>",width:"20%"}])}a++}),$.initTableBody($("#table-number"),i),0<i.length&&!0===$.voipTelePhoneNumbersNeedToRefresh&&(refreshConnectStatus(),$.voipTelePhoneNumbersNeedToRefresh=null),0<i.length?refreshConnectStatus():setTimeout(function(){$("#add").click(),$("#cancel").hide()},500),$("#provider_list").ispMgr({domID:"_isp_advanced"})}}function refreshConnectStatus(r,l,i){r=r||1e3,l=l||15,i=i||3e3,$("#table-number span.table-grid-icon.disconn-status, #table-number span.table-grid-icon.conn-status").each(function(){var a=this,e=$(a).attr("data-stack");if(e){$(a).removeClass("disconn-status conn-status").addClass("loading-icon");var n=0,t=setInterval(function(){var i=setInterval(function(){if(0!=$("body").find($(a)).length){n++;var t=$.act(ACT_GET,XTP_MULTI_ISP,e,null,null);$.exe(function(e){e||(parseInt(t.multiStatus,10)<=0?l<=n&&($(a).removeClass("loading-icon").addClass("disconn-status"),clearInterval(i)):($(a).removeClass("loading-icon").addClass("conn-status"),clearInterval(i)))})}else clearInterval(i)},r);intervalArray.push(i),clearInterval(t)},i);intervalArray.push(t)}})}function pageReload(){for(loadSubPage("qsVoIP.htm");0<intervalArray.length;)clearInterval(intervalArray.pop())}function goNext(){var e={};e.enable=$("#cw_busy").prop("checked")?"1":"0",e.beepEnable=$("#cw_beep").prop("checked")?"1":"0",$.act(ACT_SET,VOICE_PROF_CW,voipCWList[0].__stack,null,e),actForSendMsg(),$.exe(),INCLUDE_CLOUD&&"br"!=$.qd.type?$.qf.next():$.qf.exit()}$("#delAll").click(function(){$.confirm(c_str.voice_del_allcon,function(){$.addLoading($(this));var e=!1,t=$.act(ACT_GL,XTP_MULTI_ISP,null,null,["multiExtension"]);if(0==$.exe()){for(var i=0;i<t.length;i++)if(t[i].multiExtension&&""!=t[i].multiExtension){var a={multiExtension:"",multiAccountInRoute:0,multiAuthPassword:"",multiAuthUserName:"",multiIspName:"",multiOutboundProxy:"0.0.0.0",multiOutboundProxyPort:5060,multiProfileName:"",multiProxyServer:"0.0.0.0",multiProxyServerPort:5060,multiRegisterViaOB:2,multiRegistrarServer:"0.0.0.0",multiRegistrarServerPort:5060,multiVoipNum:"",multiVoipPrefixNum:""};0==e&&(e=!0),$.act(ACT_SET,XTP_MULTI_ISP,t[i].__stack,null,a)}e?(actForSendMsg(),$.exe(function(e){$.removeLoading(),e||($.voipTelePhoneNumbersNeedToRefresh=!0,pageReload())})):$.removeLoading()}})}),$("#cancel").click(function(){pageReload()}),$("#t_save").click(function(){if($.addLoading($(this)),!$("#provider_list").ispMgr("check"))return $.removeLoading(),!1;var e=$("#provider_list").ispMgr("data"),t=$("#provider_list").data("value");if(editFlag&&editIsp!=t||!editFlag&&getStack()){var i,a={},n=$.act(ACT_GS,XTP_MULTIISP_CODEC_LIST,null,curStk,["multiCodec","multiPacketizationPeriod","multiPriority"]);if(0!=$.exe())return;for(i=0;i<n.length;i++)(a={}).multiPriority=$("#provider_list").ispMgr("codec",n[i].multiCodec),a.multiPacketizationPeriod="20",$.act(ACT_SET,XTP_MULTIISP_CODEC_LIST,n[i].__stack,null,a)}if(1===INCLUDE_AREACODE){var r=$("#provider_list").ispMgr("data","areaCode");if(""===areaCodeObj.areaCode&&(r||e.multiVoipPrefixNum)){var l=r||e.multiVoipPrefixNum;$.act(ACT_SET,XTP_IGD_AREA_CODE_CFG,areaCodeObj.__stack,null,["areaCode="+l,"enable=1"])}}e.multiIspName==$.tpLang.s_str.otherprovider&&(e.multiIspName="Other"),editFlag?($.act(ACT_SET,XTP_MULTI_ISP,curStk,null,e),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||($.voipTelePhoneNumbersNeedToRefresh=!0,pageReload())})):getStack()?($.act(ACT_SET,XTP_MULTI_ISP,curStk,null,e),actForSendMsg(),$.each(ips,function(){if("voip"==this.name&&0==this.enable)return $.act(ACT_SET,WAN_IP_CONN,this.__stack,null,["Enable=1"]),!1}),$.each(ppps,function(){if("voip"==this.name&&0==this.enable)return $.act(ACT_SET,WAN_PPP_CONN,this.__stack,null,["Enable=1"]),!1}),$.exe(function(e){$.removeLoading(),e||($.voipTelePhoneNumbersNeedToRefresh=!0,pageReload())})):$.alert(ERR_VOIP_ACCOUNT_MUCH_ADD_ERROR)}),$("#add").click(function(){$("#telekom_username").prop("value","anonymous@t-online.de"),$("#provider_list").ispMgr("select",getGermanyVoIPIspIndex()),$("#next span").html(m_str.skip)}),$("#refresh").click(function(){pageReload()}),function(){if(1!==INCLUDE_AREACODE||(areaCodeObj=$.act(ACT_GET,XTP_IGD_AREA_CODE_CFG,null,null,["enable","countryCode","areaCode"]),0==$.exe())){if($.initTableHead($("#table-number"),headArray),$("#table-number").tpTable(initTable),voipCWList=$.act(ACT_GL,VOICE_PROF_CW,null,null,null),ips=$.act(ACT_GL,WAN_IP_CONN,null,null,["Enable","Name"]),ppps=$.act(ACT_GL,WAN_PPP_CONN,null,null,["Enable","Name"]),!$.exe()){var e=voipCWList[0];1==e.enable?$("#cw_busy").prop("checked",!0):$("#cw_busy").prop("checked",!1),1==e.beepEnable?$("#cw_beep").prop("checked",!0):$("#cw_beep").prop("checked",!1)}$.tpInit()}}()</script>
