<style>body{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.inline .select-container{display:inline-block}.inline .select-container .tp-select .select-box{top:-1px}.rule-list-container{width:210px;display:inline-block;height:auto;position:relative}.rule-list-container h4.status{font-weight:400}.qos-panel.status-panel-main{padding:30px 0 0 15px}.qos-panel.status-panel-main .qos-list{margin-top:20px;height:165px;overflow-x:hidden;overflow-y:auto}.msg-container-wrapper.complex-msg{margin-top:-50%;width:650px}.qos-panel.status-panel-main .qos-list .qos-list-p{width:180px;padding:8px 0;border-bottom:1px solid #d9d9d9;cursor:pointer;position:relative;margin:0}.qos-display-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;width:130px;-moz-user-select:none;-webkit-user-select:none;user-select:none}span.qos-toggle-icon{vertical-align:middle;position:absolute;width:18px;height:18px;background:url(../img/icons-02.png) no-repeat -234px -36px}p.qos-list-p span.qos-toggle-icon{top:8px;right:35px}.type-title .qos-toggle-icon{top:18px;right:3px}.selected span.qos-toggle-icon{background:url(../img/icons-02.png) no-repeat -234px -18px}p.qos-list-p span.icon-del{position:absolute;background:url(../img/icons.png) no-repeat -222px -21px;display:inline-block;width:18px;height:18px;right:16px}.qos-item-detail{margin:10px 0;background-color:#f2f2f2;width:180px}.qos-item-detail.hidden{display:none}.qos-item-detail p{line-height:26px;margin:0}label.detail-label{display:inline-block;width:65px;margin-left:10px}label.detail-label.short{width:30px;margin-left:5px;padding-right:5px}.control-panel{margin-top:20px;margin-right:10px}div.msg-container div.button-container{display:inline-block;vertical-align:middle;margin-right:5px}div.msg-container div.inline-btn-right{margin-right:0}div.msg-content-container div.header-container h3{font-size:14px;color:#1a1a1a;margin-bottom:10px;border-bottom:none;padding-bottom:0}.type-title{font-weight:400;color:#1a1a1a;border-bottom:1px solid #ccc;position:relative;cursor:pointer}.app-info-cnt{margin:6px 0 25px}.widget-wrap-outer{position:relative;display:inline-block;vertical-align:middle}.checkbox-group-wrap{vertical-align:top;display:inline-block;position:relative}ul.checkbox-group-list-wrap{vertical-align:top;display:inline-block;margin-right:2px;padding:0;margin-top:0;list-style:outside none none}.app-info-name{width:130px;padding:2px 8px}</style>
<div id="tcHeader">
    <h3 id="t_et">QoS</h3>
</div>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div id="qosEnableBox">
            <b class="l" id="t_en">QoS:</b>
            <input type="checkbox" id="enableQoS">
            <label class="T_enable">Enable</label>
            <div style="display:inline-block;vertical-align:middle">
                <div style="display:table">
                    <div id="enable-qos-tips" style="display:table-cell;width:240px;color:#b2b2b2;height:20px;line-height:15px">
                    </div>
                </div>
            </div>
        </div>
        <div>
        <p class="cfg-line" id="t_qos_note">tips</p>
        </div>
        <div class="nd">
            <b class="l" id="t_type">Line Type:</b>
            <input type="radio" id="adsl_type" name="lineTypeRadio">
            <label>DSL</label>
            <input type="radio" id="other_type" name="lineTypeRadio">
            <label id="t_other">Other</label>
        </div>
        <div class="pure-control-group nd" id="curDslUp">
            <b class="l" id="t_dslUp">Current Up Stream Rate:</b>
            <input type="text" readonly="true" class="tp-input-text" id="upStreamCurrRate">
        </div>
        <div class="pure-control-group nd" id="curDslDown">
            <b class="l" id="t_dslDown">Current Down Stream Rate:</b>
            <input type="text" readonly="true" class="tp-input-text" id="downStreamCurrRate">
        </div>
        <div class="inline">
            <b id="t_upBandwidth" class="l">Upload Bandwidth:</b>
            <input type="text" maxlength="4" class="m" id="upBandwidth">
            <select id="upUnit" class="m">
                <option value="kbps" class="T_kbps">kbps</option>
                <option value="mbps" class="T_mbps">mbps</option>
            </select>
        </div>
        <div class="inline">
            <b id="t_downBandwidth" class="l">Download Bandwidth:</b>
            <input type="text" maxlength="4" class="m" id="downBandwidth">
            <select id="downUnit" class="m">
                <option value="kbps" class="T_kbps">kbps</option>
                <option value="mbps" class="T_mbps">mbps</option>
            </select>
        </div>
        <div id="iptvQos" class="nd">
            <div>
                <b class="l" id="t_iptv">IPTV QoS:</b>
                <input type="checkbox" id="en_iptvQos">
                <label class="T_enable">Enable</label>
            </div>
            <div id="div_iptvDetails" class="nd">
                <div>
                    <b id="t_iptvClass" class="l">IPTV Class</b>
                    <select id="iptvClass" class="">
                        <option class="T T_high" value="4">High</option>
                        <option class="T T_middle" value="3">Middle</option>
                        <option class="T T_low" value="2">Low</option>
                    </select>
                </div>
            </div>
        </div>
        <div id="voipQos" class="nd">
            <div>
                <b class="l" id="t_voip">VoIP QoS:</b>
                <input type="checkbox" id="en_voipQos">
                <label class="T_enable">Enable</label>
            </div>
        </div>
        <div class="advanced-block">
            <span class="advanced-icon advanced-hide-icon" id="moreCfg"></span>
            <span class="T_adv">Advanced</span>
        </div>
        <div id="con_More" class="nd">
            <div class="pure-control-group">
                <label class="label-title l T T_c_highPriority">High Priority:</label>
                <input type="text" data-slider="true" data-slider-range="0 ,100" data-slider-snap="true" data-slider-step="5" data-slider-highlight="true" id="high">
                <span class="output"></span>
            </div>
            <div class="pure-control-group">
                <label class="label-title l T T_c_middlePriority">Middle Priority:</label>
                <input type="text" data-slider="true" data-slider-range="0 ,100" data-slider-snap="true" data-slider-step="5" data-slider-highlight="true" id="middle">
                <span class="output"></span>
            </div>
            <div class="pure-control-group">
                <label class="label-title l T T_c_lowPriority">Low Priority:</label>
                <input type="text" data-slider="true" data-slider-range="0 ,100" data-slider-snap="true" data-slider-step="5" data-slider-highlight="true" id="low">
                <span class="output"></span>
            </div>
        </div>
        <div id="saveBtn">
            <p class="br"></p>
            <div class="btn-right">
                <button type="submit" class="green T_save" id="editOK">Save</button>
            </div>
        </div>
    </form>
    <p class="br"></p>
    <h3 id="t_et2">QoS Rule List</h3>
    <div class="content-container">
        <div class="rule-list-container">
            <h4 class="status">
                <span class="T T_c_highPriority">High Priority:</span> <span id="highValue"></span>
            </h4>
            <div class="status-panel-main qos-panel">
                <div class="qos-list" id="highList">
                </div>
                <div class="control-panel">
                    <button type="submit" class="blue T_add" id="addHigh">Add</button>
                </div>
            </div>
        </div>
        <div class="rule-list-container">
            <h4 class="status">
                <span class="T T_c_middlePriority">Middle Priority:</span> <span id="middleValue"></span>
            </h4>
            <div class="status-panel-main qos-panel">
                <div class="qos-list" id="middleList">
                </div>
                <div class="control-panel">
                    <button type="submit" class="blue T_add" id="addMiddle">Add</button>
                </div>
            </div>
        </div>
        <div class="rule-list-container">
            <h4 class="status">
                <span class="T T_c_lowPriority">Low Priority:</span> <span id="lowValue"></span>
            </h4>
            <div class="status-panel-main qos-panel">
                <div class="qos-list" id="lowList">
                </div>
                <div class="control-panel">
                    <button type="submit" class="blue T_add" id="addLow">Add</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>!function(){var i,f,n=11,o=21,d=22,p=23,C=4,w=3,L=2;function b(e){if(f=$.act(ACT_GL,IQOS_RULE,null,null),$("#highList").empty(),$("#middleList").empty(),$("#lowList").empty(),!$.exe()){var l=0;$.each(f,function(){var e={};if(this.type==n){var t=this.macAddress;e[$.tpLang.qosSettings_nstr.c_mac]=t.replace(/\:/g,"-");var s=$.tpLang.qosSettings_nstr.c_none,a=$.act(ACT_GL,LAN_HOST_ENTRY,null,null);$.exe()||$.each(a,function(){this.MACAddress==t&&1==this.active&&(s=this.IPAddress)}),e[$.tpLang.qosSettings_nstr.c_ip]=s}this.type,this.type==p&&(e[$.tpLang.table_str.protocol]=$.tpLang.qosSettings_nstr.t_all,this.srcPort==this.endPort?e[$.tpLang.table_str.port]=this.srcPort:e[$.tpLang.table_str.port]=this.srcPort+"-"+this.endPort),this.type==o&&(e[$.tpLang.table_str.protocol]=$.tpLang.qosSettings_nstr.t_tcp,this.srcPort==this.endPort?e[$.tpLang.table_str.port]=this.srcPort:e[$.tpLang.table_str.port]=this.srcPort+"-"+this.endPort),this.type==d&&(e[$.tpLang.table_str.protocol]=$.tpLang.qosSettings_nstr.t_udp,this.srcPort==this.endPort?e[$.tpLang.table_str.port]=this.srcPort:e[$.tpLang.table_str.port]=this.srcPort+"-"+this.endPort),this.prioClass==C?r(l,"high",this.appName,e):this.prioClass==w?r(l,"middle",this.appName,e):this.prioClass==L&&r(l,"low",this.appName,e),l++}),$.isFunction(e)&&e()}}$.qosVar={},$("#en_iptvQos").on("click",function(){1==$(this).prop("data-checked")?$("#div_iptvDetails").removeClass("nd"):$("#div_iptvDetails").addClass("nd")}),$("#addHigh").on("click",function(){$.qosVar.newRuleClass=C,$.complexMsg("qosRule.htm")}),$("#addMiddle").on("click",function(){$.qosVar.newRuleClass=w,$.complexMsg("qosRule.htm")}),$("#addLow").on("click",function(){$.qosVar.newRuleClass=L,$.complexMsg("qosRule.htm")}),$("#editOK").on("click",function(){$.addLoading($(this)),function(){var e={},t=$("#upUnit").data("value"),s=$("#downUnit").data("value"),a=$("#iptvClass").data("value");e.enable=$("#enableQoS").prop("data-checked")?1:0,INCLUDE_ADSLWAN?$("#adsl_type").prop("checked"):e.linkType=0;"mbps"==t?e.upUnit=1:"kbps"==t&&(e.upUnit=2);if(""==$("#upBandwidth").val()||!$.isnum($("#upBandwidth").val())||parseInt($("#upBandwidth").val(),10)<1||1e3<parseInt($("#upBandwidth").val(),10))return $.alert(CMM_IQOS_BANDWIDTH_ERR),u($("#upBandwidth"));e.upTotalBW=parseInt($("#upBandwidth").val(),10),"mbps"==s?e.downUnit=1:"kbps"==s&&(e.downUnit=2);if(""==$("#upBandwidth").val()||!$.isnum($("#downBandwidth").val())||parseInt($("#downBandwidth").val(),10)<1||1e3<parseInt($("#downBandwidth").val(),10))return $.alert(CMM_IQOS_BANDWIDTH_ERR),u($("#downBandwidth"));e.downTotalBW=parseInt($("#downBandwidth").val(),10),INCLUDE_IPTV&&(e.iptvEnable=$("#en_iptvQos").prop("data-checked")?1:0,e.iptvClass=a);INCLUDE_VOIP&&(e.voIPEnable=$("#en_voipQos").prop("data-checked")?1:0);e.high=$("#high").prop("value"),e.middle=$("#middle").prop("value"),e.low=$("#low").prop("value"),$.act(ACT_GET,IQOS,null,null,i),$.exe(),e.guestEnable=i.guestEnable,e.guestClass=i.guestClass;var l=$.act(ACT_GET,ALG_CFG,null,null);$.exe(),"1"==l.hw_nat_enable?$.confirm(c_str.qos_hwnat_conflict,function(){l.hw_nat_enable="0",$.act(ACT_SET,ALG_CFG,null,null,l),$.exe(function(e){e||($.removeLoading(),$.reload())}),$.act(ACT_SET,IQOS,null,null,e),$.exe(function(e){e||($.removeLoading(),$.reload())})},function(){$.reload()}):($.act(ACT_SET,IQOS,null,null,e),$.exe(function(e){e||($.removeLoading(),$.reload())}),$.removeLoading(),$.reload())}()}),$("#moreCfg").on("click",function(){var e=this;$(e).hasClass("cln")?($("#con_More").addClass("nd"),$(e).removeClass("cln")):($("#con_More").removeClass("nd"),$(e).addClass("cln"))});var S=!1;function r(s,e,t,a){var l=$("#"+e+"List"),i=$('<div class="qos-item-container">'),n=$('<p class="qos-list-p" id="_rule'+s+'"><span class="qos-display-name">'+t+'</span><span class="qos-toggle-icon"></span><span class="icon-del"></span></p>');i.append(n);var o=0,d=!1,p='<div class="qos-item-detail hidden">';for(var r in a)o++,r==$.tpLang.qosSettings_nstr.c_mac&&(d=!0),p+='<p><label class="detail-label">'+r+":</label><span>"+a[r]+"</span>";p+="</div>";var u=$(p);d&&u.find("label.detail-label").addClass("short"),i.append(u),l.append(i),0==o?n.find(".qos-toggle-icon").css("background","none"):$(n).on("click",function(e){!0!==S&&($(this).toggleClass("selected"),$(this).hasClass("selected")?$(this).next(".qos-item-detail").first().removeClass("hidden"):$(this).next(".qos-item-detail").first().addClass("hidden"))}),$(n).find(".qos-toggle-icon").on("click",function(e){e.stopPropagation();var t=$(this).closest(".qos-list-p");t.toggleClass("selected"),t.hasClass("selected")?t.next(".qos-item-detail").first().removeClass("hidden"):t.next(".qos-item-detail").first().addClass("hidden")}).on("mousedown",function(e){e.stopPropagation()}),$(n).find(".icon-del").on("click",function(e){var t;e.stopPropagation(),t=s,$.addLoading(),$.act(ACT_DEL,IQOS_RULE,f[t].__stack,null),$.exe(function(e){$.removeLoading(),e||$.reload()})}).on("mousedown",function(e){e.stopPropagation()})}function u(e){e&&(e.focus(),e.select())}$(".rule-list-container").on("mousedown","div.qos-item-container .qos-list-p",function(e){S=!1;var m=this,u=$(this).closest(".content-container"),c=e.offsetX,h=e.offsetY,g=$(this).closest(".rule-list-container"),_=$(this).closest("div.qos-item-container");$("body").off("mousemove.qos").on("mousemove.qos",function(e){S=!0;var t=$(g).offset().left,s=$(g).offset().top,a=u.offset().left,l=u.offset().top,i=a+u.width(),n=l+u.height(),o=e.clientX,d=e.clientY;o<a?o=a:i<o&&(o=i),d<l?d=l:n<d&&(d=n);var p=o-t-c,r=d-s-h;_.css({left:p,top:r,"z-index":999,position:"absolute"})}),$("body").off("mouseup.qos").on("mouseup.qos",function(e){if($("body").off(".qos"),!0===S){for(var t=$(".rule-list-container"),s=e.clientX,a=e.clientY,l=null,i=0,n=t.length;i<n;i++){var o=$(t[i]),d=o.offset().left,p=o.offset().top,r=d+o.width(),u=p+o.height();if(d<=s&&s<=r&&p<=a&&a<=u){l=o;break}}if(null===l||l[0]===g[0])_.css({position:"static",left:0,top:0,"z-index":0});else{var c;0<l.find("#highList").length?c=C:0<l.find("#middleList").length?c=w:0<l.find("#lowList").length&&(c=L);var h=$(m).attr("id").match(/_rule(\d+)$/)[1];$(m).remove(),$.act(ACT_DEL,IQOS_RULE,f[h].__stack,null);var v=$.extend({},f[h]);delete v.__stack,v.prioClass=c,$.addLoading(),$.act(ACT_ADD,IQOS_RULE,null,null,v),$.exe(function(){b(function(){$.removeLoading()})})}}})}),$.tpInit(function(){if($("[data-slider]").each(function(){var e,l,t,i;return e=$(this),t={},(l=e.data("slider-values"))&&(t.allowedValues=function(){var e,t,s,a;for(s=l.split(","),a=[],e=0,t=s.length;e<t;e++)i=s[e],a.push(parseFloat(i));return a}()),e.data("slider-range")&&(t.range=e.data("slider-range").split(",")),e.data("slider-step")&&(t.step=e.data("slider-step")),t.snap=e.data("slider-snap"),t.equalSteps=e.data("slider-equal-steps"),e.data("slider-theme")&&(t.theme=e.data("slider-theme")),e.attr("data-slider-highlight")&&(t.highlight=e.data("slider-highlight")),null!=e.data("slider-animate")&&(t.animate=e.data("slider-animate")),e.simpleSlider(t)}),$("#high").bind("slider:ready slider:changed",function(e,t){var s=100-$("#high").prop("value")-$("#low").prop("value")>$("#high").prop("value")-5?$("#high").prop("value")-5:100-$("#high").prop("value")-$("#low").prop("value");$("#middle").simpleSlider("setLimits",10,s);var a=100-$("#high").prop("value")-$("#middle").prop("value")>$("#middle").prop("value")-5?$("#middle").prop("value")-5:100-$("#high").prop("value")-$("#middle").prop("value");$("#low").simpleSlider("setLimits",5,a),$(this).nextAll(".output:first").html(parseInt(t.value)+"%")}),$("#middle").bind("slider:ready slider:changed",function(e,t){var s=100-$("#high").prop("value")-$("#middle").prop("value")>$("#middle").prop("value")-5?$("#middle").prop("value")-5:100-$("#high").prop("value")-$("#middle").prop("value");$("#low").simpleSlider("setLimits",5,s);var a=100-$("#middle").prop("value")-$("#low").prop("value");a>=$("#high").prop("value")&&$("#high").simpleSlider("setLimits",15,a),$(this).nextAll(".output:first").html(parseInt(t.value)+"%")}),$("#low").bind("slider:ready slider:changed",function(e,t){var s=100-$("#middle").prop("value")-$("#low").prop("value");s>=$("#high").prop("value")&&$("#high").simpleSlider("setLimits",15,s);var a=100-$("#high").prop("value")-$("#low").prop("value")>$("#high").prop("value")-5?$("#high").prop("value")-5:100-$("#high").prop("value")-$("#low").prop("value");a>=$("#middle").prop("value")&&$("#middle").simpleSlider("setLimits",10,a),$(this).nextAll(".output:first").html(parseInt(t.value)+"%")}),i=$.act(ACT_GET,IQOS,null,null),algEntry=$.act(ACT_GET,ALG_CFG,null,null),$.exe()||($("#enableQoS").prop("checked",0!=i.enable),Number(algEntry.hw_nat_enable)&&$("#enable-qos-tips").html($.tpLang.qosSettings_nstr.t_enable_tips),1==i.linkType?$("#adsl_type").prop("checked",!0):$("#other_type").prop("checked",!0),$("#upBandwidth").val(i.upTotalBW),1==i.upUnit?$('#upUnit option[value="mbps"]').prop("selected","selected"):2==i.upUnit&&$('#upUnit option[value="kbps"]').prop("selected","selected"),$("#downBandwidth").val(i.downTotalBW),1==i.downUnit?$('#downUnit option[value="mbps"]').prop("selected","selected"):2==i.downUnit&&$('#downUnit option[value="kbps"]').prop("selected","selected"),INCLUDE_IPTV&&"ETH"==$.sysMode&&($("#iptvQos").removeClass("nd"),$("#en_iptvQos").prop("checked",0!=i.iptvEnable),1==i.iptvEnable&&($("#div_iptvDetails").removeClass("nd"),$('#iptvClass option[value="'+i.iptvClass+'"]').prop("selected","selected"))),INCLUDE_VOIP&&($("#voipQos").removeClass("nd"),$("#en_voipQos").prop("checked",0!=i.voIPEnable)),$("#high").simpleSlider("setValue",i.high),$("#middle").simpleSlider("setValue",i.middle),$("#low").simpleSlider("setValue",i.low),$("#highValue").text(i.high+"%"),$("#middleValue").text(i.middle+"%"),$("#lowValue").text(i.low+"%")),INCLUDE_ADSLWAN){var e,t=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);$.exe()||$.each(t,function(){"DSL"==this.WANAccessType?e=this.__stack:"Ethernet"==this.WANAccessType&&this.__stack});var s=$.act(ACT_GET,WAN_DSL_INTF_CFG,e,null,["status","upstreamCurrRate","downstreamCurrRate"]);$.exe()||(wanDslStatus=s.status,"Up"==s.status&&($("#curDslUp").removeClass("nd"),$("#curDslDown").removeClass("nd"),$("#upStreamCurrRate").prop("value",s.upstreamCurrRate+" "+s_str.kbps),$("#downStreamCurrRate").prop("value",s.downstreamCurrRate+" "+s_str.kbps)))}b()})}()</script>
