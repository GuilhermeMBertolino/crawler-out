<h3 class="T" id="t_st0">Telephony Mode</h3>
<div class="content-container">
    <p class="cfg-line T_selectmode">Select the telephony mode.</p>
    <form class="pure-form pure-form-aligned">
        <div id="voip-mode">
            <input type="radio" name="voipMode" onclick="selectMode(1)" id="voip-opt">
            <label id="t_st1">VoIP</label>
            <input type="radio" name="voipMode" onclick="selectMode(0)" id="volte-opt">
            <label class="T_volte">VoLTE</label>
        </div>
    </form>
	<div style="text-align:right" class="part-separate">
        <button type="submit" class="green inline T_save" id="voice_save" onclick="saveModeSwitch(event,0)">Save</button>
    </div>
</div>
<div id="volte-field" class="nd">
    <hr style="margin-bottom:30px;border-top:0 none;border-bottom:1px solid #ccc">
    <form class="pure-form pure-form-aligned">
        <div class="button-group-container" id="a_mobileDataSwitch">
            <b class="xl T_volte">VoLTE</b>
            <ul><li><button id="volte-enable" class="fst" value="on" onclick="toggleVolteSwitch(event,1)">On</button></li>
                <li><button id="volte-disable" class="lst" value="off" onclick="toggleVolteSwitch(event,0)">Off</button></li>
            </ul>
        </div>
    </form>
    <p class="cfg-line T_enablelte" style="margin-top:16px;margin-bottom:30px">By enabling this mode, you can make or receive phone calls over the 4G LTE network.</p>
    <p class="cfg-line T_carriersupport" style="color:#a7a9ac">Note: To use this feature, your carrier must also support VoLTE calls. If you are not sure about it, contact your carrier for help.</p>
</div>
<div id="voip-field" class="nd">
<h3 class="T" id="t_et">Telephone Numbers</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span id="refresh" class="refresh-icon"></span>
                <label class="T_refresh">Refresh</label>
                <span id="add" class="add-icon"></span>
                <label class="T_add">Add</label>
                <span id="delAll" class="delete-all-icon"></span>
                <label class="T_delall">Delete All</label>
            </div>
        </div>
        <table id="table-number">
            <thead></thead>
            <tbody id="body-number">
                <tr id="edit-container-number" class="nd">
                    <td colspan="4">
                        <div>
                            <b class="T_telephonyprovider">Telephony Provider: </b>
                            <select id="provider_list">
                            </select>
                        </div>
                        <div id="_isp_advanced" class="nd">
                            <div class="advanced-block">
                                <span class="advanced-icon advanced-hide-icon" id="moreCfg" onclick="moreCfgSwitch(this)"></span>
                                <span class="T_adv">Advanced</span>
                            </div>
                            <div id="con_More" class="nd">
                                <div>
                                    <b class="T_registrarport">Registrar Port:</b>
                                    <input type="text" size="30" id="regPort" value="5060">
                                </div>
                                <div>
                                    <b class="T_sipproxy">SIP Proxy:</b>
                                    <input type="text" maxlength="42" id="SipProxyAddr" value="0.0.0.0">
                                </div>
                                <div>
                                    <b class="T_sipproxy">SIP Proxy:</b>
                                    <select id="SipProxyAddr_select"></select>
                                </div>
                                <div>
                                    <b class="T_sipproxyport">SIP Proxy Port:</b>
                                    <input type="text" size="30" id="SipProxyPort" value="5060">
                                </div>
                                <div>
                                    <b class="T_outboundproxy">Outbound Proxy:</b>
                                    <input type="text" maxlength="42" id="ObProxyAddr" value="0.0.0.0">
                                </div>
                                <div>
                                    <b class="T_outboundproxy">Outbound Proxy:</b>
                                    <select id="ObProxyAddr_select"></select>
                                </div>
                                <div>
                                    <b class="T_outboundproxyport">Outbound Proxy Port:</b>
                                    <input type="text" size="30" id="ObProxyPort" value="5060">
                                </div>
                                <br>
                                <div>
                                    <input type="checkbox" id="RegViaOB">
                                    <label class="T_label1">Register via Outbound Proxy</label>
                                </div>
                            </div>
                        </div>
                        <div class="inline-btn-right">
                            <button type="submit" class="green T_cancel" id="cancel">Cancel</button>
                            <button type="submit" class="green T_save" id="t_save">Save</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</div>
<div id="areacodePanel" class="nd">
    <h3 class="T" id="t_et1">Area Code Setting</h3>
    <div class="content-container">
        <form class="pure-form pure-form-aligned">
            <p class="cfg-line T_areacodeinfo"> By enabling and entering your area code here</p>
            <div class="button-group-container">
                <b class="T" id="t_status">Status:</b>
                <ul>
                    <li>
                        <button id="AreaCode_on" class="fst" value="on">On</button>
                    </li>
                    <li>
                        <button id="AreaCode_off" class="lst" value="off">Off</button>
                    </li>
                </ul>
            </div>
            <div>
                <b class="T_areacode1">AreaCode: </b>
                <input type="text" maxlength="8" id="AreaCode">
            </div>
            <div class="btn-right">
                <button type="submit" class="green T_save" id="saveAreaCode">Save</button>
            </div>
        </form>
    </div>
</div>
</div>
<script>var voipCodecs,country,switchObj,editIsp,ips,ppps,curStk=[],curIndex=-1,editFlag=0,intervalArray=[],NWK_PREFER_MODE_2G_ONLY=0,NWK_PREFER_MODE_3G_ONLY=1,NWK_PREFER_MODE_4G_ONLY=2,NWK_PREFER_MODE_4G_FIRST=3,headArray=[{text:table_str.status,width:"5%"},{text:table_str.telnumber,width:"25%"},{text:table_str.provider,width:"20%"},{text:table_str.modify,width:"20%"}];function init(){var e,t;if($.removeLoading(),1===INCLUDE_AREACODE){if(areaCodeObj=$.act(ACT_GET,XTP_IGD_AREA_CODE_CFG,null,null,["enable","countryCode","areaCode"]),0!=$.exe())return;1==areaCodeObj.enable?($("#AreaCode_on").addClass("selected"),$("#AreaCode_off").removeClass("selected"),$("#AreaCode").prop("disabled",!1)):($("#AreaCode_off").addClass("selected"),$("#AreaCode_on").removeClass("selected"),$("#AreaCode").prop("disabled",!0)),$("#AreaCode").prop("value",areaCodeObj.areaCode)}$.initTableHead($("#table-number"),headArray),$("#table-number").tpTable(initTable),switchObj=$.act(ACT_GET,SYS_MODE,null,null,["VOIPSwitch","VOLTESwitch"]),ips=$.act(ACT_GL,WAN_IP_CONN,null,null,["Enable","Name"]),ppps=$.act(ACT_GL,WAN_PPP_CONN,null,null,["Enable","Name"]),$.exe()||(e=switchObj.VOIPSwitch,t=switchObj.VOLTESwitch,selectMode(e),"1"==e?($("#voip-field").show(),$("#volte-field").hide()):($("#voip-field").hide(),$("#volte-field").show()),"1"==t?($("#volte-enable").addClass("selected"),$("#volte-disable").removeClass("selected")):($("#volte-enable").removeClass("selected"),$("#volte-disable").addClass("selected")))}function getStack(){var e=$.act(ACT_GL,XTP_MULTI_ISP,null,null,["multiExtension"]);if(0==$.exe()){for(var t=0;t<e.length;t++)if(!e[t].multiExtension||""==e[t].multiExtension)return curStk=e[t].__stack,curIndex=t,!0;return!(curIndex=-1)}}function doDel(t){$.confirm(c_str.voice_del_con,function(){var e={multiExtension:"",multiAccountInRoute:0,multiAuthPassword:"",multiAuthUserName:"",multiIspName:"",multiOutboundProxy:"0.0.0.0",multiOutboundProxyPort:5060,multiProfileName:"",multiProxyServer:"0.0.0.0",multiProxyServerPort:5060,multiRegisterViaOB:2,multiRegistrarServer:"0.0.0.0",multiRegistrarServerPort:5060,multiVoipNum:"",multiVoipPrefixNum:""};$.act(ACT_SET,XTP_MULTI_ISP,t,null,e),actForSendMsg(),$.exe(function(e){e||($.voipTelePhoneNumbersNeedToRefresh=!0,pageReload())})})}function doEdit(e){editFlag=1,curStk=e;var t=$.act(ACT_GET,XTP_MULTI_ISP,e,null,null);0==$.exe()&&($("#provider_list").ispMgr("data",t),editIsp=$("#provider_list").data("value"))}function enterCheckArea(){var e,t,i;try{i=s_str.areacode,t=$("#AreaCode"),e=getValue("AreaCode",i,0,8,!1),t.get(0).value=e,checkNum(t,i)}catch(e){if(!1===e)return!1;throw e}}function moreCfgSwitch(e){$(e).hasClass("cln")?($("#con_More").addClass("nd"),$(e).removeClass("cln")):($("#con_More").removeClass("nd"),$(e).addClass("cln"))}function initTable(){var i=[],e=$.act(ACT_GL,XTP_MULTI_ISP,null,null,["multiProfileName","multiRegistrarServer","multiExtension","multiStatus","multiIspName","multiVoipPrefixNum","multiVoipNum"]);if(0==$.exe()){var a=0;$.each(e,function(){var e=0;if(this.multiExtension&&""!=this.multiExtension){e=parseInt(this.multiStatus,10)<=0?0:1;var t="["+this.__stack+"]";e?i.push([{text:"<span class='table-grid-icon conn-status' data-stack=\""+this.__stack+'"></span>',width:"5%"},{text:"1&1 Internet"===this.multiIspName?""+this.multiVoipPrefixNum+this.multiVoipNum:this.multiProfileName,width:"25%"},{text:"Other"==this.multiIspName?$.tpLang.s_str.otherprovider:this.multiIspName,width:"25%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+a+"' onclick='doEdit("+t+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+a+"' onclick='doDel("+t+");'></span>",width:"20%"}]):i.push([{text:"<span class='table-grid-icon disconn-status' data-stack=\""+this.__stack+'"></span>',width:"5%"},{text:"1&1 Internet"===this.multiIspName?""+this.multiVoipPrefixNum+this.multiVoipNum:this.multiProfileName,width:"25%"},{text:"Other"==this.multiIspName?$.tpLang.s_str.otherprovider:this.multiIspName,width:"25%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+a+"' onclick='doEdit("+t+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+a+"' onclick='doDel("+t+");'></span>",width:"20%"}])}a++}),$.initTableBody($("#table-number"),i),0<i.length&&!0===$.voipTelePhoneNumbersNeedToRefresh&&(refreshConnectStatus(),$.voipTelePhoneNumbersNeedToRefresh=null),$("#provider_list").ispMgr({domID:"_isp_advanced"})}}function refreshConnectStatus(l,o,i){l=l||1e3,o=o||15,i=i||3e3,$("#table-number span.table-grid-icon.disconn-status, #table-number span.table-grid-icon.conn-status").each(function(){var a=this,e=$(a).attr("data-stack");if(e){$(a).removeClass("disconn-status conn-status").addClass("loading-icon");var r=0,t=setInterval(function(){var i=setInterval(function(){if(0!=$("body").find($(a)).length){r++;var t=$.act(ACT_GET,XTP_MULTI_ISP,e,null,null);$.exe(function(e){e||(parseInt(t.multiStatus,10)<=0?o<=r&&($(a).removeClass("loading-icon").addClass("disconn-status"),clearInterval(i)):($(a).removeClass("loading-icon").addClass("conn-status"),clearInterval(i)))})}else clearInterval(i)},l);intervalArray.push(i),clearInterval(t)},i);intervalArray.push(t)}})}function selectMode(e){"1"==e?$("#voip-opt").prop("checked",!0):$("#volte-opt").prop("checked",!0)}function saveModeSwitch(e){var t={};$("#voip-opt").prop("checked")?t.VOIPSwitch="1":$("#volte-opt").prop("checked")&&(t.VOIPSwitch="0"),$.addLoading(),$.act(ACT_SET,SYS_MODE,null,null,t),$.exe(function(e){$.VOIPSwitch=parseInt(t.VOIPSwitch),$.reloadMenu($.curPage)})}function toggleVolteSwitch(e,r){$.addLoading($(e.target)),$.act(ACT_SET,SYS_MODE,switchObj.__stack,null,["VOLTESwitch="+r]),$.exe(function(e){var t,i=$.act(ACT_GL,LTE_WAN_CFG,null,null,["networkPreferredMode"]),a=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);$.exe()||($.each(a,function(){"LTE"==this.WANAccessType&&(t=this.__stack)}),$.each(i,function(){var e=$.stkPop(this.__stack,1);if(t==e){this.__stack;"0"==r&&this.networkPreferredMode==NWK_PREFER_MODE_4G_ONLY&&($.act(ACT_SET,LTE_WAN_CFG,this.__stack,null,["networkPreferredMode="+NWK_PREFER_MODE_4G_FIRST]),$.exe())}})),$.removeLoading(),e||$.reload()})}function pageReload(){for(;0<intervalArray.length;)clearInterval(intervalArray.pop());$.reload()}1===INCLUDE_AREACODE&&($("#areacodePanel").show(),$("#AreaCode_on").click(function(){$.addLoading($(this)),$.act(ACT_SET,XTP_IGD_AREA_CODE_CFG,areaCodeObj.__stack,null,["enable=1"]),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()}),$("#AreaCode").prop("disabled",!1)}),$("#AreaCode_off").click(function(){$.addLoading($(this)),$.act(ACT_SET,XTP_IGD_AREA_CODE_CFG,areaCodeObj.__stack,null,["enable=0"]),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()}),$("#AreaCode").prop("disabled",!0)}),$("#saveAreaCode").click(function(){if($.addLoading($(this)),0==enterCheckArea())return!1;var e=$("#AreaCode").prop("value");$.act(ACT_SET,XTP_IGD_AREA_CODE_CFG,areaCodeObj.__stack,null,["areaCode="+e]),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()})})),$("#delAll").click(function(){$.confirm(c_str.voice_del_allcon,function(){$.addLoading($(this));var e=!1,t=$.act(ACT_GL,XTP_MULTI_ISP,null,null,["multiExtension"]);if(0==$.exe()){for(var i=0;i<t.length;i++)if(t[i].multiExtension&&""!=t[i].multiExtension){var a={multiExtension:"",multiAccountInRoute:0,multiAuthPassword:"",multiAuthUserName:"",multiIspName:"",multiOutboundProxy:"0.0.0.0",multiOutboundProxyPort:5060,multiProfileName:"",multiProxyServer:"0.0.0.0",multiProxyServerPort:5060,multiRegisterViaOB:2,multiRegistrarServer:"0.0.0.0",multiRegistrarServerPort:5060,multiVoipNum:"",multiVoipPrefixNum:""};0==e&&(e=!0),$.act(ACT_SET,XTP_MULTI_ISP,t[i].__stack,null,a)}e?(actForSendMsg(),$.exe(function(e){$.removeLoading(),e||($.voipTelePhoneNumbersNeedToRefresh=!0,pageReload())})):$.removeLoading()}})}),$("#cancel").click(function(){pageReload()}),$("#t_save").click(function(){if($.addLoading($(this)),!$("#provider_list").ispMgr("check"))return $.removeLoading(),!1;var e=$("#provider_list").ispMgr("data"),t=$("#provider_list").data("value");if(editFlag&&editIsp!=t||!editFlag&&getStack()){var i,a={},r=$.act(ACT_GS,XTP_MULTIISP_CODEC_LIST,null,curStk,["multiCodec","multiPacketizationPeriod","multiPriority"]);if(0!=$.exe())return;for(i=0;i<r.length;i++)(a={}).multiPriority=$("#provider_list").ispMgr("codec",r[i].multiCodec),a.multiPacketizationPeriod="20",$.act(ACT_SET,XTP_MULTIISP_CODEC_LIST,r[i].__stack,null,a)}if(1===INCLUDE_AREACODE){var l=$("#provider_list").ispMgr("data","areaCode");if(""===areaCodeObj.areaCode&&(l||e.multiVoipPrefixNum)){var o=l||e.multiVoipPrefixNum;$.act(ACT_SET,XTP_IGD_AREA_CODE_CFG,areaCodeObj.__stack,null,["areaCode="+o,"enable=1"])}}e.multiIspName==$.tpLang.s_str.otherprovider&&(e.multiIspName="Other"),editFlag?($.act(ACT_SET,XTP_MULTI_ISP,curStk,null,e),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||($.voipTelePhoneNumbersNeedToRefresh=!0,pageReload())})):getStack()?($.act(ACT_SET,XTP_MULTI_ISP,curStk,null,e),actForSendMsg(),$.each(ips,function(){if("voip"==this.name&&0==this.enable)return $.act(ACT_SET,WAN_IP_CONN,this.__stack,null,["Enable=1"]),!1}),$.each(ppps,function(){if("voip"==this.name&&0==this.enable)return $.act(ACT_SET,WAN_PPP_CONN,this.__stack,null,["Enable=1"]),!1}),$.exe(function(e){$.removeLoading(),e||($.voipTelePhoneNumbersNeedToRefresh=!0,pageReload())})):$.alert(ERR_VOIP_ACCOUNT_MUCH_ADD_ERROR)}),$("#refresh").click(function(){pageReload()}),$.tpInit(init)</script>
