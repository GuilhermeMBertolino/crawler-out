<script>if($.mainParam)var optPageGlobal=$.mainParam[0],editOptCode=$.mainParam[1],pageNumGlobal=$.mainParam[2],indexGlobal=$.mainParam[3],msgPageListGlobal=$.mainParam[4];else optPageGlobal=5,editOptCode=5,pageNumGlobal=1,indexGlobal=0,msgPageListGlobal={};var lenSingleMsgDefault=160,lenSingleMsgInGSM7=new Array(160,146,153,153,153),lenSingleMsgOutGSM7=new Array(70,64,67,67,67),lenSingleMsgArray=new Array(lenSingleMsgInGSM7,lenSingleMsgOutGSM7),lenMsgArray=new Array(765,335),lenSingleMsgArrayIndex=0,curMsgIndex=0,curMsgIndexLenLeft=0,lenSingleAddInGSM7Ext=new Array(0,0,0,0,0),GSM_7BIT_NUM=128,arrayGSM_7DefaultTable=[64,163,36,165,232,233,249,236,242,199,10,216,248,13,197,229,916,95,934,915,923,937,928,936,931,920,926,27,198,230,223,201,32,33,34,35,164,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,161,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,196,214,209,220,167,191,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,228,246,241,252,224];function doEscapeCharEncode(e){for(var n="",t=0;t<e.length;t++)"\n"==e.charAt(t)?n+="":"\r"==e.charAt(t)?n+="":n+=e[t];return n}function outputMsgLen(){var e,n=0,t=$("#inputContent").val().length,l=0,r=0,a=0,g=curMsgIndexLenLeft=curMsgIndex=0,i=0,d=0;lenSingleAddInGSM7Ext[0]=0,lenSingleAddInGSM7Ext[1]=0,lenSingleAddInGSM7Ext[2]=0,lenSingleAddInGSM7Ext[3]=0,lenSingleAddInGSM7Ext[4]=0,$("#inputLen").css("color","#000000");for(n=lenSingleMsgArrayIndex=0;n<t;n++){if(a=e=0,94==$("#inputContent").val().charCodeAt(n)||123==$("#inputContent").val().charCodeAt(n)||125==$("#inputContent").val().charCodeAt(n)||92==$("#inputContent").val().charCodeAt(n)||91==$("#inputContent").val().charCodeAt(n)||126==$("#inputContent").val().charCodeAt(n)||93==$("#inputContent").val().charCodeAt(n)||124==$("#inputContent").val().charCodeAt(n)||8364==$("#inputContent").val().charCodeAt(n))e=1;else for(var o=0;o<GSM_7BIT_NUM;o++)if($("#inputContent").val().charCodeAt(n)==arrayGSM_7DefaultTable[o]){e=1;break}if(0==e&&(lenSingleMsgArrayIndex=1),r=lenSingleAddInGSM7Ext[0]+lenSingleAddInGSM7Ext[1]+lenSingleAddInGSM7Ext[2]+lenSingleAddInGSM7Ext[3]+lenSingleAddInGSM7Ext[4],g=lenSingleMsgArray[lenSingleMsgArrayIndex][0]+lenSingleMsgArray[lenSingleMsgArrayIndex][1]+lenSingleMsgArray[lenSingleMsgArrayIndex][2]+lenSingleMsgArray[lenSingleMsgArrayIndex][3],i=lenSingleMsgArray[lenSingleMsgArrayIndex][0]+lenSingleMsgArray[lenSingleMsgArrayIndex][1]+lenSingleMsgArray[lenSingleMsgArrayIndex][2],d=lenSingleMsgArray[lenSingleMsgArrayIndex][0]+lenSingleMsgArray[lenSingleMsgArrayIndex][1],0==lenSingleMsgArrayIndex?94!=$("#inputContent").val().charCodeAt(n)&&123!=$("#inputContent").val().charCodeAt(n)&&125!=$("#inputContent").val().charCodeAt(n)&&92!=$("#inputContent").val().charCodeAt(n)&&91!=$("#inputContent").val().charCodeAt(n)&&126!=$("#inputContent").val().charCodeAt(n)&&93!=$("#inputContent").val().charCodeAt(n)&&124!=$("#inputContent").val().charCodeAt(n)&&8364!=$("#inputContent").val().charCodeAt(n)||(a=1):r=0,n+1+r+a>lenMsgArray[lenSingleMsgArrayIndex]){curMsgIndexLenLeft=0,curMsgIndex=5,1==a&&lenSingleAddInGSM7Ext[4]++;break}g<n+1+r+a?(curMsgIndexLenLeft=lenMsgArray[lenSingleMsgArrayIndex]-(t+r+a),curMsgIndex=5,1==a&&lenSingleAddInGSM7Ext[4]++):i<n+1+r+a?(curMsgIndexLenLeft=g-(t+r+a),curMsgIndex=4,1==a&&lenSingleAddInGSM7Ext[3]++):d<n+1+r+a?(curMsgIndexLenLeft=i-(t+r+a),curMsgIndex=3,1==a&&lenSingleAddInGSM7Ext[2]++):n+1+r+a>lenSingleMsgArray[lenSingleMsgArrayIndex][0]?(curMsgIndexLenLeft=d-(t+r+a),curMsgIndex=2,1==a&&lenSingleAddInGSM7Ext[1]++):n+1+r+a<lenSingleMsgArray[lenSingleMsgArrayIndex][0]&&(curMsgIndexLenLeft=lenSingleMsgArray[lenSingleMsgArrayIndex][0]-(t+r+a),(curMsgIndex=1)==a&&lenSingleAddInGSM7Ext[0]++)}if(r=lenSingleAddInGSM7Ext[0]+lenSingleAddInGSM7Ext[1]+lenSingleAddInGSM7Ext[2]+lenSingleAddInGSM7Ext[3]+lenSingleAddInGSM7Ext[4],$("#inputContent").prop("maxlength",lenMsgArray[lenSingleMsgArrayIndex]-r),t+r>lenMsgArray[lenSingleMsgArrayIndex])return l=t+r-lenMsgArray[lenSingleMsgArrayIndex],$("#inputLen").text("(Message too long!\r\n"+lenMsgArray[lenSingleMsgArrayIndex]+" characters only.\r\nNeed to delete "+l+" characters.)"),void $("#inputLen").css("color","#ff0000");0!=curMsgIndex?$("#inputLen").text("("+curMsgIndexLenLeft+"/"+curMsgIndex+")"):$("#inputLen").text("")}function init(){$.mainParam||($("#toNumber").prop("value",""),$("#inputContent").text(""),$("#back").parents("div").first().remove()),0==optPageGlobal?($("#t_et").text("Inbox"),0==editOptCode?$("#toNumber").prop("value",msgPageListGlobal[indexGlobal].from):1==editOptCode&&$("#inputContent").text(msgPageListGlobal[indexGlobal].content)):1==optPageGlobal?($("#t_et").text("Outbox"),0==editOptCode?$("#toNumber").prop("value",msgPageListGlobal[indexGlobal].to):1==editOptCode&&$("#inputContent").text(msgPageListGlobal[indexGlobal].content)):2==optPageGlobal&&($("#t_et").text("Draft Box"),2==editOptCode&&($("#toNumber").prop("value",msgPageListGlobal[indexGlobal].to),$("#inputContent").text(msgPageListGlobal[indexGlobal].content)))}$("textarea#inputContent").keyup(function(){/MSIE (\d+\.\d+);/.test(navigator.userAgent)||setTimeout(outputMsgLen,10)}),$("textarea#inputContent").keydown(function(){/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&outputMsgLen()})</script>
<h3 id="t_et">New Message</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="pure-control-group">
                <b id="t_phoneNum" class="m">Phone Number:</b>
                <input type="text" id="toNumber">
        </div>
        <p>
        <div class="pure-control-group">
                <div class="edit-msg-left-wrap inline">
                    <label id="t_content" class="label-title m" style="vertical-align:top">Content:</label>
                    <label id="inputLen" class="label-title m" style="vertical-align:top;margin-top:8px"></label>
                </div>
                <div class="edit-msg-right-wrap inline">
                    <textarea type="text" class="lte-textarea" rows="10" cols="65" id="inputContent" maxlength="765"></textarea>
                </div>
        </div>
        <div style="text-align:right" class="part-separate">
            <div class="inline">
            	<button type="submit" class="blue inline T_back" id="back">Back</button>
            </div>
            <div class="inline">
            	<button type="submit" class="blue inline T_save" id="save">Save</button>
            </div>
            <div class="inline">
                <button type="submit" class="blue inline T_send" id="send">Send</button>
            </div>
        </div>
    </form>
</div>
<script>function checkPhoneNum(e){var t,n,l=0;if(21<=e.length||e.length<=0?(l=1,$.alert(ERR_LTE_SMS_PHONE_NUM_LEN)):"+"==(n=e.charAt(0))||$.isnum(n)?"+"==n?(t=e.substring(1,e.length),$.isnum(t)||(l=1,$.alert(ERR_LTE_SMS_PHONE_NUM_FORMAT))):$.isnum(e)||(l=1,$.alert(ERR_LTE_SMS_PHONE_NUM_FORMAT)):(l=1,$.alert(ERR_LTE_SMS_PHONE_NUM_FORMAT)),1!=l)return!0;var a=$("#toNumber");return a&&(a.focus(),a.select()),!1}var retryTimer;$("#back").click(function(){0==optPageGlobal?$.loadMain("lteSmsInbox.htm"):1==optPageGlobal?$.loadMain("lteSmsOutbox.htm"):2==optPageGlobal&&$.loadMain("lteSmsDraftbox.htm")}),$("#save").click(function(){var e,t,n,l;return e=$("#toNumber").prop("value"),t=$("#inputContent").val(),n=doEscapeCharEncode(t),!!checkPhoneNum(e)&&(""==t?($.alert(ERR_LTE_SMS_MSG_EMPTY),!1):(l=lenSingleAddInGSM7Ext[0]+lenSingleAddInGSM7Ext[1]+lenSingleAddInGSM7Ext[2]+lenSingleAddInGSM7Ext[3]+lenSingleAddInGSM7Ext[4],n.length+l>lenMsgArray[lenSingleMsgArrayIndex]?($.alert(ERR_LTE_SMS_MSG_TOO_LONG),$("#inputContent").focus(),void $("#inputContent").select()):($.addLoading($(this)),$.mainParam&&2==optPageGlobal&&2==editOptCode&&msgPageListGlobal[indexGlobal].to==e&&msgPageListGlobal[indexGlobal].content==n||($.act(ACT_SET,LTE_SMS_SENDNEWMSG,null,null,["index=2","to="+e,"textContent="+n]),!$.exe())?void($.mainParam&&2==optPageGlobal&&2==editOptCode?($.removeLoading(),$.lteSmsTips(1,s_str.msgSaveSuc),$.loadMain("lteSmsDraftbox.htm")):($.removeLoading(),$.lteSmsTips(1,s_str.msgSaveSuc),$.reload())):($.removeLoading(),$.lteSmsTips(0,s_str.msgSaveFail),!1))))});var TotalLen=0;function smsSendResult(){res=$.act(ACT_GET,LTE_SMS_SENDNEWMSG,null,null,["sendResult"]),$.exe()?($.removeLoading(),clearTimeout(retryTimer),$.lteSmsTips(0,s_str.msgSentFail),$.mainParam&&2==optPageGlobal&&2==editOptCode?$.loadMain("lteSmsDraftbox.htm"):$.reload()):1==res.sendResult?("undefined"!=retryTimer&&clearTimeout(retryTimer),$.removeLoading(),$.lteSmsTips(1,s_str.msgSentSuc),$.mainParam&&2==optPageGlobal&&2==editOptCode?$.loadMain("lteSmsDraftbox.htm"):$.reload()):2==res.sendResult?("undefined"!=retryTimer&&clearTimeout(retryTimer),$.removeLoading(),$.lteSmsTips(0,s_str.msgSentBusy,1800),$.mainParam&&2==optPageGlobal&&2==editOptCode&&$.loadMain("lteSmsDraftbox.htm")):3==res.sendResult?retryTimer=$.timeout(smsSendResult,500):($.removeLoading(),clearTimeout(retryTimer),$.lteSmsTips(0,s_str.msgSentFail),$.mainParam&&2==optPageGlobal&&2==editOptCode?$.loadMain("lteSmsDraftbox.htm"):$.reload())}$("#send").click(function(){var e,t,n,l;return e=$("#toNumber").prop("value"),t=$("#inputContent").val(),n=doEscapeCharEncode(t),!!checkPhoneNum(e)&&(""==t?($.alert(ERR_LTE_SMS_MSG_EMPTY),!1):(l=lenSingleAddInGSM7Ext[0]+lenSingleAddInGSM7Ext[1]+lenSingleAddInGSM7Ext[2]+lenSingleAddInGSM7Ext[3]+lenSingleAddInGSM7Ext[4],(TotalLen=n.length+l)>lenMsgArray[lenSingleMsgArrayIndex]?($.alert(ERR_LTE_SMS_MSG_TOO_LONG),$("#inputContent").focus(),void $("#inputContent").select()):(2==optPageGlobal&&2==editOptCode&&$.act(ACT_DEL,LTE_SMS_DRAFTMSGENTRY,smsDraftboxPagelist[indexGlobal].__stack,null),$.addLoading($(this)),$.act(ACT_SET,LTE_SMS_SENDNEWMSG,null,null,["index=1","to="+e,"textContent="+n]),void $.exe(function(e){return smsSendResult(),!1}))))}),$.tpInit(init)</script>
