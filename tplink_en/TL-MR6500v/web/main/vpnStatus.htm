<script language="javascript">var curOvpnObj,curPvpnObj,ovpnClientsGetAct=1,ovpnClientConnAct=1,ovpnClientDisconnAct=2,pvpnClientsGetAct=1,pvpnClientConnAct=1,pvpnClientDisconnAct=2;function doDisConn(t,n){if("openvpn"==t){$.addLoading($("#disconn_openvpn_"+n));$.act(ACT_SET,OVPN_CLIENT,ovpnClientsList[n-1].__stack,null,["connAct="+ovpnClientDisconnAct]);$.exe(function(t){$.removeLoading(),t||$.reload()})}if("pptpvpn"==t){$.addLoading($("#disconn_pptpvpn_"+n));$.act(ACT_SET,PVPN_CLIENT,pvpnClientsList[n-1].__stack,null,["connAct="+pvpnClientDisconnAct]);$.exe(function(t){$.removeLoading(),t||$.reload()})}}function initOvpnClientTable(){var e=new Array;ovpnClientsList=$.act(ACT_GL,OVPN_CLIENT,null,null),curOvpnObj=$.act(ACT_GET,OPENVPN,null,null),$("#ovpn_max").css("color","#000000"),$.exe(function(t){if(!t){var n=0;return $.each(ovpnClientsList,function(){""!=this.wanIp&&e.push([{text:++n,width:"20%"},{text:this.tunIp,width:"40%"},{text:"<span class='table-grid-icon edit-trash-icon' id='disconn_openvpn_"+n+"' onclick='doDisConn(\"openvpn\", "+n+");'></span>",width:"40%"}])}),console.log("ovpn maxClientsNum="+curOvpnObj.maxClientsNum+" index="+n),n==curOvpnObj.maxClientsNum&&($("#ovpn_max").html(n_str.vpnStatus.t_maxClientNum+curOvpnObj.maxClientsNum),$("#ovpn_max").css("color","#ff0000")),$.initTableBody($("#tableOvpnClientList"),e),$.tablePages($("#tableOvpnClientList"),5),e}})}function OpenVpnInit(){var t=[{text:table_str.id,width:"20%"},{text:table_str.assignedIp,width:"40%"},{text:m_str.disconn,width:"40%"}];$.initTableHead($("#tableOvpnClientList"),t),$("#tableOvpnClientList").tpTable(initOvpnClientTable)}function initPvpnClientTable(){var e=new Array;pvpnClientsList=$.act(ACT_GL,PVPN_CLIENT,null,null),curPvpnObj=$.act(ACT_GET,PPTPVPN,null,null),$("#pvpn_max").css("color","#000000"),$.exe(function(t){if(!t){var n=0;return $.each(pvpnClientsList,function(){""!=this.wanIp&&e.push([{text:++n,width:"20%"},{text:this.ptpIp,width:"40%"},{text:"<span class='table-grid-icon edit-trash-icon' id='disconn_pptpvpn_"+n+"' onclick='doDisConn(\"pptpvpn\", "+n+");'></span>",width:"40%"}])}),console.log("pvpn maxClientsNum="+curPvpnObj.maxClientsNum+" index="+n),n==curPvpnObj.maxClientsNum&&($("#pvpn_max").html(n_str.vpnStatus.t_maxClientNum+curPvpnObj.maxClientsNum),$("#pvpn_max").css("color","#ff0000")),$.initTableBody($("#tablePvpnClientList"),e),$.tablePages($("#tablePvpnClientList"),5),e}})}function PptpVpnInit(){var t=[{text:table_str.id,width:"20%"},{text:table_str.assignedIp,width:"40%"},{text:m_str.disconn,width:"40%"}];$.initTableHead($("#tablePvpnClientList"),t),$("#tablePvpnClientList").tpTable(initPvpnClientTable)}function initIpsecTable(){selAll=0,index=0,allStk=[];var n=new Array,t=$.act(ACT_GL,IPSEC_CFG,null,null,["entryID","connName","remoteGWAddress","localIPAddress","remoteIPAddress","enable","status"]);return $.exe()||$.each(t,function(){var t="["+this.__stack+"]";index++,0==this.enable?n.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one" /><label></label></div></span>',width:"5%"},{text:this.connName,width:"20%"},{text:this.remoteGWAddress,width:"15%"},{text:this.localIPAddress,width:"15%"},{text:this.remoteIPAddress,width:"15%"},{text:"Disabled",width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"ip\", "+t+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ip\", "+t+");'></span>",width:"10%"}]):0==this.status?n.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one" /><label></label></div></span>',width:"5%"},{text:this.connName,width:"20%"},{text:this.remoteGWAddress,width:"15%"},{text:this.localIPAddress,width:"15%"},{text:this.remoteIPAddress,width:"15%"},{text:"Down",width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"ip\", "+t+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ip\", "+t+");'></span>",width:"10%"}]):n.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one" /><label></label></div></span>',width:"5%"},{text:this.connName,width:"20%"},{text:this.remoteGWAddress,width:"15%"},{text:this.localIPAddress,width:"15%"},{text:this.remoteIPAddress,width:"15%"},{text:"Up",width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable("+index+" , "+t+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel("+index+", "+t+");'></span>",width:"10%"}]),allStk[index-1]=this.__stack}),$.initTableBody($("#tableIpvpnClientList"),n),n}function doEnable(t,n){var e=$.act(ACT_GET,IPSEC_CFG,n,null,null);$.exe(),0==e.enable?($.act(ACT_SET,IPSEC_CFG,n,null,["enable=1"]),$.exe(function(t){t||$.reload()})):($.act(ACT_SET,IPSEC_CFG,n,null,["enable=0"]),$.exe(function(t){t||$.reload()}))}function doDel(t,n){$.act(ACT_DEL,IPSEC_CFG,n,null,null),$.exe(function(t){t||$.reload()})}function ipSecVpnInit(){var t=[{text:'<div><input type="checkbox" id="checkbox_st" class="table-select-all" /><label></label></div>',width:"5%"},{text:table_str.connname,width:"20%"},{text:table_str.remgateway,width:"15%"},{text:table_str.locaddr,width:"15%"},{text:table_str.remaddr,width:"15%"},{text:table_str.status,width:"10%"},{text:table_str.enable,width:"10%"},{text:m_str.disconn,width:"10%"}];$.initTableHead($("#tableIpvpnClientList"),t),$("#tableIpvpnClientList").tpTable(initIpsecTable)}function init(){INCLUDE_OPENVPN_SERVER?OpenVpnInit():$("#openvpn_div").addClass("nd"),INCLUDE_PPTPVPN_SERVER?PptpVpnInit():$("#pptpvpn_div").addClass("nd"),INCLUDE_IPSEC?ipSecVpnInit():$("#ipsecvpn_div").addClass("nd")}</script>
<h3 id="t_vpnConn">VPN Connections</h3>
<div class="content-container" id="openvpn_div">
    <h4 id="t_ovpnConn">OpenVPN Connection</h4>
    <form class="pure-form pure-form-aligned">
        <table id="tableOvpnClientList">
            <thead></thead>
            <tbody id="tableOvpnClientListBody">
            </tbody>
        </table>
    </form>
    <label id="ovpn_max" class="label-title m" style="vertical-align:bottom;margin-top:8px"></label>
</div>
<div class="content-container" id="pptpvpn_div">
    <h4 id="t_pvpnConn">PPTP VPN Connection</h4>
    <form class="pure-form pure-form-aligned">
        <table id="tablePvpnClientList">
            <thead></thead>
            <tbody id="tablePvpnClientListBody">
            </tbody>
        </table>
    </form>
    <label id="pvpn_max" class="label-title m" style="vertical-align:bottom;margin-top:8px"></label>
</div>
<div class="content-container" id="ipsecvpn_div">
    <h4 id="t_ipvpnConn">IPsec VPN Connection</h4>
    <form class="pure-form pure-form-aligned">
        <table id="tableIpvpnClientList">
            <thead></thead>
            <tbody id="tableIpvpnClientListBody">
            </tbody>
        </table>
    </form>
</div>
<script language="javascript">$.tpInit(init)</script>
