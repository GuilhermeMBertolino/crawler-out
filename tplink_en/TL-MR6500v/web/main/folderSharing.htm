<script language="javascript">var ftpServer,usbDeviceList,volumeList,smbService,dlnaService,accessFolderList_samba,accessFolderList_ftp,accessFolderList_dlna,idx,o,prevObj,folderIdx,editCurIndex,g_ftpPort,userCfg,userTbl=new Array,username="",password="",cfPassword="",blank="&nbsp;&nbsp;",numAliveDev=0,numAliveLog=0,currVolume="",currPath="",currentFolder="",fPath="",firstClick=1,firstNode=1,folderPath="",currentVol="",shareTabStatus="";if(INCLUDE_USB_SFTP_SERVER)var g_sftpPort;if(INCLUDE_STORAGE_HTTP_SERVICE)var g_httpPort,g_httpsPort,storageHttp,accessFolderList_http;function selectJudge(e){var t,l=1;if(1==$("#cb"+e).prop("data-checked")){for(t=0;t<accessFolderList_samba.length;t++)0==$("#cb"+t).prop("data-checked")&&(l=0);1==l&&($("#shareTitle").prop("checked",!0),$("#shareTitle").tpCheckbox())}else $("#shareTitle").prop("checked",!1),$("#shareTitle").tpCheckbox()}function initAccessTab(){var e,t,l=new Array,a="0.0.0.0",s=$.act(ACT_GL,L2_BRIDGING_ENTRY,null,null,["bridgeName"]),r=$.act(ACT_GET,SYS_MODE,null,null),n=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]),o=$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);if(INCLUDE_VDSLWAN&&(vdsls=$.act(ACT_GL,WAN_PTM_LINK_CFG,null,null,["X_TP_Used","X_TP_VID"])),INCLUDE_L2TP)var i=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","addressingType","transportType","externalIPAddress"]);if(INCLUDE_PPTP)var c=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","addressingType","transportType","externalIPAddress"]);if(INCLUDE_WAN_VLAN)var _=$.act(ACT_GL,WAN_IP_CONN,null,null,["name","connectionType","addressingType","externalIPAddress","subnetMask","defaultGateway","DNSServers","X_TP_8021QEnabled","X_TP_VlanID"]),d=$.act(ACT_GL,WAN_PPP_CONN,null,null,["name","transportType","username","password","X_TP_8021QEnabled","X_TP_VlanID","externalIPAddress"]);else _=$.act(ACT_GL,WAN_IP_CONN,null,null,["name","connectionType","addressingType","externalIPAddress","subnetMask","defaultGateway","DNSServers"]),d=$.act(ACT_GL,WAN_PPP_CONN,null,null,["name","transportType","username","password","externalIPAddress"]);if(!$.exe()){var u=r.mode;for(e=0;e<s.length;e++){var T=$.act(ACT_GS,LAN_IP_INTF,null,s[e].__stack,["IPInterfaceIPAddress"]);$.exe()||(t=T[0].IPInterfaceIPAddress)}return"DSL"==u?($.merge(_,d),$.each(_,function(){this.name===o.__ifAliasName&&(a=this.externalIPAddress)})):"ETH"==u?($.merge(_,d),$.each(_,function(){this.name===o.__ifAliasName&&(a=this.externalIPAddress)}),INCLUDE_PPTP&&$.each(c,function(){"Ethernet"===$.arr2obj(n,"__stack")[$.stkPop(this.__stack,1)].WANAccessType&&this.name===o.__ifAliasName&&(a=this.externalIPAddress)}),INCLUDE_L2TP&&$.each(i,function(){"Ethernet"===$.arr2obj(n,"__stack")[$.stkPop(this.__stack,1)].WANAccessType&&this.name===o.__ifAliasName&&(a=this.externalIPAddress)})):"USB_3G"==u&&$.each(d,function(){"USB_3G"===$.arr2obj(n,"__stack")[$.stkPop(this.__stack,2)].WANAccessType&&this.name===o.__ifAliasName&&"PPP3G"==this.transportType&&(a=this.externalIPAddress)}),l.push([{text:'<div><input type="checkbox" id="mediaServer" /><label></label></div>',width:"16%"},{text:table_str.mediaServer,width:"32%"},{text:"--",width:"32%"},{text:"--",width:"20%"}],[{text:'<div><input type="checkbox" id="samba" /><label></label></div>',width:"16%"},{text:table_str.netNeig,width:"32%"},{text:"\\\\"+smbService.serverName,width:"32%"},{text:"--",width:"20%"}],[{text:'<div><input type="checkbox" id="innerFtp" /><label></label></div>',width:"16%"},{text:table_str.ftp,width:"32%"},{text:table_str.ftpSign+t+":"+g_ftpPort,width:"32%"},{text:'<input type="text" id="port" class="s" style="text-align:center" maxlength="5" />',width:"20%"}],[{text:'<div><input type="checkbox" id="outerFtp" /><label></label></div>',width:"16%"},{text:table_str.ftpInternet,width:"32%"},{text:table_str.ftpSign+a+":"+g_ftpPort,width:"32%"},{text:g_ftpPort,width:"20%"}]),INCLUDE_STORAGE_HTTP_SERVICE&&l.push([{text:'<div><input type="checkbox" id="httpStorage" /><label></label></div>',width:"16%"},{text:table_str.http,width:"32%"},{text:"http://"+t+":"+g_httpPort,width:"32%"},{text:'<input type="text" id="httpPort" class="s" style="text-align:center" maxlength="5" />',width:"20%"}],[{text:'<div><input type="checkbox" id="outerHttpsStorage" /><label></label></div>',width:"16%"},{text:table_str.httpInternet,width:"32%"},{text:"https://"+a+":"+g_httpsPort,width:"32%"},{text:'<input type="text" id="httpsPort" class="s" style="text-align:center" maxlength="5" />',width:"20%"}]),INCLUDE_USB_SFTP_SERVER&&l.push([{text:'<div><input type="checkbox" id="sFtp" /><label></label></div>',width:"16%"},{text:table_str.sftp,width:"32%"},{text:"sftp://"+t+":"+ftpServer.SPortNumber,width:"32%"},{text:'<input type="text" id="sport" class="s" style="text-align:center" maxlength="5" />',width:"20%"}],[{text:'<div><input type="checkbox" id="outSftp" /><label></label></div>',width:"16%"},{text:table_str.sftpInternet,width:"32%"},{text:"sftp://"+a+":"+ftpServer.SPortNumber,width:"32%"},{text:ftpServer.SPortNumber,width:"20%"}]),$.initTableBody($("#accessTab"),l),0==ftpServer.enable&&$("#accessTab").find("tr").eq(4).addClass("nd"),$("#innerFtp").click(function(){1==$(this).prop("data-checked")?$("#accessTab").find("tr").eq(4).removeClass("nd"):$("#accessTab").find("tr").eq(4).addClass("nd")}),INCLUDE_STORAGE_HTTP_SERVICE&&(0==storageHttp.enable&&$("#accessTab").find("tr").eq(6).addClass("nd"),$("#httpStorage").click(function(){1==$(this).prop("data-checked")?$("#accessTab").find("tr").eq(6).removeClass("nd"):$("#accessTab").find("tr").eq(6).addClass("nd")})),INCLUDE_USB_SFTP_SERVER&&(0==ftpServer.sftpEnable&&(INCLUDE_STORAGE_HTTP_SERVICE?$("#accessTab").find("tr").eq(8).addClass("nd"):$("#accessTab").find("tr").eq(6).addClass("nd")),$("#sFtp").click(function(){1==$(this).prop("data-checked")?INCLUDE_STORAGE_HTTP_SERVICE?$("#accessTab").find("tr").eq(8).removeClass("nd"):$("#accessTab").find("tr").eq(6).removeClass("nd"):INCLUDE_STORAGE_HTTP_SERVICE?$("#accessTab").find("tr").eq(8).addClass("nd"):$("#accessTab").find("tr").eq(6).addClass("nd")})),l}}function initShareTab(){var e,t,l,a,s,r,n=new Array,o="",i="";for(s=0;s<accessFolderList_samba.length;s++){var c=!1,_=m_str.disconnected;for(e=accessFolderList_samba[s].volumeLabel+":"+accessFolderList_samba[s].name,$.each(volumeList,function(){if(this.uuid==accessFolderList_samba[s].volumeUuid)return t=this,!(c=!0)}),l=table_str.off,1==accessFolderList_dlna[s].enable&&(l=table_str.on),a=""!=accessFolderList_samba[s].volumeUuid&&0==c?"<span class='table-grid-icon inactive-disable-icon' id='sp"+s+"' onclick='ableShare("+s+", "+c+", "+t+");'></span>":""!=accessFolderList_samba[s].volumeUuid&&"Online"!=t.status?("Error"==t.status||"Offline"==t.status&&t.enable,"<span class='table-grid-icon inactive-icon' id='sp"+s+"'></span>"):1==accessFolderList_samba[s].enable?"<span class='table-grid-icon enable-icon' id='sp"+s+"' onclick='ableShare("+s+");'></span>":"<span class='table-grid-icon disable-icon' id='sp"+s+"' onclick='ableShare("+s+");'></span>",o="<span class='table-grid-icon edit-modify-icon' id='edit"+s+"' onclick='modifyShare("+s+");'></span>",i="<span class='table-grid-icon edit-trash-icon' id='del"+s+"' onclick='delShare("+s+");'></span>",r=0;r<volumeList.length;r++)volumeList[r].label==accessFolderList_samba[s].volumeLabel&&(_=volumeList[r].name);null==_&&(_=m_str.disconnected),n.push([{text:'<div><input type="checkbox" id="cb'+s+'" onclick="selectJudge('+s+');" /><label></label></div>',width:"8%"},{text:s+1,width:"5%"},{text:accessFolderList_samba[s].alias,width:"15%"},{text:escapeStr(e),width:"25%"},{text:l,width:"10%"},{text:_,width:"10%"},{text:a,width:"10%"},{text:o+i,width:"17%"}])}return $.initTableBody($("#shareTab"),n),$.tablePages($("#shareTab"),8),n}function ableShare(e){var t,l={},a=!1;if($.each(volumeList,function(){this.uuid==accessFolderList_samba[e].volumeUuid&&(t=this,a=!0)}),""!=accessFolderList_samba[e].volumeUuid&&0==a||""!=accessFolderList_samba[e].volumeUuid&&"Online"!=t.status||(1==accessFolderList_samba[e].enable?l.enable=0:l.enable=1),$.act(ACT_SET,SMB_SERVICE_FOLDER,accessFolderList_samba[e].__stack,null,l),$.act(ACT_SET,FTP_SERVER_FOLDER,accessFolderList_ftp[e].__stack,null,l),$.act(ACT_SET,DLNA_MEDIA_SERVER_FOLDER,accessFolderList_dlna[e].__stack,null,l),INCLUDE_STORAGE_HTTP_SERVICE&&$.act(ACT_SET,STORAGE_HTTP_FOLDER,accessFolderList_http[e].__stack,null,l),!$.exe()&&($.act(ACT_SET,SMB_SERVICE,null,null,["modified=0"]),$.act(ACT_SET,FTP_SERVER,null,null,["modified=0"]),!$.exe())){var s={};s.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",s)}}function modifyShare(e){var t,l=accessFolderList_samba[editCurIndex=e].volumeLabel+":";$("#shareVolume option[value='"+l+"']").prop("selected","selected");for($("#shareVolume").tpSelect({refresh:1}),$("#filename").val(accessFolderList_samba[e].volumeLabel+":"+accessFolderList_samba[e].name),$("#shareName").val(accessFolderList_samba[e].alias),1==accessFolderList_samba[e].needAuth?($("#ea").prop("checked",!0),$("#eaNote").addClass("nd")):($("#ea").prop("checked",!1),$("#eaNote").removeClass("nd")),$("#ea").data("tpCheckbox").refresh(),t=0;t<userAccessList_samba.length;t++)parseInt(accessFolderList_samba[e].__stack,10)==parseInt(userAccessList_samba[t].__stack,10)&&parseInt(userList[0].__stack,10)==userAccessList_samba[t].userId&&(7==userAccessList_samba[t].permissions?$("#wa").prop("checked",!0):$("#wa").prop("checked",!1),$("#wa").data("tpCheckbox").refresh());1==accessFolderList_dlna[e].enable&&($("#ems").prop("checked",!0),$("#ems").data("tpCheckbox").refresh()),shareTabStatus="modify"}function delShare(e){if($.act(ACT_DEL,SMB_SERVICE_FOLDER,accessFolderList_samba[e].__stack,null,null),$.act(ACT_DEL,FTP_SERVER_FOLDER,accessFolderList_ftp[e].__stack,null,null),$.act(ACT_DEL,DLNA_MEDIA_SERVER_FOLDER,accessFolderList_dlna[e].__stack,null,null),INCLUDE_STORAGE_HTTP_SERVICE&&$.act(ACT_DEL,STORAGE_HTTP_FOLDER,accessFolderList_http[e].__stack,null,null),!$.exe()&&($.act(ACT_SET,SMB_SERVICE,null,null,["modified=0"]),$.act(ACT_SET,FTP_SERVER,null,null,["modified=0"]),!$.exe())){var t={};t.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",t)}}function delShareMul(e){$.act(ACT_DEL,SMB_SERVICE_FOLDER,accessFolderList_samba[e].__stack,null,null),$.act(ACT_DEL,FTP_SERVER_FOLDER,accessFolderList_ftp[e].__stack,null,null),$.act(ACT_DEL,DLNA_MEDIA_SERVER_FOLDER,accessFolderList_dlna[e].__stack,null,null),INCLUDE_STORAGE_HTTP_SERVICE&&$.act(ACT_DEL,STORAGE_HTTP_FOLDER,accessFolderList_http[e].__stack,null,null),$.exe()}function initAuthTab(){var e,t=new Array;if(0==volumeList.length&&t.push([{text:"--",width:"10%"},{text:"--",width:"40%"},{text:"--",width:"25%"},{text:"--",width:"25%"}]),usbDeviceList=$.act(ACT_GL,USB_DEVICE,null,null),volumeList=$.act(ACT_GL,LOGICAL_VOLUME,null,null),!$.exe()){for(idx=1;idx<=usbDeviceList.length;idx++)if("Online"==usbDeviceList[idx-1].status)for(e=0;e<volumeList.length;e++)usbDeviceList[idx-1].__stack.split(",")[0]==volumeList[e].__stack.split(",")[0]&&"Online"==volumeList[e].status&&t.push([{text:e+1,width:"10%"},{text:"volume("+volumeList[e].name+")",width:"40%"},{text:volumeList[e].label+":",width:"25%"},{text:volumeList[e].name,width:"25%"}]);$.initTableBody($("#authTab"),t),$.tablePages($("#authTab"),5)}return t}function selectAll(){var e;if(1==$("#shareTitle").prop("data-checked"))for(e=0;e<accessFolderList_samba.length;e++)$("#cb"+e).prop("checked",!0),$("#cb"+e).data("tpCheckbox").refresh();else for(e=0;e<accessFolderList_samba.length;e++)$("#cb"+e).prop("checked",!1),$("#cb"+e).data("tpCheckbox").refresh()}function init(){var e;if(userList=$.act(ACT_GL,USER_ACCOUNT,null,null),smbService=$.act(ACT_GET,SMB_SERVICE,null,null,null),ftpServer=$.act(ACT_GET,FTP_SERVER,null,null,null),INCLUDE_STORAGE_HTTP_SERVICE&&(storageHttp=$.act(ACT_GET,STORAGE_HTTP,null,null,null)),usbDeviceList=$.act(ACT_GL,USB_DEVICE,null,null),volumeList=$.act(ACT_GL,LOGICAL_VOLUME,null,null),dlnaService=$.act(ACT_GET,DLNA_MEDIA_SERVER,null,null,null),accessFolderList_samba=$.act(ACT_GL,SMB_SERVICE_FOLDER,null,null,null),accessFolderList_ftp=$.act(ACT_GL,FTP_SERVER_FOLDER,null,null,null),accessFolderList_dlna=$.act(ACT_GL,DLNA_MEDIA_SERVER_FOLDER,null,null,null),INCLUDE_STORAGE_HTTP_SERVICE&&(accessFolderList_http=$.act(ACT_GL,STORAGE_HTTP_FOLDER,null,null,null)),userAccessList_samba=$.act(ACT_GL,SMB_USER_ACCESS,null,null,null),userCfg=$.act(ACT_GET,USER_CFG,null,null,null),!$.exe()){userTbl[0]={},userTbl[0].stack=userList[0].__stack,1==userList[0].X_TP_UseLoginAccount?($("#loginAccount").prop("checked",!0),$("#username").val(userCfg.adminName),$("#username").prop("disabled",!0),$("#password").tpPassword("disabled",!0),$("#password").val(userCfg.adminPwd),$("#pwdCheck").addClass("nd"),$("#cfpwd").addClass("nd"),$("#pwdErrTips").hide()):($("#followingAccount").prop("checked",!0),$("#username").val(userList[0].username),$("#password").tpPassword("val",userList[0].password),$("#cfPassword").val(userList[0].password),$("#t_salp").addClass("nd")),g_ftpPort=ftpServer.portNumber,INCLUDE_USB_SFTP_SERVER&&(g_sftpPort=ftpServer.sPortNumber),INCLUDE_STORAGE_HTTP_SERVICE&&(g_httpPort=storageHttp.portNumber,g_httpsPort=storageHttp.httpsPortNumber);var t=[{text:table_str.enable,width:"16%"},{text:table_str.acMethod,width:"32%"},{text:table_str.link,width:"32%"},{text:table_str.port,width:"20%"}];$.initTableHead($("#accessTab"),t),$("#accessTab").tpTable(initAccessTab),1==dlnaService.serverState?$("#mediaServer").prop("checked",!0):$("#mediaServer").prop("checked",!1),$("#mediaServer").data("tpCheckbox").refresh(),1==smbService.enable?$("#samba").prop("checked",!0):$("#samba").prop("checked",!1),$("#samba").data("tpCheckbox").refresh(),1==ftpServer.enable?$("#innerFtp").prop("checked",!0):$("#innerFtp").prop("checked",!1),$("#innerFtp").data("tpCheckbox").refresh(),1==ftpServer.accessFromInternet?$("#outerFtp").prop("checked",!0):$("#outerFtp").prop("checked",!1),$("#outerFtp").data("tpCheckbox").refresh(),INCLUDE_STORAGE_HTTP_SERVICE&&(1==storageHttp.enable?$("#httpStorage").prop("checked",!0):$("#httpStorage").prop("checked",!1),$("#httpStorage").data("tpCheckbox").refresh(),1==storageHttp.accessFromInternet?$("#outerHttpsStorage").prop("checked",!0):$("#outerHttpsStorage").prop("checked",!1),$("#outerHttpsStorage").data("tpCheckbox").refresh(),$("#httpPort").val(storageHttp.portNumber),$("#httpsPort").val(storageHttp.httpsPortNumber)),$("#port").val(ftpServer.portNumber),$("#server_name").val(smbService.serverName),INCLUDE_USB_SFTP_SERVER&&($("#sport").val(ftpServer.SPortNumber),1==ftpServer.sftpEnable?$("#sFtp").prop("checked",!0):$("#sFtp").prop("checked",!1),$("#sFtp").data("tpCheckbox").refresh(),1==ftpServer.accessSftpFromInternet?$("#outSftp").prop("checked",!0):$("#outSftp").prop("checked",!1),$("#outSftp").data("tpCheckbox").refresh());t=[{text:'<div><input type="checkbox" id="shareTitle" onclick="selectAll();" /><label></label></div>',width:"8%"},{text:table_str.id,width:"5%"},{text:table_str.shareName,width:"15%"},{text:table_str.folderPath,width:"25%"},{text:table_str.mediaSharing,width:"10%"},{text:table_str.volume,width:"10%"},{text:table_str.status,width:"10%"},{text:table_str.modify,width:"17%"}];$.initTableHead($("#shareTab"),t),$("#shareTab").tpTable(initShareTab);var l=[{text:table_str.id,width:"10%"},{text:table_str.shareName,width:"40%"},{text:table_str.folderPath,width:"25%"},{text:table_str.volume,width:"25%"}];$.initTableHead($("#authTab"),l),$("#authTab").tpTable(initAuthTab),0==smbService.anonymous?($("#authOn").addClass("selected"),$("#authenticationNote").addClass("nd")):($("#authOff").addClass("selected"),1==smbService.shareAll&&$("#authenticationNote").removeClass("nd")),0==smbService.shareAll?($("#shareOff").addClass("selected"),$("#authentication").addClass("nd"),$("#authDrawing").addClass("nd"),$("#shareDrawing").removeClass("nd")):($("#shareOn").addClass("selected"),$("#shareDrawing").addClass("nd"),$("#authentication").removeClass("nd"),$("#authDrawing").removeClass("nd")),$("#server_name").val(smbService.serverName);for(var a=$("#shareVolume");0<(i=$("#shareVolume option").length);)$("#shareVolume option[index='0']").remove();var s=$("<option></option>");for(s.val(table_str.selectopt),s.text(table_str.selectopt),a.append(s),e=0;e<volumeList.length;e++)"Online"==volumeList[e].status&&((s=$("<option></option>")).val(volumeList[e].label+":"),s.text(volumeList[e].label+":"),a.append(s));for(e=0;e<accessFolderList_samba.length;e++)parseInt(accessFolderList_samba[e].__stack,10),parseInt(userAccessList_samba[0].__stack,10);folderIdx=accessFolderList_samba.length}if(void 0!==$.mainParam){var r=new Object;r=$.mainParam,$("#scroll").scrollTop(r.scrollTop)}}function getParentObj(e){e.hasClass("cc")?fPath="/"+fPath:(currentFolder=e.siblings().text(),""!=fPath&&(currentFolder+="/"+fPath),fPath=currentFolder,getParentObj(e.parent()))}function clickFunc(e){currPath=fPath="";var t=e.id;getParentObj($("#"+t).parent())}function escapeStr(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;")}function transStr(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ").replace(/\s/g," ")}function getFolderPath(e){var t,l;if(1==firstNode)if($(e).parent().hasClass("root")){for(folderPath=$(e).text(),l=0;l<volumeList.length;l++)$(e).text()==volumeList[l].label+":"&&(currVolume=volumeList[l].name);var a=$(e).css("color");if($(e).css("color","#4acbd6"),prevObj){$(prevObj).css("color",a);var s=$(prevObj).siblings(".folderSel");prevObj!=e&&(s.removeClass("folderSel"),s.addClass("folderImg"))}prevObj=e}else folderPath="/"+$(e).text(),o=e,firstNode=0,getFolderPath($(e).parent());else if($(e).parent().hasClass("root")){for(t=$(e).siblings(".span").text(),l=0;l<volumeList.length;l++)$(e).siblings(".span").text()==volumeList[l].label+":"&&(currVolume=volumeList[l].name);folderPath=t+folderPath,firstNode=1;a=$(o).css("color");$(o).css("color","#4acbd6");var r=$(o).siblings(".folderImg");if(r.removeClass("folderImg"),r.addClass("folderSel"),prevObj){$(prevObj).css("color",a);s=$(prevObj).siblings(".folderSel");prevObj!=o&&(s.removeClass("folderSel"),s.addClass("folderImg"))}prevObj=o}else folderPath="/"+$(e).siblings("span").text()+folderPath,getFolderPath($(e).parent())}function createChildFolder(e){var t;if(1==firstClick&&(firstClick=0,o=e),$(e).parent().hasClass("root")){for(t=0;t<volumeList.length;t++)$(e).siblings(".span").text()==volumeList[t].label+":"&&(currVolume=volumeList[t].name);var l,a=currVolume+"/"+transStr(currPath),s={};if(s.targetPath=a,$.act(ACT_SET,FOLDER_BROWSE,null,null,s),folderList=$.act(ACT_GL,FOLDER_NODE,null,null,null),!$.exe())for(l=0;l<folderList.length;l++){var r=escapeStr(folderList[l].folderName);text="<div style='padding-left:23px;' class='div'><div class='addFolder inline' onclick=loadClick(this);></div><div class='folderImg inline' onclick=foldSelect(this); style='cursor:pointer;'></div>&nbsp;<span class='fName inline' style='line-height:24px;vertical-align:top;cursor:pointer;' onClick='getFolderPath(this);'>"+r+"</span></div>",$(o).parent().append(text)}firstClick=1,currPath="",$(o).parent().hasClass("root")||$(o).parent().addClass("loaded")}else currentFolder=$(e).siblings(".fName").text(),""!=currPath&&(currentFolder+="/"+currPath),currPath=currentFolder,createChildFolder($(e).parent())}function foldSelect(e){$(e).siblings(".fName").click()}function loadClick(e){$(e).hasClass("addFolder")?($(e).parent().hasClass("vol")?($(e).siblings("div").removeClass("nd"),$(o).parent().removeClass("vol")):$(e).parent().hasClass("loaded")?$(e).siblings("div").removeClass("nd"):createChildFolder(e),$(e).removeClass("addFolder"),$(e).addClass("hideFolder")):$(e).hasClass("hideFolder")&&($(e).removeClass("hideFolder"),$(e).addClass("addFolder"),$(e).parent().hasClass("root")&&$(e).parent().addClass("vol"),$(e).siblings("div").addClass("nd"))}function showBrowse(){var e;for($.setFixedCentral($("#folderSel")),$.showCover(),$("#folderSel").removeClass("nd"),e=0;e<volumeList.length;e++){var t;if("Online"==volumeList[e].status&&currentVol==volumeList[e].label+":")t="<div style='padding-left:10px;' class='root'><div class='addFolder inline' onclick=loadClick(this);></div>&nbsp;<span class='span inline' style='line-height:24px;vertical-align:top;cursor:pointer;' onClick='getFolderPath(this);'>"+volumeList[e].label+":</span></div>",$("#folderSelContent").append(t)}}function showFilename(e){var t=$.id("filename");t&&(t.value=e.value)}function deleteItem(){var e;if(1==$("#shareTitle").prop("data-checked"))for(e=0;e<accessFolderList_samba.length;e++)delShareMul(e);else for(e=0;e<accessFolderList_samba.length;e++)1==$("#cb"+e).prop("data-checked")&&delShareMul(e);$.act(ACT_SET,SMB_SERVICE,null,null,["modified=0"]),$.act(ACT_SET,FTP_SERVER,null,null,["modified=0"]),$.exe();var t={};t.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",t)}function doSet(){var e,t;if(""===(e=$("#username").val()))return $.alert(ERR_USER_NAME_EMPTY);if($.asc(e,!0))return $.alert(ERR_USER_NAME_ASCII);if(/[\\\/:\*\?"<>|[\]@\+=;,\.\ ()$]+/.test(e))$.alert(ERR_USB_INVALID_CHAR_IN_USER_NAME);else{if(""===(t=$("#password").val()))return $.alert(ERR_USER_PWD_EMPTY);if($.asc(t,!0))return $.alert(ERR_USER_PWD_ASCII);if(t!==$("#cfPassword").val())return $.alert(ERR_USER_NAME_PWD_CONFLICT);userTbl[0].name=e,userTbl[0].pwd=t}}function vtlServList_IP_ConfiltPort(e){var t,l=$.act(ACT_GL,WAN_IP_CONN_PORTMAPPING,null,null),a=[],s=0,r=0,n=e.ftp;if(INCLUDE_USB_SFTP_SERVER)var o=e.sftp;var i=e.https;if(!$.exe()){if($.each(l,function(){null!=n&&1==this.portMappingEnabled&&(n==this.externalPort||n==this.X_TP_ExternalPortEnd||0<this.externalPort&&this.externalPort<n&&n<this.X_TP_ExternalPortEnd)&&(a[r]=this.__stack,r++,s=1),null!=i&&1==this.portMappingEnabled&&(i==this.externalPort||i==this.X_TP_ExternalPortEnd||0<this.externalPort&&this.externalPort<i&&i<this.X_TP_ExternalPortEnd)&&(a[r]=this.__stack,r++,s=1),INCLUDE_USB_SFTP_SERVER&&null!=o&&1==this.portMappingEnabled&&(o==this.externalPort||o==this.X_TP_ExternalPortEnd||0<this.externalPort&&this.externalPort<o&&o<this.X_TP_ExternalPortEnd)&&(a[r]=this.__stack,r++,s=1)}),1!=s)return vtlServList_PPP_ConfiltPort(e);$.confirm(c_str.ftp_vs_conflict,function(){for(t=0;t<r;t++)$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,a[t],null,["portMappingEnabled=0"]);if(!$.exe())return vtlServList_PPP_ConfiltPort(e)},function(){$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)})}}function vtlServList_PPP_ConfiltPort(e){var t,l=$.act(ACT_GL,WAN_PPP_CONN_PORTMAPPING,null,null),a=[],s=0,r=0,n=e.ftp;if(INCLUDE_USB_SFTP_SERVER)var o=e.sftp;var i=e.https;if(!$.exe()){if($.each(l,function(){null!=n&&1==this.portMappingEnabled&&(n==this.externalPort||n==this.X_TP_ExternalPortEnd||this.externalPort<n&&n<this.X_TP_ExternalPortEnd)&&(a[r]=this.__stack,r++,s=1),null!=i&&1==this.portMappingEnabled&&(i==this.externalPort||i==this.X_TP_ExternalPortEnd||this.externalPort<i&&i<this.X_TP_ExternalPortEnd)&&(a[r]=this.__stack,r++,s=1),INCLUDE_USB_SFTP_SERVER&&null!=o&&1==this.portMappingEnabled&&(o==this.externalPort||o==this.X_TP_ExternalPortEnd||this.externalPort<o&&o<this.X_TP_ExternalPortEnd)&&(a[r]=this.__stack,r++,s=1)}),1!=s)return portTrigList_IP_ConfiltPort(e);$.confirm(c_str.ftp_vs_conflict,function(){for(t=0;t<r;t++)$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,a[t],null,["portMappingEnabled=0"]);if(!$.exe())return portTrigList_IP_ConfiltPort(e)},function(){$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)})}}function portTrigList_IP_ConfiltPort(e){var t,l=$.act(ACT_GL,IP_CONN_PORTTRIGGERING,null,null),a=[],s=0,r=0,n=e.ftp;if(INCLUDE_USB_SFTP_SERVER)var o=e.sftp;var i=e.https;if(!$.exe()){if($.each(l,function(){null!=n&&(1!=this.enable||n!=this.triggerPort&&!checkPort(n,this.openPort)||(a[r]=this.__stack,r++,s=1)),null!=i&&(1!=this.enable||i!=this.triggerPort&&!checkPort(i,this.openPort)||(a[r]=this.__stack,r++,s=1)),INCLUDE_USB_SFTP_SERVER&&null!=o&&(1!=this.enable||o!=this.triggerPort&&!checkPort(o,this.openPort)||(a[r]=this.__stack,r++,s=1))}),1!=s)return portTrigList_PPP_ConfiltPort(e);$.confirm(c_str.ftp_pt_conflict,function(){for(t=0;t<r;t++)$.act(ACT_SET,IP_CONN_PORTTRIGGERING,a[t],null,["enable=0"]);if(!$.exe())return portTrigList_PPP_ConfiltPort(e)},function(){$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)})}}function portTrigList_PPP_ConfiltPort(e){var t,l=$.act(ACT_GL,PPP_CONN_PORTTRIGGERING,null,null),a=[],s=0,r=0,n=e.ftp;if(INCLUDE_USB_SFTP_SERVER)var o=e.sftp;var i=e.https;if(!$.exe()){if($.each(l,function(){null!=n&&(1!=this.enable||n!=this.triggerPort&&!checkPort(n,this.openPort)||(a[r]=this.__stack,r++,s=1)),null!=i&&(1!=this.enable||i!=this.triggerPort&&!checkPort(i,this.openPort)||(a[r]=this.__stack,r++,s=1)),INCLUDE_USB_SFTP_SERVER&&null!=o&&(1!=this.enable||o!=this.triggerPort&&!checkPort(o,this.openPort)||(a[r]=this.__stack,r++,s=1))}),1!=s)return dmzCfg_ConfiltPort(e);$.confirm(c_str.ftp_pt_conflict,function(){for(t=0;t<r;t++)$.act(ACT_SET,PPP_CONN_PORTTRIGGERING,a[t],null,["enable=0"]);if(!$.exe())return dmzCfg_ConfiltPort(e)},function(){$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)})}}function dmzCfg_ConfiltPort(e){var t=$.act(ACT_GET,DMZ_HOST_CFG,null,null);if(!$.exe()){if(1!=t.enable)return upnpCfgObj_ConfiltPort(e);$.confirm(c_str.ftp_dmz_conflict,function(){if($.act(ACT_SET,DMZ_HOST_CFG,null,null,["enable=0","IPAddress="+t.IPAddress]),!$.exe())return upnpCfgObj_ConfiltPort(e)},function(){$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)})}}function upnpCfgObj_ConfiltPort(e){var t,l=$.act(ACT_GET,UPNP_CFG),a=[],s=0,r=0,n=e.ftp;if(INCLUDE_USB_SFTP_SERVER)var o=e.sftp;var i=e.https;if(!$.exe())if(1==l.enable){var c=$.act(ACT_GL,UPNP_PORTMAPPING,null,null);if($.exe())return 0;if($.each(c,function(){null!=n&&(1!=this.portMappingEnabled||n!=this.externalPort&&n!=this.internalPort||(a[r]=this.__stack,r++,s=1)),null!=i&&(1!=this.portMappingEnabled||i!=this.externalPort&&i!=this.internalPort||(a[r]=this.__stack,r++,s=1)),INCLUDE_USB_SFTP_SERVER&&null!=o&&(1!=this.portMappingEnabled||o!=this.externalPort&&o!=this.internalPort||(a[r]=this.__stack,r++,s=1))}),1==s)$.confirm(c_str.ftp_upnp_conflict,function(){for(t=0;t<r;t++)$.act(ACT_DEL,UPNP_PORTMAPPING,a[t],null,null);if(!$.exe()&&(1==$("#outerFtp").prop("data-checked")?$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=1"]):$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]),null!=n?$.act(ACT_SET,FTP_SERVER,null,null,["portNumber="+n]):$.act(ACT_SET,FTP_SERVER,null,null,["portNumber="+$("#port").val()]),INCLUDE_USB_SFTP_SERVER&&(1==$("#outSftp").prop("data-checked")?$.act(ACT_SET,FTP_SERVER,null,null,["accessSftpFromInternet=1"]):$.act(ACT_SET,FTP_SERVER,null,null,["accessSftpFromInternet=0"]),null!=o?$.act(ACT_SET,FTP_SERVER,null,null,["SPortNumber="+o]):$.act(ACT_SET,FTP_SERVER,null,null,["SPortNumber="+$("#sport").val()])),$.act(ACT_SET,FTP_SERVER,null,null,["modified=0"]),INCLUDE_STORAGE_HTTP_SERVICE&&($.act(ACT_SET,STORAGE_HTTP,null,null,["portNumber="+$("#httpPort").val()]),$.act(ACT_SET,STORAGE_HTTP,null,null,["httpsPortNumber="+$("#httpsPort").val()]),1==$("#outerHttpsStorage").prop("data-checked")?$.act(ACT_SET,STORAGE_HTTP,null,null,["accessFromInternet=1"]):$.act(ACT_SET,STORAGE_HTTP,null,null,["accessFromInternet=0"])),!$.exe())){$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)}},function(){$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)});else if(1==$("#outerFtp").prop("data-checked")?$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=1"]):$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]),null!=n?$.act(ACT_SET,FTP_SERVER,null,null,["portNumber="+n]):$.act(ACT_SET,FTP_SERVER,null,null,["portNumber="+$("#port").val()]),$.act(ACT_SET,FTP_SERVER,null,null,["modified=0"]),INCLUDE_USB_SFTP_SERVER&&(1==$("#outSftp").prop("data-checked")?$.act(ACT_SET,FTP_SERVER,null,null,["accessSftpFromInternet=1"]):$.act(ACT_SET,FTP_SERVER,null,null,["accessSftpFromInternet=0"]),null!=o?$.act(ACT_SET,FTP_SERVER,null,null,["SPortNumber="+o]):$.act(ACT_SET,FTP_SERVER,null,null,["SPortNumber="+$("#sport").val()])),INCLUDE_STORAGE_HTTP_SERVICE&&($.act(ACT_SET,STORAGE_HTTP,null,null,["portNumber="+$("#httpPort").val()]),$.act(ACT_SET,STORAGE_HTTP,null,null,["httpsPortNumber="+$("#httpsPort").val()]),1==$("#outerHttpsStorage").prop("data-checked")?$.act(ACT_SET,STORAGE_HTTP,null,null,["accessFromInternet=1"]):$.act(ACT_SET,STORAGE_HTTP,null,null,["accessFromInternet=0"])),!$.exe())$.removeLoading(),(_={}).scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",_)}else{var _;if(1==$("#outerFtp").prop("data-checked")?$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=1"]):$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]),null!=n?$.act(ACT_SET,FTP_SERVER,null,null,["portNumber="+n]):$.act(ACT_SET,FTP_SERVER,null,null,["portNumber="+$("#port").val()]),$.act(ACT_SET,FTP_SERVER,null,null,["modified=0"]),INCLUDE_USB_SFTP_SERVER&&(1==$("#outSftp").prop("data-checked")?$.act(ACT_SET,FTP_SERVER,null,null,["accessSftpFromInternet=1"]):$.act(ACT_SET,FTP_SERVER,null,null,["accessSftpFromInternet=0"]),null!=o?$.act(ACT_SET,FTP_SERVER,null,null,["SPortNumber="+o]):$.act(ACT_SET,FTP_SERVER,null,null,["SPortNumber="+$("#sport").val()])),INCLUDE_STORAGE_HTTP_SERVICE&&($.act(ACT_SET,STORAGE_HTTP,null,null,["portNumber="+$("#httpPort").val()]),$.act(ACT_SET,STORAGE_HTTP,null,null,["httpsPortNumber="+$("#httpsPort").val()]),1==$("#outerHttpsStorage").prop("data-checked")?$.act(ACT_SET,STORAGE_HTTP,null,null,["accessFromInternet=1"]):$.act(ACT_SET,STORAGE_HTTP,null,null,["accessFromInternet=0"])),!$.exe())$.removeLoading(),(_={}).scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",_)}}function checkPort(e,t){var l,a=(t=t.toString()).split(","),s=!1;for(l=0;l<a.length;l++){var r=a[l].split("-");if(1==r.length){if(parseInt(r[0])==parseInt(e)){s=!0;break}}else if(2==r.length&&parseInt(r[0])<=parseInt(e)&&parseInt(r[1])>=parseInt(e)){s=!0;break}}return s}$("#shareItemAdd").click(function(){shareTabStatus="add"}),$("#refShareSet").click(function(){initAuthTab()}),$("#shareOn").click(function(){if($.addLoading($(this)),$.act(ACT_SET,SMB_SERVICE,null,null,["shareAll=1"]),$.act(ACT_SET,FTP_SERVER,null,null,["shareAll=1"]),$.act(ACT_SET,DLNA_MEDIA_SERVER,null,null,["shareAll=1"]),INCLUDE_STORAGE_HTTP_SERVICE&&$.act(ACT_SET,STORAGE_HTTP,null,null,["shareAll=1"]),!$.exe()){$("#authentication").removeClass("nd"),$("#shareDrawing").addClass("nd"),$("#authDrawing").removeClass("nd"),$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)}}),$("#shareOff").click(function(){if($.addLoading($(this)),$.act(ACT_SET,SMB_SERVICE,null,null,["shareAll=0"]),$.act(ACT_SET,FTP_SERVER,null,null,["shareAll=0"]),$.act(ACT_SET,DLNA_MEDIA_SERVER,null,null,["shareAll=0"]),INCLUDE_STORAGE_HTTP_SERVICE&&$.act(ACT_SET,STORAGE_HTTP,null,null,["shareAll=0"]),!$.exe()){$("#authentication").addClass("nd"),$("#authDrawing").addClass("nd"),$("#shareDrawing").removeClass("nd"),$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)}}),$("#authOn").click(function(){if($.addLoading($(this)),$.act(ACT_SET,SMB_SERVICE,null,null,["anonymous=0"]),$.act(ACT_SET,FTP_SERVER,null,null,["anonymous=0"]),INCLUDE_STORAGE_HTTP_SERVICE&&$.act(ACT_SET,STORAGE_HTTP,null,null,["anonymous=0"]),!$.exe()){$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)}}),$("#authOff").click(function(){if($.addLoading($(this)),$.act(ACT_SET,SMB_SERVICE,null,null,["anonymous=1"]),$.act(ACT_SET,FTP_SERVER,null,null,["anonymous=1"]),INCLUDE_STORAGE_HTTP_SERVICE&&$.act(ACT_SET,STORAGE_HTTP,null,null,["anonymous=1"]),!$.exe()){$.removeLoading();var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)}}),$("#shareVolume").click(function(){currentVol=$("#shareVolume").data("value")}),$("#cancelPathSel").click(function(){$.hideCover(),$("#folderSelContent").empty(),$("#folderSel").addClass("nd")}),$("#confirmPathSel").click(function(){$.hideCover(),$("#folderSelContent").empty(),$("#folderSel").addClass("nd"),$("#filename").val(transStr(folderPath))}),$("#edit-ok").click(function(){var e,t,l,a,s,r,n,o={},i={},c={};if(INCLUDE_STORAGE_HTTP_SERVICE)var _={};if($.addLoading($(this)),""!==(e=$("#shareName").val()))if(/[\\\/:\*\?"<>|\]\ ]+/.test(e))$.alert(ERR_USB_INVALID_CHAR_IN_FOLDER_NAME);else if($.asc(e))$.alert(ERR_USB_SHARE_NAME_NOT_ASCII);else if(l=t="",$.each(volumeList,function(){this.name==currVolume&&(t=this.uuid,l=this.label)}),""!=(r=$("#filename").val()))if(n=2==r.length||"ALL:"==r?"/":r.substring(r.indexOf(":")+1,r.length),currentVol!=table_str.selectopt){if("add"==shareTabStatus){for(a=0;a<accessFolderList_samba.length;a++){if(n==accessFolderList_samba[a].name&&t==accessFolderList_samba[a].volumeUuid)return void $.alert(ERR_USB_DIR_EXIST);if($("#shareName").val()==accessFolderList_samba[a].alias)return void $.alert(ERR_USB_SHARE_NAME_EXIST)}o.name=n,o.alias=$("#shareName").val(),o.enable=1,o.needAuth=1==$("#ea").prop("data-checked")?1:0,i.name=n,i.alias=$("#shareName").val(),i.enable=1,i.needAuth=1==$("#ea").prop("data-checked")?1:0,i.writePermission=1==$("#wa").prop("data-checked")?7:3,c.name=n,c.alias=$("#shareName").val(),c.enable=1==$("#ems").prop("data-checked")?1:0,c.needAuth=1==$("#ea").prop("data-checked")?1:0,INCLUDE_STORAGE_HTTP_SERVICE&&(_.name=n,_.alias=$("#shareName").val(),_.enable=1,_.needAuth=1==$("#ea").prop("data-checked")?1:0,_.readOnly=1==$("#wa").prop("data-checked")?0:1),""!=t&&(o.volumeUuid=t,i.volumeUuid=t,c.volumeUuid=t,INCLUDE_STORAGE_HTTP_SERVICE&&(_.volumeUuid=t)),""!=l&&(o.volumeLabel=l,i.volumeLabel=l,c.volumeLabel=l,INCLUDE_STORAGE_HTTP_SERVICE&&(_.volumeLabel=l)),$.act(ACT_ADD,SMB_SERVICE_FOLDER,null,null,o),accessFolderList_samba=$.act(ACT_GL,SMB_SERVICE_FOLDER,null,null,null),$.act(ACT_ADD,FTP_SERVER_FOLDER,null,null,i),accessFolderList_ftp=$.act(ACT_GL,FTP_SERVER_FOLDER,null,null,null),$.act(ACT_ADD,DLNA_MEDIA_SERVER_FOLDER,null,null,c),accessFolderList_dlna=$.act(ACT_GL,DLNA_MEDIA_SERVER_FOLDER,null,null,null),INCLUDE_STORAGE_HTTP_SERVICE&&($.act(ACT_ADD,STORAGE_HTTP_FOLDER,null,null,_),accessFolderList_http=$.act(ACT_GL,STORAGE_HTTP_FOLDER,null,null,null))}else{for(a=0;a<accessFolderList_samba.length;a++){if($("#shareName").val()==accessFolderList_samba[a].alias&&a!=editCurIndex)return void $.alert(ERR_USB_SHARE_NAME_EXIST);if(n==accessFolderList_samba[a].name&&t==accessFolderList_samba[a].volumeUuid&&a!=editCurIndex)return void $.alert(ERR_USB_DIR_EXIST)}o.name=n,o.alias=$("#shareName").val(),o.needAuth=1==$("#ea").prop("data-checked")?1:0,i.name=n,i.alias=$("#shareName").val(),i.needAuth=1==$("#ea").prop("data-checked")?1:0,i.writePermission=1==$("#wa").prop("data-checked")?7:3,c.name=n,c.alias=$("#shareName").val(),c.enable=1==$("#ems").prop("data-checked")?1:0,c.needAuth=1==$("#ea").prop("data-checked")?1:0,INCLUDE_STORAGE_HTTP_SERVICE&&(_.name=n,_.alias=$("#shareName").val(),_.needAuth=1==$("#ea").prop("data-checked")?1:0,_.readOnly=1==$("#wa").prop("data-checked")?0:1),""!=t&&(o.volumeUuid=t,i.volumeUuid=t,c.volumeUuid=t,INCLUDE_STORAGE_HTTP_SERVICE&&(_.volumeUuid=t)),""!=l&&(o.volumeLabel=l,i.volumeLabel=l,c.volumeLabel=l,INCLUDE_STORAGE_HTTP_SERVICE&&(_.volumeLabel=l)),$.act(ACT_SET,SMB_SERVICE_FOLDER,accessFolderList_samba[editCurIndex].__stack,null,o),accessFolderList_samba=$.act(ACT_GL,SMB_SERVICE_FOLDER,null,null,null),$.act(ACT_SET,FTP_SERVER_FOLDER,accessFolderList_ftp[editCurIndex].__stack,null,i),accessFolderList_ftp=$.act(ACT_GL,FTP_SERVER_FOLDER,null,null,null),$.act(ACT_SET,DLNA_MEDIA_SERVER_FOLDER,accessFolderList_dlna[editCurIndex].__stack,null,c),accessFolderList_dlna=$.act(ACT_GL,DLNA_MEDIA_SERVER_FOLDER,null,null,null),INCLUDE_STORAGE_HTTP_SERVICE&&($.act(ACT_SET,STORAGE_HTTP_FOLDER,accessFolderList_http[editCurIndex].__stack,null,_),accessFolderList_http=$.act(ACT_GL,STORAGE_HTTP_FOLDER,null,null,null))}$.exe(function(e){if(e)$.removeLoading();else{"add"==shareTabStatus?(s=accessFolderList_samba[folderIdx].__stack,accessFolderList_ftp[folderIdx].__stack,INCLUDE_STORAGE_HTTP_SERVICE&&accessFolderList_http[folderIdx].__stack):(s=accessFolderList_samba[editCurIndex].__stack,accessFolderList_ftp[editCurIndex].__stack,INCLUDE_STORAGE_HTTP_SERVICE&&accessFolderList_http[editCurIndex].__stack);var t=1,l={};for(a=0;a<userAccessList_samba.length;a++)parseInt(s,10)==parseInt(userAccessList_samba[a].__stack,10)&&(parseInt(userList[0].__stack,10)==userAccessList_samba[a].userId&&((l.userId=1)==$("#wa").prop("data-checked")?l.permissions=7:l.permissions=3),$.act(ACT_SET,SMB_USER_ACCESS,userAccessList_samba[a].__stack,null,l),t=0);1==t&&((l.userId=1)==$("#wa").prop("data-checked")?l.permissions=7:l.permissions=3,$.act(ACT_ADD,SMB_USER_ACCESS,null,s,l)),$.exe(function(e){if(e)$.removeLoading();else if($.act(ACT_SET,SMB_SERVICE,null,null,["modified=0"]),$.act(ACT_SET,FTP_SERVER,null,null,["modified=0"]),!$.exe()){$.removeLoading();var t={};t.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",t)}})}})}else $.alert(CMM_USB_SELECT_VOLUME);else $.alert(CMM_USB_BROWSE_FOLDER_PATH);else $.alert(ERR_USB_SHARE_NAME_EMPTY)}),$("#edit-cancel").click(function(){var e={};e.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",e)}),$("#saveAccount").click(function(){var e={};if(/[\\\/:\*\?"<>|[\]@\+=;,\.\ ()$]+/.test($("#username").val()))$.alert(ERR_USB_INVALID_CHAR_IN_USER_NAME);else if($.addLoading($(this)),1==$("#loginAccount").prop("checked")?e.X_TP_UseLoginAccount=1:(e.X_TP_UseLoginAccount=0,doSet(),e.username=userTbl[0].name,e.password=userTbl[0].pwd),$.act(ACT_SET,USER_ACCOUNT,userTbl[0].stack,null,e),!$.exe()){$.removeLoading();var t={};t.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",t)}}),$("#loginAccount").click(function(){$("#username").prop("disabled",!0),$("#password").tpPassword("disabled",!0),$("#username").val(userCfg.adminName),$("#password").tpPassword("val",userCfg.adminPwd),$("#pwdCheck").addClass("nd"),$("#cfpwd").addClass("nd"),$("#t_salp").removeClass("nd"),$("#pwdErrTips").hide(),$($("#password").parent()).removeClass("error"),$("#saveAccount").prop("disabled",!1)}),$("#followingAccount").click(function(){$("#username").prop("disabled",!1),$("#password").tpPassword("disabled",!1),$("#pwdCheck").removeClass("nd"),$("#cfpwd").removeClass("nd"),$("#t_salp").addClass("nd"),$("#username").val(userList[0].username),$("#password").tpPassword("val",userList[0].password),$("#cfPassword").val(userList[0].password)}),$("#pwdErrTips").text($.tpLang.login.tipsTextLength),$("input#password").keyup(function(e){var t=$("#password").tpPassword("val");$.pwdIntensityCheck($("#pwdCheck"),t),32<t.length?($($("#password").parent()).addClass("error"),$("#pwdErrTips").show(),$("#saveAccount").prop("disabled",!0)):($($("#password").parent()).removeClass("error"),$("#pwdErrTips").hide(),$("#saveAccount").prop("disabled",!1))}),$("#saveSett").click(function(){var e;if(INCLUDE_STORAGE_HTTP_SERVICE)var t,l,a,s,r;var n=$("#outerFtp").prop("data-checked");if(INCLUDE_USB_SFTP_SERVER){var o=$("#outSftp").prop("data-checked");$("#sFtp").prop("data-checked")}if(INCLUDE_STORAGE_HTTP_SERVICE)var i=$("#outerHttpsStorage").prop("data-checked");if(16<=$("#server_name").val().length)$.alert(CMM_USB_SERVER_NAME_LENGTH);else{var c={};if($.addLoading($(this)),c.serverName=$("#server_name").val(),""!=c.serverName)if($.asc(c.serverName,!0))$.alert(ERR_USB_DLNA_SERVER_NAME_NOT_ASCII);else if(/[\\\/\*\?=+:;,."<>|@\[\]\(\)\ ]+/.test(c.serverName))$.alert(ERR_USB_DLNA_INVALID_SERVER_NAME);else{var _={};_.serverName=$("#server_name").val(),$.act(ACT_SET,DLNA_MEDIA_SERVER,null,null,c),$.act(ACT_SET,SMB_SERVICE,null,null,_),1==$("#mediaServer").prop("data-checked")?$.act(ACT_SET,DLNA_MEDIA_SERVER,null,null,["serverState=1"]):$.act(ACT_SET,DLNA_MEDIA_SERVER,null,null,["serverState=0"]),1==$("#samba").prop("data-checked")?$.act(ACT_SET,SMB_SERVICE,null,null,["enable=1"]):$.act(ACT_SET,SMB_SERVICE,null,null,["enable=0"]),1==$("#innerFtp").prop("data-checked")?$.act(ACT_SET,FTP_SERVER,null,null,["enable=1"]):$.act(ACT_SET,FTP_SERVER,null,null,["enable=0"]),INCLUDE_STORAGE_HTTP_SERVICE&&(1==$("#httpStorage").prop("data-checked")?$.act(ACT_SET,STORAGE_HTTP,null,null,["enable=1"]):$.act(ACT_SET,STORAGE_HTTP,null,null,["enable=0"]));var d={https:null,ftp:null,sftp:null};if(INCLUDE_USB_SFTP_SERVER){var u;if(""==(e=$("#sport").val()))return $.alert(ERR_USB_FTP_PORT_EMPTY),void((E=$("#sport"))&&(E.focus(),E.select()));if(!$.isnum(e))return $.alert(ERR_USB_FTP_PORT_NOT_NUM),void((E=$("#sport"))&&(E.focus(),E.select()));if(e<1||65535<e)return $.alert(ERR_USB_FTP_PORT_RANGE),void((E=$("#sport"))&&(E.focus(),E.select()));if(53==e||70==e||80==e||119==e||110==e||1723==e||25==e||1080==e||23==e||33344==e||20005==e||1900==e||7547==e||139==e||445==e||3240==e||67==e||68==e||1701==e||1723==e||49152==e||1040==e||61e3==e||49153==e||554==e||546==e||547==e)return $.alert(ERR_USB_FTP_PORT_CONFLICT),void((E=$("#sport"))&&(E.focus(),E.select()));t=parseInt(e,10);var T=0;1==$("#sFtp").prop("data-checked")&&(T=1),$.act(ACT_SET,FTP_SERVER,null,null,["SPortNumber="+t,"sftpEnable="+T]),u=t,d.sftp=t}if(""!=(e=$("#port").val())){if(!$.isnum(e))return $.alert(ERR_USB_FTP_PORT_NOT_NUM),void((E=$("#port"))&&(E.focus(),E.select()));if(e<1||65535<e)return $.alert(ERR_USB_FTP_PORT_RANGE),void((E=$("#port"))&&(E.focus(),E.select()));if(53==e||70==e||80==e||119==e||110==e||1723==e||25==e||1080==e||23==e||33344==e||20005==e||1900==e||7547==e||139==e||445==e||3240==e||67==e||68==e||1701==e||1723==e||49152==e||1040==e||61e3==e||49153==e||554==e||546==e||547==e||443==e)return $.alert(ERR_USB_FTP_PORT_CONFLICT),void((E=$("#port"))&&(E.focus(),E.select()));if(INCLUDE_STORAGE_HTTP_SERVICE&&(e==$("#httpPort").val()||e==$("#httpsPort").val()))return $.alert(ERR_USB_FTP_PORT_CONFLICT),void((E=$("#port"))&&(E.focus(),E.select()));if(t=parseInt(e,10),1==$("#outerFtp").prop("data-checked")&&(d.ftp=t),INCLUDE_STORAGE_HTTP_SERVICE){if(""==(l=$("#httpPort").val()))return void $.alert(ERR_USB_HTTP_PORT_ERR);var E;if(!$.isnum(l))return $.alert(ERR_USB_HTTP_PORT_ERR),void((E=$("#httpPort"))&&(E.focus(),E.select()));if(l<1||65535<l)return $.alert(ERR_USB_HTTP_PORT_ERR),void((E=$("#httpPort"))&&(E.focus(),E.select()));if(53==l||70==l||80==l||119==l||110==l||1723==l||25==l||1080==l||23==l||33344==l||20005==l||1900==l||7547==l||139==l||445==l||3240==l||67==l||68==l||1701==l||1723==l||49152==l||1040==l||61e3==l||49153==l||554==l||546==l||547==l||443==l||l==$("#port").val()||l==$("#httpsPort").val())return $.alert(ERR_USB_HTTP_PORT_CONFLICT),void((E=$("#httpPort"))&&(E.focus(),E.select()));if(s=parseInt(l,10),""==(a=$("#httpsPort").val()))return void $.alert(ERR_USB_HTTPS_PORT_ERR);if(!$.isnum(a))return $.alert(ERR_USB_HTTPS_PORT_ERR),void((E=$("#httpsPort"))&&(E.focus(),E.select()));if(a<1||65535<a)return $.alert(ERR_USB_HTTPS_PORT_ERR),void((E=$("#httpsPort"))&&(E.focus(),E.select()));if(53==a||70==a||80==a||119==a||110==a||1723==a||25==a||1080==a||23==a||33344==a||20005==a||1900==a||7547==a||139==a||445==a||3240==a||67==a||68==a||1701==a||1723==a||49152==a||1040==a||61e3==a||49153==a||554==a||546==a||547==a||443==a||a==$("#port").val()||a==$("#httpPort").val())return $.alert(ERR_USB_HTTPS_PORT_CONFLICT),void((E=$("#httpsPort"))&&(E.focus(),E.select()));r=parseInt(a,10),d.https=r}if(n||INCLUDE_USB_SFTP_SERVER&&o||INCLUDE_STORAGE_HTTP_SERVICE&&i)return vtlServList_IP_ConfiltPort(d);if($.act(ACT_SET,FTP_SERVER,null,null,["portNumber="+t]),$.act(ACT_SET,FTP_SERVER,null,null,["modified=0"]),$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]),INCLUDE_USB_SFTP_SERVER&&($.act(ACT_SET,FTP_SERVER,null,null,["accessSftpFromInternet=0"]),$.act(ACT_SET,FTP_SERVER,null,null,["SPortNumber="+u])),INCLUDE_STORAGE_HTTP_SERVICE&&($.act(ACT_SET,STORAGE_HTTP,null,null,["portNumber="+s]),$.act(ACT_SET,STORAGE_HTTP,null,null,["accessFromInternet=0"]),$.act(ACT_SET,STORAGE_HTTP,null,null,["httpsPortNumber="+r])),!$.exe()){$.removeLoading();var p={};p.scrollTop=$("#scroll").scrollTop(),$.loadMain("folderSharing.htm",p)}}else $.alert(ERR_USB_FTP_PORT_EMPTY)}else $.alert(ERR_USB_DLNA_SERVER_NAME_EMPTY)}})</script>
<style>.err-tips{display:none;line-height:1.5;color:#c11c66;margin-left:220px}.error{border-color:#c11c66!important}.error+.err-tips{display:block}div.tpPassword.error span.corner-left{background-position:-3px -106px}div.tpPassword.error span.corner-right{background-position:-19px -106px}.pure-form input[type=text][disabled].tp-input-text~.corner-left{background-position:-3px -1px}.pure-form input[type=text][disabled].tp-input-text~.corner-right{background-position:-20px -1px}</style>
<div id="disks"></div>
<div id="folderSharingPart" class="nd">
    <h3 id="t_shareAcc">Sharing Account</h3>
    <div class="content-container">
        <form class="pure-form pure-form-aligned">
            <p class="cfg-line" id="t_info1">Prepare an account for sharing contents. You can use the login account or create a new one.</p>
            <div>
                <b id="t_account" class="l">Account:</b>
                <input type="radio" name="radio_name_account" id="loginAccount">
                <label id="t_ula">Use Default Account</label>
            </div>
            <div>
                <b class="l"></b>
                <input type="radio" name="radio_name_account" id="followingAccount">
                <label id="t_ufa">Use New Account</label>
            </div>
        <div id="user" class="pure-control-group">
            <b class="T_username l">Username:</b>
            <input type="text" maxlength="15" class="tp-input-text secLevel" id="username">
        </div>
        <div id="pwd" class="pure-control-group">
            <b class="T_passwd l">Password:</b>
                <input type="password" id="password" class="secLevel" style="border:0">
            <span id="t_salp">(Same as Login Password)</span>
        </div>
        <div class="secLevel" id="pwdCheck">
            <span class="level1 T_low">Low</span>
            <span class="level2 T_middle">Middle</span>
            <span class="level3 T_high">High</span>
        </div>
            <div class="err-tips" id="pwdErrTips">Your password is invalid. Passwords may contain 1-32 letters and numbers.</div>
        <div id="cfpwd" class="pure-control-group">
            <b class="T_cfmpwd l">Confirm Password:</b>
                <input type="password" maxlength="32" id="cfPassword" class="secLevel" style="border:0">
        </div>
        <button type="submit" class="green T_save" id="saveAccount">Save</button>
    </form>
</div>
<h3 id="t_shareSett">Sharing Setting</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="pure-control-group">
            <b id="t_nsn" class="l">Network/Media Server Name:</b>
            <input type="text" id="server_name" maxlength="15">
        </div>
        <div id="accessDrawing" class="part-separate">
            <table id="accessTab">
                <thead></thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div class="part-separate">
            <button type="submit" class="green T_save" id="saveSett">Save</button>
        </div>
    </form>
</div>
<h3 id="t_sf">Folder Sharing</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="button-group-container">
            <b id="t_esa">Share All:</b>
            <ul>
                <li>
                    <button id="shareOn" class="fst" value="on">On</button>
                </li>
                <li>
                    <button id="shareOff" class="lst" value="off">Off</button>
                </li>
            </ul>
        </div>
        <div class="browse-content-container nd" id="folderSel">
            <div class="browse-content-container-wrap">
                <span><b id="t_brw">My Router</b>
                </span>
                <br>
                <br>
                <div id="folderSelContent">
                </div>
            </div>
                <div class="inline-btn-right">
                    <button type="submit" class="green inline T_cancel" id="cancelPathSel">Cancel</button>
                    <button type="submit" class="green inline T_save" id="confirmPathSel">Save</button>
                </div>
            </div>
            <div id="shareDrawing" class="nd">
                <div class="table-op">
                    <div class="table-btn">
                        <span class="add-icon" id="shareItemAdd"></span>
                        <label class="T_add">Add</label>
                        <span class="delete-icon" onclick="deleteItem()"></span>
                        <label class="T_del">Delete</label>
                    </div>
                </div>
                <table id="shareTab">
                    <thead></thead>
                    <tbody>
                        <tr id="editShareFolder" class="nd">
                            <td colspan="8">
                                <div>
                                    <b id="t_vol">Volume Name:</b>
                                    <select id="shareVolume">
                                    </select>
                                </div>
                                <div>
                                    <b id="t_folP">Folder Path:</b>
                                    <input type="text" id="filename" class="xl" disabled="disabled" required>
                                    <button type="submit" class="blue" id="t_browse" onclick="showBrowse()">Browse</button>
                                </div>
                                <div>
                                    <b id="t_shareN">Folder Name:</b>
                                    <input type="text" id="shareName" maxlength="31" class="xl" required>
                                </div>
                                <div>
                                    <b></b>
                                    <input type="checkbox" checked="checked" id="ea">
                                    <label id="t_ea">Enable Authentication</label>
                                </div>
                                <div id="eaNote">
                                    <b class="T_usbNote">After disable authentication, if you are still asked to login, type "guest" in account and leave the password blank.</b>
                                </div>
                                <div>
                                    <b></b>
                                    <input type="checkbox" id="wa">
                                    <label id="t_wa">Enable Write Access</label>
                                </div>
                                <div>
                                    <b></b>
                                    <input type="checkbox" id="ems">
                                    <label id="t_ems">Enable Media Sharing</label>
                                </div>
                                <div class="inline-btn-right">
                                    <button type="submit" class="green T_cancel" id="edit-cancel">Cancel</button>
                                    <button type="submit" class="green T_save" id="edit-ok">Save</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        <div class="button-group-container" id="authentication">
            <b id="t_ea_a">Enable Authentication:</b>
            <ul>
                <li>
                    <button id="authOn" class="fst" value="on">On</button>
                </li>
                <li>
                    <button id="authOff" class="lst" value="off">Off</button>
                </li>
            </ul>
        </div>
        <div class="nd" id="authenticationNote">
            <b class="T_usbNote">After disable authentication, if you are still asked to login, type "guest" in account and leave the password blank.</b>
        </div>
        <div id="authDrawing" class="nd">
            <div class="table-op">
                <div class="table-btn">
                    <span class="refresh-icon" id="refShareSet"></span>
                    <label class="T_refresh">Refresh</label>
                </div>
            </div>
            <table id="authTab">
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>
    </form>
</div>
</div>
<script>$.loadPage("disks","diskSettings.htm",function(){$("#folderSharingPart").removeClass("nd"),$.tpInit(init)})</script>
