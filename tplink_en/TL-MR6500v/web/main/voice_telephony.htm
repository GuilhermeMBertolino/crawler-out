<script>var voipAccounts,voipLineList,voipLineCodecObj,speakerVolume,micVolume,curStk=new Array,freshFlag=!0,count=0,curLineIndex=-1,checkId=new Array,incomingFlag=new Array(1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768);function enterCheck(){try{var e=n_str.voice_telephony.t_dev;getValue("devName",e,1,15),checkSpecial($("#devName"),e)}catch(e){if(!1===e)return!1;throw e}return!0}function setInCome(e){var t,i=incomingFlag[e],n="",o=0;checkId=[],$.each(voipAccounts,function(){"",t=-1,checkid="",n="",this.multiExtension&&""!=this.multiExtension&&this.multiAccountInRoute&i?(this.multiProfileName,t=this.multiIndexing,checkid="in_"+t,++o<2?n="<div style='margin-bottom: 10px;'><input type='checkbox' id="+checkid+" checked='checked'/><label>"+this.multiExtension+"</label></div>":2==o&&(n="<div style='margin-bottom: 10px;'><input type='checkbox' id="+checkid+" checked='checked'/><label>"+this.multiExtension+"</label></div>",o=0),$("#incall").append(n),$(n).find("input[type='checkbox']").tpCheckbox(),checkId.push(checkid)):this.multiExtension&&""!=this.multiExtension&&(this.multiExtension,t=this.multiIndexing,checkid="in_"+t,++o<2?n="<div style='margin-bottom: 10px;'><input id="+checkid+" type='checkbox' /><label>"+this.multiExtension+"</label></div>":2==o&&(n="<div style='margin-bottom: 10px;'><input id="+checkid+" type='checkbox' /><label>"+this.multiExtension+"</label></div>",o=0),$("#incall").append(n),$(n).find("input[type='checkbox']").tpCheckbox(),checkId.push(checkid))})}function setOutSel(e){for(var t="",i="",n=0;n<voipAccounts.length;n++)voipAccounts[n].multiExtension&&""!=voipAccounts[n].multiExtension&&(t+="<option value='"+(n+1)+"' text='"+(i=voipAccounts[n].multiExtension)+"' >"+i+"</option>");t+="<option value='auto' text='auto'>"+showtype[0]+"</option>",$("#outSel").empty().append(t),0==e?$("#outSel option[value='auto']").prop("selected","selected"):$('#outSel option[value="'+e+'"]').prop("selected","selected");$("#outSel").tpSelect({refresh:1})}function doEdit(e,t){freshFlag=!1,voipAccounts=$.act(ACT_GL,XTP_MULTI_ISP,null,null,["multiProfileName","multiAccountInRoute","multiExtension","multiIndexing"]),voipLineCodecObj=$.act(ACT_GS,VOICE_PROF_LINE_CODEC_LIST,null,t,["SilenceSuppression"]);var i=$.act(ACT_GET,VOICE_PROF_LINE,t,null,["X_TP_PhoneName","X_TP_PhoneType"]),n=$.act(ACT_GET,VOICE_PROF_LINE_CALLFEAT,t,null,["X_TP_UsbVoiceEnable","X_TP_OutgoingCallprior","X_TP_OutgoingCallpriorAccount","X_TP_OutgoingCallEndWithSharp","X_TP_LineMwiEnable","X_TP_DoNotDisturbStart","X_TP_AnonymousCallBlockStart","X_TP_CallForwardUnconditionalStart","X_TP_CallForwardOnBusyStart","X_TP_CallForwardOnNoAnswerStart","callForwardUnconditionalNumber","callForwardOnBusyNumber","callForwardOnNoAnswerNumber","X_TP_CallWaitingStart","X_TP_AnonymousCallStart","X_TP_WarmLineStart","X_TP_WarmLineTimer","X_TP_WarmLineNumber","X_TP_CallForwardOnNoAnswerThresholdTime","X_TP_CallBarringMode"]);if(0==$.exe()){if(1==voipLineCodecObj[0].silenceSuppression?$("#vad").prop("checked",!0):$("#vad").prop("checked",!1),$("#vad").data("tpCheckbox").refresh(),4294967295==n.X_TP_OutgoingCallpriorAccount?setOutSel(0):setOutSel(n.X_TP_OutgoingCallpriorAccount),initVolume(t),setInCome(e),curLineIndex=e,curStk=t,"Phone 1"==i.X_TP_PhoneName)var o=table_str.phone1;else if("Phone 2"==i.X_TP_PhoneName)o=table_str.phone2;else o=i.X_TP_PhoneName;$("#devName").prop("value",o)}else freshFlag=!0}function getIncomingNum(e){for(var t="",i=count=0;i<voipAccounts.length;i++)voipAccounts[i].multiExtension&&""!=voipAccounts[i].multiExtension&&voipAccounts[i].multiAccountInRoute&incomingFlag[e]&&(t+=voipAccounts[i].multiExtension,t+="/",count++);return 0==count&&(t="--"),count==voipAccounts.length&&(t=showtype[6]),t}function doDectDel(e){$.confirm(c_str.voice_del_con,function(){$.addLoading($(this)),$.act(ACT_OP,ACT_DECT_HANDSET_UNREGISTER,e),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()})})}function doVoiceappDel(e){$.confirm(c_str.voice_del_con,function(){$.addLoading($(this)),$.act(ACT_OP,ACT_VOICEAPP_INFO_REMOVE,e),actForSendMsg(),$.exe(function(e){$.removeLoading(),e||$.reload()})})}function freshTable(){if(freshFlag){var r=new Array;if(voipAccounts=$.act(ACT_GL,XTP_MULTI_ISP,null,null,["multiProfileName","multiAccountInRoute","multiExtension","multiIndexing"]),voipLineList=$.act(ACT_GL,VOICE_PROF_LINE,null,null,["Enable","X_TP_PhoneName","X_TP_InternalNumber","X_TP_PhoneType","Status"]),0!=$.exe())return;$("#table-teldev").find("tbody tr:not(.nd)").remove();for(var u=0,e=0;e<voipAccounts.length;e++)voipAccounts[e].multiExtension&&""!=voipAccounts[e].multiExtension&&u++;var s=0,_=0;return $.each(voipLineList,function(){if("Enabled"==this.enable){if("DECT"==this.X_TP_PhoneType){if(dectInfo=$.act(ACT_GET,XTP_DECT_HANDSET_INFO,this.__stack,null,["Status"]),0!=$.exe())return;if(0==dectInfo.status)return void s++}if("VoiceApp"==this.X_TP_PhoneType){if(!INCLUDE_VOICEAPP)return;if(voiceappInfo=$.act(ACT_GET,XTP_VOICEAPP_INFO,this.__stack,null,["Status"]),0!=$.exe())return;if(0==voiceappInfo.status)return void s++}if("Phone 1"==this.X_TP_PhoneName)var e=table_str.phone1;else if("Phone 2"==this.X_TP_PhoneName)e=table_str.phone2;else e=this.X_TP_PhoneName;var t,i=getIncomingNum(s);if("--"==i)t=i;else{t=i.slice(0,-2);var n=i.split("/");t="";for(var o=0;o<n.length;o++)o==n.length-1?t+=n[o]:(t+=n[o],t+="<br />")}var a=this.X_TP_InternalNumber,l=$.act(ACT_GET,VOICE_PROF_LINE_CALLFEAT,this.__stack,null,["X_TP_UsbVoiceEnable","X_TP_OutgoingCallprior","X_TP_OutgoingCallpriorAccount","X_TP_OutgoingCallEndWithSharp","X_TP_LineMwiEnable","X_TP_DoNotDisturbStart","X_TP_AnonymousCallBlockStart","X_TP_CallForwardUnconditionalStart","X_TP_CallForwardOnBusyStart","X_TP_CallForwardOnNoAnswerStart","callForwardUnconditionalNumber","callForwardOnBusyNumber","callForwardOnNoAnswerNumber","X_TP_CallWaitingStart","X_TP_AnonymousCallStart","X_TP_WarmLineStart","X_TP_WarmLineTimer","X_TP_WarmLineNumber","X_TP_CallForwardOnNoAnswerThresholdTime","X_TP_CallBarringMode"]);if(0!=$.exe())return;2==l.X_TP_UsbVoiceEnable&&(_=1),0==u?outgoingNum="--":4294967295==l.X_TP_OutgoingCallpriorAccount?outgoingNum=showtype[0]:outgoingNum=voipAccounts[l.X_TP_OutgoingCallpriorAccount-1].multiExtension;var c="["+this.__stack+"]";"FXS"==this.X_TP_PhoneType?(1==voipLineList.length&&(a="--"),r.push([{text:e,width:"20%"},{text:t,width:"20%"},{text:a,width:"20%"},{text:outgoingNum,width:"20%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+s+"' onclick='doEdit(\""+s+'", '+c+");'></span>",width:"20%"}])):"DECT"==this.X_TP_PhoneType?r.push([{text:e,width:"20%"},{text:t,width:"20%"},{text:a,width:"20%"},{text:outgoingNum,width:"20%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+s+"' onclick='doEdit(\""+s+'", '+c+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+s+"' onclick='doDectDel("+c+");'></span>",width:"20%"}]):"VoiceApp"==this.X_TP_PhoneType&&r.push([{text:e,width:"20%"},{text:t,width:"20%"},{text:a,width:"20%"},{text:outgoingNum,width:"20%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+s+"' onclick='doEdit(\""+s+'", '+c+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+s+"' onclick='doVoiceappDel("+c+");'></span>",width:"20%"}])}s++}),_&&r.push([{text:table_str.voicemail,width:"20%"},{text:table_str.na,width:"20%"},{text:"*20",width:"20%"},{text:table_str.na,width:"20%"},{text:table_str.na,width:"20%"}]),$.initTableBody($("#table-teldev"),r),r}}function initTable(){$.auto(freshTable,VOICE_FRESH_TIME,!0)}function doCWSave(){$.addLoading($("#cwSave"));var e={};e.enable=$("#cw_busy").prop("checked")?"1":"0",e.beepEnable=$("#cw_beep").prop("checked")?"1":"0",$.act(ACT_SET,VOICE_PROF_CW,voipCWList[0].__stack,null,e),actForSendMsg(),$.exe(function(e){$.removeLoading()})}function init(){if(voipCWList=$.act(ACT_GL,VOICE_PROF_CW,null,null,null),INCLUDE_DECT&&$("#div_regdect").removeClass("nd"),!$.exe()){var e=voipCWList[0];1==e.enable?$("#cw_busy").prop("checked",!0):$("#cw_busy").prop("checked",!1),1==e.beepEnable?$("#cw_beep").prop("checked",!0):$("#cw_beep").prop("checked",!1)}}function initVolume(e){var t=$.act(ACT_GET,VOICE_PROF_LINE_PROC,e,null,["TransmitGain","ReceiveGain"]);$.exe(),$("#speaker").prop("value",t.transmitGain/2+14),$("#mic").prop("value",t.receiveGain/2+14),initSlider()}function initSlider(){$("[data-slider]").each(function(){var e,o,t,a;return e=$(this),t={},(o=e.data("slider-values"))&&(t.allowedValues=function(){var e,t,i,n;for(n=[],e=0,t=(i=o.split(",")).length;e<t;e++)a=i[e],n.push(parseFloat(a));return n}()),e.data("slider-range")&&(t.range=e.data("slider-range").split(",")),e.data("slider-step")&&(t.step=e.data("slider-step")),t.snap=e.data("slider-snap"),t.equalSteps=e.data("slider-equal-steps"),e.data("slider-theme")&&(t.theme=e.data("slider-theme")),e.attr("data-slider-highlight")&&(t.highlight=e.data("slider-highlight")),null!=e.data("slider-animate")&&(t.animate=e.data("slider-animate")),e.simpleSlider(t)})}$("#cancel").click(function(){for(var e=0;e<curStk.length;e++)curStk[e]=-1;$.reload()}),$("#save").click(function(){$.addLoading($(this)),freshFlag=!1;var e={},t={},i={},n={};if(0==enterCheck())return!1;e.enable="Enabled";var o=n_str.voice_telephony.t_dev;if(e.X_TP_PhoneName=getValue("devName",o,1,15),"auto"==$("#outSel").data("value")?t.X_TP_OutgoingCallpriorAccount=4294967295:t.X_TP_OutgoingCallpriorAccount=parseInt($("#outSel").data("value"),10),t.X_TP_CallBarringMode="2",t.X_TP_CallWaitingStart=1,n.transmitGain=$("#speaker").prop("value"),n.ReceiveGain=$("#mic").prop("value"),i.silenceSuppression=$("#vad").prop("data-checked")?1:0,-1!=curLineIndex)for(var a=0;a<checkId.length;a++){var l=0,c=checkId[a].split("_"),r=parseInt(c[1],10)-1;$("#"+checkId[a]).prop("checked")?(l|=1<<curLineIndex,l|=voipAccounts[r].multiAccountInRoute):(l=voipAccounts[r].multiAccountInRoute,l&=~(1<<curLineIndex)),$.act(ACT_SET,XTP_MULTI_ISP,voipAccounts[r].__stack,null,["multiAccountInRoute="+l])}$.act(ACT_SET,VOICE_PROF_LINE,curStk,null,e),$.act(ACT_SET,VOICE_PROF_LINE_CALLFEAT,curStk,null,t),$.act(ACT_SET,VOICE_PROF_LINE_PROC,curStk,null,n),$.act(ACT_SET,VOICE_PROF_LINE_CODEC_LIST,voipLineCodecObj[0].__stack,null,i),actForSendMsg(),$.exe(function(e){$.removeLoading(),freshFlag=!0,e||$.reload()})}),$("#refresh").click(function(){$.reload()})</script>
<h3 class="T" id="t_et">Telephony Devices</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="table-op">
            <div class="table-btn">
                <span id="refresh" class="refresh-icon"></span>
                <label class="T_refresh">Refresh</label>
            </div>
        </div>
        <table id="table-teldev">
            <thead></thead>
            <tbody>
                <tr id="edit-container-teldev" class="nd">
                    <td colspan="5">
                        <div>
                            <b class="xxxl T" id="t_dev">Device name: </b>
                            <input type="text" id="devName">
                        </div>
                        <b class="xxxl T" id="t_info1">Default telephone number for outgoing call: </b>
                        <select id="outSel">
                        </select>
                        <p class="T" id="t_info2">Incoming call numbers:</p>
                        <div id="incall"></div>
                        <div>
                            <b class="xxl T" id="t_vadsup">VAD Support:</b>
                            <input type="checkbox" id="vad">
                            <label class="T" id="t_vaden">Enable VAD</label>
                        </div>
                        <div id="volume">
                            <div class="pure-control-group">
                                <label class="label-title xxl T" id="t_speakgain">Speaker Gain:</label>
                                <input type="text" data-slider="true" data-slider-range="0,20" data-slider-step="1" data-slider-highlight="true" value="" id="speaker">
                            </div>
                            <div class="pure-control-group">
                                <label class="label-title xxl T" id="t_micgain">Mic Gain:</label>
                                <input type="text" data-slider="true" data-slider-range="0,20" data-slider-step="1" data-slider-highlight="true" value="" id="mic">
                            </div>
                        </div>
                        <div class="inline-btn-right">
                            <button type="submit" class="green T_cancel" id="cancel">Cancel</button>
                            <button type="submit" class="green T_save" id="save">Save</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</div>
<div class="content-container nd" id="div_regdect">
    <div class="modemSettings inline"></div>
    <a class="inline T_regdect" style="color:#ffcb00;border-bottom:#ffcb00 solid 1px;cursor:pointer;vertical-align:baseline" onclick='return $.loadMain("voice_adddect.htm"),!1'>Register New DECT Handset</a>
</div>
	<h3 class="T" id="t_cw_choose">Call Waiting Settings</h3>
	<div>
		<div class="content-container">
		<form class="pure-form pure-form-aligned">
			<div>
				<input type="checkbox" name="cw_beep" id="cw_beep">
				<label id="t_cw_on">Prompt me of the third party call (send me a prompt tone)</label>
			</div>
			<div>
				<input type="checkbox" name="cw_busy" id="cw_busy">
				<label id="t_cw_off">Reject the third party call (send the third party a busy tone)</label>
			</div>
			<button type="submit" class="green T_save" value="Save" id="cwSave" onclick="doCWSave()">Save</button>
		</form>
	</div>
</div>
<script>var headArray=[{text:table_str.phonename,width:"20%"},{text:table_str.innum,width:"20%"},{text:table_str.internum,width:"20%"},{text:table_str.outnum,width:"20%"},{text:table_str.modify,width:"20%"}];$.tpInit(init),$.initTableHead($("#table-teldev"),headArray),$("#table-teldev").tpTable(initTable),$("[data-slider]").bind("slider:ready slider:changed",function(t,e){$(this).prop("value",2*(e.value-14))})</script>
