<style>#chart-info{line-height:28px;text-align:right}#chart-info label{display:inline-block;width:15px;height:15px;margin:0 5px}#down label{background-color:#4acbd6}#up label{background-color:#ffcb00}</style>
<script>function changeX(t){var i=t;return i=1073741824<=t?(i/1073741824).toFixed(1)+"G":1048576<=t?(i/1048576).toFixed(1)+"M":1024<=t?(i/1024).toFixed(1)+"K":i.toFixed(1)}function changeY(t){var i=parseInt(t);return i=1e9<=t?(i/1e9).toFixed(1)+"G":1e6<=t?(i/1e6).toFixed(1)+"M":1e3<=t?(i/1e3).toFixed(1)+"K":i.toFixed(1)}function initChart(t,i){var e=[],o=[],n=[],a=i.length,r=[31,28,31,30,31,30,31,31,30,31,30,31],l=$.act(ACT_GET,HOUR,null,null,["year","month","day","hours","minutes"]);if(!$.exe()){var s,p,c,h,g,u=parseInt(l.hours,10),d=parseInt(l.minutes,10),b=parseInt(l.year,10),y=parseInt(l.month,10),C=parseInt(l.day,10);(b%400==0||b%400!=0&&b%4==0)&&(r[1]=29);for(var k=0;k<i.length;k++)"Hor"==t?((s=u-a+1+k)<0&&(s+=24),s=s<10?"0"+s:s,e.push(s+":00"),o.push(i[k].ups/3600),n.push(i[k].downs/3600)):"Min"==t?(s=(s=(p=d-a+1+k)<0?(p+=60,0==u?23:u-1):u)<10?"0"+s:s,p=p<10?"0"+p:p,e.push(s+":"+p),o.push(i[k].ups/60),n.push(i[k].downs/60)):((g=C-a+1+k)<=0?1==y?(c=b-1,g+=r[(h=12)-1]):(c=b,g+=r[(h=y-1)-1]):(h=y,c=b),h=h<10?"0"+h:h,g=g<10?"0"+g:g,e.push([h,g,c].join(".")),o.push(i[k].ups/86400),n.push(i[k].downs/86400));var m={labels:e,datasets:[{label:$.tpLang.stat_nstr.t_downstream,fillColor:"rgba(74,203,214,0.2)",strokeColor:"rgba(74,203,214,1)",pointColor:"rgba(74,203,214,1)",pointStrokeColor:"rgba(74,203,214,0.1)",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(74,203,214,1)",data:n},{label:$.tpLang.stat_nstr.t_upstream,fillColor:"rgba(255,203,0,0.2)",strokeColor:"rgba(255,203,0,1)",pointColor:"rgba(255,203,0,1)",pointStrokeColor:"rgba(255,203,0,0.1)",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(255,203,0,1)",data:o}]},f=document.getElementById("canvas").getContext("2d");window.myLine?window.myLine.initialize(m):window.myLine=new Chart(f).Line(m,{responsive:!0,animation:!1,scaleLabel:"<%=changeY(value)%>B",scaleLineColor:"#cccccc",scaleGridLineColor:"#cccccc",pointDotRadius:5,pointDotStrokeWidth:2,bezierCurveTension:.4,multiTooltipTemplate:"<%= changeX(value)%>B/s",tooltipFillColor:"rgba(54,68,75,0.9)",legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span class="legend-icon" style="background-color:<%=datasets[i].strokeColor%>"></span><p><%if(datasets[i].label){%><%=datasets[i].label%><%}%></p></li><%}%></ul>'})}}</script>
<h3 id="t_trafficMonitor">Traffic Monitor</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="button-group-container">
            <b id="t_trafficMonitorEn">Traffic Monitor:</b>
            <ul>
                <li>
                    <button id="t_on" class="fst" value="on">On</button>
                </li>
                <li>
                    <button id="t_off" class="lst" value="off">Off</button>
                </li>
            </ul>
            <div style="display:inline-block;vertical-align:middle">
                <div style="display:table;margin-left:9px">
                    <div id="enable-stat-tips" style="display:table-cell;width:240px;color:#b2b2b2;height:30px;line-height:15px">
                    </div>
                </div>
            </div>
        </div>
        <div>
            <p id="t_switchNote" class="nd"></p>
        </div>
    </form>
</div>
<div class="content-container" id="traffic-chart">
    <form class="pure-form pure-form-aligned">
        <div>
            <span id="usage-contianer" style="display:inline-block;width:250px">
                <label id="t_devUsage" class="xl">The Traffic Usage of1</label>
                <span id="deviceName"></span>
            </span>
            <select id="device" class="inline"></select>
            <select id="interval" class="inline">
                <option value="Day" id="t_daily"></option>
                <option value="Hor" id="t_hourly"></option>
                <option value="Min" id="t_Minutely"></option>
            </select>
        </div>
        <div id="chart">
            <div id="canvas-container">
            </div>
        </div>
        <div id="chart-info">
            <span id="down">
                <label></label>
                <span id="t_downstream"></span>
            </span>
            <span id="up">
                <label></label>
                <span id="t_upstream"></span>
            </span>
        </div>
    </form>
</div>
<h3 id="t_monitorList">Traffic Statistics List</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span id="freshAll" class="refresh-icon"></span>
                <label class="T_refresh">Refresh</label>
                <span id="resetAll" class="reset-icon"></span>
                <label class="T_reset">Reset</label>
            </div>
        </div>
        <table id="traffic-stat">
            <thead></thead>
            <tbody></tbody>
        </table>
    </form>
</div>
<script>var trafficIntervalId,listIntervalId,canvas=document.createElement("canvas");function init(){var e=$.act(ACT_GET,STAT_CFG,null,null),n=$.act(ACT_GET,RECORD_CFG,null,null),t=$.act(ACT_GL,STAT_ENTRY,null,null),l=$.act(ACT_GET,ALG_CFG,null,null);if(!$.exe()){if(Number(l.hw_nat_enable)&&$("#enable-stat-tips").html($.tpLang.stat_nstr.t_enableTips),1==e.enable){$("#t_on").addClass("selected"),$("#t_off").removeClass("selected");var a='<option value="1" id="t_allDev">'+$.tpLang.stat_nstr.t_allDev+"</option>";$("#device").append(a);for(var i=0;i<t.length;i++){var r=$("<option></option>");r.val(t[i].hostName),r.text($.htmlEncodeStr(t[i].hostName)),$("#device").append(r)}1!=n.allDevices&&$("#interval").html('<option value="Min" id="t_Minutely">'+$.tpLang.stat_nstr.t_Minutely+"</option>"),$("#device").attr("value","1"==n.allDevices?n.allDevices:n.hostName),1==$("#device").val()?$("#deviceName").html($.tpLang.stat_nstr.t_allDev+":"):$("#deviceName").html($.htmlEncodeStr($("#device").val())+":"),$("#interval").attr("value",n.recordInterval),$("#traffic-chart").removeClass("nd");var c=$.act(ACT_GL,RECORD_ENTRY,null,null),o=$.act(ACT_GET,RECORD_CFG,null,null);if(!$.exe()){if(o.allDevices!=n.allDevices)return void $.reload();initChart(n.recordInterval,c)}}else $("#t_switchNote").removeClass("nd"),$("#t_on").removeClass("selected"),$("#t_off").addClass("selected"),$("#traffic-chart").addClass("nd");initMonitorList(t),1==e.enable&&"Min"==n.recordInterval&&(trafficIntervalId=setTimeout(function t(){if("stat.htm"===$.curPage)if(rebooting&&trafficIntervalId)clearTimeout(trafficIntervalId);else{var l=$.act(ACT_GL,RECORD_ENTRY,null,null),a=$.act(ACT_GET,RECORD_CFG,null,null);$.exe(function(e){if(!e){if(a.allDevices!=n.allDevices)return void $.reload();try{initChart(n.recordInterval,l)}catch(e){return}trafficIntervalId=setTimeout(t,1e4)}})}},1e4))}}function changeUnit(e){return 1073741824<=e?(e/1073741824).toFixed(3)+"G":1048576<=e?(e/1048576).toFixed(3)+"M":1024<=e?(e/1024).toFixed(3)+"K":e}function initMonitorList(e){for(var t=[],l=0;l<e.length;l++)t.push([{text:"wired"==e[l].hostType?table_str.wired:"2.4g"==e[l].hostType?table_str.type24g:"5g"==e[l].hostType?table_str.type5g:m_str.disconnected,width:"20%"},{text:$.htmlEncodeStr(e[l].hostName),width:"20%"},{text:e[l].macAddress.split(":").join("-"),width:"20%"},{text:"<span>"+changeUnit(e[l].currBytesTx)+"B/s↑</br>"+changeUnit(e[l].currBytesRx)+"B/s↓</span>",width:"20%"},{text:changeUnit(parseInt(e[l].totalBytesRx)+parseInt(e[l].totalBytesTx)),width:"20%"}]);$.initTableBody($("#traffic-stat"),t)}canvas.id="canvas",document.getElementById("canvas-container").appendChild(canvas),canvas.getContext||G_vmlCanvasManager.initElement(canvas),window.myLine=null,clearTimeout(trafficIntervalId),clearTimeout(listIntervalId);var headArray=[{text:table_str.conntype,width:"20%"},{text:table_str.devName,width:"20%"},{text:table_str.mac,width:"20%"},{text:table_str.realRate,width:"20%"},{text:table_str.usage,width:"20%"}];function refreshList(){if("stat.htm"===$.curPage)if(rebooting&&listIntervalId)clearTimeout(listIntervalId);else{var t=$.act(ACT_GL,STAT_ENTRY,null,null);$.exe(function(e){e||initMonitorList(t)}),listIntervalId=setTimeout(refreshList,1e4)}}$.initTableHead($("#traffic-stat"),headArray),$("#traffic-stat").tpTable(),$.tpInit(init),$("#t_on").click(function(){var e=$.act(ACT_GET,ALG_CFG,null,null);$.exe(),1==Number(e.hw_nat_enable)?$.confirm(c_str.tm_hwnat_conflict,function(){e.hw_nat_enable="0",$.act(ACT_SET,ALG_CFG,null,null,e),$.exe(function(e){e||($.removeLoading(),$.reload())}),$.act(ACT_SET,STAT_CFG,null,null,["Enable=1"]),$.exe()||$.reload()},function(){$.reload()}):($.act(ACT_SET,STAT_CFG,null,null,["Enable=1"]),$.exe()||$.reload())}),$("#t_off").click(function(){var e=$.act(ACT_GET,DDOS_CFG,null,null);$.exe()||(1==e.enable?$.confirm(c_str.tm_dos_coexist,function(){e.enable=0,$.act(ACT_SET,DDOS_CFG,null,null,e),$.act(ACT_SET,STAT_CFG,null,null,["Enable=0"]),$.exe()||$.reload()},function(){$.reload()}):($.act(ACT_SET,STAT_CFG,null,null,["Enable=0"]),$.exe()||$.reload()))}),$("#device").click(function(e){if(1==$("#device").data("value"))$.act(ACT_SET,RECORD_CFG,null,null,["allDevices=1","recordInterval="+$("#interval").data("value")]);else $.act(ACT_SET,RECORD_CFG,null,null,["allDevices=0","hostName="+$("#device").data("value"),"recordInterval=Min"]);$.exe()||$.reload()}),$("#interval").click(function(e){if(1==$("#device").data("value"))$.act(ACT_SET,RECORD_CFG,null,null,["allDevices=1","recordInterval="+$("#interval").data("value")]);else $.act(ACT_SET,RECORD_CFG,null,null,["allDevices=0","hostName="+$("#device").data("value"),"recordInterval=Min"]);$.exe()||$.reload()}),$("#freshAll").click(function(e){var t=$.act(ACT_GL,STAT_ENTRY,null,null);$.exe()||initMonitorList(t)}),$("#resetAll").click(function(){$.act(ACT_SET,STAT_CFG,null,null,["action=1"]),$.exe(function(e){e||$.reload()})}),listIntervalId=setTimeout(refreshList,1e4)</script>
