!function($){"use strict";function clearEventBubble(evt){evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0,evt.preventDefault?evt.preventDefault():evt.returnValue=!1}$.fn.tpGridSelect=function(options){var defaultOptions={colHeads:[s_str.sun,s_str.mon,s_str.tues,s_str.wed,s_str.thur,s_str.fri,s_str.sat],rowHeads:["0:00","1:00","2:00","3:00","4:00","5:00","6:00","7:00","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24:00"],cellsInTd:1,tableRowHeadWidth:40,tableBodyWidth:600,borderColor:"#e5e6e6",textInExample:n_str.parentCtrl.t_time,selectedColor:"sel"};options=options?$.extend(defaultOptions,options):defaultOptions,$(this).css({position:"relative"});var sel=defaultOptions.selectedColor,gridContainer=this,tableRowHead=$("<table>",{cellpadding:"0",cellspacing:"0"});tableRowHead.css({float:"left",width:options.tableRowHeadWidth,padding:"1px 0 0 1px","border-collapse":"collapse","margin-top:":"1em"}),tableRowHead.addClass("sche");for(var tmpHtml="",i=0,l=options.rowHeads.length;i<l;i++)tmpHtml+="<tr><th>"+options.rowHeads[i]+"</th></tr>";tableRowHead.append(tmpHtml),$(this).append(tableRowHead);var tableBody=$("<table>",{cellspacing:0,cellpadding:0});tableBody.css({float:"left",padding:"1px 0 0 1px","border-collapse":"collapse",width:options.tableBodyWidth,"table-layout":"fixed"}),tableBody.addClass("cale"),$(this).append(tableBody),tmpHtml="",tmpHtml+="<tr>";for(i=0,l=options.colHeads.length;i<l;i++)tmpHtml+='<th id="col-head'+i+'">'+options.colHeads[i]+"</th>";tmpHtml+="</tr>",tableBody.append(tmpHtml);for(i=0,l=options.rowHeads.length-1;i<l;i++){tableBody.append("<tr></tr>");for(var j=0,m=options.colHeads.length;j<m;j++){var tdTmp=$("<td>");tableBody.find("tr:eq("+(i+1)+")").append(tdTmp);for(var k=0;k<options.cellsInTd;k++){var spanTmp=$("<span>");spanTmp.attr("id",i*m+j),tdTmp.append(spanTmp),spanTmp.data("selected",!1)}}}$(tableBody).find("th,td").css("border","1px solid"+options.borderColor),$(gridContainer).find("td span").css({width:tableBody.width()/options.colHeads.length-3,padding:0}),$(tableRowHead).find("tr").css({height:$(tableBody.find("tr:eq(1)")).height()+"px"}),$(tableRowHead).css({"margin-top":$(tableBody.find("tr:eq(0)")[0]).height()-$(tableRowHead.find("tr")[0]).height()/2+2+"px"}),$(gridContainer).css("overflow","hidden"),$(gridContainer).after('<span class="timeExam"></span><label class="timeText">'+options.textInExample+"</label>");var timeExam=$(this).next(".timeExam");timeExam.css({float:"left",height:"20px",width:"20px",margin:"3px","margin-left":$(tableRowHead).width()}),"sel"==sel?timeExam.css({backgroundColor:"#4acbd6"}):timeExam.addClass(sel),$(".timeText").css({position:"relative","line-height":"26px"});var chooseSpan=function(evt){clearEventBubble(evt),$(this).hasClass(sel)?($(this).removeClass(sel),$(this).data("selected",!1)):($(this).addClass(sel),$(this).data("selected",!0))};$(gridContainer).find("table.cale span").css("cursor","not-allowed").parent().css("cursor","not-allowed");var colHeadsEnable=!1;return{startGridSelect:function(){$(gridContainer).find("table.cale span").css("cursor","pointer").parent().css("cursor","pointer"),$(gridContainer).find("table.cale span").each(function(){$(this).on("click.grid",chooseSpan)});var eventBind=!1;$(gridContainer).on("mouseenter.grid",function(){!0!==eventBind&&(eventBind=!0,$(gridContainer).on("mousedown.grid",function(){var startX,startY,isSelect=!0,evt=window.event||arguments[0];startY=window.ActiveXObject||"ActiveXObject"in window?(startX=evt.clientX-$(gridContainer).offset().left,evt.clientY-$(gridContainer).offset().top):(startX=(evt.x||evt.clientX)-$(gridContainer).offset().left,(evt.y||evt.clientY)-$(gridContainer).offset().top);for(var startSpan=null,spanGroup=$(gridContainer).find("table.cale span"),i=0;i<spanGroup.length;i++){var span=$(spanGroup[i]),spanStartX=span.position().left,spanStartY=span.position().top,spanEndX=spanStartX+span.width(),spanEndY=spanStartY+span.height();if(spanStartX<startX&&spanStartY<startY&&startX<spanEndX&&startY<spanEndY){startSpan=span;break}}var selectMode=!startSpan||!startSpan.data("selected"),selDiv=$("<div></div>");selDiv.css({position:"absolute",width:"0px",height:"0px","font-size":"0px",margin:"0px",padding:"0px",border:"1px dashed #0099FF","background-color":"#C3D5ED","z-index":"1000",filter:"alpha(opacity:60)",opacity:"0.6",display:"none"}),$(gridContainer).append(selDiv),selDiv.css({left:startX+"px",top:startY+"px"});var _x=null,_y=null;clearEventBubble(evt);var spansTmp=$(gridContainer).find("table.cale span");$("html").on("mousemove.grid",function(){var evt=window.event||arguments[0];if(isSelect){selDiv.show(),_y=window.ActiveXObject||"ActiveXObject"in window?(_x=evt.clientX-$(gridContainer).offset().left,evt.clientY-$(gridContainer).offset().top):(_x=(evt.x||evt.clientX)-$(gridContainer).offset().left,(evt.y||evt.clientY)-$(gridContainer).offset().top),selDiv.css({left:Math.min(_x,startX)+"px",top:Math.min(_y,startY)+"px",width:Math.abs(_x-startX)+"px",height:Math.abs(_y-startY)+"px"});var _l=selDiv.offset().left,_t=selDiv.offset().top,_w=selDiv.width(),_h=selDiv.height();spansTmp.each(function(){var span,sl=$(this).width()+$(this).offset().left,st=$(this).height()+$(this).offset().top;_l<sl&&_t<st&&$(this).offset().left<_l+_w&&$(this).offset().top<_t+_h?(span=$(this),!0===selectMode?span.addClass(sel):span.hasClass(sel)&&span.removeClass(sel)):function(span){!0===span.data("selected")?span.hasClass(sel)||span.addClass(sel):!1===span.data("selected")&&span.hasClass(sel)&&span.removeClass(sel)}($(this))})}clearEventBubble(evt)}),$("html").on("mouseup.grid",function(){$(gridContainer).off("mousedown.grid"),$("html").off("mousemove.grid"),$("html").off("mouseup.grid"),eventBind=!1,$(gridContainer).trigger("mouseover"),isSelect=!1,selDiv&&selDiv.remove(),$(gridContainer).find("table.cale span").each(function(){$(this).hasClass(sel)?$(this).data("selected",!0):$(this).data("selected",!1)}),evt=startY=startX=selDiv=_y=_x=null})}))}).mouseleave(function(){})},stopGridSelect:function(){$(gridContainer).find("table.cale span").css("cursor","not-allowed").parent().css("cursor","not-allowed"),$(gridContainer).find("table.cale span").off("click.grid"),$(gridContainer).off(".grid"),$("html").off(".grid")},initGridSelectVal:function(array){if(null!=array&&null!=array&&array.length==options.colHeads.length)for(var spanGroup=$(gridContainer).find("table.cale td span"),i=0;i<spanGroup.length;i++){var row=i%options.colHeads.length,col=Math.floor(i/options.colHeads.length);1==array[row].charAt(col)?$(spanGroup[i]).addClass(sel).data("selected",!0):$(spanGroup[i]).removeClass(sel).data("selected",!1)}},getGridSelectVal:function(){for(var result=[],i=0;i<options.colHeads.length;i++)result[i]="";var spanGroup=$(gridContainer).find("table.cale td span");for(i=0;i<spanGroup.length;i++){var row=i%options.colHeads.length;$(spanGroup[i]).hasClass(sel)?result[row]+="1":result[row]+="0"}return result},setColHeadEnable:function(mode){if(void 0!==mode){var thGroup=$(gridContainer).find("table.cale tr:eq(0) th");thGroup.addClass(sel),1==mode?(colHeadsEnable=!0,thGroup.addClass(sel),thGroup.each(function(){$(this).on("click.grid",function(){$(this).hasClass(sel)?$(this).removeClass(sel):$(this).addClass(sel)})})):(colHeadsEnable=!1,thGroup.removeClass(sel),thGroup.each(function(){$(this).off(".grid")}))}},addValueWithStartEnd:function(start,end){if(!(end<start)){var spanTmp=$(gridContainer).find("table.cale tr td span"),addInCol=function(colIndex,start,end){for(var i=start;i<end;i++)$(spanTmp[i*options.colHeads.length+colIndex]).addClass(sel),$(spanTmp[i*options.colHeads.length+colIndex]).data("selected",!0)},clearInCol=function(colIndex){for(var i=0;i<options.rowHeads.length-1;i++)$(spanTmp[i*options.colHeads.length+colIndex]).removeClass(sel),$(spanTmp[i*options.colHeads.length+colIndex]).data("selected",!1)};if(!0===colHeadsEnable)for(var thTmp=$(gridContainer).find("table.cale tr:eq(0) th"),i=0;i<thTmp.length;i++)$(thTmp[i]).hasClass(sel)?addInCol(i,start,end):clearInCol(i);else for(i=0;i<options.colHeads.length;i++)addInCol(i,start,end)}},resetGridValue:function(){$(gridContainer).find("table.cale tr td span").each(function(){$(this).data("selected",!1),$(this).removeClass(sel)})}}}}(jQuery);