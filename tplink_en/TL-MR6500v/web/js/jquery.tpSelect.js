!function($){"use strict";$.fn.tpSelect=function(options){return options=$.extend({render:function(option){return $("<li data-val='"+option.val()+"' class='option-item'>"+option.text()+"</li>")},className:"",refresh:0,search:!1},options),this.each(function(){var tpselect=$(this).data("tpSelect"),keyboardControlFlag=!1,namespace=options.namespace||"tpSelect";if(namespace="."+namespace,tpselect){if(!tpselect||1!=options.refresh)return;$("#_"+this.id).remove()}else $(this).data("tpSelect",this.id);var select=$(this),bTmp=select.prev("b").hide(),title=bTmp.html(),bClass=bTmp.prop("class");if(title)var str='<label class="select-title"  '+($(bTmp).attr("id")?'id="'+$(bTmp).attr("id")+'"':"")+">"+title+'</label>&nbsp;<div class="tp-select"><div class="select-box"></div><div class="select-icon-container"><span class="select-icon"></span></div></div>';else str='<div class="tp-select"><div class="select-box"></div><div class="select-icon-container"><span class="select-icon"></span></div></div>';var selectBoxContainer=$("<div>",{html:str});$.isIE&&selectBoxContainer.find(".tp-select").append('<span class="corner-top-left"></span><span class="corner-top-right"></span><span class="corner-bot-left"></span><span class="corner-bot-right"></span>'),selectBoxContainer.addClass("select-container"),selectBoxContainer.prop("id","_"+this.id),selectBoxContainer.addClass(select.prop("class")),selectBoxContainer.find("label.select-title").addClass(bClass),select.prop("disabled")&&selectBoxContainer.addClass("disabled");var dropDown=$("<ul>",{});dropDown.addClass("drop-down");var selectBox=selectBoxContainer.find(".select-box"),iconContainer=selectBoxContainer.find(".select-icon-container");options.className&&dropDown.addClass(options.className);var majorBorder,hasMajorFlag=!1;function banBackSpace(e){var ev=e||window.event,obj=ev.target||ev.srcElement,t=obj.type||obj.getAttribute("type"),vReadOnly=obj.getAttribute("readonly"),vEnable=obj.getAttribute("enabled");vReadOnly=void 0!==vReadOnly&&vReadOnly,vEnable=void 0===vEnable||vEnable;var flag1=!(8!=ev.keyCode||"password"!=t&&"text"!=t&&"textarea"!=t||1!=vReadOnly&&1!=vEnable);if(8==ev.keyCode&&"password"!=t&&"text"!=t||"textarea"!=t||flag1)return!1}select.find("option").each(function(i){var option=$(this),li=options.render(option);if(li.click(function(){if(selectBox.html(option.text()),dropDown.trigger("hide"),li.siblings("li").removeClass("selected"),li.addClass("selected"),select.data("value")!==option.val())return select.data("value",option.val()),select.data("text",option.text()),defaultSelectItem=$(this),select.click(),!1}).mouseenter(function(){keyboardControlFlag?keyboardControlFlag=!1:(dropDown.children(".hover").removeClass("hover"),$(this).addClass("hover"))}).mouseleave(function(){$(this).removeClass("hover")}),i==select.prop("selectedIndex")&&(selectBox.html(option.text()),li.click()),option.data("skip"))return!0;option.data("major")?(!1===hasMajorFlag&&(hasMajorFlag=!0,majorBorder=$('<li class="major-item-border">').prependTo(dropDown)),li.insertBefore(majorBorder)):dropDown.append(li)}),selectBoxContainer.find(".tp-select").append(dropDown.hide()),select.hide().after(selectBoxContainer);var searchBar,selectItem,selectStr="",defaultSelectItem=dropDown.children(".selected");function smartSelect(event){if($(document).on("keypress"+namespace,banBackSpace).on("keydown"+namespace,banBackSpace),$(window).on("keypress"+namespace,banBackSpace).on("keydown"+namespace,banBackSpace),void 0===event)selectStr="",searchBar.text(selectStr);else if("back"!=$.code2key(event)||options.search){if("enter"==$.code2key(event))return selectItem=0<dropDown.children(".hover").length?dropDown.children(".hover"):defaultSelectItem,selectBox.html(selectItem.text()),defaultSelectItem=selectItem,select.data("value",selectItem.attr("data-val")),select.data("text",selectItem.text()),select.click(),void dropDown.trigger("hide");if(38===event.keyCode||40===event.keyCode){keyboardControlFlag=!0;var newOne,oldOne=0<dropDown.children("li.hover").length?dropDown.children("li.hover"):dropDown.children("li.selected");0<oldOne.length&&!oldOne.hasClass("nd")&&oldOne.position().top<dropDown.height()?(38===event.keyCode?newOne=oldOne.prevAll(".option-item:not(.nd):first"):40===event.keyCode&&(newOne=oldOne.nextAll(".option-item:not(.nd):first")),0<newOne.length&&(dropDown.children(".hover").removeClass("hover"),newOne.addClass("hover"),newOne.position().top<0?dropDown.get(0).scrollTop=newOne.position().top-dropDown.children(":first").position().top:newOne.position().top>dropDown.height()-newOne.height()&&(dropDown.get(0).scrollTop=newOne.position().top-dropDown.children(":first").position().top-dropDown.height()+newOne.height()))):(oldOne.removeClass("hover"),dropDown.children(".option-item:not(.nd):eq(1)").addClass("hover"))}else options.search||(selectStr+=$.code2key(event),searchBar.text(selectStr)),dropDown.get(0).scrollTop=0}else selectStr=selectStr.substr(0,selectStr.length-1),searchBar.text(selectStr);options.search||filter(selectStr)}function filter(str){for(var drop_children=dropDown.children(".option-item"),drop_children_show=[],i=0;i<drop_children.length;i++){var patternStr=str.replace(/([^\w])/g,"\\$1");new RegExp(patternStr,"g").test(drop_children.eq(i).text().toUpperCase())?(drop_children.eq(i).removeClass("nd"),drop_children_show.push(drop_children.eq(i))):drop_children.eq(i).addClass("nd")}}!0===options.search?searchBar=function(){var tmpLi=$('<li class="tpSelect-search-li"><div class="tpSelect-search-ctn"><span class="icon-search"></span><input type="text" class="tp-input-text tpSelect-search-input"></div></li> ');dropDown.children().eq(0).before(tmpLi);var input=tmpLi.find("input");return tmpLi.click(function(){return input.focus(),!1}),input.on("keyup",function(event){38!==event.keyCode&&40!==event.keyCode&&"enter"!=$.code2key(event)?(filter(input.val().toUpperCase()),event.stopPropagation()):event.preventDefault()}),input.on("keypress keydown",function(event){event.stopPropagation()}),{text:function(val){input.val(val)},focus:function(){input.focus()}}}():((searchBar=$("<li>",{html:""})).css({cursor:"default","border-bottom":"1px solid #ccc"}),dropDown.children().eq(0).before(searchBar),searchBar.mouseenter(function(){$(this).css({background:"#fff",color:"#4d4d4d"})}),searchBar.click(function(e){return e.preventDefault(),!1})),dropDown.on("show",function(){if(dropDown.is(":animated"))return!1;selectBox.parent().addClass("expanded");var maxHeight=$("#bot").offset().top-$(selectBox).offset().top-$(selectBox).height();maxHeight=maxHeight<240?maxHeight:240,dropDown.css("maxHeight",maxHeight),dropDown.slideDown("fast",function(){dropDown.get(0).scrollTop=tmp.position().top-dropDown.children(":first").position().top-dropDown.height()/2,options.search&&searchBar.focus()});var rows=dropDown.children("li");rows.each(function(){40<$(this).height()&&$(this).css("line-height","20px")}),dropDown.children().removeClass("selected");var tmp=dropDown.children('[data-val="'+select.data("value")+'"]').addClass("selected");0===tmp.length&&(tmp=rows.eq(1)),$(document).on("keyup.tpSelect",smartSelect)}).on("hide",function(){if(dropDown.is(":animated"))return!1;selectBox.parent().removeClass("expanded"),dropDown.slideUp("fast"),$(document).off("keyup.tpSelect",smartSelect),searchBar.text(""),filter(selectStr=""),$(document).off("keypress"+namespace,banBackSpace).off("keydown"+namespace,banBackSpace),$(window).off("keypress"+namespace,banBackSpace).off("keydown"+namespace,banBackSpace)}).on("toggle",function(){selectBox.parent().hasClass("expanded")?dropDown.trigger("hide"):dropDown.trigger("show")}),selectBox.click(function(){if(select.prop("disabled"))return!1;dropDown.trigger("toggle")}),iconContainer.click(function(){if(select.prop("disabled"))return!1;dropDown.trigger("toggle")}),$(document).on("click"+namespace,function(){dropDown.trigger("hide")})})}}(jQuery);