!function($){function tpInput(id,options){this.element=$("#"+id),this.options=$.extend({},tpInput.prototype.options,options),this._create(options),$.isFunction(this._init)&&this.init()}tpInput.prototype={constructor:tpInput,options:{placeholder:null,isPassword:null,disableChange:!0,visible:!1,classFocus:"focus",classVisible:"visible",classInvisible:"invisible",textLabel:null,textLabelClass:"",textLabelConnector:":",parentClass:"pure-control-group",borderRadius:!0,readOnly:!1,vtype:null,vtypeText:null,allowBlank:!0,blankText:null,validator:null,invalidText:null,bubbleError:!1,suffix:null,underHint:null,clickHideError:!1},_create:function(){if(this.id=this.element.attr("id"),this.element.addClass("tpInput"),this.options.readOnly=this.options.readOnly||this.element.prop("readOnly"),this.options.readOnly&&this.element.prop("readOnly",!0),this.options.textLabel||""==this.options.textLabel||0<this.element.prev("b").length){var tmpB=this.element.prev("b"),id=this.element.id+"-textLabel";0<tmpB.length&&(this.options.textLabel=this.options.textLabel||tmpB.text(),this.options.textLabelClass+=" "+tmpB.attr("class"),id=tmpB.attr("id")||id,this.element.prev("b").remove()),this.textLabel=$('<label class="label-title">'+this.options.textLabel+"</label>").addClass(this.options.textLabelClass).attr("id",id).insertBefore(this.element).after(" ")}null!==this.options.parentClass&&this.element.parent("div").addClass(this.options.parentClass),0==this.element.parent(".input-container").length&&this.element.wrap('<div class="input-container"></div>'),this.container=this.element.parent(".input-container"),this.element.wrap('<div class="input-wrapper"></div>'),this.wrapper=this.element.parent(".input-wrapper"),this.options.placeholder=this.options.placeholder||this.element.attr("placeholder"),this.options.placeholder&&(this.hint=$('<label class="input-placeholder" for="'+this.id+'"></label>').appendTo(this.container).css({left:this.element.css("paddingLeft"),height:this.element.css("height"),lineHeight:this.element.css("height")}).show(),this._setOption("placeholder",this.options.placeholder)),this.options.isPassword=null!==this.options.isPassword?this.options.isPassword:this.element.is(":password"),this.options.isPassword&&(this.container.addClass("tpPassword"),this.vInput=$('<input type="text">').appendTo(this.wrapper).attr("maxlength",this.element.attr("maxlength")).attr("oninput",this.element.attr("oninput")).attr("id",this.id+"_v").prop("disabled",this.element.prop("disabled")).addClass(this.element.attr("class")).hide(),this.visible=this.options.visible||"true"==this.element.attr("data-visible"),this._setOption("visible",this.visible),this.eyeIcon=$('<span class="icon-eye"></span>').appendTo(this.wrapper)),!0===this.options.bubbleError?this.error=$('<div class="input-err-container"> <div class="shadow-top-left"></div><div class="shadow-top"></div><div class="shadow-top-right"></div><div class="shadow-left"><div class="shadow-right"><span class="input-err-delta"></span><div class="input-err-content"><span class="text"></span></div></div></div><div class="shadow-bot-left"></div><div class="shadow-bot"></div><div class="shadow-bot-right"></div></div>').appendTo(this.container):this.error=$('<div class="input-err-container"><span class="widget-err icon-err"></span><span class="text"></span></div>').appendTo(this.container),this.options.underHint&&(this.underHint=$('<div class="input-under-hint-container"><span class="text"></span></div>').appendTo(this.container),this.showUnderHint()),!0===this.options.borderRadius&&this.wrapper.append('<span class="corner-left"></span><span class="corner-right"></span>'),this.options.suffix&&(this.suffix=$('<span class="input-suffix">'+this.options.suffix+"</span>").insertAfter(this.container)),this.options.vtype&&this._setOption("vtype",this.options.vtype),this._registerHandler()},_registerHandler:function(){var me=this;this.container.on("blur.tpInput","input[type=password], input[type=text]",function(){me.container.removeClass(me.options.classFocus),(!me.options.isPassword&&""==me.element.val()||me.options.isPassword&&0==me.visible&&""==me.element.val()||me.options.isPassword&&1==me.visible&&""==me.vInput.val())&&me.hint&&me.hint.show(),setTimeout(function(){me.container.hasClass(me.options.classFocus)||me.validate()},100)}),this.container.on("focus.tpInput","input[type=password], input[type=text]",function(){me.container.hasClass("disabled")||me.options.readOnly||(me.container.addClass(me.options.classFocus),me.hint&&me.hint.hide()),me.hideError(!me.container.hasClass("disabled")&&!me.options.readOnly),me.error.hide(),me.element.trigger("ev_focus")}),this.options.isPassword&&($(this.container).on("click.tpPassword",".icon-eye",function(){if(!me.container.hasClass("disabled")||!1!==me.options.disableChange)if(!0===me.visible){me._setOption("visible",!1);try{me.element.val(me.vInput.val()).focus()}catch(e){}}else{me._setOption("visible",!0);try{me.vInput.val(me.element.val()).focus()}catch(e){}me.disabled(me.element.prop("disabled"))}}),$(this.container).on("blur.tpPassword","input[type=password], input[type=text]",function(){!0===me.visible?me.element.val(me.vInput.val()):me.vInput.val(me.element.val())}),$(this.element).on("focus.tpPassword",function(){!0===me.visible&&me.vInput.show().focus()}),$(this.vInput).on("keydown.tpPassword keyup.tpPassword",function(e){e.stopPropagation(),me.element.trigger(e.type)}),$(this.element).on("keydown",function(e){13==e.keyCode&&e.preventDefault()}))},_unregisterHandlers:function(){this.element.off(".tpInput .tpPassword")},_setOption:function(key,value){"placeholder"==key?null!=value&&this.hint.text(value):"value"==key?this.val(value):"disabled"==key?this.disabled(value):"visible"==key?1==value?(this.visible=!0,this.container.addClass(this.options.classVisible).removeClass(this.options.classInvisible),this.vInput.show(),this.element.hide(),this.hint&&this.hint.attr("for",this.vInput.attr("id"))):(this.visible=!1,this.container.addClass(this.options.classInvisible).removeClass(this.options.classVisible),this.vInput.hide(),this.element.show(),this.hint&&this.hint.attr("for",this.element.attr("id"))):"vtype"==key?this.options.vtype=new $.su.vtype(value):"underHint"==key&&(this.options.underHint=value,this.showUnderHint())},showUnderHint:function(text){this.options.underHint&&(text=text||this.options.underHint,$.isFunction(text)&&(text=text()),this.underHint.show().find("span.text").text(text),this.container.parent(".pure-control-group").addClass("hint"))},hideUnderHint:function(){this.options.underHint&&(this.underHint.hide(),0==this.container.parent(".pure-control-group").find(".input-hint-container:visible").length&&this.container.parent(".pure-control-group").removeClass("hint"))},showError:function(text){this.error.show().find("span.text").text(text),this.container.addClass("err"),0==this.options.bubbleError&&this.container.parent(".pure-control-group").addClass("err");var me=this;me.options.clickHideError&&$(window).one("click",function(){me.hideError(!1)}),this.hideUnderHint()},hideError:function(removeBorder){this.error.hide(),!1!==removeBorder&&this.container.removeClass("err"),0==this.options.bubbleError&&0==this.container.parent(".pure-control-group").find(".input-container.err").length&&this.container.parent(".pure-control-group").removeClass("err"),this.showUnderHint()},disabled:function(flag){!0===flag?this.container.addClass("disabled"):this.container.removeClass("disabled"),this.element.prop("disabled",flag),this.options.isPassword&&this.vInput.prop("disabled",flag)},val:function(val){return void 0!==val&&(this.element.val(val),this.options.isPassword&&this.vInput.val(val),this.validate()),this.options.isPassword&&!0===this.visible?this.vInput.val():this.element.val()},focus:function(){this.options.isPassword&&1==this.visible?this.vInput.focus():this.element.focus()},validate:function(isShowed){var errText,me=this,value=this.val();if(""===value){if(!0!==me.options.allowBlank)return errText=this.options.blankText||$.tpLang.VTYPETEXT.BLANKTEXT,!1!==isShowed&&me.showError(errText),errText}else{var vtype=me.options.vtype;if(vtype&&!0===vtype.isVtype&&!0!==(errText=vtype.validate(value)))return!1===errText&&(errText=me.options.vtypeText),!1!==isShowed&&me.showError(errText),errText;if(me.options.validator&&!0!==(errText=me.options.validator(value)))return!1===errText&&(errText=me.options.invalidText||$.tpLang.VTYPETEXT.INVALIDTEXT),!1!==isShowed&&me.showError(errText),errText}return me.hideError(),!0},_destroy:function(){this._unregisterHandlers(),this.error.remove(),this.hint.remove(),this.options.isPassword&&(this.vInput.remove(),this.eyeIcon.remove()),this.element.unwrap().unwrap()}},$.fn.tpInput=function(options){var result,arg=arguments;return this.each(function(){var input=$(this).data("tpInput");if(input||"destroy"==options)"option"==options?result=input._setOption.apply(input,Array.prototype.slice.call(arg,1)):"destroy"==options?(result=input._destroy(),$(this).removeData("tpInput")):$.isFunction(input[options])&&(result=input[options].apply(input,Array.prototype.slice.call(arg,1)));else{var instance=new tpInput(this.id,options);$(this).data("tpInput",instance)}}),result},$.fn.tpPassword=$.fn.tpInput}(jQuery);