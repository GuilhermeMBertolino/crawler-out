!function($){function tpProgress(id,options){this.element=$("#"+id),this.options=$.extend({},tpProgress.prototype.options,options),this._create(options),$.isFunction(this._init)&&this.init()}tpProgress.prototype={constructor:tpProgress,options:{text:"",fieldLabel:"",tips:"",unit:"%",_timeout:0,value:0,url:null,isProgressbar:!0,showPercentage:!0,width:18,height:6,fn:null,widgetName:"progressbar",expression:"percentage*1",ptype:"horizontal",tipsCls:""},_create:function(){var obj=this.options;this.id=this.element.attr("id");var _style="horizontal"===this.options.ptype?"width:"+this.options.width*this.options.value+"px":"height:"+this.options.height*this.options.value+"px",inHtml="";this.element.addClass("progressbar-container"),null!==obj.fieldLabel&&(inHtml+='<div class="fieldlabel-wrap">',inHtml+='<label class="fieldlabel progressbar-fieldlabel">'+this.options.fieldLabel+"</label>",inHtml+="</div>"),inHtml+='<div class="progressbar-wrap-outer">',inHtml+='<div class="progressbar-wrap">',inHtml+='<div class="progressbar-content">',inHtml+='<div class="progressbar-value" style="'+_style+'"></div>',inHtml+="</div>",inHtml+="</div>",inHtml+='<div class="progressbar-text">',""!=this.options.text&&(inHtml+='<span class="progressbar-text">'+this.options.text+"</span>"),this.options.showPercentage&&(inHtml+='<span class="progressbar-percentage">'+100*this.options.value+this.options.unit+"</span>"),inHtml+="</div>",inHtml+="</div>",null!==this.options.tips&&void 0!==this.options.tips&&(inHtml+='<div class="widget-tips '+this.options.tipsCls+'">',inHtml+='<div class="content tips-content"></div>',inHtml+="</div>"),inHtml+="</div>",this.element.append(inHtml);this.element.find("div.progressbar-content").css({width:this.options.width,height:this.options.height});this.setValue({value:this.options.value})},animate:function(options){var me=this,container=this.element,type=this.options.ptype,unit=this.options.unit,expression=this.options.expression,property="horizontal"===type?"width":"height",arg1=null===options.percentageCurrent?me.percentageCurrent||0:options.percentageCurrent,percentageStart=parseInt(100*arg1,10),percentageEnd=parseInt(100*options.percentageEnd,10),duration=options.duration||500,callback=options.callback,percentageCurrent=percentageStart||0,progressbarBox=container.find("div.progressbar-content"),progressbarBar=progressbarBox.children("div.progressbar-value"),percentageBox=container.find("span.progressbar-percentage"),num=progressbarBox[property]();progressbarBar.css(property,parseInt(num*percentageStart/100,10));var p=Math.round(100*eval(expression.replace("percentage",percentageStart)))/100;percentageBox.html(p+unit);var t=parseInt(duration/Math.abs(percentageEnd-percentageStart),10),start=new Date,start_time=start.getTime();clearInterval(this._timeout),this._timeout=setInterval(function(){var now=new Date,now_time=now.getTime(),time_gap=now_time-start_time,bar_gap=Math.round(time_gap/t);if(start_time=now_time,percentageCurrent!=percentageEnd){percentageCurrent=percentageEnd<percentageCurrent?(percentageCurrent-=bar_gap,percentageCurrent<percentageEnd?percentageEnd:percentageCurrent):(percentageCurrent+=bar_gap,percentageEnd<percentageCurrent?percentageEnd:percentageCurrent),me.percentageCurrent=percentageCurrent.toFixed(1)/100;var animateObj="width"===property?{width:parseInt(num*percentageCurrent/100,10)}:{height:parseInt(num*percentageCurrent/100,10)};progressbarBar.clearQueue().animate(animateObj,t,function(){var p=Math.round(100*eval(expression.replace("percentage",percentageCurrent))/100);percentageBox.html(p+unit),me.val(percentageCurrent/100)})}else{clearInterval(me._timeout),me._timeout=0;var animateObj="width"===property?{width:parseInt(num*percentageEnd/100,10)}:{height:parseInt(num*percentageEnd/100,10)};progressbarBar.css(animateObj);var p=Math.round(100*eval(expression.replace("percentage",percentageEnd)))/100;percentageBox.html(p+unit),callback&&callback.call(me)}},t),me.val(percentageEnd/100)},reset:function(){var me=this,obj=me.options,container=me.element,type=obj.ptype,unit=obj.unit,expression=obj.expression,property="horizontal"===type?"width":"height";me.progressbar("stop");var progressbarBox=container.find("div.progressbar-content"),progressbarBar=progressbarBox.children("div.progressbar-value"),percentageBox=container.find("span.progressbar-percentage"),animateObj="width"===property?{width:0}:{height:0};progressbarBar.stop(),progressbarBar.css(animateObj);var p=Math.round(100*eval(expression.replace("percentage",0)));percentageBox.html(+unit)},stop:function(me){(me=this).element;var _timeout=me._timeout;return clearInterval(_timeout),me},setValue:function(options){var me=this,obj=me.options,container=me.element,type=obj.ptype,unit=obj.unit,expression=obj.expression,property="horizontal"===type?"width":"height",value=options.value||0,text=options.text||me.text,animateFlag=options.animateFlag||!1,progressbarBox=container.find("div.progressbar-content"),progressbarBar=progressbarBox.children("div.progressbar-value"),percentageBox=container.find("span.progressbar-percentage"),textBox=container.find("span.progressbar-text"),num=progressbarBox[property]();if(animateFlag)me.animate({percentageCurrent:me.val(),percentageEnd:value,duration:500,callback:function(){textBox.html(text)}});else{progressbarBar.css(property,num*value);var p=Math.round(100*eval(expression.replace("percentage",value)));percentageBox.html(p+unit),textBox.html(text)}return me.val(value),me},val:function(value){return void 0!==value&&(this.value=value),this.value},_setOption:function(key,value){},disabled:function(flag){},_destroy:function(){this.element.empty().removeClass("progressbar-container"),clearInterval(this._timeout)}},$.fn.tpProgress=function(options){var result,arg=arguments;return this.each(function(){var obj=$(this).data("tpProgress");if(obj||"destroy"==options)"option"==options?result=obj._setOption.apply(obj,Array.prototype.slice.call(arg,1)):"destroy"==options?(result=obj._destroy(),$(this).removeData("tpProgress")):$.isFunction(obj[options])&&(result=obj[options].apply(obj,Array.prototype.slice.call(arg,1)));else{var instance=new tpProgress(this.id,options);$(this).data("tpProgress",instance)}}),result}}(jQuery);