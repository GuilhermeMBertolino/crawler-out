!function($){function tpSearchInput(id,options){this.element=$("#"+id),this.options=$.extend({},tpSearchInput.prototype.options,options),this._create(options),$.isFunction(this._init)&&this.init()}tpSearchInput.prototype={constructor:tpSearchInput,options:{width:null,placeholder:null,searchButton:!1,data:[{text:"text",value:{}},{text:"text2",value:{}},{text:"text3",value:{}},{text:"text4",value:{}},{text:"text5",value:{}},{text:"text6",value:{}},{text:"text7",value:{}},{text:"text8",value:{}},{text:"text9",value:{}},{text:"text10",value:{}}],selectCallback:function(text,value){}},_create:function(){this.id=this.element.attr("id"),this.element.wrap('<div class="search-input-container"></div>'),this.wrapper=this.element.parent("div.search-input-container"),this.element.wrap('<div class="search-input-wrapper"></div>'),$.isIE&&this.element.after('<span class="corner-top-left"></span><span class="corner-top-right"></span><span class="corner-bot-left"></span><span class="corner-bot-right"></span>'),this.dropDownCon=$('<div class="search-input-drop-container"><ul class="search-input-drop"></ul></div>').appendTo(this.wrapper).hide(),this.dropDown=this.dropDownCon.find(".search-input-drop"),this.dropDownDelta=$('<span class="search-input-drop-delta">').appendTo(this.dropDownCon),!0===this.options.searchButton?(this.wrapper.append('<div class="search-input-button-container"><span class="search-icon"></span></div>').addClass("hasButton"),this.button=this.wrapper.find(".search-input-button-container"),this.element.addClass("hasButton")):(this.wrapper.append('<div class="search-input-button-container"><span class="search-icon"></span></div>').addClass("hasSearchIcon"),this.button=this.wrapper.find(".search-input-button-container"),this.element.addClass("hasSearchIcon")),this.hint=$('<span class="search-input-hint"></span>').appendTo(this.wrapper).hide().css({fontSize:this.element.css("fontSize"),left:this.element.css("paddingLeft"),height:this.element.css("height"),lineHeight:this.element.css("height")}),this._createList(this.options.data),this._setOption("width",this.options.width||this.element.width()),this.options.placeholder=this.options.placeholder||this.element.attr("placeholder"),this._setOption("placeholder",this.options.placeholder),void 0===document.createElement("input").placeholder&&this.options.placeholder&&""==this.element.val()&&this.hint.show(),this._registerHandler()},_createList:function(dataArray,clear){if(!$.isArray(dataArray))return!1;var drop=this.dropDown;!0===clear&&drop.empty();for(var i=0,len=dataArray.length;i<len;i++)$("<li>"+dataArray[i].text+"</li>").data("data",dataArray[i].value).appendTo(drop)},_showRelativeItems:function(){for(var inputValue=this.element.val(),regex=new RegExp(inputValue.toLowerCase().replace(/([^\w])/g,"\\$1"),"i"),items=this.dropDown.children(),isEmpty=!0,i=0,len=items.length;i<len;i++){var match,tmpItem=items.eq(i);(match=regex.exec(tmpItem.text()))?(isEmpty=!1,tmpItem.html(match.input.replace(match[0],'<strong class="highlight">'+match+"</strong>")),tmpItem.show()):tmpItem.hide()}isEmpty?this.dropDownCon.slideUp("fast"):this.dropDownCon.slideDown("fast")},_registerHandler:function(){var me=this,isKeyBoard=!1,isIE8=void 0===document.createElement("input").placeholder;this.element.on("blur.tpSearchInput",function(){isIE8&&me.options.placeholder&&""==me.element.val()&&me.hint.show()});var _showDropDownList=function(){me._showRelativeItems(),$(document).off("click.tpSearchInput").on("click.tpSearchInput",function(){me.dropDownCon.slideUp("fast"),$(document).off("click.tpSearchInput")})};this.element.on("focus.tpSearchInput",function(){isIE8&&me.options.placeholder&&me.hint.hide(),me.wrapper.addClass("focus"),!0!==me.options.searchButton&&_showDropDownList()}).on("blur.tpSearchInput",function(){me.wrapper.removeClass("focus")}),!0===this.options.searchButton&&this.button.on("click.tpSearchInput",function(){return _showDropDownList(),!1}),this.wrapper.on("mousemove.tpSearchInput",function(){isKeyBoard=!1});var keyEventObj=!0===this.options.searchButton?window:this.element;$(keyEventObj).off("keydown."+this.id).on("keydown."+this.id,function(e){if(38===e.keyCode||40===e.keyCode){isKeyBoard=!0,e.preventDefault();var newItem,oldItem=me.dropDown.find("li.hover:visible");if(0<oldItem.length?38===e.keyCode?newItem=oldItem.prevAll("li:visible:first"):40===e.keyCode&&(newItem=oldItem.nextAll("li:visible:first")):newItem=me.dropDown.find("li:visible:eq(0)"),0<newItem.length){me.dropDown.find("li.hover").removeClass("hover"),newItem.addClass("hover");var nit=newItem.position().top;nit<0?me.dropDown[0].scrollTop=nit-me.dropDown.find("li:visible:first").position().top:nit>me.dropDown.height()-newItem.height()&&(me.dropDown[0].scrollTop=nit-me.dropDown.find("li:visible:first").position().top-me.dropDown.height()+newItem.height())}}}),$(keyEventObj).off("keyup."+this.id).on("keyup."+this.id,function(e){var selectItem;"enter"==$.code2key(e)?me.dropDownCon.is(":visible")&&(selectItem=me.dropDown.find("li.hover:visible"))&&0<selectItem.length?selectItem.click():me.element.is(":focus")&&_showDropDownList():!0!==me.options.searchButton&&_showDropDownList()}),this.element.on("click.tpSearchInput",function(e){e.stopPropagation()}),this.dropDown.on("mouseenter.tpSearchInput","li",function(){isKeyBoard||(me.dropDown.find("li.hover").removeClass("hover"),$(this).addClass("hover"))}),this.dropDown.on("mouseleave.tpSearchInput","li",function(){$(this).removeClass("hover")}),this.dropDown.on("click.tpSearchInput","li",function(e){e.stopPropagation();var text=$(this).text(),value=$(this).data("data");me.val(text,value),me.dropDownCon.slideUp("fast"),$(document).off("click.tpSearchInput")})},_unregisterHandlers:function(){this.element.off(".tpSearchInput").off("."+this.id),this.dropDown.off(".tpSearchInput"),this.wrapper.off(".tpSearchInput"),this.button.off(".tpSearchInput"),$(window).off("."+this.id)},setData:function(dataArray,clear){this.options.data=!0===clear?dataArray:this.options.data.concat(dataArray),this._createList(this.options.data,clear)},_setOption:function(key,value){"selectCallback"==key?$.isFunction(value)&&(this.options.selectCallback=value):"data"==key?this.setData.apply(this,Array.prototype.slice.call(arguments,1)):"width"==key?null!=value&&(this.options.width=value,this.element.css("width",value),this.dropDown.css("min-width",value),this.dropDownDelta.css("left",value-this.element.height()-this.dropDownDelta.width()/2)):"placeholder"==key&&null!=value&&(this.options.placeholder=value,this.hint.text(value),this.element.attr("placeholder",value))},disabled:function(flag){this.element.prop("disabled",flag)},_destroy:function(){this._unregisterHandlers(),this.dropDown.remove(),this.element.unwrap()},val:function(text,data){void 0!==text&&(this.element.val(text),text&&this.hint.hide()),data&&$.isFunction(this.options.selectCallback)&&this.options.selectCallback.call(this,text,data)}},$.fn.tpSearchInput=function(options){var result,arg=arguments;return this.each(function(){var input=$(this).data("tpSearchInput");if(input)"option"==options?result=input._setOption.apply(input,Array.prototype.slice.call(arg,1)):"destroy"==options?(result=input._destroy(),$(this).removeData("tpSearchInput")):$.isFunction(input[options])&&(result=input[options].apply(input,Array.prototype.slice.call(arg,1)));else{var instance=new tpSearchInput(this.id,options);$(this).data("tpSearchInput",instance)}}),result}}(jQuery);