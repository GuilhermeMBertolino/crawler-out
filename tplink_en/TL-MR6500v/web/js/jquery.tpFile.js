!function($){function TPFile(id,options){this.element=$("#"+id),this.id=id,this.options=$.extend({},TPFile.prototype.options,options),this._create(options),$.isFunction(this._init)&&this.init()}TPFile.prototype={constructor:TPFile,options:{buttonStr:$.tpLang.s_str.browse,textLabel:null,textLabelClass:"",textLabelConnector:":",parentClass:"pure-control-group",supportFormat:[],invalidFormatText:null,validator:null,invalidText:null,allowBlank:!0,blankText:null,suffix:null},_create:function(){this.container=this.element.parent(),this.container.addClass("file-container"),this.file=this.element,this.input=$('<input type="text" id="'+this.id+'-input" readonly="true">').insertBefore(this.file),this.browse=$('<button type="button" class="green pure-button tp-btn-custom"></button>').wrap('<div class="button-container in-line">').appendTo(this.container),this.browse.html("<span>"+this.options.buttonStr+"</span>");var me=this;this.input.tpInput({textLabel:this.options.textLabel,textLabelClass:this.options.textLabelClass,textLabelConnector:this.options.textLabelConnector,parentClass:this.options.parentClass,allowBlank:this.options.allowBlank,blankText:this.options.blankText,readOnly:!0,validator:function(){return me._checkFormat(me.val(),me.options.supportFormat)?!me.options.validator||me.options.validator():me.options.invalidFormatText},invalidText:this.options.invalidText}),this._registerHandler()},_checkFormat:function(val,format){if(val=val||this.val(),0==(format=format||this.options.supportFormat).length)return!0;for(var i=0,len=format.length;i<len;i++)if(new RegExp("\\."+format[i]+"$","g").test(val))return!0;return!1},_registerHandler:function(){var me=this;this.file[0].onchange=function(){var value=$(this).val(),path=value.split("\\").pop();me.input.tpInput("val",path);var check=me.validate();me.element.trigger("ev_change",[value,!0===check])},this.input.on("click",function(){me.file.click()}),this.browse.on("click",function(){me.file.click()})},_unregisterHandlers:function(){this.browse.off("click"),this.file[0].onchange=null},showError:function(text){this.input.tpInput("showError",text)},hideError:function(){this.input.tpInput("hideError")},val:function(val){return void 0!==val?(this.input.tpInput("val",val),this.file.val(val)):this.file.val()},validate:function(isShowed){return this.input.tpInput("validate",isShowed)},_destroy:function(){this._unregisterHandlers(),this.input.tpInput("destroy"),this.input.remove(),this.browse.parent().remove()}},$.fn.tpFile=function(options){var result,arg=arguments;return this.each(function(){var input=$(this).data("tpFile");if(input||"destroy"==options)"option"==options?result=input._setOption.apply(input,Array.prototype.slice.call(arg,1)):"destroy"==options?(result=input._destroy(),$(this).removeData("tpFile")):$.isFunction(input[options])&&(result=input[options].apply(input,Array.prototype.slice.call(arg,1)));else{var instance=new TPFile(this.id,options);$(this).data("tpFile",instance)}}),result}}(jQuery);