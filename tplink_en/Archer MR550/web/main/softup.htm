<script>function showUpgradeError(e){var n;switch(e=parseInt(e,10)){case 2e4:n=strDownLoadFail;break;case 20001:n=strCheckFail,$("#t_onLineUpgrade").html("<span>"+strCheckForUpgrade+"</span>").data("operation","check").addClass("xl");break;case 20002:case 20003:n=strInternetUnavailable;break;case 20004:n=strDownLoadFail}alertButton("t_onLineUpgrade",n)}function showDownLoadProgress(){var e,n,t=0,r=0,a=0,o=80;alertButton("t_onLineUpgrade"),$.guageWithRateControl({text:strDownLoad,note:strKeepPowerOn,updateInterval:500,rateControl:function(s,i){if("INCLUDE_CLOUD"in window&&1==INCLUDE_CLOUD)0==r?(e=$.act(ACT_GET,FW_UPGRADE_INFO,null,null,null),$.exe(function(t){t||(e.progress<100&&i(parseInt(4*e.progress/5,10)),2==(n=parseInt(e.status,10))&&(r=1))})):((t+=1)%6==0&&(o=80+t/6),o<98?i(o):((a+=1)>10&&(i(100),n=3),e=$.act(ACT_GET,FW_UPGRADE_INFO,null,null,null),$.exe(function(t){t||(n=parseInt(e.status,10))})));else if("INCLUDE_FOTA"in window&&1==INCLUDE_FOTA){e=$.act(ACT_GET,SYSTEMUPDATE,null,null,null);var l=0;$.exe(function(r){r||(l=e.downSize/e.fileSize*100,parseInt(l)>t&&(t=parseInt(l),i(t||100)),(l>=100||100==t)&&(download_ok=1,2==downloadState?n=3:3==downloadState?n=2e4:l>=100&&(n=3)))}),1!=download_ok&&2!=downloadState||((t+=1)>100&&(t=100),i(t||100))}},isComplete:function(e,t,r){3==n?t&&t():n>=2e4&&(r&&r(n),$.removeLoading(),showUpgradeError(n))},callback_complete:function(){$.guage(["<span class='T T_upgrading'>"+s_str.upgrading+"</span>","<span class='T T_wait_upgrade'>"+s_str.wait_upgrade+"</span>"],100,waitTime,function(){$.refresh()},null,null,null,strKeepPowerOn)},callback_error:function(e){}})}function byteAdapt(e){e=Number(e);var n=0,t=new Array("Bytes","KB","MB","GB");if(!e||e<0)return[0,t[1]];do{if(e/=1024,3===++n)break}while(e>=1024);return-1!==(e=e.toString()).indexOf(".")&&(e=e.substr(0,e.indexOf(".")+3)),e=Number(e),[e,t[n]]}function checkDownloadState(){$.ajax({type:"POST",url:"/cgi/downloadState",async:!0,timeout:3e3,success:function(e){if(e.indexOf("result")>=0){var n,t;t=(n=e.substring(e.indexOf("result")+"result".length+2)).substring(0,n.indexOf('";'))}if(downloadState=t,t<3)setTimeout(checkDownloadState,3e3);else if(3==t||4==t)return}})}function getFwUpgradeStatu(){var e=$.act(ACT_GET,FW_UPGRADE_INFO,null,null,null),n=$.act(ACT_GET,CLOUD_SERVICE,null,null,["legality"]);return $.exe(),1==n.legality?($.removeLoading(),void alertButton("t_onLineUpgrade",strIllegalDevice)):e.status>=2e3?(online=!1,$.removeLoading(),void showUpgradeError(e.status)):5==e.status?(""==e.version?(alertButton("t_onLineUpgrade",strUpToDate),$("#t_onLineUpgrade").html("<span>"+strCheckForUpgrade+"</span>").data("operation","check").addClass("xl")):($("#onlie_up_sver").prop("value",e.version),$("#online_release_log").html(e.releaseLog),$("#t_onLineUpgrade").html("<span>"+n_str.softup.c_upgrade+"</span>").data("operation","upgrade").removeClass("xl"),$("#topUpdate").removeClass("nd"),$.adjustTop()),$.removeLoading(),void(online=!0)):void setTimeout(function(){getFwUpgradeStatu()},500)}function init(){var e=$.act(ACT_GET,IGD_DEV_INFO,null,null,["hardwareVersion","softwareVersion"]),n=$.act(ACT_GET,X_TP_LTE,null,null,["LTE_SerialNumber","LTE_SoftwareVersion"]);if("INCLUDE_CLOUD"in window&&1==INCLUDE_CLOUD)var t=$.act(ACT_GET,FW_UPGRADE_INFO,null,null,null);else if("INCLUDE_FOTA"in window&&1==INCLUDE_FOTA)var r=$.act(ACT_GET,SYSTEMUPDATE,null,null,null);if(!$.exe())if($("#up_sver").prop("value",e.softwareVersion),$("#up_hver").prop("value",e.hardwareVersion),$("#up_mver").prop("value",n.LTE_SoftwareVersion),$("#up_msn").prop("value",n.LTE_SerialNumber),"INCLUDE_CLOUD"in window&&1==INCLUDE_CLOUD)$("#onlineUpgrade-block").removeClass("nd"),1==t.status&&showDownLoadProgress(),t.version?($("#onlie_up_sver").prop("value",t.version),$("#t_onLineUpgrade").html("<span>"+n_str.softup.c_upgrade+"</span>").data("operation","upgrade")):($("#onlie_up_sver").prop("value",e.softwareVersion),$("#t_onLineUpgrade").html("<span>"+strCheckForUpgrade+"</span>").data("operation","check")),$("#online_release_log").html(t.releaseLog),$.addLoading(),checkWanLinkStatus()?($.act(ACT_OP,ACT_CLOUD_CHECKNEWFWINFO_BY_USER,null),$.exe(null,!0),getFwUpgradeStatu()):(online=!1,$.removeLoading(),alertButton("t_onLineUpgrade",strInternetUnavailable));else if("INCLUDE_FOTA"in window&&1==INCLUDE_FOTA)if($("#onlineUpgrade-block").removeClass("nd"),$("#t_onLineUpgrade").html("<span>"+strCheckForUpgrade+"</span>").data("operation","check"),$.addLoading(),checkWanLinkStatus()){if(1==r.fotaState)return online=!0,void showDownLoadProgress();$.ajax({type:"POST",url:"/cgi/fotaCheck",async:!0,timeout:5e4,bScript:!0,success:function(n){var t;return n.indexOf("result")>=0&&(t=n.substring(n.indexOf("result")+"result".length+2),result=t.substring(0,t.indexOf('";'))),2==result?(alertButton("t_onLineUpgrade",strInternetUnavailable),online=!1,$.removeLoading(),!1):3==result?(alertButton("t_onLineUpgrade",strInternetUnavailable),online=!1,$.removeLoading(),!1):(n.indexOf("hasNewVersion")>=0&&(t=n.substring(n.indexOf("hasNewVersion")+"hasNewVersion".length+2),hasNewVersion=t.substring(0,t.indexOf('";'))),1==hasNewVersion?(n.indexOf("latestVersion")>0&&(t=n.substring(n.indexOf("latestVersion")+"latestVersion".length+2),latestVersion=t.substring(0,t.indexOf('";')),$("#onlie_up_sver").prop("value",latestVersion),$("#t_onLineUpgrade").html("<span>"+n_str.softup.c_upgrade+"</span>").data("operation","upgrade")),n.indexOf("firmwareSize")>0&&(t=n.substring(n.indexOf("firmwareSize")+"firmwareSize".length+1),firmwareSize=t.substring(0,t.indexOf(";")),(t=byteAdapt(firmwareSize))[0]>10&&(downloadTime=1e4)),n.indexOf("downloadUrl")>0&&(t=n.substring(n.indexOf("downloadUrl")+"downloadUrl".length+2),downloadUrl=t.substring(0,t.indexOf('";'))),n.indexOf("releaseNote")>0&&(t=n.substring(n.indexOf("releaseNote")+"releaseNote".length+2),releaseNote=t.substring(0,t.length-3),releaseNote.indexOf("Version: ")>=0&&(firstLen=releaseNote.substring(releaseNote.indexOf("Version: ")).split("<br>")[0],latestVersion=firstLen.substring("Version: ".length),$("#onlie_up_sver").prop("value",latestVersion),releaseNote=releaseNote.substring(firstLen.length+"<br>".length)),$("#online_release_log").html(releaseNote))):($("#onlie_up_sver").prop("value",e.softwareVersion),$("#t_onLineUpgrade").html("<span>"+strCheckForUpgrade+"</span>").data("operation","check"),alertButton("t_onLineUpgrade",strUpToDate)),$.removeLoading(),void(online=!0))},error:function(){alertButton("t_onLineUpgrade",strInternetUnavailable),$("#onlie_up_sver").prop("value",e.softwareVersion),$.removeLoading()}})}else online=!1,$.removeLoading(),alertButton("t_onLineUpgrade",strInternetUnavailable),$("#onlie_up_sver").prop("value",e.softwareVersion)}function checkWanLinkStatus(){var e,n,t,r=$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]),a=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]),o=$.act(ACT_GL,LTE_WAN_CFG,null,null,["dataSwitchStatusBackup"]);if($.exe(),"LTE"==r.__ifAliasName)n="LTE";else{if("NO_INTERFACE"==r.__ifAliasName)return!1;n="Ethernet"}if($.each(a,function(){if(this.WANAccessType==n)return e=this.__stack,!1}),"Ethernet"==n){if(ethIntfConfig=$.act(ACT_GET,WAN_ETH_INTF,e,null,["Status"]),$.exe(),INCLUDE_EWAN_VLAN&&("NoLink"==ethIntfConfig.status||"Error"==ethIntfConfig.status||"Disabled"==ethIntfConfig.status)||"Unavailable"==ethIntfConfig.ethernetLinkStatus||"Down"==ethIntfConfig.ethernetLinkStatus)return!1}else if("LTE"==n&&($.each(o,function(){var n=$.stkPop(this.__stack,1);if(e==n)return e=this.__stack,t=this.dataSwitchStatusBackup,!1}),lteLinkCfg=$.act(ACT_GET,WAN_LTE_LINK_CFG,e,null,null),$.exe(),3!=lteLinkCfg.simStatus&&5!=lteLinkCfg.simStatus||1!=t))return!1;return!0}function alertButton(e,n){"string"==typeof e&&-1==e.search("#")&&(e="#"+e);var t=$(e);setTimeout(function(){(t.prev(".button-err-text").length>0?t.prev(".button-err-text"):$('<span class="button-err-text">').insertBefore(t)).html(n||"")},0)}var strUpToDate=n_str.softup.upTodate||"Your firmware is up to date",strDownLoad=n_str.softup.downLoad||"Downloading...",strKeepPowerOn=n_str.softup.keepPowerOn||"To avoid any damage, keep the device powered on.",strInternetUnavailable=n_str.softup.internetUnavailable||"Internet is unavailable.",strCheckFail=n_str.softup.checkFail||"Invalid firmware. Please download the new firmware again.",strDownLoadFail=n_str.softup.downLoadFailed||"Download failed.",strCheckForUpgrade=n_str.softup.checkForUpgrade||"Check for Upgrades",strConfirmContent=n_str.softup.confirmContent||"Are you sure you want to upgrade the firmware?",strRestoreTipContent=n_str.softup.restoreTipContent||"The router will restore to its factory default settings after firmware upgrade.<br>Are you sure you want to upgrade the firmware?",strIllegalDevice=n_str.softup.illegalDevice||"Your device does not support TP-Link cloud service. Please contact TP-Link technical support if you want to continue.",strUpgrade=n_str.softup.c_upgrade||"Upgrade",online=!1,downloadState=-1,waitTime=1800;INCLUDE_LTEWAN&&(waitTime=INCLUDE_ASR_AT?8200:2400),$("#t_upgrade").click(function(){if(""==$("#filename").val())return $.alert(ERR_FIRM_FILE_NONE),!1;var e=30,n=$("#filename").closest("form")[0],t=0,r=document.getElementById("filename");$.isIE?filesize=16777216:t=r.files[0].size,e=(e=t>20971520?parseInt(t/1048576*30):parseInt(t/1048576*16))<30?30:e;try{n.target="up_frame",n.action="/cgi/softup",n.submit()}catch(e){}setTimeout(function(){$.tpAjax({url:"/cgi/softburn",async:!0,bScript:!0,success:function(e){!e&&(e=$.ret)&&(71300==$.ret?setTimeout(function(){checkUpgradeResult()},500):$.err("cgi",$.ret))}})},3e3),$.guage(["<span class='T T_uploading'>"+s_str.uploading+"</span>","<span class='T T_wait_upload'>"+s_str.wait_upload+"</span>"],100,e,function(){$.guage(["<span class='T T_upgrading'>"+s_str.upgrading+"</span>","<span class='T T_wait_upgrade'>"+s_str.wait_upgrade+"</span>"],100,waitTime,function(){$.refresh()},null,null,null,strKeepPowerOn)})}),$("#t_onLineUpgrade").click(function(){var e=$("#t_onLineUpgrade").data("operation");if("INCLUDE_CLOUD"in window&&1==INCLUDE_CLOUD){if("check"==e)alertButton("t_onLineUpgrade"),$.addLoading($("#t_onLineUpgrade")),$.act(ACT_OP,ACT_CLOUD_CHECKNEWFWINFO_BY_USER,null),$.exe(function(e){if(e)$.removeLoading();else var n=setInterval(function(){var t=$.act(ACT_GET,FW_UPGRADE_INFO,null,null,null),r=$.act(ACT_GET,CLOUD_SERVICE,null,null,["legality"]);$.exe(function(){return e?($.removeLoading(),void clearInterval(n)):1==r.legality?(clearInterval(n),$.removeLoading(),void alertButton("t_onLineUpgrade",strIllegalDevice)):void(4!=t.status&&11!=t.status&&(5==t.status?($.removeLoading(),clearInterval(n),""==t.version?(alertButton("t_onLineUpgrade",strUpToDate),$("#t_onLineUpgrade").html("<span>"+strCheckForUpgrade+"</span>").data("operation","check").addClass("xl")):($("#onlie_up_sver").prop("value",t.version),$("#online_release_log").html(t.releaseLog),$("#t_onLineUpgrade").html("<span>"+n_str.softup.c_upgrade+"</span>").data("operation","upgrade").removeClass("xl"),$("#topUpdate").removeClass("nd"),$.adjustTop())):($.removeLoading(),clearInterval(n),showUpgradeError(t.status))))})},1e3)},!0);else if("upgrade"==e){var n="",t=parseInt($("#up_sver").val().split(".")[0]),r=parseInt($("#onlie_up_sver").val().split(".")[0]);if(!online)return void alertButton("t_onLineUpgrade",strInternetUnavailable);n=r>t?strRestoreTipContent:strConfirmContent,$.confirm(n,function(){$.addLoading($("#t_onLineUpgrade")),$.act(ACT_SET,FW_UPGRADE_INFO,null,null,["start=1"]),$.exe(function(e){e?$.removeLoading():showDownLoadProgress()})})}}else if("INCLUDE_FOTA"in window&&1==INCLUDE_FOTA)if("check"==e)alertButton("t_onLineUpgrade"),$.addLoading($("#t_onLineUpgrade")),checkWanLinkStatus()?$.ajax({type:"POST",url:"/cgi/fotaCheck",async:!0,timeout:5e4,bScript:!0,success:function(e){var n;return e.indexOf("result")>=0&&(n=e.substring(e.indexOf("result")+"result".length+2),result=n.substring(0,n.indexOf('";'))),2==result?(online=!1,$.removeLoading(),alertButton("t_onLineUpgrade",strInternetUnavailable),!1):3==result?(online=!1,$.removeLoading(),alertButton("t_onLineUpgrade",strInternetUnavailable),!1):(e.indexOf("hasNewVersion")>=0&&(n=e.substring(e.indexOf("hasNewVersion")+"hasNewVersion".length+2),hasNewVersion=n.substring(0,n.indexOf('";'))),1==hasNewVersion?(e.indexOf("latestVersion")>0&&(n=e.substring(e.indexOf("latestVersion")+"latestVersion".length+2),latestVersion=n.substring(0,n.indexOf('";')),$("#onlie_up_sver").prop("value",latestVersion),$("#t_onLineUpgrade").html("<span>"+n_str.softup.c_upgrade+"</span>").data("operation","upgrade")),e.indexOf("firmwareSize")>0&&(n=e.substring(e.indexOf("firmwareSize")+"firmwareSize".length+1),firmwareSize=n.substring(0,n.indexOf(";")),(n=byteAdapt(firmwareSize))[0]>10&&(downloadTime=1e4)),e.indexOf("downloadUrl")>0&&(n=e.substring(e.indexOf("downloadUrl")+"downloadUrl".length+2),downloadUrl=n.substring(0,n.indexOf('";'))),e.indexOf("releaseNote")>0&&(n=e.substring(e.indexOf("releaseNote")+"releaseNote".length+2),releaseNote=n.substring(0,n.length-3),releaseNote.indexOf("Version: ")>=0&&(firstLen=releaseNote.substring(releaseNote.indexOf("Version: ")).split("<br>")[0],latestVersion=firstLen.substring("Version: ".length),$("#onlie_up_sver").prop("value",latestVersion),releaseNote=releaseNote.substring(firstLen.length+"<br>".length)),$("#online_release_log").html(releaseNote))):(alertButton("t_onLineUpgrade",strUpToDate),$("#t_onLineUpgrade").html("<span>"+strCheckForUpgrade+"</span>").data("operation","check")),$.removeLoading(),void(online=!0))},error:function(){alertButton("t_onLineUpgrade",strInternetUnavailable),$.removeLoading()}}):(online=!1,$.removeLoading(),alertButton("t_onLineUpgrade",strInternetUnavailable));else if("upgrade"==e){var n="",t=parseInt($("#up_sver").val().split(".")[0]),r=parseInt($("#onlie_up_sver").val().split(".")[0]);if(!online)return alertButton("t_onLineUpgrade",strInternetUnavailable),void $.removeLoading();checkWanLinkStatus()?(n=r>t?strRestoreTipContent:strConfirmContent,$.confirm(n,function(){$.addLoading($("#t_onLineUpgrade")),showDownLoadProgress(),$.ajax({type:"POST",url:"/cgi/fotaUpgrade",async:!0,success:function(e){var n,t;e.indexOf("result")>=0&&(t=(n=e.substring(e.indexOf("result")+"result".length+2)).substring(0,n.indexOf('";'))),1==t?$.alert(ERR_ALREADY_UPGRADING):2==t&&$.alert(ERR_START_UPGRADE)}}),checkDownloadState()})):(online=!1,$.removeLoading(),alertButton("t_onLineUpgrade",strInternetUnavailable))}})</script>
<h3 id="et1">Device information</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="pure-control-group">
            <b class="l T_swver">Firmware version:</b>
            <input type="text" readonly="ture" class="tp-input-text xxxl" id="up_sver">
        </div>

        <div class="pure-control-group">
            <b class="l T_hwver">Hardware version:</b>
            <input type="text" readonly="ture" class="tp-input-text xxxl" id="up_hver">
        </div>

		<div class="pure-control-group">
            <b class="l T_mdver">Module version:</b>
            <input type="text" readonly="ture" class="tp-input-text xxxl" id="up_mver">
        </div>

		<div class="pure-control-group">
            <b class="l T_mdsn">Module SN:</b>
            <input type="text" readonly="ture" class="tp-input-text xxxl" id="up_msn">
        </div>
    </form>
</div>

<div id="onlineUpgrade-block" class="nd">
    <h3 id="et2">Online Upgrade</h3>
    <div class="content-container">
        <form id="softup-online" class="pure-form pure-form-aligned">
            <div class="pure-control-group">
                <b class="l T_c_latest">Latest version:</b>
                <input type="text" readonly="ture" class="tp-input-text xxxl" id="onlie_up_sver">
            </div>

            <p class="cfg-line release-log" id="online_release_log"></p>

            <button type="submit" class="green l T_c_upgrade l_auto" id="t_onLineUpgrade" value="Upgrade">upgrade</button>
        </form>
    </div>
</div>


<h3 id="et3">Local upgrade</h3>
<div class="content-container">
    <form id="softup-local" class="pure-form pure-form-aligned" action="/cgi/softup" enctype="multipart/form-data" method="post">
        <div class="file-container">
            <b id="t_file">New firmware file: </b>
            <input type="file" name="filename" id="filename">
        </div>
    </form>
    <form class="pure-form pure-form-aligned">
        <button type="submit" class="green l T_c_upgrade l_auto" id="t_upgrade" value="Upgrade">upgrade</button>
    </form>
</div>
<script>$.tpInit(init)</script>
