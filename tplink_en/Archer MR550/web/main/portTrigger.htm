<script language="javascript">function initTable(){selAll=0,index=0,param=[],allStk=[],allStkType=[],portTrig_param=[],portTrig_stack=[],portTrig_stackType=[],portTrig_stackIndex=0;var t=[];if(portTrigList_IP=$.act(ACT_GL,IP_CONN_PORTTRIGGERING,null,null),portTrigList_PPP=$.act(ACT_GL,PPP_CONN_PORTTRIGGERING,null,null),INCLUDE_USB_3G_DONGLE)var e=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"]);if(INCLUDE_L2TP&&(portTrigList_L2TP=$.act(ACT_GL,L2TP_CONN_PORTTRIGGERING,null,null)),INCLUDE_PPTP&&(portTrigList_PPTP=$.act(ACT_GL,PPTP_CONN_PORTTRIGGERING,null,null)),INCLUDE_WAN_MODE){if(INCLUDE_3G4G_BACKUP)n=$.act(ACT_GET,SYS_MODE,null,null,["mode","lteBackupEnable"]);else if(INCLUDE_USB_3G_BACKUP&&INCLUDE_EWAN_BACKUP)n=$.act(ACT_GET,SYS_MODE,null,null,["mode","usb3gBackup","ewanBackup"]);else var n=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"])}if(!$.exe()){var l=0;if(INCLUDE_USB_3G_DONGLE&&$.each(e,function(){if(1==this.enable)return l=this.backupEnable,!1}),INCLUDE_WAN_MODE){"ETH"==n.mode||n.mode;if(INCLUDE_3G4G_BACKUP)1==n.lteBackupEnable&&n.mode;else{INCLUDE_USB_3G_BACKUP&&INCLUDE_EWAN_BACKUP&&(n.ewanBackup,l=n.usb3gBackup)}}$.each(portTrigList_IP,function(){if(INCLUDE_WAN_MODE){$.act(ACT_GET,SYS_MODE,null,null,["mode"]),$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);$.exe()}index++;var e="["+this.__stack+"]";1==this.enable?t.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"10%"},{text:$.htmlEncodeStr(this.applicationName),width:"20%"},{text:this.triggerPort,width:"15%"},{text:this.triggerProtocol,width:"10%"},{text:this.openPort.replace(/,/g,",</br>"),width:"10%"},{text:this.openProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"ip\", "+e+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ip\", "+e+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ip\", "+e+");'></span>",width:"10%"}]):t.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"10%"},{text:$.htmlEncodeStr(this.applicationName),width:"20%"},{text:this.triggerPort,width:"15%"},{text:this.triggerProtocol,width:"10%"},{text:this.openPort,width:"10%"},{text:this.openProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"ip\", "+e+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ip\", "+e+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ip\", "+e+");'></span>",width:"10%"}]),allStk[index-1]=this.__stack,allStkType[index-1]="ip"}),$.each(portTrigList_PPP,function(){index++;var e="["+this.__stack+"]";1==this.enable?t.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"10%"},{text:$.htmlEncodeStr(this.applicationName),width:"20%"},{text:this.triggerPort,width:"15%"},{text:this.triggerProtocol,width:"10%"},{text:this.openPort,width:"10%"},{text:this.openProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"ppp\", "+e+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ppp\", "+e+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ppp\", "+e+");'></span>",width:"10%"}]):t.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"10%"},{text:$.htmlEncodeStr(this.applicationName),width:"20%"},{text:this.triggerPort,width:"15%"},{text:this.triggerProtocol,width:"10%"},{text:this.openPort,width:"10%"},{text:this.openProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"ppp\", "+e+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ppp\", "+e+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ppp\", "+e+");'></span>",width:"10%"}]),allStk[index-1]=this.__stack,allStkType[index-1]="ppp"}),INCLUDE_L2TP&&$.each(portTrigList_L2TP,function(){index++;var e="["+this.__stack+"]";1==this.enable?t.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"10%"},{text:$.htmlEncodeStr(this.applicationName),width:"20%"},{text:this.triggerPort,width:"15%"},{text:this.triggerProtocol,width:"10%"},{text:this.openPort,width:"10%"},{text:this.openProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"l2tp\", "+e+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"l2tp\", "+e+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"l2tp\", "+e+");'></span>",width:"10%"}]):t.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"10%"},{text:$.htmlEncodeStr(this.applicationName),width:"20%"},{text:this.triggerPort,width:"15%"},{text:this.triggerProtocol,width:"10%"},{text:this.openPort,width:"10%"},{text:this.openProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"l2tp\", "+e+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"l2tp\", "+e+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"l2tp\", "+e+");'></span>",width:"10%"}]),allStk[index-1]=this.__stack,allStkType[index-1]="l2tp"}),INCLUDE_PPTP&&$.each(portTrigList_PPTP,function(){index++;var e="["+this.__stack+"]";1==this.enable?t.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"10%"},{text:$.htmlEncodeStr(this.applicationName),width:"20%"},{text:this.triggerPort,width:"15%"},{text:this.triggerProtocol,width:"10%"},{text:this.openPort,width:"10%"},{text:this.openProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"pptp\", "+e+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"pptp\", "+e+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"pptp\", "+e+");'></span>",width:"10%"}]):t.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-all"/><label></label></div></span>',width:"5%"},{text:index,width:"10%"},{text:$.htmlEncodeStr(this.applicationName),width:"20%"},{text:this.triggerPort,width:"15%"},{text:this.triggerProtocol,width:"10%"},{text:this.openPort,width:"10%"},{text:this.openProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"pptp\", "+e+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"pptp\", "+e+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"pptp\", "+e+");'></span>",width:"10%"}]),allStk[index-1]=this.__stack,allStkType[index-1]="pptp"})}return $.initTableBody($("#table-triggering"),t),t}function initIntf(){var t=$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);if(INCLUDE_WAN_MODE)if(INCLUDE_3G4G_BACKUP)e=$.act(ACT_GET,SYS_MODE,null,null,["mode","lteBackupEnable"]);else var e=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);if(INCLUDE_USB_3G_DONGLE)var n=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"]);if(INCLUDE_IPV6){var l=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType","X_TP_IPv4Enabled"]),o=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","X_TP_IPv4Enabled","transportType"]);if(INCLUDE_L2TP)i=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"]);if(INCLUDE_PPTP)a=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"])}else{var l=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType"]),o=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","transportType"]);if(INCLUDE_L2TP)var i=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"]);if(INCLUDE_PPTP)var a=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"])}if(!$.exe()){wanInfName=t.__ifAliasName;var r;INCLUDE_WAN_MODE&&(r=e.mode);var p=0;INCLUDE_USB_3G_DONGLE&&$.each(n,function(){if(1==this.enable)return p=this.backupEnable,!1});for(var c=0,P=0;P<l.length;P++)if(1==l[P].NATEnabled&&"IP_Routed"==l[P].connectionType&&1==l[P].enable&&(!INCLUDE_IPV6||1==l[P].X_TP_IPv4Enabled)||INCLUDE_3G4G_BACKUP&&"ETH"==e.mode&&1==e.lteBackupEnable&&"LTE"==l[P].name){var _=l[P].name,T="ip:"+l[P].__stack;$("#wanInf").append("<option value='"+T+"' text='"+_+"' >"+_+"</option>"),c=1}for(s=0;s<o.length;s++)if(!(1!=o[s].NATEnabled||1!=o[s].enable&&("PPP3G"!=o[s].transportType||"USB_3G"!=r&&1!=p)||INCLUDE_IPV6&&1!=o[s].X_TP_IPv4Enabled)){var _=o[s].name,T="ppp:"+o[s].__stack;$("#wanInf").append("<option value='"+T+"' text='"+_+"' >"+_+"</option>"),c=1}if(INCLUDE_L2TP)for(s=0;s<i.length;s++)if(1==i[s].enable){var _=i[s].name,T="l2tp:"+i[s].__stack;$("#wanInf").append("<option value='"+T+"' text='"+_+"' >"+_+"</option>"),c=1}if(INCLUDE_PPTP)for(var s=0;s<a.length;s++)if(1==a[s].enable){var _=a[s].name,T="pptp:"+a[s].__stack;$("#wanInf").append("<option value='"+T+"' text='"+_+"' >"+_+"</option>"),c=1}if(0==c){var _=s_str.nointf,T="";$("#wanInf").append("<option value='"+T+"' text='"+_+"' >"+_+"</option>"),$("#ok").prop("disabled",!0)}$("#wanInf").find("option[text="+wanInfName+"]").prop("selected","selected");var d={refresh:1};$("#wanInf").tpSelect(d)}}function doEdit(t,e){editFlag=1,curType=t,curStk=e;$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);if(INCLUDE_WAN_MODE)if(INCLUDE_3G4G_BACKUP)n=$.act(ACT_GET,SYS_MODE,null,null,["mode","lteBackupEnable"]);else var n=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);if(INCLUDE_USB_3G_DONGLE)var l=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"]);if(INCLUDE_IPV6){var o=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType","X_TP_IPv4Enabled"]),i=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","X_TP_IPv4Enabled","transportType"]);if(INCLUDE_L2TP)a=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"]);if(INCLUDE_PPTP)r=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"])}else{var o=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType"]),i=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","transportType"]);if(INCLUDE_L2TP)var a=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"]);if(INCLUDE_PPTP)var r=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"])}if(!$.exe()){if(pStk=e[0]+","+e[1]+","+e[2]+",0,0,0","ip"==t?(portTrigCfg=$.act(ACT_GET,IP_CONN_PORTTRIGGERING,e,null,["triggerPort","triggerProtocol","openPort","openProtocol","enable","applicationName"]),wanInf=$.act(ACT_GET,WAN_IP_CONN,pStk,null,["name"])):"ppp"==t?(portTrigCfg=$.act(ACT_GET,PPP_CONN_PORTTRIGGERING,e,null,["triggerPort","triggerProtocol","openPort","openProtocol","enable","applicationName"]),wanInf=$.act(ACT_GET,WAN_PPP_CONN,pStk,null,["name"])):"l2tp"==t?(portTrigCfg=$.act(ACT_GET,L2TP_CONN_PORTTRIGGERING,e,null,["triggerPort","triggerProtocol","openPort","openProtocol","enable","applicationName"]),wanInf=$.act(ACT_GET,WAN_L2TP_CONN,pStk,null,["name"])):"pptp"==t&&(portTrigCfg=$.act(ACT_GET,PPTP_CONN_PORTTRIGGERING,e,null,["triggerPort","triggerProtocol","openPort","openProtocol","enable","applicationName"]),wanInf=$.act(ACT_GET,WAN_PPTP_CONN,pStk,null,["name"])),!$.exe()){wanInfName=wanInf.name,$("#t_apply").prop("value",$.encodeHtml(portTrigCfg.applicationName)),$("#triggerPort").prop("value",portTrigCfg.triggerPort),"TCP"==portTrigCfg.triggerProtocol?$("#trigger_protol option[value='TCP']").prop("selected","selected"):"UDP"==portTrigCfg.triggerProtocol?$("#trigger_protol option[value='UDP']").prop("selected","selected"):$("#trigger_protol option[value='TCP or UDP']").prop("selected","selected");N={refresh:1};$("#trigger_protol").tpSelect(N),$("#openPort").prop("value",portTrigCfg.openPort),"TCP"==portTrigCfg.openProtocol?$("#external_protol option[value='TCP']").prop("selected","selected"):"UDP"==portTrigCfg.openProtocol?$("#external_protol option[value='UDP']").prop("selected","selected"):$("#external_protol option[value='TCP or UDP']").prop("selected","selected");N={refresh:1};$("#external_protol").tpSelect(N),1==portTrigCfg.enable?$("#portTrig_en").prop("checked","checked"):$("#portTrig_en").prop("checked",!1),$("#portTrig_en").tpCheckbox()}var p;INCLUDE_WAN_MODE&&(p=n.mode);var c=0;INCLUDE_USB_3G_DONGLE&&$.each(l,function(){if(1==this.enable)return c=this.backupEnable,!1});for(var P=0,_=0;_<o.length;_++)if(1==o[_].NATEnabled&&"IP_Routed"==o[_].connectionType&&(1==o[_].enable&&(!INCLUDE_IPV6||1==o[_].X_TP_IPv4Enabled)||INCLUDE_3G4G_BACKUP&&"ETH"==n.mode&&1==n.lteBackupEnable&&"LTE"==o[_].name)){var T=o[_].name,s="ip:"+o[_].__stack;$("#wanInf").append("<option value='"+s+"' text='"+T+"' >"+T+"</option>"),P=1}for(d=0;d<i.length;d++)if(!(1!=i[d].NATEnabled||1!=i[d].enable&&("PPP3G"!=i[d].transportType||"USB_3G"!=p&&1!=c)||INCLUDE_IPV6&&1!=i[d].X_TP_IPv4Enabled)){var T=i[d].name,s="ppp:"+i[d].__stack;$("#wanInf").append("<option value='"+s+"' text='"+T+"' >"+T+"</option>"),P=1}if(INCLUDE_L2TP)for(d=0;d<a.length;d++)if(1==a[d].enable){var T=a[d].name,s="l2tp:"+a[d].__stack;$("#wanInf").append("<option value='"+s+"' text='"+T+"' >"+T+"</option>"),P=1}if(INCLUDE_PPTP)for(var d=0;d<r.length;d++)if(1==r[d].enable){var T=r[d].name,s="pptp:"+r[d].__stack;$("#wanInf").append("<option value='"+s+"' text='"+T+"' >"+T+"</option>"),P=1}if(0==P){var T=n_str.portTrigger.t_noavailintf,s="";$("#wanInf").append("<option value='"+s+"' text='"+T+"' >"+T+"</option>"),$("#ok").prop("disabled",!0)}$("#wanInf").find("option[text="+wanInfName+"]").prop("selected","selected");var N={refresh:1};$("#wanInf").tpSelect(N)}}function checkEntryConflict(t,e){return t.triggerPort==e.triggerPort&&(t.openPort==e.openPort&&((t.triggerProtocol==e.triggerProtocol||"TCP or UDP"==t.triggerProtocol||"TCP or UDP"==e.triggerProtocol)&&(t.openProtocol==e.openProtocol||"TCP or UDP"==t.openProtocol||"TCP or UDP"==e.openProtocol)))}function checkConflictForAllList(t,e){var n=!1;return $.each(portTrigList_IP,function(){if(e!=this.__stack&&checkEntryConflict(t,this))return n=!0}),!!n||($.each(portTrigList_PPP,function(){if(e!=this.__stack&&checkEntryConflict(t,this))return n=!0}),!!n||(!(!INCLUDE_L2TP||($.each(portTrigList_L2TP,function(){if(e!=this.__stack&&checkEntryConflict(t,this))return n=!0}),!n))||!(!INCLUDE_PPTP||($.each(portTrigList_PPTP,function(){if(e!=this.__stack&&checkEntryConflict(t,this))return n=!0}),!n))))}function doEnable(t,e,n){var l=!1,o=!1,i=!1;if(INCLUDE_PPTPVPN_SERVER)var a=$.act(ACT_GET,PPTPVPN,null,null);if(INCLUDE_OPENVPN_SERVER)var r=$.act(ACT_GET,OPENVPN,null,null);if("ip"==t){p=$.act(ACT_GET,IP_CONN_PORTTRIGGERING,e,null,null);$.exe(),INCLUDE_USB_FTP_SERVER&&(checkConflictFtpPort(p.triggerPort)&&"UDP"!=p.triggerProtocol||checkConflictFtpPort(p.openPort)&&"UDP"!=p.openProtocol)&&(l=!0),INCLUDE_PPTPVPN_SERVER&&checkConflictPptpALGPort(p.openPort)&&"UDP"!=p.openProtocol&&0==p.enable&&1==a.enable&&(o=!0),INCLUDE_OPENVPN_SERVER&&checkConflictOvpnPTPort(p.openPort,r.port)&&checkConflictOvpnPTProtocol(p.openProtocol,r.proto)&&0==p.enable&&1==r.enable&&(i=!0)}else if("ppp"==t){p=$.act(ACT_GET,PPP_CONN_PORTTRIGGERING,e,null,null);$.exe(),INCLUDE_USB_FTP_SERVER&&(checkConflictFtpPort(p.triggerPort)&&"UDP"!=p.triggerProtocol||checkConflictFtpPort(p.openPort)&&"UDP"!=p.openProtocol)&&(l=!0),INCLUDE_PPTPVPN_SERVER&&checkConflictPptpALGPort(p.openPort)&&"UDP"!=p.openProtocol&&0==p.enable&&1==a.enable&&(o=!0),INCLUDE_OPENVPN_SERVER&&checkConflictOvpnPTPort(p.openPort,r.port)&&checkConflictOvpnPTProtocol(p.openProtocol,r.proto)&&0==p.enable&&1==r.enable&&(i=!0)}else if("l2tp"==t){p=$.act(ACT_GET,L2TP_CONN_PORTTRIGGERING,e,null,null);$.exe(),INCLUDE_USB_FTP_SERVER&&(checkConflictFtpPort(p.triggerPort)&&"UDP"!=p.triggerProtocol||checkConflictFtpPort(p.openPort)&&"UDP"!=p.openProtocol)&&(l=!0),INCLUDE_PPTPVPN_SERVER&&checkConflictPptpALGPort(p.openPort)&&"UDP"!=p.openProtocol&&0==p.enable&&1==a.enable&&(o=!0),INCLUDE_OPENVPN_SERVER&&checkConflictOvpnPTPort(p.openPort,r.port)&&checkConflictOvpnPTProtocol(p.openProtocol,r.proto)&&0==p.enable&&1==r.enable&&(i=!0)}else if("pptp"==t){var p=$.act(ACT_GET,PPTP_CONN_PORTTRIGGERING,e,null,null);$.exe(),INCLUDE_USB_FTP_SERVER&&(checkConflictFtpPort(p.triggerPort)&&"UDP"!=p.triggerProtocol||checkConflictFtpPort(p.openPort)&&"UDP"!=p.openProtocol)&&(l=!0),INCLUDE_PPTPVPN_SERVER&&checkConflictPptpALGPort(p.openPort)&&"UDP"!=p.openProtocol&&0==p.enable&&1==a.enable&&(o=!0),INCLUDE_OPENVPN_SERVER&&checkConflictOvpnPTPort(p.openPort,r.port)&&checkConflictOvpnPTProtocol(p.openProtocol,r.proto)&&0==p.enable&&1==r.enable&&(i=!0)}if(l)$.confirm(c_str.forwarding_ftp_conflict,function(){$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]),$.exe(),"ip"==t?1==p.enable?$.act(ACT_SET,IP_CONN_PORTTRIGGERING,e,null,["enable=0"]):$.act(ACT_SET,IP_CONN_PORTTRIGGERING,e,null,["enable=1"]):"ppp"==t?1==p.enable?$.act(ACT_SET,PPP_CONN_PORTTRIGGERING,e,null,["enable=0"]):$.act(ACT_SET,PPP_CONN_PORTTRIGGERING,e,null,["enable=1"]):"l2tp"==t?1==p.enable?$.act(ACT_SET,L2TP_CONN_PORTTRIGGERING,e,null,["enable=0"]):$.act(ACT_SET,L2TP_CONN_PORTTRIGGERING,e,null,["enable=1"]):"pptp"==t&&(1==p.enable?$.act(ACT_SET,PPTP_CONN_PORTTRIGGERING,e,null,["enable=0"]):$.act(ACT_SET,PPTP_CONN_PORTTRIGGERING,e,null,["enable=1"])),$.exe(function(){0==p.enable?$("#en_"+n).removeClass("disable-icon").addClass("enable-icon"):$("#en_"+n).addClass("disable-icon").removeClass("enable-icon")})},function(){1==p.enable?$("#en_"+n).removeClass("disable-icon").addClass("enable-icon"):$("#en_"+n).addClass("disable-icon").removeClass("enable-icon")});else{if(o)return $.alert(CMM_PVPN_PORT_CONFLICT_WITH_PT),void $.exe(function(){0==p.enable?$("#en_"+n).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+n).removeClass("disable-icon").addClass("enable-icon")});if(i)return $.alert(CMM_OVPN_PORT_CONFLICT_WITH_PT),void $.exe(function(){0==p.enable?$("#en_"+n).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+n).removeClass("disable-icon").addClass("enable-icon")});"ip"==t?1==p.enable?$.act(ACT_SET,IP_CONN_PORTTRIGGERING,e,null,["enable=0"]):$.act(ACT_SET,IP_CONN_PORTTRIGGERING,e,null,["enable=1"]):"ppp"==t?1==p.enable?$.act(ACT_SET,PPP_CONN_PORTTRIGGERING,e,null,["enable=0"]):$.act(ACT_SET,PPP_CONN_PORTTRIGGERING,e,null,["enable=1"]):"l2tp"==t?1==p.enable?$.act(ACT_SET,L2TP_CONN_PORTTRIGGERING,e,null,["enable=0"]):$.act(ACT_SET,L2TP_CONN_PORTTRIGGERING,e,null,["enable=1"]):"pptp"==t&&(1==p.enable?$.act(ACT_SET,PPTP_CONN_PORTTRIGGERING,e,null,["enable=0"]):$.act(ACT_SET,PPTP_CONN_PORTTRIGGERING,e,null,["enable=1"])),$.exe(function(){0==p.enable?$("#en_"+n).removeClass("disable-icon").addClass("enable-icon"):$("#en_"+n).addClass("disable-icon").removeClass("enable-icon")})}}function checkConflictOvpnPTPort(t,e){for(var n=!1,l=(t=t.toString()).split(","),o=0;o<l.length;o++){var i=l[o].split("-");if(1==i.length){if(e==i[0]){n=!0;break}}else if(2==i.length){if(i[0]>i[1]){var a=i[0];i[0]=i[1],i[1]=a}if(i[0]<=e&&i[1]>=e){n=!0;break}}}return!!n}function checkConflictOvpnPTProtocol(t,e){var n=!1;return"TCP or UDP"==t?n=!0:t==e&&(n=!0),!!n}function checkConflictPptpALGPort(t){for(var e=!1,n=(t=t.toString()).split(","),l=0;l<n.length;l++){var o=n[l].split("-");if(1==o.length){if(1723==o[0]){e=!0;break}}else if(2==o.length){if(o[0]>o[1]){var i=o[0];o[0]=o[1],o[1]=i}if(o[0]<=1723&&o[1]>=1723){e=!0;break}}}return!!e}function checkConflictFtpDataPort(t){for(var e=!1,n=(t=t.toString()).split(","),l=0;l<n.length;l++){var o=n[l].split("-");if(1==o.length){if(59990<=o[0]&&o[0]<=59999){e=!0;break}}else if(2==o.length&&!(59999<o[0]||o[1]<59990)){e=!0;break}}return!!e}function checkConflictFtpPort(t){var e=$.act(ACT_GET,FTP_SERVER,null,null,null);if(!$.exe()){if(t=t.toString(),1==e.enable&&1==e.accessFromInternet)for(var n=t.split(","),l=0;l<n.length;l++){var o=n[l].split("-");if(1==o.length){if(parseInt(o[0])==parseInt(e.portNumber))return!0}else if(2==o.length&&parseInt(o[0])<=parseInt(e.portNumber)&&parseInt(o[1])>=parseInt(e.portNumber))return!0}return!1}}function doDel(t,e){"ip"==t?$.act(ACT_DEL,IP_CONN_PORTTRIGGERING,e,null):"ppp"==t?$.act(ACT_DEL,PPP_CONN_PORTTRIGGERING,e,null):"l2tp"==t?$.act(ACT_DEL,L2TP_CONN_PORTTRIGGERING,e,null):"pptp"==t&&$.act(ACT_DEL,PPTP_CONN_PORTTRIGGERING,e,null),$.exe(function(t){t||$.loadMain("portTrigger.htm")})}function isPortStr(t){for(var e,n=0;n<t.length;n++)if(e=t.charAt(n),-1=="0123456789-,".indexOf(e))return!1;for(n=0;n<t.split(",").length;n++){if(""==t.split(",")[n])return!1;if(1!=t.split(",")[n].split("-").length&&2!=t.split(",")[n].split("-").length)return!1;if(2==t.split(",")[n].split("-").length&&""==t.split(",")[n].split("-")[0])return!1;if(2==t.split(",")[n].split("-").length&&""==t.split(",")[n].split("-")[1])return!1}return!0}function initServiceTable(){for(var t=[],e=s_str.choose,n=0;n<serviceArray.length;n++){var l=n+1;t.push([{text:l,width:"20%"},{text:serviceArray[n][0],width:"50%"},{text:"<span class='choose'>"+e+"</span>",width:"30%"}])}$.initTableBody($("#table-apply"),t),$("span.choose").click(function(){var t=$(this).parents("tr").find("td:eq(1)").text(),e=$(this).parents("tr").find("td:eq(0)").text();if(e>0&&t==serviceArray[e-1][0]){$("#t_apply").prop("value",serviceArray[e-1][0]),$("#triggerPort").prop("value",serviceArray[e-1][1]),$("#openPort").prop("value",serviceArray[e-1][2]),$("#accessDevList").fadeOut(200,function(){$("#accessDevList").removeClass("on-mask msg-container").addClass("nd")}),$("#mask").hide();var n={refresh:1};$("#external_protol option[value='TCP or UDP']").prop("selected","selected"),$("#trigger_protol option[value='TCP or UDP']").prop("selected","selected"),$("#external_protol").tpSelect(n),$("#trigger_protol").tpSelect(n)}})}function selectAll(){var t;for(t=0;t<allStk.length;t++)$("#checkbox_st").prop("data-checked")?$("#"+(t+1)).prop("checked",!0):$("#"+(t+1)).prop("checked",!1);$("#checkbox_st").prop("checked",$("#checkbox_st").prop("data-checked")),$.each($("input.checkbox-checkbox"),function(){$(this).data("tpCheckbox").refresh()})}var index=0,selAll,allStk,allStkType,portTrig_stack,portTrig_stackType,portTrig_stackIndex,param,ptAttrs={},editFlag=0,curStk=[],curType=" ",portTrigList_IP,portTrigList_PPP,portTrigList_L2TP,portTrigList_PPTP,serviceArray=[["Battle.net",6112,6112],["Dialpad",7175,"51200-51201,51210"],["ICU II",2019,"2000-2038,2050-2051,2069,2085,3010-3030"],["MSN Gaming Zone",47624,"2300-2400,28800-29000"],["PC-to-Phone",12053,"12120,12122,24150-24220"],["Quick Time 4",554,"6970-6999"],["AOE II Client",47624,"2300-2400,28800-29000"],["Sudden Strike",47624,"2300-2400"],["Baldurs Gate II",47624,"2300-2400"]];$("#t_view").click(function(){0==$("#mask").length&&$("body").append('<div id="mask" class="mask"></div>'),$("#accessDevList").fadeIn(200,function(){$("#accessDevList").removeClass("nd").addClass("on-mask msg-container"),$.setFixedCentral($("#accessDevList"))}),$("#mask").show()}),$("#closeDeviceList").click(function(){$("#accessDevList").fadeOut(200,function(){$("#accessDevList").removeClass("on-mask msg-container").addClass("nd")}),$("#mask").hide()}),$("#cancel").click(function(){editFlag=0,curType=" ";for(var t=0;t<curStk.length;t++)curStk[t]=-1;$.loadMain("portTrigger.htm")}),$("#add").click(function(){initIntf(),editFlag=2}),$("#delAll").click(function(){portTrig_stack=[],portTrig_stackType=[],portTrig_stackIndex=index;for(var t=0;t<portTrig_stackIndex;t++)portTrig_stack[t]=allStk[t],portTrig_stackType[t]=allStkType[t];for(var e=0;e<portTrig_stackIndex;e++)$("#"+(e+1)).prop("data-checked")&&("ip"==portTrig_stackType[e]?$.act(ACT_DEL,IP_CONN_PORTTRIGGERING,portTrig_stack[e],null):"ppp"==portTrig_stackType[e]?$.act(ACT_DEL,PPP_CONN_PORTTRIGGERING,portTrig_stack[e],null):"l2tp"==portTrig_stackType[e]?$.act(ACT_DEL,L2TP_CONN_PORTTRIGGERING,portTrig_stack[e],null):"pptp"==portTrig_stackType[e]&&$.act(ACT_DEL,PPTP_CONN_PORTTRIGGERING,portTrig_stack[e],null));portTrig_stackIndex>0&&$.exe(function(t){t||$.loadMain("portTrigger.htm")})}),$("#ok").click(function(){var t=$("#wanInf").data("value").split(":")[0],e=$("#wanInf").data("value").split(":")[1],n=!1,l=!1,o=!1;if(""==$("#triggerPort").prop("value")||$.num($("#triggerPort").prop("value"),!0))return $.alert(ERR_NUM_INVAD),(i=$("#triggerPort"))&&(i.focus(),i.select()),!1;if(ptAttrs.applicationName=$("#t_apply").prop("value"),ptAttrs.triggerPort=parseInt($("#triggerPort").prop("value"),10),ptAttrs.triggerProtocol=$("#trigger_protol").data("value"),ptAttrs.openProtocol=$("#external_protol").data("value"),ptAttrs.enable=$("#portTrig_en").prop("data-checked")?1:0,""==$("#openPort").prop("value")||!isPortStr($("#openPort").prop("value")))return $.alert(ERR_NUM_INVAD),(i=$("#openPort"))&&(i.focus(),i.select()),!1;if(ptAttrs.openPort=$("#openPort").prop("value"),INCLUDE_USB_FTP_SERVER){if(checkConflictFtpDataPort(ptAttrs.triggerPort)&&"UDP"!=ptAttrs.triggerProtocol)return $.alert(ERR_FTP_DATA_PORT_CONFLICT),(i=$("#triggerPort"))&&(i.focus(),i.select()),!1;if(ptAttrs.enable&&"UDP"!=ptAttrs.triggerProtocol&&checkConflictFtpPort(ptAttrs.triggerPort)&&(n=!0),checkConflictFtpDataPort(ptAttrs.openPort)&&"UDP"!=ptAttrs.openProtocol){$.alert(ERR_FTP_DATA_PORT_CONFLICT);var i=$("#openPort");return i&&(i.focus(),i.select()),!1}ptAttrs.enable&&"UDP"!=ptAttrs.openProtocol&&checkConflictFtpPort(ptAttrs.openPort)&&(n=!0)}if(INCLUDE_PPTPVPN_SERVER&&ptAttrs.enable&&checkConflictPptpALGPort(ptAttrs.openPort)&&"UDP"!=ptAttrs.openProtocol){var a=$.act(ACT_GET,PPTPVPN,null,null);$.exe(),1==a.enable&&(l=!0)}if(INCLUDE_OPENVPN_SERVER){var r=$.act(ACT_GET,OPENVPN,null,null);$.exe(),ptAttrs.enable&&checkConflictOvpnPTPort(ptAttrs.openPort,r.port)&&1==r.enable&&checkConflictOvpnPTProtocol(ptAttrs.openProtocol,r.proto)&&(o=!0)}if(n)$.confirm(c_str.forwarding_ftp_conflict,function(){if($.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]),$.exe(),2==editFlag){if(checkConflictForAllList(ptAttrs,"null"))return void $.alert(CMM_PT_RECORD_ALREADY_EXIST);"ip"==t?$.act(ACT_ADD,IP_CONN_PORTTRIGGERING,null,e,ptAttrs):"ppp"==t?$.act(ACT_ADD,PPP_CONN_PORTTRIGGERING,null,e,ptAttrs):"l2tp"==t?$.act(ACT_ADD,L2TP_CONN_PORTTRIGGERING,null,e,ptAttrs):"pptp"==t&&$.act(ACT_ADD,PPTP_CONN_PORTTRIGGERING,null,e,ptAttrs),$.exe(function(t){t||$.loadMain("portTrigger.htm")})}else if(1==editFlag){var n=curType;if(checkConflictForAllList(ptAttrs,curStk))return void $.alert(CMM_PT_RECORD_ALREADY_EXIST);wanInfName==$("#wanInf").data("text")?("ip"==n?$.act(ACT_SET,IP_CONN_PORTTRIGGERING,curStk,null,ptAttrs):"ppp"==n?$.act(ACT_SET,PPP_CONN_PORTTRIGGERING,curStk,null,ptAttrs):"l2tp"==n?$.act(ACT_SET,L2TP_CONN_PORTTRIGGERING,curStk,null,ptAttrs):"pptp"==n&&$.act(ACT_SET,PPTP_CONN_PORTTRIGGERING,curStk,null,ptAttrs),$.exe(function(t){t||$.loadMain("portTrigger.htm")})):("ip"==n?$.act(ACT_DEL,IP_CONN_PORTTRIGGERING,curStk,null):"ppp"==n?$.act(ACT_DEL,PPP_CONN_PORTTRIGGERING,curStk,null):"l2tp"==n?$.act(ACT_DEL,L2TP_CONN_PORTTRIGGERING,curStk,null):"pptp"==n&&$.act(ACT_DEL,PPTP_CONN_PORTTRIGGERING,curStk,null),$.exe(function(l){l||("ip"==t?$.act(ACT_ADD,IP_CONN_PORTTRIGGERING,null,e,ptAttrs):"ppp"==t?$.act(ACT_ADD,PPP_CONN_PORTTRIGGERING,null,e,ptAttrs):"l2tp"==t?$.act(ACT_ADD,L2TP_CONN_PORTTRIGGERING,null,e,ptAttrs):"pptp"==t&&$.act(ACT_ADD,PPTP_CONN_PORTTRIGGERING,null,e,ptAttrs),$.exe(function(t){t?(ptAttrs.triggerPort=portTrigCfg.triggerPort,ptAttrs.openPort=portTrigCfg.openPort,ptAttrs.openProtocol=portTrigCfg.openProtocol,ptAttrs.enable=portTrigCfg.enable,"ip"==n?$.act(ACT_ADD,IP_CONN_PORTTRIGGERING,null,pStk,ptAttrs):"ppp"==n?$.act(ACT_ADD,PPP_CONN_PORTTRIGGERING,null,pStk,ptAttrs):"l2tp"==n?$.act(ACT_ADD,L2TP_CONN_PORTTRIGGERING,null,pStk,ptAttrs):"pptp"==n&&$.act(ACT_ADD,PPTP_CONN_PORTTRIGGERING,null,pStk,ptAttrs),$.exe(function(t){t||$.loadMain("portTrigger.htm")})):$.loadMain("portTrigger.htm")}))}))}});else{if(l)return $.alert(CMM_PVPN_PORT_CONFLICT_WITH_PT),void $.exe(function(){0==ptAttrs.enable?$("#en_"+index).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+index).removeClass("disable-icon").addClass("enable-icon")});if(o)return $.alert(CMM_OVPN_PORT_CONFLICT_WITH_PT),void $.exe(function(){0==ptAttrs.enable?$("#en_"+index).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+index).removeClass("disable-icon").addClass("enable-icon")});if(2==editFlag){if(checkConflictForAllList(ptAttrs,"null"))return void $.alert(CMM_PT_RECORD_ALREADY_EXIST);"ip"==t?$.act(ACT_ADD,IP_CONN_PORTTRIGGERING,null,e,ptAttrs):"ppp"==t?$.act(ACT_ADD,PPP_CONN_PORTTRIGGERING,null,e,ptAttrs):"l2tp"==t?$.act(ACT_ADD,L2TP_CONN_PORTTRIGGERING,null,e,ptAttrs):"pptp"==t&&$.act(ACT_ADD,PPTP_CONN_PORTTRIGGERING,null,e,ptAttrs),$.exe(function(t){t||$.loadMain("portTrigger.htm")})}else if(1==editFlag){var p=curType;if(checkConflictForAllList(ptAttrs,curStk))return void $.alert(CMM_PT_RECORD_ALREADY_EXIST);wanInfName==$("#wanInf").data("text")?("ip"==p?$.act(ACT_SET,IP_CONN_PORTTRIGGERING,curStk,null,ptAttrs):"ppp"==p?$.act(ACT_SET,PPP_CONN_PORTTRIGGERING,curStk,null,ptAttrs):"l2tp"==p?$.act(ACT_SET,L2TP_CONN_PORTTRIGGERING,curStk,null,ptAttrs):"pptp"==p&&$.act(ACT_SET,PPTP_CONN_PORTTRIGGERING,curStk,null,ptAttrs),$.exe(function(t){t||$.loadMain("portTrigger.htm")})):("ip"==p?$.act(ACT_DEL,IP_CONN_PORTTRIGGERING,curStk,null):"ppp"==p?$.act(ACT_DEL,PPP_CONN_PORTTRIGGERING,curStk,null):"l2tp"==p?$.act(ACT_DEL,L2TP_CONN_PORTTRIGGERING,curStk,null):"pptp"==p&&$.act(ACT_DEL,PPTP_CONN_PORTTRIGGERING,curStk,null),$.exe(function(n){n||("ip"==t?$.act(ACT_ADD,IP_CONN_PORTTRIGGERING,null,e,ptAttrs):"ppp"==t?$.act(ACT_ADD,PPP_CONN_PORTTRIGGERING,null,e,ptAttrs):"l2tp"==t?$.act(ACT_ADD,L2TP_CONN_PORTTRIGGERING,null,e,ptAttrs):"pptp"==t&&$.act(ACT_ADD,PPTP_CONN_PORTTRIGGERING,null,e,ptAttrs),$.exe(function(t){t?(ptAttrs.triggerPort=portTrigCfg.triggerPort,ptAttrs.openPort=portTrigCfg.openPort,ptAttrs.openProtocol=portTrigCfg.openProtocol,ptAttrs.enable=portTrigCfg.enable,"ip"==p?$.act(ACT_ADD,IP_CONN_PORTTRIGGERING,null,pStk,ptAttrs):"ppp"==p?$.act(ACT_ADD,PPP_CONN_PORTTRIGGERING,null,pStk,ptAttrs):"l2tp"==p?$.act(ACT_ADD,L2TP_CONN_PORTTRIGGERING,null,pStk,ptAttrs):"pptp"==p&&$.act(ACT_ADD,PPTP_CONN_PORTTRIGGERING,null,pStk,ptAttrs),$.exe(function(t){t||$.loadMain("portTrigger.htm")})):$.loadMain("portTrigger.htm")}))}))}}})</script>

<h3 id="et">Port Triggering</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span id="add" class="add-icon"></span>
                <label class="T_add">Add</label>
                <span id="delAll" class="delete-all-icon"></span>
                <label class="T_del">Delete</label>
            </div>
        </div>
        <table id="table-triggering">
            <thead></thead>
            <tbody id="body-triggering">
                <tr id="edit-container-triggering" class="nd">
                    <td colspan="9">
                        <div class="nd">
                            <b class="T_intfname tr-m">Interface Name: </b>
                            <select class="xl" id="wanInf">
                            </select>
                        </div>
                        <div>
                            <b class="T_app tr-m">Application: </b>
                            <input class="xl" type="text" maxlength="15" oninput="$.maxlength(this)" id="t_apply">
                            <button type="submit" class="green T_scan2 l_auto" id="t_view">Scan</button>
                        </div>
                        <div>
                            <b class="T_c_triggerport tr-m">Trigger Port: </b>
                            <input class="xl" type="text" id="triggerPort">
                            <span id="t_exrange">(XX, 1-65535)</span>
                        </div>
                        <div>
                            <b class="T_c_triggerproto tr-m">Trigger Protocol: </b>
                            <select class="xl" id="trigger_protol">
                                <option id="trigTCP" value="TCP">TCP</option>
                                <option id="trigUDP" value="UDP">UDP</option>
                                <option id="trigALL" class="T_all" value="TCP or UDP">ALL</option>
                            </select>
                        </div>
                        <div>
                            <b class="T_exterport tr-m">External Port: </b>
                            <input class="xl" type="text" id="openPort">
                            <div class="textbox-tips">
                                <span id="t_oprange">(XX or XX-XX, 1-65535, at most 5 pairs)</span>
                            </div>
                        </div>
                        <div>
                            <b class="T_c_exterproto tr-m">External Protocol: </b>
                            <select class="xl" id="external_protol">
                                <option id="openTCP" value="TCP">TCP</option>
                                <option id="openUDP" value="UDP">UDP</option>
                                <option id="openALL" class="T_all" value="TCP or UDP">ALL</option>
                            </select>
                        </div>
                        <div>
                            <b></b>
                            <input type="checkbox" id="portTrig_en" checked="checked">
                            <label class="T_enthisentry">Enable this Entry</label>
                        </div>
                        <div class="inline-btn-right">
                            <button type="submit" class="green T_cancel" id="cancel">Cancel</button>
                            <button type="submit" class="green T_save" id="ok">Save</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</div>
<div>
    <form class="pure-form pure-form-aligned">
        <div id="accessDevList" class="nd">
            <div id="closeDeviceList" class="table-op">
                <div class="panel-title">
                    <span id="t_existApp"></span>
                </div>
                <div class="table-btn">
                    <span class="close-icon table-icon"></span>
                </div>
            </div>
            <table id="table-apply">
                <thead></thead>
                <tbody id="bodyAccessDevicesList">
                </tbody>
            </table>
        </div>
    </form>
</div>
<script language="javascript">var headArray=[{text:'<div><input type="checkbox" id="checkbox_st" class="table-select-all" /><label></label></div>',width:"5%"},{text:table_str.id,width:"5%"},{text:table_str.application,width:"15%"},{text:table_str.triggerport,width:"15%"},{text:table_str.triggerproto,width:"10%"},{text:table_str.exterport,width:"20%"},{text:table_str.exterproto,width:"10%"},{text:table_str.status,width:"10%"},{text:table_str.modify,width:"10%"}],AccessDevicesListHeadArray=[{text:table_str.id,width:"20%"},{text:table_str.appname,width:"50%"},{text:table_str.operation,width:"30%"}];$.initTableHead($("#table-triggering"),headArray),$("#table-triggering").tpTable(initTable),$.initTableHead($("#table-apply"),AccessDevicesListHeadArray),$("#table-apply").tpTable(initServiceTable),$.tpInit()</script>
