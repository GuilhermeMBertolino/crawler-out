<script>function initIntf(){var t=$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);if(INCLUDE_WAN_MODE)if(INCLUDE_3G4G_BACKUP)e=$.act(ACT_GET,SYS_MODE,null,null,["mode","lteBackupEnable"]);else var e=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);if(INCLUDE_USB_3G_DONGLE)var n=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"]);if(INCLUDE_IPV6){var l=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType","X_TP_IPv4Enabled"]),a=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","X_TP_IPv4Enabled","transportType"]);INCLUDE_L2TP&&(wanL2TPList=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"])),INCLUDE_PPTP&&(wanPPTPList=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"]))}else{var l=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType"]),a=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","transportType"]);INCLUDE_L2TP&&(wanL2TPList=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"])),INCLUDE_PPTP&&(wanPPTPList=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"]))}if(!$.exe()){wanInfName=t.__ifAliasName;var r;INCLUDE_WAN_MODE&&(r=e.mode);var i=0;INCLUDE_USB_3G_DONGLE&&$.each(n,function(){if(1==this.enable)return i=this.backupEnable,!1});for(var P=0,o=0;o<l.length;o++)if(1==l[o].NATEnabled&&"IP_Routed"==l[o].connectionType&&(1==l[o].enable&&(!INCLUDE_IPV6||1==l[o].X_TP_IPv4Enabled)||INCLUDE_3G4G_BACKUP&&"ETH"==e.mode&&1==e.lteBackupEnable&&"LTE"==l[o].name)){var p=l[o].name,_="ip:"+l[o].__stack;$("#wanInf").append("<option value='"+_+"' text='"+p+"' >"+p+"</option>"),P=1}for(c=0;c<a.length;c++)if(!(1!=a[c].NATEnabled||1!=a[c].enable&&("PPP3G"!=a[c].transportType||"USB_3G"!=r&&1!=i)||INCLUDE_IPV6&&1!=a[c].X_TP_IPv4Enabled)){var p=a[c].name,_="ppp:"+a[c].__stack;$("#wanInf").append("<option value='"+_+"' text='"+p+"' >"+p+"</option>"),P=1}if(INCLUDE_L2TP)for(c=0;c<wanL2TPList.length;c++)if(1==wanL2TPList[c].enable){var p=wanL2TPList[c].name,_="l2tp:"+wanL2TPList[c].__stack;$("#wanInf").append("<option value='"+_+"' text='"+p+"' >"+p+"</option>"),P=1}if(INCLUDE_PPTP)for(var c=0;c<wanPPTPList.length;c++)if(1==wanPPTPList[c].enable){var p=wanPPTPList[c].name,_="pptp:"+wanPPTPList[c].__stack;$("#wanInf").append("<option value='"+_+"' text='"+p+"' >"+p+"</option>"),P=1}if(0==P){var p=s_str.nointf,_="";$("#wanInf").append("<option value='"+_+"' text='"+p+"' >"+p+"</option>"),$("#ok").prop("disabled",!0)}$("#wanInf").find("option[text="+wanInfName+"]").prop("selected","selected");var s={refresh:1};$("#wanInf").tpSelect(s)}}function doEdit(t,e){editFlag=1,curType=t,curStk=e;var n;$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);if(INCLUDE_WAN_MODE)if(INCLUDE_3G4G_BACKUP)l=$.act(ACT_GET,SYS_MODE,null,null,["mode","lteBackupEnable"]);else var l=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);if(INCLUDE_USB_3G_DONGLE)var a=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"]);if(INCLUDE_IPV6){var r=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType","X_TP_IPv4Enabled"]),i=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","X_TP_IPv4Enabled","transportType"]);INCLUDE_L2TP&&(wanL2TPList=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"])),INCLUDE_PPTP&&(wanPPTPList=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"]))}else{var r=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType"]),i=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","transportType"]);INCLUDE_L2TP&&(wanL2TPList=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"])),INCLUDE_PPTP&&(wanPPTPList=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"]))}if(!$.exe()){if(pStk=e[0]+","+e[1]+","+e[2]+",0,0,0","ip"==t?(vtlServCfg=$.act(ACT_GET,WAN_IP_CONN_PORTMAPPING,e,null,["portMappingEnabled","externalPort","X_TP_ExternalPortEnd","portMappingProtocol","internalPort","X_TP_InternalPortEnd","internalClient","serviceName"]),n=$.act(ACT_GET,WAN_IP_CONN,pStk,null,["name"])):"ppp"==t?(vtlServCfg=$.act(ACT_GET,WAN_PPP_CONN_PORTMAPPING,e,null,["portMappingEnabled","externalPort","X_TP_ExternalPortEnd","portMappingProtocol","internalPort","X_TP_InternalPortEnd","internalClient","serviceName"]),n=$.act(ACT_GET,WAN_PPP_CONN,pStk,null,["name"])):"l2tp"==t?(vtlServCfg=$.act(ACT_GET,WAN_L2TP_CONN_PORTMAPPING,e,null,["portMappingEnabled","externalPort","externalPortEnd","portMappingProtocol","internalPort","internalPortEnd","internalClient","serviceName"]),n=$.act(ACT_GET,WAN_L2TP_CONN,pStk,null,["name"])):"pptp"==t&&(vtlServCfg=$.act(ACT_GET,WAN_PPTP_CONN_PORTMAPPING,e,null,["portMappingEnabled","externalPort","externalPortEnd","portMappingProtocol","internalPort","internalPortEnd","internalClient","serviceName"]),n=$.act(ACT_GET,WAN_PPTP_CONN,pStk,null,["name"])),!$.exe()){if(wanInfName=n.name,"l2tp"==t||"pptp"==t){if(vtlServCfg.externalPort==vtlServCfg.externalPortEnd)$("#applyPort").prop("value",vtlServCfg.externalPort);else{P=vtlServCfg.externalPort+"-"+vtlServCfg.externalPortEnd;$("#applyPort").prop("value",P)}if($("#ipAddr").tpAddress("val",vtlServCfg.internalClient),vtlServCfg.internalPort==vtlServCfg.externalPort&&vtlServCfg.internalPortEnd==vtlServCfg.externalPortEnd&&vtlServCfg.internalPort!=vtlServCfg.internalPortEnd)$("#interPort").prop("value","");else if(vtlServCfg.internalPort==vtlServCfg.internalPortEnd)$("#interPort").prop("value",vtlServCfg.internalPort);else{P=vtlServCfg.internalPort+"-"+vtlServCfg.internalPortEnd;$("#interPort").prop("value",P)}}else{if(vtlServCfg.externalPort==vtlServCfg.X_TP_ExternalPortEnd)$("#applyPort").prop("value",vtlServCfg.externalPort);else{P=vtlServCfg.externalPort+"-"+vtlServCfg.X_TP_ExternalPortEnd;$("#applyPort").prop("value",P)}if($("#ipAddr").tpAddress("val",vtlServCfg.internalClient),vtlServCfg.internalPort==vtlServCfg.externalPort&&vtlServCfg.X_TP_InternalPortEnd==vtlServCfg.X_TP_ExternalPortEnd&&vtlServCfg.internalPort!=vtlServCfg.X_TP_InternalPortEnd)$("#interPort").prop("value","");else if(vtlServCfg.internalPort==vtlServCfg.X_TP_InternalPortEnd)$("#interPort").prop("value",vtlServCfg.internalPort);else{var P=vtlServCfg.internalPort+"-"+vtlServCfg.X_TP_InternalPortEnd;$("#interPort").prop("value",P)}}$("#serName").prop("value",$.encodeHtml(vtlServCfg.serviceName)),"TCP"==vtlServCfg.portMappingProtocol?$("#protol option[value='TCP']").prop("selected","selected"):"UDP"==vtlServCfg.portMappingProtocol?$("#protol option[value='UDP']").prop("selected","selected"):"TCP or UDP"==vtlServCfg.portMappingProtocol&&$("#protol option[value='TCP or UDP']").prop("selected","selected");T={refresh:1};$("#protol").tpSelect(T),1==vtlServCfg.portMappingEnabled?$("#vtlServ_en").prop("checked","checked"):$("#vtlServ_en").prop("checked",!1),$("#vtlServ_en").tpCheckbox()}var o;INCLUDE_WAN_MODE&&(o=l.mode);var p=0;INCLUDE_USB_3G_DONGLE&&$.each(a,function(){if(1==this.enable)return p=this.backupEnable,!1});for(var _=0,c=0;c<r.length;c++)if(1==r[c].NATEnabled&&"IP_Routed"==r[c].connectionType&&(1==r[c].enable&&(!INCLUDE_IPV6||1==r[c].X_TP_IPv4Enabled)||INCLUDE_3G4G_BACKUP&&"ETH"==l.mode&&1==l.lteBackupEnable&&"LTE"==r[c].name)){var s=r[c].name,d="ip:"+r[c].__stack;$("#wanInf").append("<option value='"+d+"' text='"+s+"' >"+s+"</option>"),_=1}for(N=0;N<i.length;N++)if(!(1!=i[N].NATEnabled||1!=i[N].enable&&("PPP3G"!=i[N].transportType||"USB_3G"!=o&&1!=p)||INCLUDE_IPV6&&1!=i[N].X_TP_IPv4Enabled)){var s=i[N].name,d="ppp:"+i[N].__stack;$("#wanInf").append("<option value='"+d+"' text='"+s+"' >"+s+"</option>"),_=1}if(INCLUDE_L2TP)for(N=0;N<wanL2TPList.length;N++)if(1==wanL2TPList[N].enable){var s=wanL2TPList[N].name,d="l2tp:"+wanL2TPList[N].__stack;$("#wanInf").append("<option value='"+d+"' text='"+s+"' >"+s+"</option>"),_=1}if(INCLUDE_PPTP)for(var N=0;N<wanPPTPList.length;N++)if(1==wanPPTPList[N].enable){var s=wanPPTPList[N].name,d="pptp:"+wanPPTPList[N].__stack;$("#wanInf").append("<option value='"+d+"' text='"+s+"' >"+s+"</option>"),_=1}if(0==_){var s=s_str.nointf,d="";$("#wanInf").append("<option value='"+d+"' text='"+s+"' >"+s+"</option>"),$("#ok").prop("disabled",!0)}$("#wanInf").find("option[text="+wanInfName+"]").prop("selected","selected");var T={refresh:1};$("#wanInf").tpSelect(T)}}function doEnable(t,e,n){var l=!1,a=!1,r=!1;if(INCLUDE_PPTPVPN_SERVER)var i=$.act(ACT_GET,PPTPVPN,null,null);if(INCLUDE_OPENVPN_SERVER)var P=$.act(ACT_GET,OPENVPN,null,null);if("ip"==t){o=$.act(ACT_GET,WAN_IP_CONN_PORTMAPPING,e,null,null);$.exe(),INCLUDE_USB_FTP_SERVER&&checkConflictFtpPort(o.externalPort,o.X_TP_ExternalPortEnd)&&"UDP"!=o.portMappingProtocol&&(l=!0),INCLUDE_PPTPVPN_SERVER&&checkConflictPptpALGPort(o.externalPort,o.X_TP_ExternalPortEnd)&&"UDP"!=o.portMappingProtocol&&0==o.portMappingEnabled&&1==i.enable&&(a=!0),INCLUDE_OPENVPN_SERVER&&checkConflictOvpnVSPort(o.externalPort,o.X_TP_ExternalPortEnd,P.port)&&checkConflictOvpnVSProtocol(o.portMappingProtocol,P.proto)&&0==o.portMappingEnabled&&1==P.enable&&(r=!0)}else if("ppp"==t){o=$.act(ACT_GET,WAN_PPP_CONN_PORTMAPPING,e,null,null);$.exe(),INCLUDE_USB_FTP_SERVER&&checkConflictFtpPort(o.externalPort,o.X_TP_ExternalPortEnd)&&"UDP"!=o.portMappingProtocol&&(l=!0),INCLUDE_PPTPVPN_SERVER&&checkConflictPptpALGPort(o.externalPort,o.X_TP_ExternalPortEnd)&&"UDP"!=o.portMappingProtocol&&0==o.portMappingEnabled&&1==i.enable&&(a=!0),INCLUDE_OPENVPN_SERVER&&checkConflictOvpnVSPort(o.externalPort,o.X_TP_ExternalPortEnd,P.port)&&checkConflictOvpnVSProtocol(o.portMappingProtocol,P.proto)&&0==o.portMappingEnabled&&1==P.enable&&(r=!0)}else if("l2tp"==t){o=$.act(ACT_GET,WAN_L2TP_CONN_PORTMAPPING,e,null,null);$.exe(),INCLUDE_USB_FTP_SERVER&&checkConflictFtpPort(o.externalPort,o.externalPortEnd)&&"UDP"!=o.portMappingProtocol&&(l=!0),INCLUDE_PPTPVPN_SERVER&&checkConflictPptpALGPort(o.externalPort,o.externalPortEnd)&&"UDP"!=o.portMappingProtocol&&0==o.portMappingEnabled&&1==i.enable&&(a=!0),INCLUDE_OPENVPN_SERVER&&checkConflictOvpnVSPort(o.externalPort,o.externalPortEnd,P.port)&&checkConflictOvpnVSProtocol(o.portMappingProtocol,P.proto)&&0==o.portMappingEnabled&&1==P.enable&&(r=!0)}else if("pptp"==t){var o=$.act(ACT_GET,WAN_PPTP_CONN_PORTMAPPING,e,null,null);$.exe(),INCLUDE_USB_FTP_SERVER&&checkConflictFtpPort(o.externalPort,o.externalPortEnd)&&"UDP"!=o.portMappingProtocol&&(l=!0),INCLUDE_PPTPVPN_SERVER&&checkConflictPptpALGPort(o.externalPort,o.externalPortEnd)&&"UDP"!=o.portMappingProtocol&&0==o.portMappingEnabled&&1==i.enable&&(a=!0),INCLUDE_OPENVPN_SERVER&&checkConflictOvpnVSPort(o.externalPort,o.externalPortEnd,P.port)&&checkConflictOvpnVSProtocol(o.portMappingProtocol,P.proto)&&0==o.portMappingEnabled&&1==P.enable&&(r=!0)}if(l)INCLUDE_USB_FTP_SERVER&&$.confirm(c_str.forwarding_ftp_conflict,function(){$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]),$.exe(),"ip"==t?0==o.portMappingEnabled?$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==o.portMappingEnabled&&$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"ppp"==t?0==o.portMappingEnabled?$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==o.portMappingEnabled&&$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"l2tp"==t?0==o.portMappingEnabled?$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==o.portMappingEnabled&&$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"pptp"==t&&(0==o.portMappingEnabled?$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==o.portMappingEnabled&&$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"])),$.exe(function(t){0==o.portMappingEnabled?$("#en_"+n).removeClass("disable-icon").addClass("enable-icon"):$("#en_"+n).addClass("disable-icon").removeClass("enable-icon")})},function(){1==o.portMappingEnabled?$("#en_"+n).removeClass("disable-icon").addClass("enable-icon"):$("#en_"+n).addClass("disable-icon").removeClass("enable-icon")});else{if(a)return $.alert(CMM_PVPN_PORT_CONFLICT_WITH_VS),void $.exe(function(){0==o.portMappingEnabled?$("#en_"+n).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+n).removeClass("disable-icon").addClass("enable-icon")});if(r)return $.alert(CMM_OVPN_PORT_CONFLICT_WITH_VS),void $.exe(function(){0==o.portMappingEnabled?$("#en_"+n).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+n).removeClass("disable-icon").addClass("enable-icon")});"ip"==t?0==o.portMappingEnabled?$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==o.portMappingEnabled&&$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"ppp"==t?0==o.portMappingEnabled?$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==o.portMappingEnabled&&$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"l2tp"==t?0==o.portMappingEnabled?$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==o.portMappingEnabled&&$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"]):"pptp"==t&&(0==o.portMappingEnabled?$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,e,null,["portMappingEnabled=1"]):1==o.portMappingEnabled&&$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,e,null,["portMappingEnabled=0"])),$.exe(function(t){0==o.portMappingEnabled?$("#en_"+n).removeClass("disable-icon").addClass("enable-icon"):$("#en_"+n).addClass("disable-icon").removeClass("enable-icon")})}}function checkEntryConflict(t,e){if(t.portMappingProtocol!=e.portMappingProtocol&&"TCP or UDP"!=t.portMappingProtocol&&"TCP or UDP"!=e.portMappingProtocol)return!1;var n=e.X_TP_ExternalPortEnd?e.X_TP_ExternalPortEnd:e.externalPortEnd,l=t.X_TP_ExternalPortEnd?t.X_TP_ExternalPortEnd:t.externalPortEnd;return!(n<t.externalPort||e.externalPort>l)}function checkConflictForAllList(t,e){var n=!1;return $.each(vtlServList_IP,function(){if(e!=this.__stack&&checkEntryConflict(t,this))return n=!0}),!!n||($.each(vtlServList_PPP,function(){if(e!=this.__stack&&checkEntryConflict(t,this))return n=!0}),!!n||($.each(vtlServList_L2TP,function(){if(e!=this.__stack&&checkEntryConflict(t,this))return n=!0}),!!n||($.each(vtlServList_PPTP,function(){if(e!=this.__stack&&checkEntryConflict(t,this))return n=!0}),!!n)))}function doDel(t,e){"ip"==t?$.act(ACT_DEL,WAN_IP_CONN_PORTMAPPING,e,null):"ppp"==t?$.act(ACT_DEL,WAN_PPP_CONN_PORTMAPPING,e,null):"l2tp"==t?$.act(ACT_DEL,WAN_L2TP_CONN_PORTMAPPING,e,null):"pptp"==t&&$.act(ACT_DEL,WAN_PPTP_CONN_PORTMAPPING,e,null),$.exe(function(t){t||$.loadMain("virtualServer.htm")})}function isPort(t,e){var n,l;if("applyPort"==e)l="0123456789-";else if("interPort"==e){if(""==t)return!0;l="0123456789"}for(var a=0;a<t.length;a++)if(n=t.charAt(a),-1==l.indexOf(n))return!1;return(1==t.split("-").length||2==t.split("-").length)&&((2!=t.split("-").length||""!=t.split("-")[0])&&(2!=t.split("-").length||""!=t.split("-")[1]))}function checkConflictPptpALGPort(t,e){var n=!1;return 0==e?1723==t&&(n=!0):0==t?1723==e&&(n=!0):t<=1723&&e>=1723&&(n=!0),!!n}function checkConflictOvpnVSPort(t,e,n){var l=!1;return 0==e?n==t&&(l=!0):0==t?n==e&&(l=!0):t<=n&&e>=n&&(l=!0),!!l}function checkConflictOvpnVSProtocol(t,e){var n=!1;return"TCP or UDP"==t?n=!0:t==e&&(n=!0),!!n}function checkConflictFtpDataPort(t,e){var n=!1;return 0==e?59990<=t&&t<=59999&&(n=!0):0==t?59990<=e&&e<=59999&&(n=!0):59999<t||e<59990||(n=!0),!!n&&($.alert(ERR_FTP_DATA_PORT_CONFLICT),!0)}function checkConflictFtpPort(t,e){var n=$.act(ACT_GET,FTP_SERVER,null,null,null);if(!$.exe()){if(1==n.enable&&1==n.accessFromInternet)if(0==t){if(n.portNumber==e)return!0}else if(0==e){if(n.portNumber==t)return!0}else if(t<=n.portNumber&&n.portNumber<=e)return!0;return!1}}function initTable(){selAll=0,index=0,param=[],allStk=[],allStkType=[],vtlServ_param=[],vtlServ_stack=[],vtlServ_stackType=[],vtlServ_stackIndex=0;var t,e=new Array;if(vtlServList_IP=$.act(ACT_GL,WAN_IP_CONN_PORTMAPPING,null,null),vtlServList_PPP=$.act(ACT_GL,WAN_PPP_CONN_PORTMAPPING,null,null),INCLUDE_USB_3G_DONGLE)var n=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"]);if(INCLUDE_L2TP&&(vtlServList_L2TP=$.act(ACT_GL,WAN_L2TP_CONN_PORTMAPPING,null,null)),INCLUDE_PPTP&&(vtlServList_PPTP=$.act(ACT_GL,WAN_PPTP_CONN_PORTMAPPING,null,null)),INCLUDE_WAN_MODE){if(INCLUDE_3G4G_BACKUP)l=$.act(ACT_GET,SYS_MODE,null,null,["mode","lteBackupEnable"]);else if(INCLUDE_USB_3G_BACKUP&&INCLUDE_EWAN_BACKUP)l=$.act(ACT_GET,SYS_MODE,null,null,["mode","usb3gBackup","ewanBackup"]);else var l=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"])}$.exe(function(a){if(!a){var r=0;if(INCLUDE_USB_3G_DONGLE&&$.each(n,function(){if(1==this.enable)return r=this.backupEnable,!1}),INCLUDE_WAN_MODE){"ETH"==l.mode||l.mode,1==l.lteBackupEnable&&l.mode;INCLUDE_USB_3G_BACKUP&&INCLUDE_EWAN_BACKUP&&(l.ewanBackup,r=l.usb3gBackup)}return $.each(vtlServList_IP,function(){t=this.__stack.split(",")[0]+","+this.__stack.split(",")[1]+","+this.__stack.split(",")[2]+",0,0,0";var n=$.act(ACT_GET,WAN_IP_CONN,t,null,["name"]),l=0;if(INCLUDE_WAN_MODE)$.act(ACT_GET,SYS_MODE,null,null,["mode"]),$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);$.exe()||(l=1),index++;var a="["+this.__stack+"]",r=0,i=0;r=0!=this.externalPort&&0==this.X_TP_ExternalPortEnd?this.externalPort:0==this.externalPort&&0!=this.X_TP_ExternalPortEnd?this.X_TP_ExternalPortEnd:this.externalPort==this.X_TP_ExternalPortEnd?this.externalPort:this.externalPort+"-"+this.X_TP_ExternalPortEnd,i=0!=this.internalPort&&0==this.X_TP_InternalPortEnd?this.internalPort:0==this.internalPort&&0!=this.X_TP_InternalPortEnd?this.X_TP_InternalPortEnd:this.internalPort==this.X_TP_InternalPortEnd?this.internalPort:this.internalPort+"-"+this.X_TP_InternalPortEnd,1==l&&n.name,allStk[index-1]=this.__stack,allStkType[index-1]="ip",1==this.portMappingEnabled?e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:r,width:"10%"},{text:this.internalClient,width:"20%"},{text:i,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"ip\", "+a+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ip\", "+a+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ip\", "+a+");'></span>",width:"10%"}]):e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:r,width:"10%"},{text:this.internalClient,width:"20%"},{text:i,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"ip\", "+a+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ip\", "+a+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ip\", "+a+");'></span>",width:"10%"}])}),$.each(vtlServList_PPP,function(){t=this.__stack.split(",")[0]+","+this.__stack.split(",")[1]+","+this.__stack.split(",")[2]+",0,0,0";var n=$.act(ACT_GET,WAN_PPP_CONN,t,null,["name"]),l=0;if(INCLUDE_WAN_MODE)$.act(ACT_GET,SYS_MODE,null,null,["mode"]),$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);$.exe()||(l=1),index++;var a="["+this.__stack+"]",r=0,i=0;r=0!=this.externalPort&&0==this.X_TP_ExternalPortEnd?this.externalPort:0==this.externalPort&&0!=this.X_TP_ExternalPortEnd?this.X_TP_ExternalPortEnd:this.externalPort==this.X_TP_ExternalPortEnd?this.externalPort:this.externalPort+"-"+this.X_TP_ExternalPortEnd,i=0!=this.internalPort&&0==this.X_TP_InternalPortEnd?this.internalPort:0==this.internalPort&&0!=this.X_TP_InternalPortEnd?this.X_TP_InternalPortEnd:this.internalPort==this.X_TP_InternalPortEnd?this.internalPort:this.internalPort+"-"+this.X_TP_InternalPortEnd,1==l&&n.name,allStk[index-1]=this.__stack,allStkType[index-1]="ppp",1==this.portMappingEnabled?e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:r,width:"10%"},{text:this.internalClient,width:"20%"},{text:i,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"ppp\", "+a+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ppp\", "+a+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ppp\", "+a+");'></span>",width:"10%"}]):e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:r,width:"10%"},{text:this.internalClient,width:"20%"},{text:i,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"ppp\", "+a+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ppp\", "+a+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ppp\", "+a+");'></span>",width:"10%"}])}),INCLUDE_L2TP&&$.each(vtlServList_L2TP,function(){t=this.__stack.split(",")[0]+","+this.__stack.split(",")[1]+","+this.__stack.split(",")[2]+",0,0,0";var n=$.act(ACT_GET,WAN_L2TP_CONN,t,null,["name"]),l=0;$.exe()||(l=1);var a="["+this.__stack+"]";index++;var r=0,i=0;r=0!=this.externalPort&&0==this.externalPortEnd?this.externalPort:0==this.externalPort&&0!=this.externalPortEnd?this.externalPortEnd:this.externalPort==this.externalPortEnd?this.externalPort:this.externalPort+"-"+this.externalPortEnd,i=0!=this.internalPort&&0==this.internalPortEnd?this.internalPort:0==this.internalPort&&0!=this.internalPortEnd?this.internalPortEnd:this.internalPort==this.internalPortEnd?this.internalPort:this.internalPort+"-"+this.internalPortEnd,1==l&&n.name,allStk[index-1]=this.__stack,allStkType[index-1]="l2tp",1==this.portMappingEnabled?e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:r,width:"10%"},{text:this.internalClient,width:"20%"},{text:i,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"l2tp\", "+a+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"l2tp\", "+a+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"l2tp\", "+a+");'></span>",width:"10%"}]):e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:r,width:"10%"},{text:this.internalClient,width:"20%"},{text:i,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"l2tp\", "+a+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"l2tp\", "+a+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"l2tp\", "+a+");'></span>",width:"10%"}])}),INCLUDE_PPTP&&$.each(vtlServList_PPTP,function(){t=this.__stack.split(",")[0]+","+this.__stack.split(",")[1]+","+this.__stack.split(",")[2]+",0,0,0";var n=$.act(ACT_GET,WAN_PPTP_CONN,t,null,["name"]),l=0;$.exe()||(l=1);var a="["+this.__stack+"]";index++;var r=0,i=0;r=0!=this.externalPort&&0==this.externalPortEnd?this.externalPort:0==this.externalPort&&0!=this.externalPortEnd?this.externalPortEnd:this.externalPort==this.externalPortEnd?this.externalPort:this.externalPort+"-"+this.externalPortEnd,i=0!=this.internalPort&&0==this.internalPortEnd?this.internalPort:0==this.internalPort&&0!=this.internalPortEnd?this.internalPortEnd:this.internalPort==this.internalPortEnd?this.internalPort:this.internalPort+"-"+this.internalPortEnd,1==l&&n.name,1==this.portMappingEnabled?e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:r,width:"10%"},{text:this.internalClient,width:"20%"},{text:i,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"pptp\", "+a+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"pptp\", "+a+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"pptp\", "+a+");'></span>",width:"10%"}]):e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one"/><label></label></div></span>',width:"5%"},{text:index,width:"5%"},{text:$.htmlEncodeStr(this.serviceName),width:"20%"},{text:r,width:"10%"},{text:this.internalClient,width:"20%"},{text:i,width:"10%"},{text:this.portMappingProtocol,width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"pptp\", "+a+", "+index+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"pptp\", "+a+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"pptp\", "+a+");'></span>",width:"10%"}]),allStk[index-1]=this.__stack,allStkType[index-1]="pptp"}),$.initTableBody($("#table-virtual"),e),e}})}function initServiceTable(){for(var t=new Array,e=0;e<serviceArray.length;e++){var n=e+1;t.push([{text:n,width:"30%"},{text:serviceArray[e][0],width:"40%"},{text:"<span class='choose' >"+s_str.choose+"</span>",width:"30%"}])}$.initTableBody($("#table-service"),t),$("span.choose").click(function(){var t=$(this).parents("tr").find("td:eq(1)").text(),e=$(this).parents("tr").find("td:eq(0)").text();if(e>0&&t==serviceArray[e-1][0]){$("#serName").prop("value",serviceArray[e-1][0]),$("#applyPort").prop("value",serviceArray[e-1][1]),$("#interPort").prop("value",serviceArray[e-1][2]),$("#accessDevList").fadeOut(200,function(){$("#accessDevList").removeClass("on-mask msg-container").addClass("nd")}),"DNS"==t?$("#protol option[value='TCP or UDP']").prop("selected","selected"):$("#protol option[value='TCP']").prop("selected","selected");var n={refresh:1};$("#protol").tpSelect(n),$("#mask").hide()}})}function selectAll(){var t;for(t=0;t<allStk.length;t++)$("#checkbox_st").prop("data-checked")?$("#"+(t+1)).prop("checked",!0):$("#"+(t+1)).prop("checked",!1);$("#checkbox_st").prop("checked",$("#checkbox_st").prop("data-checked")),$.each($("input.checkbox-checkbox"),function(){$(this).data("tpCheckbox").refresh()})}var selAll,curIndex=-1,addIndex=-1,allStk,allStkType,vtlServ_stack,vtlServ=[],vtlServ_stackIndex,param,editFlag=0,curStk=[],curType=" ",vtlServList_IP=[],vtlServList_PPP=[],wanL2TPList=[],wanPPTPList=[],vtlServList_L2TP=[],vtlServList_PPTP=[],serviceArray=new Array(["DNS",53,53],["FTP",21,21],["GOPHER",70,70],["HTTP",80,80],["NNTP",119,119],["POP3",110,110],["SMTP",25,25],["SOCK",1080,1080],["TELNET",23,23]);$("#view").click(function(){0==$("#mask").length&&$("body").append('<div id="mask" class="mask"></div>'),$("#accessDevList").fadeIn(200,function(){$("#accessDevList").removeClass("nd").addClass("on-mask msg-container"),$.setFixedCentral($("#accessDevList"))}),$("#mask").show()}),$("#closeDeviceList").click(function(){$("#accessDevList").fadeOut(200,function(){$("#accessDevList").removeClass("on-mask msg-container").addClass("nd")}),$("#mask").hide()}),$("#cancel").click(function(){editFlag=0,curType=" ";for(var t=0;t<curStk.length;t++)curStk[t]=-1;$.loadMain("virtualServer.htm")}),$("#add").click(function(){initIntf(),editFlag=2}),$("#delAll").click(function(){vtlServ_stack=[],vtlServ_stackType=[],vtlServ_stackIndex=index;for(var t=0;t<vtlServ_stackIndex;t++)vtlServ_stack[t]=allStk[t],vtlServ_stackType[t]=allStkType[t];for(var e=0;e<vtlServ_stackIndex;e++)$("#"+(e+1)).prop("data-checked")&&("ip"==vtlServ_stackType[e]?$.act(ACT_DEL,WAN_IP_CONN_PORTMAPPING,vtlServ_stack[e],null):"ppp"==vtlServ_stackType[e]?$.act(ACT_DEL,WAN_PPP_CONN_PORTMAPPING,vtlServ_stack[e],null):"l2tp"==vtlServ_stackType[e]?$.act(ACT_DEL,WAN_L2TP_CONN_PORTMAPPING,vtlServ_stack[e],null):"pptp"==vtlServ_stackType[e]&&$.act(ACT_DEL,WAN_PPTP_CONN_PORTMAPPING,vtlServ_stack[e],null));vtlServ_stackIndex>0&&$.exe(function(t){t||$.loadMain("virtualServer.htm")})}),$("#ok").click(function(){var t=$("#wanInf").data("value").split(":")[0],e=$("#wanInf").data("value").split(":")[1],n=!1,l=!1,a=!1;if($.ifip($("#ipAddr").tpAddress("val"),!0))return $.alert(ERR_IP_FORMAT),$("#ipAddr").tpAddress("focus"),!1;var r;brLanList=$.act(ACT_GL,L2_BRIDGING_ENTRY,null,null,["bridgeName"]),$.exe()||$.each(brLanList,function(){"Default"==this.bridgeName&&(r=this.__stack)});var i=$.ip2ip($("#ipAddr").tpAddress("val"));if(lanIPv4Cfg=$.act(ACT_GS,LAN_IP_INTF,null,r,["IPInterfaceIPAddress","IPInterfaceSubnetMask","X_TP_MACAddress"]),!$.exe()){if(lanIPv4Cfg[0].IPInterfaceIPAddress==i)return $.alert(CMM_DMZ_IP_NOT_BE_LAN_IP),void $("#ipAddr").tpAddress("focus");var P={};if(P.internalClient=$.ip2ip($("#ipAddr").tpAddress("val")),P.portMappingProtocol=$("#protol").data("value"),P.serviceName=$("#serName").prop("value"),P.portMappingEnabled=$("#vtlServ_en").prop("data-checked")?1:0,""==$("#applyPort").prop("value")||!isPort($("#applyPort").prop("value"),"applyPort"))return $.alert(ERR_VS_PORT_INVAD),(c=$("#applyPort"))&&(c.focus(),c.select()),!1;var o=$("#applyPort").prop("value");if("l2tp"==t||"pptp"==t){if(1==o.split("-").length?(P.externalPort=parseInt(o,10),P.externalPortEnd=parseInt(o,10)):o.split("-")[0]>o.split("-")[1]?(P.externalPort=parseInt(o.split("-")[1],10),P.externalPortEnd=parseInt(o.split("-")[0],10)):(P.externalPort=parseInt(o.split("-")[0],10),P.externalPortEnd=parseInt(o.split("-")[1],10)),INCLUDE_USB_FTP_SERVER&&"UDP"!=P.portMappingProtocol){if(checkConflictFtpDataPort(P.externalPort,P.externalPortEnd))return(c=$("#applyPort"))&&(c.focus(),c.select()),!1;P.portMappingEnabled&&checkConflictFtpPort(P.externalPort,P.externalPortEnd)&&(n=!0)}if("UDP"!=P.portMappingProtocol&&P.portMappingEnabled&&INCLUDE_PPTPVPN_SERVER&&checkConflictPptpALGPort(P.externalPort,P.externalPortEnd)&&(p=$.act(ACT_GET,PPTPVPN,null,null),$.exe(),1==p.enable&&(l=!0)),INCLUDE_OPENVPN_SERVER){_=$.act(ACT_GET,OPENVPN,null,null);if($.exe())return!1;P.portMappingEnabled&&1==_.enable&&checkConflictOvpnVSPort(P.externalPort,P.externalPortEnd,_.port)&&checkConflictOvpnVSProtocol(P.portMappingProtocol,_.proto)&&(a=!0)}}else{if(1==o.split("-").length?(P.externalPort=parseInt(o,10),P.X_TP_ExternalPortEnd=parseInt(o,10)):o.split("-")[0]>o.split("-")[1]?(P.externalPort=parseInt(o.split("-")[1],10),P.X_TP_ExternalPortEnd=parseInt(o.split("-")[0],10)):(P.externalPort=parseInt(o.split("-")[0],10),P.X_TP_ExternalPortEnd=parseInt(o.split("-")[1],10)),INCLUDE_USB_FTP_SERVER&&"UDP"!=P.portMappingProtocol){if(checkConflictFtpDataPort(P.externalPort,P.X_TP_ExternalPortEnd))return(c=$("#applyPort"))&&(c.focus(),c.select()),!1;P.portMappingEnabled&&checkConflictFtpPort(P.externalPort,P.X_TP_ExternalPortEnd)&&(n=!0)}if("UDP"!=P.portMappingProtocol&&INCLUDE_PPTPVPN_SERVER&&P.portMappingEnabled&&checkConflictPptpALGPort(P.externalPort,P.X_TP_ExternalPortEnd)){var p=$.act(ACT_GET,PPTPVPN,null,null);$.exe(),1==p.enable&&(l=!0)}if(INCLUDE_OPENVPN_SERVER){var _=$.act(ACT_GET,OPENVPN,null,null);if($.exe())return!1;P.portMappingEnabled&&1==_.enable&&checkConflictOvpnVSPort(P.externalPort,P.X_TP_ExternalPortEnd,_.port)&&checkConflictOvpnVSProtocol(P.portMappingProtocol,_.proto)&&(a=!0)}}if(!isPort($("#interPort").prop("value"),"interPort")){$.alert(ERR_VS_INTER_PORT_INVAD);var c=$("#interPort");return c&&(c.focus(),c.select()),!1}if(INCLUDE_USB_FTP_SERVER&&n)$.confirm(c_str.forwarding_ftp_conflict,function(){if($.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]),$.exe(),"l2tp"==t||"pptp"==t?""!=$("#interPort").prop("value")?P.internalPort=P.internalPortEnd=parseInt($("#interPort").prop("value"),10):(P.internalPort=P.externalPort,P.internalPortEnd=P.externalPortEnd):""!=$("#interPort").prop("value")?P.internalPort=P.X_TP_InternalPortEnd=parseInt($("#interPort").prop("value"),10):(P.internalPort=P.externalPort,P.X_TP_InternalPortEnd=P.X_TP_ExternalPortEnd),2==editFlag){if(checkConflictForAllList(P,"null"))return void $.alert(CMM_VS_RECORD_ALREADY_EXIST);"ip"==t?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,e,P):"ppp"==t?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,e,P):"l2tp"==t?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,e,P):"pptp"==t&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,e,P),$.exe(function(t){t||$.loadMain("virtualServer.htm")})}else if(1==editFlag){var n=curType;if(checkConflictForAllList(P,curStk))return void $.alert(CMM_VS_RECORD_ALREADY_EXIST);wanInfName==$("#wanInf").data("text")?("ip"==n?$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,curStk,null,P):"ppp"==n?$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,curStk,null,P):"l2tp"==n?$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,curStk,null,P):"pptp"==n&&$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,curStk,null,P),$.exe(function(t){t||$.loadMain("virtualServer.htm")})):("ip"==n?$.act(ACT_DEL,WAN_IP_CONN_PORTMAPPING,curStk,null):"ppp"==n?$.act(ACT_DEL,WAN_PPP_CONN_PORTMAPPING,curStk,null):"l2tp"==n?$.act(ACT_DEL,WAN_L2TP_CONN_PORTMAPPING,curStk,null):"pptp"==n&&$.act(ACT_DEL,WAN_PPTP_CONN_PORTMAPPING,curStk,null),$.exe(function(l){l||("ip"==t?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,e,P):"ppp"==t?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,e,P):"l2tp"==t?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,e,P):"pptp"==t&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,e,P),$.exe(function(e){e?(P.portMappingEnabled=vtlServCfg.portMappingEnabled,P.externalPort=vtlServCfg.externalPort,P.internalPort=vtlServCfg.internalPort,P.internalClient=vtlServCfg.internalClient,"l2tp"==t||"pptp"==t?(P.externalPortEnd=vtlServCfg.externalPortEnd,P.internalPortEnd=vtlServCfg.internalPortEnd):(P.X_TP_ExternalPortEnd=vtlServCfg.X_TP_ExternalPortEnd,P.X_TP_InternalPortEnd=vtlServCfg.X_TP_InternalPortEnd),"ip"==n?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,pStk,P):"ppp"==n?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,pStk,P):"l2tp"==n?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,pStk,P):"pptp"==n&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,pStk,P),$.exe()):$.loadMain("virtualServer.htm")}))}))}});else{if(l)return $.alert(CMM_PVPN_PORT_CONFLICT_WITH_VS),void $.exe(function(){0==P.portMappingEnabled?$("#en_"+index).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+index).removeClass("disable-icon").addClass("enable-icon")});if(a)return $.alert(CMM_OVPN_PORT_CONFLICT_WITH_VS),void $.exe(function(){0==P.portMappingEnabled?$("#en_"+index).addClass("disable-icon").removeClass("enable-icon"):$("#en_"+index).removeClass("disable-icon").addClass("enable-icon")});if("l2tp"==t||"pptp"==t?""!=$("#interPort").prop("value")?P.internalPort=P.internalPortEnd=$("#interPort").prop("value"):(P.internalPort=P.externalPort,P.internalPortEnd=P.externalPortEnd):""!=$("#interPort").prop("value")?P.internalPort=P.X_TP_InternalPortEnd=$("#interPort").prop("value"):(P.internalPort=P.externalPort,P.X_TP_InternalPortEnd=P.X_TP_ExternalPortEnd),2==editFlag){if(checkConflictForAllList(P,"null"))return void $.alert(CMM_VS_RECORD_ALREADY_EXIST);"ip"==t?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,e,P):"ppp"==t?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,e,P):"l2tp"==t?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,e,P):"pptp"==t&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,e,P),$.exe(function(t){t||$.loadMain("virtualServer.htm")})}else if(1==editFlag){var s=curType;if(checkConflictForAllList(P,curStk))return void $.alert(CMM_VS_RECORD_ALREADY_EXIST);wanInfName==$("#wanInf").data("text")?("ip"==s?$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,curStk,null,P):"ppp"==s?$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,curStk,null,P):"l2tp"==s?$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,curStk,null,P):"pptp"==s&&$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,curStk,null,P),$.exe(function(t){t||$.loadMain("virtualServer.htm")})):("ip"==s?$.act(ACT_DEL,WAN_IP_CONN_PORTMAPPING,curStk,null):"ppp"==s?$.act(ACT_DEL,WAN_PPP_CONN_PORTMAPPING,curStk,null):"l2tp"==s?$.act(ACT_DEL,WAN_L2TP_CONN_PORTMAPPING,curStk,null):"pptp"==s&&$.act(ACT_DEL,WAN_PPTP_CONN_PORTMAPPING,curStk,null),$.exe(function(n){n||("ip"==t?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,e,P):"ppp"==t?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,e,P):"l2tp"==t?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,e,P):"pptp"==t&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,e,P),$.exe(function(e){e?(P.portMappingEnabled=vtlServCfg.portMappingEnabled,P.externalPort=vtlServCfg.externalPort,P.internalPort=vtlServCfg.internalPort,P.internalClient=vtlServCfg.internalClient,"l2tp"==t||"pptp"==t?(P.externalPortEnd=vtlServCfg.externalPortEnd,P.internalPortEnd=vtlServCfg.internalPortEnd):(P.X_TP_ExternalPortEnd=vtlServCfg.X_TP_ExternalPortEnd,P.X_TP_InternalPortEnd=vtlServCfg.X_TP_InternalPortEnd),"ip"==s?$.act(ACT_ADD,WAN_IP_CONN_PORTMAPPING,null,pStk,P):"ppp"==s?$.act(ACT_ADD,WAN_PPP_CONN_PORTMAPPING,null,pStk,P):"l2tp"==s?$.act(ACT_ADD,WAN_L2TP_CONN_PORTMAPPING,null,pStk,P):"pptp"==s&&$.act(ACT_ADD,WAN_PPTP_CONN_PORTMAPPING,null,pStk,P),$.exe()):$.loadMain("virtualServer.htm")}))}))}}}}),INCLUDE_USB_FTP_SERVER</script>

<h3 id="et">Virtual Server</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span id="add" class="add-icon"></span>
                <label class="T_add">Add</label>
                <span id="delAll" class="delete-all-icon"></span>
                <label class="T_del">Delete</label>
            </div>
        </div>
        <table id="table-virtual">
            <thead></thead>
            <tbody id="body-virtual">
                <tr id="edit-container-virtual" class="nd">
                    <td colspan="9">
                        <p class="cfg-line" id="t_note">Note: Virtual Server setup is supported only when there is available interface. Ports used by Remote Management or CWMP will not work.</p>
                        <div class="part-separate-m nd">
                            <b class="T_intfname tr-s">Interface Name:</b>
                            <select class="xl" id="wanInf">
                            </select>
                        </div>
                        <div>
                            <b class="T_servname tr-s">Service Name:</b>
                            <input class="xl" type="text" maxlength="15" id="serName" oninput="$.maxlength(this)">
                            <button type="submit" class="green T_scan2 l_auto" id="view">Scan</button>
                        </div>
                        <div>
                            <b class="T_exterport tr-s">External Port:</b>
                            <input class="xl" type="text" id="applyPort">
                            <span id="t_iprange">(XX-XX or XX)</span>
                        </div>
                        <div>
                            <b class="T_interip tr-s">Internal IP:</b>
                            <input class="xl ip-address" type="text" id="ipAddr">
                        </div>
                        <div>
                            <b class="T_interport tr-s">Internal Port:</b>
                            <input class="xl" type="text" id="interPort">
                            <div id="virtualServer-interner-port"><span id="t_port">(XX)</span></div>
                        </div>

                        <b class="T_proto tr-s">Protocol:</b>
                        <select class="xl" id="protol">
                            <option value="TCP" id="TCP">TCP</option>
                            <option value="UDP" id="UDP">UDP</option>
                            <option value="TCP or UDP" class="T_all" id="ALL">ALL</option>
                        </select>

                        <div>
                            <b class="tr-s"></b>
                            <input class="xl" type="checkbox" id="vtlServ_en" checked="checked">
                            <label class="T_enthisentry">Enable this Entry</label>
                        </div>
                        <div class="inline-btn-right">
                            <button type="submit" class="green T_cancel" id="cancel">Cancel</button>
                            <button type="submit" class="green T_save" id="ok">Save</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</div>
<div>
    <form class="pure-form pure-form-aligned">
        <div id="accessDevList" class="nd">
            <div id="closeDeviceList" class="table-op">
                <div class="panel-title">
                    <span id="t_existServices"></span>
                </div>
                <div class="table-btn">
                    <span class="close-icon table-icon"></span>
                </div>
            </div>
            <table id="table-service">
                <thead></thead>
                <tbody id="bodyAccessDevicesList">
                </tbody>
            </table>
        </div>
    </form>
</div>
<script>var headArray=[{text:'<div><input type="checkbox" id="checkbox_st" class="table-select-all" /><label></label></div>',width:"5%"},{text:table_str.id,width:"5%"},{text:table_str.servname,width:"10%"},{text:table_str.exterport,width:"20%"},{text:table_str.interip,width:"20%"},{text:table_str.interport,width:"10%"},{text:table_str.protocol,width:"10%"},{text:table_str.status,width:"10%"},{text:table_str.modify,width:"15%"}],AccessDevicesListHeadArray=[{text:table_str.id,width:"15%"},{text:table_str.servname,width:"40%"},{text:table_str.operation,width:"45%"}];$.initTableHead($("#table-virtual"),headArray),$("#table-virtual").tpTable(initTable),$.initTableHead($("#table-service"),AccessDevicesListHeadArray),$("#table-service").tpTable(initServiceTable),$.tpInit()</script>
