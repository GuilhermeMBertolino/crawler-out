<style>#chart-info{line-height:28px;text-align:right}#chart-info label{display:inline-block;width:15px;height:15px;margin:0 5px}#down label{background-color:#4acbd6}#up label{background-color:#ffcb00}</style>
<script>function changeX(r){var o=r;return o=r>=1073741824?(o/1073741824).toFixed(1)+"G":r>=1048576?(o/1048576).toFixed(1)+"M":r>=1024?(o/1024).toFixed(1)+"K":o.toFixed(1)}function changeY(r){var o=parseInt(r);return o=r>=1e9?(o/1e9).toFixed(1)+"G":r>=1e6?(o/1e6).toFixed(1)+"M":r>=1e3?(o/1e3).toFixed(1)+"K":o.toFixed(1)}function initChart(r,o){var t=[],e=[],n=[],i=o.length,a=[31,28,31,30,31,30,31,31,30,31,30,31],l=$.act(ACT_GET,HOUR,null,null,["year","month","day","hours","minutes"]);if(!$.exe()){var s,u,d,h,p,c=parseInt(l.hours,10),g=parseInt(l.minutes,10),k=parseInt(l.year,10),w=parseInt(l.month,10),b=parseInt(l.day,10);(k%400==0||k%400!=0&&k%4==0)&&(a[1]=29);for(var C=0;C<o.length;C++)"Hor"==r?((s=c-i+1+C)<0&&(s+=24),s=s<10?"0"+s:s,t.push(s+":00"),e.push(o[C].ups/3600),n.push(o[C].downs/3600)):"Min"==r?((u=g-i+1+C)<0?(u+=60,s=0==c?23:c-1):s=c,s=s<10?"0"+s:s,u=u<10?"0"+u:u,t.push(s+":"+u),e.push(o[C].ups/60),n.push(o[C].downs/60)):((p=b-i+1+C)<=0?1==w?(d=k-1,p+=a[(h=12)-1]):(d=k,p+=a[(h=w-1)-1]):(h=w,d=k),h=h<10?"0"+h:h,p=p<10?"0"+p:p,t.push([h,p,d].join(".")),e.push(o[C].ups/86400),n.push(o[C].downs/86400));var m={labels:t,datasets:[{label:$.tpLang.stat_nstr.t_downstream,fillColor:"rgba(74,203,214,0.2)",strokeColor:"rgba(74,203,214,1)",pointColor:"rgba(74,203,214,1)",pointStrokeColor:"rgba(74,203,214,0.1)",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(74,203,214,1)",data:n},{label:$.tpLang.stat_nstr.t_upstream,fillColor:"rgba(255,203,0,0.2)",strokeColor:"rgba(255,203,0,1)",pointColor:"rgba(255,203,0,1)",pointStrokeColor:"rgba(255,203,0,0.1)",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(255,203,0,1)",data:e}]},f=document.getElementById("canvas").getContext("2d");window.myLine?window.myLine.initialize(m):window.myLine=new Chart(f).Line(m,{responsive:!0,animation:!1,scaleLabel:"<%=changeY(value)%>B",scaleLineColor:"#cccccc",scaleGridLineColor:"#cccccc",pointDotRadius:5,pointDotStrokeWidth:2,bezierCurveTension:.4,multiTooltipTemplate:"<%= changeX(value)%>B/s",tooltipFillColor:"rgba(54,68,75,0.9)",legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span class="legend-icon" style="background-color:<%=datasets[i].strokeColor%>"></span><p><%if(datasets[i].label){%><%=datasets[i].label%><%}%></p></li><%}%></ul>'})}}</script>
<h3 id="t_trafficMonitor">Traffic Monitor</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="button-group-container">
            <b id="t_trafficMonitorEn">Traffic Monitor:</b>
            <ul>
                <li>
                    <button id="t_on" class="fst" value="on">On</button>
                </li>
                <li>
                    <button id="t_off" class="lst" value="off">Off</button>
                </li>
            </ul>
            <div style="display:inline-block;vertical-align:middle">
                <div style="display:table;margin-left:9px">
                    <div id="enable-stat-tips" style="display:table-cell;width:240px;color:#b2b2b2;height:30px;line-height:15px">
                    </div>
                </div>
            </div>
        </div>
        <div>
            <p id="t_switchNote" class="nd"></p>
        </div>
    </form>
</div>
<div class="content-container" id="traffic-chart">
    <form class="pure-form pure-form-aligned">
        <div>
            <span id="usage-contianer" style="display:inline-block;width:250px">
                <label id="t_devUsage" class="xl">The Traffic Usage of1</label>
                <span id="deviceName"></span>
            </span>
            <select id="device" class="inline"></select>
            <select id="interval" class="inline">
                <option value="Day" id="t_daily"></option>
                <option value="Hor" id="t_hourly"></option>
                <option value="Min" id="t_Minutely"></option>
            </select>
        </div>
        <div id="chart">
            <div id="canvas-container">
            </div>
        </div>
        <div id="chart-info">
            <span id="down">
                <label></label>
                <span id="t_downstream"></span>
            </span>
            <span id="up">
                <label></label>
                <span id="t_upstream"></span>
            </span>
        </div>
    </form>
</div>
<h3 id="t_monitorList">Traffic Statistics List</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span id="freshAll" class="refresh-icon"></span>
                <label class="T_refresh">Refresh</label>
                <span id="resetAll" class="reset-icon"></span>
                <label class="T_reset">Reset</label>
            </div>
        </div>
        <table id="traffic-stat">
            <thead></thead>
            <tbody></tbody>
        </table>
    </form>
</div>
<script>function isNameDuplicated(e,t){for(var l=0,a=0;a<t.length;a++)e==t[a].hostName&&l++;return l}function init(){function e(){if("stat.htm"===$.curPage)if(rebooting&&trafficIntervalId)clearTimeout(trafficIntervalId);else{var t=$.act(ACT_GL,RECORD_ENTRY,null,null),a=$.act(ACT_GET,RECORD_CFG,null,null);$.exe(function(n){if(!n){if(a.allDevices!=l.allDevices)return void $.reload();try{initChart(l.recordInterval,t)}catch(e){return}trafficIntervalId=setTimeout(e,1e4)}})}}var t=$.act(ACT_GET,STAT_CFG,null,null),l=$.act(ACT_GET,RECORD_CFG,null,null),a=$.act(ACT_GL,STAT_ENTRY,null,null),n=$.act(ACT_GET,ALG_CFG,null,null);if(!$.exe()){if(Number(n.hw_nat_enable)&&$("#enable-stat-tips").html($.tpLang.stat_nstr.t_enableTips),1==t.enable){$("#t_on").addClass("selected"),$("#t_off").removeClass("selected");var i='<option value="1" id="t_allDev">'+$.tpLang.stat_nstr.t_allDev+"</option>";$("#device").append(i);for(var r=0;r<a.length;r++){var c=$("<option></option>"),s=a[r].hostName+"#"+a[r].macAddress,d=a[r].hostName;isNameDuplicated(a[r].hostName,a)>1&&(d=a[r].hostName+"("+a[r].macAddress+")"),c.val(s),c.text($.htmlEncodeStr(d)),$("#device").append(c)}if(1!=l.allDevices&&$("#interval").html('<option value="Min" id="t_Minutely">'+$.tpLang.stat_nstr.t_Minutely+"</option>"),$("#device").attr("value","1"==l.allDevices?l.allDevices:l.hostName+"#"+l.macAddress),1==$("#device").val())$("#deviceName").html($.tpLang.stat_nstr.t_allDev+":");else if(null!=$("#device").val()){var o=$("#device").val().split("#")[$("#device").val().split("#").length-1],v=$("#device").val().substr(0,$("#device").val().length-o.length-1);$("#deviceName").html($.htmlEncodeStr(v)+":")}else $("#deviceName").html($.htmlEncodeStr($("#device").val())+":");$("#interval").attr("value",l.recordInterval),$("#traffic-chart").removeClass("nd");var u=$.act(ACT_GL,RECORD_ENTRY,null,null),_=$.act(ACT_GET,RECORD_CFG,null,null);if(!$.exe()){if(_.allDevices!=l.allDevices)return void $.reload();initChart(l.recordInterval,u)}}else $("#t_switchNote").removeClass("nd"),$("#t_on").removeClass("selected"),$("#t_off").addClass("selected"),$("#traffic-chart").addClass("nd");initMonitorList(a),1==t.enable&&"Min"==l.recordInterval&&(trafficIntervalId=setTimeout(e,1e4))}}function changeUnit(e){return e>=1073741824?(e/1073741824).toFixed(3)+"G":e>=1048576?(e/1048576).toFixed(3)+"M":e>=1024?(e/1024).toFixed(3)+"K":e}function initMonitorList(e){for(var t=[],l=0;l<e.length;l++)t.push([{text:"wired"==e[l].hostType?table_str.wired:"2.4g"==e[l].hostType?table_str.type24g:"5g"==e[l].hostType?table_str.type5g:m_str.disconnected,width:"20%"},{text:$.htmlEncodeStr(e[l].hostName),width:"20%"},{text:e[l].macAddress.split(":").join("-"),width:"20%"},{text:"<span>"+changeUnit(e[l].currBytesTx)+"B/s↑</br>"+changeUnit(e[l].currBytesRx)+"B/s↓</span>",width:"20%"},{text:changeUnit(parseInt(e[l].totalBytesRx)+parseInt(e[l].totalBytesTx)),width:"20%"}]);$.initTableBody($("#traffic-stat"),t)}function refreshList(){if("stat.htm"===$.curPage)if(rebooting&&listIntervalId)clearTimeout(listIntervalId);else{var e=$.act(ACT_GL,STAT_ENTRY,null,null);$.exe(function(t){t||initMonitorList(e)}),listIntervalId=setTimeout(refreshList,1e4)}}var canvas=document.createElement("canvas");canvas.id="canvas",document.getElementById("canvas-container").appendChild(canvas),canvas.getContext||G_vmlCanvasManager.initElement(canvas),window.myLine=null;var trafficIntervalId,listIntervalId;clearTimeout(trafficIntervalId),clearTimeout(listIntervalId);var headArray=[{text:table_str.conntype,width:"20%"},{text:table_str.devName,width:"20%"},{text:table_str.mac,width:"20%"},{text:table_str.realRate,width:"20%"},{text:table_str.usage,width:"20%"}];$.initTableHead($("#traffic-stat"),headArray),$("#traffic-stat").tpTable(),$.tpInit(init),$("#t_on").click(function(){var e=$.act(ACT_GET,ALG_CFG,null,null);$.exe(),1==Number(e.hw_nat_enable)?$.confirm(c_str.tm_hwnat_conflict,function(){e.hw_nat_enable="0",$.act(ACT_SET,ALG_CFG,null,null,e),$.exe(function(e){e||($.removeLoading(),$.reload())}),$.act(ACT_SET,STAT_CFG,null,null,["Enable=1"]),$.exe()||$.reload()},function(){$.reload()}):($.act(ACT_SET,STAT_CFG,null,null,["Enable=1"]),$.exe()||$.reload())}),$("#t_off").click(function(){var e=$.act(ACT_GET,DDOS_CFG,null,null);$.exe()||(1==e.enable?$.confirm(c_str.tm_dos_coexist,function(){e.enable=0,$.act(ACT_SET,DDOS_CFG,null,null,e),$.act(ACT_SET,STAT_CFG,null,null,["Enable=0"]),$.exe()||$.reload()},function(){$.reload()}):($.act(ACT_SET,STAT_CFG,null,null,["Enable=0"]),$.exe()||$.reload()))}),$("#device").click(function(e){if(1==$("#device").data("value"))$.act(ACT_SET,RECORD_CFG,null,null,["allDevices=1","recordInterval="+$("#interval").data("value")]);else{var t=$("#device").data("value").split("#")[$("#device").data("value").split("#").length-1],l=$("#device").data("value").substr(0,$("#device").data("value").length-t.length-1);$.act(ACT_SET,RECORD_CFG,null,null,["allDevices=0","hostName="+l,"macAddress="+t,"recordInterval=Min"])}$.exe()||$.reload()}),$("#interval").click(function(e){if(1==$("#device").data("value"))$.act(ACT_SET,RECORD_CFG,null,null,["allDevices=1","recordInterval="+$("#interval").data("value")]);else $.act(ACT_SET,RECORD_CFG,null,null,["allDevices=0","hostName="+$("#device").data("value"),"recordInterval=Min"]);$.exe()||$.reload()}),$("#freshAll").click(function(e){var t=$.act(ACT_GL,STAT_ENTRY,null,null);$.exe()||initMonitorList(t)}),$("#resetAll").click(function(){$.act(ACT_SET,STAT_CFG,null,null,["action=1"]),$.exe(function(e){e||$.reload()})}),listIntervalId=setTimeout(refreshList,1e4)</script>

