!function(r){r.su.moduleManager.define("wirelessSchedule",{deps:["navigatorController"],services:["ajax","time","device"],models:["wirelessSchedule","timeSettings"],stores:["scheduleStore","hourComboStore","minuteComboStore","ampmComboStore"],views:["wirelessScheduleView"],listeners:{ev_on_launch:function(e,s,t,i,n,r,a){t.wirelessScheduleView.wirelessScheduleEnableCfg.hide(),i.wirelessSchedule.load({success:function(e){i.timeSettings.load({success:function(e){"auto"==e.type?i.wirelessSchedule.enable.enable():i.wirelessSchedule.enable.disable()}})}})},ev_before_destroy:function(e,s){s.clearUpdateTime()}},init:function(i,n,e,o,s,S){this.configViews({id:"wirelessScheduleView",items:[{id:"grid-schedule",configs:{tbar:{add:{text:r.su.CHAR.OPERATION.ADD,index:0}},popEditor:{addTitle:r.su.CHAR.WIRELESS_SCHEDULE.ADD_SCHEDULE,editTitle:r.su.CHAR.WIRELESS_SCHEDULE.MODIFY_SCHEDULE,content:"#grid-schedule-editor",fields:[{name:"timeFrom"},{name:"timeTo"},{name:"repeat"}]},columns:[{text:r.su.CHAR.WIRELESS_SCHEDULE.WIRELESS_OFF_TIME,dataIndex:"time",renderer:function(e){var s,t;if(e)return t=e.split("-")[0],e=e.split("-")[1],s="",0==parseInt(t.split(":")[0],10)?s+="12 "+r.su.CHAR.WIRELESS_SCHEDULE.AM:parseInt(t.split(":")[0],10)<12?s+=t+" "+r.su.CHAR.WIRELESS_SCHEDULE.AM:12==parseInt(t.split(":")[0],10)?s+="12 "+r.su.CHAR.WIRELESS_SCHEDULE.PM:s+=parseInt(t.split(":")[0],10)-12+" "+r.su.CHAR.WIRELESS_SCHEDULE.PM,s+="-",0==parseInt(e.split(":")[0],10)?s+="12 "+r.su.CHAR.WIRELESS_SCHEDULE.AM:parseInt(e.split(":")[0],10)<12?s+=e+" "+r.su.CHAR.WIRELESS_SCHEDULE.AM:12==parseInt(e.split(":")[0],10)?s+="12 "+r.su.CHAR.WIRELESS_SCHEDULE.PM:s+=parseInt(e.split(":")[0],10)-12+" "+r.su.CHAR.WIRELESS_SCHEDULE.PM,t=parseInt(t.split(":")[0],10),parseInt(e.split(":")[0],10)<=t&&(s+=" ("+r.su.CHAR.WIRELESS_SCHEDULE.NEXT_DAY+")"),s}},{text:r.su.CHAR.WIRELESS_SCHEDULE.REPEAT,dataIndex:"repeat",renderer:function(e){var s=e.split(",");if("eve"==s[0])return r.su.CHAR.WIRELESS_SCHEDULE.EVE;if("weekdays"==s[0])return r.su.CHAR.WIRELESS_SCHEDULE.WEEKDAYS;if("weekends"==s[0])return r.su.CHAR.WIRELESS_SCHEDULE.WEEKENDS;for(var t="",i=0;i<s.length;i++){switch(s[i]){case"sun":t+=r.su.CHAR.WIRELESS_SCHEDULE.SUN;break;case"mon":t+=r.su.CHAR.WIRELESS_SCHEDULE.MON;break;case"tue":t+=r.su.CHAR.WIRELESS_SCHEDULE.TUES;break;case"wed":t+=r.su.CHAR.WIRELESS_SCHEDULE.WED;break;case"thu":t+=r.su.CHAR.WIRELESS_SCHEDULE.THUR;break;case"fri":t+=r.su.CHAR.WIRELESS_SCHEDULE.FRI;break;case"sat":t+=r.su.CHAR.WIRELESS_SCHEDULE.SAT}i!=s.length-1&&(t+=",")}return t}},{xtype:"actioncolumn",text:r.su.CHAR.WIRELESS_SCHEDULE.MODIFY,renderer:function(e,s){var t='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit">';t+='<span class="icon"></span>';return'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit"><span class="icon"></span><span class="text"></span></a><a href="javascript:void(0)" class="grid-content-btn grid-content-btn-delete btn-delete"><span class="icon"></span><span class="text"></span></a>'}}]}}]}),this.listen({"models.wirelessSchedule.enable":{"ev_value_change":function(e,s,t){"on"==s?(S.ajax.request({proxy:"wirelessScheduleAddListProxy",method:"read",success:function(e){o.scheduleStore.loadData(e.data,!0)}}),n.wirelessScheduleView.wirelessScheduleEnableCfg.show(),S.time.on("on_time_change",i.onTimeChange),S.time.on("on_hour24_change",i.onHour24Change)):(n.wirelessScheduleView.wirelessScheduleEnableCfg.hide(),S.time.off("on_time_change",i.onTimeChange),S.time.off("on_hour24_change",i.onHour24Change))}},"stores.scheduleStore":{"ev_data_change":function(e,s,t){s.value!=s.oldValue&&"enable"==t.getName()&&o.scheduleStore.sync()},"ev_before_sync":function(e,s,t){s.preventDefault();for(var i=o.scheduleStore.getStoreData(),n=[],r=0;r<i.length;r++){var a=i[r].repeat;switch(a){case"weekends":a="sat,sun";break;case"weekdays":a="mon,tue,wed,thu,fri"}n.push(a+":["+parseInt(i[r].timeFrom)+","+parseInt(i[r].timeTo)+"]")}S.ajax.request({proxy:"wirelessScheduleAddListProxy",method:"write",data:{list:JSON.stringify(n)},success:function(e){o.scheduleStore.loadData(e.data,!0)}})}},"views.wirelessScheduleView.timeFrom":{"ev_value_change":function(e,s){var t=n.wirelessScheduleView.timeTo.getValue();"string"==typeof s&&"string"==typeof t&&(s=parseInt(s.split(":")[0],10),parseInt(t.split(":")[0],10)<=s?n.wirelessScheduleView.timeTo.setShortTips(r.su.CHAR.WIRELESS_SCHEDULE.NEXT_DAY_TIP):n.wirelessScheduleView.timeTo.setShortTips(""))}},"views.wirelessScheduleView.timeTo":{"ev_value_change":function(e,s){var t=n.wirelessScheduleView.timeFrom.getValue();"string"==typeof t&&"string"==typeof s&&(t=parseInt(t.split(":")[0],10),parseInt(s.split(":")[0],10)<=t?n.wirelessScheduleView.timeTo.setShortTips(r.su.CHAR.WIRELESS_SCHEDULE.NEXT_DAY_TIP):n.wirelessScheduleView.timeTo.setShortTips(""))}}})}},function(e,i,s,t,n,r){return{onTimeChange:function(e,s){var t=r.time.getHour24(),s=r.time.format(s,"yyyy-MM-dd HH:mm:ss",t);i.wirelessScheduleView.currentTime.setValue(s)},onHour24Change:function(e,s){s?(i.wirelessScheduleView.timeFrom.setHourSystem("24"),i.wirelessScheduleView.timeTo.setHourSystem("24")):(i.wirelessScheduleView.timeFrom.setHourSystem("12"),i.wirelessScheduleView.timeTo.setHourSystem("12"))},clearUpdateTime:function(){r.time.off("on_time_change",e.onTimeChange),r.time.off("on_hour24_change",e.onHour24Change)}}})}(jQuery);