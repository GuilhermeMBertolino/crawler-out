!function(l){l.su.moduleManager.define("oneMesh",{services:["ajax","device"],stores:["meshAvailableStore","deviceMeshStore","meshLocation","clientsList"],models:["meshEnableModel","meshDeviceEditModel","statusAll"],views:["oneMeshView"],deps:["main"],listeners:{"ev_on_launch":function(e,s,n,i,t,a,o){s.unRegisterAutoSaveData([i.meshEnableModel]),i.meshEnableModel.load()}},init:function(i,t,n,a,o,c){this.configViews({id:"oneMeshView",items:[{id:"grid-mesh-availableList",configs:[{type:"logo",dataIndex:"deviceType"},{type:"deviceName",dataIndex:"name",renderer:function(e,s){return s.model}},{type:"ip",dataIndex:"ip",renderer:function(e,s){return s.mac}},{type:"mac",dataIndex:"mac",renderer:function(e,s){s='<div class="container widget-container button-container" mac='+s.mac+">";return s+'<div class="widget-wrap-outer button-wrap-outer">'+'<div class="widget-wrap button-wrap">'+'<a href="javascript:void(0);" class="button-button" type="button" title="SAVE">'+'<span class="button-button-before"></span>'+('<span class="text button-text">'+l.su.CHAR.OPERATION.ADD_UPPERCASE+"</span>")+'<span class="icon button-loading"></span>'+'<span class="button-moire"></span>'+"</a>"+"</div>"+"</div>"}}]},{id:"grid-mesh-devicesList",configs:[{type:"logo",dataIndex:"deviceType"},{type:"deviceName",dataIndex:"name",renderer:function(e,s){s=s.location.toUpperCase();return e+" ("+(l.su.CHAR.ONE_MESH[s]||l.su.CHAR.ONE_MESH.OTHER)+")"}},{type:"ip",dataIndex:"ip",renderer:function(e,s){return s.mac}},{type:"mac",dataIndex:"mac",renderer:function(e,s){var n,i='<div class="signal-level-container widget-container">';return"object"===l.type(s)&&(n=s.clientNum,i=(i+="<span class='icon icon-signal-"+s.signal+"'></span>")+'<div class="link">'+n+" "+l.su.CHAR.ONE_MESH.CLIENTS+"</div>"),i+="</div>"}}]},{id:"grid-mesh-clientsList",configs:{columns:[{text:l.su.CHAR.GRID.ID,xtype:"rownumberer",width:"10%"},{dataIndex:"name",width:"40%",text:l.su.CHAR.ONE_MESH.DEVICE_NAME},{dataIndex:"ip",text:l.su.CHAR.ONE_MESH.IP_ADDRESS+"/"+l.su.CHAR.ONE_MESH.MAC_ADDRESS,renderer:function(e,s){var n="";return(n+='<div class="ip">'+s.ip+"</div>")+('<div class="mac">'+s.mac+"</div>")}}]}}]}),this.listen({"stores.meshAvailableStore":{"ev_loaded":function(){0<a.meshAvailableStore.getData().length?(t.oneMeshView.meshAvailablePanel.setInstruction(a.meshAvailableStore.getData().length+" "+l.su.CHAR.ONE_MESH.AVAILABLE_ONE_MESH_DEVICES),t.oneMeshView.meshAvailablePanel.show()):t.oneMeshView.meshAvailablePanel.hide()}},"models.meshEnableModel":{"ev_loaded":function(e,s){var n;"on"==s.enable?(t.oneMeshView.meshDeviceView.show(),this.initPage()):(t.oneMeshView.meshDeviceView.hide(),t.oneMeshView.noMeshView.show(),l("#no-mesh-device-note").hide(),n=.4629*l(".onemesh-pic-container").width()+"px",l(".onemesh-bg-left").height(n),l(".onemesh-bg-right").height(n)),s.time&&(i.waitTime=s.time)}}}),this.control({"#mesh-enable":{"ev_view_will_change":function(e,s){s.preventDefault(),s="on"==n.meshEnableModel.enable.getValue()?l.su.CHAR.ONE_MESH.MESH_OFF_TEXT:l.su.CHAR.ONE_MESH.MESH_ON_TEXT,t.oneMeshView.meshEnableMsg.setContent(s),t.oneMeshView.meshEnableMsg.show()}},"#mesh-enable-msg":{"ev_msg_ok":function(e,s){"on"==n.meshEnableModel.enable.getValue()?n.meshEnableModel.enable.setValue("off"):n.meshEnableModel.enable.setValue("on"),n.meshEnableModel.submit({success:function(e,s){n.meshEnableModel.load({success:function(){t.oneMeshView.meshProbarMsg.show(function(){t.oneMeshView.meshProgress.animate({duration:1e3*i.waitTime,percentageStart:0,percentageEnd:100,callback:function(){t.oneMeshView.meshProbarMsg.hide()}})})}})}})}},"#grid-mesh-devicesList":{"ev_item_click":function(e,s){c.ajax.request({proxy:"meshInfoProxy",method:"read",data:{mac:s.mac},success:function(e){l(".devicesList-container .item-selected").removeClass("item-selected"),"l"==l.su.widgetSize||"xl"==l.su.widgetSize?(t.oneMeshView.meshInfo.show(),t.oneMeshView.meshClient.show()):(l(".tab-container .tab").removeClass("selected"),t.oneMeshView.meshInfo.hide(),t.oneMeshView.meshClient.hide(),l(".tab-container .tab:first-child").click()),l("#manage-device-link").attr("href","http://"+e.ip),t.oneMeshView.deviceMeshInfoMsg.setTitle(e.model),n.meshDeviceEditModel.loadData(e),t.oneMeshView.signal.setHtml('<div class="signal-level-container widget-container"><span class=\'icon icon-signal-'+e.signal_strength+"'></span></div>"),t.oneMeshView.go.setHtml("<a href='http://"+e.ip+"' class='link'>"+l.su.CHAR.ONE_MESH.MANAGE_DEVICE+"</a>");var s=i.convertSpeed(e.link_speed_24g)+" ("+l.su.CHAR.ONE_MESH.HZ_24G+") "+i.convertSpeed(e.link_speed_5g)+" ("+l.su.CHAR.ONE_MESH.HZ_5G+")";e.link_speed_6g&&(s=s+" "+i.convertSpeed(e.link_speed_6g)+" ("+l.su.CHAR.WIRELESS_SETTINGS.MODE_6G+")"),t.oneMeshView.speed.setValue(s),a.clientsList.loadData(e.mesh_nclient_list),t.oneMeshView.deviceMeshInfoMsg.show()}})}},"#leave-device":{"ev_button_click":function(){o.main.confirm("<h3 style='font-size:16px;margin-bottom:15px;'>"+l.su.CHAR.ONE_MESH.LEAVE_ONEMESH_MSG_TITLE+"</h3>"+l.su.CHAR.ONE_MESH.LEAVE_ONEMESH_MSG_INTRODUCTION,function(){c.ajax.request({proxy:"meshManageProxy",method:"write",data:{operation:"unlink",mac:n.meshDeviceEditModel.mac.getValue()},success:function(e){i.refreshDeviceList(),t.oneMeshView.deviceMeshInfoMsg.close()}})},function(){},l.su.CHAR.ONE_MESH.LEAVE)}},"#leave-device-m":{"ev_button_click":function(){o.main.confirm("<h3 style='font-size:16px;margin-bottom:15px;'>"+l.su.CHAR.ONE_MESH.LEAVE_ONEMESH_MSG_TITLE+"</h3>"+l.su.CHAR.ONE_MESH.LEAVE_ONEMESH_MSG_INTRODUCTION,function(){c.ajax.request({proxy:"meshManageProxy",method:"write",data:{operation:"unlink",mac:n.meshDeviceEditModel.mac.getValue()},success:function(e){i.refreshDeviceList(),t.oneMeshView.deviceMeshInfoMsg.close()}})},function(){},l.su.CHAR.ONE_MESH.LEAVE)}},"#save-device-info":{"ev_button_click":function(){n.meshDeviceEditModel.validate()&&c.ajax.request({proxy:"meshInfoProxy",method:"write",data:n.meshDeviceEditModel.getData(),success:function(e){i.refreshDeviceList(),t.oneMeshView.deviceMeshInfoMsg.close()}})}},"#save-device-info-s":{"ev_button_click":function(){c.ajax.request({proxy:"meshInfoProxy",method:"write",data:n.meshDeviceEditModel.getData(),success:function(e){i.refreshDeviceList(),t.oneMeshView.deviceMeshInfoMsg.close()}})}},"#grid-mesh-availableList => .button-container":{"click":function(e,s){setTimeout(function(){l(".devicesList-container .item-selected").removeClass("item-selected")},200);e=l(e.currentTarget).attr("mac");i.setDeviceBandShow(e),i.currentMAC=e,t.oneMeshView.deviceMeshAddMsg.show()}},"#add-mesh-msg":{"ev_msg_ok":function(e,s){s.preventDefault(),c.ajax.request({proxy:"meshManageProxy",method:"write",data:{operation:"link",mac:i.currentMAC},success:function(e){i.refreshDeviceList(),t.oneMeshView.deviceMeshAddMsg.close()}})}},"#mesh-msg":{"ev_msg_ok":function(e,s){s.preventDefault(),o.main.confirm("<h3 style='font-size:16px;margin-bottom:15px;'>"+l.su.CHAR.ONE_MESH.LEAVE_ONEMESH_MSG_TITLE+"</h3>"+l.su.CHAR.ONE_MESH.LEAVE_ONEMESH_MSG_INTRODUCTION,function(){c.ajax.request({proxy:"meshManageProxy",method:"write",data:{operation:"unlink",mac:n.meshDeviceEditModel.mac.getValue()},success:function(e){i.refreshDeviceList(),t.oneMeshView.deviceMeshInfoMsg.close()}})},function(){},l.su.CHAR.ONE_MESH.LEAVE)}},".tab-container .tab":{"click":function(e){l(".tab-container .tab").removeClass("selected"),t.oneMeshView.meshInfo.hide(),t.oneMeshView.meshClient.hide(),l(e.target).addClass("selected"),(l(e.target).hasClass("first")?t.oneMeshView.meshInfo:t.oneMeshView.meshClient).show()}}})}},function(t,a,s,o,e,n){return{currentMAC:"",waitTime:1,wireless2gEnable:"on",wireless5gEnable:"on",wireless5g2Enable:"on",wireless6gEnable:"on",initPage:function(){this.checkMesh(),s.statusAll.load({success:function(){var e=s.statusAll.getData();t.wireless2gEnable=e.wireless2gEnable,t.wireless5gEnable=e.wireless5gEnable,t.wireless5g2Enable=e.wireless5g2Enable,t.wireless6gEnable=e.wireless6gEnable}})},checkMesh:function(){n.ajax.request({proxy:"meshTopoProxy",method:"read",success:function(e){var s=e;o.deviceMeshStore.load({data:{operation:"read"}}),o.meshAvailableStore.load({data:{operation:"read"},success:function(e){0<s.mesh_sclient_list.length||0<e.length?a.oneMeshView.noMeshView.hide():(a.oneMeshView.noMeshView.show(),l("#no-mesh-device-note").show(),e=.4629*l(".onemesh-pic-container").width()+"px",l(".onemesh-bg-left").height(e),l(".onemesh-bg-right").height(e))}})}})},refreshDeviceList:function(){o.deviceMeshStore.load({data:{operation:"read"}}),o.meshAvailableStore.load({data:{operation:"read"}})},convertSpeed:function(e){var s=l.su.CHAR.ONE_MESH.KBPS;return 1e3<=(e=e||0)&&(e/=1e3,s=l.su.CHAR.ONE_MESH.MBPS),""+parseInt(e,10)+s},setDeviceBandShow:function(e){for(var s=!0,n=o.meshAvailableStore.getData(),i=0;i<n.length;i++)n[i].mac===e&&(enable2g=!n[i].ch2g||"0"!==n[i].ch2g,enable5g=!n[i].ch5g||"0"!==n[i].ch5g,enable5g2=!n[i].ch5g2||"0"!==n[i].ch5g2,s=n[i].ch6g&&"0"!==n[i].ch6g);enable2g&&"on"==t.wireless2gEnable?a.oneMeshView.reconnect2g.show():a.oneMeshView.reconnect2g.hide(),enable5g&&"on"==t.wireless5gEnable?a.oneMeshView.reconnect5g1.show():a.oneMeshView.reconnect5g1.hide(),enable5g2&&"on"==t.wireless5g2Enable?a.oneMeshView.reconnect5g2.show():a.oneMeshView.reconnect5g2.hide(),s&&"on"==t.wireless6gEnable?a.oneMeshView.reconnect6g.show():a.oneMeshView.reconnect6g.hide()}}})}(jQuery);