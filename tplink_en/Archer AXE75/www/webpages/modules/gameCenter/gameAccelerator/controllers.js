!function(s){s.su.moduleManager.define("gameAccelerator",{services:["ajax","moduleLoader","moduleManager"],deps:[],models:["gameAcceleratorM"],stores:["gameAcceleratorStore"],views:["gameAcceleratorView"],listeners:{"ev_on_launch":function(e,a,n,t,c,o,s){this.unRegisterAutoSaveData([c.gameAcceleratorStore,t.gameAcceleratorM]),t.gameAcceleratorM.load({data:{operation:"getMode"},success:function(e){"on"==e.game_mode?n.gameAcceleratorView.networkMapClientPanel.show():n.gameAcceleratorView.networkMapClientPanel.hide()}}),a.getClients(),s.moduleLoader.load({module:"gameAccelerator"},{module:"bandwidth"},n.gameAcceleratorView.qosBandwidthLoader,function(){var e=s.moduleManager.get("bandwidth");e.on("ev_qos_saved",function(e){t.gameAcceleratorM.gameMode.setValue("on"),t.gameAcceleratorM.gameMode.hideLoading(),t.gameAcceleratorM.submit({data:{operation:"setMode"},success:function(e){"on"==e.gameMode?n.gameAcceleratorView.networkMapClientPanel.show():n.gameAcceleratorView.networkMapClientPanel.hide()}})}),e.on("ev_qos_save_close",function(e){t.gameAcceleratorM.gameMode.hideLoading()}),e.on("ev_qos_save_cancel",function(e){t.gameAcceleratorM.gameMode.hideLoading()})})},"ev_before_destroy":function(e,a){a.beforeDestroy()}},init:function(e,n,t,c,a,o){this.configViews({id:"gameAcceleratorView",items:[{id:"game-connected-clients-grid",configs:{columns:[{dataIndex:"deviceName",cls:"m-hide l-hide xl-hide label-empty"},{dataIndex:"deviceType",cls:"m-hide l-hide xl-hide label-empty",renderer:function(e,a){var n="",t="",c="";switch(e=e.toLowerCase()){case"pc":n="icon-pc";break;case"phone":n="icon-phone";break;case"pad":n="icon-pad";break;case"other":n="icon-pc";break;default:n="icon-"+e}return t=t+'<div class="device-type-container widget-container">'+('<span class="icon '+n+' ">'+(c=a.isGaming?'<span class="gaming-tag"></span>':c)+"</span>"),null!=a.enableInternet&&(t+='<span class="text">'+(a.enableInternet?"":s.su.CHAR.NETWORK_MAP.INTERNET_PAUSED)+"</span>"),t=(t=(t+="</div>")+'<div class="device-info-container widget-container">'+('<div class="mac">'+a.mac+"</div>"))+('<div class="ip">'+("0.0.0.0"==a.ip?"":a.ip)+"</div>")+"</div>"}},{text:s.su.CHAR.NETWORK_MAP.TYPE,width:"15%",dataIndex:"deviceType",cls:"s-hide",renderer:function(e,a){var n="",t="",c="";switch(e=e.toLowerCase()){case"pc":n="icon-pc";break;case"phone":n="icon-phone";break;case"pad":n="icon-pad";break;case"other":n="icon-pc";break;default:n="icon-"+e}return t=t+'<div class="device-type-container widget-container">'+('<span class="icon '+n+' ">'+(c=a.isGaming?'<span class="gaming-tag"></span>':c)+"</span>"),null!=a.enableInternet&&(t+='<span class="text">'+(a.enableInternet?"":s.su.CHAR.NETWORK_MAP.INTERNET_PAUSED)+"</span>"),t+="</div>"}},{text:s.su.CHAR.NETWORK_MAP.INFORMATION,dataIndex:"deviceName",width:"22%",cls:"s-hide",renderer:function(e,a){var n,t="";return t="object"===s.type(a)?(t=(t+='<div class="device-info-container widget-container">')+'<div class="name" title="'+(n=a.deviceName)+'">'+n+'</div><div class="mac">'+a.mac+"</div>")+'<div class="ip">'+("0.0.0.0"==a.ip?"":a.ip)+"</div></div>":t}},{text:s.su.CHAR.GAME_ACCELERATOR.REAL_TIME_RATE,dataIndex:"downloadSpeed",renderer:function(e,a){var n,t="",c=function(e){var a=(e=parseInt(e,10))/1024<1?(0!==e&&(e=(e/1024).toFixed(2)),s.su.CHAR.NETWORK_MAP.KBPS):e/1024/1024<1?(e/1024<1e3?e=(e/1024).toFixed(1):e/=1024,s.su.CHAR.NETWORK_MAP.KBPS):(e=(e/1024/1024).toFixed(1),s.su.CHAR.NETWORK_MAP.MBPS);return{speed:e,unit:a}};return"object"===s.type(a)&&(n=c(a.downloadSpeed),c=c(a.uploadSpeed),a.latency,t=(t=(t=(t=(t+='<div class="speed-upload-container widget-container">')+'<span class="icon"></span><span class="text">'+c.speed+"</span>")+'<span class="unit">'+c.unit+'</span></div><div class="speed-download-container widget-container">')+'<span class="icon"></span><span class="text">'+n.speed+"</span>")+'<span class="unit">'+n.unit+"</span></div>"),t}},{text:s.su.CHAR.GAME_ACCELERATOR.LATENCY,dataIndex:"latency",width:"16%",cls:"s-2-col custom-action-column",tipText:s.su.CHAR.GAME_ACCELERATOR.LATENCY_HELP,renderer:function(e,a){var n="";return n+='<div class="latency-container widget-container">',n=(n=(n=0<=e?n+'<span class="text">'+e+'</span><span class="unit">'+s.su.CHAR.GAME_ACCELERATOR.LATENCY_UNIT+"</span>":n+'<span class="text">--- </span><span class="unit">'+s.su.CHAR.GAME_ACCELERATOR.LATENCY_UNIT+"</span>")+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-latency btn-latency">'+'<span class="icon"></span>')+"</a>"+"</div>"}},{text:s.su.CHAR.GAME_ACCELERATOR.GAMEING_DURATION,dataIndex:"totalGameTime",cls:"s-2-col",renderer:function(e,a){var n,t="",c=(t+='<div class="duration-container widget-container">',c=parseInt(e/1440,10),n=parseInt(e%86400/60,10),e=parseInt(e%60,10),1===c?t=t+c+" "+s.su.CHAR.NETWORK_MAP.DAY+" ":1<c&&(t=t+c+" "+s.su.CHAR.NETWORK_MAP.DAYS+" "),t=(t=0<n?t+n+" "+s.su.CHAR.NETWORK_MAP.H+" ":t)+e+" "+s.su.CHAR.NETWORK_MAP.MIN,t+=" ("+s.su.CHAR.GAME_ACCELERATOR.TOTAL+")</div>",a.currentGameTime);return t+='<div class="duration-container widget-container">',dayCurrent=parseInt(c/1440,10),n=parseInt(c%86400/60,10),e=parseInt(c%60,10),1===dayCurrent?t=t+dayCurrent+" "+s.su.CHAR.NETWORK_MAP.DAY+" ":1<dayCurrent&&(t=t+dayCurrent+" "+s.su.CHAR.NETWORK_MAP.DAYS+" "),t=(t=0<n?t+n+" "+s.su.CHAR.NETWORK_MAP.H+" ":t)+e+" "+s.su.CHAR.NETWORK_MAP.MIN,t+=" ("+s.su.CHAR.GAME_ACCELERATOR.CURRENT+")</div>"}}]}}]}),this.control({"#game-connected-clients-grid => .btn-latency":{"ev_grid_action_click":function(e,a){var n=c.gameAcceleratorStore.getModelByKey(a),a=n.ip.getValue();o.ajax.request({proxy:"gameAccGridProxy",method:"read",data:{ip:a,operation:"getLatency"},success:function(e){n.latency.setValue(e.latency)},error:function(e){},fail:function(e){}})}},"#game-accelerator-enable":{"ev_view_change":function(e,a){t.gameAcceleratorM.submit({data:{operation:"setMode"},success:function(e){"on"==e.gameMode?n.gameAcceleratorView.networkMapClientPanel.show():n.gameAcceleratorView.networkMapClientPanel.hide()}})},"ev_view_will_change":function(e,a){var n=t.gameAcceleratorM.gameMode.getValue();"off"!=n&&n||((n=o.moduleManager.get("bandwidth")).hasConfigured()||(a.preventDefault(),t.gameAcceleratorM.gameMode.showLoading("on"),n.showBandwithMsg()))}}}),this.listen({"stores.gameAcceleratorStore":{"ev_data_change":function(e,a,n){n=n.getName();a.value!==a.oldValue&&"enablePriority"===n&&c.gameAcceleratorStore.sync()}}})}},function(e,a,n,t,c,o){var s=null;return{getClients:function(){t.gameAcceleratorStore.load({data:{operation:"loadDevice"},success:function(e){t.gameAcceleratorStore.load({data:{operation:"loadSpeed"}})}}),clearInterval(s),s=setInterval(function(){t.gameAcceleratorStore.load({data:{operation:"loadSpeed"}})},1e4)},getAccessControlMode:function(e){var a;e&&(a=e.success),n.accessControl.load({success:function(e){a&&a(n.accessControl.getData())}})},beforeDestroy:function(){clearInterval(s)},getIPaddr:function(e){return""},getConnectType:function(e){return""}}})}(jQuery);