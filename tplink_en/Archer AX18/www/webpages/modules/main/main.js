!function(l){l.su.moduleManager.define("main",{services:["moduleLoader","user","ajax","device"],views:["main"],listeners:{ev_on_launch:function(e,a,o,n,t,i,r){a.syncTokenFromStorage(),l("#global-splash .outer").css("background-size","cover");setTimeout(function(){a.hideSplash()},600);r.device.getIsBeta()?l("body").addClass("beta"):l("body").removeClass("beta");var s=r.device.getConfig().supportTetherGuidance;if(""===a.getToken())s?a.loadBasicModule("tetherGuidance"):a.loadBasicModule("login");else{try{l.su.encryptor=l.encrypt.encryptManager.getEncryptor(),l.su.userInfo=localStorage.getItem("userInfo")?JSON.parse(l.su.DES3.decrypt(localStorage.getItem("userInfo"))):{}}catch(e){return void a.loadLoginPage()}r.ajax.request({proxy:"firmwareProxy",method:"read",success:function(e){function o(e){a.loadBasicModule("index",a.resetUpgradedValue)}var n="quickSetup";a.upgraded=e.upgraded,a.rebootTime=1e3*e.rebootTime;location.hash.substr(1)===n||!0===e.isDefault?(location.href.indexOf(n)<0&&(location.href=location.href+"#"+n),a.loadBasicModule(n)):!a.upgraded||a.supportTetherGuidance?o():r.ajax.request({proxy:"checkInternetProxy",success:function(e){r.ajax.request({proxy:"cloudBindStatusProxy",method:"read",success:function(e){e.isbind?o():a.loadBasicModule(n)},fail:o,error:o})},fail:o,error:o})},fail:function(){a.loadBasicModule("login")},error:function(){a.loadBasicModule("login")}}),a.cloudInfo={},l.su.userInfo.token&&(a.cloudInfo.islogined=!0,a.cloudInfo.username=l.su.userInfo.username),r.ajax.request({proxy:"checkUpgradeNumberProxy",method:"read",success:function(e){e=parseInt(e.updateNumber,10);a.showUpgradeHint=0<e}}),a.checkMeshUpdate()}},ev_login_timeout:function(){this.onLoginTimeout()},ev_auto_upgrading:function(){this.onAutoUpgrading()},ev_user_conflict:function(){this.onUserConflict()},ev_permission_denied:function(){this.onPermissionDenied()}},init:function(n,e,o,a,t,i){this.control({"#global-confirm":{ev_msg_ok:function(e,o){n.globalConfirmSuccessCallback&&n.globalConfirmSuccessCallback.call(null,o),n.globalConfirmSuccessCallback=null},ev_msg_no:function(){n.globalConfirmFailCallback&&n.globalConfirmFailCallback.call(),n.globalConfirmFailCallback=null},ev_msg_close:function(){n.globalConfirmFailCallback&&n.globalConfirmFailCallback.call(),n.globalConfirmFailCallback=null}},"#failure-retry-msg":{ev_msg_ok:function(){l.su.moduleManager.get("firmware").failureRetry()}},"#upgrade-fail-alert":{ev_msg_ok:function(){var e=l.su.moduleManager.get("qsInternetConnection");e&&e.proceedTpCloud()}}})}},function(i,r,e,o,n,a){i=this;return{LOGOUT_URL:l.su.url("/admin/system?form=logout"),FIRMWARE_URL:l.su.url("/admin/firmware?form=upgrade"),waitingId:!1,waitingTime:2e4,showUpgradeHint:!1,upgraded:!1,rebootTime:12e4,supportTetherGuidance:a.device.getConfig().supportTetherGuidance,loadBasicModule:function(e,o){a.moduleLoader.load({module:"main"},{module:e},r.main.basicModuleLoader,o)},resetUpgradedValue:function(){a.ajax.request({proxy:"firmwareProxy",method:"write",data:{upgraded:!1},preventSuccessEvent:!0}),i.upgraded=!1},splashTime:1e3,showSplash:function(){r.main.splash.show()},hideSplash:function(){r.main.splash.fadeOut(400)},showError:function(e){e&&(r.main.globalError.setContent(e),r.main.globalError.show())},startReboot:function(e,o,n){e=e||9e4;var a=this;n?(r.main.rebootTips.show(),r.main.rebootTips.setText(n)):r.main.rebootTips.hide(),r.main.rebootMsg.show(function(){r.main.rebootProgress.animate({duration:e,percentageStart:0,percentageEnd:100,callback:function(){a.checkReboot(),o&&o()}})})},checkReboot:function(){r.main.rebootMsg.hide()},checkMeshUpdate:function(){a.ajax.request({proxy:"meshRouterUpdateProxy",success:function(e){l.grep(e,function(e){return!e.is_latest}).length&&(i.showUpgradeHint=!0)}})},showNotice:function(e,o){r.main.globalNotice.show(e,o)},hideNotice:function(e){r.main.globalNotice.hide(e)},checkLogin:function(){},setToken:function(e){localStorage.setItem("token",e),l.su.url.stok=e},getToken:function(){var e=l.su.url.stok;return e||""},syncTokenFromStorage:function(){var e=localStorage.getItem("token");e&&(l.su.url.stok=e)},onLoginTimeout:function(){i.setToken(""),location.href="http://tplinkwifi.net"},onAutoUpgrading:function(){i.setToken(""),location.href="./auto_update_blocking.html"},loadLoginPage:function(){i.setToken(""),i.loadBasicModule("login")},onUserConflict:function(){},onPermissionDenied:function(){i.alert(l.su.CHAR.ERROR["00000088"])},reload:function(){location.href="/"},toggelVisibleMask:function(e){e?r.main.transparentMask.show("global-nontrans-mask"):r.main.transparentMask.hide("global-nontrans-mask")},showMask:function(){r.main.transparentMask.show("global-trans-mask")},hideMask:function(){r.main.transparentMask.hide("global-trans-mask")},confirm:function(e,o,n,a,t){e&&(r.main.globalConfirm.setContent(e),r.main.globalConfirm.show(),r.main.globalConfirm.setButtonText("ok",a||l.su.CHAR.OPERATION.YES_UPPERCASE),r.main.globalConfirm.setButtonText("no",t||l.su.CHAR.OPERATION.CANCEL_UPPERCASE),i.globalConfirmSuccessCallback=o||function(){},i.globalConfirmFailCallback=n||function(){})},alert:function(e){e&&(r.main.globalAlert.setContent(e),r.main.globalAlert.show())},getCloudInfo:function(){return i.cloudInfo},setWaitingEvent:function(e,o,n){i.waitingId=!1;n=n||i.waitingTime;return o=(o=o||window).jquery?o:l(o),i.waitingId=setTimeout(function(){o.trigger(e)},n),!0},clearWaitingEvent:function(){i.waitingId&&(clearTimeout(i.waitingId),i.waitingId=!1)},showProBar:function(e,o){r.main.proBar.reset(),r.main.proBar.setText(e),o?(r.main.proBarTips.show(),r.main.proBarTips.setText(o)):r.main.proBarTips.hide(),r.main.progressbarWrap.show()},hideProBar:function(){r.main.progressbarWrap.hide()},setProBarValue:function(e,o){r.main.proBar.setValue(e,o)},setProBarAnimate:function(e,o){r.main.proBar.animate({percentageStart:0,percentageEnd:100,duration:1e3*e,callback:o})},setUpgradeRetryContent:function(e){r.main.failRetryMsg.setContent(e)},showUpgradeRetry:function(){r.main.failRetryMsg.show()},showUpgradeFailAlert:function(){r.main.upgradeFailAlert.show()},showLoading:function(e){r.main.loadingMsg.show(),r.main.loadingText.setText(e)},hideLoading:function(){r.main.loadingMsg.hide()}}})}(jQuery);