!function(n){n.su.moduleManager.define("sysLog",{models:["sysLogModel","runningTimeModel","saveLogModel"],stores:["logTypeStore","frequencyStore","sysLogStore"],services:["ajax","time","device"],views:["sysLogView"],listeners:{ev_on_launch:function(e,o,s,i,a,t,l){this.unRegisterAutoSaveData([i.sysLogModel,i.saveLogModel]),"ios"===n.su.platform&&s.sysLogView.saveLocalBtn.hide(),a.sysLogStore.load(),a.logTypeStore.load(),i.sysLogModel.load(),i.saveLogModel.load(),l.time.on("on_time_change",o.onTimeChange)},ev_before_destroy:function(e,o){o.beforeDestroy()}},init:function(s,a,t,i,e,l){this.configViews({id:"sysLogView",items:[{id:"system-log-information",configs:{convert:function(e){var o=n.su.CHAR.SYSTEM_LOG[e.type],s=n.su.CHAR.SYSTEM_LOG[e.level];return o&&(e.type=o),s&&(e.level=s),[e.time,e.type,e.level,e.content].join(" ")}}}]}),this.listen({"models.sysLogModel.type":{ev_value_change:function(e,o,s){s&&s!==o&&this.filterLog(o)}},"models.saveLogModel":{ev_loaded:function(e,o){s.saveEmailFlag=!!o.to,s.saveEmailFlag&&a.sysLogView.autoMailField.show(),a.sysLogView.mailToLabel.setValue(o.to)}},"models.saveLogModel.autoMailType":{ev_value_change:function(e,o,s){var i=t.saveLogModel;"on"===i.autoMail.getValue()&&("day_time"===o?(i.everyDayTime.enable(),i.everyDayTime.show(),i.everyHours.disable(),i.everyHours.hide(),a.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE)):(i.everyHours.enable(),i.everyHours.show(),i.everyDayTime.disable(),i.everyDayTime.hide(),a.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE_AND_SEND)))}},"models.saveLogModel.auth":{ev_value_change:function(e,o,s){"on"===o?(t.saveLogModel.username.enable(),t.saveLogModel.username.show(),t.saveLogModel.password.enable(),t.saveLogModel.password.show()):(t.saveLogModel.username.disable(),t.saveLogModel.username.hide(),t.saveLogModel.password.disable(),t.saveLogModel.password.hide())}},"models.saveLogModel.autoMail":{ev_value_change:function(e,o,s){var i=t.saveLogModel;"on"===o?(i.autoMailType.enable(),i.autoMailType.show(),"day_time"===i.autoMailType.getValue()?(i.everyDayTime.enable(),i.everyDayTime.show(),i.everyHours.disable(),i.everyHours.hide(),a.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE)):(i.everyHours.enable(),i.everyHours.show(),i.everyDayTime.disable(),i.everyDayTime.hide(),a.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE_AND_SEND))):(i.autoMailType.disable(),i.autoMailType.hide(),i.everyDayTime.disable(),i.everyDayTime.hide(),i.everyHours.disable(),i.everyHours.hide(),a.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE))}}}),this.control({"#mail-log-btn":{ev_button_click:function(){s.saveEmailFlag?s.sendEmail():(a.sysLogView.setMailTip.show(),a.sysLogView.mailLogMsg.show()),a.sysLogView.sendEmailStatus.hide()}},"#save-local-btn":{ev_button_click:function(){s.saveLog()}},"#mail-edit-btn":{ev_button_click:function(){a.sysLogView.setMailTip.hide(),a.sysLogView.mailLogMsg.show(),a.sysLogView.sendEmailStatus.hide()}},"#mail-log-msg-submit-btn":{ev_button_click:function(){t.saveLogModel.submit({success:function(e){s.saveEmailFlag=!0,a.sysLogView.mailToLabel.setValue(t.saveLogModel.to.getValue()),a.sysLogView.mailLogMsg.hide(),a.sysLogView.setMailTip.hide(),"on"===t.saveLogModel.autoMail.getValue()&&"hours"===t.saveLogModel.autoMailType.getValue()&&s.sendEmail(),t.saveLogModel.to.getValue()&&a.sysLogView.autoMailField.show()},fail:function(e){a.sysLogView.mailLogMsg.hide()},error:function(e){a.sysLogView.mailLogMsg.hide()}})}},"#mail-log-msg-cancel-btn":{ev_button_click:function(){a.sysLogView.mailLogMsg.hide()}},"#system-log-information":{ev_grid_action_click:function(e,o){l.ajax.request({proxy:"sysLogClearProxy",success:function(e){i.sysLogStore.remove()}})}}})}},function(e,a,o,s,i,t){return{saveEmailFlag:!1,sendEmail:function(){t.ajax.request({proxy:"sendMailProxy",success:function(e){void 0!==e.send&&(a.sysLogView.sendEmailStatus.show(),e.send?a.sysLogView.sendEmailStatus.setSuccess(n.su.CHAR.SYSTEM_LOG.SEND_OK):a.sysLogView.sendEmailStatus.setFailed(n.su.CHAR.SYSTEM_LOG.SEND_FAILED))}})},saveLog:function(){t.ajax.upload({proxy:"saveLogProxy",fileId:"save-log-file"})},filterLog:function(e){o.sysLogModel.submit({preventSuccessEvent:!0,success:function(){s.sysLogStore.load()}})},onTimeChange:function(e,o){var s=t.time.getHour24(),i=t.device.getTimeFormat(),o=t.time.format(o,i,s);a.sysLogView.currentTime.setValue(o)},beforeDestroy:function(){t.time.off("on_time_change",e.onTimeChange)}}})}(jQuery);