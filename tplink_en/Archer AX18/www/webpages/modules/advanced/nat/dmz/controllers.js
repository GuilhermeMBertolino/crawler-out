!function(m){m.su.moduleManager.define("dmz",{services:["vtype","ajax"],models:["dmz","lanAdvLanModel"],stores:["portForwardingConnectedDevicesStore","lanAdvSubnetCombo"],views:["dmzView"],listeners:{ev_on_launch:function(e,d,n,i,t,r,a){n.dmzView.dmzIpAddressWrapper.hide(),n.dmzView.natNotEnabled.hide(),a.ajax.request({proxy:"natSettingProxy",success:function(e){"off"==e.enable?n.dmzView.natNotEnabled.show():n.dmzView.natNotEnabled.hide()}}),i.dmz.load(),i.lanAdvLanModel.load(),this.control({"#dmz-ip-address":{ev_textbox_blur:function(){var e=d.ipFilter(i.dmz.ipAddr.getValue()),e=a.vtype.validate(e,"ip");1!=e?i.dmz.ipAddr.setError(e):i.dmz.ipAddr.setNormal()}},"#dmz-connected-devices-btn":{ev_button_click:function(e){n.dmzView.dmzConnectedDevices.show(),t.portForwardingConnectedDevicesStore.load()}},"#dmz-connected-devices-items":{ev_item_click:function(e,t){i.dmz.ipAddr.setValue(t.ipAddress),n.dmzView.dmzConnectedDevices.close()}},".index-common-save-btn":{ev_will_auto_save:function(e,t){"on"!=i.dmz.enable.getValue()||d.checkIPAddrSubmit()||t.preventDefault()}}}),this.listen({"models.dmz.enable":{ev_value_change:function(e,t,d){"on"==t?n.dmzView.dmzIpAddressWrapper.show():n.dmzView.dmzIpAddressWrapper.hide()}}})}},init:function(e,t,d,n,i,r){this.configViews({id:"dmzView",items:[{id:"dmz-connected-devices-items",configs:[{type:"logo",dataIndex:"deviceType"},{type:"deviceName",dataIndex:"name"},{type:"ip",dataIndex:"ipAddress"},{type:"mac",dataIndex:"macAddress"}]}]})}},function(e,t,o,s,d,n){return{ipToInt:function(e){var t=e.split(".");return 4==t.length&&/^\s*[0-9]{1,3}\.{1}[0-9]{1,3}\.{1}[ 0-9]{1,3}\.{1}[0-9]{1,3}\s*$/.test(e)?Number(t[0])*(1<<24)+(Number(t[1])<<16|Number(t[2])<<8|Number(t[3])):-1},isSameNet:function(e,t,d){var n;return""!=e&&(e=(n=this.ipToInt)(e),t=n(t),0!=(n=n(d))&&(e&n)==(t&n))},getLimitIp:function(e,t,d){for(var n,i=e.split("."),r=t.split("."),a=i.length,o=(r.length,[]),s=0;s<a;++s)"min"==d?o.push(i[s]&r[s]):(n=parseInt(r[s]),o.push(n<128?i[s]|128+(~n-128<<24>>24):i[s]|~n<<24>>24));return o.join(".")},checkIPAddrSubmit:function(){for(var e,t=this,d=t.ipFilter(o.dmz.ipAddr.getValue()),n=o.lanAdvLanModel.ipaddr.getValue(),i=o.lanAdvLanModel.maskType.getValue(),r=s.lanAdvSubnetCombo.getData(),a=0;a<r.length;a++)r[a].value==i&&(e=r[a].name);return e==m.su.CHAR.NETWORK_LAN.CUSTOM&&(e=o.lanAdvLanModel.customValue.getValue()),t.isSameNet(d,n,e)?d==t.getLimitIp(n,e,"min")||d==t.getLimitIp(n,e,"max")?(o.dmz.ipAddr.setError(m.su.CHAR.DMZ.ERROR2),!1):d!=n||(o.dmz.ipAddr.setError(m.su.CHAR.DMZ.ERROR3),!1):(o.dmz.ipAddr.setError(m.su.CHAR.DMZ.ERROR1),!1)},ipFilter:function(e){return"string"===m.type(e)?e.split(/\s+/)[0]:e}}})}(jQuery);