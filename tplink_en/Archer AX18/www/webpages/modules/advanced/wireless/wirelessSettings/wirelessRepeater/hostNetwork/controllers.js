!function(g){g.su.moduleManager.define("hostNetwork",{deps:["main"],services:["ajax","device"],models:["hostNetworkM"],stores:["hostSecurityStore","hostNetworkModeStore","wdsScanStore"],views:["hostNetworkView"],listeners:{ev_on_launch:function(e,t,n,o,s,i,a){o.hostNetworkM.load(),t.initView()}},init:function(n,o,e,t,s,i){this.configViews({id:"hostNetworkView",items:[{id:"grid-scan",configs:{paging:{items:[{name:"6",value:6,selected:!0}]},columns:[{xtype:"checkcolumn",width:80},{text:g.su.CHAR.WIFI_SHARING.SSID,dataIndex:"ssid"},{text:g.su.CHAR.WIRELESS_SETTINGS.MAC,dataIndex:"bssid"},{text:g.su.CHAR.WIRELESS_SETTINGS.SIGNAL,dataIndex:"signal",cls:"center-td",width:80,renderer:n.formatSignalHTML},{text:g.su.CHAR.WIRELESS_SETTINGS.SECURITY,dataIndex:"encryption",xtype:"actioncolumn",cls:"center-td",width:80,items:[],renderer:n.formatSecurityHTML}]}},{id:"cannot-find-wifi-notes",title:" ",items:[{text:g.su.CHAR.WIRELESS_SETTINGS.CANNOT_FIND_WIFI_NOTE_1},{text:g.su.CHAR.WIRELESS_SETTINGS.CANNOT_FIND_WIFI_NOTE_2},{text:g.su.CHAR.WIRELESS_SETTINGS.CANNOT_FIND_WIFI_NOTE_3},{text:g.su.CHAR.WIRELESS_SETTINGS.CANNOT_FIND_WIFI_NOTE_4}]}]}),this.listen({"models.hostNetworkM.mode":{ev_value_change:n.modeChangeHandler},"models.hostNetworkM.bridgeEnabled2g":{ev_value_change:function(e,t){n.bridgeEnableHandler(n.SUPPORT_MODE["2G"],t)}},"models.hostNetworkM.bridgeEnabled5g":{ev_value_change:function(e,t){n.bridgeEnableHandler(n.SUPPORT_MODE["5G"],t)}},"models.hostNetworkM.lockToAp2g":{ev_value_change:function(e,t){n.lockToApHanlder(n.SUPPORT_MODE["2G"],t)}},"models.hostNetworkM.lockToAp5g":{ev_value_change:function(e,t){n.lockToApHanlder(n.SUPPORT_MODE["5G"],t)}},"models.hostNetworkM.securityType2g":{ev_value_change:function(e,t){n.securityTypeHanlder(n.SUPPORT_MODE["2G"],t)}},"models.hostNetworkM.securityType5g":{ev_value_change:function(e,t){n.securityTypeHanlder(n.SUPPORT_MODE["5G"],t)}},"stores.wdsScanStore":{ev_loaded:n.disableUnsupportWifi}}),this.control({".cannot-find-btn":{ev_button_click:function(e){o.hostNetworkView.cannotFindWifiMsg.show()}},".scan-btn":{ev_button_click:function(e){e=g(e.currentTarget).attr("data-mode");n.setScanMode(e),n.startScan()}},"#scan-msg":{ev_msg_ok:n.replaceHostNetworkMData},"#grid-scan":{ev_grid_row_clicked:function(e,t){n.setSelectedKey(t),o.hostNetworkView.scanMsg.enableButton("ok")},ev_grid_tbar_refresh:n.startScan}})}},function(s,o,i,a,t,n){var r=["on","on"],c={"2g":0,"5g":1},d={none:{version:"auto",cipher:"auto"},psk:{version:"rsn",cipher:"aes"},psk_sae:{version:"sae_transition",cipher:"aes"}},l="",u="",e=n.device.getCurrentMode();function w(){return"client"==e}function h(e){o.hostNetworkView["connectFieldset"+e].disable(),1==g.grep(r,function(e){return"on"==e}).length&&S("disable",e)}function S(n,o){w()||g.each(c,function(e,t){e!=o&&i.hostNetworkM["bridgeEnabled"+e][n](!0)})}return{SUPPORT_MODE:{"2G":"2g","5G":"5g"},initView:function(){g("."+e+"-mode").show(),w()||(o.hostNetworkView.connectFieldset2g.show(),o.hostNetworkView.connectFieldset5g.show())},modeChangeHandler:function(e,n){w()?g.each(c,function(e,t){e==n?(o.hostNetworkView["connectFieldset"+e].show(),i.hostNetworkM["bridgeEnabled"+e].setValue("on"),s.bridgeEnableHandler(e,"on")):(o.hostNetworkView["connectFieldset"+e].hide(),i.hostNetworkM["bridgeEnabled"+e].setValue("off"),s.bridgeEnableHandler(e,"off"))}):i.hostNetworkM.mode.disable()},bridgeEnableHandler:function(e,t){"on"==(r[c[e]]=t)?(t=e,o.hostNetworkView["connectFieldset"+t].enable(),S("enable",t),s.lockToApHanlder(e,i.hostNetworkM["lockToAp"+e].getValue()),s.securityTypeHanlder(e,i.hostNetworkM["securityType"+e].getValue(),!0)):h(e)},lockToApHanlder:function(e,t){"on"==t?i.hostNetworkM["bridgedBssid"+e].enable():i.hostNetworkM["bridgedBssid"+e].disable()},securityTypeHanlder:function(e,t,n){if(t){var o=i.hostNetworkM["password"+e];switch(t){case"psk":o.show(),o.enable(),o.setVtype("psk_password"),o.setMaxLength(64);break;case"psk_sae":o.show(),o.enable(),o.setVtype("wpa3_password"),o.setMaxLength(63);break;default:o.hide(),o.disable()}n||s.setEncryptionToDefault(e,t)}},setEncryptionToDefault:function(e,t){var n;s.getSelectedKey()?s.setSelectedKey(""):(n=i.hostNetworkM["pskVersion"+e],e=i.hostNetworkM["pskCipher"+e],n.setValue(d[t].version),e.setValue(d[t].cipher))},setScanMode:function(e){l=e},getScanMode:function(){return l},setSelectedKey:function(e){u=e},getSelectedKey:function(){return u},getScanProxy:function(){switch(l){case s.SUPPORT_MODE["2G"]:return"wlanScanProxy";case s.SUPPORT_MODE["5G"]:return"wlanScan5gProxy"}},startScan:function(){o.hostNetworkView.scanMsg.hide(),t.main.showLoading(g.su.CHAR.OPERATION.SCANNING),s.loadWdsScanStore()},loadWdsScanStore:function(){function e(){setTimeout(t.main.hideLoading,300)}n.ajax.request({proxy:s.getScanProxy(),success:function(e){a.wdsScanStore.loadData(e),setTimeout(function(){t.main.hideLoading(),o.hostNetworkView.scanMsg.disableButton("ok"),o.hostNetworkView.scanMsg.show()},300)},fail:e,error:e})},replaceHostNetworkMData:function(){var e=a.wdsScanStore.getModelByKey(s.getSelectedKey()).getData(),t=s.getScanMode(),n={};n["bridgedSsid"+t]=e.ssid,n["bridgedBssid"+t]=e.bssid,n["password"+t]="",n["securityType"+t]=e.encryption,n["pskVersion"+t]=e.psk_version||"",n["pskCipher"+t]=e.psk_cipher||"",i.hostNetworkM.replaceData(n)},disableUnsupportWifi:function(){var n=a.wdsScanStore,e=n.getData(),e=g.grep(e,function(e){return"unknown"==e.encryption});e.length&&g.each(e,function(e,t){n.getModelByKey(t.key).disableRow(!0)})},formatSignalHTML:function(e){return'<div class="signal-level-container widget-container"><span class="icon icon-signal-%signal%"></span></div>'.replace("%signal%",(e=e,(e=Math.floor(parseInt(e,10)/10))<1?1:5<e?5:e))},formatSecurityHTML:function(e){var t="",n="";switch(e){case"unknown":n="unknown-security",t=g.su.CHAR.WIRELESS_SETTINGS.UNSUPPORT_ENCRYPTION_NOTE;break;case"none":n="none-security";break;default:n="security"}return'<div class="security-container widget-container"><span class="icon icon-%security%" data-tip="%tip%" tip-max-width="200px"></span></div>'.replace("%security%",n).replace("%tip%",t)}}})}(jQuery);