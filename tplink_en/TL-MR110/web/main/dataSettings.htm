<script>function selectObj(t){t&&(t.focus(),t.select())}function numCheck(t){return!!(/^(?:0|[1-9]\d*)(?:\.\d+)?$/.exec(t)&&0<=t&&1e4>t)}function fixedNum(t){return/^(?:0|[1-9]\d*)(?:\.\d{1,3})?/.exec(t)}function checkParam(){var t,e=$("#enDataLimit").hasClass("selected")?1:0,a=$("#t_enMonthDataStat").hasClass("selected")?1:0,n=!1;if(!$("#tu_correct_div").hasClass("nd")){if(t=$("#tu_correct_input").prop("value"),!numCheck(t))return $.alert(ERR_LTE_DATA_MAXLEN_ERROR),selectObj($("#tu_correct_input")),!1;n=!0}if(1==e){if(t=$("#totalAllowance").prop("value"),!numCheck(t))return $.alert(ERR_LTE_DATA_MAXLEN_ERROR_NO_ZERO),selectObj($("#totalAllowance")),!1;if(t<1)return $.alert(ERR_LTE_DATA_MAXLEN_ERROR_NO_ZERO),selectObj($("#totalAllowance")),!1;if(0==$("#taUnit").data("value")?t*=FLOW_UNIT_MB:t*=FLOW_UNIT_GB,t!=parseInt(curWanLTEIntfCfg.limitation,10)&&(n=!0),t=$("#usageAlert").prop("value"),$.num(t,[1,99],!0))return $.alert(ERR_LTE_DATA_INVALID_ALERT_PERCENT_OPEN_INTERVAL),selectObj($("#usageAlert")),!1;if(t!=curWanLTEIntfCfg.warningPercent&&(n=!0),INCLUDE_DATALIMIT_SMS_ALERT){if(t=$("#smsAlert").prop("value"),!checkPhoneNum(t))return!1;t!=curWanLTEIntfCfg.warnSimNumber&&(n=!0)}}if(1==a){if(t=$("#startDate").prop("value"),$.num(t,[1,31],!0)||t.length>2||0==t[0])return $.alert(ERR_LTE_DATA_INVALID_PAYMENT_DAY),selectObj($("#startDate")),!1;t!=curWanLTEIntfCfg.paymentDay&&(n=!0)}return e==curWanLTEIntfCfg.enableDataLimit&&a==curWanLTEIntfCfg.enablePaymentDay||(n=!0),n}function refleshBtnText(){retryTime<=60&&($("#send").text(m_str.retryafter+retryTime+m_str.seconds),retryTimer=$.timeout(refleshBtnText,1e3),0==retryTime&&("undefined"!=retryTimer&&(clearTimeout(retryTimer),retryTime=0),$("#send").css("background","#23c4c4"),$("#send").text("Send Test Message"),enableSendSms=!0)),retryTime--}function smsSendResult(){++retryTime<40?(res=$.act(ACT_GET,LTE_SMS_SENDNEWMSG,null,null,["sendResult"]),$.exe()||(1==res.sendResult?("undefined"!=retryTimer&&(clearTimeout(retryTimer),retryTime=0),$.removeLoading(),$("#t_notice").text(m_str.messagesent),$("#send").css("background","#b2b2b2"),$("#send").text(m_str.retry),retryTime=60,enableSendSms=!1,refleshBtnText()):retryTimer=$.timeout(smsSendResult,500))):($.removeLoading(),clearTimeout(retryTimer),retryTime=0,$("#t_notice").text(m_str.smstestfail))}function checkPhoneNum(t){var e,a,n=0;if(t.length>=21?(n=1,$.alert(ERR_LTE_SMS_PHONE_NUM_LEN)):"+"==(a=t.charAt(0))||$.isnum(a)?"+"==a?(e=t.substring(1,t.length),$.isnum(e)||(n=1,$.alert(ERR_LTE_SMS_PHONE_NUM_FORMAT))):$.isnum(t)||(n=1,$.alert(ERR_LTE_SMS_PHONE_NUM_FORMAT)):(n=1,$.alert(ERR_LTE_SMS_PHONE_NUM_FORMAT)),1==n){var r=$("#smsAlert");return r&&(r.focus(),r.select()),!1}return!0}function doEscapeCharEncode(t){for(var e="",a=0;a<t.length;a++)"\n"==t.charAt(a)?e+="":"\r"==t.charAt(a)?e+="":e+=t[a];return e}function init(){var t,e,a,n=$.act(ACT_GL,WAN_LTE_INTF_CFG,null,null),r=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);document.getElementById("smsAlert").setAttribute("placeholder",$.tpLang.m_str.phone_num_enter),INCLUDE_DATALIMIT_SMS_ALERT||$("#t_SmsAlert").addClass("nd"),$.exe()||($.each(r,function(){"LTE"==this.WANAccessType&&(a=this.__stack)}),$.each(n,function(){1==this.enable&&a==this.__stack&&((curWanLTEIntfCfg=this).totalStatistics<FLOW_UNIT_GB?(t=curWanLTEIntfCfg.totalStatistics/FLOW_UNIT_MB,t=t.toFixed(FLOAT_DIGIT),t+=m_str.mb,$("#tu_traffic_disInput").text(t)):(t=curWanLTEIntfCfg.totalStatistics/FLOW_UNIT_GB,t=t.toFixed(FLOAT_DIGIT),t+=m_str.gb,$("#tu_traffic_disInput").text(t)),(e=Math.ceil(this.limitation))<FLOW_UNIT_GB?((e=(e/=FLOW_UNIT_MB).toFixed(FLOAT_DIGIT))<1?$("#totalAllowance").prop("value",""):$("#totalAllowance").prop("value",e),$("#taUnit option[value='0']").prop("selected","selected")):(e=(e/=FLOW_UNIT_GB).toFixed(FLOAT_DIGIT),$("#totalAllowance").prop("value",e),$("#taUnit option[value='1']").prop("selected","selected")),curWanLTEIntfCfg.warningPercent<1||curWanLTEIntfCfg.warningPercent>99?$("#usageAlert").prop("value",90):$("#usageAlert").prop("value",curWanLTEIntfCfg.warningPercent),INCLUDE_DATALIMIT_SMS_ALERT&&0!=curWanLTEIntfCfg.warnSimNumber&&$("#smsAlert").prop("value",curWanLTEIntfCfg.warnSimNumber),$("#startDate").prop("value",this.paymentDay),1==this.enableDataLimit?$("#enDataLimit").click():$("#disDataLimit").click(),1==this.enablePaymentDay?$("#t_enMonthDataStat").click():$("#t_disMonthDataStat").click())}))}var FLOW_UNIT_MB=1048576,FLOW_UNIT_GB=1073741824,FLOAT_DIGIT=3,MAX_MONTHLY_ALLOWANCE=9999,MAX_ADJUST_DATA=9999,curWanLTEIntfCfg={},enableSendSms=!0;if($("#correct").click(function(){$("#tu_display_div").removeClass("inline"),$("#tu_display_div").addClass("nd"),$("#tu_correct_div").removeClass("nd"),$("#tu_correct_div").addClass("inline")}),$("#cancel").click(function(){$("#tu_correct_div").removeClass("inline"),$("#tu_correct_div").addClass("nd"),$("#tu_display_div").removeClass("nd"),$("#tu_display_div").addClass("inline")}),$("#enDataLimit").click(function(){$("#dataLimit_cfg_div").removeClass("nd")}),$("#disDataLimit").click(function(){$("#dataLimit_cfg_div").addClass("nd")}),$("#t_enMonthDataStat").click(function(){$("#monthDataStat_cfg_div").removeClass("nd"),$("#t_tuDisplay_totalUsed").empty(),$("#t_tuDisplay_totalUsed").text(m_str.monthlyused),$("#t_tuCorrect_totalUsed").empty(),$("#t_tuCorrect_totalUsed").text(m_str.monthlyused),$("#t_totalAllowance").empty(),$("#t_totalAllowance").text(m_str.monthlyallowance)}),$("#t_disMonthDataStat").click(function(){$("#monthDataStat_cfg_div").addClass("nd"),$("#t_tuDisplay_totalUsed").empty(),$("#t_tuDisplay_totalUsed").text(m_str.totalused),$("#t_tuCorrect_totalUsed").empty(),$("#t_tuCorrect_totalUsed").text(m_str.totalused),$("#t_totalAllowance").empty(),$("#t_totalAllowance").text(m_str.totalallowance)}),INCLUDE_DATALIMIT_SMS_ALERT){var retryTimer,retryTime=0;$("#send").click(function(){var t,e=$("#smsAlert").prop("value");return!!enableSendSms&&(e.length<=0?($.alert(ERR_LTE_SMS_PHONE_NUM_LEN),!1):!!checkPhoneNum(e)&&(t=doEscapeCharEncode("This is a test message from TP-Link 4G LTE Router. This phone number will be used to receive data usage alerts via SMS. :)"),$.addLoading($(this)),$.act(ACT_SET,LTE_SMS_SENDNEWMSG,null,null,["index=1","to="+e,"textContent="+t]),void $.exe(function(t){return smsSendResult(),!1})))})}$("#save").click(function(){var t={};if(0==checkParam())return!1;$("#tu_correct_div").hasClass("nd")?t.adjustStatistics=-1:0==$("#tuCorUnit").data("value")?t.adjustStatistics=fixedNum($("#tu_correct_input").prop("value"))*FLOW_UNIT_MB:t.adjustStatistics=fixedNum($("#tu_correct_input").prop("value"))*FLOW_UNIT_GB,$("#enDataLimit").hasClass("selected")?(t.enableDataLimit=1,0==$("#taUnit").data("value")?t.limitation=fixedNum($("#totalAllowance").prop("value"))*FLOW_UNIT_MB:t.limitation=fixedNum($("#totalAllowance").prop("value"))*FLOW_UNIT_GB,t.warningPercent=$("#usageAlert").prop("value"),INCLUDE_DATALIMIT_SMS_ALERT&&(t.warnSimNumber=$("#smsAlert").prop("value"))):t.enableDataLimit=0,$("#t_enMonthDataStat").hasClass("selected")?(t.enablePaymentDay=1,t.paymentDay=$("#startDate").prop("value")):t.enablePaymentDay=0,$.act(ACT_SET,WAN_LTE_INTF_CFG,curWanLTEIntfCfg.__stack,null,t),$.addLoading($(this)),$.exe(function(t){$.removeLoading(),$.reload()})})</script>

<h3 id="t_sett">Data Settings</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
    	
    	<div id="totalUsed_div">
    		<div id="tu_display_div" class="button-group-container inline">
    			<div id="tu_traffic_disInput_div" class="inline">
    				<label class="label-title T_totalUsed" id="t_tuDisplay_totalUsed">Total Used:</label>
					<span id="tu_traffic_disInput" class="T_mb_0">0 MB</span>    				
    			</div>
    			<div id="correct_div" class="inline" style="margin-left:80px">
    				<button type="submit" class="green T_correct l_auto" id="correct">Correct</button>
    			</div>
    		</div>
    		<div id="tu_correct_div" class="nd">   			
    			<div id="tu_correct_input_div" class="inline">
    				<label class="label-title T_totalUsed" id="t_tuCorrect_totalUsed">Total Used:</label>
    				<input type="text" id="tu_correct_input" required>
    			</div>
    			<div id="tuCorUnit_sel_div" class="inline" style="margin-left:10px">
        			<select id="tuCorUnit" class="s">
        				<option value="0" id="tuCorUnit_MB">MB</option>
        				<option value="1" id="tuCorUnit_GB">GB</option>
        			</select>
        		</div>
        		<div id="cancel_div" class="inline" style="margin-left:20px">
        			<button type="submit" class="green T_cancel" id="cancel">Cancel</button>
        		</div>
    		</div>
    	</div>
		
    	<p class="cfg-line" id="t_msg" style="margin-top:8px">You can send messages to your carrier for accurate data usage.</p>
        
		<div class="button-group-container">
            <b id="t_dataLimit">Data Limit:</b>
			<ul><li><button id="enDataLimit" class="fst" value="on">On</button></li>
                <li><button id="disDataLimit" class="lst" value="off">Off</button></li>
            </ul>
        </div>
		
        <div id="dataLimit_cfg_div">
        	<p class="cfg-line" id="t_msg1">The device will automatically disconnect from the network when data usage reaches the limit.</p>
        	<div class="inline">
        		<label class="label-title" id="t_totalAllowance">Total Allowance:</label>
        		<input type="text" id="totalAllowance" required>
        	</div>
        	<div class="inline" style="margin-left:10px">
        		<select id="taUnit" class="s">
        			<option value="0" id="taUnit_MB">MB</option>
        			<option value="1" id="taUnit_GB">GB</option>
        		</select>
        	</div>
        	<div><b id="t_usageAlert">Usage Alert:</b>
				<input type="text" id="usageAlert" required><span id="t_percent">%</span>
			</div>
            <div id="t_SmsAlert">
                <b id="t_smsAlertUse">SMS Alert for Usage:</b>
				<input type="text" id="smsAlert" maxlength="20">
                <div class="inline">
                    <button type="submit" class="green T_sendtest" style="margin-left:10px;width:270px" id="send">Send Test Message</button>
                </div>
                <span id="t_notice" class="T_smsCharge">Note:This function may cause SMS charges.</span>
			</div>
        </div>
		
        <div class="button-group-container">
            <b id="t_monthDataStat">Monthly Data Statistics:</b>
            <ul><li><button id="t_enMonthDataStat" class="fst" value="on">On</button></li>
                <li><button id="t_disMonthDataStat" class="lst" value="off">Off</button></li>
            </ul>
        </div>
		
        <div id="monthDataStat_cfg_div">
        	<div><b id="t_startDate">Start Date:</b><input type="text" id="startDate" required></div>
        </div>

        <button type="submit" class="green T_save" id="save">Save</button>
    </form>
</div>

<script>$.tpInit(init)</script>

