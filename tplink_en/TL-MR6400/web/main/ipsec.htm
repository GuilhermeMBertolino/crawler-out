<script language="javascript">function initTable(){selAll=0,index=0,allStk=[];var e=new Array,p=$.act(ACT_GET,IPSEC,[0,0,0,0,0,0]);$.exe()||(1==p.enableDPD?($("#dpd_on").addClass("selected"),$("#dpd_off").removeClass("selected")):($("#dpd_on").removeClass("selected"),$("#dpd_off").addClass("selected")));var a=$.act(ACT_GL,IPSEC_CFG,null,null,["entryID","connName","remoteGWAddress","localIPAddress","remoteIPAddress","enable","status"]);return $.exe()||$.each(a,function(){var p="["+this.__stack+"]";currentIndexArr[this.entryID]=-1,index++,0==this.enable?e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one" /><label></label></div></span>',width:"5%"},{text:$.htmlEncodeStr(this.connName),width:"20%"},{text:$.htmlEncodeStr(this.remoteGWAddress),width:"15%"},{text:this.localIPAddress,width:"15%"},{text:this.remoteIPAddress,width:"15%"},{text:"Disabled",width:"10%"},{text:"<span class='table-grid-icon disable-icon' id='en_"+index+"' onclick='doEnable(\"ip\", "+p+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ip\", "+p+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ip\", "+p+");'></span>",width:"10%"}]):0==this.status?e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one" /><label></label></div></span>',width:"5%"},{text:$.htmlEncodeStr(this.connName),width:"20%"},{text:$.htmlEncodeStr(this.remoteGWAddress),width:"15%"},{text:this.localIPAddress,width:"15%"},{text:this.remoteIPAddress,width:"15%"},{text:"Down",width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable(\"ip\", "+p+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit(\"ip\", "+p+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel(\"ip\", "+p+");'></span>",width:"10%"}]):e.push([{text:'<span><div><input type="checkbox" id="'+index+'" class="table-select-one" /><label></label></div></span>',width:"5%"},{text:$.htmlEncodeStr(this.connName),width:"20%"},{text:$.htmlEncodeStr(this.remoteGWAddress),width:"15%"},{text:this.localIPAddress,width:"15%"},{text:this.remoteIPAddress,width:"15%"},{text:"Up",width:"10%"},{text:"<span class='table-grid-icon enable-icon' id='en_"+index+"' onclick='doEnable("+index+" , "+p+");'></span>",width:"10%"},{text:"<span class='table-grid-icon edit-modify-icon' id='edit_"+index+"' onclick='doEdit("+index+" , "+p+");'></span><span class='table-grid-icon edit-trash-icon' id='del_"+index+"' onclick='doDel("+index+", "+p+");'></span>",width:"10%"}]),allStk[index-1]=this.__stack}),$.initTableBody($("#table-ipsec"),e),e}function checkIpMask(e,p){if(-1!=(p=$.ip2num(p))&&-2!=p)return!0;if(-2==p)return!1;var a,t=$.ip2num(e)>>24;return!!(a=e.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))&&(t>=-128&&t<-64?!(0==a[3]&&0==a[4]||255==a[3]&&255==a[4]):t>=-64&&t<-32?0!=a[4]&&255!=a[4]:t>=1&&t<127&&!(0==a[2]&&0==a[3]&&0==a[4]||255==a[2]&&255==a[3]&&255==a[4]))}function initConfig(){$("#connName").prop("value","Name"),$("#remoteGWAddr").prop("value","0.0.0.0"),$("#localIP").tpAddress("val","0.0.0.0"),$("#localMask").tpAddress("val","255.255.255.0"),$("#remoteIP").tpAddress("val","0.0.0.0"),$("#remoteMask").tpAddress("val","255.255.255.0"),$("#psk").prop("value","psk_key"),$("#ph1KeyTime").prop("value","3600"),$("#ph2KeyTime").prop("value","3600"),$("#spi").prop("value","101"),$("#adv").addClass("nd"),$("#ManualKey").addClass("nd"),$("#advSWButton").removeClass("nd"),$("#advSWButton").removeClass("cln"),$("#ph1MyId").prop("disabled","true"),$("#ph1PeerId").prop("disabled","true")}function checkLifeTime(e){var p=/^[0-9]*[1-9][0-9]*$/;return-1!=e.search(p)}function checkSPI(){var e=$.id("spi").value,p=/^[0-9a-fA-F]{3,8}$/,a=parseInt(e,16);a.toString(16);return-1!=e.search(p)&&!(a<256||a>4294967295)}function isValidHexKey(e,p){var a=!1;if(e.length==p){for(i=0;i<e.length&&0!=isHexaDigit(e.charAt(i));i++);i==e.length&&(a=!0)}return a}function isHexaDigit(e){var p=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","a","b","c","d","e","f"),a=p.length,t=0,l=!1;for(t=0;t<a&&e!=p[t];t++);return t<a&&(l=!0),l}function doEdit(e,p){editFlag=1,curStk=p,ipsecCfgObj=$.act(ACT_GET,IPSEC_CFG,curStk,null),$.exe(function(e){if(!e){tunnel_enable=ipsecCfgObj.enable,$("#connName").prop("value",ipsecCfgObj.connName),$("#remoteGWAddr").prop("value",ipsecCfgObj.remoteGWAddress),0==ipsecCfgObj.localIPMode?$("#localIPMode option[value='0']").prop("selected","selected"):$("#localIPMode option[value='1']").prop("selected","selected");p={refresh:1};$("#localIPMode").tpSelect(p),$("#localIP").tpAddress("val",ipsecCfgObj.localIPAddress),0==ipsecCfgObj.localIPMode?$("#localMask").tpAddress("val",ipsecCfgObj.localMask):($("#localMask").tpAddress("val","255.255.255.255"),$("#localMask").tpAddress("disabled",!0)),0==ipsecCfgObj.remoteIPMode?$("#remoteIPMode option[value='0']").prop("selected","selected"):$("#remoteIPMode option[value='1']").prop("selected","selected");p={refresh:1};$("#remoteIPMode").tpSelect(p),$("#remoteIP").tpAddress("val",ipsecCfgObj.remoteIPAddress),0==ipsecCfgObj.remoteIPMode?$("#remoteMask").tpAddress("val",ipsecCfgObj.remoteMask):($("#remoteMask").tpAddress("val","255.255.255.255"),$("#remoteMask").tpAddress("disabled",!0)),0==ipsecCfgObj.keyExMethod?$("#keyExM option[value='0']").prop("selected","selected"):$("#keyExM option[value='1']").prop("selected","selected");p={refresh:1};if($("#keyExM").tpSelect(p),0==ipsecCfgObj.keyExMethod){0==ipsecCfgObj.authMethod&&$("#authM option[value='0']").prop("selected","selected");p={refresh:1};$("#authM").tpSelect(p),$("#psk").prop("value",ipsecCfgObj.PSK),0==ipsecCfgObj.perfectFSEn?$("#perfectFSEn option[value='0']").prop("selected","selected"):$("#perfectFSEn option[value='1']").prop("selected","selected");p={refresh:1};$("#perfectFSEn").tpSelect(p),"main"==ipsecCfgObj.ph1Mode?($("#ph1Mode option[value='main']").prop("selected","selected"),$("#ph1MyIdType").prop("disabled",!0),$("#ph1PeerIdType").prop("disabled",!0)):($("#ph1Mode option[value='aggressive']").prop("selected","selected"),$("#ph1MyIdType").prop("disabled",!1),$("#ph1PeerIdType").prop("disabled",!1));p={refresh:1};$("#ph1Mode").tpSelect(p),"fqdn"!=ipsecCfgObj.ph1MyIdType?$("#ph1MyId").prop("disabled",!0):$("#ph1MyId").prop("value",ipsecCfgObj.ph1MyId),"fqdn"==ipsecCfgObj.ph1MyIdType?$("#ph1MyIdType option[value='fqdn']").prop("selected","selected"):$("#ph1MyIdType option[value='address']").prop("selected","selected");p={refresh:1};$("#ph1MyIdType").tpSelect(p),"fqdn"!=ipsecCfgObj.ph1PeerIdType?$("#ph1PeerId").prop("disabled",!0):$("#ph1PeerId").prop("value",ipsecCfgObj.ph1PeerId),"fqdn"==ipsecCfgObj.ph1PeerIdType?$("#ph1PeerIdType option[value='fqdn']").prop("selected","selected"):$("#ph1PeerIdType option[value='address']").prop("selected","selected");p={refresh:1};$("#ph1PeerIdType").tpSelect(p),"des"==ipsecCfgObj.ph1EncryptionAlo?$("#ph1EncryptionAlgo option[value='des']").prop("selected","selected"):"3des"==ipsecCfgObj.ph1EncryptionAlo?$("#ph1EncryptionAlgo option[value='3des']").prop("selected","selected"):"aes128"==ipsecCfgObj.ph1EncryptionAlo?$("#ph1EncryptionAlgo option[value='aes128']").prop("selected","selected"):"aes192"==ipsecCfgObj.ph1EncryptionAlo?$("#ph1EncryptionAlgo option[value='aes192']").prop("selected","selected"):"aes256"==ipsecCfgObj.ph1EncryptionAlo&&$("#ph1EncryptionAlgo option[value='aes256']").prop("selected","selected");p={refresh:1};$("#ph1EncryptionAlgo").tpSelect(p),"md5"==ipsecCfgObj.ph1IntegrityAlgo?$("#ph1IntegrityAlgo option[value='md5']").prop("selected","selected"):$("#ph1IntegrityAlgo option[value='sha1']").prop("selected","selected");p={refresh:1};$("#ph1IntegrityAlgo").tpSelect(p),"modp768"==ipsecCfgObj.ph1DHGroup?$("#ph1DHGroup option[value='modp768']").prop("selected","selected"):"modp1024"==ipsecCfgObj.ph1DHGroup?$("#ph1DHGroup option[value='modp1024']").prop("selected","selected"):"modp1536"==ipsecCfgObj.ph1DHGroup?$("#ph1DHGroup option[value='modp1536']").prop("selected","selected"):"modp2048"==ipsecCfgObj.ph1DHGroup?$("#ph1DHGroup option[value='modp2048']").prop("selected","selected"):"modp3072"==ipsecCfgObj.ph1DHGroup?$("#ph1DHGroup option[value='modp3072']").prop("selected","selected"):"modp4096"==ipsecCfgObj.ph1DHGroup?$("#ph1DHGroup option[value='modp4096']").prop("selected","selected"):"modp6144"==ipsecCfgObj.ph1DHGroup&&$("#ph1DHGroup option[value='modp6144']").prop("selected","selected");p={refresh:1};$("#ph1DHGroup").tpSelect(p),$("#ph1KeyTime").prop("value",ipsecCfgObj.ph1KeyTime),"des"==ipsecCfgObj.ph2EncryptionAlo?$("#ph2EncryptionAlgo option[value='des']").prop("selected","selected"):"3des"==ipsecCfgObj.ph2EncryptionAlo?$("#ph2EncryptionAlgo option[value='3des']").prop("selected","selected"):"aes128"==ipsecCfgObj.ph2EncryptionAlo?$("#ph2EncryptionAlgo option[value='aes128']").prop("selected","selected"):"aes192"==ipsecCfgObj.ph2EncryptionAlo?$("#ph2EncryptionAlgo option[value='aes192']").prop("selected","selected"):"aes256"==ipsecCfgObj.ph2EncryptionAlo&&$("#ph2EncryptionAlgo option[value='aes256']").prop("selected","selected");p={refresh:1};$("#ph2EncryptionAlgo").tpSelect(p),"hmac_md5"==ipsecCfgObj.ph2IntegrityAlgo?$("#ph2IntegrityAlgo option[value='hmac_md5']").prop("selected","selected"):$("#ph2IntegrityAlgo option[value='hmac_sha1']").prop("selected","selected");p={refresh:1};$("#ph2IntegrityAlgo").tpSelect(p),1==$("select#perfectFSEn").data("value")?$("#ph2DHGroup").prop("disabled",!1):$("#ph2DHGroup").prop("disabled",!0),"modp768"==ipsecCfgObj.ph2DHGroup?$("#ph2DHGroup option[value='modp768']").prop("selected","selected"):"modp1024"==ipsecCfgObj.ph2DHGroup?$("#ph2DHGroup option[value='modp1024']").prop("selected","selected"):"modp1536"==ipsecCfgObj.ph2DHGroup?$("#ph2DHGroup option[value='modp1536']").prop("selected","selected"):"modp2048"==ipsecCfgObj.ph2DHGroup?$("#ph2DHGroup option[value='modp2048']").prop("selected","selected"):"modp3072"==ipsecCfgObj.ph2DHGroup?$("#ph2DHGroup option[value='modp3072']").prop("selected","selected"):"modp4096"==ipsecCfgObj.ph2DHGroup?$("#ph2DHGroup option[value='modp4096']").prop("selected","selected"):"modp6144"==ipsecCfgObj.ph2DHGroup&&$("#ph2DHGroup option[value='modp6144']").prop("selected","selected");p={refresh:1};$("#ph2DHGroup").tpSelect(p),$("#ph2KeyTime").prop("value",ipsecCfgObj.ph2KeyTime),$("#ManualKey").addClass("nd"),$("#adv").addClass("nd")}else{"des-cbc"==ipsecCfgObj.manualEncryptionAlgo?$("#manualEncryptionAlgo option[value='des-cbc']").prop("selected","selected"):"3des-cbc"==ipsecCfgObj.manualEncryptionAlgo?$("#manualEncryptionAlgo option[value='3des-cbc']").prop("selected","selected"):"aes-cbc"==ipsecCfgObj.manualEncryptionAlgo&&$("#manualEncryptionAlgo option[value='aes-cbc']").prop("selected","selected");p={refresh:1};$("#manualEncryptionAlgo").tpSelect(p),$("#manualEncryptionKey").prop("value",ipsecCfgObj.manualEncryptionKey),"hmac-md5"==ipsecCfgObj.manualAuthAlgo?$("#manualAuthAlgo option[value='hmac-md5']").prop("selected","selected"):"hmac-sha1"==ipsecCfgObj.manualAuthAlgo&&$("#manualAuthAlgo option[value='hmac-sha1']").prop("selected","selected");var p={refresh:1};$("#manualAuthAlgo").tpSelect(p),$("#manualAuthKey").prop("value",ipsecCfgObj.manualAthKey),$("#spi").prop("value",ipsecCfgObj.SPI),$("#AutoKeyEx").addClass("nd"),$("#PSK_DIV").addClass("nd"),$("#Perfect_IKE").addClass("nd"),$("#adv").addClass("nd"),$("#advdiv").addClass("nd")}}})}function doEnable(e,p){var a=$.act(ACT_GET,IPSEC_CFG,p,null,null);$.exe(),0==a.enable?($.act(ACT_SET,IPSEC_CFG,p,null,["enable=1"]),$.exe(function(e){e||$.reload()})):($.act(ACT_SET,IPSEC_CFG,p,null,["enable=0"]),$.exe(function(e){e||$.reload()}))}function doDel(e,p){currentIndexArr[e]=e,$.act(ACT_DEL,IPSEC_CFG,p,null,null),$.exe(function(e){e||$.reload()})}var currentIndexArr=new Array(0,1,2,3,4,5,6,7,8,9),index=0,selAll,currentIndex=0,allStk,editFlag=0,curStk=new Array,ipsecCfgObj={},ipsecSaveObj={},tunnel_enable=1;$("#dpd_on").click(function(){$.addLoading($(this)),$.act(ACT_SET,IPSEC,[0,0,0,0,0,0],null,["enableDPD=1"]),$.exe(function(e){$.removeLoading(),e||$.reload()})}),$("#dpd_off").click(function(){$.addLoading($(this)),$.act(ACT_SET,IPSEC,[0,0,0,0,0,0],null,["enableDPD=0"]),$.exe(function(e){$.removeLoading(),e||$.reload()})}),$("#cancel").click(function(){editFlag=0;for(var e=0;e<curStk.length;e++)curStk[e]=-1;$.reload()}),$("#ok").click(function(){if($("#remoteGWAddr").prop("value").length<1)return $.alert(ERR_IPSEC_GW_INVALID),$("#remoteGWAddr").select(),void $("#remoteGWAddr").focus();if(0==$("select#localIPMode").data("value")){if(0!=$.ifip($("#localIP").tpAddress("val"),!0))return $.alert(ERR_IPSEC_LOCALIP_INVALID,$("#localIP").tpAddress("val")),$("#localIP").select(),void $("#localIP").focus();if(0!=$.mask($("#localMask").tpAddress("val"),!0))return $.alert(ERR_IPSEC_LOCALMASK_INVALID,$("#localMask").tpAddress("val")),$("#localMask").select(),void $("#localMask").focus();if(0==checkIpMask($("#localIP").tpAddress("val"),$("#localMask").tpAddress("val")))return $.alert(ERR_IPMASK_HOST_INVAD),$("#localIP").select(),void $("#localIP").focus()}else{if(0!=$.ifip($("#localIP").tpAddress("val"),!0))return $.alert(ERR_IPSEC_LOCALIP_INVALID,$("#localIP").tpAddress("val")),$("#localIP").select(),void $("#localIP").focus();if(0==checkIpMask($("#localIP").tpAddress("val"),$("#localMask").tpAddress("val")))return $.alert(ERR_IPMASK_HOST_INVAD),$("#localIP").select(),void $("#localIP").focus()}if(0==$("select#remoteIPMode").data("value")){if(0!=$.ifip($("#remoteIP").tpAddress("val"),!0))return $.alert(ERR_IPSEC_REMOTEIP_INVALID,$("#remoteIP").tpAddress("val")),$("#remoteIP").select(),void $("#remoteIP").focus();if(0!=$.mask($("#remoteMask").tpAddress("val"),!0))return $.alert(ERR_IPSEC_REMOTEMASK_INVALID,$("#remoteMask").tpAddress("val")),$("#remoteMask").select(),void $("#remoteMask").focus();if(0==checkIpMask($("#remoteIP").tpAddress("val"),$("#remoteMask").tpAddress("val")))return $.alert(ERR_IPMASK_HOST_INVAD),$("#remoteIP").select(),void $("#remoteIP").focus()}else{if(0!=$.ifip($("#remoteIP").tpAddress("val"),!0))return $.alert(ERR_IPSEC_REMOTEIP_INVALID,$("#remoteIP").tpAddress("val")),$("#remoteIP").select(),void $("#remoteIP").focus();if(0==checkIpMask($("#remoteIP").tpAddress("val"),$("#remoteMask").tpAddress("val")))return $.alert(ERR_IPMASK_HOST_INVAD),$("#remoteIP").select(),void $("#remoteIP").focus()}if(0==$("select#keyExM").data("value")){var e;if(0==$("#psk").prop("value").length)return $.alert(ERR_IPSEC_PRESHAREDKEY_INVALID),$("#psk").select(),void $("#psk").focus();if(e=parseInt($("#ph1KeyTime").prop("value")),1==isNaN(e)||e<0||0==checkLifeTime($("#ph1KeyTime").prop("value")))return $.alert(ERR_IPSEC_PHASE1_KEYLIFETIME_INVALID),$("#ph1KeyTime").select(),$("#ph1KeyTime").focus(),void $("#adv").removeClass("nd");if(e=parseInt($("#ph2KeyTime").prop("value")),1==isNaN(e)||e<0||0==checkLifeTime($("#ph2KeyTime").prop("value")))return $.alert(ERR_IPSEC_PHASE2_KEYLIFETIME_INVALID),$("#ph2KeyTime").select(),$("#ph2KeyTime").focus(),void $("#adv").removeClass("nd")}if(1==$("select#keyExM").data("value")){var p;if(-1!=(p="des-cbc"==$("select#manualEncryptionAlgo").data("value")?16:"3des-cbc"==$("select#manualEncryptionAlgo").data("value")?48:-1)&&0==isValidHexKey($("#manualEncryptionKey").prop("value"),p))return $.alert(ERR_IPSEC_MANUAL_ENKEY_INVALID),$("#manualEncryptionKey").select(),void $("#manualEncryptionKey").focus();if("aes-cbc"==$("select#manualEncryptionAlgo").data("value")){if(32!=$("#manualEncryptionKey").prop("value").length&&48!=$("#manualEncryptionKey").prop("value").length&&64!=$("#manualEncryptionKey").prop("value").length)return $.alert(ERR_IPSEC_AES_ENKEY_INVALID),$("#manualEncryptionKey").select(),void $("#manualEncryptionKey").focus();if(0==isValidHexKey($("#manualEncryptionKey").prop("value"),$("#manualEncryptionKey").prop("value").length))return $.alert(ERR_IPSEC_MANUAL_ENKEY_DIGITONLY),$("#manualEncryptionKey").select(),void $("#manualEncryptionKey").focus()}var a;if(-1!=(a="hmac-md5"==$("select#manualAuthAlgo").data("value")?32:"hmac-sha1"==$("select#manualAuthAlgo").data("value")?40:-1)&&0==isValidHexKey($("#manualAuthKey").prop("value"),a))return $.alert(ERR_IPSEC_MANUAL_AUKEY_INVALID),$("#manualAuthKey").select(),void $("#manualAuthKey").focus();if(0==checkSPI())return $.alert(ERR_IPSEC_SPI_VALUE_INVALID),$("#spi").select(),void $("#spi").focus()}if(ipsecSaveObj.entryID=currentIndex,ipsecSaveObj.enable=tunnel_enable,ipsecSaveObj.connName=$("#connName").prop("value"),ipsecSaveObj.remoteGWAddress=$("#remoteGWAddr").prop("value"),ipsecSaveObj.localIPMode=$("select#localIPMode").data("value"),ipsecSaveObj.localIPAddress=$("#localIP").tpAddress("val"),0==$("select#localIPMode").data("value")){ipsecSaveObj.localMask=$("#localMask").tpAddress("val");t=$.ip2num(ipsecSaveObj.localIPAddress)&$.ip2num(ipsecSaveObj.localMask);ipsecSaveObj.localIPAddress=$.num2ip(t)}if(ipsecSaveObj.remoteIPMode=$("select#remoteIPMode").data("value"),ipsecSaveObj.remoteIPAddress=$("#remoteIP").tpAddress("val"),0==$("select#remoteIPMode").data("value")){ipsecSaveObj.remoteMask=$("#remoteMask").tpAddress("val");var t=$.ip2num(ipsecSaveObj.remoteIPAddress)&$.ip2num(ipsecSaveObj.remoteMask);ipsecSaveObj.remoteIPAddress=$.num2ip(t)}if(ipsecSaveObj.keyExMethod=$("select#keyExM").data("value"),1==$("select#keyExM").data("value"))ipsecSaveObj.manualEncryptionAlgo=$("select#manualEncryptionAlgo").data("value"),ipsecSaveObj.manualEncryptionKey=$("#manualEncryptionKey").prop("value"),ipsecSaveObj.manualAuthAlgo=$("select#manualAuthAlgo").data("value"),ipsecSaveObj.manualAthKey=$("#manualAuthKey").prop("value"),ipsecSaveObj.SPI=$("#spi").prop("value"),ipsecSaveObj.secondSPI=$("#spi").prop("value");else{if(ipsecSaveObj.authMethod=$("select#authM").data("value"),ipsecSaveObj.PSK=$("#psk").prop("value"),ipsecSaveObj.perfectFSEn=$("select#perfectFSEn").data("value"),ipsecSaveObj.ph1Mode=$("select#ph1Mode").data("value"),ipsecSaveObj.ph1MyIdType=$("select#ph1MyIdType").data("value"),"fqdn"==$("select#ph1MyIdType").data("value")&&(ipsecSaveObj.ph1MyId=$("#ph1MyId").prop("value"),$("#ph1MyId").prop("value").length<1))return $.alert(ERR_IPSEC_MYIDENTIFIER_EMPTY),$("#ph1MyId").select(),void $("#ph1MyId").focus();if("fqdn"==$("select#ph1PeerIdType").data("value")&&(ipsecSaveObj.ph1PeerId=$("#ph1PeerId").prop("value"),$("#ph1PeerId").prop("value").length<1))return $.alert(ERR_IPSEC_PEERIDENTIFIER_EMPTY),$("#ph1PeerId").select(),void $("#ph1PeerId").focus();if(("fqdn"==$("select#ph1MyIdType").data("value")||"fqdn"==$("select#ph1PeerIdType").data("value"))&&"main"==$("select#ph1Mode").data("value"))return void $.alert(ERR_IPSEC_MODE_INVALID);ipsecSaveObj.ph1PeerIdType=$("select#ph1PeerIdType").data("value"),ipsecSaveObj.ph1EncryptionAlo=$("select#ph1EncryptionAlgo").data("value"),ipsecSaveObj.ph1IntegrityAlgo=$("select#ph1IntegrityAlgo").data("value"),ipsecSaveObj.ph1DHGroup=$("select#ph1DHGroup").data("value"),ipsecSaveObj.ph1KeyTime=$("#ph1KeyTime").prop("value"),ipsecSaveObj.ph2EncryptionAlo=$("select#ph2EncryptionAlgo").data("value"),ipsecSaveObj.ph2IntegrityAlgo=$("select#ph2IntegrityAlgo").data("value"),ipsecSaveObj.ph2DHGroup=$("select#ph2DHGroup").data("value"),ipsecSaveObj.ph2KeyTime=$("#ph2KeyTime").prop("value")}2==editFlag?$.act(ACT_ADD,IPSEC_CFG,null,null,ipsecSaveObj):$.act(ACT_SET,IPSEC_CFG,curStk,null,ipsecSaveObj),$.exe(function(e){e||$.reload()})}),$("#add").click(function(){var e;for(e=0;e<10;e++)if(-1!=currentIndexArr[e]){currentIndex=currentIndexArr[e];break}10==e&&($.alert(ERR_IPSEC_TUNNELS_FULL),$.reload()),initConfig(),editFlag=2}),$("#delAll").click(function(){ipsec_stack=[],ipsec_stackIndex=index,$.confirm(c_str.del_tunnels,function(){for(var e=0;e<ipsec_stackIndex;e++)ipsec_stack[e]=allStk[e];for(var p=0;p<ipsec_stackIndex;p++)$("#"+(p+1)).prop("data-checked")&&$.act(ACT_DEL,IPSEC_CFG,ipsec_stack[p],null);ipsec_stackIndex>0&&$.exe(function(e){e||$.reload()})})}),$("#advSWButton").click(function(){$("#advSWButton").hasClass("cln")?($("#adv").addClass("nd"),$("#advSWButton").removeClass("cln")):($("#adv").removeClass("nd"),$("#advSWButton").addClass("cln"))}),$("select#localIPMode").on("click",function(){var e=$("select#localIPMode").data("value");0==e&&$("#localMask").tpAddress("disabled",!1),1==e&&($("#localMask").tpAddress("val","255.255.255.255"),$("#localMask").tpAddress("disabled",!0))}),$("select#remoteIPMode").on("click",function(){var e=$("select#remoteIPMode").data("value");0==e&&$("#remoteMask").tpAddress("disabled",!1),1==e&&($("#remoteMask").tpAddress("val","255.255.255.255"),$("#remoteMask").tpAddress("disabled",!0))}),$("select#keyExM").on("click",function(){var e=$("select#keyExM").data("value");1==e&&($("#AutoKeyEx").addClass("nd"),$("#PSK_DIV").addClass("nd"),$("#Perfect_IKE").addClass("nd"),$("#adv").addClass("nd"),$("#advdiv").addClass("nd"),$("#ManualKey").removeClass("nd")),0==e&&($("#ManualKey").addClass("nd"),$("#AutoKeyEx").removeClass("nd"),$("#PSK_DIV").removeClass("nd"),$("#Perfect_IKE").removeClass("nd"),$("#advdiv").removeClass("nd"),$("#advSWButton").hasClass("cln")&&$("#adv").removeClass("nd"))}),$("select#perfectFSEn").on("click",function(){1==$("select#perfectFSEn").data("value")?$("#ph2DHGroup").prop("disabled",!1):$("#ph2DHGroup").prop("disabled",!0)}),$("select#ph1Mode").on("click",function(){if("fqdn"!=$("select#ph1MyIdType").data("value")&&"fqdn"!=$("select#ph1PeerIdType").data("value")||"main"!=$("select#ph1Mode").data("value")){var e=$("#ph1MyIdType").data("value");"address"==e?$("#ph1MyIdType option[value='address']").prop("selected","selected"):"fqdn"==e&&$("#ph1MyIdType option[value='fqdn']").prop("selected","selected");var p=$("#ph1PeerIdType").data("value");"address"==p?$("#ph1PeerIdType option[value='address']").prop("selected","selected"):"fqdn"==p&&$("#ph1PeerIdType option[value='fqdn']").prop("selected","selected"),"main"==$("select#ph1Mode").data("value")?($("#ph1MyIdType").prop("disabled",!0),$("#ph1PeerIdType").prop("disabled",!0)):"aggressive"==$("select#ph1Mode").data("value")&&($("#ph1MyIdType").prop("disabled",!1),$("#ph1PeerIdType").prop("disabled",!1));a={refresh:1};$("#ph1MyIdType").tpSelect(a),$("#ph1PeerIdType").tpSelect(a)}else{$.alert(ERR_IPSEC_MODE_AGGRESSIVE),$("#ph1Mode option[value='aggressive']").prop("selected","selected");var a={refresh:1};$("#ph1Mode").tpSelect(a)}}),$("select#ph1MyIdType").on("click",function(){if("address"==$("select#ph1MyIdType").data("value")&&($("#ph1MyId").prop("disabled",!0),$("#ph1MyId").prop("value","")),"fqdn"==$("select#ph1MyIdType").data("value")&&($("#ph1MyId").prop("disabled",!1),"main"==$("select#ph1Mode").data("value"))){$.alert(ERR_IPSEC_MODE_AGGRESSIVE),$("#ph1Mode option[value='aggressive']").prop("selected","selected");var e={refresh:1};$("#ph1Mode").tpSelect(e)}}),$("select#ph1PeerIdType").on("click",function(){if("address"==$("select#ph1PeerIdType").data("value")&&($("#ph1PeerId").prop("disabled",!0),$("#ph1PeerId").prop("value","")),"fqdn"==$("select#ph1PeerIdType").data("value")&&($("#ph1PeerId").prop("value",ipsecCfgObj.ph1PeerId||"0.0.0.0"),$("#ph1PeerId").prop("disabled",!1),"main"==$("select#ph1Mode").data("value"))){$.alert(ERR_IPSEC_MODE_AGGRESSIVE),$("#ph1Mode option[value='aggressive']").prop("selected","selected");var e={refresh:1};$("#ph1Mode").tpSelect(e)}})</script>

<h3 id="et">IPSec VPN</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div class="button-group-container">
            <b id="t_dpd">Dead Peer Detection:</b>
            <ul>
                <li>
                    <button id="dpd_on" class="fst" value="on">On</button>
                </li>
                <li>
                    <button id="dpd_off" class="lst" value="off">Off</button>
                </li>
            </ul>
        </div>
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span id="add" class="add-icon"></span>
                <label class="T_add">Add</label>
                <span id="delAll" class="delete-all-icon"></span>
                <label class="T_del">Delete</label>
            </div>
        </div>
        <table id="table-ipsec">
            <thead></thead>
            <tbody id="body-ipsec">
                <tr id="edit-container-ipsec" class="nd">
                    <td colspan="9">
                        <div>
                            <b id="t_conname" class="xxxl">IPSec Connection Name:</b>
                            <input class="xl" type="text" id="connName" maxlength="45">
                        </div>
                        <div>
                            <b id="t_remgwaddr" class="xxxl">Remote IPSec Gateway Address(URL):</b>
                            <input class="xl" type="text" id="remoteGWAddr" maxlength="45" title="'0.0.0.0' or 'www.example.com'">
                        </div>
                        <div class="part-separate">
                            <b id="t_tunlocaddr" class="xxxl">Tunnel access from local IP addresses:</b>
                            <select class="xl" id="localIPMode">
                                <option value="0" class="T_c_sub">Subnet</option>
                                <option value="1" class="T_c_singleaddr">Single Address</option>
                            </select>
                        </div>
                        <div>
                            <b class="xxxl T_c_addrVPN">IP Address for VPN:</b>
                            <input class="xl ip-address" type="text" id="localIP" maxlength="15">
                        </div>
                        <div>
                            <b class="xxxl T_c_submask">IP Subnetmask:</b>
                            <input class="xl ip-address" type="text" id="localMask" maxlength="15">
                        </div>
                        <div class="part-separate">
                            <b id="t_tunremaddr" class="xxxl">Tunnel access from remote IP addresses:</b>
                            <select class="xl" id="remoteIPMode">
                                <option value="0" class="T_c_sub">Subnet</option>
                                <option value="1" class="T_c_singleaddr">Single Address</option>
                            </select>
                        </div>
                        <div>
                            <b class="xxxl T_c_addrVPN">IP Address for VPN:</b>
                            <input class="xl ip-address" type="text" id="remoteIP" maxlength="15">
                        </div>
                        <div>
                            <b class="xxxl T_c_submask">IP Subnetmask:</b>
                            <input class="xl ip-address" type="text" id="remoteMask" maxlength="15">
                        </div>
                        <div class="part-separate">
                            <b id="t_kexmeth" class="xxxl">Key Exchange Method:</b>
                            <select class="xl" id="keyExM">
                                <option value="0" id="t_auto">Auto (IKE)</option>
                                <option value="1" id="t_manual">Manual</option>
                            </select>
                        </div>
                        <div id="AutoKeyEx">
                            <b id="t_authmeth" class="xxxl">Authentication Method:</b>
                            <select class="xl" id="authM">
                                <option value="0" class="T_c_presharekey">Pre-Shared Key</option>
                            </select>
                        </div>
                        <div id="PSK_DIV">
                            <b class="xxxl T_c_presharekey2">Pre-Shared Key:</b>
                            <input class="xl" type="text" id="psk" maxlength="255">
                        </div>
                        <div id="Perfect_IKE">
                            <b id="t_fosec" class="xxxl">Perfect Forward Secrecy:</b>
                            <select class="xl" id="perfectFSEn">
                                <option value="1" class="T_en">Enable</option>
                                <option value="0" class="T_dis">Disable</option>
                            </select>
                        </div>

                        <div class="advanced-block" id="advdiv">
                            <span class="advanced-icon advanced-hide-icon" id="advSWButton"></span>
                            <span class="T_adv">Advanced</span>
                        </div>
                        <div id="ManualKey">
                            <div>
                                <b class="xxxl T_enalgo">Encryption Algorithm:</b>
                                <select class="xl" id="manualEncryptionAlgo">
                                    <option value="des-cbc">DES</option>
                                    <option value="3des-cbc" selected="selected">3DES</option>
                                    <option value="aes-cbc">AES (aes-cbc)</option>
                                </select>
                            </div>
                            <div>
                                <b id="t_enkey" class="xxxl">Encryption Key:</b>
                                <input class="xl" type="text" id="manualEncryptionKey" maxlength="64" title="DES: 16 digit Hex, 3DES: 48 digit Hex">
                            </div>
                            <div>
                                <b id="t_authalgo" class="xxxl">Authentication Algorithm:</b>
                                <select class="xl" id="manualAuthAlgo">
                                    <option value="hmac-md5">MD5</option>
                                    <option value="hmac-sha1">SHA1</option>
                                </select>
                            </div>
                            <div>
                                <b id="t_authkey" class="xxxl">Authentication Key:</b>
                                <input class="xl" type="text" id="manualAuthKey" maxlength="40" title="MD5: 32 digit Hex, SHA1: 40 digit Hex">
                            </div>
                            <div>
                                <b class="xxxl">SPI:</b>
                                <input class="xl" type="text" id="spi" maxlength="8" title="Hex 100-FFFFFFFF">
                            </div>
                        </div>
                        <div id="adv">
                            <div class="part-separate">
                                <label class="label-title" id="t_phase">==Phase 1==</label>
                            </div>
                            <div class="part-separate">
                                <b class="xxxl T_mode">Mode:</b>
                                <select class="xl" id="ph1Mode">
                                    <option value="main" id="t_main" class="xxxl">Main</option>
                                    <option value="aggressive" id="t_aggr" class="xxxl">Aggressive</option>
                                </select>
                            </div>
                            <div>
                                <b id="t_myidtype" class="xxxl">My Identifier Type:</b>
                                <select class="xl" id="ph1MyIdType">
                                    <option value="address" id="t_locwanip">Local Wan IP</option>
                                    <option value="fqdn">FQDN</option>
                                </select>
                            </div>
                            <div>
                                <b id="t_myid" class="xxxl">My Identifier:</b>
                                <input class="xl" type="text" id="ph1MyId" maxlength="45">
                            </div>
                            <div>
                                <b id="t_remidtype" class="xxxl">Remote Identifier Type:</b>
                                <select class="xl" id="ph1PeerIdType">
                                    <option value="address" id="t_remwanip">Remote Wan IP</option>
                                    <option value="fqdn">FQDN</option>
                                </select>
                            </div>
                            <div>
                                <b id="t_remid" class="xxxl">Remote Identifier:</b>
                                <input class="xl" type="text" id="ph1PeerId" maxlength="45">
                            </div>
                            <div>
                                <b class="T_enalgo xxxl">Encryption Algorithm:</b>
                                <select class="xl" id="ph1EncryptionAlgo">
                                    <option value="des">DES</option>
                                    <option value="3des" selected="selected">3DES</option>
                                    <option value="aes128">AES - 128</option>
                                    <option value="aes192">AES - 192</option>
                                    <option value="aes256">AES - 256</option>
                                </select>
                            </div>
                            <div>
                                <b class="T_intealgo xxxl">Integrity Algorithm:</b>
                                <select class="xl" id="ph1IntegrityAlgo">
                                    <option value="md5">MD5</option>
                                    <option value="sha1">SHA1</option>
                                </select>
                            </div>
                            <div>
                                <b class="xxxl T_c_selectkeyex">Diffie-Hellman Group for Key Exchange:</b>
                                <select class="xl" id="ph1DHGroup">
                                    <option value="modp768">768bit</option>
                                    <option value="modp1024" selected="selected">1024bit</option>
                                    <option value="modp1536">1536bit</option>
                                    <option value="modp2048">2048bit</option>
                                    <option value="modp3072">3072bit</option>
                                    <option value="modp4096">4096bit</option>
                                </select>
                            </div>
                            <div>
                                <b class="xxxl T_c_keylife">Key Life Time:(Seconds)</b>
                                <input class="xl" type="text" id="ph1KeyTime" value="3600" maxlength="8">
                            </div>
                            <div class="part-separate">
                                <label class="label-title" id="t_phase2">==Phase 2==</label>
                            </div>
                            <div class="part-separate">
                                <b class="T_enalgo xxxl">Encryption Algorithm:</b>
                                <select class="xl" id="ph2EncryptionAlgo">
                                    <option value="des">DES</option>
                                    <option value="3des" selected="selected">3DES</option>
                                    <option value="aes128">AES - 128</option>
                                    <option value="aes192">AES - 192</option>
                                    <option value="aes256">AES - 256</option>
                                </select>
                            </div>
                            <div>
                                <b class="T_intealgo xxxl">Integrity Algorithm:</b>
                                <select class="xl" id="ph2IntegrityAlgo">
                                    <option value="hmac_md5">MD5</option>
                                    <option value="hmac_sha1">SHA1</option>
                                </select>
                            </div>
                            <div>
                                <b class="xxxl T_c_selectkeyex">Diffie-Hellman Group for Key Exchange:</b>
                                <select class="xl" id="ph2DHGroup">
                                    <option value="modp768">768bit</option>
                                    <option value="modp1024" selected="selected">1024bit</option>
                                    <option value="modp1536">1536bit</option>
                                    <option value="modp2048">2048bit</option>
                                    <option value="modp3072">3072bit</option>
                                    <option value="modp4096">4096bit</option>
                                </select>
                            </div>
                            <div>
                                <b class="xxxl T_c_keylife">Key Life Time:(Seconds)</b>
                                <input class="xl" type="text" id="ph2KeyTime" value="3600" maxlength="8">
                            </div>
                        </div>
                        <div class="inline-btn-right">
                            <button type="submit" class="green T_cancel" id="cancel">Cancel</button>
                            <button type="submit" class="green T_save" id="ok">Save</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</div>

<script>var headArray=[{text:'<div><input type="checkbox" id="checkbox_st" class="table-select-all" /><label></label></div>',width:"5%"},{text:table_str.connname,width:"20%"},{text:table_str.remgateway,width:"15%"},{text:table_str.locaddr,width:"15%"},{text:table_str.remaddr,width:"15%"},{text:table_str.status,width:"10%"},{text:table_str.enable,width:"10%"},{text:table_str.modify,width:"10%"}];$.initTableHead($("#table-ipsec"),headArray),$("#table-ipsec").tpTable(initTable),$.tpInit()</script>
