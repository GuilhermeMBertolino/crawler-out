<script language="javascript" type="text/javascript">
var apList, wlanList, wlanObj;
var isRefresh = 0;

var authMode = new Array(
    s_str.opensys, /* Ndis802_11AuthModeOpen = 0 */
    s_str.sharekey, /* Ndis802_11AuthModeShared = 1 */
    s_str.auto, /* Ndis802_11AuthModeAutoSwitch = 2 */
    "WPA", /* Ndis802_11AuthModeWPA = 3 */
    "WPA-PSK", /* Ndis802_11AuthModeWPAPSK = 4 */
    "WPA-None", /* Ndis802_11AuthModeWPANone = 5 */
    "WPA2", /* Ndis802_11AuthModeWPA2 = 6 */
    "WPA2-PSK", /* Ndis802_11AuthModeWPA2PSK = 7 */
    "WPA/WPA2", /* Ndis802_11AuthModeWPA1WPA2 = 8 */
    "WPA/WPA2-PSK" /* Ndis802_11AuthModeWPA1PSKWPA2PSK = 9 */
);

var wepStatus = new Array(
    "WEP",
    /* Ndis802_11WEPEnabled = 0,
	Ndis802_11Encryption1Enabled = Ndis802_11WEPEnabled, */
    "EncryptionDisabled",
    /* Ndis802_11WEPDisabled = 1,
	Ndis802_11EncryptionDisabled = Ndis802_11WEPDisabled, */
    "KeyAbsent",
    /* Ndis802_11WEPKeyAbsent = 2,
	Ndis802_11Encryption1KeyAbsent = Ndis802_11WEPKeyAbsent, */
    "EncryptionNotSupported",
    /* Ndis802_11WEPNotSupported = 3,
	Ndis802_11EncryptionNotSupported = Ndis802_11WEPNotSupported, */
    "TKIP",
    /* Ndis802_11TKIPEnable = 4,
	Ndis802_11Encryption2Enabled = Ndis802_11TKIPEnable, */
    "TKIP KeyAbsent", /* Ndis802_11Encryption2KeyAbsent = 5, */
    "AES",
    /* Ndis802_11AESEnable = 6,
	Ndis802_11Encryption3Enabled = Ndis802_11AESEnable, */
    "AES KeyAbsent", /* Ndis802_11Encryption3KeyAbsent = 7, */
    "TKIP or AES mix",
    /* Ndis802_11TKIPAESMix = 8, 
	Ndis802_11Encryption4Enabled = Ndis802_11TKIPAESMix,	/* TKIP or AES mix */
    "TKIP or AES mix KeyAbsent", /* Ndis802_11Encryption4KeyAbsent = 9, */
    "GroupWEP40", /* Ndis802_11GroupWEP40Enabled = 10, */
    "GroupWEP104" /* Ndis802_11GroupWEP104Enabled = 11,*/
);

function doConnect(apObj) {
    var param = new Object();

    param.wdsExist = 0;
    param.band = "_2g";

    if (apObj != null) {
        param.wdsExist = 1;
        param.SSID = apObj.SSID;
        param.BSSID = apObj.BSSID;
        param.channel = apObj.channel;
		param.authMode = apObj.authMode;
		param.wepStatus = apObj.wepStatus;
    }
    if ($.mainParam != undefined) {
        param.wdsEn = $.mainParam.wdsEn;
        param.scrollTop = $.mainParam.scrollTop;
		param.apModeType = $.mainParam.apModeType;
    }
	if($.mainParam.apModeType == '4') /*wisp*/
		$.loadMain('wirelessWispSettings.htm', param);
	else if($.mainParam.apModeType == '3')
		$.loadMain('wlConnect.htm', param); /*RE*/
	else if($.mainParam.apModeType == '0')  /*AP WDS*/
		$.loadMain('wirelessAdv.htm', param); /*RE*/
}

function initTbl(apList, page) {
    var array = [];
    index = 0;
    $.each(apList, function() {
        array.push([{
            "text": index + 1,
            "width": "5%"
        }, {
            "text": this.BSSID.replace(/\:/g, '-'),
            "width": "10%"
        }, {
            "text": this.SSID.replace(/\&/g, "&amp;").replace(/</g, "&lt;").replace(/ /g, "&nbsp;"),
            "width": ""
        }, {
            "text": this.RSSI,
            "width": "10%"
        }, {
            "text": this.channel,
            "width": "10%"
        }, {
            "text": 0 == this.securityEnable ? table_str.wldissec : '' + authMode[this.authMode] + "/" + wepStatus[this.wepStatus],
            "width": "10%"
        }, {
            "text": "<span class='table-grid-icon connect-icon' id='connect_" + index + "' onclick='doConnect(apList[" + index + "]);'></span>",
            "width": "10%"
        }]);
        index++;
    });
    $.initTableBody($("#tableWlStat"), array);
    $.tablePages($("#tableWlStat"), 8);
}

function initApList() {
    if (isRefresh) {
        $.addLoading($("#addItem .table-btn"))
        $.act(ACT_OP, ACT_OP_WLAN_SCAN, wlanObj.__stack);
        $.exe(function() {
            wlanList = $.act(ACT_GL, LAN_WLAN, null, null, ["name", "X_TP_Band"]);
            if (!$.exe()) {
                $.each(wlanList, function() {
                    if ("2.4GHz" == this.X_TP_Band) {
                        wlanObj = this;
                    }
                });
            }
            apList = $.act(ACT_GS, LAN_WLAN_BSSDESC_ENTRY, null, wlanObj.__stack, ["SSID", "BSSID", "SecurityEnable", "Channel", "RSSI","authMode", "wepStatus"]);
            if (!$.exe()) {
                // setTip(apList.length);
                $.removeLoading();
                initTbl(apList, 1);
            }
        });

    } else {
        wlanList = $.act(ACT_GL, LAN_WLAN, null, null, ["name", "X_TP_Band"]);
        if (!$.exe()) {
            $.each(wlanList, function() {
                if ("2.4GHz" == this.X_TP_Band) {
                    wlanObj = this;
                }
            });
        }
        apList = $.act(ACT_GS, LAN_WLAN_BSSDESC_ENTRY, null, wlanObj.__stack, ["SSID", "BSSID", "SecurityEnable", "Channel", "RSSI","authMode", "wepStatus"]);
        if (!$.exe()) {
            // setTip(apList.length);
            initTbl(apList, 1);
        }
    }
}

$('#back').on('click.wlscan', function() {
    doConnect(null);
})
$('#refreshIcon').on('click.wlscan', function() {

    isRefresh = 1;
})
</script>

<h3 id="et">Ap List</h3>


<div>
    <form class="pure-form pure-form-aligned">
        <div class="table-op" id="addItem">
            <div class="table-btn">
                <span id="refreshIcon" class="refresh-icon"></span>
                <label class="T_refresh">Refresh</label>
            </div>
        </div>
        <table id="tableWlStat">
            <thead></thead>
            <tbody id="bodyWlStat">
            </tbody>
        </table>
        <div class='part-separate'>
        <button type="submit" class="blue T_back" id="back">Back</button>
        </div>
    </form>
</div>

<script language="javascript" type="text/javascript">
/*$(document).ready(function() {*/
$('#scroll').scrollTop(0);
var headArray = [{
    "text": table_str.id,
    "width": "5%"
}, {
    "text": table_str.mac,
    "width": "15%"
}, {
    "text": table_str.ssid,
    "width": ""
}, {
    "text": table_str.signal,
    "width": "10%"
}, {
    "text": table_str.channel,
    "width": "10%"
}, {
    "text": table_str.encryption,
    "width": "10%"
}, {
    "text": table_str.connect,
    "width": "10%"
}];

$.initTableHead($("#tableWlStat"), headArray);
$("#tableWlStat").tpTable(initApList);
$.tpInit();
/*});*/
</script>
