<script language="javascript" type="text/javascript">
var index;
var stkArrayV4 = [];
var indexV6;
var stkArrayV6 = [];
var optFlag = 0;
var stkEdit;

var bodyArrayV4 = [];
var bodyArrayV6 = [];
var filterlist;

var aliasName;

$("#addV4").click(function() {
    optFlag = 0;
    initEditV4(0);
});

$("#addV6").click(function() {
    optFlag = 0;
    initEditV6(0);
});

function initEditV4(opt, stk) {
    if (opt == 1) {
        optFlag = 1;
        stkEdit = stk;
        var staticRteCfg = $.act(ACT_GET, L3_FORWARDING_ENTRY, stk, null, ["destIPAddress",
            "destSubnetMask", "gatewayIPAddress", "__ifAliasName", "enable"
        ]);
    }
    if (INCLUDE_IPV6) {
        var wanIPList = $.act(ACT_GL, WAN_IP_CONN, null, null, ["enable", "name", "connectionType", "X_TP_IPv4Enabled"]);
        var wanPPPList = $.act(ACT_GL, WAN_PPP_CONN, null, null, ["enable", "name", "X_TP_IPv4Enabled", "transportType"]);
        if (INCLUDE_L2TP) {
            var wanL2TPList = $.act(ACT_GL, WAN_L2TP_CONN, null, null, ["enable", "name"]);
        }
        if (INCLUDE_PPTP) {
            var wanPPTPList = $.act(ACT_GL, WAN_PPTP_CONN, null, null, ["enable", "name"]);
        }
    } else {
        var wanIPList = $.act(ACT_GL, WAN_IP_CONN, null, null, ["enable", "name", "connectionType"]);
        var wanPPPList = $.act(ACT_GL, WAN_PPP_CONN, null, null, ["enable", "name", "transportType"]);
        if (INCLUDE_L2TP) {
            var wanL2TPList = $.act(ACT_GL, WAN_L2TP_CONN, null, null, ["enable", "name"]);
        }
        if (INCLUDE_PPTP) {
            var wanPPTPList = $.act(ACT_GL, WAN_PPTP_CONN, null, null, ["enable", "name"]);
        }
    }

    if (!$.exe()) {
        for (var i = 0; i < wanIPList.length; i++) {
            if ((aliasName.__ifAliasName != "LTE") && (wanIPList[i].connectionType != "IP_Bridged") && (wanIPList[i].enable == 1) && (!INCLUDE_IPV6 || wanIPList[i].X_TP_IPv4Enabled == 1)) {
                $("#wanInf").append("<option value='" + wanIPList[i].name + "' text='" + wanIPList[i].name + "'>" + wanIPList[i].name + "</option>");
            }
        }
        for (var j = 0; j < wanPPPList.length; j++) {
            if ((aliasName.__ifAliasName != "LTE") && wanPPPList[j].enable == 1 && (wanPPPList[j].transportType != "PPP3G") && (!INCLUDE_IPV6 || wanPPPList[j].X_TP_IPv4Enabled == 1)) {
                $("#wanInf").append("<option value='" + wanPPPList[j].name + "' text='" + wanPPPList[j].name + "'>" + wanPPPList[j].name + "</option>");
            }
        }
        if (INCLUDE_L2TP) {
            for (var i = 0; i < wanL2TPList.length; i++) {
                if ((aliasName.__ifAliasName != "LTE") && wanL2TPList[i].enable == 1) {
                    $("#wanInf").append("<option value='" + wanL2TPList[i].name + "' text='" + wanL2TPList[i].name + "'>" + wanL2TPList[i].name + "</option>");
                }
            }
        }
        if (INCLUDE_PPTP) {
            for (var i = 0; i < wanPPTPList.length; i++) {
                if ((aliasName.__ifAliasName != "LTE") && wanPPTPList[i].enable == 1) {
                    $("#wanInf").append("<option value='" + wanPPTPList[i].name + "' text='" + wanPPTPList[i].name + "'>" + wanPPTPList[i].name + "</option>");
                }
            }
        }

        $("#wanInf").append("<option value='LAN' text='LAN'>LAN</option>");
        if (opt == 1) {
            $("#desAddr").tpAddress('val', staticRteCfg.destIPAddress);
            $("#route_mask").tpAddress('val', staticRteCfg.destSubnetMask);
            $("#defGw").tpAddress('val', staticRteCfg.gatewayIPAddress);
            $("#wanInf option[value='" + staticRteCfg.__ifAliasName + "']").prop("selected", "selected");
            //$("#state option[value='" + staticRteCfg.enable + "']").prop("selected", "selected");
            if (staticRteCfg.enable == 1) {
                $("#state_en").prop("checked", true).data('tpCheckbox').refresh();
            } else {
                $("#state_en").prop("checked", false).data('tpCheckbox').refresh();
            }
        }

        $("#wanInf").tpSelect({
            refresh: 1
        });
    }
}

var ipConnList;
var pppConnList;

function initEditV6(opt, stk) {
    if (opt == 1) {
        optFlag = 1;
        stkEdit = stk;
        var staticRteCfg = $.act(ACT_GET, L3_IP6_FORWARDING_ENTRY, stk, null, ["destIPv6Address", "destIPv6AddressPrefixLength", "gatewayIPv6Address", "__ifAliasName", "interface", "enable"]);
    }
    ipConnList = $.act(ACT_GL, WAN_IP_CONN, null, null, ["name", "enable", "X_TP_IfName", "X_TP_IPv6Enabled"]);
    pppConnList = $.act(ACT_GL, WAN_PPP_CONN, null, null, ["name", "enable", "X_TP_IfName", "X_TP_IPv6Enabled"]);

    if (!$.exe()) {
        for (var i = 0; i < ipConnList.length; i++) {
            if (ipConnList[i].enable == 1 && ipConnList[i].X_TP_IPv6Enabled == 1) {
                $("#wanInfV6").append("<option value='" + ipConnList[i].name + "' text='" + ipConnList[i].name + "'>" + ipConnList[i].name + "</option>");
            }
        }
        for (var i = 0; i < pppConnList.length; i++) {
            if (pppConnList[i].enable == 1 && pppConnList[i].X_TP_IPv6Enabled == 1) {
                $("#wanInfV6").append("<option value='" + pppConnList[i].name + "' text='" + pppConnList[i].name + "'>" + pppConnList[i].name + "</option>");
            }
        }

        $("#wanInfV6").append("<option value='LAN' text='LAN'>LAN</option>");

        if (opt == 1) {
            $("#desAddrV6").val(staticRteCfg.destIPv6Address);
            $("#prelenV6").val(staticRteCfg.destIPv6AddressPrefixLength);
            $("#defGwV6").val(staticRteCfg.gatewayIPv6Address);
            $("#wanInfV6 option[value='" + staticRteCfg.__ifAliasName + "']").prop("selected", "selected");
            //$("#stateV6 option[value='" + staticRteCfg.enable + "']").prop("selected", "selected");
            if (staticRteCfg.enable == 1) {
                $("#state_enV6").prop("checked", true).data('tpCheckbox').refresh();
            } else {
                $("#state_enV6").prop("checked", false).data('tpCheckbox').refresh();
            }
        }
        $("#wanInfV6").tpSelect({
            refresh: 1
        });
    }
}

function init() {
    index = 0;
    var idIndex = 1;

    var staticRteList = $.act(ACT_GL, L3_FORWARDING_ENTRY, null, null, ["destIPAddress",
        "destSubnetMask", "gatewayIPAddress", "__ifAliasName", "enable"
    ]);
    if (INCLUDE_WAN_MODE) {

        if (!INCLUDE_3G4G_BACKUP)
        {
			if(INCLUDE_USB_3G_BACKUP && INCLUDE_EWAN_BACKUP)
				var sysMode = $.act(ACT_GET, SYS_MODE, null, null, ["mode","usb3gBackup", "ewanBackup"]);
			else
				var sysMode = $.act(ACT_GET, SYS_MODE, null, null, ["mode"]);
		}
		else
			var sysMode = $.act(ACT_GET, SYS_MODE, null, null, ["mode", "lteBackupEnable"]);

        var wanCommIntfCfgList = $.act(ACT_GL, WAN_COMMON_INTF_CFG, null, null, ["WANAccessType"]);
        var wanIPList = $.act(ACT_GL, WAN_IP_CONN, null, null, ["name"]);
        var wanPPPList = $.act(ACT_GL, WAN_PPP_CONN, null, null, ["name"]);
        if (INCLUDE_L2TP) {
            var wanL2TPList = $.act(ACT_GL, WAN_L2TP_CONN, null, null, ["name"]);
        }
        if (INCLUDE_PPTP) {
            var wanPPTPList = $.act(ACT_GL, WAN_PPTP_CONN, null, null, ["name"]);
        }
    }
    if (!$.exe()) {
	var lteBackupEnable = 0;
	var usb3gBackup = 0;
	var ewanBackup = 0;
        if (INCLUDE_WAN_MODE) {
            $.merge(wanIPList, wanPPPList);
            if (INCLUDE_L2TP) {
                $.merge(wanIPList, wanL2TPList);
            }
            if (INCLUDE_PPTP) {
                $.merge(wanIPList, wanPPTPList);
            }
            var mode = (sysMode.mode == "ETH") ? "Ethernet" : sysMode.mode;
			if (INCLUDE_3G4G_BACKUP)
				lteBackupEnable = (sysMode.mode == "ETH")&&(sysMode.lteBackupEnable == "1")?1:0;
			else
				{
					if(INCLUDE_USB_3G_BACKUP && INCLUDE_EWAN_BACKUP)
					{
						ewanBackup = sysMode.ewanBackup;
						usb3gBackup	= sysMode.usb3gBackup;
					}
				}
        }

        $.each(staticRteList, function() {
            if (INCLUDE_WAN_MODE) {

                var notShow = 0;
                var wanName = this.__ifAliasName;
                $.each(wanIPList, function() {
                    if (wanName == this.name) {
                        var tmpStk = $.stkPop(this.__stack, 2);
                        $.each(wanCommIntfCfgList, function() {
                            if (tmpStk == this.__stack && this.WANAccessType != mode && lteBackupEnable == 0 && ewanBackup==0 && usb3gBackup==0) {
                                notShow = 1;
                                return;
                            }
                        });
                    }
                });
                if (notShow == 1) {
                    return;
                }
            }
            var thisStk = "[" + this.__stack + "]";
            bodyArrayV4.push([{
                "text": "<div><input type='checkbox' id='" + "V4" + index + "' class='table-select-one' /><label></label></div>",
                "width": "10%"
            }, {
                "text": idIndex++,
                "width": "10%"
            }, {
                "text": this.destIPAddress,
                "width": ""
            }, {
                "text": this.destSubnetMask,
                "width": "20%"
            }, {
                "text": this.gatewayIPAddress,
                "width": "20%"
            }, {
                "text": (this.enable == 1) ? "<span class='table-grid-icon enable-icon' id='en4_" + index + "' onclick='enRoute(\"en4_\"," + index + ", " + thisStk + ")'></span>" : "<span class='table-grid-icon disable-icon' id='en4_" + index + "' onclick='enRoute(\"en4_\"," + index + ", " + thisStk + ")'></span>",
                "width": "10%"
            }, {
                "text": "<span class='table-grid-icon edit-modify-icon' onclick='initEditV4(1, " + thisStk + ");'></span><span class='table-grid-icon edit-trash-icon' onclick='delItem(1, " + thisStk + ");'></span>",
                "width": "15%"
            }]);
            stkArrayV4[index] = this.__stack;
            index++;
        });

        $.initTableBody($("#staticRouteV4"), bodyArrayV4);
        $.tablePages($("#staticRouteV4"), 8);
    }
}

function initV6() {
    indexV6 = 0;
    var idIndexV6 = 1;
	var lteBackupEnable = 0;
	var usb3gBackup = 0;
	var ewanBackup = 0;

    var staticRteList = $.act(ACT_GL, L3_IP6_FORWARDING_ENTRY, null, null, ["destIPv6Address", "destIPv6AddressPrefixLength", "gatewayIPv6Address", "__ifAliasName", "enable"]);
    if (INCLUDE_WAN_MODE) {
        if(INCLUDE_USB_3G_BACKUP && INCLUDE_EWAN_BACKUP)
			var sysMode = $.act(ACT_GET, SYS_MODE, null, null, ["mode","usb3gBackup", "ewanBackup"]);
		else
			var sysMode = $.act(ACT_GET, SYS_MODE, null, null, ["mode"]);
        var wanCommIntfCfgList = $.act(ACT_GL, WAN_COMMON_INTF_CFG, null, null, ["WANAccessType"]);
        var wanIPList = $.act(ACT_GL, WAN_IP_CONN, null, null, ["name"]);
        var wanPPPList = $.act(ACT_GL, WAN_PPP_CONN, null, null, ["name"]);
    }
    if (!$.exe()) {
        if (INCLUDE_WAN_MODE) {
            $.merge(wanIPList, wanPPPList);
            var mode = (sysMode.mode == "ETH") ? "Ethernet" : sysMode.mode;
			if(INCLUDE_USB_3G_BACKUP && INCLUDE_EWAN_BACKUP)
			{
				ewanBackup = sysMode.ewanBackup;
				usb3gBackup	= sysMode.usb3gBackup;
			}
        }

        $.each(staticRteList, function() {
            if (INCLUDE_WAN_MODE) {

                var notShow = 0;
                var wanName = this.__ifAliasName;
                $.each(wanIPList, function() {
                    if (wanName == this.name) {
                        var tmpStk = $.stkPop(this.__stack, 2);
                        $.each(wanCommIntfCfgList, function() {
                            if (tmpStk == this.__stack && this.WANAccessType != mode && lteBackupEnable == 0 && ewanBackup==0 && usb3gBackup==0) {
                                notShow = 1;
                                return;
                            }
                        });
                    }
                });
                if (notShow == 1) {
                    return;
                }
            }

            var thisStk = "[" + this.__stack + "]";

            bodyArrayV6.push([{
                "text": "<div><input type='checkbox' id='" + "V6" + indexV6 + "' class='table-select-one' /><label></label></div>",
                "width": "10%"
            }, {
                "text": idIndexV6++,
                "width": "10%"
            }, {
                "text": this.destIPv6Address + " /" + this.destIPv6AddressPrefixLength,
                "width": ""
            }, {
                "text": this.gatewayIPv6Address,
                "width": "20%"
            }, {
                "text": (this.enable == 1) ? "<span class='table-grid-icon enable-icon' id='en6_" + indexV6 + "' onclick='enRoute(\"en6_\", " + indexV6 + ", " + thisStk + ")'></span>" : "<span class='table-grid-icon disable-icon' id='en6_" + indexV6 + "' onclick='enRoute(\"en6_\", " + indexV6 + ", " + thisStk + ")'></span>",
                "width": "10%"
            }, {
                "text": "<span class='table-grid-icon edit-modify-icon' onclick='initEditV6(1, " + thisStk + ");'></span><span class='table-grid-icon edit-trash-icon' onclick='delItem(2, " + thisStk + ");'></span>",
                "width": "15%"
            }]);
            stkArrayV6[indexV6] = this.__stack;
            indexV6++;
        });

        $.initTableBody($("#staticRouteV6"), bodyArrayV6);
        $.tablePages($("#staticRouteV6"), 8);
    }
}

function enRoute(str, index, stk) {
    var obj = $("#" + str + index);
    var flag = obj.hasClass("disable-icon");

    if (flag == true) {
        $.act(ACT_SET, str == "en4_" ? L3_FORWARDING_ENTRY : L3_IP6_FORWARDING_ENTRY, stk, null, ["enable=1"]);
    } else {
        $.act(ACT_SET, str == "en4_" ? L3_FORWARDING_ENTRY : L3_IP6_FORWARDING_ENTRY, stk, null, ["enable=0"]);
    }
    $.exe(function(ret) {
        if (flag == true) {
            obj.removeClass("disable-icon").addClass("enable-icon");
        } else {
            obj.removeClass("enable-icon").addClass("disable-icon");
        }
    });
}

$("#saveBtnV4").click(function() {
    if ($.ifip($("#desAddr").tpAddress('val'), true)) {
        $.alert(ERR_IP_FORMAT);
        $("#desAddr").tpAddress('focus');
        return false;
    }
    if ($.mask($("#route_mask").tpAddress('val'), true)) {
        $.alert(ERR_MASK_INVAD);
        $("#desAddr").tpAddress('focus');
        return false;
    }
    if ($.ifip($("#defGw").tpAddress('val'), true)) {
        $.alert(ERR_IP_FORMAT);
        $("#desAddr").tpAddress('focus');
        return false;
    }

    var staticRteAttrs = {};
    staticRteAttrs.destIPAddress = $.ip2ip($("#desAddr").tpAddress('val'));
    staticRteAttrs.destSubnetMask = $.ip2ip($("#route_mask").tpAddress('val'));
    staticRteAttrs.gatewayIPAddress = $.ip2ip($("#defGw").tpAddress('val'));
    staticRteAttrs.__ifAliasName = $("#wanInf").data("value");
    staticRteAttrs.enable = $("#state_en").prop('data-checked') == true ? "1" : "0";
    if (optFlag == 0)
        $.act(ACT_ADD, L3_FORWARDING_ENTRY, null, null, staticRteAttrs);
    else if (optFlag == 1)
        $.act(ACT_SET, L3_FORWARDING_ENTRY, stkEdit, null, staticRteAttrs);

    $.exe(function(err) {
        if (!err) {
			$.reload();
			setTimeout((function() {
	            $("span.first-mode").click();
	        }), 50);
		}
    });
});

$("#saveBtnV6").click(function() {
    var regExp = /^[0-9]{1,2}$/;
    var preLenTmp = $("#prelenV6").val();
    if (!$.isValidGLUIP6Addr($("#desAddrV6").val())) {
        $.alert(ERR_ROUTE6_DST_ADDR_VALID);
        $("#desAddrV6").focus().select();
        return false;
    }

    if ((!regExp.test(preLenTmp)) || preLenTmp > 64 || (preLenTmp % 8) != 0) {
        $.alert(ERR_ROUTE6_PREFIX_LEN_VALID);
        $("#prelenV6").focus().select();
        return false;
    }

    if (!$.isValidGLUIP6AddrStrict($("#defGwV6").val())) {
        $.alert(ERR_ROUTE6_GW_ADDR_VALID);
        $("#defGwV6").focus().select();
        return false;
    }

    var staticRteAttrs = {};
    staticRteAttrs.destIPv6Address = $("#desAddrV6").val();
    staticRteAttrs.destIPv6AddressPrefixLength = preLenTmp;
    staticRteAttrs.gatewayIPv6Address = $("#defGwV6").val();

    staticRteAttrs.__ifAliasName = $("#wanInfV6").data("value");
    staticRteAttrs.enable = $("#state_enV6").prop('data-checked') == true ? "1" : "0";

    if ($("#wanInfV6").data("value") == "LAN") {
        staticRteAttrs.interface = "br0";
    } else {
        for (var i = 0; i < ipConnList.length; i++) {
            if (ipConnList[i].enable == 1 && ipConnList[i].X_TP_IPv6Enabled == 1 && ipConnList[i].name == staticRteAttrs.__ifAliasName) {
                staticRteAttrs.interface = ipConnList[i].X_TP_IfName;
            }
        }
        for (var i = 0; i < pppConnList.length; i++) {
            if (pppConnList[i].enable == 1 && pppConnList[i].X_TP_IPv6Enabled == 1 && pppConnList[i].name == staticRteAttrs.__ifAliasName) {
                staticRteAttrs.interface = pppConnList[i].X_TP_IfName;
            }
        }
    }

    if (optFlag == 0)
        $.act(ACT_ADD, L3_IP6_FORWARDING_ENTRY, null, null, staticRteAttrs);
    else if (optFlag == 1)
        $.act(ACT_SET, L3_IP6_FORWARDING_ENTRY, stkEdit, null, staticRteAttrs);

    $.exe(function(err) {
        if (!err) {
            $.reload();
			setTimeout((function() {
                $("span.second-mode").click();
            }), 50);
        }
    });
});

function initGw() {
    var index = 0;
    var indexV6 = 0;

	if (INCLUDE_LTEWAN || INCLUDE_USB_3G_DONGLE) {
		$("#title2").removeClass("nd");
	} else {
		$("#title1").removeClass("nd");
		$("#selectWanV4").removeClass("nd");
		$("#selectWanV6").removeClass("nd");
	}

    aliasName = $.act(ACT_GET, L3_FORWARDING, null, null, ["__ifAliasName"]);
    filterlist = $.act(ACT_GL, L2_BRIDGING_FILTER, null, null, ["filterKey", "X_TP_IfAliasName", "__filterBridgeRefName"]);
    if (INCLUDE_IPV6) {
        var wanIpList = $.act(ACT_GL, WAN_IP_CONN, null, null, ["enable", "name", "connectionType", "X_TP_IPv4Enabled", "X_TP_IPv6Enabled"]);
        var wanPPPList = $.act(ACT_GL, WAN_PPP_CONN, null, null, ["enable", "name", "X_TP_IPv4Enabled", "X_TP_IPv6Enabled"]);
        if (INCLUDE_L2TP) {
            var wanL2TPList = $.act(ACT_GL, WAN_L2TP_CONN, null, null, ["enable", "name"]);
        }
        if (INCLUDE_PPTP) {
            var wanPPTPList = $.act(ACT_GL, WAN_PPTP_CONN, null, null, ["enable", "name"]);
        }

        var aliasNameV6 = $.act(ACT_GET, L3_IP6_FORWARDING, null, null, ["__ifAliasName"]);
    } else {
        var wanIpList = $.act(ACT_GL, WAN_IP_CONN, null, null, ["enable", "name", "connectionType"]);
        var wanPPPList = $.act(ACT_GL, WAN_PPP_CONN, null, null, ["enable", "name"]);
        if (INCLUDE_L2TP) {
            var wanL2TPList = $.act(ACT_GL, WAN_L2TP_CONN, null, null, ["enable", "name"]);
        }
        if (INCLUDE_PPTP) {
            var wanPPTPList = $.act(ACT_GL, WAN_PPTP_CONN, null, null, ["enable", "name"]);
        }
    }

    if (!$.exe()) {
        if (INCLUDE_USB_3G_DONGLE && INCLUDE_WAN_MODE) {
            if (aliasName.__ifAliasName.match("USB_3G") != null) {
                var pStk;
                var wanUsb3g;
                var wanTypes = $.act(ACT_GL, WAN_COMMON_INTF_CFG, null, null, ["WANAccessType"]);
                var usb3gList = $.act(ACT_GL, WAN_USB_3G_LINK_CFG, null, null, ["backupEnable"]);
                var sysMode = $.act(ACT_GET, SYS_MODE, null, null, ["mode"]);

                if (!$.exe()) {
                    $.each(wanTypes, function() {
                        if (this.WANAccessType == "USB_3G") {
                            pStk = this.__stack;
                        }
                    });

                    $.each(usb3gList, function() {
                        var tmpStk = $.stkPop(this.__stack, 1);
                        if (pStk == tmpStk) {
                            wanUsb3g = $.act(ACT_GET, WAN_USB_3G_LINK_CFG, this.__stack, null, ["mainConnObjName"]);
                        }
                    });

                    if (!$.exe()) {
                        if (sysMode.mode != "USB_3G") {
                            aliasName.__ifAliasName = wanUsb3g.mainConnObjName;
                        }
                    }
                }
            }
        }

        for (var i = 0; i < wanIpList.length; i++) {
            if ((wanIpList[i].connectionType != "IP_Bridged") && (wanIpList[i].enable == 1) && (!INCLUDE_IPV6 || wanIpList[i].X_TP_IPv4Enabled == 1) && (checkGroup(wanIpList[i].name))) {
                $("#wanInfGw").append("<option value='" + wanIpList[i].name + "' text='" + wanIpList[i].name + "'>" + wanIpList[i].name + "</option>");
                index++;
                if (wanIpList[i].name == aliasName.__ifAliasName) {
                    $("#wanInfGw option[text='" + wanIpList[i].name + "']").prop("selected", "selected");
                }
            }

            if (INCLUDE_IPV6) {
                if (wanIpList[i].enable == 1 && wanIpList[i].X_TP_IPv6Enabled == 1) {
                    $("#wanInfGw6").append("<option value='" + wanIpList[i].name + "' text='" + wanIpList[i].name + "'>" + wanIpList[i].name + "</option>");
                    indexV6++;
                    if (wanIpList[i].name == aliasNameV6.__ifAliasName) {
                        $("#wanInfGw6 option[text='" + wanIpList[i].name + "']").prop("selected", "selected");
                    }
                }
            }
        }
        for (var j = 0; j < wanPPPList.length; j++) {
            if (wanPPPList[j].enable == 1 && (wanPPPList[j].name.match("USB_3G") == null) && (!INCLUDE_IPV6 || wanPPPList[j].X_TP_IPv4Enabled == 1) && (checkGroup(wanPPPList[j].name))) {
                $("#wanInfGw").append("<option value='" + wanPPPList[j].name + "' text='" + wanPPPList[j].name + "'>" + wanPPPList[j].name + "</option>");
                index++;
                if (wanPPPList[j].name == aliasName.__ifAliasName) {
                    $("#wanInfGw option[text='" + wanPPPList[j].name + "']").prop("selected", "selected");
                }
            }
            if (INCLUDE_IPV6) {
                if (wanPPPList[j].enable == 1 && wanPPPList[j].X_TP_IPv6Enabled == 1) {
                    $("#wanInfGw6").append("<option value='" + wanPPPList[j].name + "' text='" + wanPPPList[j].name + "'>" + wanPPPList[j].name + "</option>");
                    indexV6++;
                    if (wanPPPList[j].name == aliasNameV6.__ifAliasName) {
                        $("#wanInfGw6 option[text='" + wanPPPList[j].name + "']").prop("selected", "selected");
                    }
                }
            }
        }
        if (INCLUDE_L2TP) {
            for (var i = 0; i < wanL2TPList.length; i++) {
                if (wanL2TPList[i].enable == 1) {
                    $("#wanInfGw").append("<option value='" + wanL2TPList[i].name + "' text='" + wanL2TPList[i].name + "'>" + wanL2TPList[i].name + "</option>");
                    index++;
                    if (wanL2TPList[i].name == aliasName.__ifAliasName) {
                        $("#wanInfGw option[text='" + wanL2TPList[i].name + "']").prop("selected", "selected");
                    }
                }
            }
        }
        if (INCLUDE_PPTP) {
            for (var i = 0; i < wanPPTPList.length; i++) {
                if (wanPPTPList[i].enable == 1) {
                    $("#wanInfGw").append("<option value='" + wanPPTPList[i].name + "' text='" + wanPPTPList[i].name + "'>" + wanPPTPList[i].name + "</option>");
                    index++;
                    if (wanPPTPList[i].name == aliasName.__ifAliasName) {
                        $("#wanInfGw option[text='" + wanPPTPList[i].name + "']").prop("selected", "selected");
                    }
                }
            }
        }

        if (index == 0) {
            $("#wanInfGw").append("<option value='0' text='" + s_str.noAvaiIntf + "'>" + s_str.noAvaiIntf + "</option>");
        }

        if (INCLUDE_IPV6 && (indexV6 == 0)) {
            $("#wanInfGw6").append("<option value='0' text='" + s_str.noAvaiIntf + "'>" + s_str.noAvaiIntf + "</option>");
        }
    }
    if (INCLUDE_ROUTE_BINDING) {
        $("#t_info2").removeClass("nd");
    }
}

$("#submitBtn4").click(function() {
    $.addLoading($(this));
    $.act(ACT_SET, L3_FORWARDING, null, null, ["__ifAliasName=" + $("#wanInfGw").data("text"), "__ifName=", "defaultConnectionService="]);
    $.exe(function(ret) {
        $.removeLoading();
        if (!ret) {
			$.reload();
			setTimeout((function() {
	            $("span.first-mode").click();
	        }), 50);
		}
    });
});

$("#submitBtn6").click(function() {
    $.addLoading($(this));
    $.act(ACT_SET, L3_IP6_FORWARDING, null, null, ["__ifAliasName=" + $("#wanInfGw6").data("text"), "__ifName=", "defaultConnectionService="]);
    $.exe(function(ret) {
        $.removeLoading();
        if (!ret) {
			$.reload();
			setTimeout((function() {
	            $("span.second-mode").click();
	        }), 50);
		}
    });
});

function checkGroup(wanName) {
    if (INCLUDE_ROUTE_BINDING) {
        var index = 0;
        for (index = 0; index < filterlist.length; index++) {
            if ((filterlist[index].X_TP_IfAliasName == wanName) && (filterlist[index].__filterBridgeRefName != "Default")) {
                return false;
            }
        }
    }
    return true;
}

$("button[id^='cancelBtnV']").click(function() {
    $.reload();
	if (this.id == "cancelBtnV4")
    {
        setTimeout((function() {
            $("span.first-mode").click();
        }), 50);
    }
    else if (this.id == "cancelBtnV6")
    {
        setTimeout((function() {
            $("span.second-mode").click();
        }), 50);
    }
});

function delSelect(tag) {
    var i;
    var arrayName = [];
    if (tag == 'V4') {
        arrayName = bodyArrayV4;
    } else if (tag == 'V6') {
        arrayName = bodyArrayV6;
    }

    $.confirm(c_str.del_choosed, function() {
        for (i in arrayName) {
            if ($("#" + tag + i).prop('data-checked')) {
                if (tag == "V4") {
                    $.act(ACT_DEL, L3_FORWARDING_ENTRY, stkArrayV4[i], null);
                } else {
                    $.act(ACT_DEL, L3_IP6_FORWARDING_ENTRY, stkArrayV6[i], null);
                }
            }
        }
        $.exe(function() {
            $.reload();
			if (tag == 'V4')
            {
                setTimeout((function() {
                    $("span.first-mode").click();
                }), 50);
            }
            else if (tag == 'V6')
            {
                setTimeout((function() {
                    $("span.second-mode").click();
                }), 50);
            }
        });
    });
}

function delItem(tag, stack) {
    if (tag == 1) {
        $.act(ACT_DEL, L3_FORWARDING_ENTRY, stack, null);
    } else {
        $.act(ACT_DEL, L3_IP6_FORWARDING_ENTRY, stack, null);
    }

    $.exe(function() {
        $.reload();
		if (tag == 1)
        {
            setTimeout((function() {
                $("span.first-mode").click();
            }), 50);
        }
        else if (tag == 2)
        {
            setTimeout((function() {
                $("span.second-mode").click();
            }), 50);
        }
    });

}
</script>
<div id="title1" class="nd">
	<h3 id="et1">Default Gateway</h3>
</div>
<div id="title2" class="nd">
	<h3 id="et4">Static Route</h3>
</div>
<div class="content-container">
    <div class="mode-change">
        <span class="mode-select">IPv4</span>
        <span>IPv6</span>
    </div>
    <form class="pure-form pure-form-aligned">
		<div id="selectWanV4" class="nd">
			<p id="t_info1" class="cfg-line">Note1:Select a preferred WAN interface as the system default gateway.</p>
			<p id="t_info2" class="cfg-line nd">Note2:The WAN that in other group can not be selected as system default gateway.</p>
			<div style="margin-right:30px">
				<b class="xl T_c_selwan">Select WAN Interface:</b>
				<select class="xl" id="wanInfGw"></select>
			</div>
			<button type="submit" class="green T_save" id="submitBtn4" value="Save">Save</button>

			<div class="part-separate"></div>
			<h3 id="et2">Static Route</h3>
		</div>
        <div style="position: relative;">
            <div class="table-op">
                <div class="table-btn">
                    <span id="addV4" class="add-icon"></span>
                    <label class="T_add">Add</label>
                    <span id="delV4" class="delete-icon"></span>
                    <label class="T_del">Delete</label>
                </div>
            </div>
            <table id="staticRouteV4">
                <thead></thead>
                <tbody id="routeBodyV4">
                    <tr id="editContainerV4" class="nd">
                        <td colspan="7">
                            <div>
                                <b id="t_dstip">Destination IP Address:</b>
                                <input type="text" id="desAddr" maxlength="15" class="ip-address"/>
                            </div>
                            <div>
                                <b class="T_netmask">Subnet Mask:</b>
                                <input type="text" id="route_mask" maxlength="15" class="ip-address"/>
                            </div>
                            <div>
                                <b class="T_gateway">Gateway:</b>
                                <input type="text" id="defGw" maxlength="15" class="ip-address"/>
                            </div>
                            <b class="T_c_intf">Interface:</b>
                            <select class="l" id="wanInf"></select>
                            <div>
                            <b></b>
                            <input type="checkbox" id="state_en" checked="true" />
                            <label class="T_c_enable">Enable this Entry</label>
                            </div>
                            <div class="inline-btn-right">
                                <button type="submit" class="green T_cancel" id="cancelBtnV4">Cancel</button>
                                <button type="submit" class="green T_save" id="saveBtnV4">Save</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            </br>
            <div id="lteNote" class="nd">
            <p id="t_info_lte" class="cfg-line">Note: If LTE interface is selected, gateway must be on the same subnet with 192.168.225.1.</p>
            </div>
        </div>

    </form>

    <form class="pure-form pure-form-aligned">
		<div id="selectWanV6" class="nd">
			<p id="t_info3" class="cfg-line">Select a preferred wan interface as the system IPv6 default gateway.</p>
			<div style="margin-right:30px">
				<b class="xl T_c_selwan">Select WAN Interface:</b>
				<select class="xl" id="wanInfGw6"></select>
			</div>
			<button type="submit" class="green T_save" id="submitBtn6" value="Save">Save</button>

			<div class="part-separate"></div>
			<h3 id="et3">Static Route</h3>
		</div>
        <div style="position: relative;">
            <div class="table-op">
                <div class="table-btn">
                    <span id="addV6" class="add-icon"></span>
                    <label class="T_add">Add</label>
                    <span id="delV6" class="delete-icon"></span>
                    <label class="T_del">Delete</label>
                </div>
            </div>
            <table id="staticRouteV6">
                <thead></thead>
                <tbody id="routeBodyV6">
                    <tr id="editContainerV6" class="nd">
                        <td colspan="6">
                            <div>
                                <b id="t_dstip6">Destination IPv6 Address:</b>
                                <input type="text" id="desAddrV6" maxlength="39" />
                            </div>
                            <div>
                                <b id="t_plen">Prefix Length:</b>
                                <input type="text" id="prelenV6" maxlength="39" />
                            </div>
                            <div>
                                <b class="T_gateway">Gateway:</b>
                                <input type="text" id="defGwV6" maxlength="39" />
                            </div>
                            <b class="T_c_intf">Interface:</b>
                            <select class="l" id="wanInfV6"></select>
                            <div>
                            <b></b>
                            <input type="checkbox" id="state_enV6" checked="true" />
                            <label class="T_c_enable">Enable this Entry</label>
                            </div>
                            <div class="inline-btn-right">
                                <button type="submit" class="green T_cancel" id="cancelBtnV6">Cancel</button>
                                <button type="submit" class="green T_save" id="saveBtnV6">Save</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </form>
</div>

<script language="javascript" type="text/javascript">
var headArrayV4 = [{
    "text": '<div><input type="checkbox" id="chk_routeV4" class="table-select-all" /><label></label></div>',
    "width": "10%"
}, {
    "text": table_str.id,
    "width": "10%"
}, {
    "text": table_str.destNtw,
    "width": ""
}, {
    "text": table_str.subMask,
    "width": "20%"
}, {
    "text": table_str.dftGw,
    "width": "20%"
}, {
    "text": table_str.status,
    "width": "10%"
}, {
    "text": table_str.modify,
    "width": "15%"
}];
var headArrayV6 = [{
    "text": '<div><input type="checkbox" id="chk_routeV6" class="table-select-all" /><label></label></div>',
    "width": "10%"
}, {
    "text": table_str.id,
    "width": "10%"
}, {
    "text": table_str.destNtw6,
    "width": ""
}, {
    "text": table_str.dftGw,
    "width": "20%"
}, {
    "text": table_str.enable,
    "width": "10%"
}, {
    "text": table_str.modify,
    "width": "15%"
}];
$.initTableHead($("#staticRouteV4"), headArrayV4);
$.initTableHead($("#staticRouteV6"), headArrayV6);
$("#staticRouteV4").tpTable(init);
$("#staticRouteV6").tpTable(initV6);
$.tpInit(initGw);

$("span[id^=delV]").click(function() {
    var tag = ($(this).attr("id") == "delV4") ? "V4" : "V6";
    delSelect(tag);
});
</script>
