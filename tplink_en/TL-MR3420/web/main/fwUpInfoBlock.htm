<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" manifest="app.manifest">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <link rel="shortcut icon" href="../favicon.ico" />
    <!-- <link type="text/css" href="css/reset.css" rel="stylesheet" /> -->




    <!--[if IE]>
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <style>
        .top-content-wrap{
            border:1px solid #ccc;
        }

        .close-layer{
            background: url(../img/icons.png) no-repeat;
        }

        div.collapse-layer .basic-icon{
            background: url(../img/icons.png) no-repeat;
        }

        .cloud-icon{
            background:url(../img/icons.png) no-repeat;
        }

        div.collapse-layer .advance-icon{
            background: url(../img/icons.png) no-repeat;
        }


    </style>
    <![endif]-->





    <title>Opening...</title>
    <style type="text/css">
    html {
        color: #4d4d4d;
        font-family: Verdana, Geneva, sans-serif;
        font-size: 12px;
    }
    body {
        margin: 0px;
        padding:0px;
    }
    iframe {
        position: absolute;
        width: 100%;
        height: 100%;
    }
    .top-content-wrap {
        background-color: #ffffff;
        border-radius: 5px;
        box-shadow: 1px 1px 8px #898989;
        padding: 30px;
        width: 660px;
        box-sizing: border-box;
        z-index: 999;
        left: 0;
        position: absolute;
        top: 0;
    }
    .close-layer {
        background: rgba(0, 0, 0, 0) url(../img/icons.png);
        background-position: -302px -22px ;
        cursor: pointer;
        height: 18px;
        position: absolute;
        right: 26px;
        top: 30px;
        width: 18px;
    }
    div.upgrade-field, div.collapse-layer {
        display: inline-block;
    }
    div.detail-field {
        width:390px;
        font-size: 14px;
    }
    div.version-field {
        width:100px;
        margin-right: 25px;
    }
    div.version-field, div.collapse-layer {
        vertical-align: top;
        margin-top: 0px;
        padding-top: 0px;
    }
    div.part-seperate button, div.part-seperate a {
        background-color: #4acbd6;
        min-width: 150px;
        border: 0 none;
        border-radius: 5px;
        color: #ffffff;
        height: 30px;
        line-height: 30px;
        margin-right: 8px;
        cursor: pointer;
        box-sizing: border-box;
        padding: 0;
        display: inline-block;
        text-align: center;
        text-decoration: none;
    }
    div.part-seperate button:hover, div.part-seperate a:hover {
        background-color: #23c4c4;
    }
    div.collapse-layer .basic-icon {
        background: rgba(0, 0, 0, 0) url(../img/icons.png);
        background-position: -81px -146px;
        height: 22px;
        width: 22px;
        display: inline-block;
        cursor: pointer;
    }
    .cloud-icon {
        background: rgba(0, 0, 0, 0) url(../img/icons.png) no-repeat;
        background-position: -112px -994px;
        height: 40px;
        width: 100px;
        display: inline-block;
    }
    div.collapse-layer .advance-icon {
        background: rgba(0, 0, 0, 0) url(../img/icons.png) no-repeat;
        background-position: -263px -120px;
        height: 22px;
        width: 22px;
        display: inline-block;
        cursor: pointer;
    }
    div.collapse-layer .basic-icon:hover {
        background-position: -419px -146px;
    }
    div.collapse-layer .advance-icon:hover {
        background-position: -159px -146px;
    }
    div.part-seperate {
        padding-left: 125px;
        padding-top: 30px;
        white-space: nowrap;
    }
    .hidden {
        display: none
    }

    </style>
    <!--[if lte IE 8]>
    <style type="text/css">
        .shadow-top {
            background: url("../img/ie-01.png") repeat-x 0 -6px;
            top: -13px;
            left: 0;
            height: 13px;
            margin: 0 17px 0 17px;
        }
        .shadow-bot {
            background: url("../img/ie-01.png") repeat-x center bottom;
            bottom: -13px;
            left: 0;
            height: 13px;
            margin: 0 17px 0 17px;
        }
        .shadow-top-left, .shadow-top-right, .shadow-bot-left, .shadow-bot-right {
            position: absolute;
            width: 17px;
            height: 11px;
            background: url(../img/ie-06.png) no-repeat 0px -56px;
        }
        .shadow-top-left {
            background-position: 0px -56px;
            left: 4px;
            top: 4px;
        }
        .shadow-top-right {
            background-position: 0px -38px;
            right: 0;
            top: 3px;
        }
        .shadow-bot-left {
            background-position: 0px -76px;
            left: 4px;
            bottom: 8px;
        }
        .shadow-bot-right {
            background-position: 0px -95px;
            right: 0;
            bottom: 8px;
        }
        .shadow-left {
            padding-left: 11px;
            background: url(../img/ie-02.png) no-repeat 0px 0px;
        }
        .shadow-right {
            padding-right: 11px;
            background: url(../img/ie-02.png) no-repeat center right;
        }
        .top-content-wrap {
            background: transparent;
            padding: 0;
            border: 0;
            width: 682px;
        }
        .top-content-inner {
            padding: 30px;
            background: #fff;
            position: relative;
        }
        div.part-seperate button, div.part-seperate a {
            background: url(../img/ie-05.png) no-repeat left -179px transparent;
        }
        div.part-seperate button span, div.part-seperate a span {
            height: 30px;
            min-width: 145px;
            margin-left: 5px;
            display: inline-block;
            background: url(../img/ie-05.png) no-repeat right -253px transparent;
        }
        div.part-seperate button:hover, div.part-seperate a:hover {
            background: url(../img/ie-05.png) no-repeat left -323px transparent;
        }
        div.part-seperate button:hover span, div.part-seperate a:hover span {
            background: url(../img/ie-05.png) no-repeat right -397px transparent;
        }
    </style>
    <![endif]-->
</head>

<body id="upgrade-body">
    <!--<noscript>-->
    <!--<meta http-equiv="refresh" content="0; url=error.html" />-->
    <!--</noscript>-->
    <iframe id="ifm_content" frameborder="0"></iframe>

    <div class="top-content-wrap hidden" id="top-content">
        <div class="shadow-top-left"></div>
        <div class="shadow-top"></div>
        <div class="shadow-top-right"></div>
        <div class="shadow-left">
            <div class="shadow-right">
                <div class="top-content-inner">
                    <div class="upgrade-field version-field">
                        <span class="cloud-icon"></span>
                    </div>
                    <div class="upgrade-field detail-field">
                        <label id="upgrade-feature-label" class="text">Hi, a new firmware is available for your wireless
                            router.</label>

                        <p id="upgrade-feature-detail-cnt" class="hidden">
                            <span id="upgrade-feature-detail" class="text">details</span>
                        </p>
                    </div>

                    <div class="collapse-layer" type="button" style="display: inline-block;">
                        <span class="basic-icon" id="open-detail"></span>
                    </div>

                    <div class="close-layer" id="close-layer"></div>

                    <div class="part-seperate">
                        <button id="never-btn" type="button">Ignore</button>
                        <button id="remind-btn" type="button">remind</button>
                        <a id="upgrade-btn" href="http://192.168.1.1" target="_blank">upgrade</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="shadow-bot-left"></div>
        <div class="shadow-bot"></div>
        <div class="shadow-bot-right"></div>
    </div>

    <script type="text/javascript">
    /*===========================
     * methods for dom operation
     *============================= */
    function setAttr(dom, attr, val) {
        if (dom.setAttribute) {
            dom.setAttribute(attr, val);
        } else {
            dom[attr] = val;
        }
    }

    function $(id) {
        return document.getElementById(id);
    }

    function inArray(elem, elems) {
        var i, l;
        l = elems.length;
        for (i = 0; i < l; i++)
            if (elems[i] === elem)
                return true;
        return false;
    }

    function hasClass(elem, className) {
        return elem && inArray(className, (elem.className ? elem.className : "").split(/\s+/));
    }

    function addClass(elem, className) {
        if (elem && elem.nodeType == 1 && !hasClass(elem, className))
            elem.className += (elem.className ? " " : "") + className;
    }

    function removeClass(elem, className) {
        if (elem && elem.nodeType == 1 && hasClass(elem, className)) {
            elem.className = elem.className.replace(className, "");
            elem.className = elem.className.replace(/\s+/, " ");
        }
    }


    document.body.onload = function() {
        /*=========================
         * code for multi language
         * =========================*/
        var charArray = (function() {
            CHAR_ARRAY = {
                'en_US': {
                    FIRMWARE_VERSION: "Firmware Version: ",
                    UPGRADE_NOW: "Upgrade Now",
                    REMIND: "Remind Me Later",
                    NOTICE: "Hi, a new firmware is available for your wireless router. Do you want to upgrade now?",
                NEVER:                          "Ignore This Version"
                },
                'de_DE': {
                    FIRMWARE_VERSION: "Firmware Version: ",
                    UPGRADE_NOW: "Jetzt Updaten",
                    REMIND: "Später Erinnern",
                    NOTICE: "Hi, eine neue Firmware ist für Ihren Router verfügbar. Möchten Sie jetzt ein Update durchführen?",
                    NEVER: "Für diese Version"
                },
                'pl_PL': {
                    FIRMWARE_VERSION: "Wersja firmware: ",
                    UPGRADE_NOW: "Aktualizuj teraz",
                    REMIND: "Przypomnij później",
                    NOTICE: "Dostępna jest nowa aktualizacja firmware'u twojego routera. Aktualizować teraz?",
                    NEVER: "Ignoruj aktualizację"
                },
                'ru_RU': {
                    FIRMWARE_VERSION: "Версия встроенного ПО: ",
                    UPGRADE_NOW: "Выполнить обновление ",
                    REMIND: "Напомнить позже",
                    NOTICE: "Добрый день, доступна новая версия встроенного ПО для Вашего беспроводного маршрутизатора. Желаете выполнить обновление сейчас?",
                    NEVER: "Проигнорировать данную версию"
                },
                'tr_TR': {
                    FIRMWARE_VERSION: "Yazılım Versiyonu: ",
                    UPGRADE_NOW: "Şimdi Güncelle",
                    REMIND: "Sonra Hatırlat",
                    NOTICE: "Kablosuz router'ınız için yeni bir yazılım versiyonu var. Şimdi güncellemek ister misiniz?",
                    NEVER: "Bu Versiyonu Yoksay"
                },
                'it_IT': {
                    FIRMWARE_VERSION: "Versione Firmware: ",
                    UPGRADE_NOW: "Aggiorna adesso",
                    REMIND: "Ricordamelo dopo",
                    NOTICE: "Un nuovo firmware è disponibile per il vostro router wireless. Volete aggiornarlo adesso?",
                    NEVER: "Ignorate questa versione"
                }
            };

            var DEFAULT_LAN = 'en_US';
            var match = document.cookie.match(/locale=(?:(\w+);?)/);
            var locale = 'en_US';

            if ('locale_language' in window) {
                locale = locale_language;
            } else if (match && match[1]) {
                locale = match[1];
            } else {
                var navLan = navigator.language || navigator.browserLanguage;
                var navLanArr = navLan.split('-');
                navLan = navLanArr[0].toLowerCase() + '_' + navLanArr[1].toUpperCase();
                if (CHAR_ARRAY.hasOwnProperty(navLan)) {
                    locale = navLan;
                } else {
                    navLan = navLanArr[0].toLowerCase();
                    for (var i in CHAR_ARRAY) {
                        if (CHAR_ARRAY.hasOwnProperty(i)) {
                            if (i.search(navLan) === 0) {
                                locale = i;
                                break;
                            }
                        }
                    }
                }
            }

            return CHAR_ARRAY[locale] || CHAR_ARRAY[DEFAULT_LAN];
        })();

        $("never-btn").innerHTML = '<span>' + charArray.NEVER + '</span>';
        $("remind-btn").innerHTML = '<span>' + charArray.REMIND + '</span>';
        $("upgrade-btn").innerHTML = '<span>' + charArray.UPGRADE_NOW + '</span>';
        $("upgrade-feature-label").innerHTML = charArray.NOTICE;

        /*=======================
         * control the view depends on the fwVersion
         * =======================*/
        try {
            $('upgrade-feature-detail').innerHTML = charArray.FIRMWARE_VERSION + fwVersion + '<br>' + fwReleaseLog;
            if (fwType === 3) {
                $("never-btn").style.display = "none";
                $("remind-btn").style.display = "none";
            } else if (fwType === 2) {
                $("never-btn").style.display = "inline";
                $("remind-btn").style.display = "inline";
            }
        } catch (e) {

        }

        function setCenter() {
            var top_content_width = 542;
            var leftOff = parseInt(document.body.clientWidth - top_content_width) / 2;
            $("top-content").style.left = leftOff + 'px';
        }

        setCenter();
        window.onresize = function() {
            setCenter();
        };

        // $("#top-content").removeClass("hidden");
        //$("#top-content").fadeIn(1000);

        setTimeout(function() {
            $("top-content").style.display = 'block';
        }, 3000);
        /*=======================
         * code for iframe
         * =======================*/
        var getUrlParam = function(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }


        var ori_url = getUrlParam("url");
        var reg = new RegExp("(^http:|^https:)");
        if (reg.test(ori_url)) {
            ori_url = ori_url;
        } else {
            ori_url = "http://" + ori_url;
        }

        setAttr($("ifm_content"), "src", ori_url);
        setAttr($("upgrade-btn"), "href", location.protocol + '//' + location.host);

        //    code for event
        $("close-layer").onclick = function() {
            $("top-content").style.display = "none";
            window.location.href = ori_url;
        };

        $("open-detail").onclick = function() {
            if ($("open-detail").className == 'basic-icon') {
                $("upgrade-feature-detail-cnt").style.display = 'block';
                $("open-detail").className = 'advance-icon';
            } else {
                $("upgrade-feature-detail-cnt").style.display = 'none';
                $("open-detail").className = 'basic-icon';
            }
        };
        /*=======================================
         * code for logical. send data to backend.
         * =======================================*/
        function getHttpObject(hook) {
            var xmlHttp = null;
            try {
                xmlHttp = new XMLHttpRequest();
            } catch (e) {
                try {
                    xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
                } catch (e) {
                    try {
                        xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                    } catch (e) {
                        /* How to handle this error? */
                    }
                }
            }
            xmlHttp.onreadystatechange = function() {
                if (xmlHttp.readyState == 4) {
                    if (hook)
                        hook();
                }
            };
            return xmlHttp;
        }
        function utf8_encode(string) {
            string = string.replace(/\r\n/g, "\n");
            var utftext = "";

            for (var n = 0; n < string.length; n++) {
                var c = string.charCodeAt(n);
                if (c < 128) {
                    utftext += String.fromCharCode(c);
                } else if ((c > 127) && (c < 2048)) {
                    utftext += String.fromCharCode((c >> 6) | 192);
                    utftext += String.fromCharCode((c & 63) | 128);
                } else {
                    utftext += String.fromCharCode((c >> 12) | 224);
                    utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                    utftext += String.fromCharCode((c & 63) | 128);
                }
            }
            return utftext;
        }
        function Base64Encoding(input) {
            var keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
            var output = "";
            var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
            var i = 0;
            input = utf8_encode(input);
            while (i < input.length) {
                chr1 = input.charCodeAt(i++);
                chr2 = input.charCodeAt(i++);
                chr3 = input.charCodeAt(i++);
                enc1 = chr1 >> 2;
                enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
                enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
                enc4 = chr3 & 63;

                if (isNaN(chr2)) {
                    enc3 = enc4 = 64;
                } else if (isNaN(chr3)) {
                    enc4 = 64;
                }
                output = output + keyStr.charAt(enc1) + keyStr.charAt(enc2) + keyStr.charAt(enc3) + keyStr.charAt(enc4);
            }
            return output;
        }
        function doSetWanBlockAction(action, callback) {
            var xmlHttpObj;
            xmlHttpObj = getHttpObject(function() {
                if (xmlHttpObj.status == 200) {
                    callback();
                } else {
                    return;
                }
            });

            var webAction = encodeURIComponent(Base64Encoding(action));
            xmlHttpObj.open("POST", "http://" + window.location.host + "/cgi/wanBlock?action=" + webAction, true);
            xmlHttpObj.send(null);
        }

        //    /cgi/wanBlock?action=
        //            action后可以跟的值有：
        //wan口错误拦截页面：
        //"wanErrorBlock-DR"  /*DR: don't remind*/
        //    固件推送信息拦截页面（高优先级）：
        //"fwUpInfoHigh-UN"   /*UN: update now.*/
        //    固件推送信息拦截页面（中等优先级）：
        //"fwUpInfoMiddle-DR" /*DR: don't remind*/
        //    "fwUpInfoMiddle-RL" /*RL: remind later.*/
        //    "fwUpInfoMiddle-UN" /*UN: update now.*/
        var ACT_DR = "fwUpInfoMiddle-DR",
            /*DR: don't remind*/
            ACT_RL = "fwUpInfoMiddle-RL",
            /*RL: remind later.*/
            ACT_UN_H = "fwUpInfoHigh-UN",
            /*UN: update now.*/
            ACT_UN_M = "fwUpInfoMiddle-UN"; /*UN: update now.*/

        $("never-btn").onclick = function() {
            doSetWanBlockAction(ACT_DR, function() {
                window.location.href = ori_url;
            });
        };

        $("remind-btn").onclick = function() {
            doSetWanBlockAction(ACT_RL, function() {
                window.location.href = ori_url;
            });
        };

        $("upgrade-btn").onclick = function() {
            // var ret = location.href.match(/(https?):\/\/([^:\/]+)(:\d+)?\/?([^?]*)/);
            // location.href = ret[1] + "://" + ret[2] + (ret[3] ? ret[3] : "") + "/";
            // document.cookie = "goToUpgrade=true;path=/"
            if (fwType === 3) {
                doSetWanBlockAction(ACT_UN_H, function () {
                    document.cookie = "goToUpgrade=true;path=/";
//                    window.location.href = ori_url;
                });
            } else if (fwType === 2) {
                doSetWanBlockAction(ACT_UN_M, function () {
                    document.cookie = "goToUpgrade=true;path=/";
//                    window.location.href = ori_url;
                });
            }
        };


    }
    </script>
</body>

</html>
