!function(a){a.su.moduleManager.define("initLogin",{services:["ajax","device"],views:["initLoginView"],deps:["main"],models:["initLoginModel","initLoginControl","improvementModel"],listeners:{ev_on_launch:function(n,o,e,i,t,r,a){a.ajax.request({proxy:"keyProxy",success:function(n){n&&n.password&&(o.encryptKey=n.password)}})}},init:function(e,i,n,o,t,r){this.control({"#init-login-confirm":{keyup:function(n){n.preventDefault();var o=!i.initLoginView.initLoginButton.isDisabled();13==n.keyCode&&o&&(a(n.target).blur(),e.doInitLogin())}},"#init-login-button":{ev_button_click:function(){e.doInitLogin()}}})}},function(o,n,i,e,t,r){return{supportTetherGuidance:r.device.getConfig().supportTetherGuidance,isMobile:a.su.isMobile(),encryptKey:null,doInitLogin:function(){if(i.initLoginControl.validate()){i.initLoginControl.password.getValue();if(i.initLoginControl.password.getValue()!=i.initLoginControl.confirm.getValue())return i.initLoginControl.confirm.setError(a.su.CHAR.ERROR["00000080"]),!1;var n=i.initLoginControl.password.doEncrypt(o.encryptKey);i.initLoginModel.password.setValue(n),o.initEncryptor().then(o.handleLogin)}},initEncryptor:function(){var o=a.Deferred();return a.su.encryptor?(r.ajax.requestPromise({proxy:"authProxy"}).then(function(n){a.su.encryptor.setRSAKey(n.key[0],n.key[1]),a.su.encryptor.setSeq(n.seq),a.su.encryptor.genAESKey();n=i.initLoginControl.password.getValue();a.su.encryptor.setHash("admin",n),a.encrypt.encryptManager.recordEncryptor(),o.resolve()}).fail(function(){o.reject()}),o.promise()):o.resolve()},handleLogin:function(){i.initLoginModel.login({success:function(n){r.device.getConfig().supportTetherGuidance?o.showUeipMsg(n):o.handleLoginSuccess(n)},fail:o.handleLoginFail})},handleLoginSuccess:function(n){var o,e=n.stok||(n="12345",e=top.location.href,o=e.indexOf("stok="),n=0<=o?e.substring(o+5):n);localStorage&&(t.main.setToken(e),t.main.reload())},showUeipMsg:function(n){o.loginData=n},handleLoginFail:function(n,o){var e=!(n.data&&n.data.failureCount&&5<=n.data.failureCount);n.data&&n.data.hasOwnProperty("errorcode")&&e&&(e=String(n.data.errorcode).replace(/^-/,"E"),i.localLoginControl.password.setErrorHtml(a.su.CHAR.ERROR[e]))}}})}(jQuery);