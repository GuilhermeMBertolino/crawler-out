!function(a){a.su.moduleManager.define("networkStatus",{models:["wanStatus","internetConnect","lanAdvLanModel","lanAdvLinkAggModel","iptvVlan","dhcpServer","ddnsAdv","ddnsAdvTplinkModel","ddnsAdvNoipModel","ddnsAdvDnydnsModel"],services:["device"],stores:["iptvVlanStore","ddnsAdvTplinkStore"],views:["networkStatusView"],listeners:{ev_on_launch:function(e,n,t,a,s,d,r){this.unRegisterAutoSaveData(a.ddnsAdv),n.refreshStatus(),n.refresh=setInterval(n.refreshStatus,1e4)}},init:function(e,o,i,n,t,l){this.configViews({id:"networkStatusView",items:[{id:"internet-conn-type",renderer:function(e){switch(e){case"dhcp":return a.su.CHAR.NETWORK_STATUS.DYNAMIC_IP;case"static":return a.su.CHAR.NETWORK_STATUS.STATIC_IP;case"pppoe":return a.su.CHAR.NETWORK_STATUS.PPPOE;case"l2tp":return a.su.CHAR.NETWORK_STATUS.L2TP;case"pptp":return a.su.CHAR.NETWORK_STATUS.PPTP;case"dslite":return a.su.CHAR.NETWORK_INTERNET.DSLITE;case"v6plus":return a.su.CHAR.NETWORK_INTERNET.V6_PLUS;case"ocn":return a.su.CHAR.NETWORK_INTERNET.OCN}}},{id:"dhcp-server-status",renderer:function(e){return"off"==e?a.su.CHAR.NETWORK_STATUS.DISABLED:a.su.CHAR.NETWORK_STATUS.ENABLED}},{id:"ddns-service-provider",renderer:function(e){switch(e){case 0:return a.su.CHAR.NETWORK_STATUS.TP_LINK;case 1:return a.su.CHAR.NETWORK_STATUS.NO_IP;case 2:return a.su.CHAR.NETWORK_STATUS.DNYDNS}}}]}),this.listen({"models.wanStatus":{ev_loaded:e.setStatusPanel},"models.lanAdvLinkAggModel":{ev_loaded:function(e,n,t){var a=i.lanAdvLinkAggModel.portSettings.getValue(),s=[];if("1"==i.lanAdvLinkAggModel.getData().enableAgg){for(var d=0;d<a.length;d++)a[d].enable&&(s[s.length]=l.device.getPortName(a[d].name));var r=s.join(" & ");o.networkStatusView.lanLink.show(),o.networkStatusView.lanLink.setValue(r)}else o.networkStatusView.lanLink.hide()}},"models.iptvVlan":{ev_loaded:function(e,n,t){"off"==i.iptvVlan.getData().enable?o.networkStatusView.iptvPanel.hide():o.networkStatusView.iptvPanel.show()}},"models.dhcpServer":{ev_loaded:function(e,n,t){"off"==i.dhcpServer.getData().enable?i.dhcpServer.ipaddrStart.hide():i.dhcpServer.ipaddrStart.show()}},"models.lanAdvLanModel.maskType":{ev_value_change:function(e,n,t){switch(n){case 0:i.lanAdvLanModel.maskType.setValue("255.255.255.0");break;case 1:i.lanAdvLanModel.maskType.setValue("255.255.0.0");break;case 2:i.lanAdvLanModel.maskType.setValue("255.0.0.0");break;case 3:i.lanAdvLanModel.maskType.setValue(i.lanAdvLanModel.customValue.getValue())}}},"models.dhcpServer.ipaddrEnd":{ev_value_change:function(e,n,t){var a=i.dhcpServer.ipaddrStart.getValue();i.dhcpServer.ipaddrStart.setValue(a+"-"+n)}}})}},function(s,d,n,r,e,o){return{refreshStatus:function(){n.internetConnect.load(),n.wanStatus.load(),n.lanAdvLanModel.load(),n.lanAdvLinkAggModel.load(),n.iptvVlan.load(),r.iptvVlanStore.load({data:{operation:"read"},success:function(e){s.lanNum=e.port_settings.length;for(var n=0;n<s.lanNum;n++){var t=r.iptvVlanStore.getSubModelBindByIndex(n),a=t.name.getValue();t.lan.setLabelField(o.device.getPortName(a))}r.iptvVlanStore.show()}}),n.dhcpServer.load(),n.ddnsAdv.load({success:function(e){if("off"===e.enable)d.networkStatusView.ddnsPanel.hide();else switch(d.networkStatusView.ddnsPanel.show(),e.provider){case"tp-link":a.su.userInfo.token&&(r.ddnsAdvTplinkStore.load({success:function(e){s.setCurrentDomain(e)}}),d.networkStatusView.ddnsAdvTplink.show());break;case"noip":n.ddnsAdvNoipModel.load(),d.networkStatusView.ddnsAdvNoip.show();break;case"dyndns":n.ddnsAdvDnydnsModel.load(),d.networkStatusView.ddnsAdvDnydns.show()}}})},setCurrentDomain:function(e){for(var n="",t=e.length,a=0;a<t;a++)"occupied"===e[a].status&&(n=e[a].domain);d.networkStatusView.currentDomain.setValue(n)},setStatusPanel:function(e,n){d.networkStatusView.internetStatusPanel.show()}}})}(jQuery);