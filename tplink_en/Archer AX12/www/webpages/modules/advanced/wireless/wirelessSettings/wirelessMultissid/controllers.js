!function(R){var A="2g",T="5g";R.su.moduleManager.define("wirelessMultissid",{deps:["utils"],services:["ajax","device"],models:["wireless2gModel","wireless5gModel","wirelessEdit2gModel","wirelessEdit5gModel","ofdmaModel","twtModel","regionWirelessCapabilityModel","regionWirelessModel"],stores:["wireless2gStore","wireless5gStore","encryptionStore","transPower2gStore","transPower5gStore","htmode2gStore","channel2gStore","hwmode2gStore","htmode5g1Store","channel5g1Store","hwmode5g1Store"],views:["wirelessMultissidView"],listeners:{ev_on_launch:function(e,s,t,i,n,a,o){this.unRegisterAutoSaveData([i.wirelessEdit2gModel,i.wirelessEdit5gModel,n.wireless2gStore,n.wireless5gStore]),i.regionWirelessModel.load(),i.ofdmaModel.load(),i.twtModel.load(),i.wireless2gModel.load(),i.wireless5gModel.load(),n.wireless2gStore.load(),n.wireless5gStore.load(),s.checkMuMimo(),t.wirelessMultissidView.modeTab.itemClick("wireless-2g-mode")}},init:function(a,i,o,r,e,s){var t='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-%type% btn-%type%"><span class="icon"></span><span class="text"></span></a>',n={};function l(e){var s=R.su.CHAR.WIRELESS_SETTINGS["MODE_"+e.toUpperCase()];return{popEditor:{content:"#grid-wireless-editor-"+e},columns:[{text:R.su.CHAR.WIRELESS_SETTINGS.BAND,dataIndex:"key",width:80,renderer:function(e){return s+"-"+e}},{text:R.su.CHAR.WIRELESS_SETTINGS.WIRELESS_NETWORK_NAME,dataIndex:"ssid",width:100},{text:R.su.CHAR.WIRELESS_SETTINGS.WIRELESS_PASSWORD,dataIndex:"encryption",renderer:a.formatPassword,width:90},{text:R.su.CHAR.WIRELESS_SETTINGS.SECURITY,dataIndex:"encryption",width:160,renderer:function(e){return n[e]||n["0"]}},{text:R.su.CHAR.GRID.STATUS,dataIndex:"enable",width:80,xtype:"customWidget",widgetName:"switch",settings:{labelField:null,trueValue:"on",falseValue:"off"}},{text:R.su.CHAR.GRID.MODIFY,xtype:"actioncolumn",renderer:function(){return t.replace(/%type%/g,"edit")+t.replace(/%type%/g,"share")}}]}}n[R.su.securityCode.no_security]=R.su.CHAR.WIRELESS_SETTINGS.NO_SECURITY,n[R.su.securityCode.psk_aes]=R.su.CHAR.WIRELESS_SETTINGS.WPA2_AES,n[R.su.securityCode.psk_aes_tkip]=R.su.CHAR.WIRELESS_SETTINGS.WPA2_AES_TKIP,n[R.su.securityCode.psk_sae_personal]=R.su.CHAR.WIRELESS_SETTINGS.WPA3_PERSONAL,n[R.su.securityCode.psk_sae_personal_aes]=R.su.CHAR.WIRELESS_SETTINGS.WPA3_PERSONAL_AES,n[R.su.securityCode.wpa_enterprise]=R.su.CHAR.WIRELESS_SETTINGS.WPA2_ENTERPRISE,n[R.su.securityCode.wpa_enterprise_tkip]=R.su.CHAR.WIRELESS_SETTINGS.WPA_WPA2_ENTERPRISE,this.configViews({id:"wirelessMultissidView",items:[{id:"wireless-mode-tab",fields:[{text:R.su.CHAR.WIRELESS_SETTINGS.MODE_2G,name:"wireless-2g-mode",container:"wireless-2g-mode"},{text:R.su.CHAR.WIRELESS_SETTINGS.MODE_5G,name:"wireless-5g-mode",container:"wireless-5g-mode"}]},{id:"grid-wireless-2g",configs:l(A)},{id:"grid-wireless-5g",configs:l(T)}]}),this.listen({"models.regionWirelessModel":{ev_loaded:function(e,s){a.setRegion(s.country.toUpperCase()),o.regionWirelessCapabilityModel.loadData(s.capability,!0)}},"models.regionWirelessCapabilityModel":{ev_loaded:function(e,s){a.checkWirelessBand(s),a.initRegionData()}},"stores.wireless2gStore":{ev_loaded:function(e,s){a.handleHwmodeOptions(A),a.handleEncryptionOptions(A)},ev_data_change:a.onWirelessStatusChange},"stores.wireless5gStore":{ev_loaded:function(e,s){a.handleHwmodeOptions(T),a.handleEncryptionOptions(T)},ev_data_change:a.onWirelessStatusChange},"models.wireless2gModel":{ev_loaded:function(){a.initChannelValue(A)}},"models.wireless5gModel":{ev_loaded:function(){a.initChannelValue(T)}},"models.wirelessEdit2gModel.enable":{ev_value_change:a.onEditingStatusChange},"models.wirelessEdit5gModel.enable":{ev_value_change:a.onEditingStatusChange},"models.wirelessEdit2gModel.encryption":{ev_value_change:a.onEncryptionChange},"models.wirelessEdit5gModel.encryption":{ev_value_change:a.onEncryptionChange},"models.wireless2gModel.hwmode":{ev_value_change:function(e,s,t){a.handle2gChannelOptions(s,t),a.handleHtmodeOptions(A,s),a.handleEncryptionOptions(A),a.checkOfdmaAndTwt()}},"models.wireless5gModel.hwmode":{ev_value_change:function(e,s){a.handleHtmodeOptions(T,s),a.handleEncryptionOptions(T),a.checkOfdmaAndTwt()}},"models.wireless5gModel.htmode":{ev_value_change:function(e,s,t){var s="auto"==s?20:parseInt(s),i=o.regionWirelessCapabilityModel.channel5g.getValue(),n=[],n=160==s?a.getHtChannel160Items(i,T,!0):a.getHtChannelItems(i,s,!0);r.channel5g1Store.loadItems(n),t&&o.wireless5gModel.isDirty()&&a.initChannelValue(T)}}}),this.control({".grid-wireless":{ev_grid_before_edit:function(e,s,t){i.wirelessMultissidView.wifisharing.hideContent(),a.setEditorContent(a.getWirelessMode(),t),a.setEditingId(t)},ev_grid_before_save:function(e,s,t){s.preventDefault(),a.validateEditModel()&&(a.isLastWireless()?i.wirelessMultissidView.disableAllMsg.show():a.updateWirelessConfig(t))},ev_grid_save:function(){a.setEditingId("")},ev_grid_cancel:function(){a.setEditingId("")}},".grid-wireless => a.btn-share":{ev_grid_action_click:a.showWifisharing},"#disable-all-msg":{ev_msg_ok:a.onDisableAllMsgOk,ev_msg_cancel:a.onDisableAllMsgCancel,ev_msg_close:a.onDisableAllMsgCancel},"#wireless-mode-tab":{ev_switch_click:function(e,s){s=-1<s.indexOf(A)?A:T;a.setWirelessMode(s),a.resetWirelessModel(s)}}})}},function(o,a,r,l,i,n){var d="",u=A,e=r.regionWirelessCapabilityModel.channel2g.getValue(),c=!1,g="",h="",p={},t=(p[A]=0,p[T]=0,A,T,[R.su.securityCode.psk_aes_tkip,R.su.securityCode.wpa_enterprise_tkip]),S=["ax","ax_5"],w=[A,T],f={},_={},E={},m={},M={},C={},v=(m[A]="hwmode2gStore",M[A]="htmode2gStore",C[A]="channel2gStore",m[T]="hwmode5g1Store",M[T]="htmode5g1Store",C[T]="channel5g1Store",f[A]="wireless2gModel",f[T]="wireless5gModel",_[A]="wirelessEdit2gModel",_[T]="wirelessEdit5gModel",E[A]="wireless2gStore",E[T]="wireless5gStore",[36,40,44,48,52,56,60,64,100,104,108,112,116,120,124,128]),W=[36,40,44,48,52,56,60,64],y=[52,56,60,64,100,104,108,112,116,120,124,128,132,136,140,144];function I(e){return 0<p[e]?"off":"on"}function b(e){var s=function(){var e={};"s"==R.su.widgetSize?(e.x=30,e.y=55):(e.x=0,e.y=186);return e}();R("#grid-wifisharing").css({top:e.y-s.y+R(".page-content").scrollTop(),left:e.width-s.x})}return{isLastWireless:function(){var i=enableWirelssNum=0;return storeData=enableWirelss=[],R.each(w,function(e,s){var t;storeData=l[E[s]].getData(),enableWirelss=R.grep(storeData,function(e){return"on"==e.enable}),enableWirelssNum=enableWirelss.length,s==o.getWirelessMode()&&(enableWirelssNum+=c),i+=enableWirelssNum,t=enableWirelssNum,p[s]=t}),i<=0},setEditingId:function(e){d=e},setEditorContent:function(e,s){var s=l[E[e]].getModelByKey(s).key.getValue(),t=r[_[e]].enable,e=R.su.CHAR.WIRELESS_SETTINGS["MODE_"+e.toUpperCase()]+"-"+s;t.setLabelField(e)},setWirelessMode:function(e){u=e},getWirelessMode:function(){return u},getChannel2gLength:function(){return e&&e.length},resetWirelessModel:function(t){var i,n=this;R.each(w,function(e,s){i=r[f[s]],s==t?(n.registerAutoSaveData([i]),i.reset(),o.initChannelValue(s)):n.unRegisterAutoSaveData([i])})},validateEditModel:function(){return r[_[o.getWirelessMode()]].validate()},handleEncryptionOptions:function(e){var s=r[f[e]].hwmode.getValue();r[_[e]].encryption[-1<R.inArray(s,S)?"disableItems":"enableItems"](t)},handleHwmodeOptions:function(e){e=e||o.getWirelessMode(),r[f[e]].hwmode[e=l[E[e=e]].getData(),R.grep(e,function(e){return-1<R.inArray(e.encryption,t)}).length?"disableItems":"enableItems"](S)},handleHtmodeOptions:function(e,s){var t=r[f[e]]["htmode"];switch(s){case"b":case"g":case"bg":case"a_5":t.setValue("auto"),t.hide();break;case"n_5":case"an_5":t.disableItems(["80"]),"80"==t.getValue()&&t.setValue("auto"),t.show();break;default:t.enableItems(["80"]),t.show()}},handle2gChannelOptions:function(e,s){var t=r.wireless2gModel;13<o.getChannel2gLength()&&("b"==e||"b"==s)&&o.initChannelItems(A,function(){s&&t.channel.isDirty()&&o.initChannelValue(A)},"b"==e)},initChannelValue:function(e){var s,t;e===o.getWirelessMode()&&(s=r[f[e]].channel.getValue(),t=l[C[e]].getData(),r[f[e]].channel.setValue(i.utils.valInObjArr(s,t)?s:"auto"))},onEncryptionChange:function(e,s){var t=o.getWirelessMode(),i=r[_[t]]["pskKey"],n=a.wirelessMultissidView["wpaEnterprise"+t];switch(s){case R.su.securityCode.no_security:n.hide(),i.hide(),i.disable();break;case R.su.securityCode.psk_aes:case R.su.securityCode.psk_aes_tkip:n.hide(),i.show(),i.enable(),i.setVtype("psk_password"),i.setMaxLength(64);break;case R.su.securityCode.psk_sae_personal:case R.su.securityCode.psk_sae_personal_aes:n.hide(),i.show(),i.enable(),i.setVtype("wpa3_password"),i.setMaxLength(63);break;case R.su.securityCode.wpa_enterprise:case R.su.securityCode.wpa_enterprise_tkip:i.hide(),i.disable(),n.show()}},onWirelessStatusChange:function(){d||(o.isLastWireless()?a.wirelessMultissidView.disableAllMsg.show():o.updateWirelessStatus())},onEditingStatusChange:function(e,s,t){d&&(c=t?"off"==s&&"on"==g?-1:"on"==s&&"off"==g?1:0:(g=s,!1))},onDisableAllMsgOk:function(){d?o.updateWirelessConfig(d):o.updateWirelessStatus()},onDisableAllMsgCancel:function(){d||o.reloadWirelessStore()},checkOfdmaAndTwt:function(){var e=r.wireless2gModel.hwmode.getValue(),s=r.wireless5gModel.hwmode.getValue();"bgn"==e&&"anac_5"==s?(r.ofdmaModel.enable.disable(),r.twtModel.enable.disable()):(r.ofdmaModel.enable.enable(),r.twtModel.enable.enable())},checkMuMimo:function(){var e=n.device.getConfig();e.supportMUMIMO&&e.support5G1MUMIMO&&r.wirelessEdit5gModel.muMimo.show()},updateWirelessStatus:function(){var t=o.getWirelessMode(),i=l[E[t]],e=i.checkDataChange().update,n={operation:"update"};R.each(e,function(e,s){if(!s)return!1;R.extend(n,i.getModelByKey(e).getData("submit",!0),{disabled_all:I(t)}),o.submitWirelessStatus(t,n)})},updateWirelessConfig:function(s){var t=o.getWirelessMode(),e={operation:"update"},i=r[_[t]].getData("submit",!0);i.vlan=parseInt(i.vlan),R.extend(e,i,{key:s,disabled_all:I(t)}),o.submitWirelessStatus(t,e,function(){var e=l[E[t]];e.getPlugin("popEditor").completeEdit(),e.dom().triggerHandler("ev_grid_cancel",[s])})},submitWirelessStatus:function(e,s,t){function i(){t&&t(),o.reloadWirelessStore()}n.ajax.request({proxy:e==A?"wireless2gProxy":"wireless5gProxy",data:s,success:i,fail:i,error:i})},reloadWirelessStore:function(){l[E[o.getWirelessMode()]].load()},formatPassword:function(e,s,t){switch(e){case R.su.securityCode.no_security:return t?"":"---";case R.su.securityCode.wpa_enterprise:case R.su.securityCode.wpa_enterprise_tkip:return s.wpaKey;default:return s.pskKey}},showWifisharing:function(s,t){a.wirelessMultissidView.wifisharing.hideContent(),setTimeout(function(){var e;b(s.target.getBoundingClientRect()),a.wirelessMultissidView.wifisharing.setValue((e=t,{ssid:(e=l[E[u]].getModelByKey(e).getData()).ssid,password:o.formatPassword(e.encryption,e,!0),security:e.encryption})),a.wirelessMultissidView.wifisharing.showContent()},200)},setRegion:function(e){h=e},getHtChannelItems:function(e,s,t){if(!e)return[];var i=[],n=-1,a=0,o=e.length;if(i[0]={name:R.su.CHAR.WIRELESS_SETTINGS.AUTO,value:"auto"},!(s%20))for(var r=0;r<=o;r++){var l=parseInt(e[r]);if(n<0||n+4==l)a+=20;else{for(;a%s;)i.pop(),a-=20;if(isNaN(l))break;a=20}i.push({name:(n=l)+(t&&-1<R.inArray(l,y)?"(DFS)":""),value:l.toString()})}return i},getHtChannel160Items:function(e,s,t){for(var i=[],n=e.length,a=s!=T||"CA"!=h&&"AU"!=h?v:W,o=0;o<n;o++){var r=parseInt(e[o]);R.inArray(r,a)<0||i.push({name:r+(t&&0<=R.inArray(r,y)?"(DFS)":""),value:r.toString()})}return i},checkWirelessBand:function(t){var i,e=w;R.each(e,function(e,s){(i=t["channel"+s])&&i.length||w.splice(e,1)})},initRegionData:function(){R.each(w,function(e,s){o.initHtmodeItems(s),o.initHwmodeItems(s),o.initChannelItems(s)})},initHtmodeItems:function(e){var s=l[M[e]],e=function(e){var s=[];s[0]={name:R.su.CHAR.WIRELESS_SETTINGS.AUTO,value:"auto"};for(var t=0;t<e.length;t++)s.push({name:e[t]+R.su.CHAR.WIRELESS_SETTINGS.MHZ,value:e[t]});return s}(r.regionWirelessCapabilityModel["htmode"+e].getValue());s.loadData(e)},initHwmodeItems:function(e){var s=l[m[e]],e=function(e){for(var s=[],t=0;t<e.length;t++)s.push({name:R.su.CHAR.WIRELESS_SETTINGS["MODE_"+e[t].toUpperCase()],value:e[t]});return s}(r.regionWirelessCapabilityModel["hwmode"+e].getValue());s.loadData(e)},initChannelItems:function(e,s,t){var i=l[C[e]],n=r.regionWirelessCapabilityModel["channel"+e].getValue(),a=[];e==A&&13<n.length?(a=o.getHtchannelItems(n,20),t||a.pop()):a=function(e){var s=[];s[0]={name:R.su.CHAR.WIRELESS_SETTINGS.AUTO,value:"auto"};for(var t=0;t<e.length;t++)s.push({name:e[t],value:e[t].toString()});return s}(n),i.loadData(a),s&&s(a)}}})}(jQuery);