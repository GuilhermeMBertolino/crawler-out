!function(w){w.su.moduleManager.define("throughputMonitor",{services:["ajax","timer"],models:["throughputModel"],stores:["throughputMonitorSelecterStore"],views:["throughputMonitorView"],listeners:{ev_on_launch:function(e,t,r,o,i,a,n){o.throughputModel.load({success:function(e){e.device_2g_enable||(r.throughputMonitorView.throughputMonitorSelect.disableItem(0),r.throughputMonitorView.throughputMonitorSelect.disableItem(1)),e.device_5g_enable||(r.throughputMonitorView.throughputMonitorSelect.disableItem(2),r.throughputMonitorView.throughputMonitorSelect.disableItem(3))}}),t.initECharts(),w("#throughput-monitor-chart-lable-g2rx").hide(),w("#throughput-monitor-chart-lable-g2tx").hide(),w("#throughput-monitor-chart-lable-g5rx").hide(),w("#throughput-monitor-chart-lable-g5tx").hide()},ev_before_destroy:function(e,t,r,o,i,a,n){t.clearPageInterval(),t.destoryChart()}},init:function(o,e,t,r,i,a){this.control({}),this.listen({"views.throughputMonitorView.throughputMonitorSelect":{ev_value_change:function(e,t,r){t.g2rx?w("#throughput-monitor-chart-lable-g2rx").show():w("#throughput-monitor-chart-lable-g2rx").hide(),t.g2tx?w("#throughput-monitor-chart-lable-g2tx").show():w("#throughput-monitor-chart-lable-g2tx").hide(),t.g5rx?w("#throughput-monitor-chart-lable-g5rx").show():w("#throughput-monitor-chart-lable-g5rx").hide(),t.g5tx?w("#throughput-monitor-chart-lable-g5tx").show():w("#throughput-monitor-chart-lable-g5tx").hide(),o.setGetThroughputInterval(),o.selectedSeries=t,o.setSeriesData(!0)}}})}},function(o,e,t,r,i,a){var n,s=!0,g="Kbps",l={g2rx:[],g2tx:[],g5rx:[],g5tx:[]},c={g2rx:[],g2tx:[],g5rx:[],g5tx:[]},h=0,u=0,d=0,x=0,p=0,v=0,_=0,m=0,f={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:[],axisLabel:{interval:5}},yAxis:{type:"value",name:"Kbps"},series:[]},b={name:"2grx",type:"line",symbol:"none",data:[],itemStyle:{normal:{lineStyle:{width:2,color:"#0091ff"}}}},y={name:"2gtx",type:"line",symbol:"none",data:[],itemStyle:{normal:{lineStyle:{width:2,type:"dotted",color:"#31c4ff"}}}},S={name:"5grx",type:"line",symbol:"none",data:[],itemStyle:{normal:{lineStyle:{width:2,color:"#fa6400"}}}},F={name:"5gtx",type:"line",symbol:"none",data:[],itemStyle:{normal:{lineStyle:{width:2,type:"dotted",color:"#f7b400"}}}},M=null;return{selectedSeries:{g2rx:!1,g2tx:!1,g5rx:!1,g5tx:!1},setGetThroughputInterval:function(){null===M&&(M=a.timer.setInterval(o,function(){a.ajax.request({proxy:"throughputProxy",success:function(e){o.pushSeriesData(e)},fail:function(e){o.clearPageInterval()},error:function(){o.clearPageInterval()}})},1e3,!0))},pushSeriesData:function(e){if(s)s=!1,o.setLastData(e);else{if(60<l.g2rx.length){for(var t in l)l[t].shift();for(var t in c)c[t].shift()}e.device_2g&&(l.g2rx.push(parseFloat(e.device_2g.device_2g_rx)-h),l.g2tx.push(parseFloat(e.device_2g.device_2g_tx)-u),c.g2rx.push((parseFloat(e.device_2g.device_2g_rx)/1024).toFixed(2)-p),c.g2tx.push((parseFloat(e.device_2g.device_2g_tx)/1024).toFixed(2)-v)),e.device_5g&&(l.g5rx.push(parseFloat(e.device_5g.device_5g_rx)-d),l.g5tx.push(parseFloat(e.device_5g.device_5g_tx)-x),c.g5rx.push((parseFloat(e.device_5g.device_5g_rx)/1024).toFixed(2)-_),c.g5tx.push((parseFloat(e.device_5g.device_5g_tx)/1024).toFixed(2)-m)),o.setLastData(e),o.setSeriesData()}},setLastData:function(e){e.device_2g&&(h=parseFloat(e.device_2g.device_2g_rx),u=parseFloat(e.device_2g.device_2g_tx),p=(parseFloat(e.device_2g.device_2g_rx)/1024).toFixed(2),v=(parseFloat(e.device_2g.device_2g_tx)/1024).toFixed(2)),e.device_5g&&(d=parseFloat(e.device_5g.device_5g_rx),x=parseFloat(e.device_5g.device_5g_tx),_=(parseFloat(e.device_5g.device_5g_rx)/1024).toFixed(2),m=(parseFloat(e.device_5g.device_5g_tx)/1024).toFixed(2))},getEcharts:function(){var e=w.Deferred();return void 0===window.echarts?w.su.router.loadFile("js/libs/echarts.min.js",function(){e.resolve(window.echarts)}):window.echarts&&e.resolve(window.echarts),e.promise()},initECharts:function(){o.getEcharts().then(function(e){for(var t=document.getElementById("throughput-monitor-chart"),r=0;r<=60;r++)f.xAxis.data.push(r+"s");(n=e.init(t)).setOption(f)})},setSeriesData:function(e){var t=[],r=(1024<=o.getSeriesDataMax()&&"Kbps"==g?o.changeUnitToMbps():o.getSeriesDataMax()<1&&"Mbps"==g&&o.changeUnitToKbps(),"Kbps"==g?l:c);o.selectedSeries.g2rx&&(b.data=r.g2rx,t.push(b)),o.selectedSeries.g2tx&&(y.data=r.g2tx,t.push(y)),o.selectedSeries.g5rx&&(S.data=r.g5rx,t.push(S)),o.selectedSeries.g5tx&&(F.data=r.g5tx,t.push(F)),e?o.setEchartsClean(t):o.setEcharts(t)},getSeriesDataMax:function(){var e=[],t="Kbps"==g?l:c;return o.selectedSeries.g2rx&&(e=e.concat(t.g2rx)),o.selectedSeries.g2tx&&(e=e.concat(t.g2tx)),o.selectedSeries.g5rx&&(e=e.concat(t.g5rx)),o.selectedSeries.g5tx&&(e=e.concat(t.g5tx)),Math.max.apply(null,e)},changeUnitToMbps:function(){g="Mbps",f.yAxis.name="Mbps"},changeUnitToKbps:function(){g="Kbps",f.yAxis.name="Kbps"},setEcharts:function(e){f.series=e,n.setOption(f)},setEchartsClean:function(e){f.series=e,n.setOption(f,!0)},clearPageInterval:function(){null!=M&&(clearInterval(M),M=null)},destoryChart:function(){n&&n.clear()}}})}(jQuery);