(function(){$.su.module=$.su.module||{};$.su.module.https=$.su.module.https||{};var modules={};var _fn=function(){return null};modules.administration=function(){var interfaces=$.su.module.createObject();var empty=$.su.module.createObject("empty");var ACC_LOCAL_HTTPS_URL_NEW=$.su.url("/admin/administration?form=https");var URL_VIRTUAL=$.su.url("/admin/nat?form=vs");var URL_PORT=$.su.url("/admin/nat?form=pt");var ACC_REMOTE_URL_NEW=$.su.url("/admin/administration?form=remote");var localHttpsProxy=new $.su.Proxy({url:ACC_LOCAL_HTTPS_URL_NEW});var virtualProxy=new $.su.Proxy({url:URL_VIRTUAL});var portTriggeringProxy=new $.su.Proxy({url:URL_PORT});var remoteProxy=new $.su.Proxy({url:ACC_REMOTE_URL_NEW});var lanIP=0;var lanMask=0;var lanProxy=new $.su.Proxy({url:$.su.url("/admin/network?form=lan_ipv4")});lanProxy.read({},function(data){lanIP=data.ipaddr;lanMask=data.mask_type.toUpperCase()=="CUSTOM"?data.custom_value:data.mask_type});var virtual_port_list=[];virtualProxy.read({},function(data){var len=data.length;var arr=[];for(var i=0;i<len;i++){var enable=data[i].enable;var protocol=data[i].protocol.toUpperCase();var port=data[i].external_port;if((enable=="on")&&(protocol!="UDP")){virtual_port_list.push(port)}}});$.extend(empty,{init:function(){var innerHTML='<input type="text"  id="port" name="port" value="" />';innerHTML+='<input type="text"  id="ipaddr" name="ipaddr" value="" />';$("#ip_port_cnt").html(innerHTML);$("#ip_port_cnt").fieldset({fields:[{name:"ipaddr"},{name:"port"}]});$("input#enable_remote").radio({fieldLabel:"",labelCls:"l",items:[{boxlabel:$.su.CHAR.ACCOUNT.DISABLE_REMOTE_MANAGEMENR,inputValue:"off",id:"radio-1"},{boxlabel:$.su.CHAR.ACCOUNT.ENABLE_REMOTE_MANAGEMENR_ALL,inputValue:"all",id:"radio-2"},{boxlabel:$.su.CHAR.ACCOUNT.ENABLE_REMOTE_MANAGEMENR,inputValue:"partial",id:"radio-3"}],column:1}).on("ev_change",function(e,oldValue,newValue){if(newValue=="off"){$("#ip_port_cnt").fieldset("disable")}else{if(newValue=="all"){$("#ip_port_cnt").fieldset("enable");$("#ipaddr").textbox("disable")}else{$("#ip_port_cnt").fieldset("enable")}}});$("input#port").textbox({fieldLabel:$.su.CHAR.ACCOUNT.WEB,vtype:"number",textFormat:$.su.format.number,allowBlank:false,maxLength:5,validator:function(val){var val=parseInt(val,10);if((val!=80)&&(val<1024)){return $.su.CHAR.ERROR["00000042"]}if(val>=65536){return $.su.CHAR.ERROR["00000042"]}return true},labelCls:"l"});$("input#ipaddr").textbox({fieldLabel:$.su.CHAR.ACCOUNT.REMOTEIP,labelCls:"l",vtype:{vtype:"ip",allowAllOneFlag:false},textFormat:$.su.format.ip,maxLength:15,allowBlank:false});function conflictPort(port,portListStr){var len=portListStr.length;for(var i=len-1;i>=0;i--){if(portListStr[i].indexOf("-")>=0){var arr=portListStr[i].split("-");if((port>=arr[0])&&(port<=arr[1])){return true}}else{if(port==portListStr[i]){return true}}}return false}$("form#remote-setting").form({proxy:remoteProxy,fields:[{name:"enable",mapping:"enable"},{name:"port",mapping:"port"},{name:"ipaddr",mapping:"ipaddr"}],submitBtn:"#remote-setting-submit",validator:function(){var port=$("input#port").textbox("getValue");var enable=$("#enable_remote").radio("getValue");if(enable=="partial"||enable=="all"){if(conflictPort(port,virtual_port_list)){$("#virtual_alert_cnt").msg("show");return false}}if($("input#enable_remote").radio("getValue")=="partial"&&$.su.func.isSameNet($("#ipaddr").textbox("getValue"),lanIP,lanMask)){$("#ipaddr").textbox("setError");$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000056"]);return false}return true}});var isRemoteLogin=false;remoteProxy.read({},function(data){isRemoteLogin=data.remote});function goToNewUrl(){var oriUrl=top.location.href;var stIindex=oriUrl.indexOf("//");var port=$("input#port").textbox("getValue");top.location.href=oriUrl.slice(0,stIindex+2)+oriUrl.slice(stIindex+2).split("/")[0].split(":")[0]+":"+port}function callback_remote_setting(data){if(isRemoteLogin){var t=setTimeout(function(){remoteProxy.read({},null,null,function(data){goToNewUrl()})},1000)}}$("button#remote-setting-submit").button({text:$.su.CHAR.LAN.SAVE,cls:"submit",handler:function(){$("form#remote-setting").form("submit",{},callback_remote_setting)}});$("#virtual_alert_cnt").msg({okHandler:function(){if($("input#enable_remote").radio("getValue")=="partial"&&$.su.func.isSameNet($("#ipaddr").textbox("getValue"),lanIP,lanMask)){$("#ipaddr").textbox("setError");$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000056"]);$("#virtual_alert_cnt").msg("close");return false}$("form#remote-setting").form("submit",null,callback_remote_setting,null,null,true,false)},cls:"m warning",cancelHandler:function(){return true},type:"prompt"});$("#virtual_confirm_content").html($.su.CHAR.ACCOUNT.NOTICE);$("#ip_port_cnt").fieldset("disable")},helpInit:function(){return"ADMIN_REMOTE_WITHOUT_HTTPS"},helpAfterLoad:function(){$("#local_management_https").hide()}});interfaces.init=function(){$("input#local_https").switchbutton({fieldLabel:$.su.CHAR.ACCOUNT.LOCAL_HTTPS,proxy:localHttpsProxy,onValue:"on",offValue:"off",labelCls:"m",cls:"form-inner",field:{name:"https_enable"}});var port_triggering_port_list=[];var innerHTML='<input type="text" id="web_address" name="web_address" value="" />';innerHTML+='<input type="text" id="https_port" name="https_port" value="" />';innerHTML+='<input type="text" id="http_port" name="http_port" value="" />';innerHTML+='<input type="text" id="managers" name="managers" value="" />';innerHTML+='<input type="text" id="ipaddr" name="ipaddr" value="" />';$("#ip_port_cnt").html(innerHTML);portTriggeringProxy.read({},function(data){var len=data.length;var arr=[];for(var i=0;i<len;i++){var enable=data[i].enable;var protocol=data[i].external_protocol.toUpperCase();var port=data[i].external_port;if((enable=="on")&&(protocol!="UDP")){port_triggering_port_list.push(port)}}});$("#ip_port_cnt").fieldset({fields:[{name:"web_address"},{name:"https_port"},{name:"http_port"},{name:"managers"},{name:"ipaddr"}]});$("input#enable_remote").checkbox({fieldLabel:$.su.CHAR.ACCOUNT.REMOTE,labelCls:"l",items:[{boxlabel:$.su.CHAR.ACCOUNT.ENABLE,uncheckedValue:"off",inputValue:"on"}]}).on("ev_change",function(e,oldValue,newValue){var val=(newValue[0]=="enable"||newValue[0]=="on")?"on":"off";switch(val){case"on":$("#ip_port_cnt").fieldset("show");var managers=$("input#managers").combobox("getValue");if(managers[0]=="all"){$("#ipaddr").textbox("disable");$("#ipaddr").textbox("hide")}if(managers[0]=="specified"){$("#ipaddr").textbox("enable");$("#ipaddr").textbox("show")}break;case"off":$("#ip_port_cnt").fieldset("hide");break}});$("input#web_address").textbox({fieldLabel:$.su.CHAR.ACCOUNT.WEB_ADDRESS_FOR_MANAGEMENT,labelCls:"l",inputCls:"xxxxl",readOnly:true});$("input#https_port").textbox({fieldLabel:$.su.CHAR.ACCOUNT.HTTPS_PORT,vtype:"number",textFormat:$.su.format.number,allowBlank:false,maxLength:5,validator:function(val){var val=parseInt(val,10);if((val!=443)&&(val<1024)){return $.su.CHAR.ERROR["00000043"]}if(val>=65536){return $.su.CHAR.ERROR["00000043"]}var http_port=parseInt($("input#http_port").textbox("getValue"),10);if(val==http_port){return $.su.CHAR.ACCOUNT.HTTPS_PORT_CONFLICT_2}return true},labelCls:"l"});$("input#http_port").textbox({fieldLabel:$.su.CHAR.ACCOUNT.HTTP_PORT,vtype:"number",textFormat:$.su.format.number,allowBlank:false,maxLength:5,validator:function(val){var val=parseInt(val,10);if((val!=80)&&(val<1024)){return $.su.CHAR.ERROR["00000042"]}if(val>=65536){return $.su.CHAR.ERROR["00000042"]}var https_port=parseInt($("input#https_port").textbox("getValue"),10);if(val==https_port){return $.su.CHAR.ACCOUNT.HTTP_PORT_CONFLICT_2}return true},labelCls:"l"});$("input#managers").combobox({fieldLabel:$.su.CHAR.ACCOUNT.REMOTE_MANAGERS,labelCls:"l",items:[{name:$.su.CHAR.ACCOUNT.ALL_DEVICES,value:"all"},{name:$.su.CHAR.ACCOUNT.SPECIFIED_DEVICE,value:"specified"}],noneSelectedText:$.su.CHAR.OPERATION.NOSELECTEDTEXT}).on("ev_change",function(e,oldValue,newValue){switch(newValue[0]){case"all":$("#ipaddr").textbox("disable");$("#ipaddr").textbox("hide");break;case"specified":$("#ipaddr").textbox("enable");$("#ipaddr").textbox("show");break}});$("input#ipaddr").textbox({fieldLabel:$.su.CHAR.ACCOUNT.ONLY_IP,labelCls:"l",vtype:{vtype:"ip",allowAllOneFlag:false},textFormat:$.su.format.ip,maxLength:15,allowBlank:false});function conflictPort(port,portListStr){var len=portListStr.length;for(var i=len-1;i>=0;i--){if(portListStr[i].indexOf("-")>=0){var arr=portListStr[i].split("-");if((port>=arr[0])&&(port<=arr[1])){return true}}else{if(port==portListStr[i]){return true}}}return false}var isRemoteLogin=false;$("form#remote-setting").form({proxy:remoteProxy,fields:[{name:"enable",mapping:"enable"},{name:"web_address",mapping:"web_address"},{name:"https_port",mapping:"https_port"},{name:"http_port",mapping:"http_port"},{name:"managers",mapping:"managers"},{name:"ipaddr",mapping:"ipaddr"}],submitBtn:"#remote-setting-submit",validator:function(){var http_port=$("input#http_port").textbox("getValue");var https_port=$("input#https_port").textbox("getValue");var enable_remote_value=$("#enable_remote").checkbox("getValue");var enable=(enable_remote_value[0]=="enable"||enable_remote_value[0]=="on")?"on":"off";if(enable=="on"){if(conflictPort(https_port,virtual_port_list)){$("#virtual_confirm_content").html($.su.CHAR.ACCOUNT.HTTPS_PORT_CONFLICT_1);$("#virtual_alert_cnt").msg("show");return false}if(conflictPort(http_port,virtual_port_list)){$("#virtual_confirm_content").html($.su.CHAR.ACCOUNT.HTTP_PORT_CONFLICT_1);$("#virtual_alert_cnt").msg("show");return false}if(conflictPort(https_port,port_triggering_port_list)){$("#virtual_confirm_content").html($.su.CHAR.ACCOUNT.HTTPS_PORT_CONFLICT_3);$("#virtual_alert_cnt").msg("show");return false}if(conflictPort(http_port,port_triggering_port_list)){$("#virtual_confirm_content").html($.su.CHAR.ACCOUNT.HTTP_PORT_CONFLICT_3);$("#virtual_alert_cnt").msg("show");return false}}if($("input#managers").combobox("getValue")[0]=="specified"&&$.su.func.isSameNet($("#ipaddr").textbox("getValue"),lanIP,lanMask)){$("#ipaddr").textbox("setError");$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000056"]);return false}return true}}).on("ev_loadData",function(e,data){if(data&&data.remote){isRemoteLogin=data.remote}});$("#remote_disabled_msg_content").text($.su.CHAR.ACCOUNT.REMOTE_DISABLED_NOTICE);$("#remote_disabled_msg_container").msg({type:"confirm",cls:"l warning",noText:$.su.CHAR.ACCOUNT.CANCEL,yesText:$.su.CHAR.ACCOUNT.CONTINUE,closeBtn:false,okHandler:function(){$("form#remote-setting").form("submit",{},null);return true}});$("button#remote-setting-submit").button({text:$.su.CHAR.LAN.SAVE,cls:"submit",handler:function(){if(!isRemoteLogin){$("form#remote-setting").form("submit",{},null)}else{$("#remote_disabled_msg_container").msg("show")}}});$("#virtual_alert_cnt").msg({okHandler:function(){if($("input#managers").combobox("getValue")[0]=="specified"&&$.su.func.isSameNet($("#ipaddr").textbox("getValue"),lanIP,lanMask)){$("#ipaddr").textbox("setError");$("#remote-setting").form("setError",$.su.CHAR.ERROR["00000056"]);$("#virtual_alert_cnt").msg("close");return false}$("form#remote-setting").form("submit",null,null,null,null,true,false)},cls:"m warning",cancelHandler:function(){return true},type:"prompt"});$("#virtual_confirm_content").html($.su.CHAR.ACCOUNT.HTTP_PORT_CONFLICT_1);$("#ip_port_cnt").fieldset("hide")};interfaces.helpInit=function(){return"ADMIN_REMOTE"};interfaces.helpAfterLoad=function(){$("#local_management_https").show()};return $.su.module.https_support?interfaces:empty};modules.virtualServers=function(){var interfaces=$.su.module.createObject();var empty=$.su.module.createObject("empty");var ACC_REMOTE_URL_NEW=$.su.url("/admin/administration?form=remote");var remoteProxy=new $.su.Proxy({url:ACC_REMOTE_URL_NEW});var remote_https_port=0;var remote_http_port=0;var remote_enable="on";var remote_port=0;$.extend(empty,{init:function(){remoteProxy.read({},function(data){remote_port=data.port;remote_enable=data.enable})},remoteEnable:function(){if(remote_enable=="off"){return true}else{return false}},conflict:function(sub_extport){if(sub_extport.length==1){sub_extport[0]=parseInt(sub_extport[0],10);if(sub_extport[0]==remote_port){$("#virtual_alert_cnt").msg("show");return false}}if(sub_extport.length==2){if((sub_extport[0]<=remote_port)&&(sub_extport[1]>=remote_port)){$("#virtual_alert_cnt").msg("show");return false}}return true}});interfaces.init=function(){remoteProxy.read({},function(data){remote_https_port=data.https_port;remote_http_port=data.http_port;remote_enable=data.enable})};interfaces.remoteEnable=function(){if(remote_enable=="off"){return true}else{return false}};interfaces.conflict=function(sub_extport){if(sub_extport.length==1){sub_extport[0]=parseInt(sub_extport[0],10);if(sub_extport[0]==remote_https_port){$("#virtual_confirm_content").html($.su.CHAR.VIRTUAL_SERVERS.NOTICE1);$("#virtual_alert_cnt").msg("show");return false}if(sub_extport[0]==remote_http_port){$("#virtual_confirm_content").html($.su.CHAR.VIRTUAL_SERVERS.NOTICE2);$("#virtual_alert_cnt").msg("show");return false}}if(sub_extport.length==2){if((sub_extport[0]<=remote_https_port)&&(sub_extport[1]>=remote_https_port)){$("#virtual_confirm_content").html($.su.CHAR.VIRTUAL_SERVERS.NOTICE1);$("#virtual_alert_cnt").msg("show");return false}if((sub_extport[0]<=remote_http_port)&&(sub_extport[1]>=remote_http_port)){$("#virtual_confirm_content").html($.su.CHAR.VIRTUAL_SERVERS.NOTICE2);$("#virtual_alert_cnt").msg("show");return false}}return true};return $.su.module.https_support?interfaces:empty};modules.portTriggering=function(){var interfaces=$.su.module.createObject();var empty=$.su.module.createObject("empty");$.extend(empty,{conflict:function(){}});var remote_https_port=0;var remote_http_port=0;var remote_enable="on";var ACC_REMOTE_URL_NEW=$.su.url("/admin/administration?form=remote");var remoteProxy=new $.su.Proxy({url:ACC_REMOTE_URL_NEW});interfaces.init=function(){remoteProxy.read({},function(data){remote_https_port=data.https_port;remote_http_port=data.http_port;remote_enable=data.enable})};interfaces.conflict=function(){var port=$("input#external_port").textbox("getValue");var protocol=$("input#external_protocol").combobox("getValue")[0];var enable=$("#trigger_enable").checkbox("getValue")[0];var sub_extport=port.split("-");if(sub_extport.length==2){sub_extport[0]=parseInt(sub_extport[0],10);sub_extport[1]=parseInt(sub_extport[1],10);if(parseInt(sub_extport[0],10)>parseInt(sub_extport[1],10)){var temp_port=sub_extport[0];sub_extport[0]=sub_extport[1];sub_extport[1]=temp_port}}if(remote_enable=="off"){return true}if((protocol!="UDP")&&(enable)){if(sub_extport.length==1){sub_extport[0]=parseInt(sub_extport[0],10);if(sub_extport[0]==remote_https_port){$("#trigger_confirm_content").html($.su.CHAR.VIRTUAL_SERVERS.NOTICE1);$("#trigger_alert_cnt").msg("show");return false}if(sub_extport[0]==remote_http_port){$("#trigger_confirm_content").html($.su.CHAR.VIRTUAL_SERVERS.NOTICE2);$("#trigger_alert_cnt").msg("show");return false}}if(sub_extport.length==2){if((sub_extport[0]<=remote_https_port)&&(sub_extport[1]>=remote_https_port)){$("#trigger_confirm_content").html($.su.CHAR.VIRTUAL_SERVERS.NOTICE1);$("#trigger_alert_cnt").msg("show");return false}if((sub_extport[0]<=remote_http_port)&&(sub_extport[1]>=remote_http_port)){$("#trigger_confirm_content").html($.su.CHAR.VIRTUAL_SERVERS.NOTICE2);$("#trigger_alert_cnt").msg("show");return false}}}return true};return $.su.module.https_support?interfaces:empty};$.su.module.https=modules}());