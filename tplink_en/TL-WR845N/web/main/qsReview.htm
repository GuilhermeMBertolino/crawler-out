<p id="et" class="et T">Quick Setup - Review Setting</p>
<div class="con1 M">
    <p class="bl"></p>
    <p class="ct"></p>
    <p class="T st" id="t_congraduation">Congratulations! The settings is finish, please click finish button to make it work.For detailed settings, please click other menus if necessary.</p>
    <p><i id="t_change" class="nd">Changing work mode should be reboot!</i>
    </p>
    <p class="bl"></p>
    <p class="ct"></p>
    <p id="t_confirm">Confirm the configuration you have set. If anything wrong,please go Back to reset.</p>
    <p><i id="t_recommend">It's recommented to take a note of these settings that you'll need later for reference.</i>
    </p>
    <p class="br"></p>
	<p class="st" id='t_tz'>Time Zone Settings</p>
	<p>
        <b class="item" id="t_timezone">Time Zone:</b>
        <span id="timezone"></span>
    </p>
	<p class="bl"></p>
    <p class="ct"></p>
    <p class="st" id='t_wl'>Wireless Settings</p>
    <p>
        <b class="item" id="t_operamode">Oreartion Mode:</b>
        <span id="opreationMode"></span>
    </p>
    <p id="regionBox" class="nd">
        <b class="item T T_region">Region:</b>
        <span id="region"></span>
    </p>
    <p class="nd">
        <b class="item T T_txpow">Transmit Power:</b>
        <span id="txpow"></span>
    </p>
    <p>
        <b class="item" id="t_channel">Wireless Channel:</b>
        <span id="channel"></span>
    </p>
    <div id="common-ctn">
        <p id="common_ssid">
            <b class="item" id="t_ssid">Wireless Network Name(SSID):</b>
        <span id="ssid"></span>
    </p>
        <p id="security-ctn">
            <b class="item" id="t_secmode">Wireless Security Mode:</b>
            <span id="security"></span>
        </p>
        <p id="pwd-ctn">
            <b class="item T_wlpwd">Wireless Password:</b>
            <span id="password"></span>
        </p>
    </div>
    <div id="multissid-ctn" class="nd">
        <div id="ssid1-ctn" class="nd">
    <p>
                <b class="item T" id="t_ssid1">SSID1:</b>
                <span id="ssid1"></span>
    </p>
			<div id="vlan1-ctn" class="nd">
			<p>
                <b class="item T" id="t_vlan1">VLAN ID:</b>
                <span id="vlan1"></span>
            </p>
			</div>
    <p>
                <b class="item T T_security"></b>
                <span id="sec_mode_1"></span>
            </p>
            <p id="pwd-1" class="nd">
                <b class="item T T_passwd">Password1:</b>
                <span id="pwd1"></span>
    </p>
            <p class="br"></p>
        </div>
        <div id="ssid2-ctn" class="nd">
    <p>
                <b class="item T" id="t_ssid1">SSID2:</b>
                <span id="ssid2"></span>
            </p>
			<div id="vlan2-ctn" class="nd">
			<p>
                <b class="item T" id="t_vlan2">VLAN ID:</b>
                <span id="vlan2"></span>
            </p>
			</div>			
            <p>
                <b class="item T T_security"></b>
                <span id="sec_mode_2"></span>
            </p>
            <p id="pwd-2" class="nd">
                <b class="item T T_passwd">Password2:</b>
                <span id="pwd2"></span>
            </p>
            <p class="br"></p>
        </div>
        <div id="ssid3-ctn" class="nd">
            <p>
                <b class="item T" id="t_ssid1">SSID3:</b>
                <span id="ssid3"></span>
            </p>
			<div id="vlan3-ctn" class="nd">
			<p>
                <b class="item T" id="t_vlan3">VLAN ID:</b>
                <span id="vlan3"></span>
            </p>
			</div>			
            <p>
                <b class="item T T_security"></b>
                <span id="sec_mode_3"></span>
            </p>
            <p id="pwd-3" class="nd">
                <b class="item T T_passwd">Password3:</b>
                <span id="pwd3"></span>
            </p>
            <p class="br"></p>
        </div>
        <div id="ssid4-ctn" class="nd">
            <p>
                <b class="item T" id="t_ssid1">SSID4:</b>
                <span id="ssid4"></span>
            </p>
			<div id="vlan4-ctn" class="nd">
			<p>
                <b class="item T" id="t_vlan4">VLAN ID:</b>
                <span id="vlan4"></span>
            </p>
			</div>
            <p>
                <b class="item T T_security"></b>
                <span id="sec_mode_4"></span>
    </p>
            <p id="pwd-4" class="nd">
                <b class="item T T_passwd">Password:</b>
                <span id="pwd4"></span>
            </p>
            <p class="br"></p>
        </div>
    </div>
    <p class="bl"></p>
    <p class="ct"></p>
    <p class="st" id="t_lan">LAN Settings</p>
    <p>
        <b class="item" id="t_defaultAccess">Default Access:</b>
        <span id="defaultAccess"></span>
    </p>	
    <p id="lan-type">
        <b class="item" id="t_lantype">LAN Type:</b>
        <span id="lanType"></span>
    </p>
    <p id="lan-addr">
        <b class="item T T_ipaddr">IP Address:</b>
        <span id="lanIp"></span>
    </p>
    <p class="bl"></p>
    <p class="tail ctr" id="tail">
        <input type="button" class="button L T T_back" value="Back" onclick="goPrev()" />
        <input type="button" class="button L T T_finish" value="Finish" onclick="reboot()" id="finish" />
    </p>
</div>
<script>
var timeZoneInfo = new Array
(
	["-12:00", "(GMT-12:00) Enewetak, Kwajalein"],
	["-11:00", "(GMT-11:00) Midway Island, Samoa"],
	["-10:00", "(GMT-10:00) Hawaii"],
	["-09:00", "(GMT-09:00) Alaska"],
	["-08:00", "(GMT-08:00) Pacific Time (US & Canada); Tijuana"],
	["-07:00", "(GMT-07:00) Mountain Time (US & Canada); Arizona"],
	["-06:00", "(GMT-06:00) Central Time (US & Canada); Central America, Mexico City"],
	["-05:00", "(GMT-05:00) Eastern Time (US & Canada); Bogota, Lima"],
	["-04:30", "(GMT-04:30) Caracas"],
	["-04:00", "(GMT-04:00) Atlantic Time (Canada); Santiago, Asuncion"],
	["-03:30", "(GMT-03:30) Newfoundland"],
	["-03:00", "(GMT-03:00) Brasilia, Buenos Aires, Georgetown, Greenland"],
	["-02:00", "(GMT-02:00) Mid-Atlantic"],
	["-01:00", "(GMT-01:00) Azores, Cape Verde Is."],
	["+00:00", "(GMT) Greenwich Mean Time: Dublin, Edinburgh, London, Lisbon"],
	["+01:00", "(GMT+01:00) Amsterdam, Berlin, Rome, Stockholm, Paris, Prague, Bratislava"],
	["+02:00", "(GMT+02:00) Cairo, Athens, Istanbul, Minsk, Jerusalem, Kiev, Chisinau"],
	["+03:00", "(GMT+03:00) Baghdad, Kuwait, Riyadh"],
	["+03:30", "(GMT+03:30) Tehran"],
	["+04:00", "(GMT+04:00) Abu Dhabi, Muscat, Baku, Tbilisi, Yerevan, Moscow, St.Petersburg"],
	["+04:30", "(GMT+04:30) Kabul"],
	["+05:00", "(GMT+05:00) Islamabad, Karachi, Tashkent"],
	["+05:30", "(GMT+05:30) Madras, Kolkata, Mumbai, New Delhi"],
	["+05:45", "(GMT+05:45) Katmandu"],
	["+06:00", "(GMT+06:00) Almaty, Astana, Dhaka, Ekaterinburg, Bishkek"],
	["+06:30", "(GMT+06:30) Rangoon"],
	["+07:00", "(GMT+07:00) Bangkok, Jakarta, Hanoi, Novosibirsk"],
	["+08:00", "(GMT+08:00) Beijing, Chongqing, Urumchi, Hong Kong, Taipei, Kuala Lumpur, Perth"],
	["+09:00", "(GMT+09:00) Tokyo, Osaka, Sapporo, Seoul"],
	["+09:30", "(GMT+09:30) Darwin, Adelaide"],
	["+10:00", "(GMT+10:00) Brisbane, Guam, Canberra, Melbourne, Sydney, Yakutsk"],
	["+11:00", "(GMT+11:00) Magadan, Solomon Is., New Caledonia"],
	["+12:00", "(GMT+12:00) Fuji, Kamchatka Peninsula, Marshall Is., Wellington"],
	["+13:00", "(GMT+13:00) Nukualofa"]
);

var regionCodeInfo = new Array
(
	[8, "AL ", 0,3, "ALBANIA"],
	[12,"DZ ", 0,3, "ALGERIA"],
	[32,"AR ", 0,3, "ARGENTINA"],
	[51,"AM ", 0,3,"ARMENIA"],
	[36,"AU ", 0,3, "AUSTRALIA"],
	[40,"AT ", 0,3,"AUSTRIA"],
	[31,"AZ ", 0,3,"AZERBAIJAN"],
	[48,"BH ", 0,3,"BAHRAIN"],
	[112,"BY ", 0,3,"BELARUS"],
	[56,"BE ", 0,3,"BELGIUM"],
	[84,"BZ ", 0,8,"BELIZE"],
	[68,"BO ", 0,8,"BOLIVIA"],
	[76,"BR ", 0,3,"BRAZIL"],
	[96,"BN ", 0,3,"BRUNEI DARUSSALAM"],
	[100,"BG ", 0,3,"BULGARIA"],
	[116,"KH ", 0,3,"CAMBODIA"],
	[124,"CA ", 0,1,"CANADA"],
	[152,"CL ", 0,3,"CHILE"],
	[156,"CN ", 0,3,"CHINA"],
	[170,"CO ", 0,1,"COLOMBIA"],
	[188,"CR ", 0,3,"COSTA RICA"],
	[191,"HR ", 0,3,"CROATIA"],
	[196,"CY ", 0,3,"CYPRUS"],
	[203,"CZ ", 0,3,"CZECH REPUBLIC"],
	[208,"DK ", 0,3,"DENMARK"],
	[214,"DO ", 0,1,"DOMINICAN REPUBLIC"],
	[218,"EC ", 0,3,"ECUADOR"],
	[818,"EG ", 0,3,"EGYPT"],
	[222,"SV ", 0,3,"EL SALVADOR"],
	[233,"EE ", 0,3,"ESTONIA"],
	[246,"FI ", 0,3,"FINLAND"],
	[250,"FR ", 0,3,"FRANCE"],
	[268,"GE ", 0,3,"GEORGIA"],
	[276,"DE ", 0,3,"GERMANY"],
	[300,"GR ", 0,3,"GREECE"],
	[320,"GT ", 0,1,"GUATEMALA"],
	[340,"HN ", 0,3,"HONDURAS"],
	[344,"HK ", 0,3,"HONG KONG"],
	[348,"HU ", 0,3,"HUNGARY"],
	[352,"IS ", 0,3,"ICELAND"],
	[356,"IN ", 0,3,"INDIA"],
	[360,"ID ", 0,3,"INDONESIA"],
	[364,"IR ", 0,3,"IRAN"],
    [368,"IQ",  0,3, "IRAQ"],
	[372,"IE ", 0,3,"IRELAND"],
	[376,"IL ", 0,7,"ISRAEL"],
	[380,"IT ", 0,3,"ITALY"],
	[392,"JP ", 3,6,"JAPAN"],
	[400,"JO ", 0,3,"JORDAN"],
	[398,"KZ ", 0,3,"KAZAKHSTAN"],
	[410,"KP ", 2,3,"NORTH KOREA"],
	[408,"KR ", 2,3,"KOREA REPUBLIC"],
	[381,"YK ", 0,3,"KOSOVO"],
	[414,"KW ", 0,3,"KUWAIT"],
	[428,"LV ", 0,3,"LATVIA"],
	[422,"LB ", 0,3,"LEBANON"],
	[438,"LI ", 0,3,"LIECHTENSTEIN"],
	[440,"LT ", 0,3,"LITHUANIA"],
	[442,"LU ", 0,3,"LUXEMBOURG"],
	[446,"MO ", 0,3,"MACAU"],
	[807,"MK ", 0,3,"MACEDONIA"],
	[458,"MY ", 0,3,"MALAYSIA"],
	[470,"MT", 0,3, "MALTA",],
	[484,"MX ", 0,1,"MEXICO"],
	[492,"MC ", 0,3,"MONACO"],
	[504,"MA ", 0,3,"MOROCCO"],
	[528,"NL ", 0,3,"NETHERLANDS"],
	[554,"NZ ", 0,8,"NEW ZEALAND"],
	[578,"NO ", 0,3,"NORWAY"],
	[512,"OM ", 0,3,"OMAN"],
	[586,"PK ", 0,3,"PAKISTAN"],
	[591,"PA ", 0,1,"PANAMA"],
    [600,"PY",  0,3,"PARAGUAY"],
	[604,"PE ", 0,3,"PERU"],
	[608,"PH ", 0,3,"PHILIPPINES"],
	[616,"PL ", 0,3,"POLAND"],
	[620,"PT ", 0,3,"PORTUGAL"],
	[630,"PR ", 0,1,"PUERTO RICO"],
	[634,"QA ", 0,3,"QATAR"],
	[642,"RO ", 0,3,"ROMANIA"],
	[643,"RU ", 0,3,"RUSSIA"],
	[682,"SA ", 0,3,"SAUDI ARABIA"],
	[702,"SG ", 4,3,"SINGAPORE"],
	[688,"RS ", 0,3,"SERBIA"],
	[703,"SK ", 0,3,"SLOVAK REPUBLIC"],
	[705,"SI ", 0,3,"SLOVENIA"],
	[710,"ZA ", 0,3,"SOUTH AFRICA"],
	[724,"ES ", 0,3,"SPAIN"],
	[752,"SE ", 0,3,"SWEDEN"],
	[756,"CH ", 0,3,"SWITZERLAND"],
	[760,"SY ", 0,3,"SYRIAN ARAB REPUBLIC"],
	[158,"TW ", 1,1,"TAIWAN"],
	[764,"TH ", 0,3,"THAILAND"],
	[780,"TT ", 0,3,"TRINIDAD AND TOBAGO"],
	[788,"TN ", 0,3,"TUNISIA"],
	[792,"TR ", 0,3,"TURKEY"],
	[804,"UA ", 0,3,"UKRAINE"],
	[784,"AE ", 0,3,"UNITED ARAB EMIRATES"],
	[826,"GB ", 0,3,"UNITED KINGDOM"],
	[840,"US ", 0,1,"UNITED STATES"],
	[858,"UY ", 0,3,"URUGUAY"],
	[860,"UZ ", 0,1,"UZBEKISTAN"],
	[862,"VE ", 0,8,"VENEZUELA"],
	[704,"VN ", 0,3,"VIET NAM"],
	[887,"YE ", 0,3,"YEMEN"],
	[716,"ZW ", 0,3,"ZIMBABWE"]
);

var powerLabel = {
	100: 	s_str.high,
	50: 	s_str.medium,
	20: 	s_str.low
};

var bReboot;
$.loadHelpFrame('QsReviewHelpRpm.htm');

function goPrev() {
    $.qf.prev();
}

function reboot() {
	var needRelogin = false;
    var obj = $.id('finish');
    $.addLoading(obj);
	
	if ($.qd.sysMode == "Hotspot")
	{
		saveConnection();
	}
	
    if ($.qd.realMode !== $.qd.sysMode) {
        var multiModeArg = {};
        multiModeArg.mode = $.qd.sysMode;
        $.act(ACT_SET, MULTIMODE, null, null, multiModeArg);
    }
    saveWireless();
    saveLan();
	saveChangePwd();
	saveTimeZone();

    if ($.qd.realMode !== $.qd.sysMode) {
        bReboot = true;
    }
    
	if( $.qd.sysMode != "Hotspot" && $.qd.sysMode != "Router")
	{
		$.act(ACT_OP, ACT_OP_NTP_REQUEST); 
	}
	
	$.exe(function(ret) {
        if (ret) {
        return;
    }
    if (bReboot) {
            // $.guage(["<span class='T_rebooting'>" + s_str.rebooting + "</span>", "<span class='T T_wait_reboot'>" + s_str.wait_reboot + "</span>"], 100, $.guageInterval, function() {
            //     $.refreshWindow();
            // });
        } else {
			if (needRelogin){
				$.deleteCookie("Authorization");
				window.parent.location.reload();
			}else{
				$.loadMain('status.htm', false);
			}
        }
    });
    if (bReboot) {
        $.guage(["<span class='T_rebooting'>" + s_str.rebooting + "</span>", "<span class='T T_wait_reboot'>" + s_str.wait_reboot + "</span>"], 100, $.guageInterval, function() {
            $.refreshWindow();
        });
    }
}

function showTimeZone()
{
	var i;

	for (i = 0; i < timeZoneInfo.length; i++)
	{
		if ($.qd.timeZone == timeZoneInfo[i][0])
		{
			break;
		}
	}
	
	if (i < timeZoneInfo.length)
	{
		$.h($.id('timezone'), timeZoneInfo[i][1]);
	}
	else
	{
		$.h($.id('timezone'), "(GMT-08:00) Pacific Time (US & Canada); Tijuana");
	}
}

function showRegion()
{
	var i;
	if ($.qd.wl.showRegion != 1)
	{
		return;
	}
	for (i = 0; i < regionCodeInfo.length; i++)
	{
		if ($.qd.wl.domain == regionCodeInfo[i][1])
		{
			break;
		}
	}
	if (i < regionCodeInfo.length)
	{
		$.h($.id('region'), country_str[i]);
		$.removeClass($.id("regionBox"), "nd");
	}
	else
	{
		$.addClass($.id('regionBox'), "nd");
	}
}
function showPower()
{
    $.h($.id('txpow'), powerLabel[$.qd.wl.power]);
}

function setDefaultHostname() {
    var c;
    var ch = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.";
    var i = 0;
    var hostname = "";
    var hostnameLen = 0;

    for (i = 0; i < $.model.length; i++) {
        c = $.model.charAt(i);
        if (ch.indexOf(c) == -1) {
            if (hostnameLen == 0 || (hostnameLen > 0 && hostname.charAt(hostnameLen - 1) == "_")) {
                continue;
            } else {
                hostname += "_";
                hostnameLen++;
            }
        } else {
            hostname += c;
            hostnameLen++;
        }
    }

    defaultHostname = (hostnameLen > 0 && hostname.charAt(hostnameLen - 1) == "_") ? hostname.substr(0, hostnameLen - 1) : hostname;
}

function showParam() {
    var mode = $.qd.sysMode.toLowerCase();
    $.h($.id('opreationMode'), s_str[mode]);
	showTimeZone();
    showRegion();
    showPower();

    if ($.qd.sysMode == "MSSID") {
        $.h($.id('channel'), $.qd.multi.chnn == "auto" ? s_str.auto : $.qd.multi.chnn);
        $.removeClass($.id('multissid-ctn'), "nd");
        $.addClass($.id('common-ctn'), "nd");
        for (var i = 1; i < 5; i++) {
            if ($.qd.multi[("enable" + i)]) {
                $.removeClass($.id('ssid' + i + '-ctn'), "nd");
				$.h($.id("ssid" + i), $.qd.multi[("ssid" + i)].replace(/\&/g, "&amp;").replace(/</g, "&lt;").replace(/ /g, "&nbsp;"));
				if ($.qd.multi[("enVlan" + i)]) {
                    $.removeClass($.id('vlan' + i + '-ctn'), "nd");
                    $.h($.id('vlan' + i), $.qd.multi[("vlan" + i)]);
                }
                if ($.qd.multi[("en_pwd" + i)] == "1") {
                    $.removeClass($.id('pwd-' + i), "nd");
                    $.h($.id('sec_mode_' + i), s_str.wpa2_psk);
                    $.h($.id('pwd' + i), $.qd.multi[("pwd" + i)]);
                } else {
                    $.h($.id('sec_mode_' + i), s_str.noneEnc);
                }
            }
        }
    } else {
		$.h($.id('channel'), $.qd.wl.chnn == "auto" ? s_str.auto : $.qd.wl.chnn);
        $.h($.id('ssid'), $.qd.wl.ssid);
        if ($.qd.wl.sec) {
            if ($.qd.wl.encryptMode == "WEPEncryption") {
                $.h($.id('security'), s_str.wepEnc);
            } else {
                $.h($.id('security'), s_str.wpa2_psk);
            }
    $.h($.id('password'), $.qd.wl.pwd);
        } else {
            $.h($.id('security'), s_str.noneEnc);
            $.addClass($.id("pwd-ctn"), "nd");
        }
        // if ($.qd.sysMode == "Client") {
        //     $.addClass($.id("security-ctn"), "nd");
        // }
        // $.h($.id('security'), $.qd.wl.sec ? 'Psk' : 'None');
    }

	if (INCLUDE_MULTIMODE_ROUTER) {	
		$.h($.id('defaultAccess'), 'http://tplinkwifi.net');
	}else{
		$.h($.id('defaultAccess'), 'http://tplinkap.net');
	}

	if ($.qd.sysMode == 'Hotspot')
	{
		$.addClass($.id('lan-addr'), 'nd');
		$.addClass($.id('lan-type'), 'nd');
	}
	else
	{
		$.h($.id('lanType'), $.qd.lan.addressType == 1 ? 'Smart DHCP' : 'Static IP');
		$.h($.id('lanIp'), $.qd.lan.tmpLanIp);

		if ($.qd.lan.addressType == 1) {
			$.addClass($.id('lan-addr'), 'nd');
		}
	}
}


function saveWirelessMulti() {
    var arg2g = {};
    if ($.qd.multi.chnn == "auto") {
        arg2g.autoChannelEnable = 1;
    } else {
        arg2g.autoChannelEnable = 0;
        arg2g.channel = $.qd.multi.chnn;
    }
    if ($.qd.multi.mode == "n-only") {
        arg2g.standard = "n-only";
    } else {
        arg2g.standard = $.qd.multi.mode;
    }
    arg2g.X_TP_Bandwidth = $.qd.multi.bandWidth;
    $.act(ACT_SET, LAN_WLAN, $.qd.multi.wlanObjStk, null, arg2g);

    var multiObj = {};
    multiObj.vlanEnabled = $.qd.multi.vlan ? 1 : 0;
    multiObj.MultiSSIDEnable = 1;
    $.act(ACT_SET, LAN_WLAN_MULTISSID, $.qd.multi.wlanObjStk, null, multiObj);
    // $.act(ACT_SET, LAN_WLAN_WPS, $.qd.multi.wlanObjStk, null, ["enable=" + 0]);
    for (var i = 1; i < 5; i++) {
        var multissidObj = {};
        multissidObj.enable = $.qd.multi[("enable" + i)];
			
        multissidObj.SSID = $.qd.multi[("ssid" + i)];
		if($.qd.multi[("vlan" + i)])
		{
			multissidObj.vlan = $.qd.multi[("vlan" + i)];
		}
        if ($.qd.multi[("en_pwd" + i)] == "1") {
            multissidObj.beaconType = "11i";
            multissidObj.IEEE11iEncryptionModes = "AESEncryption";
            multissidObj.WPAEncryptionModes = "AESEncryption";
            multissidObj.WPAAuthenticationMode = "PSKAuthentication";
            multissidObj.IEEE11iAuthenticationMode = "PSKAuthentication";
            multissidObj.preSharedKey = $.qd.multi[("pwd" + i)];
        } else {
            multissidObj.beaconType = "Basic";
            multissidObj.basicEncryptionModes = "None";
            multissidObj.BasicAuthenticationMode = "None";
        }
        
        $.act(ACT_SET, LAN_WLAN_MSSIDENTRY, $.qd.multi.ssidStkList[i - 1], null, multissidObj);
    }
}

function saveWireless() {
    if ($.qd.sysMode == 'MSSID') {
        saveWirelessMulti();
        return true;
    }
    var arg2g = {};
    if ($.qd.wl.en) {
        arg2g.enable = 1;
        arg2g.SSID = $.qd.wl.ssid;
        if ($.qd.wl.domain != $.qd.dmRegion) {
            arg2g.regulatoryDomain = $.qd.wl.domain;
        }
		//arg2g.transmitPower = $.qd.wl.power; 
        if ($.qd.wl.chnn == "auto") {
            arg2g.autoChannelEnable = 1;
        } else {
            arg2g.autoChannelEnable = 0;
            arg2g.channel = $.qd.wl.chnn;
        }
        if ($.qd.wl.mode == "n-only") {
            arg2g.standard = "n-only";
        } else if ($.qd.wl.mode == "n") {
            arg2g.standard = "n";
        } else {
            arg2g.standard = $.qd.wl.mode;
        }
        arg2g.X_TP_Bandwidth = $.qd.wl.bandwidth;

		if ($.qd.sysMode == 'Hotspot')
		{
				arg2g.SSIDAdvertisementEnabled = $.qd.wl.ssidBcastEnable;
		}

        if ($.qd.wl.sec) {
            if ($.qd.wl.encryptMode == 'WEPEncryption') {
                arg2g.beaconType = "Basic";
                arg2g.BasicEncryptionModes = "WEPEncryption";
				if ($.qd.wl.basicAuthenticationMode != undefined)
				{
						arg2g.BasicAuthenticationMode = $.qd.wl.basicAuthenticationMode;
				}
				else if ($.qd.wl.authMode != undefined)
				{
						arg2g.BasicAuthenticationMode = ($.qd.wl.authMode == "Open") ? "None" : "SharedAuthentication";
				}
                arg2g.WEPKeyIndex = $.qd.wds.wepKeyIndex;
                var stkArr = $.qd.wl.stack.split(',');
                for (var i = 0; i < stkArr.length; i++) {
                    if (stkArr[i] == 0) {
                        stkArr[i] = $.qd.wds.wepKeyIndex;
                        break;
                    }
                }
                var wepStk = stkArr.join(',');
                $.act(ACT_SET, LAN_WLAN_WPS, $.qd.wl.stack, null, ["enable=" + 0]);
                $.act(ACT_SET, LAN_WLAN_WEPKEY, wepStk, null, ["WEPKey=" + $.qd.wl.pwd]);
            } else {
                arg2g.beaconType = "11i";
                if ($.qd.wl.mode == "n-only") {
                    arg2g.IEEE11iEncryptionModes = "AESEncryption";
                    arg2g.WPAEncryptionModes = "AESEncryption";
                    arg2g.WPAAuthenticationMode = "PSKAuthentication";
                    arg2g.IEEE11iAuthenticationMode = "PSKAuthentication";
                } else {
                    arg2g.IEEE11iEncryptionModes = "AESEncryption";
                    arg2g.WPAEncryptionModes = "AESEncryption";
                    arg2g.WPAAuthenticationMode = "PSKAuthentication";
                    arg2g.IEEE11iAuthenticationMode = "PSKAuthentication";
                }
                arg2g.X_TP_PreSharedKey = $.qd.wl.pwd;
            }

        } else {
            arg2g.beaconType = "Basic";
            arg2g.basicEncryptionModes = "None";
            arg2g.BasicAuthenticationMode = "None";
        }
    } else {
        arg2g.enable = 0;
        if ($.qd.wl.domain != $.qd.dmRegion) {
            arg2g.regulatoryDomain = $.qd.wl.domain;
            arg2g.autoChannelEnable = 1;
        }
    }
	if (INCLUDE_FORCE_REGION_SELECT)
	{
		arg2g.X_TP_DomainSetByUser = 1;
	
	}
    /*Client模式下root wireless的设置保存*/
    if ($.qd.sysMode == 'Client' || $.qd.sysMode == 'Repeater' || $.qd.sysMode == 'Hotspot') {
        if ($.qd.sysMode == 'Client') {
            arg2g.SSIDAdvertisementEnabled = $.qd.wl.ssidAdver;
        }
        var arg2gwds = {};
        arg2gwds.bridgeEnable = $.qd.wds.enable;
        if (INCLUDE_LAN_WLAN_WDS_DETECT) {
            arg2gwds.bridgeAddrMode = $.qd.wds.addrMode;
        }
        arg2gwds.bridgeBSSID = $.qd.wds.bssid;
        arg2gwds.bridgeSSID = $.qd.wds.ssid;
        arg2gwds.bridgeAuthMode = $.qd.wds.authMode;
        arg2gwds.bridgeEncryptMode = $.qd.wds.encryptMode;
        arg2gwds.bridgeKey = $.qd.wds.key;
        arg2gwds.bridgeWepKeyIndex = $.qd.wds.wepKeyIndex;

        $.act(ACT_SET, LAN_WLAN_WDSBRIDGE, $.qd.wl.stack, null, arg2gwds);
    }

    $.act(ACT_SET, LAN_WLAN, $.qd.wl.stack, null, arg2g);
    return true;
}

function saveLan() {

	if ($.qd.sysMode == 'Hotspot')
	{
		return;
	}

    var ipv4Settings = {};
    if (($.ip2num($.qd.lan.oldLanIp) != $.ip2num($.qd.lan.tmpLanIp) || $.ip2num($.qd.lan.oldLanMask) != $.ip2num($.qd.lan.tmpLanMask))) {
        bReboot = true;
    }
    if (INCLUDE_SMART_DHCP) {
        if ($.qd.lan.addressType == 1) {
            bReboot = false;
            if ($.qd.lan.oldDhcpAuto == 0){
                bReboot = true;
            }
            ipv4Settings.IPInterfaceAddressingType = 'Static';
            $.act(ACT_SET, LAN_HOST_CFG, $.qd.lan.stackHost, null, ["DHCPServerEnable=" + $.qd.lan.dhcpEnable, "X_TP_DHCPAuto=" + $.qd.lan.addressType, "DNSServers=" + $.ip2ip($.qd.lan.tmpLanIp) + ",0.0.0.0"]);
        } else {
            ipv4Settings.IPInterfaceAddressingType = 'Static';
            ipv4Settings.IPInterfaceIPAddress = $.qd.lan.tmpLanIp;
            ipv4Settings.IPInterfaceSubnetMask = $.qd.lan.tmpLanMask;
			$.act(ACT_SET, LAN_HOST_CFG, $.qd.lan.stackHost, null, ["DHCPServerEnable=" + $.qd.lan.dhcpEnable, "X_TP_DHCPAuto=0", "DNSServers=" + $.ip2ip($.qd.lan.tmpLanIp) + ",0.0.0.0"]);
        }
        $.act(ACT_SET, LAN_IP_INTF, $.qd.lan.stackIP, null, ipv4Settings);
    } else {
        ipv4Settings.IPInterfaceAddressingType = 'Static';
        ipv4Settings.IPInterfaceIPAddress = $.qd.lan.tmpLanIp;
        ipv4Settings.IPInterfaceSubnetMask = $.qd.lan.tmpLanMask;
        $.act(ACT_SET, LAN_IP_INTF, $.qd.lan.stackIP, null, ipv4Settings);
    }
    return true;
}

function saveConnection() {
    if ($.qd.type) {
        var pStk;
        var staticStk;
        var dynStk;
        var PPPoEStk;
        var L2tpStk;
        var PptpStk;
        var bpaStk;
        var wanIPList = $.act(ACT_GL, WAN_IP_CONN, null, null, ["enable", "addressingType", "X_TP_IPv4Enabled", "X_TP_BpaEnable"]);
        var wanPPPList = $.act(ACT_GL, WAN_PPP_CONN, null, null, ["enable", "transportType", "X_TP_IPv4Enabled"]);
        var wanL2tpList = $.act(ACT_GL, WAN_L2TP_CONN, null, null, ["enable", "addressingType", "transportType"]);
        var wanPptpList = $.act(ACT_GL, WAN_PPTP_CONN, null, null, ["enable", "addressingType", "transportType"]);
        var wanTypes = $.act(ACT_GL, WAN_COMMON_INTF_CFG, null, null, ["WANAccessType"]);
        if ($.qd.type == "dhcp") {
            var devInfo = $.act(ACT_GET, IGD_DEV_INFO, null, null, ["modelName"]);
        }
        $.act(ACT_CGI, "/cgi/info");

        if (!$.exe()) {
            /*save MultiMode Here!*/


            $.each(wanTypes, function() {
                if (this.WANAccessType == "Ethernet")
                    pStk = this.__stack;
            });

            $.each(wanIPList, function() {
                var tmpStk = $.stkPop(this.__stack, 2);
                if (pStk == tmpStk && this.X_TP_IPv4Enabled == 1) {
                    if (this.addressingType == "Static") {
                        staticStk = this.__stack;
                    }
                    if (this.addressingType == "DHCP") {
                        if (this.X_TP_BpaEnable == 1)
                            bpaStk = this.__stack;
                        else
                            dynStk = this.__stack;
                    }
                }
            });
            $.each(wanPPPList, function() {
                var tmpStk = $.stkPop(this.__stack, 2);
                if (pStk == tmpStk && this.X_TP_IPv4Enabled == 1) {
                    if (this.transportType == "PPPoE") {
                        PPPoEStk = this.__stack;
                    }
                }
            });
            $.each(wanL2tpList, function() {
                var tmpStk = $.stkPop(this.__stack, 1);
                if (pStk == tmpStk) {
                    l2tpStk = this.__stack;
                }
            });
            $.each(wanPptpList, function() {
                var tmpStk = $.stkPop(this.__stack, 1);
                if (pStk == tmpStk) {
                    pptpStk = this.__stack;
                }
            });
            if ($.qd.type == "ppp") {
                $.act(ACT_SET, WAN_ETH_INTF, pStk, null, ["X_TP_lastUsedIntf=pppoe_eth3_d"]);
                $.act(ACT_SET, WAN_L2TP_CONN, l2tpStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_PPTP_CONN, pptpStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_PPP_CONN, PPPoEStk, null, {
                    enable: 1,
                    username: $.qd.ppp.usr,
                    password: $.qd.ppp.pwd,
                    secondConnection: $.qd.ppp.secondConnection
                });
                if (INCLUDE_DUAL_ACCESS) {
                    if ($.qd.ppp.secondConnection == "sec_conn_dynip") {
                        var wan_iplistarg_dyn = {};
                        wan_iplistarg_dyn.enable = 1;
                        $.act(ACT_SET, WAN_IP_CONN, dynStk, null, wan_iplistarg_dyn);
                        $.act(ACT_SET, WAN_IP_CONN, staticStk, null, {
                            enable: 0
                        });
                    } else if ($.qd.ppp.secondConnection == "sec_conn_staip") {
                        var wan_iplistarg_sta = {};
                        wan_iplistarg_sta.externalIPAddress = $.qd.ppp.externalIPAddress;
                        wan_iplistarg_sta.subnetMask = $.qd.ppp.subnetMask;
                        wan_iplistarg_sta.enable = 1;
                        /* fix bug, yuanshang, 2015-5-27 */
                        wan_iplistarg_sta.defaultGateway = "0.0.0.0";
                        wan_iplistarg_sta.DNSServers = "0.0.0.0,0.0.0.0";

                        $.act(ACT_SET, WAN_IP_CONN, staticStk, null, wan_iplistarg_sta);
                        $.act(ACT_SET, WAN_IP_CONN, dynStk, null, {
                            enable: 0
                        });
                    } else {
                        $.act(ACT_SET, WAN_IP_CONN, dynStk, null, {
                            enable: 0
                        });
                        $.act(ACT_SET, WAN_IP_CONN, staticStk, null, {
                            enable: 0
                        });
                    }
                } else {
                    $.act(ACT_SET, WAN_IP_CONN, dynStk, null, {
                        enable: 0
                    });
                    $.act(ACT_SET, WAN_IP_CONN, staticStk, null, {
                        enable: 0
                    });
                }
                instance = $.act(ACT_GET, WAN_PPP_CONN, PPPoEStk, null, ["name", "X_TP_IfName"]);
            } else if ($.qd.type == "dhcph") {
                setDefaultHostname();
                $.act(ACT_SET, WAN_ETH_INTF, pStk, null, ["X_TP_lastUsedIntf=ipoe_eth3_d"]);
                $.act(ACT_SET, WAN_PPP_CONN, PPPoEStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_IP_CONN, staticStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_L2TP_CONN, l2tpStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_PPTP_CONN, pptpStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_IP_CONN, dynStk, null, {
                    enable: 1,
                    NATEnabled: 1,
                    X_TP_Hostname: defaultHostname
                });
                instance = $.act(ACT_GET, WAN_IP_CONN, dynStk, null, ["name", "X_TP_IfName"]);

            } else if ($.qd.type == "staip") {
                $.act(ACT_SET, WAN_ETH_INTF, pStk, null, ["X_TP_lastUsedIntf=ipoe_eth3_s"]);
                $.act(ACT_SET, WAN_PPP_CONN, PPPoEStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_IP_CONN, dynStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_L2TP_CONN, l2tpStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_PPTP_CONN, pptpStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_IP_CONN, staticStk, null, {
                    enable: 1,
                    NATEnabled: 1,
                    externalIPAddress: $.qd.staip.ip,
                    subnetMask: $.qd.staip.mask,
                    defaultGateway: $.qd.staip.gw,
                    DNSOverrideAllowed: 1,
                    DNSServers: $.qd.staip.dns + "," + $.qd.staip.dns2
                });
                instance = $.act(ACT_GET, WAN_IP_CONN, staticStk, null, ["name", "X_TP_IfName"]);
            } else if ($.qd.type == "l2tp") {
                $.act(ACT_SET, WAN_ETH_INTF, pStk, null, ["X_TP_lastUsedIntf=l2tp_eth3_d"]);
                $.act(ACT_SET, WAN_PPP_CONN, PPPoEStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_IP_CONN, staticStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_IP_CONN, dynStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_PPTP_CONN, pptpStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_L2TP_CONN, l2tpStk, null, {
                    enable: 1,
                    username: $.qd.l2tp.usr,
                    password: $.qd.l2tp.pwd,
                    serverIpOrName: $.qd.l2tp.server,
                    addressingType: $.qd.l2tp.addrtype
                });
                if ($.qd.l2tp.addrtype == "Static") {
                    $.act(ACT_SET, WAN_L2TP_CONN, l2tpStk, null, {
                        externalIPAddressIP: $.qd.l2tp.ip,
                        subnetMaskIP: $.qd.l2tp.mask,
                        defaultGatewayIP: $.qd.l2tp.gw,
                        DNSServersIP: $.qd.l2tp.dns + "," + $.qd.l2tp.dns2
                    });
                }
                instance = $.act(ACT_GET, WAN_L2TP_CONN, l2tpStk, null, ["name", "ifName"]);
            } else if ($.qd.type == "pptp") {
                $.act(ACT_SET, WAN_ETH_INTF, pStk, null, ["X_TP_lastUsedIntf=pptp_eth3_d"]);
                $.act(ACT_SET, WAN_PPP_CONN, PPPoEStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_IP_CONN, staticStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_IP_CONN, dynStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_L2TP_CONN, l2tpStk, null, {
                    enable: 0
                });
                $.act(ACT_SET, WAN_PPTP_CONN, pptpStk, null, {
                    enable: 1,
                    username: $.qd.pptp.usr,
                    password: $.qd.pptp.pwd,
                    serverIpOrName: $.qd.pptp.server,
                    addressingType: $.qd.pptp.addrtype
                });
                if ($.qd.pptp.addrtype == "Static") {
                    $.act(ACT_SET, WAN_PPTP_CONN, l2tpStk, null, {
                        externalIPAddressIP: $.qd.pptp.ip,
                        subnetMaskIP: $.qd.pptp.mask,
                        defaultGatewayIP: $.qd.pptp.gw,
                        DNSServersIP: $.qd.pptp.dns + "," + $.qd.pptp.dns2
                    });
                }
                instance = $.act(ACT_GET, WAN_PPTP_CONN, pptpStk, null, ["name", "ifName"]);
            }

            $.act(ACT_SET, WAN_IP_CONN, bpaStk, null, {
                enable: 0
            });
			if (!$.exe()){
				newname = instance.name;
				//console.log(newname);
				$.act(ACT_SET, L3_FORWARDING, null, null, { __ifAliasName: newname, __ifName: "", defaultConnectionService: ""});
				return true;
			}else{
				doErr(ret);
				return false;
			}			
            return true;
          } else {
			doErr(ret);
			return false;
          }
    }
}

function saveChangePwd() {
	if (WEB_QS_CHANGEPASSWORD){
		if ($.qd.changPwd == 1){
			var tmpAccout = {};
			tmpAccout.oldPwd = $.qd.newaccout.oldPwd;
			tmpAccout.name = $.qd.newaccout.name;
			tmpAccout.pwd = $.qd.newaccout.pwd;
			$.act(ACT_CGI, "/cgi/auth", null, null, tmpAccout);
			needRelogin = true;
		}
	}
}

function saveTimeZone() {

	var timeParams = ["localTimeZone="+$.qd.timeZone];

	if (INCLUDE_FORCE_TIMEZONE_SELECT)
	{
		timeParams.push("X_TP_TimeZoneSetByUser=1");
	}
	
	$.act(ACT_SET, TIME, null, null, timeParams);
}

showParam();

if ($.qd.sysMode != $.qd.realMode) {
    $.removeClass($.id("t_change"), "nd");
}
</script>
