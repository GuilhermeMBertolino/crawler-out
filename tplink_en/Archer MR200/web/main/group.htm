<script>function virtualPortsEnableClick(e,l){$("#groupBtn").hasClass("disabled")||($.addLoading($(l)),$.act(ACT_SET,ETH_SWITCH,null,null,["enableVirtualPorts="+e]),$.exe(function(e){e||($.removeLoading(),$.reload())}))}function doConfig(){$.loadPage("main","groupAdd.htm")}function doDelete(e,l){for(var t=0;t<filterlist.length;t++)e.bridgeName==filterlist[t].__filterBridgeRefName&&"Default"!=filterlist[t].__filterBridgeName&&$.act(ACT_SET,L2_BRIDGING_FILTER,filterlist[t].__stack,null,["__filterBridgeRefName=Default"]);"Default"!=e.bridgeName&&$.act(ACT_DEL,L2_BRIDGING_ENTRY,e.__stack,null),$.exe(function(e){e||$.reload()})}function doDeleteNullBr(e){"Default"!=e.bridgeName&&$.act(ACT_DEL,L2_BRIDGING_ENTRY,e.__stack,null),$.exe()||$.reload()}function buildTable(){var e=0,l=1,t=[],a=0,n=$.id("tableGrouping");if(INCLUDE_WAN_MODE)var i=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);var r=$.act(ACT_GET,ETH_SWITCH,null,null,["enableVirtualPorts"]);brlist=$.act(ACT_GL,L2_BRIDGING_ENTRY,null,null,["bridgeName"]),filterlist=$.act(ACT_GL,L2_BRIDGING_FILTER,null,null,["filterKey","X_TP_IfAliasName","__filterBridgeRefName","filterEnable"]);var s=$.act(ACT_GL,L2_BRIDGING_INTF,null,null,["availableInterfaceKey","interfaceType"]);if(INCLUDE_IPTV)var f=$.act(ACT_GET,DSL_IPTV_CFG,null,null,["enable"]);var _=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);if(INCLUDE_ETHERNET_WAN)var o=$.act(ACT_GL,WAN_ETH_INTF,null,null,["enable"]);var d,T=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","connectionType","name"]),u=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","transportType","name"]),b=$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]),N=0,c=0,I=-1,C=0,p=0;if(!$.exe()){INCLUDE_WAN_MODE&&"ETH"==i.mode&&(p=1),p&&$("#add").css("display","none"),$.each(_,function(){"Ethernet"==this.WANAccessType&&(d=this.__stack)}),$("#vlan_note").addClass("nd"),INCLUDE_ETHERNET_WAN&&$.each(o,function(){this.__stack==d&&1==this.enable&&($("#groupBtn").addClass("disabled"),C=1)}),INCLUDE_IPTV&&1==f.enable&&$("#groupBtn").addClass("disabled"),$("#groupBtn").hasClass("disabled")&&($("#vlan_note").removeClass("nd"),1!=r.enableVirtualPorts&&($.act(ACT_SET,ETH_SWITCH,null,null,["enableVirtualPorts=1"]),$.exe(function(e){e||$.reload()}))),1==r.enableVirtualPorts?$("#vlanEn").addClass("selected"):$("#vlanDis").addClass("selected");for(var m=0;m<brlist.length;m++){tmpWanIf=[],tmpLanIf=[],N=0,c=0,a=0,t[m]=0;for(var L=0;L<filterlist.length;L++)if(0!=filterlist[L].filterEnable){var E=0;if(INCLUDE_ROUTE_BINDING){for(g=0;g<T.length;g++)if(T[g].name==filterlist[L].X_TP_IfAliasName&&0==T[g].enable){E=1;break}for(g=0;g<u.length;g++)if(u[g].name==filterlist[L].X_TP_IfAliasName&&(0==u[g].enable||"PPP3G"==u[g].transportType)){E=1;break}}else for(var g=0;g<T.length;g++)if(T[g].name==filterlist[L].X_TP_IfAliasName&&("IP_Routed"==T[g].connectionType||"IP_Bridged"==T[g].connectionType&&0==T[g].enable)){E=1;break}if(1!=E&&filterlist[L].__filterBridgeRefName==brlist[m].bridgeName)for(var A=0;A<s.length;A++)filterlist[L].filterKey==s[A].availableInterfaceKey&&("WANInterface"==s[A].interfaceType&&(tmpWanIf[N]=filterlist[L].X_TP_IfAliasName,tmpWanIf[N]==b.__ifAliasName&&(I=N),N++),"LANInterface"==s[A].interfaceType&&(tmpLanIf[c]=filterlist[L].X_TP_IfAliasName,c++))}for(var D=N>c?N:c,G=0;G<D;G++)(v=n.insertRow(-1)).insertCell(0).innerHTML=brlist[m].bridgeName,tmpLanIf[G]?v.insertCell(1).innerHTML=tmpLanIf[G]:v.insertCell(1).innerHTML="&nbsp;",$($(v).children().get(1)).addClass("muti-row-first"),tmpWanIf[G]&&G==I&&"Default"==brlist[m].bridgeName&&"NO_INTERFACE"!=b.__ifAliasName?v.insertCell(2).innerHTML="<font color='red'>"+tmpWanIf[G]+"</font>":tmpWanIf[G]?v.insertCell(2).innerHTML=tmpWanIf[G]:v.insertCell(2).innerHTML="&nbsp;","Default"==brlist[m].bridgeName||INCLUDE_IPTV&&"IPTV_Group"==brlist[m].bridgeName?v.insertCell(3).innerHTML="&nbsp;":v.insertCell(3).innerHTML="<a href='' onclick='doDelete(brlist["+m+"],"+m+");return false;'><span class='table-grid-icon edit-trash-icon'></span></a>",t[m]++,a=1;if(0==a){var v=n.insertRow(-1);v.insertCell(0).innerHTML=brlist[m].bridgeName,v.insertCell(1).innerHTML="&nbsp;",v.insertCell(2).innerHTML="&nbsp;","Default"==brlist[m].bridgeName?v.insertCell(3).innerHTML="&nbsp;":v.insertCell(3).innerHTML="<a href='' onclick='doDeleteNullBr(brlist["+m+"]);return false;'><span class='table-grid-icon edit-trash-icon'></span></a>",t[m]++}}for(;e<brlist.length&&n.rows[l];){for(;0==t[e];)e++;n.rows[l].cells[0].rowSpan=t[e],n.rows[l].cells[3].rowSpan=t[e];for(var h=1;h<t[e];h++)n.rows[l+h].deleteCell(0),n.rows[l+h].deleteCell(2);l+=t[e],e++}}}function initGroupingTable(){var e=[{text:table_str.group,width:"30%"},{text:table_str.lanif,width:"30%"},{text:table_str.wanif,width:"30%"},{text:table_str.del,width:"10%"}];$.initTableHead($("#tableGrouping"),e),buildTable(),"DSL"==$.sysMode?$("#sysModeNote").text(c_str.groupDSLSysMode):"ETH"==$.sysMode&&$("#sysModeNote").text(c_str.groupETHSysMode)}function init(){$("#tableGrouping").tpTable(initGroupingTable)}var tmpWanIf=[],tmpLanIf=[],brlist,filterlist</script>
<h3 id="t_grouptitle">Interface Grouping</h3>

<div class="content-container">
    <form class="pure-form pure-form-aligned">
    <p class="cfg-line" id="sysModeNote"></p>
        <div class="button-group-container" id="groupBtn">
            <b class="xl" id="t_note4">Enable the Virtual Lan Ports feature:</b>
            <ul>
                <li>
                    <button id="vlanEn" class="fst T_on" value="on">On</button>
                </li>
                <li>
                    <button id="vlanDis" class="lst T_off" value="off">Off</button>
                </li>
            </ul>
        </div>

        <div id="vlan_note">
            <p class="br"></p>
            <span id="t_note1">Note: You cannot disable VLAN functionality with an IPTV or Ethernet WAN Connection enabled.</span>
            <p class="br"></p>
        </div>

        <div class="table-op" id="tableGroupingUpper">
            <div class="table-btn" id="add">
                <span class="add-icon"></span>
                <label id="T_add" class="T_add">Add</label>
            </div>
        </div>

        <table id="tableGrouping">
            <thead></thead>
            <tbody id="tableGroupingBody"></tbody>
        </table>
    </form>
</div>

<script>$("#add").on("click",function(n){doConfig()}),$("#vlanEn").on("click",function(n){virtualPortsEnableClick(1,this)}),$("#vlanDis").on("click",function(n){virtualPortsEnableClick(0,this)}),$(document).ready(function(){$.tpInit(init)})</script>
