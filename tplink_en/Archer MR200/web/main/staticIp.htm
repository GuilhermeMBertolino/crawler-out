<script language="javascript">function initEditStaticIP(){var e=$.wd.conn[$.wd.editIndex].obj;$("#ip_address").tpAddress("val",e.externalIPAddress),$("#netmask").tpAddress("val",e.subnetMask),$("#ip_gateway").tpAddress("val",e.defaultGateway),$("#mtu").val(e.maxMTUSize),1==e.NATEnabled?($("#enable_nat").prop("checked",!0),$("#enable_fullnat").prop("checked",1==e.X_TP_FullconeNATEnabled?1:0)):0==e.NATEnabled&&($("#enable_nat").prop("checked",!1),$("#enable_fullnat").prop("disabled",!0),$("#enable_fullnat").prop("checked",!1)),$("#ip_igmp_en").prop("checked",1==e.X_TP_IGMPProxyEnabled?1:0),1==e.DNSOverrideAllowed&&($("#dns_address").tpAddress("val",e.DNSServers.split(",")[0]),$("#second_dns").tpAddress("val",e.DNSServers.split(",")[1]?e.DNSServers.split(",")[1]:"0.0.0.0")),INCLUDE_IPV6&&($("#ip_enable_v4").prop("checked",1==e.X_TP_IPv4Enabled?1:0),enableStaIPv4(1==e.X_TP_IPv4Enabled?1:0),$("#ip_enable_v6").prop("checked",1==e.X_TP_IPv6Enabled?1:0),enableStaIPv6(1==e.X_TP_IPv6Enabled?1:0),$("#ip6_address").val(e.X_TP_ExternalIPv6Address),$("#ip6_plen").val(e.X_TP_PrefixLength),$("#ip6_gateway").val(e.X_TP_DefaultIPv6Gateway),0==e.X_TP_DefaultIPv6GatewayOverride&&$("#ip6_gateway").val("::"),INCLUDE_IPV6_MLD&&$("#ip_mld_en").prop("checked",1==e.X_TP_MLDProxyEnabled?1:0),1==e.X_TP_IPv6DNSOverrideAllowed&&($("#dns6_address").val(e.X_TP_IPv6DNSServers.split(",")[0]),$("#second_dns6").val(e.X_TP_IPv6DNSServers.split(",")[1]?e.X_TP_IPv6DNSServers.split(",")[1]:"::")))}function showIPoE(){INCLUDE_IPV6&&(showIPv6(),$("#ip_enable_v4").prop("checked",!0),$("#ip_enable_v6").prop("checked",!1)),$("#ip_elem_basic").removeClass("nd"),$("#ipoeClick").removeClass("nd"),$("#ipoeClick").removeClass("cln"),$("#ip_elem_adv").addClass("nd")}function enableStaIPv4(e){e?($("#ip_basic_v4").removeClass("nd"),$("#ip_adv_v4").removeClass("nd")):($("#ip_basic_v4").addClass("nd"),$("#ip_adv_v4").addClass("nd"))}function enableStaIPv6(e){e?($("#ip_basic_v6").removeClass("nd"),$("#ip_adv_v6").removeClass("nd")):($("#ip_basic_v6").addClass("nd"),$("#ip_adv_v6").addClass("nd")),INCLUDE_IPV6_MLD&&e?$("#ip_mld").removeClass("nd"):$("#ip_mld").addClass("nd")}function initStaticIp(){showIPoE(),"staticIp"==$.wd.conn[$.wd.editIndex].type&&initEditStaticIP(),dftGtw=$("#defaut_gateway_staip"),INCLUDE_IPV6&&(dftGtw6=$("#default_gateway_staip6")),initDefaultGwDNS(),$("#divMacClone").removeClass("nd")}function stcNatClick(){$("#enable_nat").prop("data-checked")?$("#enable_fullnat").prop("disabled",!1):($("#enable_fullnat").prop("checked",!1),$("#enable_fullnat").prop("disabled",!0)),$("#enable_fullnat").data("tpCheckbox").refresh()}function IPClick(e){$(e).hasClass("cln")?($("#ip_elem_adv").addClass("nd"),$(e).removeClass("cln")):($("#ip_elem_adv").removeClass("nd"),$(e).addClass("cln")),INCLUDE_IPV6_MLD&&1==$("#ip_enable_v6").prop("data-checked")?$("#ip_mld").removeClass("nd"):$("#ip_mld").addClass("nd")}function addStaIpAttrs(){var e=$("#ip_address").tpAddress("val"),a=$("#netmask").tpAddress("val"),d=$("#ip_gateway").tpAddress("val");if(!INCLUDE_IPV6||$("#ip_enable_v4").prop("data-checked")){if($.ifip(e))return $("#ip_address").tpAddress("focus"),!1;if($.mask(a))return $("#netmask").tpAddress("focus"),!1;if($.ipmask(e,a))return $("#ip_address").tpAddress("focus"),!1}if(wanArg.externalIPAddress=$.ip2ip(e),wanArg.subnetMask=$.ip2ip(a),(!INCLUDE_IPV6||$("#ip_enable_v4").prop("data-checked"))&&$.ifip(d,!0))return $.alert(ERR_GATEWAY_IP_FORMAT),$("#ip_gateway").tpAddress("focus"),!1;if(wanArg.defaultGateway=d?$.ip2ip(d):"0.0.0.0",wanArg.NATEnabled=$("#enable_nat").prop("data-checked")?1:0,wanArg.X_TP_FullconeNATEnabled=$("#enable_fullnat").prop("data-checked")?1:0,wanArg.X_TP_IGMPProxyEnabled=$("#ip_igmp_en").prop("data-checked")?1:0,!($("#mtu").val()>=576&&$("#mtu").val()<=1500))return $.alert(ERR_WAN_MTU_INVAD),$("#mtu").focus().select(),!1;wanArg.maxMTUSize=parseInt($("#mtu").val(),10);var _=$("#dns_address").tpAddress("val"),n=$("#second_dns").tpAddress("val"),s="";if(!INCLUDE_IPV6||$("#ip_enable_v4").prop("data-checked")){if($.ifip(_,!0))return $.alert(ERR_WAN_DNSADDR_INVAD),$("#dns_address").tpAddress("focus"),!1;if(""!=n&&"0.0.0.0"!=n&&$.ifip(n,!0))return $.alert(ERR_WAN_SECDNS_INVAD),$("#second_dns").tpAddress("focus"),!1}if(_=_?$.ip2ip(_):"0.0.0.0",n=n?$.ip2ip(n):"0.0.0.0",s=_+","+n,wanArg.DNSOverrideAllowed="0.0.0.0,0.0.0.0"==s?0:1,wanArg.DNSServers=s,wanArg.enable=1,wanArg.connectionType="IP_Routed",wanArg.addressingType="Static","staticIp"==$.wd.conn[$.wd.editIndex].type&&($.wd.l3ForwardingObj.__ifAliasName=dftGtw.data("text")),INCLUDE_IPV6){if(wanArg.X_TP_IPv4Enabled=$("#ip_enable_v4").prop("data-checked")?1:0,wanArg.X_TP_IPv6Enabled=$("#ip_enable_v6").prop("data-checked")?1:0,0==wanArg.X_TP_IPv4Enabled&&0==wanArg.X_TP_IPv6Enabled)return $.alert(ERR_WAN6_IP_STACK_NONE),!1;var l=$("#ip6_address").val(),r=$("#ip6_plen").val(),d=$("#ip6_gateway").val();if(1==wanArg.X_TP_IPv6Enabled){if(!$.isValidGLUIP6AddrStrict(l))return $.alert(ERR_WAN6_ADDR_INVAD),$("#ip6_address").focus().select(),!1;if(r<0||r>128)return $.alert(ERR_WAN6_PFXLEN_INVAD),$("#ip6_plen").focus().select(),!1;if(!$.isValidGLUIP6AddrStrict(d))return $.alert(ERR_WAN6_ADDR_INVAD),$("#ip6_gateway").focus().select(),!1}wanArg.X_TP_ExternalIPv6Address=l,wanArg.X_TP_PrefixLength=r,wanArg.X_TP_DefaultIPv6Gateway=d||"::",wanArg.X_TP_DefaultIPv6GatewayOverride="::"!=wanArg.X_TP_DefaultIPv6Gateway?1:0,INCLUDE_IPV6_MLD&&(wanArg.X_TP_MLDProxyEnabled=$("#ip_mld_en").prop("data-checked")?1:0);var _=$("#dns6_address").val(),n=$("#second_dns6").val(),t="";if(1==wanArg.X_TP_IPv6Enabled){if(!$.isValidGLUIP6AddrStrict(_))return $.alert(ERR_WAN6_ADDR_INVAD),$("#dns6_address").focus().select(),!1;if(""!=n&&"::"!=n&&!$.isValidGLUIP6AddrStrict(n))return $.alert(ERR_WAN6_ADDR_INVAD),$("#second_dns6").focus().select(),!1}t=(_=_||"::")+","+(n=n||"::"),wanArg.X_TP_IPv6DNSOverrideAllowed="::,::"==t?0:1,wanArg.X_TP_IPv6DNSServers=t,"staticIp"==$.wd.conn[$.wd.editIndex].type&&($.wd.l3Ip6ForwardingObj.__ifAliasName=dftGtw6.data("text"))}return!0}$("#ip_enable_v4").click(function(){enableStaIPv4($("#ip_enable_v4").prop("data-checked"))}),$("#ip_enable_v6").click(function(){enableStaIPv6($("#ip_enable_v6").prop("data-checked"))})</script>

<div id="ip_elem_basic" class="nd">
    <div class="IPv6 nd"><b>IPv4:</b>
        <input type="checkbox" id="ip_enable_v4" checked="checked">
        <label class="T_enable"></label>
    </div>
    <div id="ip_basic_v4">
        <div><b class="T_ipaddr">IP Address:</b>
            <input type="text" id="ip_address" value="0.0.0.0" maxlength="15" class="ip-address">
        </div>
        <div><b class="T_netmask">Subnet Mask:</b>
            <input type="text" id="netmask" value="0.0.0.0" maxlength="15" class="ip-address">
        </div>
        <div><b class="T_gateway">Gateway:</b>
            <input type="text" id="ip_gateway" value="0.0.0.0" maxlength="15" class="ip-address">
        </div>
        <div><b class="T_dns">DNS Server:</b>
            <input type="text" id="dns_address" value="0.0.0.0" maxlength="15" class="ip-address">
        </div>
        <div><b class="T_secdns">Secondary DNS server:</b>
            <input type="text" id="second_dns" value="0.0.0.0" maxlength="15" class="ip-address">
            <span class="T_optional">(Optional)</span>
        </div>
        <b class="T_defgw">Default Gateway:</b>
        <select id="defaut_gateway_staip" class="l"></select>
    </div>
    <div class="IPv6 nd"><b>IPv6:</b>
        <input type="checkbox" id="ip_enable_v6">
        <label class="T_enable">&nbsp;</label>
    </div>
    <div id="ip_basic_v6" class="nd">
        <div class="IPv6 nd"><b class="T_ip6addr">IPv6 Address:</b>
            <input type="text" id="ip6_address" value="::" maxlength="40">
        </div>
        <div class="IPv6 nd"><b class="T_plen">Prefix Length:</b>
            <input type="text" id="ip6_plen" value="64" maxlength="15">
        </div>
        <div class="IPv6 nd"><b class="T_ip6gw">IPv6 Gateway:</b>
            <input type="text" id="ip6_gateway" value="::" maxlength="40">
        </div>
        <div class="IPv6 nd"><b class="T_dns">IPv6 DNS Server:</b>
            <input type="text" id="dns6_address" value="::" maxlength="40">
        </div>
        <div class="IPv6 nd"><b class="T_secdns">Secondary IPv6 DNS Server:</b>
            <input type="text" id="second_dns6" value="::" maxlength="40">
            <span class="T_optional">(Optional)</span>
        </div>

        <p class="IPv6 nd"><b class="T_ip6defgw">IPv6 Default Gateway:</b>
            <select id="default_gateway_staip6" class="l"></select>
        </p>
    </div>

</div>

<div class="advanced-block">
    <span class="advanced-icon advanced-hide-icon" id="ipoeClick" onclick="IPClick(this)"></span>
    <span class="T_adv">Advanced</span>
</div>

<div id="ip_elem_adv" class="nd">
    <div><b class="T_mtuSize">MTU Size:</b>
        <input type="text" id="mtu" size="5" maxlength="4" value="1500">
        <div class="textbox-tips">
            <span class="T_mtu1500">The default is 1500</span>,
            <span class="T_nochg">do not change unless necessary.</span>
        </div>
    </div>
    <div id="ip_adv_v4">
        <div><b class="T_ennat">Enable NAT</b>
            <input type="checkbox" id="enable_nat" checked="checked" onclick="stcNatClick()">
            <label class="T_enable">&nbsp;</label>
        </div>
        <div><b class="T_enfullcone">Enable Fullcone NAT</b>
            <input type="checkbox" id="enable_fullnat">
            <label class="T_enable">&nbsp;</label>
        </div>
        <div><b class="T_enigmp">Enable IGMP Proxy</b>
            <input type="checkbox" id="ip_igmp_en" checked="true">
            <label class="T_enable">&nbsp;</label>
        </div>
    </div>
    <div id="ip_adv_v6">
        <div id="ip_mld" class="IPv6 nd">
            <b class="T_enmld">Enable MLD Proxy</b>
            <input type="checkbox" id="ip_mld_en" checked="true">
            <label class="T_enable">&nbsp;</label>
        </div>
    </div>
</div>

<script language="JavaScript">$.tpInit(initStaticIp)</script>
