<script language="javascript">function doSave(){var e=$.act(ACT_GL,L2_BRIDGING_ENTRY,null,null,["bridgeName"]),a=$.act(ACT_GL,L2_BRIDGING_FILTER,null,null,["filterKey","X_TP_IfAliasName","__filterBridgeRefName","filterEnable"]),l=$("#groupName").prop("value"),n=$("#enableGroupIsolation").prop("data-checked")?1:0;if(!$.isname(l)){$.alert(ERR_WAN_INTER_GROUPNAME_INVALID);var t=$("#groupName");return t&&(t.focus(),t.select()),!1}if(!$.exe()){for(var i=0;i<e.length;i++)if(l==e[i].bridgeName)return void $.alert(ERR_GROUP_NAME_INVAD);var r,_,f=0,T=0;do{if(r=$("#lanID"+T),_=$("#wanID"+T),1==r.prop("data-checked")||1==_.prop("data-checked")){f=1;break}T++}while(r.length>0||_.length>0);if(!f)return void $.alert(ERR_GROUP_INVAD);if($.act(ACT_ADD,L2_BRIDGING_ENTRY,null,null,["bridgeName="+l,"X_TP_EnableBridgeIsolation="+n]),$.exe())return;$.each(a,function(e){for(a=0;(r=$("#lanID"+a)).length>0;a++)1==r.prop("data-checked")&&this.X_TP_IfAliasName==r.siblings().text()&&$.act(ACT_SET,L2_BRIDGING_FILTER,this.__stack,null,["__filterBridgeRefName="+l]);for(var a=0;(_=$("#wanID"+a)).length>0;a++)1==_.prop("data-checked")&&this.X_TP_IfAliasName==_.siblings().text()&&$.act(ACT_SET,L2_BRIDGING_FILTER,this.__stack,null,["__filterBridgeRefName="+l])}),$.exe(function(e){e||($.removeLoading(),$.loadMain("group.htm"))})}}function doBack(){$.loadMain("group.htm")}function buildTable(){$("#lanTable"),$("#wanTable"),$.act(ACT_GL,L2_BRIDGING_ENTRY,null,null,["bridgeName"]);var e=$.act(ACT_GL,L2_BRIDGING_FILTER,null,null,["filterKey","X_TP_IfAliasName","__filterBridgeRefName","filterEnable"]),a=$.act(ACT_GL,L2_BRIDGING_INTF,null,null,["availableInterfaceKey","interfaceType"]),l=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","connectionType","name"]),n=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","connectionType","name","transportType"]);$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);if(!$.exe()){var t,i,r=0,_=0;$.each(e,function(e,f){if(0!=this.filterEnable){var T=0;if(INCLUDE_ROUTE_BINDING){for(f=0;f<l.length;f++)if(l[f].name==this.X_TP_IfAliasName&&0==l[f].enable){T=1;break}for(f=0;f<n.length;f++)if(n[f].name==this.X_TP_IfAliasName&&(0==n[f].enable||"PPP3G"==n[f].transportType)){T=1;break}}else for(var f=0;f<l.length;f++)if(l[f].name==this.X_TP_IfAliasName&&("IP_Routed"==l[f].connectionType||"IP_Bridged"==l[f].connectionType&&0==l[f].enable)){T=1;break}if(1!=T)for(var b=0;b<a.length;b++)this.filterKey==a[b].availableInterfaceKey&&("Default"==this.__filterBridgeRefName&&"LANInterface"==a[b].interfaceType&&(t="<div><input type='checkbox' id='lanID"+r+"'/><label>"+this.X_TP_IfAliasName+"</label></div><p></p>",$("#lanTableTd").append(t),$("#lanTable tbody tr td").css("text-align","left"),r++),"Default"==this.__filterBridgeRefName&&"WANInterface"==a[b].interfaceType&&(i="<div><input type='checkbox' id='wanID"+_+"'/><label>"+this.X_TP_IfAliasName+"</label></div><p></p>",$("#wanTableTd").append(i),$("#wanTable tbody tr td").css("text-align","left"),_++))}})}}function initLanTable(){var e=[{text:"<b>"+table_str.avlanif+"</b>",width:"230px"}];$.initTableHead($("#lanTable"),e),$("#lanTable tbody tr td").css("text-align","left"),$("#lanTableTd").css("vertical-align","top"),$("#lanTable").css("border","none"),$("#lanTable th").css("border-left","none")}function initWanTable(){var e=[{text:"<b>"+table_str.avwanif+"</b>",width:"230px"}];$.initTableHead($("#wanTable"),e),$("#wanTable tbody tr td").css("text-align","left"),$("#wanTableTd").css("vertical-align","top"),$("#wanTable").css("border","none"),$("#wanTable th").css("border-left","none")}function init(){$("#lanTable").tpTable(initLanTable),$("#wanTable").tpTable(initWanTable),buildTable()}</script>

<h3 id="t_addgrouptitle">Add New Group</h3>
<div class="content-container">
    <form class="pure-form pure-form-aligned">
        <div>
            <label class="m" id="t_name">Group Name:</label>
            <input type="text" id="groupName" maxlength="15" oninput="$.maxlength(this)" required>
        </div>
        <p class="br"></p>
        <div class="pure-g">
            <div class="pure-u-1-2">
                <div class="content">
                    <div class="group-panel-main">
                        <table id="lanTable">
                            <thead></thead>
                            <tbody>
                                <tr>
                                    <td id="lanTableTd"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="pure-u-1-2">
                <div class="content">
                    <div class="group-panel-main" style="overflow:auto">
                        <table id="wanTable">
                            <thead></thead>
                            <tbody>
                                <tr>
                                    <td id="wanTableTd"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <input type="checkbox" id="enableGroupIsolation">
            <label id="t_eniso">Enable Group Isolation.</label>
        </div>



        <p class="br"></p>
        <div class="inline-btn-right">
            <button type="submit" class="green inline T_cancel" id="editBack">Cancel</button>
            <button type="submit" class="green inline T_save" id="editOK">Save</button>
        </div>
    </form>
</div>

<script language="javascript">$("#editBack").on("click",function(i){doBack()}),$("#editOK").on("click",function(i){$.addLoading($(this)),doSave()}),$.tpInit(init)</script>
