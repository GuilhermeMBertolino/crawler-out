<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>3G/4G</title>
<style type="text/css">
	div.container.widget-container.text-container.offset{
		position: absolute;
		top:200px;
		left:540px;
	}
</style>

</head>

<body>
<div class="func-container">

	<div id="g3_g4_panel">

		 <div id="g3_g4_form">

		 	<form id="g3_g4_setting">
		    	<input id="g_usb_modem"  name="modemstatus"/>
		    	<input id="g_location" name="locindex"/>
		    	<input id="g_mobile_isp" name="ispindex"/>

		    	<input id="g_mobile_set" name="setisp" value="" />

		    	<input id="g_isp_hidden" name="isp_hidden"/>
		    	<input id="g_dial_num" name="dialnum"/>
		    	<input id="g_apn" name="apn"/>
		    	<input id="g_username" name="username"/>
		    	<input id="g_password" name="password"/>

		    	<p id="" class="part-seperate">
		    		<span id="g_tips_preferred" class="bold"></span>
		    		<span id="g_tips_idle_time"></span>
		    	</p>

		    	<input id="g_connection_mode" name="connectmode" class=""/>

		    	<input id="g_max_idle_time" name="maxidletime"/>

		    	<input id="g_auth_type" name="authentype" class=""/>

		    	<p id="auth_type_tips" class="indent-label-m">
		    		<span id="auth_tips_notice" class="red"></span>
		    		<span id="auth_tips_default"></span>
		    	</p>

		    	<div class="part-seperate">
		    		<button id="g_btn_connect" type="button"></button>
		    		<button id="g_btn_disconnect" type="button"></button>
		    	</div>
		    	

		    	<button id="lan_submit" type="button"></button>
		    </form>

		 </div>

	</div>

	<div id="modem_help"></div>

</div>

<script type="text/javascript">
try{
    $
}catch(e){
    location.href = "/";
};

$(document).ready(function(e){
	$("div.func-container").page({
		title: $.su.CHAR.G3_G4.TITLE,
		help: ""	//可能是个调用的id 也可能是个url
	});

	$("div#g3_g4_panel").panel({
		title: $.su.CHAR.G3_G4.TITLE,
		collapsible: false
	});

	var dataProxy = new $.su.Proxy({
		// url: "./data/location.json"		
		url: $.su.url('/admin/usbmodem?form=isplist')
	});

	var locationObj = {};

	var locationStack = {};

	var localCombo = new Array();

	var firstLoad = true;


	dataProxy.read({}, function(data){
		locationObj = data;

		for (var localName in data)
		{
			var regionNum = localName.slice(8);
			locationStack[regionNum] = {};
			locationStack[regionNum]['regionCode'] = regionNum;
			locationStack[regionNum]['regionName'] = data[localName]['location_name'];

			localCombo.push({name:data[localName]['location_name'], value:regionNum});

			locationStack[regionNum]['ispList'] = [];

			for(var ispName in data[localName]){

				if(ispName.slice(0,3)=='isp'){
					locationStack[regionNum]['ispList'].push({name:data[localName][ispName]['isp_name'], value:ispName.slice(3)});
					locationStack[regionNum][ispName] = data[localName][ispName];
				}

			}
		}
		// console.log(locationStack)

		$("input#g_location").combobox('loadData', localCombo);

		formProxy.read({}, function(data){
			$("input#g_isp_hidden").textbox('setValue',  data.ispindex);

			$("form#g3_g4_setting").form('loadData', data);

			// $("input#g_mobile_isp").combobox('loadData', locationStack[data.location]['ispList'] );

			// $("input#g_mobile_isp").combobox('setValue', data.ispindex);

		});

	});

	var formProxy = new $.su.Proxy({
		url: $.su.url('/admin/usbmodem?form=modemset')
		// url: './data/g3.g4.json'
	});

	$("form#g3_g4_setting").form({
		proxy: formProxy,
		fields: [
			// {name: "modemstatus", mapping: "modemstatus"},
			{name: "locindex", mapping: "locindex"},
			{name: "ispindex", mapping: "ispindex"},
			{name: "setisp", mapping: "setisp"},
			/*{name: "dialnum", mapping: "dialnum"},
			{name: "apn", mapping: "apn"},
			{name: "username", mapping: "username"},
			{name: "password", mapping: "password"},*/
			{name: "connectmode", mapping: "connectmode"},
			{name: "maxidletime", mapping: "maxidletime"},
			{name: "authentype", mapping: "authentype"}
		],
		autoLoad: false,
		submitBtn: "default"
	}).on('ev_loadData', function(event, data){
		switch(data.modemstatus){
			case '0':
				$("input#g_usb_modem").textbox('setValue', $.su.CHAR.G3_G4.UNPLUGGED);
				break;
			case '1':
				$("input#g_usb_modem").textbox('setValue', $.su.CHAR.G3_G4.IDENTIFYING);
				break;
			case '2':
				$("input#g_usb_modem").textbox('setValue', $.su.CHAR.G3_G4.IDENTIFY_SUCCESS);
				break;
		}
	});



	$("input#g_usb_modem").textbox({
		fieldLabel: $.su.CHAR.G3_G4.USB_MODEM,
		readOnly: true
	});

	$("input#g_mobile_set").textbox({
		fieldLabel: '',
		cls: 'hidden',
		readOnly: true
	});

	$("input#g_isp_hidden").textbox({
		fieldLabel: null,
		readOnly: true,
		cls: 'hidden'
	});

	$("input#g_dial_num").textbox({
		fieldLabel: null,
		cls: 'hidden'
	});

	$("input#g_apn").textbox({
		fieldLabel: null,
		cls: 'hidden'
	});

	$("input#g_username").textbox({
		fieldLabel: null,
		cls: 'hidden'
	});

	$("input#g_password").textbox({
		fieldLabel: null,
		cls: 'hidden'
	});

	$("input#g_location").combobox({
		fieldLabel: $.su.CHAR.G3_G4.LOCATION,
		items:[
		]
	}).on('ev_change', function(){
		$("input#g_mobile_isp").combobox( 'loadData', locationStack[$("input#g_location").combobox('getValue')].ispList );
		if(firstLoad==true){
			$("input#g_mobile_isp").combobox( 'setValue', $("input#g_isp_hidden").textbox('getValue') );
			firstLoad = false;
		}else if(locationStack[$("input#g_location").combobox('getValue')].ispList.length != 0){
			$("input#g_mobile_isp").combobox( 'setValue', '0' );
		}

	});

	$("input#g_mobile_isp").combobox({
		fieldLabel: $.su.CHAR.G3_G4.MOBILE_ISP,
		inputCls: 'xl',
		items:[
		]
	}).on('ev_change', function( item, oldValue, newValue ){
		$("input#g_dial_num").textbox( 'setValue', locationStack[$("input#g_location").combobox('getValue')]['isp'+newValue].dialnum );
		$("input#g_apn").textbox( 'setValue', locationStack[$("input#g_location").combobox('getValue')]['isp'+newValue].apn );
		$("input#g_username").textbox( 'setValue', locationStack[$("input#g_location").combobox('getValue')]['isp'+newValue].username );
		$("input#g_password").textbox( 'setValue', locationStack[$("input#g_location").combobox('getValue')]['isp'+newValue].password );		
	})



	$('span#g_tips_preferred').html($.su.CHAR.G3_G4.CONNECTION_TIP);
	$('span#g_tips_idle_time').html($.su.CHAR.G3_G4.IDLE_TIME_TIP);


	$("input#g_connection_mode").radio({
		fieldLabel: $.su.CHAR.G3_G4.CONNECTION_MODE,
		columns: 1,
		items:[
			{id:'g_mode_demand', boxlabel: $.su.CHAR.G3_G4.CONNECT_ON_DEMAND, inputValue: 'ondemand', name:'connection_mode'},
			{id:'g_mode_auto', boxlabel: $.su.CHAR.G3_G4.CONNECT_AUTOMATICALLY, inputValue: 'auto', name:'connection_mode'},
			{id:'g_mode_manually', boxlabel: $.su.CHAR.G3_G4.CONNECT_MANUALLY, inputValue: 'manual', name:'connection_mode'}
		]
	}).on('ev_change', function(item, oldValue, newValue){
		if(newValue=='manual'){
			$('input#g_max_idle_time').textbox('enable');
		}else{
			$('input#g_max_idle_time').textbox('disable');
		}
	});


	$('input#g_max_idle_time').textbox({
		fieldLabel: $.su.CHAR.G3_G4.MAX_IDLE_TIME,
		labelCls: 'xs',
		inputCls: 'xs',
		tips: $.su.CHAR.G3_G4.MINUTES,
		tipsCls: 'l',
		cls: 'indent-label-m'
	});

	$("input#g_auth_type").radio({
		fieldLabel: $.su.CHAR.G3_G4.AUTHENTICATION_TYPE,
		columns: 3,
		cls: 'part-seperate',
		items:[
			{id:'g_auth_auto', boxlabel: $.su.CHAR.G3_G4.AUTO, inputValue: 'auto', name:'g_auth', checked:true},
			{id:'g_auth_pap', boxlabel: $.su.CHAR.G3_G4.PAP, inputValue: 'pap', name:'g_auth'},
			{id:'g_auth_chap', boxlabel: $.su.CHAR.G3_G4.CHAP, inputValue: 'chap', name:'g_auth'}
		]
	});

	$('span#auth_tips_notice').html($.su.CHAR.OPERATION.NOTE);
	$('span#auth_tips_default').html($.su.CHAR.G3_G4.AUTH_TYPE_TIP);

	$('button#g_btn_connect').button({
		text: $.su.CHAR.G3_G4.CONNECT,
		cls: 'inline-block indent-label-m',
		handler: function(){

		}
	});

	$('button#g_btn_disconnect').button({
		fieldLabel: null,
		text: $.su.CHAR.G3_G4.DISCONNECT,
		cls: 'inline-block part-seperate',
		handler: function(){

		}
	});


/*
	var gProxy = new $.su.Proxy({
		timeout: 20000,
		url: $.su.url('/admin/network?form=lan_ipv4')
	});

	$("form#lan-ipv4-setting").form({
		proxy: ipv4Proxy,
		fields: [
			{name: "macaddr", mapping: "macaddr"},
			{name: "ipaddr", mapping: "ipaddr"},
			{name: "mask_type", mapping: "mask_type"},
			{name: "custom_value", mapping: "custom_value"}
		],
		submitBtn: 'lan_submit',
		validator: function(){
			return true;
		}
	});

*/

	var helpLan = new $.su.Help({
		container: "div#modem_help",
		content: ['MODEM']
	});

});
</script>
</body>

</html>