<html><head>
<link rel=stylesheet href='stylemain.css' type='text/css'>
<link rel=stylesheet href='colors.css' type='text/css'>
<script language="javascript" src="util.js"></script>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<script language="javascript" src="portName.js"></script> 
<script language='javascript'>
<!-- hide
var PMAP_MAX_ENTRY = 16;
var entrynum = 0;
var sessionKey = '<%ejGetOther(sessionKey)%>';
var PortMapStr = '<%ejGetOther(PortMapStr)%>';

var tmp = PortMapStr.split("~");
var vartmp = tmp[0].split("^");

function frmLoad() {
 with ( document.forms[0] ) {
 }
}

function addClick() {
 var loc = 'portmapadd.html';
 var code = 'location=\"' + loc + '\"';
 eval(code);
}

function editClick(name) {
 var gName = '';
 gName += name;
 var loc = 'portmapedit.cgi?groupName=' + name;
 loc += '&sessionKey='+sessionKey;
 var code = 'location=\"' + loc + '\"';
 eval(code);
}

//Save and Apply Click
function savAppClick(brdSts,intfSts,rml) {
//process bridge status
var brdStsLst = '1';

//process interface status
var intfStsLst = '';
//process remove list
var rmlLst = '';
if(vartmp[0] > 1)
{
    if (rml.length > 0)
       for (i = 0; i < rml.length; i++) {
          if ( rml[i].checked == true )
             rmlLst += rml[i].value + ', ';
       }
    else if ( rml.checked == true )
       rmlLst = rml.value;
}

 var loc = 'portmapcfg.cmd?action=savapply&intfSts=' + intfStsLst + '&brdSts=' + brdStsLst + '&rml=' + rmlLst;
 loc += '&sessionKey='+sessionKey;
 var code = 'location=\"' + loc + '\"';
 eval(code);
}
   
   // Config Enable/Disable
function pmapCfgClick() {
 with ( document.forms[0] ) {
    var lName = '';
    var brdId = vartmp[1];
    var loc = 'portmapcfg.cmd?action=config';
    lName = getLNameByUName(brdId + '|' + ifName);
    loc += '&sessionKey='+sessionKey;
    var code = 'location=\"' + loc + '\"';
    eval(code);
 }
 }
 // done hiding -->
 </script>
</head><body onLoad='frmLoad()'><form>
<script>tbl_head('Interface Grouping -- A maximum '+PMAP_MAX_ENTRY+' entries can be configured');
</script>
<div style="width:90%;text-align:left">
Interface Grouping supports multiple ports to PVC and bridging groups. Each group
will perform as an independent network. To support this feature, you must
create mapping groups with appropriate LAN and WAN interfaces using
the Add button. The Remove button will remove the grouping and add the
ungrouped interfaces to the Default group. Only the default group has IP interface.<br><br>
<div style="color:#ff0000"><b>Note</b>:After add a group of interface, please reboot you router manually.</div>
</div>
<br>
<table border='1' cellpadding='4' cellspacing='0' width='90%'>

  
   <tr>
      <td class='hd'>Group Name</td>
      <td class='hd'>Remove</td>
      <td class='hd'>WAN Interface</td>
      <td class='hd'>LAN Interfaces</td>
      <td class='hd'>DHCP Vendor IDs</td>
   </tr>
    <script>
   	var htm;
   	var rows;
   	var cols;
   	rows = PortMapStr.split('~');
   	entrynum =rows.length-1;
   	if(PortMapStr!='')
	   	for(var n=1;n<rows.length;n++)
	   	{
	   			cols = rows[n].split('^');
	   			//if(cols.length!=5) continue;
	   			htm = '<tr>';
               htm += '<td rowspan="'+cols[0]+'">'+cols[1]+'</td>';
               if("Default"!=cols[1])
					{
                   htm += "<td align='center' rowspan="+cols[0]+"><input type='checkbox' name='rml' value='"+cols[1]+"'></td>";
                   htm += "<td align='center' rowspan="+cols[0]+">"+cols[2]+"</td>";
					}else
					{
                   htm += "<td align='center' rowspan="+cols[0]+">&nbsp</td>";
					}
               if("&nbsp"==cols[3])
					{
                   htm += "<td align='center' rowspan="+cols[0]+" >&nbsp</td>";
						 htm += '</tr>';
					}else
					{
						  var i = 0;
						  var brdId = cols[3];
						  var wanInterfaceInfo = cols[4];
						  var interfaceInfo = cols[5];
						  var vendorIdInfo = cols[6];
						  var wanInterfaces = wanInterfaceInfo.split('|');
						  var interfaces = interfaceInfo.split('|');
						  var vendorIds = vendorIdInfo.split('|');
						  var intfDisp = '';
						  var brdIntf = '';
						  var blankcell = ' ';
						  var numWanRows = wanInterfaces.length;
						  var numrows = interfaces.length;
						  
						  if(vendorIds.length > numrows)
						  {
							  numrows = vendorIds.length;
						  }
						  if(numWanRows.length > numrows)
						  {
							  numrows = numWanRows.length;
						  }
							 
						  
						  for (i = 0; i < numrows; i++) {
						  //table header
							  if(i > 0)
							  {
								  document.write("<tr>");
							  }
					 
								if("Default" == cols[1]) 
								{
									 // column 3: filter interface name (WAN side interface) only for Default group
										 if (i < wanInterfaces.length)
										 {
											 htm += "<td align='center'>"+wanInterfaces[i]+"</td>";
										 } else {
											 htm += "<td align='center'>"+blankcell+"</td>";
										 }
								}
						 
						  // column 4: filter interface name (LAN side interface)
							  if (i < interfaces.length)
							  {
								  brdIntf = brdId + '|' + interfaces[i];
								  intfDisp = getUNameByLName(brdIntf);
								  brdIntf = '';
								  htm += "<td align='center'>"+intfDisp+"</td>";
							  } else {
								  htm += "<td align='center'>"+blankcell+"</td>";
							  }
				
						  // last column (5): dhcp vendor id
							  if (i < vendorIds.length)
							  {
								  htm += "<td align='center'>"+vendorIds[i]+"</td>";
							  } else {
								  htm += "<td align='center'>"+blankcell+"</td>";
							  }
						  
							  htm += "</tr>";
						  }
					}
	   			document.write(htm);
	   	}
 	</script>
  </table>
<script> 
   if(entrynum<PMAP_MAX_ENTRY)
		tbl_tail("<input type='button' class='button' onClick='addClick()' value='Add'>&nbsp;&nbsp;<input type='button' class='button' onClick='savAppClick(this.form.brdSts,this.form.intfSts,this.form.rml)' value='Remove'>");
	else
		tbl_tail("<input type='button' class='button' onClick='savAppClick(this.form.brdSts,this.form.intfSts,this.form.rml)' value='Remove'>");
</script>
</form>
</body>
</html>