<html><head>
<link rel=stylesheet href='stylemain.css' type='text/css'>
<link rel=stylesheet href='colors.css' type='text/css'>
<script language='javascript' src='util.js'></script>
<meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<script language='javascript' src='util.js'></script>
<script language='javascript'>
<!-- hide

var sessionKey='<%ejGetOther(sessionKey)%>';
//"iftype,coonMode,prtcl,vlanMuxPrValue,vlanMuxIdValue,supportWanVlanMux,serviceNameSufix";
var wanSrvcInfo="<%ejGetOther(tenda,wanSrvcInfo)%>";

//0:ATM;1:pppoa;2:ipoa;3:eth;4:ptm;10:undefined/invalid
var iftype=0;
/*
	CMS_CONNECTION_MODE_DEFAULT=0,    < Default connection mdoe - single wan service over 1 connection 
   CMS_CONNECTION_MODE_VLANMUX=1,     < Vlan mux connection mdoe - multiple vlan service over 1 connection          
   CMS_CONNECTION_MODE_MSC=2,        < MSC connection mdoe - multiple wan service over 1 connection            
*/
var connMode= 0;
//macro:SUPPORT_WANVLANMUX
var supportWanVlanMux=1;
/*
	 CMS_WAN_TYPE_PPPOE               = 0,
   CMS_WAN_TYPE_PPPOA               = 1,
   CMS_WAN_TYPE_DYNAMIC_IPOE        = 2,
   CMS_WAN_TYPE_BRIDGE              = 3,
   CMS_WAN_TYPE_PPPOE_RELAY         = 4,
   CMS_WAN_TYPE_IPOA                = 5,
   CMS_WAN_TYPE_STATIC_IPOE         = 6,   
   
   CMS_WAN_TYPE_STATIC_ETHERNET_IP  = 10,
   CMS_WAN_TYPE_DYNAMIC_ETHERNET_IP = 11,
   CMS_WAN_TYPE_ETHERNET_PPPOE      = 12,
   CMS_WAN_TYPE_ETHERNET_BRIDGE     = 13,
   CMS_WAN_TYPE_UNDEFINED           = 99
*/
var prtcl=0;
//ptm0/(0_0_1):0_0_1 or atm1/(0_0_35):0_0_35
var serviceNameSufix="";
//glbWebVar.vlanMuxPr
var vlanMuxPrValue='';
//glbWebVar.vlanMuxId
var vlanMuxIdValue='';

var defaultname = '';

function initValue(){
	if(wanSrvcInfo == ""){
		btnNext();
	}
	
	var token=wanSrvcInfo.split(",");
	if(token.length != 7){
		btnNext();
	}
	
	if(token[0]==""){
		iftype=0;
	}else{
		iftype=parseInt(token[0]);
	}
	
	if(token[1]==""){
		connMode=0;
	}else{
		connMode=parseInt(token[1]);
	}
	
	if(token[2]==""){
		prtcl=0;
	}else{
		prtcl=parseInt(token[2]);
	}
	
	vlanMuxPrValue=token[3];
	vlanMuxIdValue=token[4];
//------
	if(token[3]=='0')
		vlanMuxPrValue = '';
	if(token[4]=='-1')
		vlanMuxIdValue = '';
//------	
	if(token[5]==""){
		supportWanVlanMux=1;
	}else{
		supportWanVlanMux=parseInt(token[5]);
	}
	
	serviceNameSufix=token[6];
}


function frmLoad() {
	initValue();
	showWanMode();
	
  with ( document.forms[0] ) {
  	if(prtcl == 0 || prtcl == 12){
	    ntwkPrtcl[0].checked = true;
	}else if(prtcl==2 || prtcl==6 ||prtcl==10 || prtcl==11){
		ntwkPrtcl[1].checked = true;
	}else if(prtcl==3 || prtcl==13){
		ntwkPrtcl[2].checked = true;	
	}else{
	}
    servicename.value = '';
	if(supportWanVlanMux==1){
		if((iftype==0) || (iftype==3) || (iftype==4)){	
			if(connMode==1){
				vlanMuxPr.value=vlanMuxPrValue;
				vlanMuxId.value=vlanMuxIdValue;
			}
		}
	}
  }
  prtclClick();
}

function prtclClick() {
  with ( document.forms[0] ) {
  	 if(iftype==0 || iftype==4){
  	 	if (servicename.value == '' || servicename.value == defaultname) {
		    if ( ntwkPrtcl[0].checked == true ){
				defaultname = 'pppoe_'+serviceNameSufix;
			}else if ( ntwkPrtcl[1].checked == true ){
      			defaultname = 'ipoe_'+serviceNameSufix;
			}else{
        		defaultname = 'br_'+serviceNameSufix;
			}
		    servicename.value = defaultname;
		}
	 }else if(iftype==1){	
	 	if (servicename.value == '' || servicename.value == defaultname) {
			defaultname = 'pppoa_'+serviceNameSufix;
			servicename.value = defaultname;
		}	
	 }else if(iftype==2){	
	 	if (servicename.value == '' || servicename.value == defaultname) {
			defaultname = 'ipoa_'+serviceNameSufix;
			servicename.value = defaultname;
		}	
	 }else if(iftype==3){	
	 	if (servicename.value == '' || servicename.value == defaultname) {
			if(connMode==1){		
				if ( ntwkPrtcl[0].checked == true ){
					defaultname = 'pppoe_'+serviceNameSufix;
				}else if ( ntwkPrtcl[1].checked == true ){
    	  			defaultname = 'ipoe_'+serviceNameSufix;
				}else{
					defaultname = 'br_'+serviceNameSufix;
				}
			}else{
				if ( ntwkPrtcl[0].checked == true ){
					defaultname = 'pppoe_'+serviceNameSufix;
				}else{
					defaultname = 'ipoe_'+serviceNameSufix;
				}
			}
			servicename.value = defaultname;
		}	
	 }   
  }//with
}

function btnNext() {
  var loc = '';
  with ( document.forms[0] ) {
  	if(iftype==0 || iftype==4){
		if ( ntwkPrtcl[0].checked == true )
		  loc = 'pppoe.cgi?enblEnetWan=0&ntwkPrtcl=0';
		else if ( ntwkPrtcl[1].checked == true )
		  loc = 'wancfg.cgi?enblEnetWan=0&ntwkPrtcl=2';
		else
		  loc = 'ntwksum2.cgi?enblEnetWan=0&ntwkPrtcl=3&enblDhcpSrv';
		  
		if(supportWanVlanMux==1){
			if(connMode==1){
				var vlmpr = parseInt(vlanMuxPr.value);
				var vlmid = parseInt(vlanMuxId.value);
				if(vlanMuxPr.value=='')
				{
							alert('Please input VLAN 8021p Priority.');
							return;
				}
				if(vlanMuxId.value=='')
				{
							alert('Please input VLAN ID.');
							return;
				}
				if ( vlmpr != -1 || vlmid != -1 ) {
				if ( vlmpr < 0 || vlmpr > 7 ) {
					alert('VLAN 8021p Priority \"' + vlmpr + '\" is out of range [0-7].');
					return;
				}
				if ( vlmid < 0 || vlmid > 4094 ) {
					alert('VLAN ID \"' + vlmid + '\" is out of range [0-4094].');
					return;
				}
				servicename.value =  servicename.value + '.' + vlanMuxId.value;
				}
				loc += '&enVlanMux=1&vlanMuxId='+vlmid;
				loc += '&vlanMuxPr='+vlmpr;
			}
		}
	}else if(iftype==1){
		loc = 'pppoe.cgi?enblEnetWan=0&ntwkPrtcl=1';
	}else if(iftype==2){
		loc = 'ipoacfg.cgi?enblEnetWan=0&ntwkPrtcl=5';
	}else if(iftype==3){
		if ( ntwkPrtcl[0].checked == true )
		  loc = 'pppoe.cgi?enblEnetWan=0&ntwkPrtcl=12';
		else if ( ntwkPrtcl[1].checked == true )
		  loc = 'wancfg.cgi?enblEnetWan=0&ntwkPrtcl=11';
		else
		  loc = 'ntwksum2.cgi?enblEnetWan=0&ntwkPrtcl=13';
		  
		if(supportWanVlanMux==1){
			if(connMode==1){
				var vlmpr = parseInt(vlanMuxPr.value);
				var vlmid = parseInt(vlanMuxId.value);
				if(vlanMuxPr.value=='')
				{
							alert('Please input 8021p Priority.');
							return;
				}
				if(vlanMuxId.value=='')
				{
							alert('Please input VLAN ID.');
							return;
				}
				if ( vlmpr != -1 || vlmid != -1 ) {
					if ( vlmpr < 0 || vlmpr > 7 ) {
						alert('VLAN 8021p Priority \"' + vlmpr + '\" is out of range [0-7].');
						return;
					}
					if ( vlmid < 0 || vlmid > 4094 ) {
						alert('VLAN ID \"' + vlmid + '\" is out of range [0-4094].');
						return;
					}
					servicename.value =  servicename.value + '.' + vlanMuxId.value;
				}
				loc += '&enVlanMux=1&vlanMuxId='+vlmid;
				loc += '&vlanMuxPr='+vlmpr;
			}
		}
	}
    loc += '&serviceName=' + servicename.value;
  }//with
  
	  loc += '&sessionKey='+sessionKey;
	  var code = 'location="' + loc + '"';
	 // alert("code"+code);
	  eval(code);
}

function btnBack() {
  var code = 'location="' + 'wanifc.cmd' + '"';
  eval(code);
}

function showWanMode(){
	if((iftype==0) || (iftype==3) || (iftype==4)){
		document.getElementById("wanMode").style.display = "block";	
		document.getElementById("pppoe").style.display = "block";		
		document.getElementById("ipoe").style.display = "block";
		
		if((iftype==0) || (iftype==4) || ((iftype==3)&&(connMode==1))){		
			document.getElementById("bridge").style.display = "block";
		}
	}	
	
	if(supportWanVlanMux == 1){
		if(((iftype==0)||(iftype==3)||(iftype==4))&&(connMode==1)){	
			document.getElementById("vlan").style.display = "block";
		}
	}
	
}


// done hiding -->
</script>
</head>
<body>
<body onLoad='frmLoad()'>
<script>tbl_head('WAN Service Configuration')</script>
	<form>
	
		<table id="wanMode" border='0' cellpadding='0' cellspacing='0' width='88%' style="display:none">
		  <tr><td>Select WAN service type:</td></tr>
		  <tr id="pppoe" style="display:none"><td><input type='radio' name='ntwkPrtcl' onClick='prtclClick()'>&nbsp;PPP over Ethernet (PPPoE)</td></tr>
		  <tr id="ipoe" style="display:none"><td><input type='radio' name='ntwkPrtcl' onClick='prtclClick()'>&nbsp;IP over Ethernet</td></tr>    
		  <tr id="bridge" style="display:none"><td><input type='radio' name='ntwkPrtcl' onClick='prtclClick()'>&nbsp;Bridging</td></tr>
		</table>
		
		<br><br>
		<table border='0' cellpadding='0' cellspacing='0' width='88%'>
		<tr>
		<td>Enter Service Description:&nbsp;</td>
		<td><input type='text' size='32' name='servicename'></td>
		</tr>
		</table>
		<br><br>
		
		<table id="vlan" border='0' cellpadding='0' cellspacing='0' width='88%%' style="display:none">
			<tr><td>For tagged service, enter valid 802.1P Priority and 802.1Q VLAN ID.</td></tr>
			<tr><td>For untagged service, set -1 to both 802.1P Priority and 802.1Q VLAN ID.</td></tr>
			<tr><td>&nbsp;</td></tr>
			<tr>
				<td>Enter 802.1P Priority [0-7]:&nbsp;</td>
				<td><input type='text' size='4' name='vlanMuxPr'></td>
			</tr>
			<tr>
				<td>Enter 802.1Q VLAN ID [0-4094]:&nbsp;</td>
				<td><input type='text' size='4' name='vlanMuxId'></td>
			</tr>
		</table>
		<br><br>
		
		
		<script>tbl_tail("<input type='button' class='button' onClick='btnBack()' value='Back'>&nbsp;&nbsp;<input type='button' class='button' onClick='btnNext()' value='Next'>")
		</script>
	</form>
</blockquote>
</body>
</html>
