#!/bin/sh

CSID_DUALBAND="0x00193201"
DUALBAND=`rdcsman $CSID_DUALBAND u32`

if [ $DUALBAND -eq 1 ]; then
	WSCUPNP_FILE="/var/run/wscd.pid.rai0"
	CONFIG_FILE="/etc/Wireless/RT2860AP/RT5392AP.dat"
else
	WSCUPNP_FILE="/var/run/wscd.pid.ra0"

	if [ -e "/etc/Wireless/RT2860AP/RT5392AP.dat" ]; then
		CONFIG_FILE="/etc/Wireless/RT2860AP/RT5392AP.dat"
	else
	
	if [ -e "/etc/Wireless/RT2860/RT2860.dat" ]; then
		CONFIG_FILE="/etc/Wireless/RT2860/RT2860.dat"
	else
		CONFIG_FILE="/etc/Wireless/RT2860AP/RT2860AP.dat"
	fi
	fi
fi

IWPRIV="/usr/sbin/iwpriv"
CSID_WPSSTATUS="0x80190103"
CSID_SYS_WLANIF="0x8000F391"
WLAN_IF=`rdcsman $CSID_SYS_WLANIF str`

# Monitor the status
status_pre="0"
while [ true ] ; do
    status="`$IWPRIV $WLAN_IF stat | grep "WscStatus($WLAN_IF)" | awk '{print $2}'`"
    if [ "$status" != "$status_pre" ] ; then
        status_pre="$status"
        wrcsman "$CSID_WPSSTATUS $status"
    fi
	sleep 1
done
