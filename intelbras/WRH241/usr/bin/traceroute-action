#!/bin/ash

case "$1" in

	start)
		TARGET=`rdcsman 0x8015000F str`
		traceroute -w 2 "$TARGET" > /var/run/traceroute_result  &
		PID=$!
		wrcsman "0x80150011 $PID && 0x80150010 1"		
		;;
		
	startv6)
		TARGET=`rdcsman 0x8015000F str`
		traceroute -w 2 "$TARGET" > /var/run/traceroute_result  &
		PID=$!
		wrcsman "0x80150011 $PID && 0x80150010 1"
		;;

	status)
		PID=`rdcsman 0x80150011 u32`
		if [ ! -d "/proc/$PID" ] ; then
			wrcsman "0x80150010 0"
		fi	
		;;
	
	show)	
		cat /var/run/traceroute_result
		;;
	
	*)
		exit 1
		;;
esac

exit 0

